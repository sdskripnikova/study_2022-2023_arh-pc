window.__OCTAVIUS_READY__=!0;(function(a){"use strict";if(typeof window=="object"&&window.wallaby){wallaby.delayStart();a("./",require,wallaby)}else if(typeof define==="function"&&define.amd){define("jssdk",function(){var b=require.toUrl("jssdk");return a(/^..?\//.test(b)?"./":b.split("/").slice(0,-1).join("/"),require)})}else{var b=a(__dirname,{config:function(){}});delete b.tests;delete b.bench;delete b.modules;module.exports={cfg:b,extend:function(a){Object.keys(this.cfg).forEach(function(b){var c=a[b],d=this[b];if(a[b]){if(c instanceof Array){a[b]=c.concat(d)}else{Object.keys(d).forEach(function(a){c[a]=d[a]})}}else{a[b]=d}},this.cfg);return a}}}})(function(a,require,b){"use strict";var c={},d;require.config(d={deps:b?b.tests:[],callback:b&&b.start,paths:function(b){b.tests=[];b.bench=[];b.paths={};b.modules=["config","logger","Emitter","request","RPC","RPC/statuses/sdc","RPC/statuses/token","RPC/statuses/processing","RPC/statuses/secure_folder","RPC/statuses/oauth_fail","Storage","TaskScheduler","Task","Model","Model.List","RPCModel","cloud/Entry","cloud/actions/AcceptLicense","cloud/actions/Space","uuid","utils/util","utils/extension","utils/url","utils/promise","mail/Folder","mail/SharedMailbox","mail/Contact","mail/User","mail/UserSecurity","mail/Phone","mail/Password","Action","Transaction","mail/actions/AddAttachToCloud","mail/actions/AddCloudStockToCloud","mail/actions/AddToCloud","mail/actions/CategoryChange","mail/actions/ContactSuggests","mail/actions/CloudFolderAdd","mail/actions/MarkAs","mail/actions/MarkAsAll","mail/actions/MoveTo","mail/actions/MoveToAll","mail/actions/Delete","mail/actions/DeleteAll","mail/actions/Spam","mail/actions/Archive","mail/actions/ArchiveAll","mail/actions/Schedule","mail/actions/PasswordGenerate","mail/actions/FolderAccessToken","mail/actions/UserAdditionalEmail","mail/actions/Toggle2StepAuth","mail/actions/Translate","mail/actions/Snooze","mail/actions/PasswordRecovery","mail/actions/PasswordStrength","mail/actions/PasswordSupport","mail/actions/PasswordChange","mail/actions/UserSignup","mail/actions/UserSignatureAttachesAdd","mail/actions/UserSignatureAttachesAdd/SignUploadTask","mail/actions/UserSignatureAttachesAdd/Transport","mail/actions/ConfirmReceipt","mail/actions/PromoplatesManage","mail/actions/UserEditMetathreads","mail/actions/CleanmasterUnreadManage","mail/actions/MessagesMeta","mail/Message","mail/Thread","calendar/Event","calendar/Calendar","calendar/actions/EventAction","mail/Attachment","mail/MessageFormData","mail/MessageFormData/Preprocessor","mail/MessageFormData/Transport","mail/MessageFormData/Reattach","mail/MessageFormData/Attachment/AddAttachment","mail/MessageFormData/Attachment/RemoveAttachments","mail/MessageFormData/Template","mail/MessageFormData/Translate","mail/MessageFormData/ConstructFormData","mail/MessageFormData/PrototypeHelpers","mail/MessageFormData/tasks/CloudStockUploadTask","mail/MessageFormData/tasks/MailUploadTask","mail/MessageFormData/tasks/OversizeCloudUploadTask","mail/MessageFormData/tasks/ReattachTask","mail/MessageFormData/Utils","mail/MessageFormData/MainActions/Send","mail/MessageFormData/MainActions/Save","mail/MessageFormData/MainActions/CancelDelivery","mail/MessageFormData/MainActions/ForceDelivery","mail/MessageFormData/MainActions/Destroy","mail/MessageFormData/MainActions/ToJSON","mail/MessageFormData/ModelHelpers","mail/User/TOTPCode","mail/RestoreEmail","oauth/Application","mail/User/Error","help/Content","mail/actions/PhoneCheck","mail/SmartReply","mail/actions/PushToRebus","mail/AttachSearch","mail/Collector","mail/Alias","mail/mixins/Translator","mail/TransactionMetadata","mail/PromoDomain","mail/actions/Redirect","filters/actions/ChangeOrder","filters/actions/ConfirmForward","filters/actions/Edit","filters/actions/ResendConfirm","filters/actions/SaveSeveral","filters/actions/SwitchEnabled","filters/Filter","mail/getters/MessageMeta","jssdk/next/action/global","jssdk/next/action","jssdk/next/logger","jssdk/next/logger/logger","jssdk/next/model/attrs","jssdk/next/model","jssdk/next/model/model","jssdk/next/model/ref","jssdk/next/model/source","jssdk/next/react/action","jssdk/next/react","jssdk/next/react/selector","jssdk/next/react/state","jssdk/next/react/util","jssdk/next/request","jssdk/next/rpc/addons/event-emitter","jssdk/next/rpc/addons/recorder","jssdk/next/rpc/backend","jssdk/next/rpc/files","jssdk/next/rpc/hook","jssdk/next/rpc/hooks/default","jssdk/next/rpc/hooks/mailapi-token","jssdk/next/rpc/hooks/no-sdc","jssdk/next/rpc/hooks/noop","jssdk/next/rpc/hooks/oauth-token","jssdk/next/rpc/hooks/processing","jssdk/next/rpc/http","jssdk/next/rpc","jssdk/next/rpc/legacy-bridge","jssdk/next/rpc/mailapi","jssdk/next/rpc/qs","jssdk/next/rpc/request","jssdk/next/rpc/response","jssdk/next/rpc/rest","jssdk/next/rpc/rpc","jssdk/next/rpc/swa","jssdk/next/rpc/test.util","jssdk/next/rpc/typing","jssdk/next/state/global","jssdk/next/state","jssdk/next/state/selector","jssdk/next/subject","jssdk/next/subject/subject","jssdk/next/types","jssdk/next/util/abort-ctrl","jssdk/next/util/define","jssdk/next/util/lazy","jssdk/next/util/url"];b.modules.forEach(function(a){var c=a.split("/");if(/^@?jssdk(\/|$)/.test(a)){var d=[].concat(c.slice(1),c.length==2?"index":[]).join("/");b.paths[a]=d;return}c.push(c.slice().pop());c=c.join("/");b.tests.push(a+".test");b.bench.push(a+".bench");b.paths[a+".test"]=c+".test";b.paths[a+".bench"]=c+".bench";b.paths[a]=c});b.paths["mail/Spam/old-api-adapter"]="mail/actions/Spam/old-api-adapter";var c={filter:"vendor/filter","jquery.mockjax":"vendor/jquery.mockjax",inherit:"vendor/inherit",performance:"vendor/performance",apidoc:"tests/apidoc",uuid:"vendor/uuid"};function d(){var c=b.paths;[].forEach.call(arguments,function(b){Object.keys(b).forEach(function(d,e){e=b[d];c[d]=(/^(\/\/|http)/.test(e)?"":a+"/")+e})});return c}return d(b.paths,c)}(typeof c==="undefined"?{}:c)});Object.keys(d).forEach(function(a){c[a]=d[a]});return c});define("node_modules/@mail/jssdk/boot",["jssdk"],function(a){return a});"use strict";var MODULES_PATH="node_modules";var paths={trackJS:"empty:","mrg-xray":"empty:","@mail/xray":"empty:",timingNow:"empty:","xray-config":"empty:","filters.mail.ru":"empty:",blitz:"empty:",themesConfig:"empty:","socket.io":"https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io","io-socket":"service/socket-io",AuthGateLoader:"service/authgate","modernizr-custom":"bundles/vendor/modernizr-custom",dompurify:"../node_modules/dompurify/dist/purify.min","@mail-core/dashboard/keeper":"../node_modules/@mail-core/dashboard/keeper","@mail/radars-decorator":"../node_modules/@mail/radars-decorator/dist/index-feast","@mail/radars-decorator/dist/index-react":"../node_modules/@mail/radars-decorator/dist/index-react","@mail/features":"../node_modules/@mail/features/dist/features",mqmatch:"../node_modules/mqmatch/dist/mqMatch.min","cross.project.dnd":"../node_modules/cross.project.dnd/dist/lib","ui-react":"bundles/react/ui-react.bundle","vk-messenger":"bundles/react/vk-messenger.bundle","react.env":"empty:",react:"empty:","react-dom":"empty:","react-intl":"empty:","@mail/operands":"../node_modules/@mail/operands/dist/@mail/operands.umd","@octo/smart-input":"../node_modules/@octo/smart-input/dist/@octo/smart-input.umd","@mail/adman":"../node_modules/@mail/adman/dist/adman","@mail/adman-logger":"../node_modules/@mail/adman-logger/dist/adman-logger","@mail/amp-viewer":"../node_modules/@mail/amp-viewer/amp-viewer","@mail/contact-validation":"../node_modules/@mail/contact-validation/dist/contact-validation","@mail/smokescreen":"../node_modules/@mail/smokescreen/dist/mrg-smokescreen","@mail/nano-xhr":"empty:","mrg-nano-xhr":"empty:","@mail/honeypot":"../node_modules/@mail/honeypot/dist/main","@mail/mimic/dist/types/src/projects/octavius":"../node_modules/@mail/mimic/dist/octavius.bundle","ductus-loader":"../node_modules/@mail/ductus/dist/ductus-loader","@mail/darkosha":"../node_modules/@mail/darkosha/dist/darkosha","@mail/calls-api":"../node_modules/@mail/calls-api/dist/calls-api","@mail-core/logger":"../node_modules/@mail-core/logger","@mail/release-detect":"../node_modules/@mail/release-detect/release-detect","@mail/notifier-client":"../node_modules/@mail/notifier-client/dist/notifier-client.min","@mail/sw-box":"../node_modules/@mail/sw-box/dist/sw-box.client",axios:"../node_modules/axios/dist/axios","axios-jsonp":"../node_modules/axios-jsonp/dist/index","axios-mock-adapter":"../node_modules/axios-mock-adapter/dist/axios-mock-adapter","service/addressbook/addressbook":"service/addressbook/addressbook-impl","@mail/vkui":"empty:","@mail/vkui/2kit":"empty:","suggests/group":MODULES_PATH+"/suggests/src/group","suggests/suggests":MODULES_PATH+"/suggests/src/suggests","suggests/data-source":MODULES_PATH+"/suggests/src/data-source","suggests/labels":MODULES_PATH+"/suggests/src/labels","suggests/search-index":MODULES_PATH+"/suggests/src/search-index","suggests/template":MODULES_PATH+"/suggests/src/template","suggests/punto":MODULES_PATH+"/suggests/src/punto",mobx:"../node_modules/mobx/lib/mobx.umd","mobx-react":"../node_modules/mobx-react/index","prop-types":"../node_modules/prop-types/prop-types.min",classnames:"../node_modules/classnames/index","mobx-state-tree":"../node_modules/mobx-state-tree/dist/mobx-state-tree.umd","regenerator-runtime":"../node_modules/regenerator-runtime/runtime","page-lifecycle":"../node_modules/page-lifecycle/dist/lifecycle.es5","feast-css":MODULES_PATH+"/feast/src/require-css","feast-tpl":MODULES_PATH+"/feast/src/require-feast","feast-svg":MODULES_PATH+"/feast/src/require-svg","mailru-toolkit-bundle":"bundles/mailru-toolkit/mailru-toolkit","mailru-toolkit-lego-bundle":"bundles/mailru-toolkit/mailru-toolkit.lego","mrg-message-broker/Subscription/Subscription":MODULES_PATH+"/mrg-message-broker/dist/main","@mail/oauth":"../node_modules/@mail/oauth/oauth-client","left-pad":MODULES_PATH+"/left-pad/index","@mail/keymaster":"../node_modules/@mail/keymaster/main",twemoji:"../node_modules/twemoji/dist/twemoji.amd","@mail/cross-url-sharing":"../node_modules/@mail/cross-url-sharing/.build/index","@mail/e.mail.ru.feedback":"../node_modules/@mail/e.mail.ru.feedback/dist/index.min"};var noOverwritePaths={"mailru-toolkit-lego-bundle":true,"mailru-toolkit-bundle":true,"vk-messenger":true,mimic:true};if(typeof window!=="undefined"){var requirePaths=require.s.contexts._.config.paths;for(var pathsKey in paths){if(paths[pathsKey]==="empty:"){delete paths[pathsKey]}if(!window.skipRequireClear&&noOverwritePaths[pathsKey]&&requirePaths[pathsKey]){delete paths[pathsKey]}}delete paths["toolkit-common/keymaster/keymaster"]}require.config({deps:["jssdk"],waitSeconds:0,config:{feast:{debug:typeof window!=="undefined"&&!window.BUILD,socket:typeof window!=="undefined"&&!window.BUILD,useTryCatch:typeof location!=="undefined"&&/ui-block/.test(location.pathname)}},bundles:{"react.env":["react","react-dom","react-intl"]},packages:[{name:"feast-app",location:"@mail/feast-dev/app",main:"app.js"}],shim:{"mailru-toolkit-lego-bundle":{},themesConfig:{deps:["mrg-i18n-utils"]},"FileAPI/plugins/FileAPI.exif":{deps:["FileAPI"]}},paths:paths});if(typeof window!=="undefined"){window.define("feast-mailru-toolkit/toolkit-updater",["node_modules/feast-mailru-toolkit/toolkit-updater"],function(a){return a});if(!window.skipRequireClear){window.define("features",["@mail/features"],function(a){return a})}window.define("@mail/blitz",["blitz"],function(a){return a});window.define("@mail/share-folder",["share-folder"],function(a){return a})}define("require.config",[],function(){});define("init/i18n",["require","exports","mrg-i18n-utils"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("cfg",["require","exports","config"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b=a.default(window.__cfgOptions);var c=window.sotaConfig.cfg;b.set(c);b.set("requirejs-config",{paths:window.requirejsConfig.paths});b.set("themesPath",window.getThemesPath());exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("cfgUser",["require","exports","config"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b=window.sotaConfig.userConfig;var c=a.default(b);b.api.forEach(function(a){if(a.method==="/api/v1/user/short"){c.set("initialUser",a.data.body);c.set("initialUser.email",a.data.email)}});exports.default=c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/browser",["require","exports","modernizr-custom","mrg-device-tools"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=b.default.matchUserAgent(navigator.userAgent);function d(){return a.default.touchevents||c.msie&&a.default.pointerevents}function e(){var b;if(a.default.hovermq){b=a.default.mq("(hover:hover)")}else{b=!a.default.mq("screen and (max-width: 760px)")||!a.default.touchevents}return b}c.capabilities={"hover-support":e(),"touch-support":d(),"sticky-support":a.default.csspositionsticky};c.mac=!!navigator.userAgent.match(/\bMac\b/);var f={};c.prefixedCSS=function(b){if(!f[b]){f[b]=a.default.prefixedCSS(b)}return f[b]};var g=window.navigator.userAgent.toLowerCase();c.isIE=!!g.match(/msie/);c.isSafari=/safari/.test(g)&&!/chrome/.test(g);c.isTouchDevice=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints||typeof window.orientation!=="undefined"||/(iphone|ipod|ipad|android|iemobile|blackberry|bada)/.test(g)};c.cssPositionValueSupported=function(a){var b=document.createElement("div");try{for(var c=0,d=a;c<d.length;c++){var e=d[c];b.style.position=e;if(b.style.position===e){return e}}}catch(a){return""}return""};c.hasTouchPointer=function(){var a=false;try{a=window.matchMedia("(pointer:coarse)").matches}catch(a){}return a};c.supportedSticky=c.cssPositionValueSupported(["sticky","-webkit-sticky"]);exports.default=c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("temporary/force-3pane-exp",["require","exports","@mail/features","@mail/flags","@mail/xray"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.perform=exports.needForce3Pane=exports.getExpStatus=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(){var a=new URLSearchParams(window.location.search);return a.has("newreg")};var e=function(){if(!a.default.has("force-3pane-exp")||b.default.get("use-3pane").isExist()||!d()){return"noexp"}return a.default.getAsBoolean("force-3pane-exp",false)?"3pane":"2pane"};exports.getExpStatus=e;var f=function(){return exports.getExpStatus()==="3pane"};exports.needForce3Pane=f;var g=function(){var a=exports.getExpStatus();if(a==="noexp"){return}b.default.get("use-3pane").save({state:a==="3pane",close:a==="3pane",time:true}).then(function(){c.default.send("force_3pane_experiment",{dwh:{state:a==="3pane"}})})};exports.perform=g});define("helpers/querystring",["exports","pilotjs"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var c=b;if(typeof b!=="string"){return{}}if(b.includes("?")){c=b.split("?")[1]}return a.queryString.parse(c)}});define("RPC/statuses/processing",["RPC","logger"],function(a,b){"use strict";var c={status:"processing",process:function(a){var c=a.get("body.retry_after");b.add("processing.retry_after",c);a.options.retries++;return function(a){setTimeout(function(){b.add("processing.retry_after.resolve",c);a()},c)}}};a.attachBaseErrorHandler(c);return c});define("RPC/statuses/sdc",["RPC","request","utils/util"],function(a,b,c){"use strict";var d;var e={status:"denied:nosdc",process:function(e,f){if(!d){var g=c.urlToAbsolute(e.get("url"));var h=(f||a).setup("sdcUrl");d=b.get(h,{from:g},window.IS_TESTS?{}:{jsonp:"JSONP_call",dataType:"jsonp",force:true}).then(function(a){return a}).catch(function(a){return a}).then(function(a){d=null;return a}).then(function(a){return a.body?true:Promise.reject()})}return d}};a.attachBaseErrorHandler(e);return e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("RPC/statuses/secure_folder",["require","exports","RPC","logger","Action","mail/Folder"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=function(a){return(a===null||a===void 0?void 0:a.error)==="not_open"};function f(a){var b=a.body,c=b===void 0?{}:b;var d;var f;for(var g=0,h=Object.keys(c);g<h.length;g++){var i=h[g];if(e(c[i])){f=i;d=c[i];break}}if(!d){return{}}return{errorField:d,errorKey:f}}var g={status:"invalid",process:function(a){var e=f(a);if("errorField"in e){b.default.add("invalid.folder.error",e);return d.default.findOne(e.errorField.value).then(function(a){return c.default.waitFor("folderSecure",[a])})}}};a.default.attachBaseErrorHandler(g);exports.default=g;return g});define("RPC/statuses/token",["logger","RPC","utils/promise"],function(a,b,c){"use strict";var d;var e={status:"denied:token",process:function(e,f){if(!d){var g=function(){d=null;a.add("remove persistent promise")};d=(f||b).call("tokens",{},{force:true}).then(c.done(g),c.fail(g))}return d.then(c.done(function(c){var d=c.get("body.token");a.add("RPC.newToken",d);e.data.token=d;(f||b).setup("token",d)}))}};b.attachBaseErrorHandler(e);return e});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("AuthGateLoader",["require","exports","cfg","Emitter","logger"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=Promise.resolve(b.default.apply({show:function(){var b=this;var d=c.default.scope("service/authgate",{auth:a.default.auth});new Promise(function(a,b){require(["service/auth/account"],a,b)}).then(__importStar).then(function(a){var c=a.default;d.call(function(){return Promise.resolve(c.relogin()).then(function(a){d.add("email",{email:a});c.keepalive();b.emit("auth",a)})})})}}))});define("mail/Phone",["RPCModel"],function(a){"use strict";var b=a.extend({findUrl:"user",bindUrl:"user/phones/bind",saveUrl:"user/phones/edit",removeUrl:"user/phones/remove",enable2FactorUrl:"user/2-step-auth/enable",disable2FactorUrl:"user/2-step-auth/disable",defaults:{id:null,temporaryId:null,phone:"",visibility:"visible",country:"",mobile:true,status:"nonverified",noticeable:"",two_factor:false},prepareSendData:function(a,b){switch(a){case"add":b={phones:JSON.stringify([{id:b.id,phone:b.phone,visibility:b.visibility,mobile:b.mobile,status:b.status}])};break}return b},getFormattedNumber:function(){var a=/^(7|8)(9..|499|495|812)(...)(..)(..)$/,b=/\d{5}(\d{2})/,c=this.get("phone");if(a.test(c)){c=c.replace(a,"+$1 ($2) $3-**-**")}else{c=c.replace(b,"*****$1")}return c},parse:function(a,b){var c={};if(/user$/.test(b.url)){c=a.phones}else if(/user\/phones\/add/.test(b.url)){c={id:a[0]}}return c},_call2FactorsMethod:function(a,b,c,d){d=Object(d);return this.queue(function(e){var f=e.constructor.url(a);if(c){d.password=c}if(b){d.reg_token=b}return e.request.post(f,d)}.bind(this))},bind:function(a,b){var c={phone:{phone:this.get("phone"),visibility:this.get("visibility"),mobile:true}};return this._call2FactorsMethod("bind",a,b,c)}});b.filterPotentialSecondFactor=function(a){if(!(a instanceof b.List)){a=b.map(a)}var c=a.filter({status:"ok",two_factor:false});var d=a.filter({status:"too_young",two_factor:false});var e=a.filter({status:"in_remove_queue"});if(c.length){return c}if(d.length&&!e.length){return d}return new b.List};b.getPotentialSecondFactor=function(){return b.find().then(function(a){return b.filterPotentialSecondFactor(a)})};b.version="0.4.1";return b});define("mail/User/TOTPCode",["Model"],function(a){"use strict";var b=a.extend({defaults:{enabled:false,application:"",platform:""}});b.version="0.1.1";return b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/User",["require","exports","RPC","RPCModel","mail/Phone","mail/User/TOTPCode","utils/util"],function(require,exports,a,b,c,d,e){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=b.default.extend({className:"mail.User",loginUrl:"user/short",findUrl:"user",removeUrl:"user/remove",saveUrl:"user/edit",findBillsCountUrl:"user/paymentdata",editMetathreadsSettingsUrl:"golang/user/edit/metathreads",defaults:{signs:[],addressbook:{sort:{}},phones:null,notifications:{},security:{},messages:{},name:{},birthday:{},restore:{},totp:{enabled:false},agent:{visible:{},history:{}}},isNew:function(){return!this.is("common_purpose_flags")},isDataFully:function(){return this.is("phones")},getEmail:function(){return this.get("login")+"@"+this.get("domain")},getFullName:function(a){var b=a===void 0?{}:a,c=b.strict,d=c===void 0?false:c;var f=this.get("nick");if(f){return f}var g=this.get("name")||{},h=g.first,i=g.middle,j=g.last;if(h||i||j){return e.default.calculateFullName({first:h,middle:i,last:j})}if(!d){return this.getEmail()}},isTwoFactorEnable:function(){var a=(this.get("phones")||[]).some(function(a){return!!a.two_factor});if(!a){a=this.get("totp").enabled}return!!a},isPDD:function(){return this.get("account_type")==="pdd"},getMainPhone:function(){if(!this.isDataFully()){return null}var a=this.get("phones").find(function(a){return!!a.main_phone});return new c.default(a)},getTwoFactor:function(){var a;if(!this.isTwoFactorEnable()){return null}a=(this.get("phones")||[]).filter(function(a){return a.two_factor});if(a.length){return new c.default(a[0])}return f.TOTPCode.map(this.get("totp"))}});f.TOTPCode=d.default;f.login=function(){var a=this.url("login"),b=this.fn.request;return b.post(a).then(function(a){b.setup("token",a.get("body.token"));b.setup("email",a.get("email"));return a.map(f)})};f.findBillsCount=function(){return a.default.get(f.url("findBillsCount")).then(function(a){var b=a.body.unpaid_fines;var c=a.body.unpaid_bills;var d=(b||0)+(c||0);return{unpaidFines:b,unpaidBills:c,total:d}})};f.getMetathreadsSettingsFromVisibility=function(a){if(!Array.isArray(a)){return{}}var b={};a.forEach(function(a){var c=a.folder_id,d=a.state;b[c]=d});return b};f.METATHREADS_STATES={ON:0,HIDDEN:1,OFF:2};f.version="0.3.0";exports.default=f;return f});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/auth",["require","exports","AuthGateLoader","Emitter","mail/User","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e;var f;d.default.errorHandler.push({status:"denied:user",process:function(b){if(!f){f=new Promise(function(c){a.default.then(function(a){a.show();a.one("auth",function(a){f=null;b.data.email=a;c()})})})}return f}});exports.default=b.default.apply({version:"0.1.0",user:null,isAuth:function(){return!!this.user},setUser:function(a){this.user=c.default.map(a);this.trigger("login",this.user);return a},login:function(){e=e||this.loadUser().then(function(a){new Promise(function(a,b){require(["service/auth/account"],a,b)}).then(__importStar).then(function(a){var b=a.default;return b.keepalive()});return a});return e},loadUser:function(){var a=this;return c.default.login().then(function(b){a.setUser(b);return b}).catch(function(){return a.user})}})});define("service/radars/defaults",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={events:[],broadcast:true,prop:"radar-id"}});define("service/getModule",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;var a={};function b(b){if(!a[b]){a[b]=new Promise(function(a){window.require([b],a)})}return a[b]}});define("service/radars/ductus",["exports","@mail/features","logger","service/getModule"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function i(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var k="octavius";var l=1e3;var m=l*60;var n=m*60;var o=24*n;var p=function(){function a(){var b=this;i(this,a);this.handlePerformanceLogReady=this.handlePerformanceLogReady.bind(this);var c=null;this.ductusPromise=new Promise(function(a){c=a});(0,f.default)("ductus/ductus-octavius").then(function(a){b.ductusDispatch=a.standalone({project:k,config:{traffic:{timings:[{"1m":m},{"5m":5*m},{"10m":10*m},{"1h":n},{"1d":o},{"2d":2*o}]},performanceLog:{sessionStorage:d.default.has("perflog_session_storage"),chunkLength:parseInt((d.default.get("perflog_chunk_length")||{}).data,10),chunks:parseInt((d.default.get("perflog_chunks")||{}).data,10),onReady:b.handlePerformanceLogReady}}});c()})}j(a,[{key:"dispatch",value:function a(b){var c=this;try{if(typeof this.ductusDispatch!=="function"){this.ductusPromise.then(function(){c.dispatch(b)});return}this.ductusDispatch({type:b.type,payload:h({},b)})}catch(a){console.error(a);e.default.add(a)}}},{key:"loadPerformanceLog",value:function a(){try{if(this.ductusLoadPerformanceLog){return this.ductusLoadPerformanceLog()}}catch(a){console.error(a);e.default.add(a)}return{ductusError:"no performance log"}}},{key:"handlePerformanceLogReady",value:function a(b){this.ductusLoadPerformanceLog=b}}]);return a}();exports.default=p});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/radars/index",["require","exports","@mail/radars-decorator","@mail/xray","mail/Folder","service/auth","service/radars/defaults","service/radars/ductus"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createConfiguredRadar=exports.radarService=void 0;a=__importStar(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g=/:/g;var h="_";function i(a){return a.replace(g,h)}function j(a){return i(a.filter(function(a){return a}).join(h))}function k(a,b){var c;if(Array.isArray(a)){c=j(a);return{chain:c.split(h),type:c,value:b}}if(typeof a==="object"){if(Array.isArray(a.chain)){c=j(a.chain)}else{c=i(a.type)}return __assign(__assign({},a),{chain:c.split(h),type:c})}c=i(String(a));return{chain:c.split(h),type:c,value:b}}var l=function(){function g(){var b=this;this.send=this.send.bind(this);this.ductus=new f.default;this.RadarDecorator=a.default;a.default.addAdapter(a.FeastAdapter);a.default.defaults=e.default;a.default.register(function(a,c){b.send(k(c))})}g.prototype.init=function(a){this.layout=a};g.prototype.sendLoadInfo=function(a,b){this.send("hit");this.send({type:"send_timings",data:{loadTime:a,timers:b}});var c=d.default.user.get("parental_control_mode");if(c&&c!=="off"){this.send({type:"hit_pcm",intervals:[[c,1]]})}};g.prototype.sendArchiveFoldersInfo=function(){var a=c.default.all;a===null||a===void 0?void 0:a.forEach(function(a){if(a.isArchive()&&!a.isSystem()){b.default.send("user-have-archive-folder",{dwh:{id:a.id}})}})};g.prototype.send=function(a,b,e){if(b===void 0){b=1}var f=k(a,b);f.value=f.value==null?1:f.value;f.meta=f.meta&&typeof f.meta==="object"?f.meta:{};if(this.layout){f.meta.layoutSize=this.layout.size;f.meta.layoutType=this.layout.getType()==="2pane"?"2":"3";f.meta.layoutSettingsType=this.layout.getUiLayout().type==="2pane"?"2":"3"}var g=d.default.user;f.meta.email=g&&g.getEmail();f.meta.themeId=g&&g.get("theme");f.meta.folders=c.default.all;if(e){f.data={};Object.keys(e).forEach(function(a){f.data[a]=e[a]})}this.ductus.dispatch(f)};g.prototype.loadPerformanceLog=function(){return this.ductus.loadPerformanceLog()};return g}();exports.radarService=new l;function m(a){var b=a.prefix,c=a.radar,d=c===void 0?exports.radarService.send:c,e=a.data,f=e===void 0?null:e;var g=b!==undefined;return function a(c,e){if(!g&&!f){return d(c,e)}if(Array.isArray(c)){c=__spreadArrays([b],c);return d({chain:c,data:f},e)}if(typeof c==="object"){var h=c.chain||c.type.split("_");return d(__assign(__assign({},c),{chain:__spreadArrays([b],h),data:f}))}return d({type:b+"_"+c,data:f},e)}}exports.createConfiguredRadar=m;exports.default=exports.radarService.send});define("polyfills/closest/closest",[],function(){"use strict";if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector}if(!Element.prototype.closest){Element.prototype.closest=function a(b){var c=this;if(!document.documentElement.contains(c)){return null}do{if(c.matches(b)){return c}c=c.parentElement||c.parentNode}while(c!==null&&c.nodeType===1);return null}}});define("polyfills/contains-node/contains-node",[],function(){"use strict";if(!Selection.prototype.containsNode||/Edg/.test(navigator.userAgent)){Selection.prototype.containsNode=function a(b){var c=document.getSelection();if(c.isCollapsed){return false}var d=c.anchorNode;var e=c.focusNode;if(d.nodeType===Node.TEXT_NODE&&d===b){return true}if(d.nodeType===Node.ELEMENT_NODE&&d.contains(b)){return true}if(e.nodeType===Node.TEXT_NODE&&e===b){return true}if(e.nodeType===Node.ELEMENT_NODE&&e.contains(b)){return true}var f=c.getRangeAt(0);var g=document.createRange();g.selectNode(b);var h=f.compareBoundaryPoints(Range.END_TO_END,g)!==-1;var i=f.compareBoundaryPoints(Range.START_TO_START,g)!==1;if(h&&i){return true}return false}}});define("polyfills/index",["./closest/closest","./contains-node/contains-node"],function(){"use strict"});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/shortcut",["require","exports","feast"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"+":107,"[":219,"]":221,"\\":220,"|":220,"?":191,"&":55};var c={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91,cmd:91};var d={Up:"↑",Down:"↓",Left:"←",Right:"→"};var e=/Up|Down|Left|Right/;function f(a){return b[a]||a.toUpperCase().charCodeAt(0)}function g(a){var b,d,e,g,h,i,j,k,l;var m=[];b=a.replace(/\s/g,"");if(!b){return m}var n=b.split("',");for(h=0;h<n.length;h++){l="";d=n[h].split(":");if(d[d.length-1]==""){d[d.length-2]+=":";d.pop()}if(d.length==2){d[1]=d[1].replace(/'/g,"");if(d[1]&&d[1]!="true"){l=d[1]}}d=d[0];d=d.split("|");if(d[d.length-1]==""){d[d.length-2]+="|";d.pop()}for(i=0;i<d.length;i++){b=d[i];e=b.split(",");if(e[e.length-1]==""){e[e.length-2]+=",";e.pop()}k={shortcut:b};b=e[0].split("+");if(b[b.length-1]==""){b[b.length-2]+="+";b.pop()}g=[];if(b.length>1){g=b.slice(0,b.length-1);for(j=0;j<g.length;j++){g[j]=c[g[j]]}b=[b[b.length-1]]}b=b[0];k.code=f(b);k.mods=g;if(e.length==2){k.sequence=f(e[1])}if(l){k.uiname=l}m.push(k)}}return m}function h(a){var b=a.target||a.srcElement,c=b.tagName;return!(c=="INPUT"||c=="SELECT"||c=="TEXTAREA"||b.isContentEditable)}function i(a,b){for(var c=0;c<b.length;c++){if(b[c]==a){return true}}return false}var j=function(){function f(){this.el=document;this._handlers={};this.service=true;this._collection=this.el.getElementsByClassName("js-shortcut");this._stopSequence=this._stopSequence.bind(this);this._keydownHandler=this._keydownHandler.bind(this);document.addEventListener("keydown",this._keydownHandler)}f.prototype._keydownHandler=function(a){var c=window.key;if(!h(a)||a.isDefaultPrevented()||a.keyCode==b["esc"]&&(!c||c.getScope()!="all")){return}var d=a.keyCode;var e=this._collection;var f=this._getPressedModes(a);var g,i=0,j;for(i;i<e.length;i++){g=e[i];j=this._compareKey(d,this.getShortcuts(g),f);if(j){a.preventDefault();if(j.sequence&&!this._isSequence()){this._startSequence(d);break}else{if(this._doAction(g,j)){if(typeof Event==="function"){var k=new Event("ui-abstract-action");g.dispatchEvent(k)}else{var k=document.createEvent("CustomEvent");k.initCustomEvent("ui-abstract-action",false,false,undefined);g.dispatchEvent(k)}break}}}}};f.prototype.getShortcuts=function(a){var b=this.getShortcutAttribute(a);var c=this._handlers;if(!c[b]){c[b]=g(b)}return c[b]};f.prototype._getPressedModes=function(a){var b=[];if(a.shiftKey){b.push(c["shift"])}if(a.altKey){b.push(c["alt"])}if(a.ctrlKey){b.push(c["ctrl"])}if(a.metaKey){b.push(c["cmd"])}return b};f.prototype._compareKey=function(a,b,c){var d=false,e,f,g,h;for(f=0;f<b.length;f++){e=b[f];if(this._isSequence()){d=a==e.sequence}else if(a==e.code){d=true;h=e.mods;for(g=0;g<h.length;g++){if(!i(h[g],c)){d=false;break}}if(c.length>h.length){d=false}}if(d){d=e;break}}return d};f.prototype._startSequence=function(a){if(!this._isSequence()){this._sequenceCode=a;this._sequence=setTimeout(this._stopSequence,1e3)}};f.prototype._stopSequence=function(){clearTimeout(this._sequence);this._sequence=-1;this._sequenceCode=-1};f.prototype._isSequence=function(){return this._sequence>0};f.prototype.getShortcutAttribute=function(b){var c=a.default.Block.get(b);var d=c?c.get("shortcut"):b.getAttribute("data-shortcut");return d||""};f.prototype.getShortcutItems=function(){return this._collection};f.getShortcutTitle=function(a,b){if(b===void 0){b=false}if(!a){return""}if(b===undefined){b=!!navigator.userAgent.match(/\bMac\b/)}a=a.replace(/\s/g,"").replace(/command/g,"cmd");if(a!="|"&&a.includes("|")){if(b&&a.includes("cmd")){a=a.split("|");for(var c=0;c<a.length;c++){if(a[c].includes("cmd")){a=a[c];break}}}else{a=a.split("|")[0]}}if(a.includes(":'true'")){a=a.split(":'true'")[0];a=a.split("',");a=a[a.length-1]}if(a.includes(":'")){return""}return f.formatShortcutHint(a)};f.formatShortcutHint=function(a){var b="";var c=[];if(a){if(a!=","&&a.includes(",")){c=a.split(",");b=c.map(f.formatShortcutHint).join(", ")}else{c=a.split("+");b=c.map(function(a){return a.slice(0,1).toUpperCase()+a.slice(1).toLowerCase()}).join("+")}}if(b.match(e)){for(var g in d){b=b.replace(g,d[g])}}return b};return f}();exports.default=j});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mixins/shortcut-title",["require","exports","feast","helpers/browser","service/shortcut"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.onlyMixin=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.onlyMixin="shortcut-title";a.default.tags.$mixins[exports.onlyMixin]=function(a,d){if(b.default.mac&&d["shortcut-mac"]){d.shortcut=d["shortcut-mac"]}var e=d.shortcut||d["dropdown-shortcut"];if(e){var f=c.default.getShortcutTitle(e);if(f){d["title-shortcut"]=""+f}}}});define("setup",["exports","@mail/features","Action","cfg","feast","helpers/querystring","mail/Folder","mail/MessageFormData/Transport","request","RPC","RPC/statuses/processing","RPC/statuses/sdc","RPC/statuses/secure_folder","RPC/statuses/token","service/radars/index","./polyfills/index","setimmediate","mixins/shortcut-title","feast-extension/qa","feast-extension/a11y","feast-extension/promo"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RPC=undefined;var o=C(a);var p=C(b);var q=C(c);var r=C(d);var s=C(e);var t=C(f);var u=C(g);var v=C(h);var w=C(i);var x=C(j);var y=C(k);var z=C(l);var A=C(m);var B=C(n);function C(a){return a&&a.__esModule?a:{default:a}}var D=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();o.default.setFeaturesToSalt(["adv-list-default-config"]);o.default.import(q.default.get("sotaFeatures")||{},a.Source.Onlineconf);o.default.importFromString(q.default.get("sotaMigrationConfigFeatures")||"",a.Source.Slot);o.default.import(q.default&&q.default.omicron&&q.default.omicron.Config,a.Source.Omicron);if(q.default.get("isFtrsConfigurable")){var E=window.location.search.match(/[?&]ftrs=([^&]*)/);if(E){try{var F=window.decodeURIComponent(E[1]);o.default.importFromString(F,a.Source.GetParam)}catch(a){console.log(a)}}}var G=(0,s.default)(location.href);var H=/Array|Object/;var I=new u.default;v.default.setup({safeMode:true});w.default.setup({safeMode:true,email:G["x-email"],timeout:0,baseUrl:"/api/",sdcUrl:q.default.get("urls.authUrl")+"/sdc",errorHandlers:[y.default,A.default,x.default,z.default]});w.default.serialize=function(a){for(var b in a){if(a.hasOwnProperty(b)){var c=a[b];if(H.test(a.toString.call(c))){a[b]=JSON.stringify(c)}}}return a};var J=w.default.Request.prototype.end;w.default.Request.prototype.end=function a(b,c){if(Array.isArray(c)&&c[0]==="AjaxResponse"){c={status:c[1]==="OK"?"200":"400",body:c[2]};var d=void 0;for(var e=0;e<c.body.list.length;e++){d=c.body.list[e];if(!Array.isArray(d.n)){continue}d.id=[d.id].concat(d.n).join(";")}}if(!o.default.has("disable-uploader-replace")&&this.url.includes(I.getUrl("createCloudAttachment"))){var f=c,g=f.body;var h=g.loader_url;if(h&&/octavius/.test(location.host)){g.loader_url=h.replace(/\.e\./,".octavius.")}if(h&&/vk/.test(location.host)){g.loader_url=h.replace(/\.e\./,".vk.")}}return J.call(this,b,c)};if(typeof coreKeeper!=="undefined"){w.default.request.on("end",function(a,b){window.coreKeeper.api(b,{log5XX:o.default.has("log_5xx")})})}w.default.url=function(a){var b={};var c=o.default.getAsTypedArray("rpc-url",o.default.String,[],",");if(c){c.forEach(function(a){a=a.split(":");b[a[0]]=a[1]})}return function c(d,e){var f=d.split("?",2),g=D(f,2),h=g[0],i=g[1];var j=d;if(typeof b[h]==="string"){j=b[h]+(i===undefined?"":"?"+i)}return a.call(this,j,e)}}(w.default.url);p.default.on("folderSecure",function(){return Promise.reject()});p.default.on("complete",function(){return t.default.prototype.storage.clear()});var K=o.default.getAsInt("folder-max-level",0);if(K!==0){t.default.MAX_CHILD_LEVEL=K-1}r.default.PerformanceTrace.on("data",function(a){(0,B.default)({type:"feast_performance_trace",data:a.entries});a.clear()});exports.RPC=w.default;exports.default={}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("default-values",["require","exports","@mail/features","cfg","cfgUser","helpers/browser","temporary/force-3pane-exp","setup"],function(require,exports,a,b,c,d,e){"use strict";var f;var g,h,i;Object.defineProperty(exports,"__esModule",{value:true});exports.CUSTOM_THEMES_PREVIEWS_PATHS=exports.SEARCH_PANEL_SIZE=exports.NEW_TOOLBAR=exports.SEARCH_PANEL_PORTAL=exports.SEARCH_PANEL_REACT=exports.ENABLE_HIDE_TRANSLATOR=exports.SHOW_PROMO_PUSH_PLATE=exports.FAKE_CREATE_TODO=exports.WIDGET_ICONS_VARIANT=exports.HIDE_RECEIPTS_METATHREAD=exports.SMART_CARD_ICS=exports.B2B_INNER_ATTACHMENTS_NOTIFY=exports.ENABLE_MENTIONS=exports.GO_TO_ACTION_BUTTOM=exports.BACK_TO_PARENT_AT_EMPTY_LETTERS=exports.DESELECT_ALL_LABEL_STYLE=exports.PORTAL_MENU_CLEAR_METATHREAD=exports.PORTAL_MENU_MORE_FOLDER_ACTIONS=exports.BACK_TO_PARENT_SHORTCUT=exports.BACK_TO_PARENT_AT_LETTERS=exports.BACK_TO_PARENT_AT_LOGO=exports.BACK_TO_PARENT_POS=exports.METATHREAD_BACK_TO_INBOX=exports.SEARCH_SUGGESTS_DELAY_TIME=exports.SEARCH_SUGGESTS_DELAY=exports.FOLDERS_SORT_VARIATION=exports.HIDE_EMOJI_IN_SNIPPET=exports.HIDE_EMOJI_IN_CORRESPONDENT=exports.HIDE_EMOJI_IN_SUBJECT=exports.METATHREAD_REDIRECT=exports.VIEW_URL_IDS_VALIDATE_DISABLE=exports.MESSAGES_ID_REG_EXP=exports.ATTACHES_ID_REG_EXPS=exports.SHOW_CATEGORY_FEEDBACK_PLATE=exports.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED=exports.R7_EXTENSIONS_FORMATS=exports.R7_VIEW_ENABLED=exports.UNSUBSCRIBE_IN_MORE_DROPDOWN=exports.UNSUBSCRIBE_INSTEAD_SPAM=exports.SEARCH_CATEGORIES=exports.USE_NEW_SEARCH_CATEGORY_FORMAT=exports.ENABLE_OFFICIAL_LETTERS=exports.CKE_QUOTE_PARSE_FIX_DISABLE=exports.HIDE_GAMES_METATHREAD=exports.HIDE_SCHOOL_METATHREAD=exports.HIDE_OFFICIAL_METATHREAD=exports.ENABLE_LIST_LETTER_ACTION_BUTTONS=exports.ATTACH_ANALYTICS_EXT_DISABLED=exports.THREAD_SWITCH_RACE_FIX=exports.HIDE_DISABLE_TO_MYSELF_METATHREAD=exports.HIDE_WEBVIEW_TITLE=exports.USE_WEBPACK_BUILD=exports.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH=exports.HIDE_MESSAGE_SMART_REPLY=exports.HIDE_MESSAGE_FOOTER=exports.CSAT_REPEAT_INTERVAL=exports.CSAT_DOMAIN=exports.CSAT_DRY_RUN=exports.CSAT_DAILY_PERMILLE=exports.CSAT_POLL_ID=exports.CSAT_DISABLED=exports.AUTOMATED_SHOW_TRANSLATOR=exports.DISABLE_AUTOMATED_TRANSLATE=exports.DARK_MODE_ROLLBACK_ON_COPY=exports.DISABLE_GREEN_OFFICIAL_ON_LETTER_LIST=exports.SHOW_OFFICIAL_ON_LETTER_LIST=exports.SHOW_OFFICIAL_SENDER_PROMO=exports.DISABLE_GREEN_RELIABLE_ON_LETTER_LIST=exports.SHOW_RELIABLE_ON_LETTER_LIST=exports.SHOW_RELIABLE_SENDER_PROMO=exports.COMPOSE_FETCH_AUTOREPLY=exports.ADDRESSBOOK_ICO=exports.MOBILE_ADDRESSBOOK_URL=exports.DISABLE_COMPOSE_ATTACHMENT_CLICK=exports.HIDE_CHANGE_SIGNATURE=exports.HIDE_SETTINGS_BUTTON=exports.HIDE_CONTEXTMENU_SEARCH_BUTTON=exports.HIDE_CONTEXTMENU_ADD_CONTACT_BUTTON=exports.COMPOSE_SHORT_ATTACH_PANEL=exports.COMPOSE_DISABLE_TOOLBAR=exports.COMPOSE_DISABLE_CLICKABLE_LABELS=exports.COMPOSE_HIDE_AVATAR=exports.COMPOSE_FOOTER_DROPDOWN=exports.HIDE_COMPOSE_WIDGETS=exports.HIDE_COMPOSE_CANCEL_BUTTON=exports.HIDE_NOTIFY_CLOSE_BUTTON=exports.DISABLE_DROPDOWN_ACTIONS_SHORTCUTS=exports.XXS_BREAKPOINT=exports.ENABLE_XXS_BREAKPOINT=exports.DISABLE_LEFT_COLUMN=exports.LASTSEEN_COMPOSE_ALLOW_GARAGE=exports.LASTSEEN_SHOW_TIME_STATUS=exports.LASTSEEN_ONLINE_STATUS=exports.LASTSEEN_DISABLE_PLATFORM=exports.LETTER_LASTSEEN_REQUEST=exports.LAST_SEEN_V2_ENABLE=exports.POLLING_ONLY_VISIBLE=exports.PROMT_LOGO_HREF=exports.PARENTAL_CONTROL_APPROVE_FOLDER_ID=exports.PARENTAL_CONTROL_DENY_FOLDER_ID=exports.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID=exports.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS=exports.FORBID_EXCLUDED_FOLDERS_SEARCH=exports.FORBID_SPAM=exports.FORBID_FILTERS=exports.DISABLE_DELETE_FROM_TRASH=exports.TRASH_FOLDER_ID=exports.FORCE_PARENTAL_CONTROL_DIE=exports.ENABLE_MULTIPLE_FILTERS=exports.ENABLE_SORTING=exports.NOADS_BUTTON_SHOW_EXP=exports.NOADS_BUTTON_SHOW_FORCE=exports.DISABLE_ATTACHES_OPENING=exports.DEFAULT_AVATAR_SRC=exports.COMPOSE_TEMPLATES_URL=exports.COMPOSE_TEMPLATES_SUBJECTS=exports.COMPOSE_ALLOWED_TEMPLATES=exports.DISABLE_LETTER_HEADERS_BUTTON=exports.SHORTCUT_LEFT_COLUMN_LIMIT=exports.SHOW_RELOAD_BUTTON=exports.DISABLE_MARUSIA_IN_PORTAL=exports.URL_EXTRA_PARAMS=exports.HIDE_HEADLINE=exports.USE_SINGLE_TAB_BLACKLIST_REGEXP=exports.USE_SINGLE_TAB_WHITELIST_REGEXP=exports.USE_SINGLE_TAB=exports.HIDE_LOGO=exports.METATHREAD_MOVE_TO_SPAN_NOTIFY_DURATION=exports.METATHREAD_MOVE_TO_SPAN_NOTIFY=exports.RESTORE_EXPIRED_ATTACHMENTS_TIME=exports.RESTORE_EXPIRED_ATTACHMENTS=exports.COMPOSE_EMOJI_FILTER=exports.QUOTA_SPACE_URL=exports.QUOTA_AD_URL=exports.QUOTA_GROUP=exports.USE_X_CALENDAR=exports.RENDER_COMPOSE_TO_BODY_START=exports.SHOW_UNSUBSCRIBE_AFTER_MOVE_TO_SPAM=exports.SHOW_UNSUBSCRIBE_AFTER_SPAM=exports.EMOJI_FALLBACK=exports.COMPOSE_EMOJI_RECENTLY_COUNT=exports.COMPOSE_EMOJI=exports.MESSAGES_ATTACHES_BLOBCLOUD_PATH=exports.MESSAGES_ATTACHES_BLOBCLOUD=exports.CLEANMASTER_MODAL_ACTIONS_DISABLED=exports.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED=exports.MARUSIA_READ_ALL_LETTERS=exports.CKE_CLIPBOARD_FIX=exports.RESIZER_DRAG_ICON_SHOWN=exports.LAZY_SMOKE_SCREEN_INIT=exports.PRELOAD_RELEASE_BUNDLES_FILTER=exports.CONTRAST_LOGO_THEMES=exports.SWBOX_TOKEN_UPDATE_INTERVAL=exports.EXPIRED_ATTACHES_TOOLTIP=exports.LIST_ADVERT_ANIMATION=exports.RADAR_PROJECT=exports.DND_IMAGES_PATH=exports.DND_CLOUD_FOLDER_CHOICE=exports.THEME_SOUZMULTFILM_MARUSIA=exports.DISABLE_DOMAIN_AUTHCHECK=exports.VK_DOMAIN=exports.VK_THEMES_LIST=exports.USE_CUSTOM_THEME_PREVIEW_NAME=exports.THEME_PREFIX=exports.OCTAVIUS_PLACEHOLDERS_PATH=exports.IS_VK_HOST=exports.VK=exports.SENT_PAGE_NOTIFY=exports.ATTACH_WARNING_TOOLTIP=exports.EXPIRED_ATTACHES_DIE=exports.VK_MESSENGER_APP_ID=exports.VK_CONNECT_DOMAIN=exports.VK_OAUTH_DOMAIN=exports.VK_LOGIN_DOMAIN=exports.SWA_SUPERAPP_SILENT_URL=exports.VK_MESSENGER_LOGOUT=exports.VK_MESSENGER_SHOW_AUTH_NOTIFY=exports.VK_MESSENGER_DISABLE_SILENT_AUTH=exports.VK_MESSENGER_AUTH_THROTTLE=exports.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY=exports.VK_MESSENGER_RESTORE_ON_REFRESH_DISABLED=exports.VK_MESSENGER_CHAT_HREF_BASE=exports.VK_MESSENGER_CHAT_ID_BY_EMAIL=exports.VK_MESSENGER_EXTERNAL=exports.VK_MESSENGER_CHECK_VK_AUTH=exports.DISABLE_VK_MESSENGER=exports.SWBOX_ANALYTICS_REQUEST=exports.ADVERT_FEEDBACK_TEXTS=exports.ADVERT_FEEDBACK_CONFIG2=exports.ADVERT_FEEDBACK=exports.NOTIFY_CLOSE_DELAY=exports.MONETA_PAYMENT_LETTER_URL_REGEXP=exports.LETTER_CONTENT_ADV_ENABLE=exports.WEBPUSH_METRIC_DISABLE=exports.HEADLESS_COUNTER=exports.CLOUD_VIEWER_HOST=exports.CLOUD_VIEWER_TEMPORARY=exports.CLOUD_VIEWER_ATTACH_TYPES=exports.CLOUD_VIEWER_FILE_TYPES=exports.CLOUD_VIEWER_FORCE=exports.CLOUD_VIEWER_GROUP=exports.CLOUD_VIEWER_GROUPS=exports.FLAGS_AUTOSYNC_DEBOUNCE=exports.FLAGS_AUTOSYNC=exports.CANCELLATION_RESERVE_TIME=exports.SETTINGS_DOCK_CLEANMASTER_USE_UNSUBSCRIBE_TITLE=exports.SETTINGS_DOCK_PULSE_INLINE_DISABLED=exports.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION=exports.SETTINGS_DOCK_CLEANMASTER_INLINE_DISABLED=exports.SETTINGS_DOCK_HIDE_CLEANMAILBOX=exports.SETTINGS_DOCK_START_FULL_SCREEN=exports.SETTINGS_DOCK_DISABLE_AUTO_EXPAND=exports.SETTINGS_DOCK_DISABLE_EXPAND_BUTTON=exports.SETTINGS_DOCK_30_50_MODE=exports.AMP_SENDER_METRICS=exports.DELAY_NO_DISCOUNTS_BLOCK=exports.DELAY_FOR_NEW_DISCOUNT=exports.PROMO_DISCOUNTS_COLORS=exports.SWBOX_LOG_SILENT_ERRORS=exports.SWBOX=exports.NEW_LETTER_LIST_3PANE=exports.NEW_LETTER_LIST=exports.FORCE_DISABLE_NEW_LETTER_LIST=exports.THREAD_WITH_RELIABLE_MARK=exports.NEW_THREAD=exports.FORCE_DISABLE_NEW_THREAD=exports.NTFR_EXP_BACKOFF=exports.NTFR_RECONNECT_ON_FOCUS=exports.NTFR_INTERVALS=exports.WIDGET_PAYMENT_URL=exports.WIDGET_CALLS_URL=exports.WIDGET_TODO_URL=exports.WIDGET_X_CALENDAR_URL=exports.WIDGET_CALENDAR_URL=exports.WIDGET_ADDRESSBOOK_URL=exports.WIDGET_CLOUD_URL=exports.MARUSIA_SKILLSERVER_TEST=exports.MARUSIA_READ_LETTER=exports.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT=exports.LL_UNSUBSCRIBE_NEWSLETTERS_SENDERS_LIMIT=exports.DISCOUNT_DESCRIPTION_FROM_SUBJECT=exports.ADV_NO_ADS_POSTMSG_URL=exports.ADV_NO_ADS_PROMO_URL=exports.ADV_OFF_MONTH_GROUP=exports.ADV_OFF_QUERY_GROUP=exports.ADV_OFF_CONTROL_GROUP=exports.ADV_OFF_NOTIFY_GROUP=exports.ADV_OFF_CLOUD_GROUP=exports.ADV_EXP_ID_SEND=exports.ADV_TARIFF_FEATURE=exports.ADV_DIRECT_READY_TIMEOUT=exports.ADV_EXP_ID=exports.SHOW_DEFINITELY_SPAM=exports.LOG_DATASOURCE_PROBLEMS=exports.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS=exports.FORCE_SHOW_PRIORITY_MESSAGES_READ_LETTER=exports.FORCE_SHOW_PRIORITY_MESSAGES_LIST_LETTERS=exports.ACTUAL_LETTERS_DEFAULT_NEWSLETTERS=exports.ACTUAL_LETTERS_DEFAULT_INBOX=exports.HAS_PRIORITY_MESSAGES=exports.CLOUD_TARIFFS_IFRAME_URL=exports.OVERSIZE_CLOUD_ATTACHES_MOCK_CLOUD=exports.OVERSIZE_CLOUD_ATTACHES_FOLDER=exports.OVERSIZE_CLOUD_ATTACHES=exports.ACTUAL_REASON_FEEDBACK=exports.CHANGE_EXPIRED_PASSWORD_URL=exports.COMPOSE_USER_LOADING_DISABLED=exports.DELAY_FOR_CANCELLATION=exports.COMPOSE_INIT_ADDRESSBOOK=exports.MIN_LETTER_HEIGHT_STICKY=exports.METATHREADS_SETTINGS_ORDER=exports.HIDE_NEWS_METATHREAD=exports.AUTOSAVE_DRAFT_TIMEOUT_SECONDS=exports.CALL_TITLE_BLINK_INTERVAL=exports.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION=exports.OK_RELOAD_SHADOW=exports.TWO_STEP_ENABLE_URL=exports.LL_UNSUBSCRIBE_NEWSLETTERS_TIMEOUT=exports.LL_UNSUBSCRIBE_NEWSLETTERS_INTERVAL=exports.LL_UNSUBSCRIBE_NEWSLETTERS=exports.PAYMENT_LETTER_UNIVERSAL=exports.DISCOUNTS_MOUSE_SCROLL=exports.PROMO_LOGO_MIN_WIDTH=exports.RESIZE_UPDATE_DEBOUNCE_TIME=exports.OK_RELOAD=exports.OK_RELOAD_TIMEOUT=exports.RELOAD_TIMEOUT=exports.IS_RESEND_DROPDOWN_DISABLED=exports.CSS_VARS_FALLBACK=exports.P2P_PROMO_SHOWN_RECENTLY=exports.DISCOUNTS_BLOCK_LIMIT=exports.DISCOUNTS_FLAG_NAME=exports.DISCOUNTS_BLOCK_DEFAULT=exports.DISCOUNTS_BLOCK=exports.USER_LAYOUT_ENABLE_METRICS=exports.USER_LAYOUT_SAVE_TO_STORAGE=exports.USER_LAYOUT_RESIZE_3PANE=exports.USER_LAYOUT_RESIZE=exports.WHITE_PORTAL_THEME=exports.WHITE_PORTAL_HAS_FLAG=exports.WHITE_PORTAL_AVAILABLE=exports.WHITE_PORTAL_NEWREG=exports.WHITE_PORTAL_FORCED=exports.SKIP_DWH=exports.ENABLE_ACTION_OVER_SELECTED=exports.FORGOT_PASSWORD_URL=exports.VISIBILITY_WATCHER_CONFIG=exports.NO_CSS_GRID_LOG_KAKTAM=exports.LAYER_METATHREAD_DISABLE=exports.SETTINGS_DROPDOWN_HIDE_SETTINGS=exports.SETTINGS_DROPDOWN_HIDE_CLEANMASTER=exports.SETTINGS_DROPDOWN_HIDE_NOTIFICATIONS=exports.FILTER_SETTINGS_DEFAULT_TEXT_VAR=exports.PORTAL_MENU_HEIGHT=exports.HEADLINE_HEIGHT=exports.LAST_SEEN_OMICRON=exports.LAST_SEEN_ENABLE=exports.MARUSIA_URL=exports.MARUSIA_LOGO=exports.SELECT_GEO_URL=exports.WEATHER_URL=exports.WELCOME_BLOCK_SNOOZE_INTERVAL=exports.WELCOME_BLOCK_SHOW_INTERVAL=exports.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT=exports.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL=exports.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD=exports.WELCOME_BLOCK_DISABLED=exports.DARK_MODE_BACKGROUND_ASYNC=exports.KASPERSKY_ENG_LOGO_LANGS=exports.MAX_CLOUD_STOCK_SIZE_LIMIT=exports.DARK_MODE_SNEAKY=exports.DARK_MODE_FRAME_BUDGET=exports.DARK_MODE_ASYNC_THRESHOLD=exports.DARK_MODE_ASYNC=exports.DARK_MODE_MEDIA_QUERY=exports.DARK_MODE_BASE_COLOR=exports.CALLS_P2P_OUTGOING=exports.CALLS_BASE_URL=exports.CALLS_P2P=exports.OAUTH_CLIENT_ID=exports.CLOUD_LOAD_DIRECTORY=exports.CLOUD_HOME_URL=exports.CLOUD_OPEN_API_URL=exports.DND_NOTIFY_DURATION=exports.DND_CLOUD_SHARE=exports.DND_CLOUD_ENABLED=exports.DND_CLOUD_FILES_LIMIT=exports.LAYER_CONFIRM_FOLDER_CLEAR=exports.RENOVATOR_DISABLED=exports.SIDEBAR_MENU_LIST_CONFIG=exports.CKE_ATTACH_BASE64=exports.LAYER_UNSAFE_ATTACH=exports.DATES_METADATA=exports.BILLS_COUNTER_MAX=exports.BILLS_COUNTER_UPDATE_INTERVAL=exports.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART=exports.LETTER_PREVIEW_RADAR=exports.LETTER_PREVIEWS_CONFIG=exports.LETTER_PREVIEWS=exports.MATCH_MEDIA_LOG=exports.COMPOSE_SLIDER_LAST_STEP_DELTA=exports.WORD_BREAK_IN_TOOLTIP=exports.FEED_SUBSCRIPTIONS_IFRAME_URL_SETTINGS=exports.FEED_SUBSCRIPTIONS_IFRAME_URL=exports.FEED_SUBSCRIPTIONS_INFORMER=exports.FEED_SUBSCRIPTIONS=exports.SEARCH_SIDEBARS_SWAP=exports.ADV_SEARCH_SEND_QUERY=exports.ADV_SEARCH_EXP_ID=exports.SUGGEST_SEARCH_INTERNET_URL=exports.SUGGEST_SEARCH_INTERNET=exports.NAV_MY_FOLDERS_CONTAINER_ID=exports.SETTINGS_AUTOREPLY_LINK=exports.MESSAGE_SUGGESTS=exports.LETTER_DATA_WHITE_LIST=exports.PHISHING_ALERT=exports.FOLDER_MAX_CHILD_LEVEL_UI=exports.THEMES_WIDGET_CLOUDY_ENABLED=exports.PROMO_DOMAIN_CROSS_ENABLED=exports.PROMO_DOMAIN_HEADER=exports.SHOW_TODO_TOGGLE=exports.SIDEBAR_PAY_NOTIFICATION_BADGE=exports.ADV_SPECLINE_ENABLED=exports.ADV_SPECLINE_SLOTS=exports.DOMPURIFY=exports.THEMES_AVAILABLE=exports.FORCE_METATHREADS_EXP=exports.FORCE_METATHREADS_LETTER=exports.FORCE_METATHREADS=exports.METATHREADS_FORCED_EXP=exports.METATHREAD_TOMYSELF_SNIPPET_ITEMS_MAX_COUNT=exports.TODO_URL=exports.KASPERSKY=exports.MIMIC_IGNORE_HAS_WLIST=exports.NO_MIMIC_ON_ADBLOCK=exports.NO_MIMIC_ON_WLIST=exports.ADVERT_CPM_VALUES=exports.ADVERT_CPM_EXP=exports.ADVERT_CPM_RELOAD_CONF=exports.ADVERT_CPM_RELOAD=exports.ADVERT_SCROLL_CONF=exports.ADVERT_SCROLL=exports.IS_CHROME=exports.SUGGEST_FROM=exports.SMART_THREAD_FETCHING=exports.ARCHIVE_DISABLED=exports.OCTAVIUS_PREFETCH=exports.DEBUG_SERVER_TIMESTAMP=exports.DISABLE_TIME_CORRECTION=exports.IGNORE_LOCAL_TIME=exports.LETTER_FROM_FUTURE_LOG_KAKTAM=exports.LETTER_FROM_FUTURE_LOG_DATES=exports.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP=exports.MAX_ATTACHES_SIZE_LIMIT=exports.PACKAGES_URL=exports.USER_LANG=exports.SUPPORT_WIDGET_THEME_IDS=exports.WIDGETS_SHOW_LIMIT_MAP=exports.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS=exports.SETTINGS_DROPDOWN_HIDE_TO_MYSELF=exports.SUPPORTED_CUSTOM_METATHREADS=exports.SIGNATURE_URL=exports.SETTINGS_URL=exports.NOTIFICATIONS_URL=exports.CLEANMASTER_URL=exports.HELP_PAGINATOR=exports.HELP_TO_MYSELF=exports.HELP_METATHREADS=exports.HELP_THREADS=exports.HELP_3PANE=exports.HELP_URL=exports.IS_READLETTER_NATIVE_STICKY_DISABLED=exports.SERVER_TIME=exports.BUILD=exports.PREFETCH_CORRESPONDENTS_DISABLE=exports.ADMAN_SEND_HAS_VK=exports.ADMAN_SEND_SYNC_IDS=exports.ADMAN_REINIT_ON_DETECT=exports.ADMAN_REINIT_ON_DIRECT_LOAD_ERROR=exports.ADMAN_USE_MIMIC_ON_DIRECT_LOAD_ERROR=exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK_FOR_BLOCKER=exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK=exports.EXTRA_SUGGEST_SEARCH=exports.COMPOSE_SEND_USER_TRACK_CONF=exports.COMPOSE_SEND_USER_TRACK=exports.FORCE_EXPANDED_ATTACHES_MAX_TEXT_LENGTH=exports.FORCE_EXPANDED_ATTACH_LIST=exports.COMPOSE_SEND_STAT=exports.DISABLE_FROM_MAIL_ATTACHES=exports.LIMIT_OF_THEME_RETRY=exports.APPLY_THEME_TIMEOUT=exports.CONFIRM_RECEIPT_HELP_URL=exports.CONFIRM_RECEIPT_HELP=exports.FORCE_CUSTOM_THREAD=exports.SPAM_HELP_DISABLED=exports.SETTINGS_DROPDOWN_HIDE_HELP=exports.HIDE_METATHREADS=exports.TRANSACTION_HEADER=exports.LIST_LETTER_ORDER=exports.ALL_ATTACHES_MAX_COUNT=exports.SEARCH_ALL_ATTACHES=exports.LETTER_TO_YOURSELF=exports.DISABLE_LETTER_FOOTER_CALENDAR=exports.DISABLE_LETTER_HEAD_CALENDAR=exports.DISABLE_LETTER_CALENDAR_NEWSLETTERS=exports.DISABLE_CALLS_ON_SENT_PAGE=exports.DISABLE_CALLS_TIP=exports.DISABLE_CALLS_COMPOSE_TIP=exports.CALLS_DISABLE_COMPOSE_BTN=exports.CALLS_DISABLE_LETTER_FOOTER_CALL=exports.CALLS_DISABLE_LETTER_HEAD_CALL=exports.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS=exports.CALLS_DISABLE_LETTER_CALL=exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALENDAR=exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALL=exports.CALLS_DISABLE_COMPOSE_DROPDOWN_TOMYSELF=exports.CALLS_DISABLE_COMPOSE_DROPDOWN=exports.CALLS_CREATE_ROOM_TIMEOUT=exports.CALLS_CREATE_ROOM_URL=exports.CALLS=exports.DISABLE_PASSWORD_FOLDER_INFO=exports.DISABLE_CREATE_EVENT=exports.DISABLE_SAVE_IN_ARCHIVE=exports.SPECIAL_THIRD_SEPTEMBER=exports.PAY_IMAGE_VARIANT=exports.NEW_AB_COMPOSE_VIEW=exports.NEW_AB_SUGGEST=exports.DARK_MODE_THEMES=exports.DEFAULT_THEME_ID=exports.UNIQUE_THEME_ID_LIST=exports.HAS_UNIQUE_THEME_ID_LIST=exports.UNIQUE_THEME_ID=exports.HAS_UNIQUE_THEME_ID=exports.COMPOSE_SUBJECT_AUTOCOMPLETE=exports.RELEVANT_SEARCH=exports.RELEVANT_SEARCH_FTRS=exports.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT=exports.ADV_FAST_AUTOUPDATE_TIMEOUT=exports.ADMAN_BROKER_IMMEDIATE_FETCH_TIMEOUT=exports.ADMAN_BROKER_DELAYED_FETCH_TIMEOUT=exports.ADV_IDLE_TIMEOUT=exports.ADV_FAST_UPDATE_TIMEOUT=exports.ADV_160_ON_SMALL_WIDTH=exports.DISABLE_TOOLTIPS=exports.ENABLE_WYSIWYG_STICKY=exports.WEBVIEW_DARK_THEME=exports.WEBVIEW=exports.TOUCH_MODE=exports.OCTAVIUS_MOBILE=exports.IS_TABLET=exports.WEBVIEW_MOBILE_MODE_ENABLED=exports.CATEGORY_FEEDBACK_SUBMENU_NOTIFY_DURATION=exports.CATEGORY_FEEDBACK_SUBMENU=exports.CATEGORY_FEEDBACK=exports.MAX_LAYOUT_WIDTH=exports.ENABLE_NAV_UP=exports.CAN_ENABLE_PAGINATOR=exports.LAYER_IFRAME_PARAMS=exports.LETTER_BODY_POPUP_ALLOWED=exports.VIEWERS_AVAILABLE=exports.VIEWER_EDITORS=exports.DISABLE_DOCS_PREVIEWS=exports.DISABLE_DOCUMENTS_EDIT=exports.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW=exports.DISABLE_DOCUMENTS_VIEW=exports.INACTIVE_TAB_RELOAD_DURATION=exports.STATUS_AUTO_CALL=exports.SAFE_URL_LETTERS=exports.MONETA_SANDBOX=exports.MONETA_BASE_URL=exports.MONETA_POST_MESSAGE_URL_REG_EXP=exports.PAYMENT_CENTER_KAKTAM=exports.PAYMENT_CENTER_NOT_HIDDEN=exports.ADDRESS_HEADER_CALENDAR=exports.ADDRESS_HEADER=exports.LIST_LETTER_PAYMENT_DIES_CLOSEABLE=exports.LIST_LETTER_PAYMENT_DIES_GMAP=exports.SHOW_LIST_LETTER_PAYMENT_DIES=exports.COMPOSE_WINDOW_ANIMATION=exports.SERVER_ERROR_URL=exports.ADV_SLOTS=exports.FOLDERS_SHARE_ENABLED=exports.DYNAMIC_FAVICON=exports.THREAD_LETTERS_LOAD_MORE_COUNT=exports.SEARCH_HIDE_CATEGORIES=exports.DISABLE_TRANSLATE=exports.IS_NEW_ADDRESSBOOK=exports.FILTER_SAVE_UPDATE_TIMEOUT=exports.PROGRESS_FACTOR_DOWNLOAD=exports.PROGRESS_FACTOR_UPLOAD=exports.PROGRESS_FACTOR_LOAD_START=exports.PROGRESS_FAKE_LOAD_FACTOR=exports.APPROX_REQUEST_DOWNLOAD=exports.APPROX_REQUEST_UPLOAD=exports.ENABLE_SEARCH_POLLING_2PANE_READMSG=exports.ENABLE_SEARCH_POLLING=exports.ADVERT_SIDEBAR_ROUNDED=exports.ADMAN_CUSTOM_LABEL=exports.ADV_LIST_UPDATE_CACHE=exports.ADV_LIST_METATHREAD_SPECIFIC_CONFIG=exports.ADV_LIST_METATHREAD_CONFIG=exports.ADV_LIST_DEFAULT_CONFIG=exports.ADV_LIST_FOLDER_CONFIG=exports.ADV_LIST_PREFETCH_COUNT=exports.USE_3PANE=exports.SETTINGS_CLEANMASTER_BUILTIN=exports.ALL_READ_BUTTON=exports.ALL_READ_METATHREADS_ONLY=exports.UNSUBSCRIBE_COUNT_ALL=exports.FEATURE_UNSUBSCRIBE=exports.MIMIC_ENDPOINT=exports.MIMIC_FORCE=exports.MIMIC_PARTNER_ID=exports.MIMIC_EXP_ID=exports.ADMAN_BLOCKER_IDS=exports.ADMAN_EXP_ID=exports.ENABLE_XRAY_ENCRYPTOR=exports.API_ENCRYPTOR_MIMIC_LIMIT=exports.API_ENCRYPTOR_CONFIG=exports.HONEYPOT_INTERVALS=exports.HONEYPOT=exports.SMOKESCREEN_LOCATORS=exports.ENABLE_WELTER=exports.ENABLE_SMOKESCREEN=exports.HIDE_TOYS=exports.BL_PROP_NAME=exports.TABLES_EXPANDER_POPUP=exports.IMAGES_EXPANDER_POPUP=exports.TABLES_EXPANDER=exports.IMAGES_EXPANDER=exports.FULL_ATTACH_THUMB_LIMIT=exports.CORRESPONDENTS_LIMIT=exports.CKE_AUTOCORRECT_ALPHABET_LIST=exports.COMPOSE_TRANSLATOR=exports.DISABLE_SAVE_TO_CLOUD=exports.COMPOSE_DISABLE_CLOUD_ATTACHES=exports.TRANSLATOR_REQUEST_TIMEOUT=exports.LETTER_CYRILLIC_PERCENT=exports.QUOTES_VERSION=exports.AMP_TIMEOUT=exports.AMP_REDIRECT_URL=exports.AMP_PROXY_HOST=exports.AMP_IFRAME_PATH=exports.ENABLE_AMP=exports.ENABLE_LOGGING=exports.IS_NATIVE_STICKY_DISABLED=exports.LAYER_SENT_PAGE_CONFIG=exports.STATUS_DEBOUNCE_TIMEOUT=exports.IS_DEBUG=exports.METATHREAD_LOAD_MORE_COUNT_MAX=exports.METATHREAD_LIMIT=exports.LIST_LIMIT=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);function j(a,b){if(!c.default||!c.default[a]){return b}return c.default[a]}var k=a.default.getAsString("mobile-os")==="Android";var l=a.default.getAsString("mobile-os")==="iPhone OS";exports.LIST_LIMIT=a.default.getAsInt("dataset_list_limit",100);exports.METATHREAD_LIMIT=a.default.getAsInt("metathreads-limit",10);exports.METATHREAD_LOAD_MORE_COUNT_MAX=a.default.getAsInt("metathreads-more",5);exports.IS_DEBUG=!!a.default.getAsInt("debug",0);exports.STATUS_DEBOUNCE_TIMEOUT=a.default.getAsInt("status-debounce-timeout",10);exports.LAYER_SENT_PAGE_CONFIG={delayVisible:a.default.getAsInt("layer_sent_page_delay_visible",30*1e3)};exports.IS_NATIVE_STICKY_DISABLED=a.default.has("is-native-sticky-disabled");exports.ENABLE_LOGGING=a.default.has("enable-logging");exports.ENABLE_AMP=a.default.has("enable-amp");exports.AMP_IFRAME_PATH=b.default.urls.ampIframePath||"about:blank";exports.AMP_PROXY_HOST=a.default.getAsURL("amp-proxy-host","");exports.AMP_REDIRECT_URL=b.default.urls.ampRedirectUrl||"about:blank";exports.AMP_TIMEOUT=a.default.getAsInt("amp-timeout",1e4);exports.QUOTES_VERSION=a.default.getAsInt("quotes-version",1);exports.LETTER_CYRILLIC_PERCENT=a.default.getAsInt("letter-cyrillic-percent",60);exports.TRANSLATOR_REQUEST_TIMEOUT=a.default.getAsInt("translation-request-timeout",6e3);exports.COMPOSE_DISABLE_CLOUD_ATTACHES=a.default.has("compose-disable-cloud-attaches");exports.DISABLE_SAVE_TO_CLOUD=a.default.has("disable-save-to-cloud");exports.COMPOSE_TRANSLATOR=a.default.has("compose-translator");exports.CKE_AUTOCORRECT_ALPHABET_LIST=a.default.has("cke-autocorrect-alphabet-list");exports.CORRESPONDENTS_LIMIT=a.default.getAsInt("correspondents-limit",100);exports.FULL_ATTACH_THUMB_LIMIT=a.default.getAsInt("full-attach-thumb-limit",2);exports.IMAGES_EXPANDER=a.default.has("images-expander");exports.TABLES_EXPANDER=a.default.has("tables-expander");exports.IMAGES_EXPANDER_POPUP=a.default.has("images-expander-popup");exports.TABLES_EXPANDER_POPUP=a.default.has("tables-expander-popup");exports.BL_PROP_NAME=a.default.getAsString("bl-property-name");var m=a.default.has("hide-ads")||b.default[exports.BL_PROP_NAME]===false?exports.BL_PROP_NAME:false;exports.HIDE_TOYS=m;exports.ENABLE_SMOKESCREEN=a.default.has("smokescreen")&&!m;exports.ENABLE_WELTER=a.default.has("mimic-welter-enable");exports.SMOKESCREEN_LOCATORS=a.default.getAsTypedArray("smokescreen-locators",a.default.String,["dataset","draggable","scrollable","letter-list","list-letter-bait","layout","ll","nav","metathread","mt","slot","layer","notify-stack","js-letter-list-item","js-tooltip-direction_letter-bottom","js-tooltip-direction_right","js-tooltip-direction_left","js-tooltip-direction_top"]);exports.HONEYPOT=j("honeypot",[]);exports.HONEYPOT_INTERVALS=a.default.getAsTypedArray("honeypot-async",a.default.Int,[1e3,2e3,3e5],"|");exports.API_ENCRYPTOR_CONFIG=a.default.getAsArray("mimic-crypto-api",["plain","8192"],"|");exports.API_ENCRYPTOR_MIMIC_LIMIT=a.default.getAsInt("mimic-api-encryptor-limit",7e3);exports.ENABLE_XRAY_ENCRYPTOR=a.default.has("mimic-crypto-xray");exports.ADMAN_EXP_ID=a.default.getAsInt("adv-exp-id",null);exports.ADMAN_BLOCKER_IDS=a.default.getAsJSON("adv-blocker-ids",{default:null});exports.MIMIC_EXP_ID=a.default.getAsInt("mimic-exp-id");exports.MIMIC_PARTNER_ID=a.default.getAsInt("adman-mimic-partner-id");exports.MIMIC_FORCE=a.default.has("mimic-force");exports.MIMIC_ENDPOINT=a.default.getAsURL("mimic-endpoint","");exports.FEATURE_UNSUBSCRIBE=a.default.has("feature-unsubscribe");exports.UNSUBSCRIBE_COUNT_ALL=a.default.has("unsubscribe-count-all");exports.ALL_READ_METATHREADS_ONLY=a.default.has("all-read-metathreads-only");exports.ALL_READ_BUTTON=a.default.has("all-read-button");exports.SETTINGS_CLEANMASTER_BUILTIN=a.default.has("settings_cleanmaster_builtin");exports.USE_3PANE=a.default.has("use-3pane")||e.needForce3Pane();exports.ADV_LIST_PREFETCH_COUNT=a.default.getAsInt("adv-list-prefetch-count",1);exports.ADV_LIST_FOLDER_CONFIG=a.default.getAsJSON("adv-list-folder-config",{500015:{enable:"false"}});exports.ADV_LIST_DEFAULT_CONFIG=a.default.getAsJSON("adv-list-default-config",{enable:"true","3pane":{start:"0"},"2pane":{start:"0"}});exports.ADV_LIST_METATHREAD_CONFIG=a.default.getAsJSON("adv-list-metathread-config",{"3pane":{interval:"10",start:"4",enable:"true"},"2pane":{interval:"10",start:"4",enable:"true"}});exports.ADV_LIST_METATHREAD_SPECIFIC_CONFIG=a.default.getAsJSON("adv-list-metathread-specific-config",{});exports.ADV_LIST_UPDATE_CACHE=a.default.getAsInt("adv-list-update-cache",1e3*60*60);exports.ADMAN_CUSTOM_LABEL=a.default.has("adman-custom-label");exports.ADVERT_SIDEBAR_ROUNDED=a.default.has("advert-sidebar-rounded");exports.ENABLE_SEARCH_POLLING=a.default.has("search-polling");exports.ENABLE_SEARCH_POLLING_2PANE_READMSG=a.default.has("search-polling-2pane-readmsg");exports.APPROX_REQUEST_UPLOAD=(f=a.default.getAsTypedArray("progress-bar",[a.default.Int,a.default.Int,a.default.Float,a.default.Float,a.default.Float,a.default.Float],[100,1e5,.6,.1,.4,.4],"|"),f[0]),exports.APPROX_REQUEST_DOWNLOAD=f[1],exports.PROGRESS_FAKE_LOAD_FACTOR=f[2],exports.PROGRESS_FACTOR_LOAD_START=f[3],exports.PROGRESS_FACTOR_UPLOAD=f[4],exports.PROGRESS_FACTOR_DOWNLOAD=f[5];exports.FILTER_SAVE_UPDATE_TIMEOUT=a.default.getAsInt("filter-save-update-timeout",200);exports.IS_NEW_ADDRESSBOOK=a.default.has("new-octavius-addressbook");exports.DISABLE_TRANSLATE=a.default.has("disable-translate");exports.SEARCH_HIDE_CATEGORIES=a.default.has("search-hide-categories");exports.THREAD_LETTERS_LOAD_MORE_COUNT=a.default.getAsInt("thread-letters-load-more-count",50);exports.DYNAMIC_FAVICON=a.default.has("dynamic-favicon");exports.FOLDERS_SHARE_ENABLED=a.default.has("share-folders");exports.ADV_SLOTS=m?Object.entries(a.default.getAsJSON("adv-new",{})).reduce(function(a,b){var c=b[0],d=b[1];if(d.counter){a[c]=d}return a},{}):a.default.getAsJSON("adv-new",{});exports.SERVER_ERROR_URL=a.default.getAsURL("server-error-page","/error-pages/500.html");exports.COMPOSE_WINDOW_ANIMATION=a.default.has("compose-window-animation");exports.SHOW_LIST_LETTER_PAYMENT_DIES=a.default.has("show-list-letter-payment-dies");exports.LIST_LETTER_PAYMENT_DIES_GMAP=a.default.getAsJSON("list-letter-payment-dies-gmap");exports.LIST_LETTER_PAYMENT_DIES_CLOSEABLE=a.default.has("list-letter-payment-dies-closeable");exports.ADDRESS_HEADER=a.default.has("address-header");exports.ADDRESS_HEADER_CALENDAR=a.default.has("address-header-calendar");exports.PAYMENT_CENTER_NOT_HIDDEN=a.default.has("payment-center-not-hidden");exports.PAYMENT_CENTER_KAKTAM=a.default.has("payment-center-kaktam");exports.MONETA_POST_MESSAGE_URL_REG_EXP=new RegExp(b.default.urls.monetaPostMessageUrlRegExp);exports.MONETA_BASE_URL=b.default.urls.monetaBaseUrl+"?region_id="+c.default.regionId;exports.MONETA_SANDBOX=b.default.urls.monetaSandBox;exports.SAFE_URL_LETTERS=new RegExp(b.default.urls.safeUrlLetters.replace(/,/g,"|"));exports.STATUS_AUTO_CALL=a.default.getDuration("status-auto-call",120);exports.INACTIVE_TAB_RELOAD_DURATION=a.default.getDuration("inactive-tab-reload-duration",120);exports.DISABLE_DOCUMENTS_VIEW=a.default.has("disable-documents-view");exports.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW=l;exports.DISABLE_DOCUMENTS_EDIT=a.default.has("disable-documents-edit");exports.DISABLE_DOCS_PREVIEWS=a.default.has("disable-docs-previews");exports.VIEWER_EDITORS=a.default.getAsJSON("viewer-editors",{});exports.VIEWERS_AVAILABLE=a.default.getAsTypedArray("viewers-available",a.default.String,["ms","docs"]);exports.LETTER_BODY_POPUP_ALLOWED=b.default.urls["payment-popup-list-params"]||{};exports.LAYER_IFRAME_PARAMS=((h=(g=c.default.config)===null||g===void 0?void 0:g.payments)===null||h===void 0?void 0:h["layer-iframe-params"])||{};exports.CAN_ENABLE_PAGINATOR=a.default.has("paginator");exports.ENABLE_NAV_UP=a.default.has("nav-up");exports.MAX_LAYOUT_WIDTH=a.default.getAsInt("max-layout-width",2150);exports.CATEGORY_FEEDBACK=a.default.has("category-feedback");exports.CATEGORY_FEEDBACK_SUBMENU=a.default.has("category-feedback-submenu");exports.CATEGORY_FEEDBACK_SUBMENU_NOTIFY_DURATION=a.default.getAsInt("category-feedback-submenu",6);exports.WEBVIEW_MOBILE_MODE_ENABLED=a.default.has("enable-webview-mobile-mode");exports.IS_TABLET=a.default.has("is-tablet")||d.default.hasTouchPointer()&&d.default.mac;exports.OCTAVIUS_MOBILE=a.default.has("octavius-mobile");var n=exports.WEBVIEW_MOBILE_MODE_ENABLED&&(a.default.has("is-mobile")||d.default.isTouchDevice());exports.TOUCH_MODE=exports.IS_TABLET||n||exports.OCTAVIUS_MOBILE;exports.WEBVIEW=a.default.has("is-webview");exports.WEBVIEW_DARK_THEME=a.default.has("is-webview-dark-theme");exports.ENABLE_WYSIWYG_STICKY=!k;exports.DISABLE_TOOLTIPS=l;exports.ADV_160_ON_SMALL_WIDTH=a.default.has("adv-160");exports.ADV_FAST_UPDATE_TIMEOUT=a.default.getAsDuration("adv-fast-update-timeout",1e4);exports.ADV_IDLE_TIMEOUT=a.default.getAsDuration("adv-idle-timeout",3e5);exports.ADMAN_BROKER_DELAYED_FETCH_TIMEOUT=a.default.getAsDuration("adv-delayed-fetch-timeout",2e3);exports.ADMAN_BROKER_IMMEDIATE_FETCH_TIMEOUT=a.default.getAsDuration("adv-immediate-fetch-timeout",100);exports.ADV_FAST_AUTOUPDATE_TIMEOUT=a.default.getAsDuration("adv-fast-autoupdate-timeout",3e4);exports.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT=a.default.getAsInt("adman-mimic-on-fail-retry-count",2);exports.RELEVANT_SEARCH_FTRS=a.default.getAsJSON("relevant-search",null);exports.RELEVANT_SEARCH=exports.RELEVANT_SEARCH_FTRS||{};exports.COMPOSE_SUBJECT_AUTOCOMPLETE=a.default.has("compose-subject-autocomplete");exports.HAS_UNIQUE_THEME_ID=a.default.has("user-unique-themeId");exports.UNIQUE_THEME_ID=a.default.getAsString("user-unique-themeId","default");exports.HAS_UNIQUE_THEME_ID_LIST=a.default.has("user-unique-themeId-list");exports.UNIQUE_THEME_ID_LIST=a.default.getAsString("user-unique-themeId-list","default");exports.DEFAULT_THEME_ID=a.default.getAsString("default-themeId",exports.UNIQUE_THEME_ID);exports.DARK_MODE_THEMES=a.default.getAsArray("dark-mode-themes",["t5000","t5001"]);exports.NEW_AB_SUGGEST=a.default.has("new-ab-suggests");exports.NEW_AB_COMPOSE_VIEW=a.default.has("new-ab-compose-view");exports.PAY_IMAGE_VARIANT=a.default.getAsString("pay-image-variant","1");exports.SPECIAL_THIRD_SEPTEMBER=a.default.has("special-third-september");exports.DISABLE_SAVE_IN_ARCHIVE=a.default.has("disable-save-in-archive");exports.DISABLE_CREATE_EVENT=a.default.has("disable-create-event");exports.DISABLE_PASSWORD_FOLDER_INFO=a.default.has("disable-password-folder-info");exports.CALLS=a.default.has("calls");exports.CALLS_CREATE_ROOM_URL=a.default.getAsString("calls-create-room-url","https://corsapi-test.imgsmail.ru/calls/api/v1/room");exports.CALLS_CREATE_ROOM_TIMEOUT=a.default.getAsInt("calls-create-room-timeout",3e3);exports.CALLS_DISABLE_COMPOSE_DROPDOWN=a.default.has("calls-disable-compose-dropdown");exports.CALLS_DISABLE_COMPOSE_DROPDOWN_TOMYSELF=a.default.has("calls-disable-compose-dropdown-tomyself");exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALL=a.default.has("calls-disable-compose-dropdown-call");exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALENDAR=a.default.has("calls-disable-compose-dropdown-calendar");exports.CALLS_DISABLE_LETTER_CALL=a.default.has("calls-disable-letter-call");exports.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS=a.default.has("calls-disable-letter-call-newsletters");exports.CALLS_DISABLE_LETTER_HEAD_CALL=a.default.has("calls-disable-letter-head-call");exports.CALLS_DISABLE_LETTER_FOOTER_CALL=a.default.has("calls-disable-letter-footer-call");exports.CALLS_DISABLE_COMPOSE_BTN=a.default.has("calls-disable-compose_btn");exports.DISABLE_CALLS_COMPOSE_TIP=a.default.has("disable-calls-compose-tip");exports.DISABLE_CALLS_TIP=a.default.has("disable-calls-tip");exports.DISABLE_CALLS_ON_SENT_PAGE=a.default.has("disable-calls-on-sent-page");exports.DISABLE_LETTER_CALENDAR_NEWSLETTERS=a.default.has("disable-letter-calendar-newsletters");exports.DISABLE_LETTER_HEAD_CALENDAR=a.default.has("disable-letter-head-calendar");exports.DISABLE_LETTER_FOOTER_CALENDAR=a.default.has("disable-letter-footer-calendar");exports.LETTER_TO_YOURSELF=a.default.getAsString("letter-to-yourself");exports.SEARCH_ALL_ATTACHES=a.default.has("search-all-attaches");exports.ALL_ATTACHES_MAX_COUNT=a.default.getAsInt("search-all-attaches-max-count",5);exports.LIST_LETTER_ORDER=a.default.has("list-letter-order");exports.TRANSACTION_HEADER=a.default.getAsJSON("transaction-header",null);exports.HIDE_METATHREADS=a.default.has("hide-metathreads");exports.SETTINGS_DROPDOWN_HIDE_HELP=a.default.has("settings-dropdown-hide-help");exports.SPAM_HELP_DISABLED=a.default.has("confirm-receipt-help");exports.FORCE_CUSTOM_THREAD=a.default.has("force-custom-thread");exports.CONFIRM_RECEIPT_HELP=a.default.has("confirm-receipt-help");exports.CONFIRM_RECEIPT_HELP_URL=b.default.urls.confirmReceiptHelp||"https://help.mail.ru/mail-help/letters/write/helpful";exports.APPLY_THEME_TIMEOUT=a.default.getAsInt("theme-apply-small-timeout",30*1e3);exports.LIMIT_OF_THEME_RETRY=a.default.getAsInt("limit_of_theme_retry",3);exports.DISABLE_FROM_MAIL_ATTACHES=a.default.has("disable-from-mail-attaches");exports.COMPOSE_SEND_STAT=a.default.has("send-compose-stats");exports.FORCE_EXPANDED_ATTACH_LIST=a.default.has("force-expanded-attach-list");exports.FORCE_EXPANDED_ATTACHES_MAX_TEXT_LENGTH=a.default.getAsInt("force-expanded-attach-list",200);exports.COMPOSE_SEND_USER_TRACK=a.default.has("compose-send-user-track");exports.COMPOSE_SEND_USER_TRACK_CONF=a.default.getAsTypedArray("compose-send-user-track",a.default.Int,[100,200],"|");exports.EXTRA_SUGGEST_SEARCH=a.default.has("extra-suggest-search");exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK=a.default.has("adman-direct-error-handle");exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK_FOR_BLOCKER=a.default.has("adman-direct-error-blocker");exports.ADMAN_USE_MIMIC_ON_DIRECT_LOAD_ERROR=a.default.has("adman-direct-error-mimic");exports.ADMAN_REINIT_ON_DIRECT_LOAD_ERROR=a.default.has("adman-direct-error-reinit");exports.ADMAN_REINIT_ON_DETECT=a.default.has("adman-reinit-on-detect");exports.ADMAN_SEND_SYNC_IDS=!a.default.has("adman-disable-send-sync-ids");exports.ADMAN_SEND_HAS_VK=!a.default.has("adman-disable-send-has-vk");exports.PREFETCH_CORRESPONDENTS_DISABLE=a.default.has("prefetch-correspondents-disable");exports.BUILD=b.default.build;exports.SERVER_TIME=b.default.serverTime;exports.IS_READLETTER_NATIVE_STICKY_DISABLED=exports.IS_NATIVE_STICKY_DISABLED||a.default.has("is-readletter-native-sticky-disabled")||!d.default.supportedSticky;exports.HELP_URL=a.default.getAsURL("help-mail-url",b.default.urls.helpMailUrl||"https://help.mail.ru/mail");exports.HELP_3PANE=b.default.urls.help3PaneUrl;exports.HELP_THREADS=b.default.urls.helpThreadsUrl;exports.HELP_METATHREADS=b.default.urls.helpMetathreadsUrl;exports.HELP_TO_MYSELF=b.default.urls.helpToMyselfUrl;exports.HELP_PAGINATOR=b.default.urls.helpPaginatorUrl;exports.CLEANMASTER_URL=b.default.urls.cleanmasterUrl||"https://e.mail.ru/settings/cleanmaster?octaviusMode=1";exports.NOTIFICATIONS_URL=b.default.urls.notificationsUrl||"https://e.mail.ru/settings/general#notifications";exports.SETTINGS_URL=a.default.getAsString("settings-url","https://e.mail.ru/settings/?octaviusMode=1");exports.SIGNATURE_URL=b.default.get("urls.signatureUrl")||"https://e.mail.ru/settings/general#signature";exports.SUPPORTED_CUSTOM_METATHREADS=a.default.getAsArray("supported_custom_metathreads",["tomyself"]);exports.SETTINGS_DROPDOWN_HIDE_TO_MYSELF=a.default.has("settings-dropdown-hide-to-myself");exports.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS=a.default.getAsArray("widgets-with-show-limit-theme-ids",["t5001","t5003","t5004","t1169","t5002","t5005"]);exports.WIDGETS_SHOW_LIMIT_MAP={};exports.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS.forEach(function(b){exports.WIDGETS_SHOW_LIMIT_MAP[b]=a.default.getAsInt("widget-show-limit-"+b,5)});exports.SUPPORT_WIDGET_THEME_IDS=a.default.getAsArray("support-widget-theme-ids",["t1154","t1155","t1189","t1190","t1168","t3002","t3015","t5001","t1169","t5003","t5004","t5002","t5005","t5007"]);exports.USER_LANG=c.default.LANG;exports.PACKAGES_URL=b.default.urls.packagesUrl;exports.MAX_ATTACHES_SIZE_LIMIT=a.default.has("max-attaches-size-limit")?a.default.getAsInt("max-attaches-size-limit",26214400):null;exports.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP=a.default.getAsInt("letter-from-future-threshold-timestamp",0);exports.LETTER_FROM_FUTURE_LOG_DATES=a.default.getAsTypedArray("letter-from-future-log-dates",a.default.String,[],"|").map(function(a){return a.replace(/_/g," ")});exports.LETTER_FROM_FUTURE_LOG_KAKTAM=a.default.has("letter-from-future-log-kaktam");exports.IGNORE_LOCAL_TIME=a.default.has("ignore-local-time");exports.DISABLE_TIME_CORRECTION=a.default.has("disable-time-correction");exports.DEBUG_SERVER_TIMESTAMP=a.default.getAsInt("debug-server-timestamp",0);exports.OCTAVIUS_PREFETCH=a.default.has("octavius-prefetch");exports.ARCHIVE_DISABLED=a.default.has("archive-disabled");exports.SMART_THREAD_FETCHING=a.default.has("smart-thread-fetching");exports.SUGGEST_FROM=a.default.getAsJSON("suggest-from",null);exports.IS_CHROME=a.default.has("is_chrome");exports.ADVERT_SCROLL=a.default.has("advert-scroll");exports.ADVERT_SCROLL_CONF=a.default.getAsTypedArray("advert-scroll",a.default.Int,[2,1,1],"|");exports.ADVERT_CPM_RELOAD=a.default.has("advert-cpm-reload");exports.ADVERT_CPM_RELOAD_CONF=a.default.getAsTypedArray("advert-cpm-reload",a.default.Int,[1e3,0,1e3,0]);exports.ADVERT_CPM_EXP=a.default.getAsString("advert-cpm-exp","0");exports.ADVERT_CPM_VALUES=a.default.getAsTypedArray("advert-cpm-values",a.default.Int,[]);exports.NO_MIMIC_ON_WLIST=a.default.has("adv-no-mimic-on-wlist");exports.NO_MIMIC_ON_ADBLOCK=a.default.has("adv-no-mimic-on-adblock");exports.MIMIC_IGNORE_HAS_WLIST=!a.default.has("mimic-ignore-has-white-list-disabled");exports.KASPERSKY=a.default.has("kaspersky");exports.TODO_URL=a.default.getAsString("todo-url","https://todo.mail.ru");exports.METATHREAD_TOMYSELF_SNIPPET_ITEMS_MAX_COUNT=a.default.getAsInt("metathread_tomyself_snippet_items_max_count",3);exports.METATHREADS_FORCED_EXP=a.default.getAsString("octavius-notify-metathreads-forced",null);exports.FORCE_METATHREADS=a.default.has("force-metathreads");exports.FORCE_METATHREADS_LETTER=a.default.has("force-metathreads-letter");exports.FORCE_METATHREADS_EXP=a.default.has("force-metathreads-exp");var o=a.default.getAsJSON("themes-available",{});if(o.whitelist===undefined){o.whitelist=[]}var p=a.default.has("disable-default-theme");if(!p){o.whitelist.unshift("default")}if(o.colorized===undefined){o.colorized=true}exports.THEMES_AVAILABLE=o;exports.DOMPURIFY=a.default.has("dompurify");exports.ADV_SPECLINE_SLOTS=m?{}:a.default.getAsJSON("adv-specline",{});exports.ADV_SPECLINE_ENABLED=m?false:a.default.has("adv-specline-enabled");exports.SIDEBAR_PAY_NOTIFICATION_BADGE=a.default.has("sidebar-pay-notification-badge");exports.SHOW_TODO_TOGGLE=a.default.has("todo-toggle");exports.PROMO_DOMAIN_HEADER=a.default.getAsJSON("promo-domain-header",[]);exports.PROMO_DOMAIN_CROSS_ENABLED=a.default.has("promo-domain-cross-enabled");exports.THEMES_WIDGET_CLOUDY_ENABLED=a.default.has("themes-widget-cloudy-enabled");exports.FOLDER_MAX_CHILD_LEVEL_UI=4;exports.PHISHING_ALERT=a.default.getAsJSON("phishing-alert",{}).show==="true";exports.LETTER_DATA_WHITE_LIST=a.default.getAsJSON("letter-data-white-list",{});exports.MESSAGE_SUGGESTS=a.default.has("message-suggests");exports.SETTINGS_AUTOREPLY_LINK=b.default.urls.settingsAutoReply||"/settings/autoreply";exports.NAV_MY_FOLDERS_CONTAINER_ID=a.default.getAsString("nav-my-folders-container-id","myFoldersContainer");exports.SUGGEST_SEARCH_INTERNET=a.default.has("suggest-search-internet");exports.SUGGEST_SEARCH_INTERNET_URL=a.default.getAsString("suggest-search-internet-url","https://go.mail.ru/search?gp=990009&frm=search_mail_sg");exports.ADV_SEARCH_EXP_ID=a.default.getAsString("adv-search-exp-id");exports.ADV_SEARCH_SEND_QUERY=a.default.has("adv-search-send-query");exports.SEARCH_SIDEBARS_SWAP=a.default.has("search-sidebars");exports.FEED_SUBSCRIPTIONS=a.default.has("feed-subscriptions");exports.FEED_SUBSCRIPTIONS_INFORMER=!a.default.has("feed-subscriptions-informer-disabled");exports.FEED_SUBSCRIPTIONS_IFRAME_URL=a.default.getAsURL("feed-subscriptions-iframe-url","https://pulse.mail.ru/service/subscribes_frame/");exports.FEED_SUBSCRIPTIONS_IFRAME_URL_SETTINGS=a.default.getAsURL("feed-subscriptions-iframe-url-settings","https://pulse.mail.ru/service/metathread_subscribe/");exports.WORD_BREAK_IN_TOOLTIP=!a.default.has("disable-word-break-in-tooltip");exports.COMPOSE_SLIDER_LAST_STEP_DELTA=a.default.getAsInt("compose-slider-last-step-delta",10);exports.MATCH_MEDIA_LOG=a.default.has("match_media_log");exports.LETTER_PREVIEWS=a.default.has("letter-previews-config");exports.LETTER_PREVIEWS_CONFIG=a.default.getAsJSON("letter-previews-config",{"folders-list":[],"stubs-count":0,"show-previews":false,"go-on-server":false});exports.LETTER_PREVIEW_RADAR=a.default.has("letter-previews-radar");exports.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART=a.default.has("sidebar-pay-notification-badge-smart");exports.BILLS_COUNTER_UPDATE_INTERVAL=a.default.getAsInt("bills-counter-update-interval",5*60);exports.BILLS_COUNTER_MAX=a.default.getAsInt("bills-counter-max",99);exports.DATES_METADATA=a.default.has("dates-metadata");exports.LAYER_UNSAFE_ATTACH=a.default.has("layer-unsafe-attach");exports.CKE_ATTACH_BASE64=a.default.has("cke-attach-base64");exports.SIDEBAR_MENU_LIST_CONFIG=a.default.getAsJSON("sidebar-menu-list-config",[{hidden:false,type:"calls"},{hidden:false,type:"cloud"},{hidden:false,type:"contacts"},{hidden:false,type:"calendar"},{hidden:false,type:"pay"},{hidden:false,type:"bonus"},{hidden:false,type:"todo"}]);exports.RENOVATOR_DISABLED=a.default.has("renovator-disabled");exports.LAYER_CONFIRM_FOLDER_CLEAR=a.default.getAsJSON("confirm-folder-clear-config",{inbox:true,tomyself:true,trash:true,child_trash:true});exports.DND_CLOUD_FILES_LIMIT=a.default.getAsInt("dnd-cloud-files-limit",100);exports.DND_CLOUD_ENABLED=a.default.has("dnd-cloud-enabled");exports.DND_CLOUD_SHARE=a.default.has("dnd-cloud-share");exports.DND_NOTIFY_DURATION=a.default.getAsInt("dnd-notify-duration",6);exports.CLOUD_OPEN_API_URL=b.default.urls.cloudOpenApiUrl||"https://openapi.cloud.mail.ru/api/v1/";exports.CLOUD_HOME_URL=b.default.urls.cloudHomeUrl||"https://cloud.mail.ru/home";exports.CLOUD_LOAD_DIRECTORY=b.default.urls.cloudLoadDirectory||"/Загрузки";exports.OAUTH_CLIENT_ID=a.default.getAsString("oauth-client-id","b4c073bb6c5a4b1b84d2c7d2a1bceb9b");exports.CALLS_P2P=a.default.has("calls_p2p");exports.CALLS_BASE_URL=b.default.urls.callsBaseUrl||"https://calls.mail.ru";exports.CALLS_P2P_OUTGOING=a.default.has("calls_p2p_outgoing");exports.DARK_MODE_BASE_COLOR=a.default.getAsJSON("dark_mode_base_color",{r:35,g:35,b:36});exports.DARK_MODE_MEDIA_QUERY=a.default.has("dark_mode_media_query");exports.DARK_MODE_ASYNC=a.default.getAsEnum("dark_mode_async",["true","false","auto"],"false");exports.DARK_MODE_ASYNC_THRESHOLD=a.default.getAsInt("dark_mode_async_threshold",100);exports.DARK_MODE_FRAME_BUDGET=a.default.getAsInt("dark_mode_frame_budget",20);exports.DARK_MODE_SNEAKY=a.default.has("dark_mode_sneaky");exports.MAX_CLOUD_STOCK_SIZE_LIMIT=a.default.getAsInt("max-cloud-stock-size",2*1024*1024*1024);exports.KASPERSKY_ENG_LOGO_LANGS=a.default.getAsTypedArray("kaspersky_eng_logo_langs",a.default.String,["en_US","es_ES"]);exports.DARK_MODE_BACKGROUND_ASYNC=a.default.has("dark_mode_background_async");exports.WELCOME_BLOCK_DISABLED=a.default.has("welcome-block-disabled");exports.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD=a.default.getAsInt("welcome-block-scroll-hide-threshold",1);exports.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL=a.default.getAsInt("welcome-block-update-weather-interval",10*60);exports.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT=a.default.getAsInt("welcome-block-hide-greeting-timeout",5*60);exports.WELCOME_BLOCK_SHOW_INTERVAL=a.default.getAsInt("welcome-block-show-interval",60*60);exports.WELCOME_BLOCK_SNOOZE_INTERVAL=a.default.getAsInt("welcome-block-snooze-interval",24*60*60);exports.WEATHER_URL=b.default.urls.weatherUrl||"https://img.imgsmail.ru/static.promo/octavius/weather/";exports.SELECT_GEO_URL=b.default.urls.selectGeoUrl||"https://mail.ru/region";exports.MARUSIA_LOGO=b.default.urls.marusiaLogo||"https://img.imgsmail.ru/static.promo/octavius/welcome/marusia.png";exports.MARUSIA_URL=b.default.urls.marusiaUrl||"https://marusia.mail.ru/";exports.LAST_SEEN_ENABLE=a.default.has("ab-lastseen-octavius");exports.LAST_SEEN_OMICRON=a.default.getDataOrDefault("ab-lastseen-addressbook",null);exports.HEADLINE_HEIGHT="var(--vkui--octavius_size_headline_height--regular, 36px)";exports.PORTAL_MENU_HEIGHT="var(--vkui--octavius_size_portal-menu_height--regular, 56px)";if(((i=b.default.headline)===null||i===void 0?void 0:i.headlinePromoHeight)!==0){window.addEventListener("message",function(a){var c;if(a.origin.includes("https://limg.imgsmail.ru")&&a.data.close){document.documentElement.style.setProperty("--vkui--octavius_size_headline_height--regular",((c=b.default.headline)===null||c===void 0?void 0:c.headlineHeight)+"px","important")}})}exports.FILTER_SETTINGS_DEFAULT_TEXT_VAR=a.default.getDataOrDefault("filter-settings-default-text-var","0");exports.SETTINGS_DROPDOWN_HIDE_NOTIFICATIONS=a.default.has("settings-dropdown-hide-notifications");exports.SETTINGS_DROPDOWN_HIDE_CLEANMASTER=a.default.has("settings-dropdown-hide-cleanmaster");exports.SETTINGS_DROPDOWN_HIDE_SETTINGS=a.default.has("settings-dropdown-hide-settings");exports.LAYER_METATHREAD_DISABLE=a.default.has("layer-metathread-disable");exports.NO_CSS_GRID_LOG_KAKTAM=a.default.has("no-css-grid-log-kaktam");exports.VISIBILITY_WATCHER_CONFIG=a.default.getAsJSON("visibility-watcher-config",{errThreshold:4,checkTimeout:2e3,disabled:false});exports.FORGOT_PASSWORD_URL=a.default.getAsString("forgot-password-url","https://e.mail.ru/settings/folders");exports.ENABLE_ACTION_OVER_SELECTED=a.default.has("enable_action_over_selected");exports.SKIP_DWH=a.default.has("radar-skipdwh");exports.WHITE_PORTAL_FORCED=a.default.has("white_portal_forced");exports.WHITE_PORTAL_NEWREG=a.default.has("white_portal_newreg");exports.WHITE_PORTAL_AVAILABLE=a.default.has("white_portal_available");exports.WHITE_PORTAL_HAS_FLAG=a.default.has("white_portal_has_flag");exports.WHITE_PORTAL_THEME=a.default.getAsString("white_portal_theme","t6000");if(exports.WHITE_PORTAL_FORCED||exports.WHITE_PORTAL_NEWREG||exports.WHITE_PORTAL_AVAILABLE){exports.THEMES_AVAILABLE.whitelist.push(exports.WHITE_PORTAL_THEME)}exports.USER_LAYOUT_RESIZE=a.default.has("user-layout-resize")&&!exports.TOUCH_MODE;exports.USER_LAYOUT_RESIZE_3PANE=exports.USER_LAYOUT_RESIZE&&a.default.has("user-layout-resize-3pane");exports.USER_LAYOUT_SAVE_TO_STORAGE=exports.USER_LAYOUT_RESIZE&&!a.default.has("user-layout-disable-save-to-storage");exports.USER_LAYOUT_ENABLE_METRICS=!a.default.has("user-layout-disable-metrics");exports.DISCOUNTS_BLOCK=a.default.has("discounts-block");exports.DISCOUNTS_BLOCK_DEFAULT=a.default.has("discounts-block_default");exports.DISCOUNTS_FLAG_NAME=a.default.getAsString("discounts-flag-name","discounts-v2");exports.DISCOUNTS_BLOCK_LIMIT=a.default.getAsInt("discounts-block-limit",50);exports.P2P_PROMO_SHOWN_RECENTLY=a.default.getAsDuration("p2p_promo_show_recently_duration",7*24*60*60);exports.CSS_VARS_FALLBACK=a.default.has("css-vars-fallback");exports.IS_RESEND_DROPDOWN_DISABLED=a.default.has("resend-dropdown-disabled");exports.RELOAD_TIMEOUT=a.default.getAsTypedArray("deploy_switch_reload_timeout",a.default.Int,[1,60],",");exports.OK_RELOAD_TIMEOUT=a.default.getAsTypedArray("deploy_ok_reload_timeout",a.default.Int,exports.RELOAD_TIMEOUT,",");exports.OK_RELOAD=a.default.has("deploy_ok_reload");exports.RESIZE_UPDATE_DEBOUNCE_TIME=a.default.getAsDuration("resize-update-debounce-time",300);exports.PROMO_LOGO_MIN_WIDTH=a.default.getAsInt("promo-logo-min-width",210);exports.DISCOUNTS_MOUSE_SCROLL=a.default.getAsString("discounts_mouse_scroll","2pane");exports.PAYMENT_LETTER_UNIVERSAL=a.default.has("payment-letter-universal");exports.LL_UNSUBSCRIBE_NEWSLETTERS=a.default.has("ll-unsubscribe-newsletters");exports.LL_UNSUBSCRIBE_NEWSLETTERS_INTERVAL=a.default.getAsInt("ll-unsubscribe-newsletters-interval",60*60);exports.LL_UNSUBSCRIBE_NEWSLETTERS_TIMEOUT=a.default.getAsInt("ll-unsubscribe-newsletters-timeout",5);exports.TWO_STEP_ENABLE_URL=a.default.getAsURL("2fa_enable_url","https://account.mail.ru/user/2-step-auth/enable");exports.OK_RELOAD_SHADOW=a.default.has("deploy_ok_shadow");exports.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION=a.default.has("compose-native-thumb-rotation");exports.CALL_TITLE_BLINK_INTERVAL=a.default.getAsInt("call_title_blink_interval",0);exports.AUTOSAVE_DRAFT_TIMEOUT_SECONDS=a.default.getAsInt("autosave-draft-timeout-seconds",60);exports.HIDE_NEWS_METATHREAD=a.default.has("hide_news_metathread");exports.METATHREADS_SETTINGS_ORDER=a.default.getAsArray("metathreads-settings-order",["games","school","newsLetters","social","toMyself","receipts","news","official","inbox"]);exports.MIN_LETTER_HEIGHT_STICKY=a.default.getAsInt("min-letter-height-sticky",400);exports.COMPOSE_INIT_ADDRESSBOOK=a.default.has("compose-init-addressbook");exports.DELAY_FOR_CANCELLATION=a.default.has("delay-for-cancellation");exports.COMPOSE_USER_LOADING_DISABLED=a.default.has("compose-user-loading-disabled");exports.CHANGE_EXPIRED_PASSWORD_URL=a.default.getAsURL("change-expired-password-url","https://id.mail.ru/security");exports.ACTUAL_REASON_FEEDBACK=a.default.has("actual-reason-feedback");exports.OVERSIZE_CLOUD_ATTACHES=a.default.has("oversize-cloud-attaches");exports.OVERSIZE_CLOUD_ATTACHES_FOLDER=a.default.getAsString("oversize-cloud-attaches-folder",exports.CLOUD_LOAD_DIRECTORY);exports.OVERSIZE_CLOUD_ATTACHES_MOCK_CLOUD=a.default.has("oversize-cloud-attaches-mock-cloud");exports.CLOUD_TARIFFS_IFRAME_URL=b.default.urls.cloudTariffsIframeUrl||"https://cloud.mail.ru/uploader";exports.HAS_PRIORITY_MESSAGES=a.default.has("priority-messages");exports.ACTUAL_LETTERS_DEFAULT_INBOX=a.default.has("priority-messages_default");exports.ACTUAL_LETTERS_DEFAULT_NEWSLETTERS=a.default.has("priority-messages-default-newsletters");exports.FORCE_SHOW_PRIORITY_MESSAGES_LIST_LETTERS=a.default.has("force-show-priority-messages-list-letters");exports.FORCE_SHOW_PRIORITY_MESSAGES_READ_LETTER=a.default.has("force-show-priority-messages-read-letter");exports.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS=a.default.has("force-hide-priority-messages-settings");exports.LOG_DATASOURCE_PROBLEMS=a.default.has("log-datasource-problems");exports.SHOW_DEFINITELY_SPAM=a.default.has("show-definitely-spam");exports.ADV_EXP_ID=a.default.getAsString("adv-exp-id");exports.ADV_DIRECT_READY_TIMEOUT=a.default.getAsInt("adman-insert-context-timeout",1800);exports.ADV_TARIFF_FEATURE=a.default.getAsString("noadsPromoTariff");exports.ADV_EXP_ID_SEND=a.default.has("adv-exp-id-send");exports.ADV_OFF_CLOUD_GROUP=a.default.getAsArray("adv-off-cloud-group",["769"]);exports.ADV_OFF_NOTIFY_GROUP=a.default.getAsArray("adv-off-notify-group",["773"]);exports.ADV_OFF_CONTROL_GROUP=a.default.getAsArray("adv-off-control-group",["787"]);exports.ADV_OFF_QUERY_GROUP=a.default.getAsArray("adv-off-query-group",["789"]);exports.ADV_OFF_MONTH_GROUP=a.default.getAsArray("adv-off-month-group",["791"]);exports.ADV_NO_ADS_PROMO_URL=a.default.getAsString("no-ads-promo-url","https://cloud.mail.ru/promo/quota?feature=ad&utm_source=mail_disable_ad&utm_medium=cross-promo&utm_campaign=ed.quota#start");exports.ADV_NO_ADS_POSTMSG_URL=a.default.getAsString("no-ads-postmsg-url","https://promo.mail.ru");exports.DISCOUNT_DESCRIPTION_FROM_SUBJECT=a.default.has("discount-description-from-subject");exports.LL_UNSUBSCRIBE_NEWSLETTERS_SENDERS_LIMIT=a.default.getAsInt("ll-unsubscribe-newsletters-senders-limit",3);exports.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT=a.default.getAsInt("ll-unsubscribe-newsletters-show-limit",3);exports.MARUSIA_READ_LETTER=a.default.has("marusia-read-letter");exports.MARUSIA_SKILLSERVER_TEST=a.default.has("marusia-skill-server-test");exports.WIDGET_CLOUD_URL=b.default.get("urls.widgetCloudUrl")||"https://cloud.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_cloud";exports.WIDGET_ADDRESSBOOK_URL=exports.IS_NEW_ADDRESSBOOK?b.default.get("urls.octaviusAddressbookUrl"):b.default.get("urls.septimaAddressbookUrl")||"https://e.mail.ru/addressbook?from=mail&utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_addressbook";exports.WIDGET_CALENDAR_URL=b.default.get("urls.widgetCalendarUrl")||"https://calendar.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_calendar";exports.WIDGET_X_CALENDAR_URL=b.default.get("urls.widgetXCalendarUrl")||"https://x.calendar.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_calendar";exports.WIDGET_TODO_URL=b.default.get("urls.widgetTodoUrl")||"https://todo.mail.ru/?from=mail&utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_todo";exports.WIDGET_CALLS_URL=b.default.get("urls.widgetCallsUrl")||"https://calls.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_calls";exports.WIDGET_PAYMENT_URL=b.default.get("urls.payMenuUrl")||"https://e.mail.ru/payment/center?from=mail&utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_payment";exports.NTFR_INTERVALS=a.default.getAsJSON("ntfr_intervals",{keepalive:4*60*1e3,successConnect:4*60*1e3});exports.NTFR_RECONNECT_ON_FOCUS=a.default.has("ntfr_reconnect_on_focus");exports.NTFR_EXP_BACKOFF=a.default.getAsJSON("ntfr_exp-backoff",{minDelay:2*60*1e3,maxDelay:60*60*1e3,jitter:.4,factor:2});exports.FORCE_DISABLE_NEW_THREAD=a.default.has("force-disable-new-thread");exports.NEW_THREAD=a.default.has("use-new-thread")&&!exports.TOUCH_MODE&&!exports.FORCE_DISABLE_NEW_THREAD;exports.THREAD_WITH_RELIABLE_MARK=a.default.has("thread-with-reliable-mark")&&!exports.TOUCH_MODE;exports.FORCE_DISABLE_NEW_LETTER_LIST=a.default.has("force-disable-new-letter-list");exports.NEW_LETTER_LIST=a.default.has("use-new-letter-list")&&!exports.TOUCH_MODE&&!exports.FORCE_DISABLE_NEW_LETTER_LIST;exports.NEW_LETTER_LIST_3PANE=exports.NEW_LETTER_LIST&&!a.default.has("disable-new-letter-list-3pane");exports.SWBOX=a.default.has("swbox");exports.SWBOX_LOG_SILENT_ERRORS=a.default.has("swbox_log-silent-errors");exports.PROMO_DISCOUNTS_COLORS=a.default.getAsJSON("promo-discounts-colors",{});exports.DELAY_FOR_NEW_DISCOUNT=a.default.getAsDuration("delay-for-new-discounts",2*7*24*60*60);exports.DELAY_NO_DISCOUNTS_BLOCK=a.default.getAsInt("empty-discounts-block-delay",604800);exports.AMP_SENDER_METRICS=a.default.has("amp_fallback_sender_metric");exports.SETTINGS_DOCK_30_50_MODE=a.default.has("settings_dock_30_50_mode");exports.SETTINGS_DOCK_DISABLE_EXPAND_BUTTON=a.default.has("settings_dock_disable_expand_button");exports.SETTINGS_DOCK_DISABLE_AUTO_EXPAND=a.default.has("settings_dock_disable_auto_expand");exports.SETTINGS_DOCK_START_FULL_SCREEN=a.default.has("settings_dock_start_full_screen");exports.SETTINGS_DOCK_HIDE_CLEANMAILBOX=a.default.has("settings_dock_hide_cleanmailbox");exports.SETTINGS_DOCK_CLEANMASTER_INLINE_DISABLED=a.default.has("settings_dock_cleanmaster_inline_disabled");exports.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION=a.default.getAsInt("settings_dock_cleanmaster_notify_duration",5);exports.SETTINGS_DOCK_PULSE_INLINE_DISABLED=a.default.has("settings_dock_pulse_inline_disabled");exports.SETTINGS_DOCK_CLEANMASTER_USE_UNSUBSCRIBE_TITLE=a.default.has("settings_dock_cleanmaster_use_unsubscribe_title");exports.CANCELLATION_RESERVE_TIME=a.default.getAsInt("cancellation-reserve-time",10);exports.FLAGS_AUTOSYNC=a.default.has("flags_autosync");exports.FLAGS_AUTOSYNC_DEBOUNCE=a.default.getAsInt("flags_autosync_debounce",2e3);exports.CLOUD_VIEWER_GROUPS={CONTROL:0,MAIL:1,CLOUD:2};exports.CLOUD_VIEWER_GROUP=a.default.getAsInt("exp-cloud-viewer-group",exports.CLOUD_VIEWER_GROUPS.CONTROL);exports.CLOUD_VIEWER_FORCE=a.default.has("exp-cloud-viewer-force");exports.CLOUD_VIEWER_FILE_TYPES=a.default.getAsArray("exp-cloud-viewer-file-types",[]);exports.CLOUD_VIEWER_ATTACH_TYPES=a.default.getAsArray("exp-cloud-viewer-attach-types",[]);exports.CLOUD_VIEWER_TEMPORARY=a.default.has("exp-cloud-viewer-temporary");exports.CLOUD_VIEWER_HOST=a.default.getAsString("exp-cloud-viewer-host","cloud.mail.ru");exports.HEADLESS_COUNTER=a.default.has("headless_counter");exports.WEBPUSH_METRIC_DISABLE=a.default.has("webpush_metric_disable");exports.LETTER_CONTENT_ADV_ENABLE=a.default.has("letter-content-native-advert-enable");exports.MONETA_PAYMENT_LETTER_URL_REGEXP=new RegExp(b.default.urls.monetaPaymentLetterUrlRegExp||"^https:\\/\\/e\\.mail\\.ru\\/");exports.NOTIFY_CLOSE_DELAY=a.default.getAsInt("notify_close_delay",4);exports.ADVERT_FEEDBACK=a.default.has("advert-feedback-config2");exports.ADVERT_FEEDBACK_CONFIG2=a.default.getAsJSON("advert-feedback-config2",{});exports.ADVERT_FEEDBACK_TEXTS=a.default.getAsJSON("advert-feedback-text",{title:i18n("Вам интересны похожие предложения?"),positiveButtonText:i18n("Интересны"),negativeButtonText:i18n("Не моё"),chance:5e3});exports.SWBOX_ANALYTICS_REQUEST=a.default.getAsJSON("swbox-analytics-request",{mail:false,promo:false});exports.DISABLE_VK_MESSENGER=a.default.has("disable-vk-messenger");exports.VK_MESSENGER_CHECK_VK_AUTH=a.default.has("vk-messenger-check-vk-auth");exports.VK_MESSENGER_EXTERNAL=a.default.has("vk-messenger-external");exports.VK_MESSENGER_CHAT_ID_BY_EMAIL=a.default.getAsJSON("vk-messenger-chat-id-by-email",{});exports.VK_MESSENGER_CHAT_HREF_BASE=a.default.getAsString("vk-messenger-chat-href-base","https://vk.com/im?sel=-");exports.VK_MESSENGER_RESTORE_ON_REFRESH_DISABLED=a.default.has("vk-messenger-restore-on-refresh-disabled");exports.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY="vk-messenger-active-chat";exports.VK_MESSENGER_AUTH_THROTTLE=a.default.getAsInt("vk-messenger-auth-throttle",1e3);exports.VK_MESSENGER_DISABLE_SILENT_AUTH=a.default.has("vk-messenger-disable-silent-auth");exports.VK_MESSENGER_SHOW_AUTH_NOTIFY=a.default.has("vk-messenger-show-auth-notify");exports.VK_MESSENGER_LOGOUT=a.default.has("vk-messenger-logout");exports.SWA_SUPERAPP_SILENT_URL=a.default.getAsString("swa-superapp-silent-url","https://account.mail.ru/jsapi/vk/superapp/silent");exports.VK_LOGIN_DOMAIN=a.default.getAsString("vk-login-domain","login.vk.com");exports.VK_OAUTH_DOMAIN=a.default.getAsString("vk-oauth-domain","oauth.vk.com");exports.VK_CONNECT_DOMAIN=a.default.getAsString("vk-connect-domain","id.vk.com");exports.VK_MESSENGER_APP_ID=a.default.getAsInt("vk-messenger-app-id",7965175);exports.EXPIRED_ATTACHES_DIE=a.default.has("expired-attaches-die");exports.ATTACH_WARNING_TOOLTIP=a.default.has("attach-warning-tooltip");exports.SENT_PAGE_NOTIFY=a.default.has("sent-page-notify");exports.VK=a.default.has("vk");exports.IS_VK_HOST=a.default.has("is-vk-host");exports.OCTAVIUS_PLACEHOLDERS_PATH=exports.VK?exports.PACKAGES_URL+"/static.promo/octavius/placeholders/vk/":exports.PACKAGES_URL+"/static.promo/octavius/placeholders/mail/";exports.THEME_PREFIX=a.default.getAsString("theme-prefix","");exports.USE_CUSTOM_THEME_PREVIEW_NAME=a.default.has("use-custom-theme-preview-name");exports.VK_THEMES_LIST=a.default.has("vk-themes-list");exports.VK_DOMAIN=a.default.getAsString("vk-domain","vk.com");exports.DISABLE_DOMAIN_AUTHCHECK=a.default.has("disable-domain-authcheck");exports.THEME_SOUZMULTFILM_MARUSIA=a.default.getAsJSON("theme-souzmultfilm-marusia",{});exports.DND_CLOUD_FOLDER_CHOICE=a.default.has("dnd-cloud-folder-choice");exports.DND_IMAGES_PATH=a.default.getAsString("dnd-images-path","static.promo/cross.project.dnd/");exports.RADAR_PROJECT=a.default.getAsString("radar-project","octavius");exports.LIST_ADVERT_ANIMATION=a.default.has("list-advert-animation");exports.EXPIRED_ATTACHES_TOOLTIP=a.default.has("expired-attaches-tooltip");exports.SWBOX_TOKEN_UPDATE_INTERVAL=a.default.getAsInt("swbox-token-update-interval",0);exports.CONTRAST_LOGO_THEMES=a.default.getAsArray("contrast-logo-themes",["t6000"]);exports.PRELOAD_RELEASE_BUNDLES_FILTER=a.default.getAsArray("preload-release-bundles-filter");exports.LAZY_SMOKE_SCREEN_INIT=a.default.getAsBoolean("lazy-smoke-screen-init");exports.RESIZER_DRAG_ICON_SHOWN=a.default.has("resizer-drag-icon-shown");exports.CKE_CLIPBOARD_FIX=a.default.has("cke-clipboard-fix");exports.MARUSIA_READ_ALL_LETTERS=a.default.has("marusia-read-all-letters");exports.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED=a.default.has("cke_autocorrect_afterDeleteContents_disabled");exports.CLEANMASTER_MODAL_ACTIONS_DISABLED=a.default.has("cleanmaster-modal-actions-disabled");exports.MESSAGES_ATTACHES_BLOBCLOUD=a.default.has("messages-attaches-blobcloud");exports.MESSAGES_ATTACHES_BLOBCLOUD_PATH=a.default.getAsString("messages-attaches-blobcloud-path","//blobcloud.e.mail.ru/upload/");exports.COMPOSE_EMOJI=a.default.has("compose-emoji");exports.COMPOSE_EMOJI_RECENTLY_COUNT=a.default.getAsInt("compose-emoji-recently-count",30);exports.EMOJI_FALLBACK=a.default.has("emoji-fallback");exports.SHOW_UNSUBSCRIBE_AFTER_SPAM=a.default.has("show-unsubscribe-after-spam");exports.SHOW_UNSUBSCRIBE_AFTER_MOVE_TO_SPAM=a.default.has("show-unsubscribe-after-move-to-spam");exports.RENDER_COMPOSE_TO_BODY_START=!a.default.has("render-compose-to-body-end");exports.USE_X_CALENDAR=a.default.has("use-x-calendar");exports.QUOTA_GROUP=a.default.getAsArray("quota-adv-exp-ids",["500","501","502","503"]);exports.QUOTA_AD_URL="https://cloud.mail.ru/promo/quota?feature=ad&utm_source=mail_disable_ad&utm_medium=cross-promo&utm_campaign=ed.quota#start";exports.QUOTA_SPACE_URL="https://cloud.mail.ru/promo/quota?feature=space&utm_source=mail_2GB&utm_medium=cross-promo&utm_campaign=ed.quota#start";exports.COMPOSE_EMOJI_FILTER=a.default.has("compose-emoji-filter");exports.RESTORE_EXPIRED_ATTACHMENTS=a.default.has("restore-expired-attachments");exports.RESTORE_EXPIRED_ATTACHMENTS_TIME=a.default.getAsInt("restore-expired-attachments",8e4);exports.METATHREAD_MOVE_TO_SPAN_NOTIFY=a.default.has("metathread-move-to-spam-notify");exports.METATHREAD_MOVE_TO_SPAN_NOTIFY_DURATION=a.default.getAsInt("metathread-move-to-spam-notify-duration",4);exports.HIDE_LOGO=a.default.has("hide-logo");exports.USE_SINGLE_TAB=a.default.has("use-single-tab");exports.USE_SINGLE_TAB_WHITELIST_REGEXP=a.default.getAsRegExp("use-single-tab-whitelist-regexp","");exports.USE_SINGLE_TAB_BLACKLIST_REGEXP=a.default.getAsRegExp("use-single-tab-blacklist-regexp","");exports.HIDE_HEADLINE=a.default.has("hide-headline");exports.URL_EXTRA_PARAMS=exports.WEBVIEW?{wv:1,"wv-dark":exports.WEBVIEW_DARK_THEME?1:0}:exports.OCTAVIUS_MOBILE?{mv:1}:null;exports.DISABLE_MARUSIA_IN_PORTAL=a.default.has("disable-marusia-in-portal");exports.SHOW_RELOAD_BUTTON=a.default.has("show-reload-button");exports.SHORTCUT_LEFT_COLUMN_LIMIT=a.default.getAsInt("shortcut-left-column-limit",36);exports.DISABLE_LETTER_HEADERS_BUTTON=a.default.has("disable-letter-headers-button");exports.COMPOSE_ALLOWED_TEMPLATES=a.default.getAsArray("compose_allowed_templates",[]);exports.COMPOSE_TEMPLATES_SUBJECTS=a.default.getAsJSON("compose_templates_subjects",{});exports.COMPOSE_TEMPLATES_URL=a.default.getAsString("compose_templates_url","https://e-mail-ru.mrgcdn.ru/static/cards/");exports.DEFAULT_AVATAR_SRC=b.default.get("urls.avatarUrl")+"/pic?width=90&height=90";exports.DISABLE_ATTACHES_OPENING=a.default.has("disable-attaches-opening");exports.NOADS_BUTTON_SHOW_FORCE=a.default.has("noads-button-show-force");exports.NOADS_BUTTON_SHOW_EXP=a.default.has("noads-button-show-exp");exports.ENABLE_SORTING=a.default.has("enable-sorting");exports.ENABLE_MULTIPLE_FILTERS=a.default.has("enable-multiple-filters");exports.FORCE_PARENTAL_CONTROL_DIE=a.default.has("force-parental-control-die");exports.TRASH_FOLDER_ID=a.default.getAsInt("trash-folder-id",500002);exports.DISABLE_DELETE_FROM_TRASH=a.default.has("disable-delete-from-trash");exports.FORBID_FILTERS=a.default.has("forbid-filters");exports.FORBID_SPAM=a.default.has("forbid-spam");exports.FORBID_EXCLUDED_FOLDERS_SEARCH=a.default.has("forbid-excluded-folders-search");exports.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS=a.default.getAsArray("parental-control-private-folder-ids",[]);exports.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID=a.default.getAsString("nav-parent-private-folders-container-id","parentPrivateFoldersContainer");exports.PARENTAL_CONTROL_DENY_FOLDER_ID=a.default.getAsInt("parental-control-deny-folder-id",950);exports.PARENTAL_CONTROL_APPROVE_FOLDER_ID=a.default.getAsInt("parental-control-approve-folder-id",0);exports.PROMT_LOGO_HREF=a.default.getAsURL("promt-logo-href","https://www.translate.ru/?utm_source=mail.ru&utm_medium=link&utm_campaign=brand");exports.POLLING_ONLY_VISIBLE=a.default.has("polling_only_visible");exports.LAST_SEEN_V2_ENABLE=a.default.has("lastseen-v2");exports.LETTER_LASTSEEN_REQUEST=exports.LAST_SEEN_V2_ENABLE&&a.default.has("lastseen-letter-request");exports.LASTSEEN_DISABLE_PLATFORM=a.default.has("lastseen-platform-disable");exports.LASTSEEN_ONLINE_STATUS=a.default.getAsString("lastseen-online-status","ONLINE");exports.LASTSEEN_SHOW_TIME_STATUS=a.default.getAsString("lastseen-show-time-status","OFFLINE");exports.LASTSEEN_COMPOSE_ALLOW_GARAGE=a.default.has("lastseen-compose-allow-garage");exports.DISABLE_LEFT_COLUMN=a.default.has("disable-left-column");exports.ENABLE_XXS_BREAKPOINT=a.default.has("enable-xxs-breakpoint");exports.XXS_BREAKPOINT=a.default.getAsInt("xxs-breakpoint",760);exports.DISABLE_DROPDOWN_ACTIONS_SHORTCUTS=a.default.has("disable-dropdown-actions-shortcuts");exports.HIDE_NOTIFY_CLOSE_BUTTON=a.default.has("hide-notify-close-button");exports.HIDE_COMPOSE_CANCEL_BUTTON=a.default.has("hide-compose-cancel-button");exports.HIDE_COMPOSE_WIDGETS=a.default.has("hide-compose-widgets");exports.COMPOSE_FOOTER_DROPDOWN=a.default.has("compose-footer-dropdown");exports.COMPOSE_HIDE_AVATAR=a.default.has("compose-hide-avatar");exports.COMPOSE_DISABLE_CLICKABLE_LABELS=a.default.has("compose-disable-clickable-labels");exports.COMPOSE_DISABLE_TOOLBAR=a.default.has("compose-disable-toolbar");exports.COMPOSE_SHORT_ATTACH_PANEL=a.default.has("compose-short-attach-panel");exports.HIDE_CONTEXTMENU_ADD_CONTACT_BUTTON=a.default.has("hide-contextmenu-add-contact-button");exports.HIDE_CONTEXTMENU_SEARCH_BUTTON=a.default.has("hide-contextmenu-search-button");exports.HIDE_SETTINGS_BUTTON=a.default.has("hide-settings-button");exports.HIDE_CHANGE_SIGNATURE=a.default.has("hide-change-signature");exports.DISABLE_COMPOSE_ATTACHMENT_CLICK=a.default.has("disable-compose-attachment-click");exports.MOBILE_ADDRESSBOOK_URL=a.default.getAsString("mobile-addressbook-url",exports.WIDGET_ADDRESSBOOK_URL);exports.ADDRESSBOOK_ICO=a.default.getAsString("addressbook-ico","");exports.COMPOSE_FETCH_AUTOREPLY=a.default.has("compose-fetch-autoreply");exports.SHOW_RELIABLE_SENDER_PROMO=a.default.has("show-reliable-sender-promo");exports.SHOW_RELIABLE_ON_LETTER_LIST=a.default.has("show-reliable-on-list-letters");exports.DISABLE_GREEN_RELIABLE_ON_LETTER_LIST=a.default.has("disable-green-reliable-on-letter-list");exports.SHOW_OFFICIAL_SENDER_PROMO=a.default.has("show-official-sender-promo");exports.SHOW_OFFICIAL_ON_LETTER_LIST=a.default.has("show-official-on-list-letters");exports.DISABLE_GREEN_OFFICIAL_ON_LETTER_LIST=a.default.has("disable-green-official-on-letter-list");exports.DARK_MODE_ROLLBACK_ON_COPY=a.default.has("dark_mode-rollback_on_copy");exports.DISABLE_AUTOMATED_TRANSLATE=a.default.has("disable-automated-translate");exports.AUTOMATED_SHOW_TRANSLATOR=a.default.has("automated-show-translator");exports.CSAT_DISABLED=a.default.has("csat_disabled");exports.CSAT_POLL_ID=a.default.getAsString("csat_poll_id","");exports.CSAT_DAILY_PERMILLE=a.default.getAsInt("csat_daily_permille",3);exports.CSAT_DRY_RUN=a.default.has("csat_dry_run");exports.CSAT_DOMAIN=a.default.getAsString("csat_domain","");exports.CSAT_REPEAT_INTERVAL=a.default.getAsInt("csat_repeat_interval",180);exports.HIDE_MESSAGE_FOOTER=a.default.has("hide-message-footer");exports.HIDE_MESSAGE_SMART_REPLY=a.default.has("hide-message-smart-reply");exports.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH=a.default.has("hide-message-smart-reply-by-only-width");exports.USE_WEBPACK_BUILD=a.default.getAsBoolean("use-webpack-build");exports.HIDE_WEBVIEW_TITLE=a.default.has("hide-webview-title");exports.HIDE_DISABLE_TO_MYSELF_METATHREAD=a.default.has("hide-disable-to-myself-metathread");exports.THREAD_SWITCH_RACE_FIX=a.default.has("thread-switch-race-fix");exports.ATTACH_ANALYTICS_EXT_DISABLED=a.default.has("attach-analytics-ext-disabled");exports.ENABLE_LIST_LETTER_ACTION_BUTTONS=a.default.has("enable-list-letter-action-buttons");exports.HIDE_OFFICIAL_METATHREAD=a.default.has("hide_official_metathread");exports.HIDE_SCHOOL_METATHREAD=a.default.has("hide-school-metathread");exports.HIDE_GAMES_METATHREAD=a.default.has("hide-games-metathread");exports.CKE_QUOTE_PARSE_FIX_DISABLE=a.default.has("cke-quote-parse-fix-disable");exports.ENABLE_OFFICIAL_LETTERS=a.default.has("enable-official-letters");exports.USE_NEW_SEARCH_CATEGORY_FORMAT=exports.ENABLE_OFFICIAL_LETTERS||a.default.has("use-new-search-category-format");exports.SEARCH_CATEGORIES=["document_scans","order","finance","registration","travel","event",exports.ENABLE_OFFICIAL_LETTERS?"official":"fees"].filter(function(b){return!a.default.has("disable-"+b)});exports.UNSUBSCRIBE_INSTEAD_SPAM=a.default.has("unsubscribe-instead-spam");exports.UNSUBSCRIBE_IN_MORE_DROPDOWN=a.default.has("unsubscribe-in-more-dropdown");exports.R7_VIEW_ENABLED=a.default.has("r7-cloud-view");exports.R7_EXTENSIONS_FORMATS=a.default.getAsArray("r7-extensions",["doc","docm","docx","dot","dotm","dotx","epub","fodt","htm","html","mht","odt","ott","rtf","djvu","xps","csv","fods","ods","ots","xls","xlsm","xlsx","xlt","xltm","xltx","fodp","odp","otp","pot","potm","potx","pps","ppsm","ppsx","ppt","pptm","pptx"]);exports.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED=a.default.has("settings_dock_browsersettings_enabled")&&(a.default.has("browser-settings-mailto")||a.default.has("browser-settings-notifications-push")||a.default.has("browser-settings-notifications-web"));exports.SHOW_CATEGORY_FEEDBACK_PLATE=a.default.has("show-category-feedback-plate");exports.ATTACHES_ID_REG_EXPS=a.default.getAsJSON("viewer-attaches-id-reg-exps",{});exports.MESSAGES_ID_REG_EXP=a.default.getAsJSON("viewer-message-id-reg-exps",{});exports.VIEW_URL_IDS_VALIDATE_DISABLE=a.default.has("view-url-ids-validate-disable");exports.METATHREAD_REDIRECT=a.default.has("metathread_redirect");exports.HIDE_EMOJI_IN_SUBJECT=a.default.has("hide-emoji-in-subject");exports.HIDE_EMOJI_IN_CORRESPONDENT=a.default.has("hide-emoji-in-correspondent");exports.HIDE_EMOJI_IN_SNIPPET=a.default.has("hide-emoji-in-snippet");exports.FOLDERS_SORT_VARIATION=a.default.getAsString("folders_sort_variation");exports.SEARCH_SUGGESTS_DELAY=a.default.has("search-suggests-delay");exports.SEARCH_SUGGESTS_DELAY_TIME=a.default.getAsInt("search-suggests-delay-time",500);exports.METATHREAD_BACK_TO_INBOX=a.default.has("metathread-back-to-inbox");exports.BACK_TO_PARENT_POS=a.default.getAsArray("back-to-parent-pos",[]);exports.BACK_TO_PARENT_AT_LOGO=exports.BACK_TO_PARENT_POS.includes("logo");exports.BACK_TO_PARENT_AT_LETTERS=exports.BACK_TO_PARENT_POS.includes("letters");exports.BACK_TO_PARENT_SHORTCUT=a.default.has("back-to-parent-shortcut");exports.PORTAL_MENU_MORE_FOLDER_ACTIONS=a.default.has("portal-menu-more-folder-actions");exports.PORTAL_MENU_CLEAR_METATHREAD=a.default.has("portal-menu-clear-metathread");exports.DESELECT_ALL_LABEL_STYLE=a.default.getAsString("deselect-all-label-style","back");exports.BACK_TO_PARENT_AT_EMPTY_LETTERS=a.default.has("back-to-parent-at-empty-letters");exports.GO_TO_ACTION_BUTTOM=a.default.has("go-to-action-button");exports.ENABLE_MENTIONS=a.default.has("enable-mentions");exports.B2B_INNER_ATTACHMENTS_NOTIFY=a.default.has("b2b-inner-attachments-notify");exports.SMART_CARD_ICS=a.default.has("smart-card-ics");exports.HIDE_RECEIPTS_METATHREAD=a.default.has("hide-receipts-metathread");exports.WIDGET_ICONS_VARIANT=a.default.getAsString("widget-icons-variant","");exports.FAKE_CREATE_TODO=a.default.has("fake-create-todo");exports.SHOW_PROMO_PUSH_PLATE=a.default.has("show-promo-push-plate");exports.ENABLE_HIDE_TRANSLATOR=a.default.has("enable-hide-translator");exports.SEARCH_PANEL_REACT=a.default.has("new-toolbar");exports.SEARCH_PANEL_PORTAL=a.default.has("new-toolbar");exports.NEW_TOOLBAR=a.default.has("new-toolbar");exports.SEARCH_PANEL_SIZE=a.default.getAsInt("search-panel-size",336);exports.CUSTOM_THEMES_PREVIEWS_PATHS=a.default.getAsJSON("custom-themes-previews-paths")||{}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/lazy",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.uniqCallback=exports.lazyInit=exports.createAppBundlePreloader=exports.executeAllLazyAfterReadyTask=exports.addLazyAfterReadyTask=void 0;a=__importDefault(a);var b=[];function c(a){b.push(a)}exports.addLazyAfterReadyTask=c;function d(a){var c=requestAnimationFrame;c(function d(){var e=b.shift();if(e){e(a);c(d)}})}exports.executeAllLazyAfterReadyTask=d;function e(b){var c=b.jsMap,d=b.staticHost,e=b.filter;var f=Object.assign({},c===null||c===void 0?void 0:c.paths);return function(b){var c=b.jsMap;Object.entries((c===null||c===void 0?void 0:c.paths)||{}).forEach(function(b){var c=b[0],g=b[1];if(!Array.isArray(e)||!(e.includes("ALL")||e.includes(c))){return}var h={};var i=false;if(f[c]!==g){var j=document.createElement("link");j.as="script";j.rel="preload";j.crossOrigin="anonymous";j.href=""+d+g+".js";document.head.appendChild(j);f[c]=g;i=true;h[c]=1}if(i){a.default.send("app-bdl-preload",{i:h})}})}}exports.createAppBundlePreloader=e;function f(a){var b=null;return function(){if(b===null){b=a()}return b}}exports.lazyInit=f;var g=new WeakMap;var h=new WeakMap;function i(a,b){g.set(a,b);if(!h.has(a)){h.set(a,function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}return g.get(a).apply(void 0,b)})}return h.get(a)}exports.uniqCallback=i});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("lazy.modules",["require","exports","./helpers/lazy"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lazyUIThemesWidget=exports.lazyUIWidgetCalendar=exports.lazyUIThemesWidgetWeather=exports.lazyUIThemesWidgetWarface=exports.lazyUIThemesWidgetStarWars=exports.lazyUIThemesWidgetSpartakFC=exports.lazyUIThemesWidgetSouzmultfilm=exports.lazyUIThemesWidgetSerenity=exports.lazyUIThemesWidgetRickMorty=exports.lazyUIThemesWidgetOlympiad2021=exports.lazyUIThemesWidgetNewYear=exports.lazyUIThemesWidgetLostArk=exports.lazyUIThemesWidgetLetter=exports.lazyUIThemesWidgetItem=exports.lazyUIThemesWidgetIIHF=exports.lazyUIThemesWidgetHoroscope=exports.lazyUIThemesWidgetFootball=exports.lazyUIThemesWidgetEuro2020=exports.lazyUIThemesWidgetEpicenter=exports.lazyUIThemesWidgetCloudyRemake=exports.lazyUIThemesWidgetCloudy=exports.lazyUIThemesWidgetVK=exports.lazyUIThemesWidgetOK=exports.lazyUILayerMetathreadsSettings=exports.lazyUILayerConfirmDeleteFolder=exports.lazyUILayerCreateFolder=exports.lazyUILayerEditSettingsFilter=exports.lazyUILayerCleanmasterModal=exports.lazyUILayerSentPage=exports.lazyUIUnsubscribe=exports.lazyUIGallery=exports.lazyUILetter=exports.lazyUIComposeWindows=exports.lazyUIComposeApp=exports.lazyUIDragAndDrop=exports.lazyHelpersVisibilityWatcher=exports.lazyHelpersLogger=exports.lazyMediatorWelcomeBlockManager=exports.lazyMediatorSettingsManager=exports.lazyMediatorMarusiaManager=exports.lazyMediatorTodoManager=exports.lazyMediatorCallsManager=exports.lazyMediatorCalendarManager=exports.lazyMediatorComposeManager=exports.lazyMediatorPageTitle=exports.lazyServiceDarkosha=exports.lazyTemporaryFixSignature=exports.lazyMailReleaseDetect=exports.lazyMailKeymaster=exports.lazyMailAmpViewer=exports.lazyHammerJS=exports.lazyMailTextAnalyzer=exports.lazyClipboard=exports.lazyFileAPI=exports.lazyDomPurify=exports.uniqCallback=void 0;Object.defineProperty(exports,"uniqCallback",{enumerable:true,get:function(){return a.uniqCallback}});function b(a){return a.default}exports.lazyDomPurify=a.lazyInit(function(){return new Promise(function(a,b){require(["dompurify"],a,b)}).then(__importStar).then(function(a){var b=a.default;return b()})});exports.lazyFileAPI=a.lazyInit(function(){return new Promise(function(a,b){require(["FileAPI"],a,b)}).then(__importStar)});exports.lazyClipboard=a.lazyInit(function(){return new Promise(function(a,b){require(["clipboard"],a,b)}).then(__importStar).then(function(a){return a.default})});exports.lazyMailTextAnalyzer=a.lazyInit(function(){return new Promise(function(a,b){require(["@mail/text-analyzer"],a,b)}).then(__importStar)});exports.lazyHammerJS=a.lazyInit(function(){return new Promise(function(a,b){require(["hammerjs"],a,b)}).then(__importStar)});exports.lazyMailAmpViewer=a.lazyInit(function(){return new Promise(function(a,b){require(["@mail/amp-viewer"],a,b)}).then(__importStar)});exports.lazyMailKeymaster=a.lazyInit(function(){return new Promise(function(a,b){require(["@mail/keymaster"],a,b)}).then(__importStar).then(function(){return window.key})});exports.lazyMailReleaseDetect=a.lazyInit(function(){return new Promise(function(a,b){require(["@mail/release-detect"],a,b)}).then(__importStar)});exports.lazyTemporaryFixSignature=a.lazyInit(function(){return new Promise(function(a,b){require(["temporary/fix-signature"],a,b)}).then(__importStar)});exports.lazyServiceDarkosha=a.lazyInit(function(){return new Promise(function(a,b){require(["service/darkosha"],a,b)}).then(__importStar)});exports.lazyMediatorPageTitle=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/page-title"],a,b)}).then(__importStar)});exports.lazyMediatorComposeManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/compose-manager"],a,b)}).then(__importStar)});exports.lazyMediatorCalendarManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/calendar-manager"],a,b)}).then(__importStar)});exports.lazyMediatorCallsManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/calls-manager"],a,b)}).then(__importStar)});exports.lazyMediatorTodoManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/todo-manager/todo-manager"],a,b)}).then(__importStar)});exports.lazyMediatorMarusiaManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/marusia-manager"],a,b)}).then(__importStar)});exports.lazyMediatorSettingsManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/settings-manager"],a,b)}).then(__importStar).then(b)});exports.lazyMediatorWelcomeBlockManager=a.lazyInit(function(){return new Promise(function(a,b){require(["mediator/welcome-block-manager"],a,b)}).then(__importStar)});exports.lazyHelpersLogger=a.lazyInit(function(){return new Promise(function(a,b){require(["helpers/logger"],a,b)}).then(__importStar)});exports.lazyHelpersVisibilityWatcher=a.lazyInit(function(){return new Promise(function(a,b){require(["helpers/visibility-watcher"],a,b)}).then(__importStar)});exports.lazyUIDragAndDrop=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/drag-and-drop/drag-and-drop"],a,b)}).then(__importStar).then(b)});exports.lazyUIComposeApp=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/compose-app/compose-app"],a,b)}).then(__importStar).then(b)});exports.lazyUIComposeWindows=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/compose-windows/compose-windows"],a,b)}).then(__importStar).then(b)});exports.lazyUILetter=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/letter/letter"],a,b)}).then(__importStar).then(b)});exports.lazyUIGallery=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/gallery/gallery"],a,b)}).then(__importStar).then(b)});exports.lazyUIUnsubscribe=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/unsubscribe/unsubscribe"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerSentPage=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/layer-sent-page/layer-sent-page"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerCleanmasterModal=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerEditSettingsFilter=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/layer-edit-settings-filter/layer-edit-settings-filter"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerCreateFolder=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/layer-create-folder/layer-create-folder"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerConfirmDeleteFolder=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerMetathreadsSettings=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/layer-metathreads-settings/layer-metathreads-settings"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetOK=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-ok/themes-widget-ok"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetVK=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-vk/themes-widget-vk"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetCloudy=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-cloudy/themes-widget-cloudy"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetCloudyRemake=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-cloudy-remake/themes-widget-cloudy-remake"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetEpicenter=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-epicenter/themes-widget-epicenter"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetEuro2020=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-euro-2020/themes-widget-euro-2020"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetFootball=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-football/themes-widget-football"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetHoroscope=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-horoscope/themes-widget-horoscope"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetIIHF=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-iihf/themes-widget-iihf"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetItem=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-item/themes-widget-item"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetLetter=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-letter/themes-widget-letter"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetLostArk=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-lost-ark/themes-widget-lost-ark"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetNewYear=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-new-year/themes-widget-new-year"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetOlympiad2021=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-olympiad-2021/themes-widget-olympiad-2021"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetRickMorty=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-rick-morty/themes-widget-rick-morty"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetSerenity=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-serenity/themes-widget-serenity"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetSouzmultfilm=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-souzmultfilm/themes-widget-souzmultfilm"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetSpartakFC=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-spartak-fc/themes-widget-spartak-fc"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetStarWars=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-star-wars/themes-widget-star-wars"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetWarface=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-warface/themes-widget-warface"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetWeather=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-weather/themes-widget-weather"],a,b)}).then(__importStar).then(b)});exports.lazyUIWidgetCalendar=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/widget-calendar/widget-calendar"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidget=a.lazyInit(function(){return new Promise(function(a,b){require(["ui-block/themes-widget/themes-widget"],a,b)}).then(__importStar).then(b)})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-omicron-segment",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getOmicronSegment=void 0;a=__importDefault(a);function b(){try{return a.default.getConfig().o_ss}catch(a){return""}}exports.getOmicronSegment=b});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/swBox",["require","exports","@mail/sw-box","@mail/xray","cfgUser","default-values","helpers/get-omicron-segment","RPC","service/auth"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isSWBoxEnabled=exports.getFirebaseConfig=void 0;b=__importDefault(b);c=__importDefault(c);f=__importStar(f);g=__importDefault(g);function h(){return{template:"default",defaultTitle:i18n("Почта Mail.ru"),defaultBody:i18n("Вам пришло новое письмо"),defaultIcon:"https://img.imgsmail.ru/r/default/ico/icon-192.png",emptySubjectText:i18n("Без темы")}}function i(a){return{title:"${config.defaultTitle}",titlePlural:[i18n("{count} новых писем",{count:"{count}"}),i18n("{count} новое письмо",{count:"{count}"}),i18n("{count} новых письма",{count:"{count}"})],icon:"${config.defaultIcon}",tag:"mail.notification.${email}",description:"${config.defaultBody}",body:"${config.defaultBody}",defaultAction:{action:"octavius.open",url:a}}}function j(a){return{title:"${fetchedData.title}",titlePlural:[i18n("{count} новых писем",{count:"{count}"}),i18n("{count} новое письмо",{count:"{count}"}),i18n("{count} новых письма",{count:"{count}"})],icon:"${fetchedData.icon}",tag:"mail.notification.${email}",description:"${fetchedData.description}",body:"${fetchedData.body}",actions:[{action:"mailapi.message.markRead",title:i18n("Прочитано"),url:a+"/${fetchedData.folderId}/${fetchedData.threadId}/?x-email=${email_encoded}"},{action:"mailapi.message.remove",title:i18n("Удалить"),url:a+"/${fetchedData.folderId}/${fetchedData.threadId}/?x-email=${email_encoded}"}],defaultAction:{action:"message.open",url:a+"/${fetchedData.folderId}/${fetchedData.threadId}/?x-email=${email_encoded}"}}}function k(){return{api:{mode:a.PushAPIMode.Firebase,apiKey:"AIzaSyCXIiICr-x1z94Uw-0nk0qyFkQHcFjk7X0",authDomain:"fluorcorpmailru.firebaseapp.com",databaseURL:"https://fluorcorpmailru.firebaseio.com",projectId:"fluorcorpmailru",storageBucket:"fluorcorpmailru.appspot.com",messagingSenderId:"61247752867",appId:"1:61247752867:web:f3f93e07c1c8e47fb84d16",vapidKey:"BNplt3Du3_Pmt1EEEWG6ly2NA_agH5GSTx5k4ySgmye-Qt9HohZJ8FS7Otk2LumQuZ3VVLXnNxbDsruQFwsFbCo"},applicationName:"mail_octavius",clientName:"ru.mail.e",locale:c.default.LANG,platform:"webpush"}}exports.getFirebaseConfig=k;var l="firebase-v1";function m(){return(d.SWBOX||a.hasServiceWorkerTag(l))&&a.SWBoxImpl.isSupported()}exports.isSWBoxEnabled=m;function n(c){var l=g.default.user.getEmail();var n="https://"+location.host;var o=a.createServiceWorker(l);var p=function(){var a=h();var b=i(n);var c=j(n);var g=k();o.config({project:"octavius",logSilentErrors:d.SWBOX_LOG_SILENT_ERRORS,analyticsRequest:d.SWBOX_ANALYTICS_REQUEST,tokenUpdateInterval:d.SWBOX_TOKEN_UPDATE_INTERVAL,rpc:{enabled:true,config:{urls:{project:n,token:f.setup("baseUrl")+"v1/tokens",sdc:f.setup("sdcUrl")}}},xray:{defaultParams:{p:"octavius"},o_ss:e.getOmicronSegment()},pushHandler:{enabled:true,config:g,templates:{default:b,mail:c},pushes:{default:a,mail:__assign(__assign({},a),{template:"mail",dataFetcher:"mailMessageData"}),promo:{}}}})};if(!m()){return o}o.register().then(function(){p();if(!o.pushManager){return}o.pushManager.on("message.open",function(a){c.go("#read-letter",{folder:a.fetchedData.folderId,letter:a.fetchedData.threadId,id:a.fetchedData.messageId})})}).catch(function(a){if(typeof a==="string"&&a==="The operation is insecure."){b.default.send("push_security_error",{i:"octavius"})}});return o}var o;exports.default={fetch:function(a){o=o!==null&&o!==void 0?o:n(a.router);return Promise.resolve(m()?o:undefined)},getInstance:function(){return o}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("push-metrics.setup",["require","exports","@mail/sw-box","@mail/xray","data-source/source/swBox"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pushMetricsSetup=void 0;b=__importDefault(b);function d(){var d,e;var f=(e=(d=window.navigator)===null||d===void 0?void 0:d.serviceWorker)===null||e===void 0?void 0:e.ready;if(!f){b.default.send("webpush_serviceworker_absence");return}f.then(function(a){var b;return(b=a===null||a===void 0?void 0:a.pushManager)===null||b===void 0?void 0:b.getSubscription()}).then(function(b){if(!b){return"none"}return a.describeSubscription(b).then(function(a){if(a.applicationServerKey===c.getFirebaseConfig().api.vapidKey){return"swbox"}else{return"pushmanager"}})}).catch(function(){return"none"}).then(function(a){var c;var d=((c=window.Notification)===null||c===void 0?void 0:c.permission)||"error";b.default.send("webpush",{dwh:{push_type:a,push_permission:d}})})}exports.pushMetricsSetup=d});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/calls",["require","exports","@mail/calls-api","@mail/flags","@mail/xray","cfgUser","default-values","Emitter"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CallsService=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);var g;var h=null;var i=function(f){__extends(i,f);function i(){return f!==null&&f.apply(this,arguments)||this}i.prototype.loadTools=function(){!g&&(g=new Promise(function(a){window.require(["@mail/oauth"],function(b){b.init({clientId:"b4c073bb6c5a4b1b84d2c7d2a1bceb9b",scopes:["calls.api"]});a({oauth:b})})}));return g};i.prototype.createRoom=function(){var a=this;return new Promise(function(d,f){if(typeof window.fetch!=="function"){c.default.send("calls_create_error_fetch-unsupported");f("fetch-unsupported")}var g=setTimeout(function(){c.default.send("calls_create_error_timeout");f("timeout")},e.CALLS_CREATE_ROOM_TIMEOUT);a.loadTools().then(function(a){var h=a.oauth;h.auth(function(a){var i=a.status,j=a.access_token;if(i!==h.AUTH_CONNECTED){c.default.send("calls_create_error_oauth",{rlog:"calls_error_oauth",rlog_message:JSON.stringify(i)});f("oauth")}fetch(e.CALLS_CREATE_ROOM_URL,{method:"POST",headers:{Authorization:"Bearer "+j}}).then(function(a){clearTimeout(g);if(a.ok){a.json().then(function(a){if(!a.url){c.default.send("calls_create_error_invalid-body");f("invalid-body")}c.default.send("calls_create_success");d(a.url);var e=b.default.get("used-calls");if(!(e&&e.state)){e===null||e===void 0?void 0:e.save({state:true,time:true})}})}else if(a.status===429){c.default.send("calls_create_error_ratelimit");f("ratelimit")}else{c.default.send("calls_create_error_api_"+a.status);f("api")}}).catch(function(a){clearTimeout(g);c.default.send("calls_create_error_network",{rlog:"calls_error_api",rlog_message:JSON.stringify(a)});f("network")})})}).catch(function(a){c.default.send("calls_create_error_load",{rlog:"calls_error",rlog_message:JSON.stringify(a)});f("load")})})};i.prototype.getTemplate=function(a){var b=i18n("Перейдите по ссылке, чтобы подключиться к звонку:");return b+' <a href="'+a+'" data-call-url="'+a+'">'+a+"</a><br/>\x3c!--focus--\x3e"};i.prototype.getPlannedTime=function(a){var b=(a||new Date).getHours();var c=(a||new Date).getMinutes()>49?2:1;var d=(b+c)%24;return(d<10?"0":"")+d+":00"};i.prototype.getSubject=function(){return i18n("Приглашение на звонок")};i.prototype.getCallsAPIClient=function(){var b=this;if(!h){h=a.createCallsAPIClient({callBaseUrl:e.CALLS_BASE_URL,email:d.default.initialUser.email,incomingCalls:e.CALLS_P2P,xraySend:c.default.send.bind(c.default),onShow:function(a){return b.emit("update",__assign({action:"start"},a))},onHide:function(){return b.emit("update",{action:"end"})}})}return h};return i}(f.default);exports.CallsService=i;exports.default=new i});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/after-ready",["require","exports","default-values","temporary/force-3pane-exp","../lazy.modules","../push-metrics.setup","../service/calls"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initAfterReady=void 0;e=__importDefault(e);var f=function(f){Promise.all([c.lazyMailKeymaster(),c.lazyHelpersLogger()]).then(function(a){var b=a[0],c=a[1];b("ctrl+alt+l",c.sendLogs)});c.lazyUIDragAndDrop().then(function(a){new a({router:f}).renderTo(document.getElementById("drag-and-drop"))});if(!a.WEBPUSH_METRIC_DISABLE){d.pushMetricsSetup()}e.default.getCallsAPIClient();c.lazyTemporaryFixSignature().then(function(a){a.fixSignature()});b.perform()};exports.initAfterReady=f});define("feast-tpl!app/feast-tpl!ui-block/headline/headline.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="hidden" test="!attrs.enabled || !attrs.visible"/>\n</div>\n',"app/feast-tpl!ui-block/headline/headline.html")});define("feast-tpl!ui-block/headline/headline.html",["feast-tpl!app/feast-tpl!ui-block/headline/headline.html"],function(a){return a});define("helpers/dom-utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.insertHTML=exports.getPreviousSibling=exports.getNextSibling=exports.parentsUntil=void 0;function a(a,b,c){var d=[];var e=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a=a.parentElement;while(a&&!e.call(a,b)){if(!c){d.push(a)}else if(e.call(a,c)){d.push(a)}a=a.parentElement}return d}exports.parentsUntil=a;function b(a,b){var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;var d=a.nextElementSibling;if(!b){return d}while(d){if(c.call(d,b)){return d}d=d.nextElementSibling}}exports.getNextSibling=b;function c(a,b){var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;var d=a.previousElementSibling;if(!b){return d}while(d){if(c.call(d,b)){return d}d=d.previousElementSibling}}exports.getPreviousSibling=c;function d(a,b){a.innerHTML=b;var c=a.querySelectorAll("script");for(var d=0;d<c.length;d++){var e=c[d];var f=document.createElement("SCRIPT");if(e.innerText.length){f.appendChild(document.createTextNode(e.innerText))}for(var g=0;g<e.attributes.length;g++){var h=e.attributes[g];f.setAttribute(h.name,h.value)}if(e.parentNode){e.parentNode.replaceChild(f,e)}}}exports.insertHTML=d});define("helpers/parse",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseStringToBoolean=b;var a={false:false,true:true,0:false,1:true};function b(b){return a[b]}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/encryptor",["require","exports","@mail/xray","default-values","request","utils/util"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var e="^(("+window.location.protocol+")?//"+window.location.host+")?/";var f=new RegExp(e+"api-proxy");var g=new RegExp(e+"api/v1(.*)$");var h=new RegExp(e+"api/v1/(messages/attaches/add|user/signature/attaches/add|ab/import)");var i=b.API_ENCRYPTOR_CONFIG[0],j=b.API_ENCRYPTOR_CONFIG[1],k=b.API_ENCRYPTOR_CONFIG[2];var l={endpoint:"/api/v1",type:i,key:k,limit:j,getUrl:function(a){if(a.match(g)&&!a.match(h)){return g.exec(a)[3]}if(a.match(f)){return a}}};function m(a,b){if(a.length<b){return a}}function n(a,c){var e=c.settings;var f=a.getUrl(e.url);if(f){var g=e.params||e.data;if(!g||typeof g==="string"||d.default.isPlainObject(g)){var h=void 0;var i=f.indexOf("/api-proxy/rb-mimic/v1/")===0?b.API_ENCRYPTOR_MIMIC_LIMIT:j;if(g){f+=f.includes("?")?"&":"?";if(typeof g==="string"){h=m(d.default.param({__urlp:f+g}),i)}else{h=m(f+d.default.param(g),i);if(h){h={__urlp:h}}}}else{h=m(d.default.param({__urlp:f}),i)}if(h){e.url=a.endpoint;e.method="POST";e.type="POST";e.data=h;delete e.params;if(e.headers){e.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"}}}}}var o={encryptorOptions:l,enable:function(){c.default.on("start",function(a,b){b.on("beforesend",function(a){n(l,{settings:a})})});if(b.ENABLE_XRAY_ENCRYPTOR){a.default.setConfig({beforeSend:function(a,b){n(l,{settings:b});return true}})}},initXHR:function(a,b){return n(a,b)}};exports.default=o});define("service/adv/locator",["exports","@mail/smokescreen","cfgUser","default-values"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.locator=undefined;var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}var g=exports.locator=new d.default({match:c.SMOKESCREEN_LOCATORS,styleSheetsOptions:{stylesAlwaysInHead:true,substituteRelative:true,justOneSelectorArr:e.default.oneSelectorRules}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/storage",["require","exports","@mail/xray","cfgUser"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createSessionStorage=exports.createScopeStorage=void 0;a=__importDefault(a);b=__importDefault(b);var c=function(a,c){if(c===void 0){c=true}return c?(b.default.get("initialUser.email")||"")+":"+a:a};var d=function(){function b(c){if(c===void 0){c="localStorage"}if(c===b.LOCAL_STORAGE){try{this.storage=window.localStorage}catch(b){a.default.send("localstorage_access_error",{rlog:"octavius_app_jserror",rlog_message:JSON.stringify(b)});this.storage={}}}else if(c===b.SESSION_STORAGE){try{this.storage=window.sessionStorage}catch(b){a.default.send("sessionstorage_access_error",{rlog:"octavius_app_jserror",rlog_message:JSON.stringify(b)});this.storage={}}}else{this.storage={}}}Object.defineProperty(b,"LOCAL_STORAGE",{get:function(){return"LOCAL_STORAGE"},enumerable:false,configurable:true});Object.defineProperty(b,"SCOPE_STORAGE",{get:function(){return"SCOPE_STORAGE"},enumerable:false,configurable:true});Object.defineProperty(b,"SESSION_STORAGE",{get:function(){return"SESSION_STORAGE"},enumerable:false,configurable:true});b.prototype.set=function(a,b,d){if(d===void 0){d={}}var e=c(a,d.email);try{this.storage[e]=JSON.stringify(b)}catch(a){}};b.prototype.get=function(a,b){if(b===void 0){b={}}var d=c(a,b.email);try{return JSON.parse(this.storage[d])}catch(a){return null}};return b}();exports.default=new d(d.LOCAL_STORAGE);function e(){return new d(d.SCOPE_STORAGE)}exports.createScopeStorage=e;function f(){return new d(d.SESSION_STORAGE)}exports.createSessionStorage=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/actions",["require","exports","pilotjs"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.HIDE_UNSUBSCRIBE_SENDER=exports.COUNT_UNSUBSCRIBE_VIEW=exports.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST=exports.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE=exports.UPDATE_LAYOUT_SUPPORT_TODO=exports.TOGGLE_TODO=exports.TOGGLE_PAGINATOR=exports.TOGGLE_TO_MYSELF_METATHREAD=exports.HIDE_PAYMENT_DIE=exports.LOAD_PAGE=exports.THREAD_LOAD_MORE=exports.UPDATE_LAYOUT_SUPPORT_3_PANE=exports.TOGGLE_FOLDER_SHORTCUTS=exports.TOGGLE_COMPOSE_EXTEND_MODE=exports.ENABLE_ACTUAL_MESSAGES=exports.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS=exports.TOGGLE_ACTUAL_MESSAGES_IN_INBOX=exports.TOGGLE_PONY_MODE=exports.UPDATE_LAYOUT_TYPE=exports.UPDATE_SEARCH=exports.TOGGLE_DISCOUNTS=exports.TOGGLE_THREADS_SETTING=exports.TOGGLE_METATHREADS_SETTINGS=exports.EDIT_METATHREADS_SETTINGS=exports.CHANGE_METATHREADS_SETTING=exports.TOGGLE_METATHREADS_SETTING=exports.LOAD_MORE_METATHREAD=exports.TOGGLE_METATHREAD=exports.EXECUTE_JSSDK_ACTION=exports.DESTROY_THREADS_AND_MESSAGES=exports.UPDATE_ALL=exports.LOAD_MORE=exports.NAVIGATE=void 0;a=__importDefault(a);exports.NAVIGATE=a.default.Loader.ACTION_NAVIGATE;exports.LOAD_MORE="LOAD_MORE";exports.UPDATE_ALL="UPDATE_ALL";exports.DESTROY_THREADS_AND_MESSAGES="DESTROY_THREADS_AND_MESSAGES";exports.EXECUTE_JSSDK_ACTION="EXECUTE_JSSDK_ACTION";exports.TOGGLE_METATHREAD="TOGGLE_METATHREAD";exports.LOAD_MORE_METATHREAD="LOAD_MORE_METATHREAD";exports.TOGGLE_METATHREADS_SETTING="TOGGLE_METATHREADS_SETTING";exports.CHANGE_METATHREADS_SETTING="CHANGE_METATHREADS_SETTING";exports.EDIT_METATHREADS_SETTINGS="EDIT_METATHREADS_SETTINGS";exports.TOGGLE_METATHREADS_SETTINGS="TOGGLE_METATHREADS_SETTINGS";exports.TOGGLE_THREADS_SETTING="TOGGLE_THREADS_SETTING";exports.TOGGLE_DISCOUNTS="TOGGLE_DISCOUNTS";exports.UPDATE_SEARCH="UPDATE_SEARCH";exports.UPDATE_LAYOUT_TYPE="UPDATE_LAYOUT_TYPE";exports.TOGGLE_PONY_MODE="TOGGLE_PONY_MODE";exports.TOGGLE_ACTUAL_MESSAGES_IN_INBOX="TOGGLE_ACTUAL_MESSAGES_IN_INBOX";exports.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS="TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS";exports.ENABLE_ACTUAL_MESSAGES="ENABLE_ACTUAL_MESSAGES";exports.TOGGLE_COMPOSE_EXTEND_MODE="TOGGLE_COMPOSE_EXTEND_MODE";exports.TOGGLE_FOLDER_SHORTCUTS="TOGGLE_FOLDER_SHORTCUTS";exports.UPDATE_LAYOUT_SUPPORT_3_PANE="UPDATE_LAYOUT_SUPPORT_3_PANE";exports.THREAD_LOAD_MORE="THREAD_LOAD_MORE";exports.LOAD_PAGE="LOAD_PAGE";exports.HIDE_PAYMENT_DIE="HIDE_PAYMENT_DIE";exports.TOGGLE_TO_MYSELF_METATHREAD="TOGGLE_TO_MYSELF_METATHREAD";exports.TOGGLE_PAGINATOR="TOGGLE_PAGINATOR";exports.TOGGLE_TODO="TOGGLE_TODO";exports.UPDATE_LAYOUT_SUPPORT_TODO="UPDATE_LAYOUT_SUPPORT_TODO";exports.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE="HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE";exports.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST="DELETE_SENDER_FROM_UNSUBSCRIBE_LIST";exports.COUNT_UNSUBSCRIBE_VIEW="COUNT_UNSUBSCRIBE_VIEW";exports.HIDE_UNSUBSCRIBE_SENDER="HIDE_UNSUBSCRIBE_SENDER"});define("data-source/match/match",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function a(a){if(this.length){return this.includes(a)}return true}function b(a){return!this.includes(a)}exports.default=function(c){var d=a.bind(c);d.exclude=b.bind(c);return d}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/ui-layout",["require","exports","@mail/flags","data-source/actions","data-source/match/match","default-values","service/adv/config","service/radars/index","service/storage"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.changeSupportTodo=exports.changeSupport3Pane=exports.defaults=void 0;a=__importDefault(a);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);var h="octavius-disable-air-mode";var i="octavius-folder-shortcuts";var j="compose:extended";var k="todo";var l=function(){var a=g.default.get(j);return a||false};var m=function(){var b=a.default.get(h);return!d.TOUCH_MODE&&b&&b.state};var n=function(){var b=a.default.get(i);return b&&b.state};var o=function(){var b=a.default.get(k);return b&&b.state};exports.defaults={type:d.USE_3PANE?"3pane":"2pane",support3pane:true,ponyMode:m(),hideAds:d.HIDE_TOYS===d.BL_PROP_NAME,manualShortcuts:n(),composeExtended:l(),supportTodo:true,todo:o()};var p=function(a){exports.defaults.support3pane=a};exports.changeSupport3Pane=p;var q=function(a){exports.defaults.supportTodo=a};exports.changeSupportTodo=q;exports.default={match:c.default(["#attachment","#attachment-editor"]).exclude,fetch:function(c,d,l,m){var n=l&&l.type;var o=l.value;var p=m&&m.uiLayout||exports.defaults;switch(n){case b.UPDATE_LAYOUT_SUPPORT_3_PANE:{return __assign(__assign({},p),{support3pane:o})}case b.UPDATE_LAYOUT_SUPPORT_TODO:{return __assign(__assign({},p),{supportTodo:o})}case b.UPDATE_LAYOUT_TYPE:{a.default.get("use-3pane").save({state:o==="3pane"});return __assign(__assign({},p),{type:o})}case b.TOGGLE_PONY_MODE:{var q=!p.ponyMode;a.default.get(h).save({state:q});e.setRBParam("ponymode",q?1:0);return __assign(__assign({},p),{ponyMode:q})}case b.TOGGLE_TODO:{var q=!p.todo;a.default.get(k).save({state:q});return __assign(__assign({},p),{todo:q})}case b.TOGGLE_FOLDER_SHORTCUTS:{var q=!p.manualShortcuts;f.default(["on_shortcuts_change",q?"on":"off"]);a.default.get(i).save({state:q});return __assign(__assign({},p),{manualShortcuts:q})}case b.TOGGLE_COMPOSE_EXTEND_MODE:{var q=!p.composeExtended;f.default(["on_compose_extend_change",q?"on":"off"]);g.default.set(j,q);return __assign(__assign({},p),{composeExtended:q})}}return p}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/config",["require","exports","@mail/adman-logger","@mail/features","cfg","cfgUser","default-values","helpers/parse","logger","service/adv/encryptor","service/adv/locator","service/radars/index","service/smokescreen","service/storage","../../data-source/source/ui-layout"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAdvTheme=exports.defaultViewerTheme=exports.getSize=exports.defaultTheme=exports.placementsConfig=exports.slotsConfig=exports.deleteRBParam=exports.setRBParam=exports.getRBParams=exports.siteParams=exports.getExpId=exports.hasWhiteList=exports.hasAdBlock=exports.hasBlocker=exports.options=exports.getSiteZone=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importStar(l);var n=function(){return 10};exports.getSiteZone=n;exports.options={immediateFetchTimeout:e.ADMAN_BROKER_IMMEDIATE_FETCH_TIMEOUT,delayedFetchTimeout:e.ADMAN_BROKER_DELAYED_FETCH_TIMEOUT};var o=function(){return a.default.hasBlocker()};exports.hasBlocker=o;var p=function(){return a.default.hasAdBlock()};exports.hasAdBlock=p;var q=function(){return a.default.hasAdBlockWhiteList()};exports.hasWhiteList=q;var r=function(){return a.default.getExpId()};exports.getExpId=r;if(a.default.injector){a.default.injector.set("onClickWithBlockerWhitelistHosts",c.default.urls.mimicWhitelistUrls)}exports.siteParams={preview:location.search.match(/[?&]preview=(\d+)/)&&RegExp.$1,siteId:105,version:"octavius"};function s(a){var b=a.origin,c=a.data;if(b==="https://ad.mail.ru"&&c){window.removeEventListener("message",s);var d=c==="connected"||c==="not_authorized"?1:0;l.default.set("trgVkAuth",d,{email:false})}}function t(){window.addEventListener("message",s);var a=document.createElement("iframe");a.style.display="none";a.src="//ad.mail.ru/dist/vkAuth.html";document.body.appendChild(a)}if(e.ADMAN_SEND_HAS_VK){t()}var u=function(){var a={};if(e.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK&&(!e.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK_FOR_BLOCKER||exports.hasBlocker())){var b="direct"+Math.random().toString(36).slice(2);window[b]=function(a){if(e.ADMAN_USE_MIMIC_ON_DIRECT_LOAD_ERROR&&e.ENABLE_SMOKESCREEN){delete window[b];i.locator.setup({enable:true});h.default.enable();k.default.default.subscribeToggleOn("routeend");if(e.ADMAN_REINIT_ON_DIRECT_LOAD_ERROR&&e.ADMAN_REINIT_ON_DETECT){k.default.default.router.reload()}j.default("adman_direct_error_reinit")}else{a();j.default("adman_direct_error_target")}g.default.add("ADMAN.DIRECT_LOAD_ERROR");j.default("adman_direct_error")};a.directLoadErrorCallback=b}var c=new URLSearchParams(window.location.search);if(c.has("newreg")){a.mail_event="registration"}else if(c.has("authid")||c.has("back")){a.mail_event="login"}a.ponymode=m.defaults.ponyMode?1:0;a.in3paneMetathread=0;a.email=d.default.get("initialUser.email");a.rounded=e.ADVERT_SIDEBAR_ROUNDED?1:0;if(e.ADMAN_SEND_SYNC_IDS){var f=l.default.get("rb_sync_id",{email:false});if(f){Object.assign(a,f)}var n=l.createSessionStorage().get("rb_sync_id",{email:false});if(n){Object.assign(a,n)}}if(e.ADMAN_SEND_HAS_VK){var o=l.default.get("trgVkAuth",{email:false});if(o==1){a.vk=1}}return a};var v=u();var w=function(){return v};exports.getRBParams=w;var x=function(a,b){v[a]=b};exports.setRBParam=x;var y=function(a){return delete v[a]};exports.deleteRBParam=y;exports.slotsConfig={};exports.placementsConfig={};e.ADV_SPECLINE_ENABLED&&Object.assign(e.ADV_SLOTS,e.ADV_SPECLINE_SLOTS);Object.entries(e.ADV_SLOTS).forEach(function(a){var b=a[0],c=a[1];var d=c.slot,g=c.limit,h=c.autoUpdate,i=c.onAutoUpdate,j=c.renderThrottling,k=c.handlePageVisibility,l=c.counter,m=c.urlChangeOnly,n=c.statId,o=c.mimicId,p=c.mimicLimit,q=p===void 0?g:p,r=c.width;exports.slotsConfig[b]={id:d,name:b,counter:f.parseStringToBoolean(l),urlChangeOnly:f.parseStringToBoolean(m),limit:parseInt(g,10),statId:n,mimicId:o,mimicLimit:parseInt(q,10),onAutoUpdate:f.parseStringToBoolean(i)};exports.placementsConfig[b]={siteZone:exports.getSiteZone,name:b,slot:d,autoUpdate:parseInt(h,10),renderThrottling:parseInt(j,10),handlePageVisibility:f.parseStringToBoolean(k),calculateHeight:b==="sidebar"||b==="sidebar-small",width:parseInt(r,10),heightCoef:e.ADVERT_SCROLL_CONF[1],rbParams:exports.getRBParams,renderOnCreate:false}});exports.defaultTheme={isDarkTheme:false,siteBgColor:"ffffff",urlColor:"999999",hoverColor:"000000",bg:"ffffff",bgHover:"ffffff",borderColor:"ffffff",textColor:"000000",titleColor:"005bd1",titleHoverColor:"000000",listBg:"f0f5ff",listBgHover:"f0f5ff",listBorderColor:"ffffff",listTitleColor:"005bd1",listTitleHoverColor:"005bd1",listTextColor:"333333",listButtonBgColor:"ffffff",listButtonTextColor:"333333",listButtonBorderColor:"e2e2e1",listButtonBorderHoverColor:"005BD1",listButtonTextHoverColor:"005BD1",listButtonBgHoverColor:"ffffff",sentMsgOkBg:"ffffff",sentMsgOkBgHover:"ffffff",sentMsgOkBorderColor:"e0e0e0",sentMsgOkTextColor:"000000",sentMsgOkTitleColor:"005bd1",sentMsgOkTitleHoverColor:"000000"};var z={isDarkTheme:true,siteBgColor:"000000",urlColor:"9C9C9C",hoverColor:"ffffff",bg:"000000",bgHover:"000000",borderColor:"000000",textColor:"ffffff",titleColor:"0667FF",titleHoverColor:"ffffff",listBg:"151515",listBgHover:"151515",listBorderColor:"1F1F1F",listTitleColor:"589BFF",listTitleHoverColor:"589BFF",listTextColor:"333333",listButtonBgColor:"313131",listButtonTextColor:"D7D7D7",listButtonBorderColor:"313131",listButtonBorderHoverColor:"414141",listButtonTextHoverColor:"D7D7D7",listButtonBgHoverColor:"414141",sentMsgOkBg:"313131",sentMsgOkBgHover:"313131",sentMsgOkBorderColor:"1D1D1D",sentMsgOkTextColor:"ffffff",sentMsgOkTitleColor:"0667FF",sentMsgOkTitleHoverColor:"ffffff"};var A={"2pane":{ponymode:{isPonymode:true,advHeight:40,imgWrapperHeight:36,imgWrapperWidth:95,imgHeight:95,imgWidth:95,titleLineHeight:20,titleFontSize:13,infoLineHeight:17,infoFontSize:13,infoMarginTop:0,descriptionLineHeight:20,descriptionFontSize:13},notPonymode:{isPonymode:false,advHeight:48,imgWrapperHeight:42,imgWrapperWidth:110,imgHeight:110,imgWidth:110,titleLineHeight:20,titleFontSize:15,infoLineHeight:17,infoFontSize:13,infoMarginTop:0,descriptionLineHeight:20,descriptionFontSize:13}},"3pane":{ponymode:{isPonymode:true,advHeight:81,imgWrapperHeight:56,imgWrapperWidth:90,imgHeight:90,imgWidth:90,titleLineHeight:20,titleFontSize:15,infoLineHeight:16,infoFontSize:11,infoMarginTop:2,descriptionLineHeight:18,descriptionFontSize:12},notPonymode:{isPonymode:false,advHeight:101,imgWrapperHeight:56,imgWrapperWidth:100,imgHeight:100,imgWidth:100,titleLineHeight:20,titleFontSize:15,infoLineHeight:16,infoFontSize:11,infoMarginTop:10,descriptionLineHeight:18,descriptionFontSize:13}}};var B=function(a){var b=exports.getRBParams(),c=b.in3paneMetathread,d=b.ponymode;var e=d||c?"ponymode":"notPonymode";return A[a][e]};exports.getSize=B;exports.defaultViewerTheme={top:"dcdcdc",topHover:"ffffff",bg:"333333"};var C=b.default.getAsJSON("adv-theme-new",{});var D=b.default.getAsJSON("adv-theme-viewer",{});var E=b.default.getAsJSON("adv-theme-dark",{});Object.assign(exports.defaultTheme,C);Object.assign(z,E);Object.assign(exports.defaultViewerTheme,D);function F(a){return __assign(__assign({},exports.defaultTheme),a.isDarkMode()?z:null)}exports.getAdvTheme=F});define("helpers/define-utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defineExternalForSyncUse=exports.defineExternal=void 0;var define=window.define;function a(a,b){define(a,function(){return b})}exports.defineExternal=a;function b(b,c){a(b,c);window.require([b],function(){})}exports.defineExternalForSyncUse=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/rb",["require","exports","request"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={getSlot:function(b,c,d){if(c===void 0){c="themes"}if(d===void 0){d=0}var e=b?"/widgets/"+c+"/"+b+"/":"/widgets/"+c+"/";if(!(!d||isNaN(Number(d)))){e+="?preview="+Number(d)}return a.default(e,null,{force:true}).then(function(a){return a.body})}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/themes",["require","exports","@mail/xray","default-values","Emitter","helpers/rb","service/auth"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ThemeModel=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=.5*1e3;var g=1e3;var h=10*60*1e3;var i=60*1e3;var j=[[1050,656],[1280,800],[1440,900],[1680,1050],[1920,1200],[2560,1600]].map(function(a,b,c){return a.concat(b?c[b-1].map(function(a){return++a}):[0,0])});var k={container:document.querySelector("#css-bundle-theme"),createStyle:function(a){var b=document.createElement("style");b.type="text/css";b.innerHTML=a;return b},createLink:function(a){var b=document.createElement("link");b.crossOrigin="anonymous";b.rel="stylesheet";b.type="text/css";b.href=a;return b},append:function(a){this.container.appendChild(a)},remove:function(a){var b=a.parentNode;if(b){b.removeChild(a)}},link:null,style:null};var l=function(){function c(a,c,d){var e="settings__preview";var f="vertical__preview";if(b.USE_CUSTOM_THEME_PREVIEW_NAME&&c&&c.custom_preview_name){e=c.custom_preview_name()}var g=(b.CUSTOM_THEMES_PREVIEWS_PATHS===null||b.CUSTOM_THEMES_PREVIEWS_PATHS===void 0?void 0:b.CUSTOM_THEMES_PREVIEWS_PATHS[a])||d+"/"+a+"/images/"+e;var h=window.devicePixelRatio>1?g+".HiDPi.jpg":g+".jpg";var i={};if(c===null||c===void 0?void 0:c.verticalPreview){var j=window.devicePixelRatio>1?f+".HiDPi.jpg":f+".jpg";i.verticalPreview=d+"/"+a+"/images/"+j}Object.assign(this,{widget:{}},c,__assign({id:a,path:d,preview:h},i));this.id=a}c.prototype.getActualVariant=function(){var a=b.THEME_PREFIX+"all";if(this.randomVariant){a=this.randomVariant}else if(this.select_variant){a=this.select_variant(this)}return a};c.prototype.getStyle=function(a){return k.createStyle(this.createAdaptiveBackgroundCSS(a))};c.prototype.getLink=function(a){if(this.select_css_alias){a=this.select_css_alias(a)}return k.createLink(this.path+"/"+this.id+"/"+a+".css")};c.prototype.getImagesPath=function(a){var b=this.variants?"/v1":"";return this.path+"/"+this.id+"/images/bg"+(a==="all"?b:"/"+a)};c.prototype.selectRandomVariant=function(){var a=this.variants;if(a){this.randomVariant=a[Math.floor(Math.random()*a.length)]}};c.prototype.loadWidgetData=function(){var a=this;var b=this.isNeedLoadData()?d.default.getSlot(this.id):Promise.resolve({});b.then(function(b){delete b.background;a.widget.data=b},function(){});return b};c.prototype.preloadAdaptiveImage=function(a){var b=this.getAdaptiveImages(a);return Object.keys(b).length?new Promise(function(a){var c=new Image;c.onload=a;c.onerror=a;c.src=b.default;setTimeout(a,g)}):Promise.resolve()};c.prototype.preload=function(a){return this.preloadAdaptiveImage(a)};c.prototype.createAdaptiveBackgroundCSS=function(a){var b=this.getAdaptiveImages(a);var c=this.id;function d(a,d,e,f){return"@media (min-width: "+e+"px), (min-height: "+f+"px) {"+("body.theme-"+c+" .application-mail {")+"background-image:"+("url("+b[a+"x"+d]+"),")+("url("+b.default+");")+("background-size: "+a+"px "+d+"px;")+"}"+"}"}return Object.keys(b).length?j.reduce(function(a,b){return a+d(b[0],b[1],b[2],b[3])},""):""};c.prototype.getAdaptiveImages=function(a){var b={};if(this.adaptive_background){var c=j.filter(function(a){return a[2]<=window.innerWidth||a[3]<=window.innerHeight}).pop();if(!this.randomVariant&&this.widget.data.background){Object.assign(b,this.widget.data.background)}else{var d=this.getImagesPath(a);j.forEach(function(a){b[a[0]+"x"+a[1]]=d+"/"+a[0]+"x"+a[1]+".jpg"})}b.default=b[c[0]+"x"+c[1]]}return b};c.prototype.checkVariant=function(){var a=this;var b=this.getActualVariant();if(b!==this.variant){this.preload(b).then(function(){a.applyVariant(b)})}};c.prototype.apply=function(a){var b=this;return new Promise(function(c,d){b.loadWidgetData().then(function(){b.selectRandomVariant();var e=b.getActualVariant();if(b.isApplyed()&&e===b.variant){c(void 0)}else if(a){b.preload(e).then(function(){b.applyVariant(e).then(c,d)},c)}else{b.applyVariant(e).then(c,d)}},d)})};c.prototype.applyVariant=function(a){var b=this;return new Promise(function(c,d){var e=b.getLink(a);var f=b.getStyle(a);var g=b.isApplyed()?b.waitApplyVariant(k.link,k.style,e,f):b.waitApplyTheme(k.link,k.style,e,f);g.then(c,d);k.append(e);k.append(f)}).then(function(c){var d=c[0],e=c[1],f=c[2],g=c[3];b.variant=a;if(e){k.remove(e)}if(d){k.remove(d)}k.link=f;k.style=g;return b},function(){return Promise.reject()})};c.prototype.waitApplyTheme=function(c,d,e,f){var g=this;return new Promise(function(h,i){var j;var k=function(){a.default.send("theme_wait_apply_error");clearTimeout(j);i([e,f])};var l=setTimeout(function(){k()},b.APPLY_THEME_TIMEOUT);var m=function(){clearTimeout(l);h([c,d,e,f])};var n=function(){if(g.isApplyed()){m()}else{j=setTimeout(n,10)}};n()})};c.prototype.waitApplyVariant=function(a,b,c,d){return new Promise(function(e){setTimeout(function(){e([a,b,c,d])},f)})};c.prototype.isSupportWidget=function(){return b.SUPPORT_WIDGET_THEME_IDS.includes(this.id)};c.prototype.isNeedLoadData=function(){return!!this.widget.slot};c.prototype.isNeedAutoUpdate=function(){return!!this.auto_update};c.prototype.isApplyed=function(){var a=window.getComputedStyle(k.container);return a.content.includes(this.id)||a.fontFamily.includes(this.id)};c.prototype.isDarkMode=function(){return b.DARK_MODE_THEMES.includes(this.id)};c.prototype.isWhiteTheme=function(){return this.id===b.WHITE_PORTAL_THEME};c.prototype.store=function(){return e.default.user.save("theme",this.id)};return c}();exports.ThemeModel=l;var m=function(){function d(){c.default.apply(this);this.retryCount=0;this.model=new l;this.models=[]}d.prototype.setup=function(a){Object.assign(this,a)};d.prototype.import=function(a){var c=this;var d=a.split(",");if(b.HAS_UNIQUE_THEME_ID){d=[b.UNIQUE_THEME_ID]}if(b.HAS_UNIQUE_THEME_ID_LIST){d=b.UNIQUE_THEME_ID_LIST.split(",")}this.models=d.filter(function(a){return c.config[a]}).map(function(a){return new l(a,c.config[a],c.path)})};d.prototype.getDefaultModel=function(){return this.getModel(b.DEFAULT_THEME_ID)};d.prototype.getModel=function(a){return this.getModels().find(function(b){return b.id===a})};d.prototype.getModels=function(){return this.models};d.prototype.setThemeInterval=function(a){var b=this;clearInterval(this.timer);if(a.isNeedLoadData()){this.timer=setInterval(function(){a.apply(true).then(function(){b.emit("themes:reload",a)},function(){})},h)}else if(a.isNeedAutoUpdate()){this.timer=setInterval(function(){a.checkVariant()},i)}};d.prototype.setDefaultTheme=function(){var a=this;var b=this.getDefaultModel();this.model=b;b.apply(false).then(function(){a.setThemeInterval(b);a.emit("themes:apply",b)},function(){})};d.prototype.setTheme=function(c,d){var e=this;var f=this.model.id;var g=c.id===this.model.id?Promise.resolve():c.apply(!!this.model.id);if(!this.model.id){this.model=c}var h=new Promise(function(d,f){g.then(function(){e.model=c;e.setThemeInterval(c);e.emit("themes:apply",c);d(void 0)},function(){var g=function(){if(e.retryCount<b.LIMIT_OF_THEME_RETRY){c.apply(false).then(function(){e.model=c;e.setThemeInterval(c);e.emit("themes:apply",c);a.default.send("theme_retry_ok");d(void 0)},function(){e.retryCount++;g()})}else{e.retryCount=0;if(c.id===e.model.id){e.setDefaultTheme();a.default.send("failed_retry_page_load")}else{a.default.send("failed_retry_theme_change")}f()}};if(c.id){g()}else{e.setDefaultTheme();a.default.send("unknown_theme")}})});Promise.all([h,new Promise(function(a,b){require(["service/portal"],a,b)}).then(__importStar)]).then(function(a){var b=a[0],d=a[1];d.default.setColorTheme(c.isDarkMode()?"dark":"default")});if(d){h.then(function(){c.store()}).then(function(){a.default.send("themes_select",{dwh:{theme_from:f,theme_to:c.id}})}).catch(function(){})}return h};return d}();exports.default=m});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/themes.setup",["require","exports","@mail/features","cfg","cfgUser","default-values","helpers/define-utils","service/themes"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);f=__importStar(f);var g=new f.default;var h;var i={themes:g,load:function(){if(!h){h=new Promise(function(a,b){require(["themesConfig"],a,b)}).then(__importStar);h.then(function(a){var e=b.default.themesPath;var f;if(d.VK_THEMES_LIST){f=c.default.get("config.themes.vklist")||"default"}else{f=c.default.get("config.themes.list")||"default"}g.setup({config:a.themes,path:e});g.import(f)})}return h},getColorizedModels:function(){return this.getAllModels().filter(function(a){return a.colorized})},getModels:function(){return this.getAllModels().filter(function(a){return!a.colorized})},getAllModels:function(){var a=g.getModels();var b=d.THEMES_AVAILABLE.whitelist,c=d.THEMES_AVAILABLE.colorized;return a.filter(function(a){return a.colorized&&c||b.includes(a.id)})},getDefaultModel:function(){return g.getDefaultModel()},getModel:function(a){return g.getModel(a)},getSelectedModel:function(){return g.model},setTheme:function(a,b){return g.setTheme(a,b)},setThemeById:function(a){var b=this.getModel(a);this.setTheme(b,true).catch(function(){})},getCurrentThemeId:function(){return b.default.themeId},applyUserTheme:function(){var c=this;var d=a.default.getAsString("user-unique-themeId")||a.default.getAsString("themeId")||b.default.themeId;if(d==="default"){d=a.default.getAsString("default-themeId")||"default"}var e=a.default.getAsString("user-unique-themeId-list");if(!!e&&!e.includes(d)){d=e.split(",")[0]}var h=a.default.getAsString("themeVariant");g.emit("usertheme:apply",new f.ThemeModel(d));this.load().then(function(){var a=c.getModel(d);if(a&&h){a.variants=[h]}var b=c.getDefaultModel();var e=a||b;g.setTheme(e,false).then(function(){return e},function(){return Promise.reject()}).catch(function(){g.setTheme(b).catch(function(){})})})}};e.defineExternalForSyncUse("service/themes.setup",i);exports.default=i});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/mimic",["require","exports","@mail/features","@mail/mimic/dist/types/src/projects/octavius","@mail/xray","cfgUser","default-values","logger","service/adv/config","service/adv/encryptor","service/adv/locator","service/radars/index","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);var l;var m={lazyInit:function(){l=b.default({previewId:location.search.match(/[?&]preview=(\d+)/)&&RegExp.$1,pageId:String(e.MIMIC_PARTNER_ID),expId:e.MIMIC_EXP_ID,ignoreTimeout:true,project:"octavius",features:a.default,locator:i.locator,logger:f.default,xray:c.default,email:d.default.get("initialUser").email,broker:{getUrl:function(a){return e.MIMIC_ENDPOINT+"/"+a},handleResponse:function(a,b){var d=b.json&&b.json.result||{};var e=b.ajaxOptions||{};e.url="/api/v1/rb-mimic/"+a;f.default.add("mimic response",{ajax:e,status:b.status,result:d});var g=e.__ts;var h=(new Date).getTime();var i=h-g;var j={};j[a+"-hit"]=i;if(b.xhr){j[a+"-h_"+b.xhr.status]=i}if(d.status){j[a+"-a_"+d.status]=i}c.default.send("mimic-api",{i:j})},APIEncryptor:{encryptorOptions:h.default.encryptorOptions,initXHR:h.default.initXHR}}});if(g.hasWhiteList()){j.default("adman_mimic_on_wl")}},setLayoutManager:function(a){this.layoutManager=a},insert:function(a,b,c,d){if(d===void 0){d=0}if(!l){this.lazyInit()}var f=g.slotsConfig[b.name];var h=this.layoutManager.getType();k.default.load().then(function(){var a={index:d,type:b.name,limit:f.mimicLimit,statId:f.statId,slotId:f.mimicId,originalSlotId:f.id,sidebarSmall:b._width===160,theme:g.getAdvTheme(k.default.getSelectedModel()),sizes:g.getSize(h),pane:h};var i=b._container;if(i&&b.active&&!f.counter&&(!e.NO_MIMIC_ON_WLIST||!g.hasWhiteList()||e.MIMIC_IGNORE_HAS_WLIST)){l.insert(i,a).then(function(a){b.setLastRenderTS();if(c){c(a)}}).catch(function(a){if(e.IS_DEBUG){console.error(a)}})}})}};exports.default=m});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/index",["require","exports","@mail/adman","@mail/xray","default-values","Emitter","service/adv/config","service/adv/mimic","service/radars/index","service/themes.setup","utils/util","./config"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Adman=exports.sidebarPlacementsList=exports.SLOTS_EXCEPT_SENT=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);exports.Adman=a.default;var k={sidebar:c.ADV_FAST_UPDATE_TIMEOUT,list2pane:c.ADV_FAST_UPDATE_TIMEOUT,list3pane:c.ADV_FAST_UPDATE_TIMEOUT,"sidebar-small":c.ADV_FAST_UPDATE_TIMEOUT};exports.SLOTS_EXCEPT_SENT=["sidebar","list2pane"];if(j.hasBlocker()){try{var l=CSSStyleDeclaration.prototype.setProperty;CSSStyleDeclaration.prototype.setProperty=function a(b,c,d){try{if(b==="display"&&c==="none"&&d==="important"){try{throw new Error}catch(a){if(!a.stack.toString().includes("hideViaDisplayProperty")){return l.apply(this,arguments)}else{return l.call(this,"display","")}}}else{return l.apply(this,arguments)}}catch(a){}}}catch(a){}}var m=new a.default.Broker(e.options,e.siteParams);var n=[];var o=[];var p=function(){function a(){var a=this;this.check=function(b,c){var d=e.slotsConfig[b];if(!d.onAutoUpdate&&c){return false}if(d.urlChangeOnly){return a.checkUrlChanged()}return true}}a.prototype.checkUrlChanged=function(){var a=window.app.request;if(a!==this.lastRequest&&a.router&&a.router.isReady){this.lastRequest=a;return true}return false};return a}();var q=160;var r={sidebar:true,"sidebar-small":true};exports.sidebarPlacementsList=Object.keys(r);var s="sidebar";var t=null;function u(a){if(a==="sidebar"){return s}else if(a==="list2pane"){return G.activeListPlacement}return a}function v(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}Object.values(a.default.placements()).forEach(function(a){a.setExpId(j.getExpId())})}function w(a){function b(){j.deleteRBParam("mail_event");a.removeListener("adv-render-fail",b);a.removeListener("adv-render-success",b)}a.addListener("adv-render-fail",b);a.addListener("adv-render-success",b)}function x(a){if(a===void 0){a=0}if(c.ADVERT_CPM_VALUES[a]){return c.ADVERT_CPM_VALUES[a]}return c.ADVERT_CPM_RELOAD_CONF[2]}function y(){var a=c.ADVERT_CPM_VALUES.length;if(a>0){return a-1}return c.ADVERT_CPM_RELOAD_CONF[1]}var z=[];function A(){e.setRBParam("min_cpm",x());z.forEach(C)}var B=i.default.debounce(A,1e3,null);function C(a){a.removeListener("adv-render-success",B);function b(b){var c=a.getExcludeFromAllPlacements();a.setExcludeFromAllPlacements(true);a.render(true,b).then(G.onPlacementRender.bind(G,a),function(){return null});a.setExcludeFromAllPlacements(c)}var d=null;var f=0;var h=false;a.addListener("adv-render-success",function(a){var i=a.name,k=a.banner,l=a.isAutoUpdate;clearTimeout(d);e.setRBParam("min_cpm",x());if(h){h=false}else if(k){g.default(["adman_cpm",c.ADVERT_CPM_EXP,i,"success_try",String(f)]);f=0}else if(f++<y()){e.setRBParam("min_cpm",x(f));d=setTimeout(function(){b(l)},c.ADVERT_CPM_RELOAD_CONF[0])}else{f=0;if(c.ADVERT_CPM_RELOAD_CONF[3]){h=true;j.deleteRBParam("min_cpm");b(l)}g.default(["adman_cpm",c.ADVERT_CPM_EXP,i,"not_found"])}})}function D(a){z.push(a);a.once("adv-render-success",B)}var E=null;var F=null;var G={_slotsState:{},dwhData:E,_listAdvertCurrent:F,_listAdvertNext:F,_isFeedback2step:false,_isFirstRender:true,_isFeedbackActive:c.ADVERT_FEEDBACK,activeListPlacement:"list2pane",visibleAdv:{"spec-project-letter":false},setVisibleAdv:function(a,b){this.visibleAdv[a]=b},isAdvVisible:function(a){return this.visibleAdv[a]},init:function(){var b=this;this.successSlotHandler=this.handleSlotSuccess.bind(this);this.failSlotHandler=this.handleSlotFail.bind(this);Object.keys(e.slotsConfig).forEach(function(d){var f=null;var g=e.slotsConfig[d];if(g.counter){f=(new p).check}var h=__assign(__assign({},e.placementsConfig[d]),{needRenderTogether:f,excludeFromAllPlacements:g.urlChangeOnly,expId:j.getExpId()});var i=new a.default.Slot(g,m);var k=new a.default.Placement(h,i);k.setExpIdGetter(function(){return j.getExpId()});if(k.name==="counter-top"){w(k)}if(c.ADVERT_CPM_RELOAD&&!g.counter){D(k)}i.on("adv-fetch-success",function(){return b.successSlotHandler(i,k)});i.on("adv-fetch-fail",function(){return b.failSlotHandler(i,k,false)});i.on("adv-fetch-force-fail",function(){return b.failSlotHandler(i,k,true)});n.push(i);o.push(k);b._slotsState[d]={status:null,retry:c.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT}});this._updateBrokerTheme(h.default.getSelectedModel());a.default.attachBroker(m);a.default.addSlots(n);a.default.addPlacements(o);a.default.on("adv-render-fail",this.handleRenderFail.bind(this))},update:function(b){var d=this;if(b===void 0){b={}}var f=b.ignoreThrottling,g=f===void 0?false:f,h=b.forceThrottlingTS,i=h===void 0?{}:h,j=b.isForced,l=j===void 0?false:j,m=b.isAutoUpdate,n=m===void 0?false:m;var o=Date.now();Object.values(a.default.placements()).filter(function(a){var b=a.name;var c=e.slotsConfig[b];if(c.counter&&!c.urlChangeOnly){return false}if(l){return true}if(b==="sent"){return false}return!/list/.test(b)}).forEach(function(a){var b=a.name;var c=e.slotsConfig[b];var f=e.placementsConfig[b];var h=i[b]||f.renderThrottling;if(c.counter&&c.urlChangeOnly){a.renderTogether(true)}else if(g){a.render(true,n).then(d.onPlacementRender.bind(d,a),function(){return null})}else if(o-a.getLastRenderTS()>h){a.render(false,n).then(d.onPlacementRender.bind(d,a),function(){return null})}});if(this._fastAutoUpdate){this._scheduleAutoUpdate(c.ADV_FAST_AUTOUPDATE_TIMEOUT,k)}},updateOnAction:function(){var a=this;window.clearTimeout(this._idleTimer);this._enableFastAutoUpdate();this._idleTimer=window.setTimeout(function(){a._disableFastAutoUpdate();g.default("adv_user-idle")},c.ADV_IDLE_TIMEOUT);g.default("adv_update-on-action");this.update({forceThrottlingTS:k})},_enableFastAutoUpdate:function(){this._fastAutoUpdate=true},_disableFastAutoUpdate:function(){this._fastAutoUpdate=false},_scheduleAutoUpdate:function(a,b){var c=this;g.default("adv_schedule-autoupdate");window.clearTimeout(this._scheduleUpdateTimer);this._scheduleUpdateTimer=window.setTimeout(function(){c.update({forceThrottlingTS:b,isAutoUpdate:true})},a)},sleep:function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}var d=b.map(u);d.forEach(function(b){if(a.default.placement(b)){a.default.sleep(b,true)}})},wakeUp:function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}var d=b.map(u);d.forEach(function(b){if(a.default.placement(b)){a.default.wakeUp(b)}})},_activeSidebarPlacementFromWidth:function(a){return a===q?"sidebar-small":"sidebar"},toggleActiveSidebarPlacement:function(b){var c=this._activeSidebarPlacementFromWidth(b);if(c===s){return null}var d=a.default.placement(s);if(d){d.sleep();d.detachFromContainer()}s=c;var e=a.default.placement(c);if(e){e.wakeUp()}return e},getActiveSidebarPlacement:function(){return s},toggleMimic:function(a){n.forEach(function(b){b.forceFail=a});m.clearBatches();o.forEach(function(a){a.clearPendingRender()});g.default(["adman_mimic_toggle",a])},hasRequest:function(){return Object.values(this._slotsState).some(function(a){return a.status})},handleSlotSuccess:function(a){var b=this._slotsState[a.name];if(b.status==="fail"||b.status==="pending"){g.default({type:"adman_was_fail",intervals:[[a.name,1]]})}b.status="success";b.retry=c.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT;g.default(["adman_slot_success"]);if(!this._successOnWLRadarSent&&j.hasWhiteList()){g.default("adman_success_on_WL");this._successOnWLRadarSent=true}},handleSlotFail:function(a,b,c,d){var h=e.slotsConfig[a.name].mimicId;var i=this._slotsState[a.name];if(c){g.default(["adman_slot","force-fail"]);i.status="fail";if(h){if(b.name.includes("list2pane")){b.name="list2pane"}else if(b.name.includes("list3pane")){b.name="list3pane"}f.default.insert(a,b,this.onPlacementRender.bind(this,b),d)}}else if(i.status==="success"||i.status==="pending"){if(i.status==="success"){g.default({type:"adman_was_success",intervals:[[a.name,1]]})}i.status="pending";if(i.retry--<=0){g.default({type:"adman_after_retry",intervals:[[a.name,1]]});g.default(["adman_slot","fail"]);this.emit("slot:fail",a,b);i.status="fail";f.default.insert(a,b,this.onPlacementRender.bind(this,b),d)}}else{g.default(["adman_slot","fail"]);this.emit("slot:fail",a,b);i.status="fail"}},handleRenderFail:function(a){require(["trackJS"],function(b){b.sendRadar("banners",{adman:true,error:a.error,params:{slot:a.banner.slot,banner:a.banner.banner,test_id:a.testId,site_id:a.siteId,sz:a.siteZone}},"octavius_banners")})},handleThemeApply:function(b){var c=this;if(t===b.id){return}a.default.clearCache();new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar).then(function(a){a.default.FeastBlock.clearCache("letter-list-item-adv");c._updateBrokerTheme(b);c.update({ignoreThrottling:true,isForced:true})})},_updateBrokerTheme:function(b){t=b.id;e.setRBParam("isDarkTheme",b.isDarkMode()?1:0);m.setTheme(new a.default.Theme(e.getAdvTheme(b)))},onPlacementRender:function(a,b){var d=this;var e=a.name;if((e==="sidebar"||e==="sidebar-small")&&b&&this._isFeedbackActive){var f=b.dwhChain,g=b.processed;if(f&&!g){b.processed=true;setTimeout(function(){for(var a=0,b=f;a<b.length;a++){var c=b[a];d.sidebarVisibleCallback(c)}},c.ADV_DIRECT_READY_TIMEOUT)}}},sidebarVisibleCallback:function(a){this.emit("sidebar:visible");this.dwhData=a;var c=this._isFeedback2step?"ad-feedback-2-upd":"ad-feedback-upd";var d={dwh:__assign({state:c},a)};if(!this._isFirstRender){b.default.send(c,d)}this._isFirstRender=false},showAdFeedback:function(){var a=c.ADVERT_FEEDBACK_CONFIG2.chance;if(!a){return false}return c.ADVERT_FEEDBACK&&Math.random()<1/a},setFeedback2Step:function(){this._isFeedback2step=true},setFeedbackUnactive:function(){this._isFeedbackActive=false},on:function(a,b){this.emitter.addListener(a,b)},off:function(a,b){this.emitter.removeListener(a,b)},setActiveListPlacement:function(a){this.activeListPlacement=a}};d.default.apply(G);require(["mediator/layout-manager"],function(a){var b=a.default,c=a.getColumnContentWidth;var d=function(){v(G._activeSidebarPlacementFromWidth(c(b._getAdv160ColumnRight())))};d();b.on("update",d)});G.init();h.default.themes.one("usertheme:apply",function(a){G._updateBrokerTheme(a)});h.default.themes.on("themes:apply",G.handleThemeApply.bind(G));exports.default=G});define("service/smokescreen",["exports","@mail/honeypot","@mail/smokescreen","default-values","feast","logger","service/adv/config","service/adv/encryptor","service/adv/index","service/adv/locator","service/radars/index","service/themes.setup"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.selector=exports.withWelter=undefined;var l=t(a);var m=t(b);var n=t(d);var o=t(e);var p=t(g);var q=t(h);var r=t(j);var s=t(k);function t(a){return a&&a.__esModule?a:{default:a}}var u=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var v=false;var w=false;var x=false;var y=false;var z=new l.default(c.HONEYPOT);var A=exports.withWelter=m.default.createWelterDecorator(function(a){return u({},a,{attrs:{className:50,"data-id":30,"data-draggable-id":30},deps:{feast:n.default},minSize:1})});var B=i.locator.transform.bind(i.locator);var C=void 0;var D=true;var E=[];var F=c.HONEYPOT_INTERVALS.reverse();var G={init:function a(b,d){var e=this;this.router=b;this.checkHoneypot=this.checkHoneypot.bind(this);this.handleSlotFail=this.handleSlotFail.bind(this);this.handleRouteEndEvent=this.handleRouteEndEvent.bind(this);E.push.apply(E,this.getMainStyles());var g=function a(){if(c.ENABLE_SMOKESCREEN&&(!c.NO_MIMIC_ON_WLIST||!(0,f.hasWhiteList)())&&(!c.NO_MIMIC_ON_ADBLOCK||!(0,f.hasAdBlock)())){e.sendHoneypotDetectRadar(true)}};var h=function a(){q.default.on("slot:fail",function(){return e.handleSlotFail()});s.default.themes.on("themes:apply",function(){return e.update()});s.default.themes.one("themes:apply",function(){E.push.apply(E,e.getThemeStyles())})};if(d){setTimeout(g,50);setTimeout(h,1)}else{g();h()}},handleSlotFail:function a(){if(c.ENABLE_SMOKESCREEN){this.toggle(true,true)}},sendHoneypotDetectRadar:function a(b){y=true;if(this.checkHoneypot()){if(!D&&z){z.destroy();z=null}(0,r.default)(["honeypot_detect"]);if(b){(0,r.default)(["honeypot_detect_sync"])}else{(0,r.default)(["honeypot_detect_async"])}}},scheduleHoneypotChecking:function a(){var b=this;if((!D||!F.length||C)&&z){z.destroy();z=null}var c=void 0;if(F.length===1){c=F[0]}else{c=F.pop()}if(!c){return}C=setTimeout(function(){b.sendHoneypotDetectRadar()},c)},getStyles:function a(b){return Array.from(document.querySelectorAll(b)).map(function(a){return a.href})},getThemeStyles:function a(){return this.getStyles("#css-bundle-theme > link")},getMainStyles:function a(){return this.getStyles("#css-bundle > link")},setupLocatorStyles:function a(){if(E.length){i.locator.setup({links:E},function(a){console.error(a);require(["trackJS"],function(b){b.sendRadar("mimic",{enabled:v,error:a,params:{type:"locator"}},"octavius_mimic")})});E.length=0}},checkHoneypot:function a(){var b=z.check(c.IS_DEBUG);C=undefined;c.IS_DEBUG&&console.warn("[Honeypot] check",b);if(b||c.MIMIC_FORCE){if(c.IS_DEBUG&&c.MIMIC_FORCE){console.warn("mimic-force")}D=false;this.toggle(true)}else{this.scheduleHoneypotChecking()}return b},update:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(v&&b){p.default.enable()}var e=v&&(!d||!q.default.hasRequest());if(e){i.locator.setup({enable:v},function(a){console.error(a);require(["trackJS"],function(b){b.sendRadar("mimic",{enabled:v,error:a,params:{type:"switch"}},"octavius_mimic")})});this.setupLocatorStyles()}if(b){if(c.ENABLE_WELTER){m.default.toggleWelterGlobal(e)}n.default.set("classNameBuilder",e?B:undefined);q.default.toggleMimic(v);if(e&&window.app&&app.view){this.router.reload();o.default.add("APP.REINIT");(0,r.default)("app_reinit")}}},toggle:function a(b,d){if(!c.NO_MIMIC_ON_WLIST||!(0,f.hasWhiteList)()||(0,f.hasWhiteList)()&&d&&c.MIMIC_IGNORE_HAS_WLIST){if(!y&&(0,f.hasWhiteList)()){this.sendHoneypotDetectRadar()}var e=v!==b;v=b;if(w&&x){this.router.off("routeend",this.handleRouteEndEvent);w=false;x=false}this.update(e,d)}},lookup:function a(b){return v?i.locator.transform(b):b},isEnabled:function a(){return v},getLocator:function a(){return i.locator},isValidURL:function a(b){var c=window.location.host.replace(/\//g,"\\/");var d=new RegExp("^https:\\/\\/"+c+"\\/inbox\\/1:(.*):0\\/\\?$").exec(b);if(d&&i.locator.isWelter(d[1])){return false}return true},handleRouteEndEvent:function a(){x=true;this.toggle(true)},subscribeToggleOn:function a(b){if(!w){w=true;this.router.one(b,this.handleRouteEndEvent)}}};c.IS_DEBUG&&(window.boom=function(){return G.toggle(!v)});exports.default=G;var H=exports.selector=i.locator.selector.bind(i.locator)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/portal",["require","exports","cfgUser","feast-mod/letters-count","helpers/dom-utils","mail/Folder","service/smokescreen","utils/util"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);f=__importDefault(f);var g;var h=100;var i=f.default.debounce(function(){window.__PH&&window.__PH.updateCounter({mail:b.countUnreadTotalMod()})},h,null);exports.default={load:function(){if(!g){g=Promise.resolve(a.default.get("headline")).then(function(a){var b=document.querySelector("#headline");if(b.childNodes.length&&window.__PH){b.style.visibility="visible";d.default.all.on("change reset",i);return}try{var f=document.querySelector(e.selector("#headline .headline"));c.insertHTML(f,a)}catch(a){}d.default.all.on("change reset",i)})}return g},setColorTheme:function(a){var b,c;(c=(b=window.__PH)===null||b===void 0?void 0:b.setColorTheme)===null||c===void 0?void 0:c.call(b,a)}}});define("ui-block/headline/headline",["exports","default-values","feast","feast-tpl!./headline.html","service/portal"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(b);var f=h(c);var g=h(d);function h(a){return a&&a.__esModule?a:{default:a}}var i=e.default.Block.extend({name:"headline",template:f.default,blocks:{},defaults:{visible:true,enabled:true},attrChanged:{enabled:function a(b){b?i.show():i.hide()}},didMount:function a(){g.default.load()}});i.hide=function a(){var b=document.querySelector("#headline");if(b){b.style.display="none"}};i.show=function b(){var c=document.querySelector("#headline");if(c&&!a.HIDE_HEADLINE){c.style.display="block"}};exports.default=i});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/headline",["require","exports","ui-block/headline/headline","../helpers/lazy"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getHeadline=void 0;a=__importDefault(a);exports.getHeadline=b.lazyInit(function(){var b=document.getElementById("headline");var c=new a.default({visible:false});if(b.childNodes.length){c.renderTo(b)}else{c.didMount()}return c})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/checkContactsPossessing",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkContactsPossessing=exports.url=void 0;b=__importDefault(b);exports.url="ab/smart";function c(a){var c=a.emails;var d=a.fields||[];if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}d.push("last_seen");d.push("flags");return b.default.call(exports.url,{by_email:c,simple:true,fields:d})}exports.checkContactsPossessing=a.createGlobalAction("ab/smart",function(a){return __awaiter(void 0,void 0,Promise,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,c(a)];case 1:b=f.sent();d=b.body||{};e=d.contacts||[];return[2,a.emails.reduce(function(a,b){if(!a.contacts){a.contacts={}}a[b]=e.some(function(a){if(!Array.isArray(a.emails)){return false}return a.emails.includes(b)});e.forEach(function(c){if(c&&Array.isArray(c.emails)&&c.emails.includes(b)){var d=c.last_seen?Object.assign({},c.last_seen):{status:"",client_type:""};a.contacts&&(a.contacts[b]=d)}});return a},{})]}})})})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/lastSeen",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchLastSeen=exports.url=void 0;b=__importDefault(b);exports.url="ab/lastseen";function c(a){var c=a.emails,d=a.only_memcache,e=d===void 0?true:d;if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}return b.default.call(exports.url,{emails:c,only_memcache:e})}exports.fetchLastSeen=a.createGlobalAction("ab/lastseen",function(a){return __awaiter(void 0,void 0,Promise,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,c(a)];case 1:b=f.sent();d=b.body||[];e=new Map(d.map(function(a){return[a.email,a.last_seen]}));return[2,a.emails.reduce(function(a,b){var c=e.get(b);if(!c){return a}a[b]=c;return a},{})]}})})})});define("data-source/data-source",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isDataSourceEvent=void 0;var a=window.requestAnimationFrame||function(a){return window.setTimeout(a,12)};var b=window.cancelAnimationFrame||function(a){return window.clearTimeout(a)};function c(a){return Boolean("type"in a&&"details"in a&&a.details)}exports.isDataSourceEvent=c;var d=function(){function c(){this._emissionPid=null;this._changesBatch=[];this._handleBatchEmission=this._handleBatchEmission.bind(this)}c.prototype._handleBatchEmission=function(){var a=this;var b=this._changesBatch;this._changesBatch=[];b.forEach(function(b){a.emit("action",{type:"action",details:b})});this.emit("change",{type:"change",details:{changes:b}});b.forEach(function(b){a.emit("actionend",{type:"actionend",details:b})});this.emit("afterchange",{type:"afterchange"})};c.prototype.dispatch=function(a){this.emit("beforeaction",{type:"beforeaction",details:{action:a}})};c.prototype.updateAll=function(){throw new Error("Not implemented")};c.prototype.getData=function(){throw new Error("Not implemented")};c.prototype.getLoader=function(){throw new Error("Not implemented")};c.prototype.notifyNextData=function(c,d,e){this._changesBatch.push({request:c,action:d,data:e});if(this._emissionPid){b(this._emissionPid)}this._emissionPid=a(this._handleBatchEmission)};return c}();exports.default=d});define("service/layer-load",["exports","./getModule"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadLayer=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a){var c=this.loaded;!c[a]&&(c[a]=new Promise(function(c){(0,b.default)("ui-block/layer-"+a+"/layer-"+a).then(function(a){var b=a.default;if(b.prototype.needToolkit){require(["ajs","feast-mailru-toolkit"],function(a,d){var e=d.loadToolkit;e(function(){c(b)})})}else{c(b)}})}));return c[a]}});define("mail/UserSecurity",["RPCModel","mail/Phone"],function(a,b){"use strict";var c=a.extend({className:"mail.UserSecurity",url:"golang/user/security",defaults:{id:null,password_changed:0,password_required:false,need_change_password:false,restore:null,phones:null},isDataFully:function(){return this.is("restore")},okPhones:function(){var a=this.get("phones");return new b.List(a?a.filter(function(a){return a.status==="ok"}):[])}});return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/PasswordStrength",["require","exports","Action","RPC"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=a.default.extend({url:{signup:"utils/password/strength",change:"user/password/strength",restore:"user/password/restore/strength"},reasons:["like_current_password","like_dictionary_word","like_username","like_firstname","like_lastname","like_nickname","like_birthdate","like_city","like_phone","like_secret_question","weak","invalid","only_digits"],grades:4,gradesName:{INITIAL:1,LOW:2,MIDDLE:3,HIGH:4},operation:function a(c){var d=c.password;if(!d){return Promise.reject({password:"required"})}var e=c.type;var f=this.url[e];if(!f){f=this.url.signup}return b.default.call(f,c).then(this._processResponse.bind(this))},_processResponse:function(a){var b=a.body||{};var c=b.reasons||[];var d=b.warning_reasons||[];return{reasons:c,warningReasons:d}}});a.default.register("mail.PasswordStrength",c);c.version="0.4.0";exports.default=c;return c});define("mail/actions/PasswordChange",function(require){"use strict";var a=require("Action"),b=require("RPC");var c=a.extend({urls:{change:"user/password/change"},required:{change:["password","redirect_uri"]},_processResponse:function(a){return a.body},operation:function a(c){var d="change";var e=this.required[d];var f={};var g=false;e.forEach(function(a){if(typeof c[a]==="undefined"){f[a]="required";g=true}});if(g){return Promise.reject(f)}if(c.more_password_strength){c.more_password_strength="1"}var h=this.urls[d];return b.call(h,c).then(this._processResponse.bind(this))}});a.register("mail.PasswordChange",c);return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/promo",["require","exports","cfg","default-values","feast-extension/promo","service/getModule","service/radars/index","service/smokescreen","mail/UserSecurity","mail/actions/PasswordStrength","mail/actions/PasswordChange"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);function g(a){return document.querySelector(f.selector("."+c.promoClassPrefix+a))}var h;var i="octavius";var j;function k(){return i}function l(){return document.querySelector(f.selector(".renovator"))}exports.default={load:function(){if(!h){h=Promise.all([d.default("2promo"),d.default("mediator/layout-manager")]).then(function(b){var c=b[0],d=b[1];return[new c({radar:e.default,selector:f.selector,getElementByPromoId:g,getThemeId:k,omicron:a.default.get("omicron")}),d]})}return h},update:function(){this.load().then(function(a){var b=a[0],c=a[1];if(c.default.isLessThen("xs")){return}b.update()});this.updateRenovator()},applyTheme:function(a){var b=a.isDarkMode()?"octaviusBlack":"octavius";if(i!==b){i=b;this.update()}},updateRenovator:function(){if(!b.RENOVATOR_DISABLED){this.loadRenovator().then(function(a){a.update()})}},hideRenovator:function(){if(!b.RENOVATOR_DISABLED){this.loadRenovator().then(function(a){a.hide()})}},loadRenovator:function(){if(!j){j=d.default("renovator").then(function(a){return new a({getThemeId:k,getContainer:l})})}return j}}});define("service/layer",["exports","default-values","service/layer-load","service/promo"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=e(c);function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function h(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var i=function a(b,c,d,e){h(this,a);this.view=b;this.data=c;this.Block=d;this.container=e};var j=function(){function a(c){h(this,a);this.UILayerWindow=c;this.loaded={};this.load=b.loadLayer.bind(this)}g(a,[{key:"create",value:function a(b,c,d){var e=document.createElement("DIV");var f=new this.UILayerWindow;f.renderTo(e);f.set(d);return new i(f,c,b,e)}}]);return a}();var k=function(){function b(){h(this,b)}g(b,[{key:"setup",value:function a(b){this._stack=[];this.rootEl=document.createElement("DIV");this.layerFactory=new j(b);document.body.appendChild(this.rootEl)}},{key:"open",value:function a(b,c){var e=this;var f=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.layerFactory.load(b).then(function(a){var b=e.layerFactory.create(a,c,f);b.view.on("window:close",function(){e._pop();d.default.update()});e._push(b);d.default.update();return b.view.setLayer(a,c)})}},{key:"openIframeLayer",value:function b(c){var d=c.paramsKey,e=c.additionalParams,g=e===undefined?{}:e,h=c.factoryParams,i=h===undefined?{}:h,j=c.onPostMessage;var k=d&&a.LAYER_IFRAME_PARAMS[d]||{};return this.open("iframe",f({},k,g,{router:app}),f({dimmer:true},i)).then(function(a){if(typeof j==="function"){a.on("layer-iframe:post-message",j)}return a})}},{key:"getInstance",value:function a(){var b=this._getCurrentLayer();if(!b){return null}return b.view}},{key:"_push",value:function a(b){this._hideLayer(this._getCurrentLayer());this._stack.push(b);this._showLayer(b)}},{key:"_pop",value:function a(){this._hideLayer(this._getCurrentLayer());this._stack.pop();this._showLayer(this._getCurrentLayer())}},{key:"_getCurrentLayer",value:function a(){if(!this._stack){return}return this._stack[this._stack.length-1]}},{key:"_hideLayer",value:function a(b){if(!b){return}this.rootEl.removeChild(b.container);b.view.set("active",false)}},{key:"_showLayer",value:function a(b){if(!b){return}this.rootEl.appendChild(b.container);b.view.set("active",true)}}]);return b}();exports.default=new k});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/notify",["require","exports","default-values","service/radars/index"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);var c=i18n("Что-то пошло не так");var d={type:"",text:"",qa:"notify-item",actions:[],duration:a.NOTIFY_CLOSE_DELAY,inline:true,className:"",unique:false};var e={};exports.default={isReady:function(a){if(a===void 0){a="default"}return!!e[a]},setup:function(a,b){if(b===void 0){b="default"}e[b]=a},add:function(a,f){if(f===void 0){f="default"}var g=e[f];var h=__assign(__assign({},d),a);if(!g){console.warn("Нет очереди ошибок для отображения в нотификациях");return}if(h.type===this.types.error){b.default("notify_error");if(h.text.includes(c)){b.default("notify_error_unknown")}}return g.add(h)},error:function(a,b){if(b===void 0){b="default"}this.add(__assign({type:this.types.error,text:c+"!"},a),b)},setData:function(a,b,c){if(c===void 0){c="default"}var d=e[c];d.setData(a.idx,b)},types:{error:"error",success:"success",default:""},MAX_LENGTH:44,MAX_LENGTH_SMALL:32}});define("feast-mod/avatar",["exports","cfg"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.avatarUrl=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a,c,d){return b.default.get("urls.avatarUrl")+"/pic"+("?width="+d)+("&height="+d)+("&email="+encodeURIComponent(a))+("&name="+encodeURIComponent(c))}});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html",["feast"],function(a){return a.smartParse('<div qa:id="contextmenu-correspondent">\n\t<fn:var name="contact" value="{attrs.model}"/>\n\t<fn:var name="username" value="{_this.getUserName(contact)}" />\n\t<fn:var name="mobile" value="{attrs.extraDetails.mobile}"/>\n\n\t<b:list>\n\t\t<b:list-item\n\t\t\tbem:mod="pure"\n\t\t\tremit:click.prevent.stop="dummy:click"\n\t\t>\n\t\t\t<div bem:elem="avatar">\n\t\t\t\t<b:notification-badge\n\t\t\t\t\t\tshow="{attrs.isOnline}"\n\t\t\t\t\t\tcolorMode="success"\n\t\t\t\t\t\tsize="l"\n\t\t\t\t\t\tbottom="-8"\n\t\t\t\t\t\tright="8"\n\t\t\t\t\t\ttest-id="{attrs.isOnline && \'online-badge\'}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="content" bem:block="widget">\n\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\tqa:id="avatar"\n\t\t\t\t\t\t\tsize="l"\n\t\t\t\t\t\t\temail="{contact.email}"\n\t\t\t\t\t\t\tname="{contact.name}"\n\t\t\t\t\t\t\tsrc="{_this.getHighResolutionAvatar(contact)}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:notification-badge>\n\t\t\t</div>\n\t\t\t<div bem:elem="userdata" title="{username}">\n\t\t\t\t<div qa:id="username" bem:elem="name">{username}</div>\n\t\t\t\t<div qa:id="email" bem:elem="email">{contact.email}</div>\n\t\t\t\t<fn:if test="_this.isLastSeenPossible()">\n\t\t\t\t\t<b:lastseen\n\t\t\t\t\t\tloading="{attrs.checkingPossession}"\n\t\t\t\t\t\ttext="{attrs.lastSeen.status}"\n\t\t\t\t\t\tclient="{attrs.lastSeen.client_type}"\n\t\t\t\t\t\tsuccess="{attrs.isOnline}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<b:list-item qa:id="copy" ref="js-copy" radar-id="copy">\n\t\t\t<span bem:elem="ico" bem:mod="copy">\n\t\t\t\t<b:ico name="actions:copy" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Копировать адрес\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="compose"\n\t\t\tremit:click="compose:to"\n\t\t\tevent:details="contact"\n\t\t\tradar-id="compose"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="compose">\n\t\t\t\t<b:ico name="compose" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Написать письмо\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="call"\n\t\t\tfn:if="_this.canCallTo(contact)"\n\t\t\tremit:click="call:to"\n\t\t\tevent:details="contact"\n\t\t\tradar-id="call"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="call">\n\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Позвонить\')}</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="!(attrs.hideSearchButton && mobile)">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="correspondent"\n\t\t\t\tremit:click="correspondent:search"\n\t\t\t\tevent:details="{email:contact.email,model:contact.messageModel}"\n\t\t\t\tradar-id="search"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="search">\n\t\t\t\t\t<b:ico name="search" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Найти все письма\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\n\t\t<fn:if test="attrs.isShouldCheckPossession && attrs.checkingPossession">\n\t\t\t<b:list-item\n\t\t\t\tbem:mod="centering"\n\t\t\t\tqa:id="add-contact-spinner"\n\t\t\t>\n\t\t\t\t<b:spinner inline size="xs" color="additional"/>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.isShouldCheckPossession && !attrs.checkingPossession && !attrs.isInAddressbook">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="add-contact"\n\t\t\t\tremit:click="addressbook:addcontact"\n\t\t\t\tevent:details="contact"\n\t\t\t\tradar-id="add-contact"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="navigation_add_user">\n\t\t\t\t\t<b:ico name="navigation_add_user" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Добавить в контакты\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.isShouldCheckPossession && !attrs.checkingPossession && attrs.isInAddressbook && !(attrs.hideAddContactButton && mobile)">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="open-contact"\n\t\t\t\tremit:click="addressbook:opencontact"\n\t\t\t\tevent:details="contact"\n\t\t\t\tradar-id="open-contact"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="navigation_users">\n\t\t\t\t\t<b:ico name="navigation_users" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'В контактах\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html")});define("feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html"],function(a){return a});define("data-source/discounts/types",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseDiscount=exports.isDiscount=exports.isSaleArray=exports.parseSale=exports.isSale=exports.parseSaleDate=exports.isSaleDate=exports.isShortDateString=exports.isSaleValue=void 0;function a(a){return a&&typeof a==="object"&&typeof a["size"]==="number"&&!Number.isNaN(a["size"])&&a["size"]>0&&typeof a["currency"]==="string"&&a["currency"].length>0}exports.isSaleValue=a;function b(a){if(typeof a!=="string"){return false}var b=new Date(a);return!Number.isNaN(b.getTime())}exports.isShortDateString=b;function c(a){return a&&typeof a==="object"&&b(a["date"])&&typeof a["is_default"]==="boolean"}exports.isSaleDate=c;function d(a){return{is_default:a.is_default,date:new Date(a.date)}}exports.parseSaleDate=d;function e(b){return b&&typeof b==="object"&&typeof b["category"]==="string"&&a(b["discount"])&&c(b["start_date"])&&c(b["end_date"])}exports.isSale=e;function f(a){return{category:a.category,discount:a.discount,start_date:d(a.start_date),end_date:d(a.end_date)}}exports.parseSale=f;function g(a){return Array.isArray(a)&&a.length>0&&a.every(function(a){return e(a)})}exports.isSaleArray=g;function h(a){return a&&typeof a==="object"&&typeof a["description"]==="string"&&typeof a["from"]==="string"&&typeof a["max_discount_index"]==="number"&&(typeof a["from_jsonld"]==="boolean"||typeof a["from_jsonld"]==="undefined")&&(Array.isArray(a["promocodes"])||typeof a["promocodes"]==="undefined")&&b(a["received_date"])&&g(a["sale"])&&a["max_discount_index"]>=0&&a["max_discount_index"]<a["sale"].length}exports.isDiscount=h;function i(a){return{description:a.description,from:a.from,is_promo:a.from_jsonld,promocodes:a.promocodes,received_date:new Date(a.received_date),sale:a.sale.map(function(a){return f(a)}),max_discount_index:a.max_discount_index}}exports.parseDiscount=i});define("helpers/getCurrentTimestamp",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCurrentTimestamp=void 0;function a(){return Math.floor(Date.now()/1e3)}exports.getCurrentTimestamp=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/discounts/index",["require","exports","@mail/flags","@mail/xray","data-source/discounts/types","data-source/match/match","default-values","helpers/getCurrentTimestamp","mail/Folder","utils/util"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);function i(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()}var j=h.debounce(function(a){return b.default.send("discounts_count",{v:a,dwh:{discounts_viewed:a}})},2e3,null);var k=false;var l=function(){k=false};var m=function(b){var c=a.default.get(e.DISCOUNTS_FLAG_NAME);var d=c.getCount("close")%2===0;var f=n();if(b.length&&d){c.save({close:true})}if(b.length){return b}if(!d&&f){c.save({close:true,time:true});k=true;return b}if(k){return b}return undefined};var n=function(){var b=a.default.get(e.DISCOUNTS_FLAG_NAME);var c=b.getTime();if(c===0){return true}var d=f.getCurrentTimestamp();return d>c+e.DELAY_NO_DISCOUNTS_BLOCK};exports.default={match:d.default(["#attachment","#attachment-editor"]).exclude,fetch:function(a,d){var f=a.route;var h=f&&f.is("#search #search-letter");if(h){return Promise.resolve()}return Promise.all([d("status"),d("uiThreadsSettings")]).then(function(a){var d;var f=a[0],h=a[1];var k=[];var n=new Date;if(!e.DISCOUNTS_BLOCK||!h.discounts||f.folder!==g.default.NEWSLETTERS){l();return undefined}for(var o=0;o<Math.min(f.discounts.length,e.LIST_LIMIT);o++){var p=f.discounts[o];var q=p.get("discount");if(!c.isDiscount(q)){if(q!==undefined){b.default.send("discounts_invalid")}continue}var r=c.parseDiscount(q);var s=r.sale[r.max_discount_index];if(e.DISCOUNT_DESCRIPTION_FROM_SUBJECT){r.description=p.get("subject")}if(s.end_date.date>n||i(s.end_date.date,n)){k.push(__assign(__assign({},r),{sale:s,message_id:p.id,shop:(d=p.get("correspondents.from.0.name"))!==null&&d!==void 0?d:""}))}else{b.default.send("discounts_stale")}}j(k.length);return m(k)})}}});define("data-source/server-error",["require","exports","default-values","service/smokescreen"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=function(){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a.SERVER_ERROR_URL,false);d.onreadystatechange=function(){if(d.readyState!==4){return}if(d.status===200){b(d.responseText)}else{c(d)}};d.send()})};function d(){var a=window.app;if(a.view){a.view.destroy()}a.isDead=true;var d=document.createElement("STYLE");d.innerText=b.selector(".dimmer")+" {display: none !important;}";document.head.appendChild(d);var e=window["app-canvas"];c().then(function(a){e.style.height="100vh";e.innerHTML=a}).catch(function(a){e.style.height="100vh";e.style["text-align"]="center";e.innerHTML=i18n("Произошла ошибка сервера №")+(a.status?a.status:"500")+".<br/>"+i18n("Наши специалисты уже разбираются с проблемой.")})}exports.default=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/utils/logger",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DataSourceLogger=void 0;a=__importDefault(a);var b=function(){function b(){this.isLogging=true;this.entries=[]}b.prototype.addEntry=function(a){if(!this.isLogging){return}this.entries.push({action:a})};b.prototype.stopLogging=function(){if(!this.isLogging){return}this.isLogging=false;if(!this.entries.length){return}b.sendLog(this.entries)};b.sendLog=function(b){a.default.send("datasource_log",{rlog:"octavius_datasource_log",rlog_message:b})};return b}();exports.DataSourceLogger=b});define("helpers/delete-emoji-in-string",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasEmoji=exports.deleteEmoji=void 0;var a=/[^-\s](\u00A9|\u00AE|[\u2000-\u3300]|\uD83C[\uD000-\uDFFF]|\uD83D[\uD000-\uDFFF]|\uD83E[\uD000-\uDFFF])[^-\s][^&]/;var b=/\s(\u00A9|\u00AE|[\u2000-\u3300]|\uD83C[\uD000-\uDFFF]|\uD83D[\uD000-\uDFFF]|\uD83E[\uD000-\uDFFF])\s/g;var c=/(\u00A9|\u00AE|[\u2000-\u3300]|\uD83C[\uD000-\uDFFF]|\uD83D[\uD000-\uDFFF]|\uD83E[\uD000-\uDFFF])/g;var d=/[^\s]/;function e(e){var f=e.match(a);while(f){var g=f[0],h=f[1];e=e.replace(g,g.replace(h," "));f=e.match(a)}e=e.replace(b," ");e=e.replace(c,"");var i=String.fromCharCode(65039);while(e.includes(i)){e=e.replace(i,"")}return d.test(e)?e:""}exports.deleteEmoji=e;function f(a){return c.test(a)}exports.hasEmoji=f});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/mailbox/loader",["require","exports","default-values","Emitter","mail/Folder","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isJSSDKCompliantObject=exports.SecureFolderNotOpenError=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);function e(a){Error.call(this);this.name="Secure Folder Not Open Error";this.folderId=a;if(Error.captureStackTrace){Error.captureStackTrace(this,e)}else{this.stack=new Error("empty").stack}}exports.SecureFolderNotOpenError=e;e.prototype=Object.assign(Object.create(Error.prototype),{constructor:e,getFolderId:function(){return this.folderId}});function f(a){return!!(a&&typeof a==="object"&&typeof a.is==="function"&&typeof a.get==="function")}exports.isJSSDKCompliantObject=f;var g=function(b){__extends(g,b);function g(){var a=b.call(this)||this;a.rpcRequestResults={};a.foldersLastModified={};a.latestFoldersList=null;return a}g.getCacheKey=function(a){var b,c;var d=Object.keys(a.filters||{});d.sort();return""+a.folder+":"+a.offset+":"+a.limit+":"+d.join("")+":"+(((b=a.sort)===null||b===void 0?void 0:b.type)+"-"+((c=a.sort)===null||c===void 0?void 0:c.order))};g.getTimestamp=function(){return Math.floor(Date.now()*.001)};g.prototype.load=function(b){var h=this;b.folder=parseInt(b.folder||0,10);b.offset=b.offset||0;b.limit=b.limit||a.LIST_LIMIT;b.filters=b.filters||{};b.sort=b.sort||{};var i=c.default.all.get(b.folder);if(i&&!i.isSecureOpen()){return Promise.reject(new e(i.get("id")))}var j=g.getCacheKey(b);var k=g.getTimestamp();var l=this.foldersLastModified[j];if(k===l){l--}var m=!i||i.isNewsletters();var n=__assign(__assign({folder:b.folder,limit:b.limit,filters:b.filters,sort:b.sort,last_modified:b.time||l||1,force_custom_thread:a.FORCE_CUSTOM_THREAD,supported_custom_metathreads:a.SUPPORTED_CUSTOM_METATHREADS},m&&{pinned_limit:a.DISCOUNTS_BLOCK?a.DISCOUNTS_BLOCK_LIMIT:0}),a.FOLDERS_SORT_VARIATION&&{folders_sort_variation:a.FOLDERS_SORT_VARIATION});if(b.offset_id){n.offset_id=b.offset_id;delete n.last_modified}else{n.offset=b.offset}return d.default.get("threads/status/smart",n).catch(function(b){var c=h.rpcRequestResults[j];var e=b.get("status");var g=b.get("body");if(e===403&&g==="twostep_required"){window.location.href=a.TWO_STEP_ENABLE_URL}if(e===403&&g==="password_expired"){window.location.href=a.CHANGE_EXPIRED_PASSWORD_URL}if(!f(b)||e!==304&&e!==500){throw b}if(h.latestFoldersList&&c){return __assign(__assign({},c),{folders:h.latestFoldersList})}if(e===500){throw b}return d.default.get("threads/status/smart",__assign(__assign({},n),{last_modified:1}))}).catch(function(a){if(f(a)&&a.is("invalid")&&a.get("body.folder.error")==="not_open"){throw new e(n.folder)}throw a}).then(function(a){if(f(a)){a={folders:a.body.folders,userGrants:a.body.user_grants,threads:a.body.threads,threadsTotal:a.body.threads_total,mboxSize:a.body.mbox_size,collectors:a.body.collectors,lastModified:a.get("lastModified"),discounts:a.body.discounts}}h.rpcRequestResults[j]=a;h.latestFoldersList=a.folders;h.foldersLastModified[j]=a.lastModified;return a})};g.prototype.invalidateCache=function(){this.rpcRequestResults={};this.foldersLastModified={}};return g}(b.default);var h=new g;exports.default=h});define("service/page-lifecycle",["exports","default-values","Emitter","page-lifecycle"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function i(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function j(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var k=function(b){j(c,b);function c(){g(this,c);var a=i(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.default.addEventListener("statechange",a.stateChange.bind(a));return a}h(c,[{key:"init",value:function a(b){this.router=b}},{key:"stateChange",value:function b(c){var d=c.oldState,e=c.newState;if(!this.router){return}var f=d==="passive"&&e==="active";var g=this.router.model.status&&this.router.model.status.lastUpdateTime;var h=g&&Date.now()-g>a.INACTIVE_TAB_RELOAD_DURATION*1e3;if(f&&h){this.emit("pagelifecycle:reload")}}}]);return c}(d.default);var l=new k;exports.default=l});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/Alias",["require","exports","RPCModel"],function(require,exports,a){"use strict";a=__importDefault(a);var b=a.default.extend({className:"mail.Alias",defaults:{alias:""},findUrl:"aliases",addUrl:"aliases/add",removeUrl:"aliases/remove",saveUrl:"aliases/edit",alwaysSendAllAttributes:true,canSendLetters:function(){return true},getEmail:function(){return this.get("alias")},getOwnerFullName:function(){return null},isShared:function(){return false},isAnonymous:function(){return!this.meta("isPDD")&&!this.is("permanent")},isPermanent:function(){return this.is("permanent")}});b.version="0.2.0";exports.default=b;return b});define("data-source/source/aliases",["exports","data-source/match/match","mail/Alias","service/radars/index","@mail-core/dashboard"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}var i=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.default={match:(0,e.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c,e,h){if(h&&h.aliases){return h.aliases}return d.userKeeper.group("app-fetch-alias",function(){return Promise.all([c("authUser"),f.default.find()]).then(function(a){var b=i(a,2),c=b[0],d=b[1];var e=d.toArray();e.forEach(function(a){a.meta("isPDD",c.isPDD())});return e}).catch(function(){(0,g.default)(["aliases","load","failed"]);return[]})},{score:"fetch"})}}});define("helpers/decode-uri-component",["exports","logger","service/radars/index"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a){try{return decodeURIComponent(a)}catch(b){c.default.add("decodeURIComponent.error",{error:b,url:a});(0,d.default)(["decode-uri-component","error"]);return null}};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}});define("data-source/source/attachment",["exports","helpers/decode-uri-component"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={match:["#attachment"],defaults:null,fetch:function a(c,d){return d("message").then(function(a){var d=(0,b.default)(c.params.id);var e=a.get("attaches.list");return e.getSafe(d)})}}});define("data-source/source/attachment-temporary",["exports","helpers/decode-uri-component","mail/Attachment"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:["#attachment-temporary"],fetch:function a(b){var e=b.params.message;var f=(0,c.default)(b.params.id);return d.default.findTemporary({message_id:e}).then(function(a){return{list:a,attachment:a.get(f)}})}}});define("data-source/source/authUser",["exports","service/auth"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={fetch:function a(){return b.default.user}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/bills-counter",["require","exports","service/storage"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.STORAGE_KEY=void 0;a=__importDefault(a);exports.STORAGE_KEY="bills-counter";var b={handleLoad:function(a,b,c){if(c){return __assign(__assign({},a),{hasNewPayments:!!a.total,hasPaidPaymentsWithNoNew:false})}var d=a.unpaidFines>b.unpaidFines;var e=a.unpaidBills>b.unpaidBills;var f=d||e;var g=a.unpaidFines<b.unpaidFines;var h=a.unpaidBills<b.unpaidBills;var i=!f&&(h||g);return __assign(__assign({},a),{hasNewPayments:f,hasPaidPaymentsWithNoNew:i})},set:function(b){a.default.set(exports.STORAGE_KEY,b)},get:function(){return a.default.get(exports.STORAGE_KEY)}};exports.default=b});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/bills-count",["require","exports","@mail/flags","data-source/actions","data-source/match/match","default-values","mail/User","service/bills-counter","service/radars/index"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default={match:c.default(["#attachment","#attachment-editor"]).exclude,fetch:function(c,h,i,j){var k;if(!d.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){return Promise.resolve({})}var l=(k=j===null||j===void 0?void 0:j.billsCount)!==null&&k!==void 0?k:f.default.get();var m=i.type,n=i.state;if(m===b.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE){f.default.set(n);return Promise.resolve(n)}var o=!(l===null||l===void 0?void 0:l.timestamp);var p=Math.floor(Date.now()/1e3);var q=o||p-l.timestamp>d.BILLS_COUNTER_UPDATE_INTERVAL;if(!q){return Promise.resolve(l)}return e.default.findBillsCount().then(function(b){var c;var d=f.default.handleLoad(b,l,o);var e=d.hasNewPayments,g=d.hasPaidPaymentsWithNoNew;var h=e?false:!!g;if(e||g){(c=a.default.get("octavius-sidebar-pay-notification-badge-smart"))===null||c===void 0?void 0:c.save({state:h})}var i=__assign(__assign({},d),{timestamp:p});f.default.set(i);return i}).catch(function(){g.default("user-paymentdata-err");return{}})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/Collector",["require","exports","Model","utils/util"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=/^(extra_auth|pause|auth_error)$/;var d=a.default.extend({className:"mail.Collector",defaults:{email:"",state:"",type:"",owner:null},canSendLetters:function(){return!c.test(this.get("state"))},getEmail:function(){return this.get("email")},getOwnerFullName:function(){var a=this.get("owner");if(!a){return null}return b.default.calculateFullName({first:a.first_name,last:a.last_name})},isShared:function(){return this.get("type")==="shared"},isAnonymous:function(){return false},isPermanent:function(){return false}});d.version="0.2.0";exports.default=d;return d});define("data-source/source/collectors",["exports","data-source/match/match","mail/Collector"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c){return c("status").then(function(a){return(a.collectors||[]).map(function(a){return new d.default(a)})})}}});define("data-source/source/folder",["exports","data-source/match/match","mail/Folder"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c){return c("folders").then(function(a){if(a){return d.default.all.get(b.params.folder)}return d.default.findOne({id:b.params.folder})})}}});define("data-source/source/folders",["exports","data-source/match/match","mail/Folder"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c){return c("status").then(function(a){return a.folders||d.default.find()})}}});define("data-source/source/hidden-payment-dies",["exports","data-source/match/match","../../service/storage","../actions"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var i="hidden-payment-dies";exports.default={match:(0,d.default)(["#letters","#read-letter"]),fetch:function a(b,d,f,j){var k=j&&j.hiddenPaymentDies||e.default.get(i)||{};if(f.type===c.HIDE_PAYMENT_DIE){var l=h({},k,g({},f.uidl,""));e.default.set(i,l);return l}return k}}});define("data-source/source/jssdk-action",["exports","data-source/actions","data-source/match/match"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(b);function d(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function b(c,d,e){if(!e||e.type!==a.EXECUTE_JSSDK_ACTION){return Promise.resolve()}var f=e.action;return f.execute(e.params)}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/SharedMailbox",["require","exports","utils/util","RPCModel"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=b.default.extend({className:"mail.SharedMailbox",findUrl:"user/shared-mailboxes",defaults:{owner:{},permissions:{},system_folders:{}},checkGrant:function(a){return Boolean(this.get("permissions")[a])},getRootFolder:function(){var a=this.get("system_folders").root;return a?String(a):null},getOwnerEmail:function(){return this.get("owner").email}});c.List.fn.getMailboxesByGrant=function(a){var b=[];var c=this.length;while(c--){if(this[c].checkGrant(a)){b.push(this[c])}}return b};c.List.fn.getMailboxByEmail=function(a){var b=this.length;while(b--){if(this[b].get("owner").email===a){return this[b]}}return null};a.default.extend(c,{GRANTS:{create_toplvl_flds:"create_toplvl_flds",write:"write"}});c.version="1.0.0";exports.default=c;return c});define("models/metathread/metathread",["exports","default-values","mail/Thread","Model"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}var g=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var h=d.default.extend({className:"models.Metathread",constructor:function b(){d.default.prototype.constructor.apply(this,arguments);this.set({_metathreadExpanded:false,_metathreadLimit:a.METATHREAD_LIMIT,_metathreadIsLimitReached:true})},isExpanded:function a(){return this.get("_metathreadExpanded")},setExpanded:function a(b){var c=b!==this.get("_metathreadExpanded");if(c&&b&&this.get("metathread_data.new_cnt")){this.set("metathread_data.new_cnt",0)}this.set("_metathreadExpanded",b)},getMetathreadFolder:function a(){return this.get("metathread_data.folder")},getMetathreadFolderName:function a(){return this.get("metathread_data.folder_name")},setLimit:function b(){var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:a.METATHREAD_LIMIT;this.set("_metathreadLimit",c)},getLimit:function a(){return this.get("_metathreadLimit")},isLimitReached:function a(){return this.is("_metathreadIsLimitReached")},setLimitReached:function a(b){this.set("_metathreadIsLimitReached",b)},getFooterModel:function a(){if(this._footer){return this._footer}this._footer=new e.default;this._footer.set({metathreadFooter:true,metathread:this,id:"footerId"+this.id});return this._footer},isToMyself:function a(){return this.get("metathread_data.category")==="tomyself"}});h.isMetathread=function a(b){if(!b||(typeof b==="undefined"?"undefined":g(b))!=="object"){return}if(typeof b.get==="function"){var c=b;return c.is("flags.metathread")&&c.is("metathread_data.folder")}var d=b;return!!(d.flags&&d.flags.metathread&&d.metathread_data&&d.metathread_data.folder)};h.isMetathreadFooter=function a(b){return!!(b&&b.get("metathreadFooter"))};h.patchThreadId=function a(b){if(typeof b.get!=="function"){b.id="multithreadFixId"+b.metathread_data.folder}};exports.default=h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("route/utils/filter-query",["require","exports","cfgUser","default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var c="filter_";var d="all";var e="sort";var f="D";var g={D:{type:"date",order:"desc"},F:{type:"from",order:"desc"},S:{type:"subject",order:"desc"},d:{type:"date",order:"asc"},f:{type:"from",order:"asc"},s:{type:"subject",order:"asc"}};var h={all:true,unread:false,flagged:false,with_attachments:false};var i=a.default.get("initialUser.messages.sort");var j=Object.keys(g).find(function(a){return g[a].type===i.type&&g[a].order===i.order})||f;var k=b.ENABLE_SORTING?j:undefined;exports.default={getQuery:function(a){var b={};Object.entries(h).forEach(function(a){var e=a[0],f=a[1];if(e!==d&&f){b[""+c+e]=1}});if(a){b[e]=k}return b},getFilterConfig:function(){return h},getSortingType:function(){return k},toggleFilter:function(a){if(h.hasOwnProperty(a)){h[a]=!h[a]}},applyFilter:function(a){if(!b.ENABLE_MULTIPLE_FILTERS){Object.keys(h).forEach(function(a){h[a]=false});this.toggleFilter(a)}else{this.toggleFilter(a);var c=Object.entries(h).filter(function(a){var b=a[0],c=a[1];return b!==d&&c});if(c.length){h.all=false}else{h.all=true}}},applySorting:function(a){k=a||f},resetFilters:function(){Object.keys(h).forEach(function(a){h[a]=false});h.all=true},resetSorting:function(){this.applySorting(f)},set:function(a){var f=Object.keys(a).filter(function(a){return a.startsWith(c)});if(f.length){if(b.ENABLE_MULTIPLE_FILTERS){var i=false;f.forEach(function(a){var b=a.replace(c,"");if(h.hasOwnProperty(b)&&b!==d){h[b]=true;i=true}});if(i){h.all=false}}else{var j=f[0].replace(c,"");if(h.hasOwnProperty(j)&&j!==d){this.applyFilter(j)}}}else{this.resetFilters()}if(b.ENABLE_SORTING&&a[e]&&g[a[e]]){this.applySorting(a[e])}},has:function(){return!!Object.entries(h).filter(function(a){var b=a[0],c=a[1];return b!==d&&c}).length},isFilter:function(a){return h[a]},get:function(){if(h.all){return{}}var a={};Object.entries(h).forEach(function(b){var c=b[0],e=b[1];if(c!==d&&e){a[c]=e}});return a},getSorting:function(){return g[k]||{}},isLetterInFilter:function(a){return!this.has()||this.isFilter("flagged")&&a.is("flags.flagged")||this.isFilter("unread")&&a.is("flags.unread")||this.isFilter("with_attachments")}}});define("helpers/data-source-dispatch",["require","exports","data-source/actions"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.dispatchAndWait=void 0;function b(b,c){if(b===void 0){b={type:a.UPDATE_ALL}}var d=c===void 0?{}:c,e=d.waitForAppLoad,f=e===void 0?false:e;return new Promise(function(a){require(["data-source/index"],function(c){if(c.default){c=c.default}if(f){c.loadPromise().then(function(){a(c.dispatch(b))})}else{a(c.dispatch(b))}})})}exports.default=b;function c(a){return new Promise(function(b,c){require(["data-source/index"],function(d){if(d.default){d=d.default}d.dispatch(a).then(function(a){d.one("afterchange",function(){b(a)})}).catch(c)})})}exports.dispatchAndWait=c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("feast-mod/utils",["require","exports","@mail/xray","cfgUser"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatDate=exports.isToday=exports.getLocale=exports.TRANSLATE_STRINGS_TO_MOMENT=exports.NAMED_DAYS=exports.capitalize=void 0;a=__importDefault(a);b=__importDefault(b);var c=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};exports.capitalize=c;exports.NAMED_DAYS={TODAY:i18n("сегодня"),YESTERDAY:i18n("вчера")};exports.TRANSLATE_STRINGS_TO_MOMENT={today:i18n("сегодня"),tomorrow:i18n("завтра"),yesterday:i18n("вчера")};var d=function(a){if(a===void 0){a=b.default.LANG||"ru-RU"}return a.replace(/_/g,"-")};exports.getLocale=d;try{(new Date).toLocaleString(exports.getLocale(),{day:"numeric",month:"short"})}catch(b){a.default.send("date-tolocalestring-err");Date.prototype.toLocaleString=function(a,b){var c=!!(b&&b.day);var d=!!(b&&b.hour);var e=c===d;return(e||c?[this.getDate().toString().padStart(2,"0"),(this.getMonth()+1).toString().padStart(2,"0"),this.getFullYear().toString().slice(2)].join("."):"")+(e?", ":"")+(e||d?this.getHours()+":"+this.getMinutes().toString().padStart(2,"0"):"")}}function e(a){var b=new Date;return b.getFullYear()===a.getFullYear()&&b.getMonth()===a.getMonth()&&b.getDate()===a.getDate()}exports.isToday=e;var f=function(a,b,c){var d;var e=a.findIndex(function(a){var c=a.type;return b===c});var f=a.findIndex(function(a){var b=a.type;return c===b});if(e>f){d=[f,e],e=d[0],f=d[1]}if(e===-1||e===f){return undefined}return a[e+1].type==="literal"&&a.slice(e+2,f).every(function(b){var c=b.type,d=b.value;return c!=="literal"||d===a[e+1].value})?a[e+1].value:undefined};var g=false;function h(a){return[{type:"weekday",value:"#"+(a.getDay()+1)},{type:"literal",value:", "},{type:"day",value:a.getDate().toString().padStart(2,"0")},{type:"literal",value:"."},{type:"month",value:(a.getMonth()+1).toString().padStart(2,"0")},{type:"literal",value:"."},{type:"year",value:a.getFullYear().toString().slice(-2)},{type:"literal",value:", "},{type:"hour",value:a.getHours().toString().padStart(2,"0")},{type:"literal",value:":"},{type:"minute",value:a.getMinutes().toString().padStart(2,"0")},{type:"literal",value:":"},{type:"second",value:a.getSeconds().toString().padStart(2,"0")}]}function i(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return g?{formatToParts:h}:Intl.DateTimeFormat.apply(Intl,a)}function j(b){var c;a.default.send("intl-datetimeformat-err-"+b,{i:(c={},c["fb-"+g]=1,c),skipdwh:true});g=true}try{i(exports.getLocale(),{day:"numeric",month:"numeric",year:"numeric",hour12:false}).formatToParts(new Date)}catch(a){j("c1")}try{i(exports.getLocale(),{day:"numeric",month:"long",year:"numeric",hour12:false}).formatToParts(new Date)}catch(a){j("c2")}var k=function(b,c,d){var e,h;if(d===void 0){d={}}c=c.filter(function(a){var b=a[1];return b!==undefined});var k;try{k=i((e=d.locale)!==null&&e!==void 0?e:exports.getLocale(),__assign(__assign(__assign({},Object.fromEntries(c)),{hour12:false}),d.intlOptions)).formatToParts(b)}catch(e){a.default.send("formatdate-err",{rlog:"formatdate",rlog_message:{e:e,isFallbackDateTimeFormat:g}});j("run");k=i((h=d.locale)!==null&&h!==void 0?h:exports.getLocale(),__assign(__assign(__assign({},Object.fromEntries(c)),{hour12:false}),d.intlOptions)).formatToParts(b)}var l=Object.fromEntries(k.filter(function(a){var b=a.type;return b!=="literal"}).map(function(a){var b=a.type,c=a.value;return[b,c]}));return c.flatMap(function(a,b){var e,g,h,i;var j=a[0],m=a[1];var n=(g=(e=d.literalAfter)===null||e===void 0?void 0:e[j])!==null&&g!==void 0?g:b+1<c.length?(i=(h=d.literalBefore)===null||h===void 0?void 0:h[c[b+1][0]])!==null&&i!==void 0?i:f(k,j,c[b+1][0]):undefined;return[j==="hour"&&l[j]==="24"?m==="2-digit"?"00":"0":l[j],n&&(!d.maxLengthLiteral||d.maxLengthLiteral>=n.length)?n:" "]}).join("").trim()};exports.formatDate=k});define("helpers/date-range",["exports","../feast-mod/utils"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DateRangeValue=exports.DateRangeKeysMap=exports.QueryKeysMap=exports.DateRangeRole=undefined;exports.dateToSeconds=k;exports.secondsToDate=l;var b=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var c=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var f;function g(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var h=86400*1e3;var i=1e3;var j=10*1e3;function k(a){return Math.round(a.getTime()/i)}function l(a){return a*i}var m=exports.DateRangeRole={FROM:"from",TO:"to"};var n=exports.QueryKeysMap={QUERY:"q_query",SUBJECT:"q_subj",FOLDER:"q_folder",CATEGORY:"q_tcategory",CC_FROM:"q_from",CC_TO:"q_to",FLAG_UNREAD:"q_read",FLAG_FLAGGED:"q_flag",FLAG_ATTACH:"q_attach",INTERVAL_DATE:"q_date",INTERVAL_DATE_LAPSE:"q_date_lapse"};var o=exports.DateRangeKeysMap=(f={},g(f,m.FROM,{year:"dyb",month:"dmb",day:"ddb"}),g(f,m.TO,{year:"dye",month:"dme",day:"dde"}),f);function p(a,b){var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:j;return Math.abs(a-b)<c}var q=exports.DateRangeValue=function(){function a(b,c){d(this,a);this.date=b;this.role=c;if(typeof b==="number"){this.date=new Date(b)}}e(a,[{key:"toQuery",value:function a(){var b;var c=this.date,d=this.role;return b={},g(b,o[d].year,c.getFullYear()),g(b,o[d].month,c.getMonth()+1),g(b,o[d].day,c.getDate()),b}},{key:"normalize",value:function a(){switch(this.role){case m.FROM:{this.date.setHours(0);this.date.setMinutes(0);this.date.setSeconds(0);break}case m.TO:{this.date.setHours(23);this.date.setMinutes(59);this.date.setSeconds(59)}}return this}},{key:"equals",value:function a(b){return this.role===b.role&&this.date.getTime()===b.date.getTime()}},{key:"equalsEpsilon",value:function a(b){return this.role===b.role&&p(this.date.getTime(),b.date.getTime())}}],[{key:"fromQuery",value:function b(c,d){var e=o[d],f=e.year,g=e.month,h=e.day;if(c[f]==null||c[g]==null||c[h]==null){return null}var i=new Date;i.setFullYear(parseInt(c[f],10),parseInt(c[g],10)-1,parseInt(c[h],10));return new a(i,d)}}]);return a}();var r=function(){function f(a,b){d(this,f);this.from=a;this.to=b}e(f,[{key:"normalize",value:function a(){this.from.normalize();this.to.normalize();return this}},{key:"toDateAndLapse",value:function a(){var b=this.from.date.getTime();var c=this.to.date.getTime();var d=Math.round(.5*(b+c));var e=d-b;var f=new Date(d);var g=Math.floor(e/h)||0;return{date:f,lapse:g}}},{key:"toDateAndDateEnd",value:function a(){var b=this.from.date.getTime();var c=this.to.date.getTime();var d=0;var e=new Date(b);var f=new Date(c);if(p(b,c,h)){f=null}return{date:e,dateEnd:f,lapse:d}}},{key:"toQuery",value:function b(){var d;var e=this.toDateAndLapse(),f=e.date,h=e.lapse;return c({},this.from.toQuery(),this.to.toQuery(),(d={},g(d,n.INTERVAL_DATE,(0,a.formatDate)(f,[["day","2-digit"],["month","2-digit"],["year","numeric"]],{literalAfter:{day:".",month:"."}})),g(d,n.INTERVAL_DATE_LAPSE,h),d))}},{key:"toRPCInterval",value:function a(){return{from:k(this.from.date),to:k(this.to.date)}}},{key:"equals",value:function a(b){return this.from.equals(b.from)&&this.to.equals(b.to)}},{key:"equalsEpsilon",value:function a(b){return this.from.equalsEpsilon(b.from)&&this.to.equalsEpsilon(b.to)}}],[{key:"fromDateAndLapse",value:function a(c){var d=c.date,e=c.dateEnd,g=c.lapse;if(typeof d==="string"){var i=d.split("."),j=b(i,3),k=j[0],l=j[1],n=j[2];d=new Date(parseInt(n,10),parseInt(l,10)-1,parseInt(k,10),12,0,0,0)}var o=d.getTime();var p=g*h;var r=o-p;var s=o+p;if(e){var t=e.getTime();r=o;s=t}return new f(new q(r,m.FROM).normalize(),new q(s,m.TO).normalize())}},{key:"fromQuery",value:function a(b){var c=b[n.INTERVAL_DATE];var d=parseInt(b[n.INTERVAL_DATE_LAPSE],10)||0;if(c){return f.fromDateAndLapse({date:c,lapse:d})}var e=new f(q.fromQuery(b,m.FROM),q.fromQuery(b,m.TO));if(e.from!==null&&e.to!==null){return e.normalize()}return null}},{key:"fromRPCInterval",value:function a(b){return new f(new q(l(b.from),m.FROM),new q(l(b.to),m.TO))}}]);return f}();exports.default=r});define("state-tree/search-operand/utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchOperandType=void 0;exports.SearchOperandType={FILTER:"filter",CATEGORY:"category",QUERY:"query",FOLDER:"folder",DATE:"date",MESSAGE:"message",MAILBOX:"mailbox"}});var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search/utils",["require","exports","@mail/operands","@octo/smart-input","helpers/date-range","mail/Folder","state-tree/search-operand/utils"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.findOperandIndex=exports.findOperand=exports.reconcileOperandsList=exports.isInMailbox=exports.searchQueriesEqual=exports.deriveFlagsFromOperand=exports.deriveSearchQueryFromOperand=void 0;c=__importDefault(c);d=__importDefault(d);function f(b,c){switch(c.subtype){case a.OperandQueryTypes.FROM:{b.correspondents=b.correspondents||{};b.correspondents.from=c.value;break}case a.OperandQueryTypes.TO:{b.correspondents=b.correspondents||{};b.correspondents.to=c.value;break}case a.OperandQueryTypes.SUBJECT:{b.subject=c.value;break}case a.OperandQueryTypes.QUERY:{b.query=c.value;break}}}exports.deriveSearchQueryFromOperand=f;function g(b,c){switch(c.subtype){case a.OperandFilterTypes.UNREAD:{b.flags=b.flags||{};b.flags.unread=true;break}case a.OperandFilterTypes.FLAGGED:{b.flags=b.flags||{};b.flags.flagged=true;break}case a.OperandFilterTypes.ATTACH:{b.flags=b.flags||{};b.flags.attach=true;break}}}exports.deriveFlagsFromOperand=g;function h(a,b){return Object.keys(a).every(function(d){if(a[d]===b[d]){return true}if(d==="flags"&&b.flags){var e=a.flags;var f=b.flags;return e.unread===f.unread&&e.flagged===f.flagged&&e.attach===f.attach}if(d==="correspondents"&&b.correspondents){var g=a.correspondents;var h=b.correspondents;return g.from===h.from&&g.to===h.to}if(d==="interval"&&b.interval){var i=c.default.fromRPCInterval(a.interval).normalize();var j=c.default.fromRPCInterval(b.interval).normalize();return i.equals(j)}return false})}function i(a,b){return h(a,b)&&h(b,a)}exports.searchQueriesEqual=i;function j(b,f,g,h){switch(g.type){case e.SearchOperandType.FILTER:{var i=b.flags&&(g.subtype===a.OperandFilterTypes.UNREAD&&b.flags.unread||g.subtype===a.OperandFilterTypes.FLAGGED&&b.flags.flagged||g.subtype===a.OperandFilterTypes.ATTACH&&b.flags.attach);if(!i){h.push(g)}return"flags."+g.subtype}case e.SearchOperandType.CATEGORY:{if(!b.transaction_category){h.push(g)}return"transaction_category"}case e.SearchOperandType.QUERY:{var i=g.subtype===a.OperandQueryTypes.SUBJECT&&b.subject!==void 0||g.subtype===a.OperandQueryTypes.QUERY&&b.query!==void 0||b.correspondents&&(g.subtype===a.OperandQueryTypes.FROM&&b.correspondents.from!==void 0||g.subtype===a.OperandQueryTypes.TO&&b.correspondents.to!==void 0);var j=g.subtype===a.OperandQueryTypes.FROM||g.subtype===a.OperandQueryTypes.TO;if(!i){return h.push(g)}if(j){g.setValue(b.correspondents[g.subtype])}else{g.setValue(b[g.subtype])}if(j){return"correspondents."+g.subtype}return g.subtype}case e.SearchOperandType.FOLDER:{var k=d.default.all.get(b.folder);if(!k){h.push(g);return e.SearchOperandType.FOLDER}if(k.isServiceShared()){h.push(g);return e.SearchOperandType.FOLDER}if(g.value!==b.folder){g.setValue(b.folder)}return e.SearchOperandType.FOLDER}case e.SearchOperandType.DATE:{var i=b.interval!==void 0;if(!i){h.push(g)}else{var l=c.default.fromDateAndLapse(g.value).normalize();var m=c.default.fromRPCInterval(b.interval).normalize();if(!l.equals(m)){g.setValue(m.toDateAndLapse())}}return"interval"}case e.SearchOperandType.MAILBOX:{var k=d.default.all.get(b.folder);if(!k){h.push(g)}if(k.isServiceShared()&&g.value.id.toString()!==k.get("id").toString()){g.setValue({id:k.get("id"),name:k.get("owner").name,email:k.get("owner").email})}return e.SearchOperandType.FOLDER}}}function k(a,b){if(!a||!b||!b.isServiceShared()){return false}if(!a.get("owner")||!b.get("owner")){return false}return a.get("owner").email===b.get("owner").email}exports.isInMailbox=k;function l(a,c){var d=c.type,e=c.subtype,f=c.value;a[b.SmartInputActions.PUSH]({current:{type:d,subtype:e,value:f}})}function m(a,f){var g={};var h=[];__spreadArrays(a.operands).forEach(function(b){var c=j(f,a,b,h);g[c]=true});h.forEach(function(c){var d=a.operands.findIndex(function(a){return a===c});if(d>=0){a[b.SmartInputActions.SPLICE](d,1)}});function i(b,f){if(g[b]||f===void 0){return}g[b]=true;switch(b){case"folder":{var h=d.default.all.get(f);if(h.isShareTake()){var i=d.default.all.find(function(a){return k(h,a)});l(a,{type:e.SearchOperandType.MAILBOX,value:{id:i.get("id"),name:h.get("owner").name,email:h.get("owner").email}})}if(!h.isServiceShared()){l(a,{type:e.SearchOperandType.FOLDER,value:f})}break}case"transaction_category":{return l(a,{type:e.SearchOperandType.CATEGORY,subtype:f})}case"interval":{return l(a,{type:e.SearchOperandType.DATE,value:c.default.fromRPCInterval(f).toDateAndLapse()})}case"subject":case"query":{return l(a,{type:e.SearchOperandType.QUERY,subtype:b,value:f})}case"flags.unread":case"flags.flagged":case"flags.attach":{return f&&l(a,{type:e.SearchOperandType.FILTER,subtype:b.split(".")[1]})}case"correspondents.from":case"correspondents.to":{return l(a,{type:e.SearchOperandType.QUERY,subtype:b.split(".")[1],value:f})}}}Object.keys(f).forEach(function(a){if(a==="flags"||a==="correspondents"){Object.keys(f[a]||{}).forEach(function(b){return i(a+"."+b,f[a][b])})}else{i(a,f[a])}})}exports.reconcileOperandsList=m;function n(a,b,c){return a.operands.find(function(a){return a.type===b&&a.subtype===c})}exports.findOperand=n;function o(a,b,c){return a.operands.findIndex(function(a){return a.type===b&&a.subtype===c})}exports.findOperandIndex=o});define("state-tree/search-operand/search-operand",["exports","@mail/operands","mobx-state-tree","./utils"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchMailboxOperand=exports.SearchDateOperand=undefined;var d=exports.SearchDateOperand=b.types.model("SearchDateOperand",{date:b.types.Date,dateEnd:b.types.maybe(b.types.union(b.types.Date,b.types.null)),lapse:b.types.optional(b.types.number,0)});var e=exports.SearchMailboxOperand=b.types.model("SearchMailboxOperand",{id:b.types.union(b.types.number,b.types.string),email:b.types.string});var f=b.types.model("SearchOperandState",{type:b.types.enumeration(Object.values(c.SearchOperandType)),subtype:b.types.maybe(b.types.union(b.types.enumeration(Object.values(a.OperandFilterTypes)),b.types.enumeration(Object.values(a.OperandCategoryTypes)),b.types.enumeration(Object.values(a.OperandQueryTypes)))),value:b.types.maybe(b.types.union(b.types.string,b.types.number,d,e,b.types.undefined))}).actions(function(a){return{setType:function b(c){a.type=c},setSubtype:function b(c){a.subtype=c},setValue:function b(c){a.value=c}}});var g=b.types.model("SearchOperand",{current:f,next:b.types.maybe(f)}).views(function(a){return{get type(){return a.current.type},get subtype(){return a.current.subtype},get value(){return a.current.value},get editing(){return!!a.next}}}).actions(function(a){return{applyChanges:function c(){var d=a.next;if(!a.editing){return}a.current.type=d.type;a.current.subtype=d.subtype;a.current.value=(0,b.isStateTreeNode)(d.value)?(0,b.getSnapshot)(d.value):d.value;a.next=void 0},setType:function b(c){a.applyChanges();a.current.type=c},setSubtype:function b(c){a.applyChanges();a.current.subtype=c},setValue:function c(d){if(d===a.value){return}a.next=a.next||(0,b.getSnapshot)(a.current);a.next.value=d}}});exports.default=g});define("state-tree/search-interval/search-interval",["exports","helpers/date-range","mobx-state-tree"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(a);function d(a){return a&&a.__esModule?a:{default:a}}var e=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var f=b.types.model("SearchInterval",{from:b.types.number,to:b.types.maybe(b.types.number)}).preProcessSnapshot(function(b){if(!b){return b}var d=e({},b,{to:b.to||(0,a.dateToSeconds)(new Date)});return c.default.fromRPCInterval(d).normalize().toRPCInterval()});exports.default=f});define("state-tree/search-response/search-response",["exports","mail/Folder","mobx-state-tree","state-tree/search-interval/search-interval"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchFolder=exports.SearchDatesTypes=undefined;var d=f(a);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}var g=exports.SearchDatesTypes={TODAY:"today",YESTERDAY:"yesterday",WEEK:"week",MONTH:"month",MONTHS:"months",YEARS:"years"};var h=b.types.model("SearchDate",{found:b.types.number,interval:e.default});var i=b.types.model("SearchDates",{today:b.types.maybe(h),yesterday:b.types.maybe(h),week:b.types.maybe(h),month:b.types.maybe(h),months:b.types.optional(b.types.array(h),[]),years:b.types.optional(b.types.array(h),[])}).views(function(a){return{get all(){var b=[];Object.values(g).forEach(function(c){var d=a[c];if(!d){return}if(c===g.MONTHS||c===g.YEARS){d.forEach(function(a){if(!a.found){return}b.push({type:c,found:a.found,from:a.interval.from,to:a.interval.to})});return}if(!d.found){return}b.push({type:c,found:d.found,from:d.interval.from,to:d.interval.to})});return b}}});var j=exports.SearchFolder=b.types.model("SearchFolder",{found:b.types.optional(b.types.number,0),id:b.types.string,name:b.types.optional(b.types.string,"")}).views(function(a){return{get folderName(){return a.name||a.folderModel.get("name")},get isShareTake(){return a.folderModel.isShareTake()},get idNumber(){return+this.id},get folderModel(){return d.default.get(this.id)}}}).actions(function(a){return{updateFromModel:function b(){var c=a.folderModel;a.name=c.get("name")}}});var k=b.types.model("SearchResponse",{count:b.types.optional(b.types.number,0),folders:b.types.optional(b.types.array(j),[]),dates:b.types.optional(i,{})});exports.default=k});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/ContactSuggests",["require","exports","Action","RPC"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=a.default.extend({urls:{suggest:"ab/smart/suggest",default:"ab/smart"},fields:["id","emails","display_name","priority","nick","name"],operation:function(a){var c=a.search;if(typeof c==="undefined"){return Promise.reject({search:"required"})}var d={search:c};var e=this.urls.suggest;if(c===""){d={fields:this.fields,simple:true};e=this.urls.default}if(a.limit){d.limit=a.limit}return b.default.get(e,d).then(this._processResponse.bind(this,e))},_processResponse:function(a,b){var c=b.body||{};var d=c.contacts||[];if(a===this.urls.default){d=d.reduce(function(a,b){if(!b.emails){return a}b.emails.forEach(function(c){var d=Object.assign({},b);d.email=c;a.push(d)});return a},[])}var e=c.labels||[];return{contacts:d,labels:e}}});a.default.register("mail.ContactSuggests",c);c.version="1.0.0";exports.default=c;return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/addressbook/addressbook",["require","exports","@mail/features","RPC","service/auth"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isInAddressbook=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(a,b){b=b.toLowerCase();return a.some(function(a){return Array.isArray(a[1])&&!a[4]&&a[1].some(function(a){return a&&b===a.toLowerCase()})})};exports.isInAddressbook=d;var e;var f=function(){function d(){this.dataSource=null;this._promise=null;this._contacts=null}d.prototype.lazyInit=function(){var a=this;if(!e){e=new Promise(function(d){require(["suggests/data-source"],function(e){var f=a;a.dataSource=new e({getCommonContacts:function(a){var b=this;f.getCommonAddressBook(function(a){if(a){b.resolve(a)}else{b.reject()}},a,["id","emails","nick","name","display_name","priority"])},getContacts:function(){var a=this;if(!f._promise){f._promise=b.default.call("ab/fast",{need_id:true,need_labels:true}).then(function(b){var c=b.body;f._contacts=c;a.resolve({body:c})})}return f._promise},getGroups:function(){var a=this;return b.default.call("ab/labels").then(function(b){return a.resolve({body:b.body})})}},{prefix:c.default.user.getEmail()});a.dataSource.get().then(d)})})}return e};d.prototype.all=function(){return this.lazyInit().then(function(a){return a.all()})};d.prototype.getCachedAll=function(){return this._contacts};d.prototype.find=function(a,b){if(b===void 0){b={}}var c=b.limit;return this.lazyInit().then(function(b){return b.find(a)}).then(function(a){if(c){return a.slice(0,c)}return a})};d.prototype.getGroup=function(a){return this.lazyInit().then(function(b){return b.getGroup(a)})};d.prototype.getCommonAddressBook=function(c,d,e){if(a.default.has("load-common-contacts")){var f="ab/contacts/common"+(d?"/diff":"");b.default.get(f,{last_modified:d,fields:e}).then(function(a){c({body:a.body,last_modified:a.lastModified})},function(){c(null)})}else{c(false)}};return d}();exports.default=new f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search-query/search-query",["require","exports","@mail/operands","mobx-state-tree","state-tree/search-interval/search-interval"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);var d=b.types.model("SearchCorrespondents",{from:b.types.maybe(b.types.string),to:b.types.maybe(b.types.string)});var e=b.types.model("SearchFlags",{unread:b.types.boolean,flagged:b.types.boolean,attach:b.types.boolean});var f=b.types.model("SearchQuery",{query:b.types.maybe(b.types.string),subject:b.types.maybe(b.types.string),folder:b.types.maybe(b.types.number),transaction_category:b.types.maybe(b.types.enumeration(Object.values(a.OperandCategoryTypes))),correspondents:b.types.maybe(d),flags:b.types.maybe(e),interval:b.types.maybe(c.default),all_attaches:b.types.maybe(b.types.boolean),in_excluded_folders:b.types.maybe(b.types.boolean)});exports.default=f});define("state-tree/suggest-operand/suggest-operand",["exports","@mail/operands","mobx-state-tree","../../default-values"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SuggestOperandsValidator=exports.SuggestOperand=undefined;var d;function e(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var f=exports.SuggestOperand=b.types.model("SuggestOperand",{value:b.types.string,type:b.types.enumeration(Object.values(a.OperandSuggestAddTypes))});var g=exports.SuggestOperandsValidator=(d={},e(d,a.OperandSuggestAddTypes.FROM,function(a){var b=a.trim();if(!b||b.split(" ").length>1){return false}if(!c.SUGGEST_FROM){return false}if(c.SUGGEST_FROM.all){return true}if(c.SUGGEST_FROM.keywords&&c.SUGGEST_FROM.keywords.length){return c.SUGGEST_FROM.keywords.some(function(a){if(a&&a[0]==="R"&&a[1]==="_"){try{return new RegExp(a.slice(2)).test(b)}catch(a){return false}}return b.toLowerCase()===a.toLowerCase()})}return false}),e(d,a.OperandSuggestAddTypes.SEARCH_INTERNET,function(a){var b=a.trim();if(!c.SUGGEST_SEARCH_INTERNET){return false}return b.split(" ").length>1}),d)});define("state-tree/search-suggests/utils",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.findSuggestOperandIndex=a;function a(a,b){return a.findIndex(function(a){return a.type===b})}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search-suggests/search-suggests",["require","exports","@mail/operands","default-values","mail/actions/ContactSuggests","mobx-state-tree","service/addressbook/addressbook","state-tree/search-query/search-query","state-tree/suggest-operand/suggest-operand","./utils"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchSuggestsDefaults=exports.mapMessagesSuggest=exports.SearchQueryRequestSuggest=exports.SearchQueryMessageSuggest=exports.SearchQueryAddressbookSuggest=exports.SearchQueryWordSuggest=void 0;c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);var i="messages/search/requests";var j="messages/search/suggest";var k=1e3;var l;var m;var n;var o=0;function p(a){return typeof a==="string"&&!!a.length}exports.SearchQueryWordSuggest=d.types.model("SearchQueryWordSuggest",{word:d.types.string});exports.SearchQueryAddressbookSuggest=d.types.model("SearchQueryAddressbookSuggest",{name:d.types.string,email:d.types.string});exports.SearchQueryMessageSuggest=d.types.model("SearchQueryMessageSuggest",{email:d.types.string,name:d.types.string,subject:d.types.string,messageId:d.types.string,threadId:d.types.string,folder:d.types.string});exports.SearchQueryRequestSuggest=d.types.model("SearchQueryRequestSuggest",{query:f.default,overall_count:0,two_weeks_count:0,timestamp:d.types.optional(d.types.Date,new Date),empty:false}).actions(function(a){return{fromRPC:function(b){a.overall_count=b.overall_count;a.two_weeks_count=b.two_weeks_count;a.timestamp=new Date(b.timestamp*k);b=__assign({},b);delete b.overall_count;delete b.two_weeks_count;delete b.timestamp;if(b.correspondents){if(!p(b.correspondents.from)){delete b.correspondents.from}if(!p(b.correspondents.to)){delete b.correspondents.to}}if(Object.keys(b).length){a.query=b}else{a.empty=true}}}});function q(a){return(a.body.requests||[]).map(function(a){var b=exports.SearchQueryRequestSuggest.create({query:{}});b.fromRPC(a);return b}).filter(function(a){return!a.empty})}function r(a,d){if(b.NEW_AB_SUGGEST){return c.default.execute({search:a||"",limit:d.limit}).then(function(a){return a.result.contacts.map(function(a){a.name=a.display_name;return a})})}return e.default.find(a,d).then(function(a){return a.map(function(a){return a.data})})}function s(a){return a.map(function(a){if(a.correspondents&&a.correspondents.from&&a.correspondents.from.length!==0){a.email=a.correspondents.from[0].email;a.name=a.correspondents.from[0].name}else{a.email="";a.name=""}a.messageId=a.id;a.threadId=a.thread_id;return a})}exports.mapMessagesSuggest=s;function t(a,c,d){var e=c+"::"+d.query+"::"+d.limit;if(e===m){return Promise.resolve(l)}if(b.SEARCH_SUGGESTS_DELAY&&c.includes("messages/search/suggest")){window.clearTimeout(n);return new Promise(function(f,g){n=window.setTimeout(function(){return a.get(c,d).then(function(a){m=e;l=a;f(a)})},b.SEARCH_SUGGESTS_DELAY_TIME)})}return a.get(c,d).then(function(a){m=e;l=a;return a})}var u=d.types.model("SearchQuerySuggests",{requests:d.types.optional(d.types.array(exports.SearchQueryRequestSuggest),[]),words:d.types.optional(d.types.array(exports.SearchQueryWordSuggest),[]),contacts:d.types.optional(d.types.array(exports.SearchQueryAddressbookSuggest),[]),messages:d.types.optional(d.types.array(exports.SearchQueryMessageSuggest),[]),operands:d.types.optional(d.types.array(g.SuggestOperand),[])}).actions(function(a){return{fetch:d.flow(function c(e){var f,g,h,k,l,n,p,u,v,w;var x=e.query,y=e.limit,z=y===void 0?5:y,A=e.force,B=A===void 0?false:A;return __generator(this,function(c){switch(c.label){case 0:f=++o;g=d.getEnv(a);h=g.getRPC&&g.getRPC();if(!h){console.warn("No RPC in ENV");return[2]}k=x?j:i;if(B){m=null}l={query:x,limit:z};if(b.MESSAGE_SUGGESTS){l.instant_search=1}return[4,Promise.all([t(h,k,l),x?r(x,{limit:z}):Promise.resolve()])];case 1:n=c.sent(),p=n[0],u=n[1];if(f!==o){return[2]}a.requests=q(p);a.words=(p.body.suggests||[]).slice(0,z).map(function(a){return{word:a}});a.contacts=u||[];v=p.body.instant_search_response?p.body.instant_search_response.messages:[];w=s(v);a.messages=(w||[]).slice(0,z);return[2]}})})}}).actions(function(a){return{addOrUpdateSuggestOperand:function(b,c){if(c===void 0){c=void 0}var d=h.findSuggestOperandIndex(a.operands,b);if(d>=0){var e=a.operands[d];e.value=c;return}a.operands.push(g.SuggestOperand.create({type:b,value:c}))},clearSuggestOperands:function(){a.operands.clear()},removeSuggestOperand:function(b){var c=h.findSuggestOperandIndex(a.operands,b);if(c===-1){return}a.operands.splice(c,1)}}}).actions(function(b){return{computeOperands:function(c,d){if(!c||d){b.clearSuggestOperands()}Object.values(a.OperandSuggestAddTypes).forEach(function(a){if(g.SuggestOperandsValidator[a](c)){b.addOrUpdateSuggestOperand(a,c)}else{b.removeSuggestOperand(a)}})}}});exports.default=u;function v(){return{}}exports.searchSuggestsDefaults=v});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search/search",["require","exports","@mail/operands","@octo/smart-input","helpers/date-range","mail/Folder","mobx","mobx-state-tree","service/auth","state-tree/search/utils","state-tree/search-operand/search-operand","state-tree/search-operand/utils","state-tree/search-response/search-response","state-tree/search-suggests/search-suggests","../../default-values","../search-response/search-response"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchDefaults=exports.asBoolean=exports.asNumber=exports.asString=exports.QueryKeysMap=void 0;c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);i=__importDefault(i);k=__importDefault(k);l=__importStar(l);exports.QueryKeysMap={QUERY:"q_query",SUBJECT:"q_subj",FOLDER:"q_folder",CATEGORY:"q_tcategory",CC_FROM:"q_from",CC_TO:"q_to",FLAG_UNREAD:"q_read",FLAG_FLAGGED:"q_flag",FLAG_ATTACH:"q_attach",INTERVAL_DATE:"q_date",INTERVAL_DATE_LAPSE:"q_date_lapse",IN_EXCLUDED_FOLDERS:"q_trash"};function o(a){if(a===void 0){return void 0}return String(a)}exports.asString=o;function p(a){if(a===void 0){return a}return parseInt(a,10)}exports.asNumber=p;function q(a){a=String(a);return a==="true"||a==="1"}exports.asBoolean=q;var r=[].concat(Object.values(a.OperandFilterTypes)).concat(m.SEARCH_CATEGORIES).concat(Object.values(a.OperandQueryTypes)).reduce(function(a,b){a[b]=true;return a},{});var s={unread:a.OperandFilterTypes.UNREAD,flagged:a.OperandFilterTypes.FLAGGED,attach:a.OperandFilterTypes.ATTACH};var t;var u;var v;var w="-1024";var x=f.types.model("Search",{response:f.types.optional(k.default,{}),smartInput:b.createModel(i.default),value:f.types.string,suggests:l.default,totalSuggests:0,selectedSuggest:-1,progress:false,loading:false,in_excluded_folders:false}).views(function(a){return{get hasOperands(){return!!(a.smartInput.operands&&a.smartInput.operands.length)},get allMailboxes(){var a=d.default.all.toArray().filter(function(a){return a.isServiceShared()}).map(function(a){return{email:a.get("owner").email,name:a.get("owner").name,id:a.get("id")}});var b=g.default.user;var c={email:b.getEmail(),name:b.getFullName(),id:w};return __spreadArrays([c],a)}}}).views(function(a){return{get query(){var b={};a.smartInput.operands.forEach(function(a){switch(a.type){case j.SearchOperandType.FOLDER:{b.folder=a.value;break}case j.SearchOperandType.QUERY:{h.deriveSearchQueryFromOperand(b,a);break}case j.SearchOperandType.CATEGORY:{b.transaction_category=a.subtype;break}case j.SearchOperandType.FILTER:{h.deriveFlagsFromOperand(b,a);break}case j.SearchOperandType.DATE:{b.interval=c.default.fromDateAndLapse(a.value).normalize().toRPCInterval();break}case j.SearchOperandType.MAILBOX:{b.mailbox=a.value.id}}});if(b.mailbox){b.folder=b.folder||b.mailbox;delete b.mailbox}if(a.hasOperands){b.in_excluded_folders=a.in_excluded_folders}return b}}}).views(function(a){return{get empty(){return!Object.keys(a.query).length},get currentMailbox(){var b=a.query;return this.getMailboxByFolder(b.folder)}}}).views(function(a){return{get isMyMailboxSelected(){return a.currentMailbox.id===w},get folders(){var b=a.response,c=a.query,d=a.currentMailbox;var e=b.folders||[];var f=c.folder!==void 0;if(f){e=__spreadArrays([n.SearchFolder.create({id:c.folder.toString(),found:0})],e)}var g=function(a){var b=a.folderModel;if(!b){return false}if(d.id===w){return!b.isShareTake()}return b.isShareTake()&&!b.isServiceShared()&&b.get("owner").email===d.email};var h={};e.forEach(function(a,b){if(b===0&&f||g(a)){h[a.idNumber]=a}});return Object.values(h)}}}).views(function(b){return{get hiddenSuggestMap(){var c=b.query,e=b.currentMailbox,f=b.isMyMailboxSelected,g=b.folders;var i=__assign({},r);i[j.SearchOperandType.CATEGORY]=true;i[j.SearchOperandType.FILTER]=true;i[j.SearchOperandType.FOLDER]=true;i[j.SearchOperandType.DATE]=true;i[a.OperandQueryTypes.FROM]=true;i[a.OperandQueryTypes.TO]=true;i[a.OperandQueryTypes.SUBJECT]=true;i[a.OperandQueryTypes.QUERY]=true;if(d.default.all.hasSharedTake()){var k=b.allMailboxes;var l=d.default.all.get(c.folder);var n=k.filter(function(a){var b=a.id;if(b===w){return false}var c=d.default.all.get(b);return c&&!h.isInMailbox(l,c)});i[j.SearchOperandType.MAILBOX]=n.length?n:false}if(c.transaction_category){i[j.SearchOperandType.CATEGORY]=false;Object.values(a.OperandCategoryTypes).forEach(function(a){i[a]=false})}if(c.flags){Object.keys(s).forEach(function(a){if(c.flags[a]){i[s[a]]=false}});if(c.flags.attach&&c.flags.flagged&&c.flags.unread){i[j.SearchOperandType.FILTER]=false}}if(c.correspondents){if(c.correspondents.from){i[a.OperandQueryTypes.FROM]=false}if(c.correspondents.to){i[a.OperandQueryTypes.TO]=false}}if(c.interval){i[j.SearchOperandType.DATE]=false}var o=e.id!==c.folder;var p=c.folder!==undefined;var q=!g.length;if(p&&(f||o||q)||b.empty){i[j.SearchOperandType.FOLDER]=false}if(c.subject!==void 0){i[a.OperandQueryTypes.SUBJECT]=false}if(c.query!==void 0){i[a.OperandQueryTypes.QUERY]=false}if(m.SEARCH_HIDE_CATEGORIES){i[j.SearchOperandType.CATEGORY]=false}return i}}}).views(function(b){return{get enabledQueryOptions(){var c=b.hiddenSuggestMap;return Object.values(a.OperandQueryTypes).reduce(function(b,d){if(c[d]){return b|a.OperandQueryOptions[d]}return b},0)},get countedMailboxes(){var a=b.allMailboxes,c=b.response,d=c.count,e=c.folders,f=e===void 0?[]:e;var g=a[0],h=a.slice(1);var i=0;var j=h.map(function(a){var b=f.find(function(b){return b.id.toString()===a.id.toString()});var c=b?b.found:0;i+=c;return __assign(__assign({},a),{found:c})});var k=d-i;var l=__assign(__assign({},g),{found:k});return __spreadArrays([l],j)}}}).views(function(a){return{get routerQuery(){var b;var d=(b={},b[exports.QueryKeysMap.QUERY]=a.query.query,b[exports.QueryKeysMap.SUBJECT]=a.query.subject,b[exports.QueryKeysMap.FOLDER]=a.query.folder,b[exports.QueryKeysMap.CATEGORY]=a.query.transaction_category,b[exports.QueryKeysMap.CC_FROM]=a.query.correspondents&&a.query.correspondents.from,b[exports.QueryKeysMap.CC_TO]=a.query.correspondents&&a.query.correspondents.to,b[exports.QueryKeysMap.FLAG_UNREAD]=a.query.flags&&a.query.flags.unread?1:void 0,b[exports.QueryKeysMap.FLAG_FLAGGED]=a.query.flags&&a.query.flags.flagged?1:void 0,b[exports.QueryKeysMap.FLAG_ATTACH]=a.query.flags&&a.query.flags.attach?1:void 0,b[exports.QueryKeysMap.IN_EXCLUDED_FOLDERS]=a.query.in_excluded_folders?1:void 0,b);var e=a.query.interval;if(e){d=__assign(__assign({},d),c.default.fromRPCInterval(e).toQuery())}Object.keys(d).forEach(function(a){if(d[a]===void 0){delete d[a]}});return d}}}).actions(function(a){return{setProgress:function(b){a.progress=!!b;if(!b){window.clearTimeout(v)}},setResponse:function(b){a.response.count=b.found.count;a.response.folders=b.found.folders;a.response.dates=b.found.dates}}}).actions(function(a){return{setValue:function(b){a.value=b},setSuggestsInfo:function(b){var c=b.totalSuggests,d=c===void 0?a.totalSuggests:c,e=b.selectedSuggest,f=e===void 0?a.selectedSuggest:e;a.totalSuggests=d;a.selectedSuggest=f},setLoading:function(b){a.loading=!!b;if(!b){a.setProgress(false)}},reloadLetters:function(){var b=f.getEnv(a);var c=b.getDataSource&&b.getDataSource();if(!c){return}c.dispatch({type:c.UPDATE_ALL})},setInExcludedFolders:function(b){a.in_excluded_folders=!!b}}}).actions(function(c){return{setQuery:function(a){var b=!!p(a.in_excluded_folders);c.setInExcludedFolders(b);var e=d.default.all.get(a.folder);var f=c.currentMailbox,g=c.isMyMailboxSelected;if(b&&e&&!(e.isSpam()||e.isTrash())){if(g){delete a.folder}if(!g){a.folder=f.id}}h.reconcileOperandsList(c.smartInput,a)},setResponseAndProgress:function(a,b){c.setResponse(a);c.setProgress(b)},appendSearchQuery:function(d){if(!d){return}c.setValue("");var e=c.smartInput.operands.find(function(b){return b.subtype===a.OperandQueryTypes.QUERY});if(e){e.setValue(e.value+" "+d);return e.applyChanges()}c.smartInput[b.SmartInputActions.PUSH]({current:{type:j.SearchOperandType.QUERY,subtype:a.OperandQueryTypes.QUERY,value:d}})}}}).actions(function(a){return{syncWithRouteQuery:function(b){var d={query:o(b[exports.QueryKeysMap.QUERY]),subject:o(b[exports.QueryKeysMap.SUBJECT]),folder:p(b[exports.QueryKeysMap.FOLDER]),transaction_category:o(b[exports.QueryKeysMap.CATEGORY]),in_excluded_folders:p(b[exports.QueryKeysMap.IN_EXCLUDED_FOLDERS])};if(b[exports.QueryKeysMap.CC_FROM]!==void 0||b[exports.QueryKeysMap.CC_TO]!==void 0){d.correspondents={from:o(b[exports.QueryKeysMap.CC_FROM]),to:o(b[exports.QueryKeysMap.CC_TO])}}if(b[exports.QueryKeysMap.FLAG_UNREAD]!==void 0||b[exports.QueryKeysMap.FLAG_FLAGGED]!==void 0||b[exports.QueryKeysMap.FLAG_ATTACH]!==void 0){d.flags={unread:q(b[exports.QueryKeysMap.FLAG_UNREAD]),flagged:q(b[exports.QueryKeysMap.FLAG_FLAGGED]),attach:q(b[exports.QueryKeysMap.FLAG_ATTACH])}}var e=c.default.fromQuery(b);if(e){d.interval=e.normalize().toRPCInterval()}a.setQuery(d)},getLetterHref:function(b){var c=f.getEnv(a);var d=c.getRouter&&c.getRouter();var e="#read-letter";var g=d[e];return g.getUrl({letter:b.threadId,folder:b.folder,id:b.messageId},"inherit")},goToLetter:function(b){if(b===void 0){b=void 0}var c=f.getEnv(a);var d=c.getRouter&&c.getRouter();var e=this.getLetterHref(b);d.nav(e,{initiator:"popstate"})},goToLetterAndClear:function(a){if(a===void 0){a=void 0}this.goToLetter(a);this.clear()},getMailboxByFolder:function(b){var c=a.allMailboxes;var e=d.default.all.get(b);if(!b||!e||!e.isShareTake()){return c.find(function(a){var b=a.id;return b===w})}return c.find(function(a){var b=a.email;return b===e.get("owner").email})},applyMailboxOperand:function(c){if(!c||c.id===a.currentMailbox.id){return}this.removeOperand(j.SearchOperandType.FOLDER);this.removeOperand(j.SearchOperandType.MAILBOX);if(c.id===w){return}f.applyAction(a.smartInput,{name:b.SmartInputActions.PUSH,args:[{current:{type:j.SearchOperandType.MAILBOX,value:c}}]})},applyFolderOperand:function(c){if(d.default.all.hasSharedTake()){var e=this.getMailboxByFolder(c);this.applyMailboxOperand(e)}f.applyAction(a.smartInput,{name:b.SmartInputActions.PUSH,args:[{current:{type:j.SearchOperandType.FOLDER,value:c}}]})},applyOperand:function(c,d,e){if(e===void 0){e=void 0}if(c!==j.SearchOperandType.QUERY&&!!a.value){a.appendSearchQuery(a.value)}a.value="";if(c===j.SearchOperandType.MAILBOX){this.applyMailboxOperand(e);return}if(c===j.SearchOperandType.FOLDER){this.applyFolderOperand(e);return}f.applyAction(a.smartInput,{name:b.SmartInputActions.PUSH,args:[{current:{type:c,subtype:d,value:e}}]})},setOperandActive:function(c,d,e){if(d===void 0){d=void 0}if(e===void 0){e=void 0}var g=a.smartInput;var i=h.findOperandIndex(g,c,d);if(i<0){this.applyOperand(c,d,e);i=h.findOperandIndex(g,c,d)}if(i>=0){f.applyAction(a.smartInput,{name:b.SmartInputActions.SET_OPERAND_FLAGS,args:[i,{active:true,editing:true}]})}},setInputActive:function(){var c=a.smartInput.operands;var d=c.length;var e=c[c.length-1];if(e&&(e.type===j.SearchOperandType.DATE||e.type===j.SearchOperandType.FOLDER)){d--}f.applyAction(a.smartInput,{name:b.SmartInputActions.SET_OPERAND_FLAGS,args:[d,{active:true,editing:true}]})},applyOperandAndFocus:function(a,b,c){if(c===void 0){c=void 0}this.applyOperand(a,b,c);this.setInputActive()},removeOperand:function(c,d){var e=a.smartInput;var f=h.findOperandIndex(e,c,d);if(f>=0){e[b.SmartInputActions.SPLICE](f,1)}},clear:function(){a.value="";a.in_excluded_folders=false;f.applyAction(a.smartInput,{name:b.SmartInputActions.CLEAR});t=void 0;window.clearTimeout(u);u=void 0},updateOperand:function(b,c,d,e){var f=h.findOperand(a.smartInput,b,c);if(f&&d!==void 0){f.setSubtype(d)}if(f&&e!==void 0){f.setValue(e);f.applyChanges()}},updateOperandSubtypeAndFocus:function(c,d){c.setSubtype(d);var e=a.smartInput.operands.findIndex(function(a){return c===a});f.applyAction(a.smartInput,{name:b.SmartInputActions.SET_OPERAND_FLAGS,args:[e,{active:true,editing:false}]})},updateOperandSubtypeAndBlur:function(c,d){c.setSubtype(d);f.applyAction(a.smartInput,{name:b.SmartInputActions.DEACTIVATE_ALL})}}}).extend(function(a){e.reaction(function(){return a.value},function(){a.suggests.computeOperands(a.value,a.hasOperands)});e.reaction(function(){return a.query},function(){a.setLoading(true);if(u!==void 0){return}u=window.setTimeout(function(){u=void 0;var b=!t;if(b||!h.searchQueriesEqual(a.query,t)){t=a.query;var c=f.getEnv(a);var d=c.getRouter&&c.getRouter();if(!d||!d.activeRoute.is("#search")&&!d.activeRoute.is("#search-letter")&&a.empty){a.setLoading(false);return}if(d.route.is("#search-letter")&&b){return}d.go("#search",{},a.routerQuery).then(function(){a.setLoading(false)});v=window.setTimeout(function(){a.setProgress(true)},100)}},100)});return{}});exports.default=x;function y(){return{smartInput:{},value:"",suggests:l.searchSuggestsDefaults()}}exports.searchDefaults=y});define("state-tree/application/application",["exports","data-source/actions","helpers/data-source-dispatch","mobx-state-tree","RPC","../search/search"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.store=undefined;var f=i(b);var g=i(d);var h=i(e);function i(a){return a&&a.__esModule?a:{default:a}}var j=c.types.model({search:h.default});var k=exports.store=j.create({search:(0,e.searchDefaults)()},{getRouter:function a(){return window.app},getRPC:function a(){return g.default},getDataSource:function b(){return{dispatch:f.default,UPDATE_ALL:a.UPDATE_ALL}}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/utils",["require","exports","Action","default-values","mail/Folder","mail/Message","mail/SharedMailbox","mail/Thread","Model","models/metathread/metathread","route/utils/filter-query","service/mailbox/loader","state-tree/application/application"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lettersLoaderIntegrationService=exports.getStore=exports.destroyExcessThreads=exports.destroyThreadOrMessage=exports.requestQueryEquals=exports.handleSecureOpenError=exports.prevStatusIfActionLocked=exports.prevDataIfActionLocked=exports.isActionLocked=exports.prevStatus=exports.concatThreadLists=exports.mergeThreadLists=exports.mapThreadIds=exports.mapMessages=exports.mapThreads=exports.mapSharedMailboxes=exports.mapFolders=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importStar(j);var l=["search_attaches","search_subject","search_snippet","thread_id"];function m(a){var b={};var d=a.map(function(a){var d=c.default.all.get(a.id);if(d){d.set(a);d.meta("level",undefined)}else{d=new c.default(a);c.default.all.set([d])}b[a.id.toString()]=true;return d});c.default.all.forEach(function(a){if(!b[a===null||a===void 0?void 0:a.get("id").toString()]){c.default.all.remove(a)}});return d}exports.mapFolders=m;function n(a){if(a===void 0){a=[]}var b={};var c=a.map(function(a){var c,d,f;var g=e.default.all.get((c=a.owner)===null||c===void 0?void 0:c.email);if(g){g.set(a)}else{g=new e.default(__assign(__assign({},a),{id:(d=a.owner)===null||d===void 0?void 0:d.email}));e.default.all.set([g])}b[(f=a.owner)===null||f===void 0?void 0:f.email]=true;return g});e.default.all.forEach(function(a){if(!b[a===null||a===void 0?void 0:a.get("owner.email")]){e.default.all.remove(a)}});return c}exports.mapSharedMailboxes=n;function o(a,b,c){if(b===void 0){b={}}if(c===void 0){c=0}var d=[];var e;var g;for(var i=0;i<a.length;i++){e=a[i];if(h.default.isMetathread(e)){h.default.patchThreadId(e);g=h.default.map(e)}else{g=f.default.all.get(e.id);if(g){g.set(e,{sync:true,clean:true,resetChanged:true});if(Object.keys(g.changed).length){g.meta("changed",(g.meta("changed")||0)+1)}if(b.currentId===e.id){b.changed=!!Object.keys(g.changed).length}}else{g=new f.default(e);f.default.all.set([g])}g.setContainingMetathread(null);g.meta("_ui-index",c+i)}d.push(g)}return d}exports.mapThreads=o;function p(a){if(!a){return[]}var b=[];var c;var e;var f;for(var g=0;g<a.length;g++){c=a[g];e=d.default.all.get(c.id);if(e){e.set(c)}else{e=new d.default(c);d.default.all.set([e])}for(var h=0;h<l.length;h++){f=l[h];e.meta(f,c[f])}e.meta("_ui-priority-index",g);b.push(e)}return b}exports.mapMessages=p;function q(a){var b={};var c=a.length;var d;while(c--){d=a[c];b[d.id]=d}return b}exports.mapThreadIds=q;function r(a,b){var c;for(var d=0;d<a.length;d++){c=a[d];if(!c){return false}if(c.id===b){return true}}return false}function s(a,b){var c=b.get("date");var d;for(var e=0;e<a.length;e++){d=a[e];if(d.get("date")<c){a.splice(e,0,b);return}}a.push(b)}function t(a){var b={};var c=[];var d;for(var e=0;e<a.length;e++){d=a[e];if(!b[d.id]){b[d.id]=true;c.push(d)}}return c}function u(a){var b=a.getFolder();if(!b.isMetathread()){return false}var c=+b.get("id");var d=h.default.all.find(function(a){return a.getMetathreadFolder()===c});return d.isExpanded()}function v(a,b,c){var d=c.offset,e=c.limit,h=c.persistThread;var i=a.slice(0,d);var j=a.slice(d,d+e);var k=a.slice(d+e,a.length);var l=h instanceof g.default;var m=l?h.id:h;var n=l?h:f.default.all.get(h);var o=h&&r(j,m);var p=o&&!r(b,m);if(p&&n&&!u(n)){s(b,n)}var q=[].concat(i).concat(b).concat(k);return t(q)}exports.mergeThreadLists=v;function w(a,b){var c=q(b);var d=[];var e;for(var f=0;f<a.length;f++){e=a[f];if(!c[e.id]){d.push(e)}}return d.concat(b)}exports.concatThreadLists=w;function x(a){return __assign({},a&&a.status||{})}exports.prevStatus=x;function y(){return a.default.active>0}exports.isActionLocked=y;function z(c){if(y()){if(b.IS_DEBUG){console.warn("[data-source] Изменения не были внесены в state, поскольку выполняется "+a.default.active+" действий.")}return c}return null}exports.prevDataIfActionLocked=z;function A(a){return z(x(a))}exports.prevStatusIfActionLocked=A;function B(a,b,c){if(a instanceof j.SecureFolderNotOpenError){var d=x(c);return __assign(__assign({},d),{folders:d.folders,letters:[]})}throw a}exports.handleSecureOpenError=B;function C(a,b){return a.filter_flagged==b.filter_flagged&&a.filter_unread==b.filter_unread&&a.filter_with_attachments==b.filter_with_attachments}exports.requestQueryEquals=C;function D(a){if(typeof a.destroy==="function"){a.destroy()}var b=f.default.all.get(a.id);var c=d.default.all.get(a.id);if(b){b.destroy()}if(c){c.destroy()}}exports.destroyThreadOrMessage=D;function E(a,b){return a.filter(function(a){if(!b(a)){return true}D(a);return false})}exports.destroyExcessThreads=E;function F(){return k.store}exports.getStore=F;exports.lettersLoaderIntegrationService={doRequest:function(a,b){return j.default.load(b)},concatThreadLists:w,mergeThreadLists:v,mapThreads:o,mapMessages:p,mapFolders:m,mapSharedMailboxes:n,isActionLocked:y,mapCollectors:function(a){return a},getListLimit:function(){return b.LIST_LIMIT},getFilterQuery:function(){return i.default.get()},getSortingQuery:function(){return i.default.getSorting()},getCurrentTS:function(){return Date.now()},unreadMessagesNotificationsFix:function(a){j.default.emit("data",[a])},isSecureFolderNotOpenError:function(a){return a instanceof j.SecureFolderNotOpenError},getAllFolders:function(){return c.default.all.toArray()}}});define("data-source/source/letter",["exports","@mail-core/dashboard","data-source/actions","data-source/utils","data-source/utils/logger","default-values","logger","mail/Message","mail/Thread"],function(exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var i=l(f);var j=l(g);var k=l(h);function l(a){return a&&a.__esModule?a:{default:a}}var m=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var o=0;function p(a,b){i.default.add(a,b);d.DataSourceLogger.sendLog(n({label:a},b))}function q(a){return a===o}function r(a,b,c){var d=c.params.letter;if(c.is("#read-letter")&&d!==a.id){var e=a.getFolder();c.redirectTo(c.router.getUrl("#read-letter",{letter:a.id,folder:e.id}));if(b){b.destroy()}}return a}function s(a,b){if(!a){return}var d=a.get("messages").toArray();var e=(0,c.mapThreadIds)(b);a.set("messages",d.filter(function(a){if(e[a.id]){a.destroy();a=j.default.all.get(a.id);if(a){a.destroy()}return false}return true}));return a}function t(a,b,d){var f={id:a.id,offset:0,last_modified:1,force_custom_thread:e.FORCE_CUSTOM_THREAD,use_color_scheme:e.DARK_MODE_MEDIA_QUERY?1:0};var g=n({},f,b);return k.default.fetchData(g,true).then(function(b){if(!(0,c.prevDataIfActionLocked)(a)){var e=b.messages;var f=a.get("messages").toArray();if(d){b.messages=(0,c.concatThreadLists)(f,e)}else{b.messages=(0,c.mergeThreadLists)(f,e,{offset:g.offset,limit:e.length})}a.set(b)}else{p("letter.fetchThread.then",{query:g,prevDataIfActionLocked:true})}return a})}function u(a,b,c){if(!e.SMART_THREAD_FETCHING||!a.isDataFully()){return t(a)}p("letter.tryFetchThread.prevThreadMetaChanged",{changed:a.meta("changed")});if(a.meta("changed")){a.meta("changed",0);return t(a)}var d=b.threadMeta||{changed:true};var f=Object.values(c).some(function(b){var c=b.threadMeta;return c.currentId===a.id&&c.changed});var g=d.currentId===a.id&&d.changed;p("letter.tryFetchThread.checkChanged",{changedCurrent:g,changedInMetathreads:f});if(!g&&!f){return Promise.resolve(a)}return t(a)}exports.default={match:["#read-letter","#search-letter"],defaults:null,fetch:function d(f,g,h,i){var l=f.params,v=l.folder,w=l.letter,x=l.part;var y=h&&h.type;var z=void 0;if(i&&i.letter){z=i.letter}var A=k.default.get(w);if((0,c.prevDataIfActionLocked)(A)){p("letter.fetch",{actionType:y,prevDataIfActionLocked:true});return A}return a.userKeeper.group("app-fetch-thread",function(){switch(y){case b.THREAD_LOAD_MORE:{var a=A;var c=a.get("messages.length");return t(a,{offset:c,limit:e.THREAD_LETTERS_LOAD_MORE_COUNT},true)}case b.DESTROY_THREADS_AND_MESSAGES:{return s(A,h.models.messages)}case b.NAVIGATE:case b.UPDATE_ALL:{if(x){var d=w.replace(/\d+:(\d+):\d+/,"$1;"+x);return j.default.findOne({id:d,folder_id:v,use_color_scheme:e.DARK_MODE_MEDIA_QUERY?1:0}).then(function(a){var b=a.get("folder");if(v==b){return new k.default(n({},a.attributes,{expand:d,messages:[a]}))}else{return f.redirectTo(f.router.getUrl("#read-letter",{folder:b,letter:w,part:x}))}})}if(A&&A.isDataFully()){var i=++o;return Promise.all([g("status"),g("metathreads")]).then(function(a){var c=m(a,2),d=c[0],e=c[1];setImmediate(function(){u(A,d,e).then(function(a){if(!q(i)){return a}var c=r(a,A,f);if(y===b.NAVIGATE){c.emit("loaded-changes")}return c})});return Promise.resolve(A)})}else if(A){return t(A).then(function(a){return r(a,A,f)})}else{var l={id:w,force_custom_thread:e.FORCE_CUSTOM_THREAD,use_color_scheme:e.DARK_MODE_MEDIA_QUERY?1:0};return k.default.findOne(l).then(function(a){return r(a,A,f)})}}default:return A||z}},{score:"fetch",appendix:!y?"no-act":"act"})}}});define("data-source/utils/paginator",["require","exports","../../default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isPaginatorGlobalEnabled=exports.isPaginatorEnabled=exports.canPaginatorBeEnabled=exports.dropPageHeight=exports.hasMemoizedExactPageHeight=exports.getMemoizedPageHeight=exports.memoizePageHeight=exports.calcSkeletonsAtEnd=exports.calcLastLetterIndex=exports.calcSkeletonsAtStart=void 0;var b={};function c(b){var c=typeof b.page==="number";return c?Math.max((b.page-1)*a.LIST_LIMIT-1,0):0}exports.calcSkeletonsAtStart=c;function d(a){return a.letters.length+c(a)}exports.calcLastLetterIndex=d;function e(a){var b=d(a);return Math.max(a.lettersTotal-b-1,0)}exports.calcSkeletonsAtEnd=e;function f(a,c,d){if(d===void 0){d=false}b[a]={height:c,exact:d}}exports.memoizePageHeight=f;function g(a){return b[a]?b[a].height:undefined}exports.getMemoizedPageHeight=g;function h(a){return!!(b[a]&&b[a].exact)}exports.hasMemoizedExactPageHeight=h;function i(a){delete b[a]}exports.dropPageHeight=i;function j(b){var c=b&&b.model&&b.model.uiLayout;var d=b&&b.activeRoute&&b.activeRoute.is("#search #search-letter");var e=c&&c.type==="3pane"&&c.support3pane;return a.CAN_ENABLE_PAGINATOR&&!d&&!e}exports.canPaginatorBeEnabled=j;function k(a,b){var c=b&&b.paginator;return j(a)&&c}exports.isPaginatorEnabled=k;function l(a){var b=a&&a.model&&a.model.uiThreadsSettings;return k(a,b)}exports.isPaginatorGlobalEnabled=l});define("data-source/source/letter-neighbours",["exports","data-source/actions","data-source/utils/paginator","helpers/data-source-dispatch","mail/Message","models/metathread/metathread","pilotjs"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=k(c);var h=k(d);var i=k(e);var j=k(f);function k(a){return a&&a.__esModule?a:{default:a}}var l=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var m=-1;function n(a,b){if(b||a.meta("thread_id")){return a.meta("thread_id")||a.id}if(/:/.test(a.id)){return a.id}if(a instanceof h.default){return"0:"+a.get("id")+":"+a.get("folder")}return"0:"+a.id+":0"}function o(a,b,c){var d=void 0;var e=void 0;while(b>0){d=a[b];e=d&&n(d,c);b--;d=a[b];if(d&&n(d,c)!==e&&!i.default.isMetathread(d)){return d}}}function p(a,b,c){var d=void 0;var e=void 0;while(b<a.length-1){d=a[b];e=d&&n(d,c);b++;d=a[b];if(d&&n(d,c)!==e&&!i.default.isMetathread(d)){return d}}}exports.default={match:["#read-letter","#search-letter"],defaults:null,fetch:function c(d,e,f,h){var i=f&&f.type;var k=h&&h.letterNeighbours||{};var q=d.route.is("#search-letter");if(i!==a.NAVIGATE&&i!==a.UPDATE_ALL&&i!==a.LOAD_MORE&&i!==a.LOAD_PAGE&&k){return k}var r=Promise.all([q?e("search"):e("status"),e("letter"),e("uiThreadsSettings")]);return r.then(function(c){var e=l(c,3),f=e[0],h=e[1],i=e[2];var k=i.threads;var r=f.letters;var s=d.params.id||d.params.letter;var t=r.findIndex(function(a){return a.id===s});var u=t===1;var v=t>=r.length-2;if(t===m){if(q){return{}}return{prev:{threadId:h.get("prev")},next:{threadId:h.get("next")}}}var w=o(r,t,k);var x=p(r,t,k);if((0,b.isPaginatorEnabled)(d.router,i)&&u&&!q&&f.page>1){(0,g.default)({type:a.LOAD_MORE,prev:true,priority:j.default.Loader.PRIORITY_LOW})}if(v&&!f.isLastPage){(0,g.default)({type:a.LOAD_MORE,priority:j.default.Loader.PRIORITY_LOW})}return{prev:w&&{threadId:n(w,k),id:w.id},next:x&&{threadId:n(x,k),id:x.id}}})}}});define("data-source/source/letters",["exports","mail/Thread"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.default={match:["#letters","#read-letter"],defaults:new b.default.List,fetch:function a(b,c){var e=[c("status"),c("folder"),c("letter")];return Promise.all(e).then(function(a){var b=d(a,1),c=b[0];return c.letters||[]})}}});define("data-source/source/message",["exports","default-values","mail/Message"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(b);function d(a){return a&&a.__esModule?a:{default:a}}exports.default={match:["#attachment"],defaults:null,fetch:function b(d){var e=d.params.message;var f=d.query["folder-id"];return c.default.findOne({id:e,folder_id:f,use_color_scheme:a.DARK_MODE_MEDIA_QUERY?1:0})}}});define("data-source/source/metathreads",["exports","data-source/actions","data-source/utils","default-values","mail/Folder","models/metathread/metathread","route/utils/filter-query","service/mailbox/loader"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=l(d);var i=l(e);var j=l(f);var k=l(g);function l(a){return a&&a.__esModule?a:{default:a}}var m=function a(){return{}};function n(a,c){var d=c.metathreads[a.id];return(0,b.prevDataIfActionLocked)(d)}function o(a,b){var c=b&&b.metathreads[a.id];return c&&c.threads||[]}function p(a,b){if(!a.threads){return a}a.threads.forEach(function(a){a.setContainingMetathread(b)});return a}function q(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{offset:0},c=b.limit,d=b.offset;var e=c+1;return k.default.load({folder:a.getMetathreadFolder(),limit:e,offset:d,sort:j.default.getSorting()}).then(function(a){var b=a.threads.length===e;return{threads:b?a.threads.slice(0,e-1):a.threads,isLimitReached:!b}})}function r(a,b){b.setLimitReached(a.isLimitReached);return a}function s(){i.default.all.forEach(function(a){a.setExpanded(false);a.setLimit()});return m()}function t(a,c,d){var e=a.getLimit();var f=c.params.letter;var g={currentId:f,changed:false};return q(a,{limit:e}).then(function(c){return n(a,d)||{threads:(0,b.mapThreads)(c.threads,g),threadMeta:g,isLimitReached:c.isLimitReached}}).then(function(b){return r(b,a)}).then(function(b){return p(b,a)}).catch(function(a){return(0,b.handleSecureOpenError)(a,c,d)})}function u(a,d,e){var f=o(a,e);var g=c.LIST_LIMIT;var h=d.params.letter;var i={currentId:h,changed:false};return q(a,{limit:g}).then(function(c){return n(a,e)||{threads:(0,b.mergeThreadLists)(f,(0,b.mapThreads)(c.threads,i),{limit:g,offset:0}),isLimitReached:c.isLimitReached,threadMeta:i}}).then(function(b){return r(b,a)}).then(function(b){return p(b,a)}).catch(function(a){return(0,b.handleSecureOpenError)(a,d,e)})}function v(a,d,e){var f=o(a,e);var g=f.length;var h=d.params.letter;var i={currentId:h,changed:false};return q(a,{offset:g,limit:c.METATHREAD_LIMIT}).then(function(a){return(0,b.prevStatusIfActionLocked)(e)||{threads:(0,b.concatThreadLists)(f,(0,b.mapThreads)(a.threads,i)),isLimitReached:a.isLimitReached,threadMeta:i}}).then(function(b){return r(b,a)}).then(function(b){return p(b,a)}).catch(function(a){return(0,b.handleSecureOpenError)(a,d,e)})}function w(a,b){var d=i.default.all.filter(function(a){return a.isExpanded()});return Promise.all(d.map(function(d){if(d.getLimit()<=c.LIST_LIMIT){return t(d,a,b)}return u(d,a,b)})).then(function(a){return a.reduce(function(a,b,c){var e=d[c];a[e.id]=b;return a},{})})}exports.default={match:["#letters","#read-letter"],defaults:m(),fetch:function d(e,f,g,j){var k=g&&g.type;var l=j&&j.metathreads||m();var n=e&&e.params.folder;var o=j&&j.request&&j.request.params.folder;if((0,b.prevDataIfActionLocked)(l)){return l}switch(k){case a.LOAD_MORE_METATHREAD:{var p=g.model;return v(p,e,j).then(function(a){p.setLimit(p.getLimit()+c.METATHREAD_LIMIT);l[p.id]=a;return l})}case a.TOGGLE_METATHREAD:{var q=Date.now();var r=g.model,t=g.state;r.set({lastToggle:q});if(t===r.isExpanded()){return l}r.setExpanded(t);if(!t){delete l[r.id]}return w(e,j)}case a.TOGGLE_TO_MYSELF_METATHREAD:var u=g&&g.state;var x=i.default.all.get("multithreadFixId500015");if(x&&u===false){x.setExpanded(false);x.setLimit()}return w(e,j);case a.TOGGLE_METATHREADS_SETTING:case a.CHANGE_METATHREADS_SETTING:case a.EDIT_METATHREADS_SETTINGS:case a.TOGGLE_METATHREADS_SETTINGS:case a.NAVIGATE:case a.UPDATE_ALL:{if(k===a.NAVIGATE&&o!==n&&n!==h.default.INBOX||k===a.TOGGLE_METATHREADS_SETTING||k===a.CHANGE_METATHREADS_SETTING||k===a.EDIT_METATHREADS_SETTINGS||k===a.TOGGLE_METATHREADS_SETTINGS){if(e.is("#read-letter")||e.is("#search-letter")){return s()}return f("letters").then(s,s)}return w(e,j)}}return l}}});define("helpers/service-worker-listener",["exports","helpers/data-source-dispatch","service/auth","service/radars/index"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){if(!j){if(window.navigator.serviceWorker&&navigator.serviceWorker.addEventListener){navigator.serviceWorker.addEventListener("message",i)}j=Promise.resolve()}return j};var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){if(a.type==="show-letter"){var b=void 0;if(a.thread){b=app.getUrl("#read-letter",{folder:a.folder,letter:a.thread})}else if(a.letter){b=app.getUrl("#read-letter",{folder:a.folder,letter:"0:"+a.letter+":"+a.folder})}if(b){app.nav(b)}else{(0,d.default)()}}}function i(a){if(a.data){var b=null;try{b=JSON.parse(a.data)}catch(a){}if(!b){return null}var c=e.default.user;var g=c.get("login")+"@"+c.get("domain");if(b.email===g){if(b.type==="focus"){if(b.action){h(b.action)}else{(0,d.default)()}(0,f.default)({type:"pushnotification",intervals:[["page_"+(b.action?"action":"focus"),"1"]]})}else if(b.type==="ping"){a.target.controller.postMessage(JSON.stringify({type:"pong",email:g}))}}}}var j=void 0});define("helpers/push-manager.config",["exports","cfg","data-source/source/swBox","helpers/service-worker-listener","push-manager","service/auth","helpers/get-omicron-segment"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){if((0,b.isSWBoxEnabled)()){return Promise.resolve()}if(!l){var a=j.default.user;var c=a.get("login")+"@"+a.get("domain");var d={push_title:i18n("Почта Mail.ru"),push_body:i18n("Вам пришло новое письмо"),push_icon:g.default.get("urls.packagesUrl")+"/r/default/ico/icon-192.png",push_body_plural:[i18n("{count} новых писем"),i18n("{count} новое письмо"),i18n("{count} новых письма")],push_empty_subject:i18n("Без темы"),push_from:i18n("От"),push_to:i18n("Кому"),locale:"ru_RU",account:c,application:"mail_e",client_name:"ru.mail.e",counter_push_click:[g.default.get("urls.imgRadarUrl")+"/update?email="+c+"&p=octavius&t=pushnotification\n\t\t\t\t\t\t&v=12&i=all:1,click:2&dwh={%22type%22:%22pushnotification%22,%22ver%22:2,%22action%22:%22click%22}\n\t\t\t\t\t\t&o_ss="+(0,f.getOmicronSegment)()],counter_push_show:[g.default.get("urls.imgRadarUrl")+"/update?email="+c+"&p=octavius&t=pushnotification\n\t\t\t\t\t\t&v=12&i=all:1,show:2&dwh={%22type%22:%22pushnotification%22,%22ver%22:2,%22action%22:%22show%22}\n\t\t\t\t\t\t&o_ss="+(0,f.getOmicronSegment)()]};setTimeout(function(){i.default.setup(d);i.default.register("/serviceworker.js",{scope:"/"}).then(h.default).catch(function(a){console.error(a)})},1);l=Promise.resolve(i.default)}return l};var g=k(a);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}var l=void 0});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/pushManager",["require","exports","helpers/push-manager.config"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={fetch:function(){return a.default()}}});define("data-source/source/request",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={fetch:function a(b){return b}}});define("data-source/source/route",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={fetch:function a(b){return b.router.activeRoute||b.router}}});define("data-source/source/router",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={fetch:function a(b){return b.router}}});define("data-source/utils/searchResponseHelpers",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSuggestSearchLetters=a;exports.getSuggestFound=b;function a(a){if(!a){return[]}if(!a.extra_suggest_search_results){return[]}return a.extra_suggest_search_results.messages}function b(a){if(!a){return{}}if(!a.extra_suggest_search_results){return{}}return a.extra_suggest_search_results.found}});define("helpers/fast-deep-equal",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function b(c,d){if(c===d){return true}if(c&&d&&(typeof c==="undefined"?"undefined":a(c))=="object"&&(typeof d==="undefined"?"undefined":a(d))=="object"){if(c.constructor!==d.constructor){return false}var e=void 0;var f=void 0;var g=void 0;if(Array.isArray(c)){e=c.length;if(e!==d.length){return false}for(f=e;f--!==0;){if(!b(c[f],d[f])){return false}}return true}if(c.constructor===RegExp){return c.source===d.source&&c.flags===d.flags}if(c.valueOf!==Object.prototype.valueOf){return c.valueOf()===d.valueOf()}if(c.toString!==Object.prototype.toString){return c.toString()===d.toString()}g=Object.keys(c);e=g.length;if(e!==Object.keys(d).length){return false}for(f=e;f--!==0;){if(!Object.prototype.hasOwnProperty.call(d,g[f])){return false}}for(f=e;f--!==0;){var h=g[f];if(!b(c[h],d[h])){return false}}return true}return c!==c&&d!==d}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/relevant-search",["require","exports","@mail/operands","mail/Folder","../default-values","../helpers/fast-deep-equal"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getRelevantQuery=exports.formRelevantQuery=void 0;b=__importDefault(b);d=__importDefault(d);function e(b,c){if(!c||Object.keys(c).length===0){return null}var e=b.query;if(!e){return null}var f={};var g=c.accurate,h=g===void 0?false:g,i=c.limit,j=i===void 0?3:i,k=c.minWords,l=k===void 0?1:k,m=c.maxWords,n=m===void 0?Infinity:m,o=c.category,p=o===void 0?null:o,q=c.queryType,r=q===void 0?null:q,s=c.filters,t=s===void 0?[]:s,u=c.folder,v=u===void 0?null:u,w=c.documents,x=w===void 0?false:w,y=c.from,z=y===void 0?false:y,A=c.to,B=A===void 0?false:A,C=c.saveFields,D=C===void 0?["all"]:C,E=c.group;var F=e.split(" ");if(!(F.length>=l&&F.length<=n)){return null}if(D.includes("all")){f=__assign({},b)}else{f=D.reduce(function(a,c){if(b[c]||b[c]===0){a[c]=b[c]}return a},{})}if(h){var G=e.length>2&&e[0]==='"'&&e[e.length-1]==='"';if(!G){f.query='"'+e+'"'}}if(x&&!b.transaction_category){f.transaction_category="document_scans"}if(p&&Object.values(a.OperandCategoryTypes).includes(p)){f.transaction_category=p}if(t&&t.length>0&&t.every(function(b){return Object.values(a.OperandFilterTypes).includes(b)})){f.flags=t.reduce(function(a,b){var c;return __assign(__assign({},a),(c={},c[b]=true,c))},__assign({},b.flags))}if(r&&Object.values(a.OperandQueryTypes).includes(r)){if(r!==a.OperandQueryTypes.QUERY){delete f.query}f[r]=e}if(v||v===0){f.folder=v}if(z&&!f.correspondents){f.correspondents={from:e};delete f.query}if(B&&!z&&!f.correspondents){f.correspondents={to:e};delete f.query}if(!Object.keys(f).length||d.default(f,b)){return null}f.limit=j;f.no_history=true;if(E){f.group=E}return f}exports.formRelevantQuery=e;function f(a,c){if(!c||!a){return null}if(a.transaction_category){return null}var d=a.query,f=a.folder;if(!d){return null}if(f){var g=b.default.all.get(f);if(g&&g.isShareTake()){return null}}var h=d.split(" ");var i=c.configByKeywords&&c.configByKeywords.find(function(a){return a.keywords.some(function(a){return h.some(function(b){if(a&&a[0]==="R"&&a[1]==="_"){try{return new RegExp(a.slice(2)).test(b)}catch(a){return false}}return b.toLowerCase()===a.toLowerCase()})})});if(i){return e(a,i)}if(h.length===1){return e(a,c.oneWordConfig)}if(h.length>=2){return e(a,c.twoWordMoreConfig)}}exports.getRelevantQuery=f;exports.default=function(a){var b=__assign(__assign({},c.RELEVANT_SEARCH),{configByKeywords:__spreadArrays((c.RELEVANT_SEARCH===null||c.RELEVANT_SEARCH===void 0?void 0:c.RELEVANT_SEARCH.configByKeywords)||[])});return f(a,b)}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/search",["require","exports","@mail/flags","data-source/actions","data-source/utils","data-source/utils/searchResponseHelpers","default-values","helpers/data-source-dispatch","mail/Message","pilotjs","RPC","service/mailbox/loader","service/radars/index","service/relevant-search","state-tree/search-operand/utils","uuid"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);n=__importDefault(n);function o(a){var b=a.transaction_category,c=__rest(a,["transaction_category"]);if(e.USE_NEW_SEARCH_CATEGORY_FORMAT&&b){return __assign({search_categories:[b]},c)}if(b==="document_scans"){return __assign({only_with_documents:1},c)}return a}function p(b,c){var d=c.offset,f=c.limit,g=c.search_id,h=c.extra_suggest_search;var k=o(b);var l=a.default.get("threads").state;return i.default.get("messages/search",__assign(__assign({},k),{offset:d,limit:f,search_id:g,extra_suggest_search:h,with_threads:l,all_attaches:e.SEARCH_ALL_ATTACHES})).catch(function(a){if(a&&a.is("invalid")&&a.get("body.folder.error")==="not_open"){return{error:new j.SecureFolderNotOpenError(a.get("body.folder.value")),body:{messages:[],found:{count:0}}}}throw a})}function q(a,b){var f=b===void 0?{}:b,g=f.limit,h=g===void 0?0:g,i=f.search_id;return p(a,{offset:0,limit:h||e.LIST_LIMIT,search_id:i,extra_suggest_search:e.EXTRA_SUGGEST_SEARCH}).then(function(a){var b=a.body.found;var e=d.getSuggestSearchLetters(a.body);var f=d.getSuggestFound(a.body);return{error:a.error,requestID:a.requestID,letters:c.mapMessages(a.body.messages),lettersTotal:b.count,found:b,suggestLetters:c.mapMessages(e),suggestLettersTotal:f.count,suggestFound:f,extraSuggestSearchQuery:a.body.extra_suggest_search_query}})}function r(a,b,d){if(b&&Object.keys(b).length>0){var f=b.group;delete b.group;if(!b.limit){return q(a,{search_id:d}).then(function(a){return __assign(__assign({},a),{doneRelevantSearch:{group:f}})})}var g=Promise.all([q(a,{search_id:d}),q(b,{limit:b.limit,search_id:d})]);return g.then(function(a){var d=a[0],g=a[1];return __assign(__assign({},d),{letters:c.mergeThreadLists(g.letters,d.letters,{offset:b.limit,limit:e.LIST_LIMIT,persistThread:""}),doneRelevantSearch:{group:f}})})}return q(a,{search_id:d})}function s(a,b,d){if(b===void 0){b=[]}return p(a,{offset:b.length,limit:e.LIST_LIMIT,search_id:d,extra_suggest_search:false}).then(function(a){return{error:a.error,requestID:a.requestID,letters:c.concatThreadLists(b,c.mapMessages(a.get("body.messages"))),isLastPage:a.get("body.messages").length!==e.LIST_LIMIT,lettersTotal:a.get("body.found.count")}})}var t=null;exports.default={match:["#search","#search-letter"],defaults:{letters:[],lettersTotal:0,suggestLetters:[],suggestLettersTotal:0},fetch:function(a,d,i,j){var o=c.getStore();var p=o.search;var q=j?j.search:{};if(!t){t=d("status")}q.letters=q.letters||[];var u=a.params.id;var v=l.default(p.query);switch(i.type){case b.TOGGLE_METATHREADS_SETTING:case b.UPDATE_ALL:{if(!e.ENABLE_SEARCH_POLLING&&i.type===b.UPDATE_ALL){return q}if(!Object.keys(p.query).length){return q}return d("uiLayout").then(function(d){var f=d.type==="3pane"&&d.support3pane;if(!e.ENABLE_SEARCH_POLLING_2PANE_READMSG&&i.type===b.UPDATE_ALL&&!f&&a.route.is("#search-letter")){return q}return r(p.query,v,q.search_id).then(function(a){p.setResponse(a);return __assign(__assign(__assign({},q),a),{letters:c.mergeThreadLists(q.letters,a.letters,{offset:0,limit:e.LIST_LIMIT,persistThread:g.default.all.get(u)})})}).catch(function(a){if(a&&a.is("invalid")&&a.get("body.folder.error")==="not_exists"&&p.query&&p.query.folder){p.removeOperand(m.SearchOperandType.FOLDER)}return Promise.reject(a)})})}case b.NAVIGATE:case b.UPDATE_SEARCH:{return t.then(function(){var c=__assign({},q);if(i.type===b.NAVIGATE){var d=q.query;p.syncWithRouteQuery(a.query);if(v===null&&Object.keys(p.query).length){v=l.default(p.query)}if(p.query===d){return q}c.isLastPage=false}if(!Object.keys(p.query).length){p.setResponse({found:{}});return Promise.resolve({query:{},found:{},letters:[],lettersTotal:0,suggestLetters:[],suggestLettersTotal:0,suggestFound:{}})}var e=p.query;var f=n.default();return r(e,v,f).then(function(a){return __assign(__assign(__assign({},c),{error:void 0,query:e,search_id:f}),a)}).then(function(a){p.setResponseAndProgress(a,false);var b=a&&a.query&&a.query.query;var c=a&&!a.lettersTotal&&!a.suggestLettersTotal;if(b&&c){k.default("search-query-result-empty")}return a}).catch(function(a){p.setProgress(false);return Promise.reject(a)})})}case b.LOAD_MORE:{if(!Object.keys(p.query).length){return q}return s(p.query,q.letters,q.search_id).then(function(a){return __assign(__assign(__assign({},q),{error:void 0}),a)})}case b.DESTROY_THREADS_AND_MESSAGES:{var w=__spreadArrays(i.models.messages,i.models.threads);var x={};w.forEach(function(a){var b=a.id;x[b]=true});var y=q.letters.filter(function(a){if(!x[a.id]){return true}c.destroyThreadOrMessage(a);return false});return __assign(__assign({},q),{letters:y,lettersTotal:y.length})}case b.UPDATE_LAYOUT_TYPE:{if(a.route.is("#search-letter")){f.default({type:b.UPDATE_ALL,priority:h.default.Loader.PRIORITY_LOW})}break}}return q}}});define("helpers/encode-uri-component",["exports","logger","service/radars/index"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a){try{return encodeURIComponent(a)}catch(b){c.default.add("encodeURIComponent.error",{error:b,url:a});(0,d.default)(["encode-uri-component","error"]);return null}};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/object-to-query",["require","exports","helpers/encode-uri-component"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.objectToQuery=void 0;a=__importDefault(a);function b(b,c){if(c===void 0){c=false}return Object.keys(b).map(function(d){if(c){return a.default(d)+"="+a.default(b[d])}return d+"="+b[d]}).join("&")}exports.objectToQuery=b;exports.default=b});define("helpers/querystring-add",["exports","helpers/object-to-query","helpers/querystring"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var e=a.split(/(#.*)/),h=g(e,2),i=h[0],j=h[1],k=j===undefined?"":j;var l=i.split("?"),m=g(l,2),n=m[0],o=m[1],p=o===undefined?"":o;var q=(0,c.default)(f({},(0,d.default)(p),b),true);return n+"?"+q+k};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var g=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}()});var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/ads-off",["require","exports","@mail/xray","default-values","helpers/querystring-add","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAdsPromoUrl=exports.onComplete=exports.sendAdsOffTargetGroup=exports.isAdsOffTargetGroup=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var e=__spreadArrays(b.ADV_OFF_QUERY_GROUP,b.ADV_OFF_MONTH_GROUP);var f;(function(a){a["alreadyNoAds"]="already_noads"})(f||(f={}));function g(){var a=b.ADV_EXP_ID&&e.includes(b.ADV_EXP_ID);var c=b.ADV_TARIFF_FEATURE===f.alreadyNoAds;return a&&!c}exports.isAdsOffTargetGroup=g;function h(){if(!b.ADV_EXP_ID_SEND||!g()){return Promise.resolve(null)}return d.default.call("/api/v1/prodsubs/noads/available").catch(function(b){a.default.send("noads_req_err",{rlog:"noads_req_err",rlog_message:{error:b}})})}exports.sendAdsOffTargetGroup=h;var i=function(a){window.open(a);window.addEventListener("message",function(a){var c=a.data,d=a.origin;if(d===b.ADV_NO_ADS_POSTMSG_URL&&c==="refresh"){window.location.reload()}})};exports.onComplete=i;var j=function(a){return c.default(b.ADV_NO_ADS_PROMO_URL,{from:a})};exports.getAdsPromoUrl=j});define("helpers/audio-player",["exports","default-values","mrg-xray"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(b);function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var g=function(){function b(a,c){e(this,b);this.soundFileName=a;this.audioElement=this._getAudioElement(c)}f(b,[{key:"_createSoundElement",value:function a(){var b=document.createElement("div");b.style.display="none";document.body.appendChild(b);return b}},{key:"_initSoundElement",value:function a(b,c){b.innerHTML='<audio preload="auto">'+'<source src="'+c+'.mp3" type="audio/mpeg">'+'<source src="'+c+'.ogg" type="audio/ogg">'+"</audio>"}},{key:"_getAudioElement",value:function a(b){var c=this._createSoundElement();this._initSoundElement(c,this.soundFileName);if(c&&c.childNodes[0]&&b&&b.id){c.childNodes[0].id=b.id}return c&&c.childNodes[0]}},{key:"play",value:function b(){if(this.audioElement){try{var d=this.audioElement.play();if(d!==void 0){d.then(function(){c.default.send("audio_notification_started",{skipdwh:a.SKIP_DWH})}).catch(function(){c.default.send("audio_notification_failed",{skipdwh:a.SKIP_DWH})})}}catch(b){c.default.send("audio_notification_exception",{skipdwh:a.SKIP_DWH})}}}}]);return b}();exports.default=g});define("helpers/notify-sound",["exports","cfg","helpers/audio-player"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var h=c.default.get("urls.packagesUrl")+"/static.promo/sounds/notifier/bell";var i=new d.default(h,{id:"notify-sound-player"});var j=function(){function a(){f(this,a)}g(a,[{key:"play",value:function a(){i.play()}}]);return a}();exports.default=new j});define("service/mailbox/on-status/unread-messages-notifications-utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.reactToChangesInUnread=exports.getNewSessionCounter=void 0;function a(a,b){var c=a-b;if(c>=0){return c}return 0}exports.getNewSessionCounter=a;function b(a,b,c){var d=a.totalUnreadGt,e=a.totalMsgGt,f=a.trackedUnreadGt,g=a.trackedMsgGt,h=a.isPageVisible,i=a.totalUnreadEq,j=a.totalMsgEq,k=a.trackedUnreadEq,l=a.trackedMsgEq;if(d&&e&&!h){if(f&&g){b()}}else if(!i||!j||!k||!l){c()}}exports.reactToChangesInUnread=b});define("service/mailbox/on-status/unread-messages-notifications",["exports","Emitter","helpers/notify-sound","service/radars/index","./unread-messages-notifications-utils"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b){var c=0;function d(d){var e=+new Date-c;if(e>b||d){c=+new Date;a()}}return d}function j(a){var b=this;e.default.apply(this);this._settings=a;this._sessionUnreadCounter=0;this._sessionStartTrackedUnreadCounter=0;this._prevTotalUnreadCounter=0;this._prevTotalMsgCounter=0;this._prevTrackedUnreadCounter=0;this._prevTrackedMsgCounter=0;this._isPageVisible=true;this._sessionFirstHandle=true;this._forceAudio=false;this._initAudioActions();document.addEventListener("visibilitychange",function(a){return b._onVisibilityChange(a)})}Object.assign(j.prototype,{_initAudioActions:function a(){this._playAudioIfTimePassed=i(function(){f.default.play();(0,g.default)({chain:["tabnotification_mail_sound_play"],intervals:[["add","1"]]})},this._settings.soundPlayingTimeout)},_playAudio:function a(){var b=this._settings.getState();if(b.sound){this._playAudioIfTimePassed(this._forceAudio);this._forceAudio=false}},_enableTitleBlinking:function a(){this._playAudio();this.emit("update",{count:this._sessionUnreadCounter,timeout:this._settings.titleBlinkingTimeout})},_disableTitleBlinking:function a(){this.emit("update")},_updTitleWithNotifications:function a(){var b=this._settings.getState();if(this._sessionUnreadCounter&&!this._isPageVisible&&b.enabled){this._enableTitleBlinking()}else{this._disableTitleBlinking()}},_resetSessionUnreadCounter:function a(){this._sessionStartTrackedUnreadCounter+=this._sessionUnreadCounter;this._sessionUnreadCounter=0;this._forceAudio=true},_onVisibilityChange:function a(b){this._isPageVisible=!b.target.hidden;if(this._isPageVisible){this._resetSessionUnreadCounter();this._disableTitleBlinking()}},_isHandledFolder:function a(b){return!(b.isTrashLike()||b.isSpam()||b.isArchive()||b.isSent()||b.isDrafts()||b.isTemplates()||b.isDeleted()||b.isOutbox())},_getFolderRoot:function a(b,c){var d=+b.get("parent");if(d===-1){return b}else{var e=void 0;for(var f=0;f<c.length;f++){if(+c[f].id===d){e=c[f]}}return this._getFolderRoot(e,c)}},_getMessagesCounter:function a(b,c,d){var e=this._settings.getState();var f=0;if(d){b.forEach(function(a){f+=a.get(c)})}else if(e.onlyInbox){var g=b.find(function(a){return a.isInbox()});if(g){return g.get(c)}return 0}else{for(var h=0;h<b.length;h++){var i=b[h];if(this._isHandledFolder(i,b)){f+=i.get(c)}}}return f},onNewMessagesInInactiveTab:function a(b){this._sessionUnreadCounter=b;this._updTitleWithNotifications(this._sessionUnreadCounter)},onChangeInMessages:function a(b){this._sessionUnreadCounter=b;this._resetSessionUnreadCounter();this._disableTitleBlinking()},handleUpdate:function a(b){var c=this;if(this._sessionFirstHandle){this._sessionFirstHandle=false;this._prevTotalUnreadCounter=this._getMessagesCounter(b.folders,"messages_unread",true);this._prevTotalMsgCounter=this._getMessagesCounter(b.folders,"messages_total",true);this._prevTrackedUnreadCounter=this._getMessagesCounter(b.folders,"messages_unread");this._prevTrackedMsgCounter=this._getMessagesCounter(b.folders,"messages_total");this._sessionStartTrackedUnreadCounter=this._prevTrackedUnreadCounter;return}var e=this._getMessagesCounter(b.folders,"messages_unread",true);var f=this._getMessagesCounter(b.folders,"messages_total",true);var g=this._getMessagesCounter(b.folders,"messages_unread");var h=this._getMessagesCounter(b.folders,"messages_total");var i=e>this._prevTotalUnreadCounter;var j=f>this._prevTotalMsgCounter;var k=g>this._prevTrackedUnreadCounter;var l=h>this._prevTrackedMsgCounter;var m=e===this._prevTotalUnreadCounter;var n=f===this._prevTotalMsgCounter;var o=g===this._prevTrackedUnreadCounter;var p=h===this._prevTrackedMsgCounter;var q=(0,d.getNewSessionCounter)(g,this._sessionStartTrackedUnreadCounter);(0,d.reactToChangesInUnread)({totalUnreadGt:i,totalMsgGt:j,trackedUnreadGt:k,trackedMsgGt:l,totalUnreadEq:m,totalMsgEq:n,trackedUnreadEq:o,trackedMsgEq:p,isPageVisible:this._isPageVisible},function(){return c.onNewMessagesInInactiveTab(q)},function(){return c.onChangeInMessages(q)});this._prevTrackedMsgCounter=h;this._prevTrackedUnreadCounter=g;this._prevTotalMsgCounter=f;this._prevTotalUnreadCounter=e}});exports.default=j});define("service/mailbox/on-status/unread-messages-notifications.setup",["exports","@mail/features","@mail/flags","../../../lazy.modules","service/mailbox/on-status/unread-messages-notifications","service/radars/index"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(a);var g=j(b);var h=j(d);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}var k=void 0;function l(){var a=f.default.get("unread-messages-notification");return a&&a.state&&a.data}exports.default={test:function a(){return l()},setup:function a(){var b=l().split(":");var d=b[0]===void 0?2e3:+b[0];var e=b[1]===void 0?3e4:+b[1];var f=!!(b[2]===void 0?false:+b[2]);var j=!!(b[3]===void 0?false:+b[3]);var m=!!(b[4]===void 0?false:+b[4]);function n(){var a=g.default.get("sound-notifications");var b=!!(a.state===void 0?f:a.state);var c=!!(a.state===void 0?m:a.getCount("close")%2);var d=!!(a.state===void 0?j:a.getCount("show")%2);return{enabled:b,sound:c,onlyInbox:d}}k=new h.default({titleBlinkingTimeout:d,soundPlayingTimeout:e,getState:n});var o=n();(0,c.lazyMediatorPageTitle)().then(function(a){var b=a.default;b.register(k)});(0,i.default)({chain:["tabnotification_mail_feature_"+(o.enabled?"on":"off")],intervals:[["add",1]]});(0,i.default)({chain:["tabnotification_mail_sound_"+(o.sound?"on":"off")],intervals:[["add",1]]});(0,i.default)({chain:["tabnotification_mail_inbox_"+(o.onlyInbox?"on":"off")],intervals:[["add",1]]})},handle:function a(){if(k){k.handleUpdate.apply(k,arguments)}}}});define("service/mailbox/listeners",["exports","service/mailbox/loader","service/mailbox/on-status/unread-messages-notifications.setup"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){f.filter(function(a){var b=!a.test||a.test();if(b&&a.setup){a.setup()}return b});f.forEach(function(a){c.default.on("data",a.handle)})};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=[d.default]});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/subscriptions/mailbox",["require","exports","@mail/features","helpers/object-to-query","logger","mrg-message-broker/Subscription/Subscription","RPC"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);function f(a){var d=e.default.setup("email");var f=e.default.setup("token");var g={};a=a||{};if(!a.logScope){a.logScope="mailboxSubscription"}if(a.endpoint){a.endpoint+="?"}else{a.endpoint=location.host+"/api-proxy/notifier/v1/ws?"}if(!a.system){this.system="storage"}this.event=a.event;if(d){g.email=d}if(f){g.token=f}a.endpoint+=b.default(g,true);this.options=a;this.log=c.default.getScope("subscription/Mailbox")}Object.assign(f.prototype,{_rev:null,_sub:null,subscribe:function(){var a=this;var b=this.options;if(this._sub){this.log.add("destroy old subscription");this._sub.destroy();this._sub=null}if(!this.isSupport()){this.log.add("subscription is not supported by client");return false}var c=new URL(b.endpoint,window.location.origin);c.searchParams.delete("token");this.log.add("connect to",c.toString());this._sub=new d.default("wss://"+b.endpoint,b);this._sub.onActivate=function(){return a.onActivate()};this._sub.onDeactivate=function(){return a.onDeactivate()};return true},isSupport:function(){if(!this._rev||!this._rev.revision||!this._rev.checksum){this.log.add("client revision is empty");return false}return d.default.isSupport()},onActivate:function(){var a=this;this.log.add("create subscription",this.system);this._sub.create(this.system,this.event)["catch"](function(b){return a.onError(b)});this._sub.on("storage.change",function(b){return a._handle(b)}).on("sync",function(){return a._handle("sync")}).on("attached",function(){return a._handle("attached")}).on("detached",function(){return a._handle("detached")})},onDeactivate:function(){},onDetached:function(){},onAttached:function(){},onError:function(a){this.log.add("mailbox fetch revision error",a)},onMailbox:function(a){this.log.add("get new notification",a)},setRevision:function(b){var c=a.default.get("test_threads_revision");var d=null;var e;if(c){if(typeof c.data!=="string"){c.data=c.data[0]}if(typeof c.data==="string"){e=c.data.split(",")}d={revision:e[0],checksum:e[1]}}if(b&&b.revisions&&b.revisions[this.system]){d=b.revisions[this.system];this.log.add("set new revision",d)}this._rev=d},_handle:function(a){if(a==="sync"){this.onMailbox()}else if(a==="detached"){this.onDetached()}else if(a==="attached"){this.onAttached()}else if(a.revision_last!==this._rev.revision&&a.checksum_last!==this._rev.checksum){this.onMailbox()}else{this.log.add("client has actual data")}}});exports.default=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/subscriptions/mailbox.setup",["require","exports","@mail/features","default-values","logger","service/mailbox/loader","service/radars/index","service/subscriptions/mailbox","utils/util"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);var h=function(){return document.visibilityState==="visible"};function i(){var i=a.default.has("threads_polling_disabled");var j=a.default.getAsArray("async_notify",[],"|");var k=a.default.getAsInt("keepalive_timeout_min_config_value",1e4);var l=a.default.get("async_notify_throttle");var m=a.default.has("async_notify_v2");var n={};var o=1e3;if(j.length>0){var p=a.default.URL({mail:true})("//"+j[0],"");if(j.length>=2&&p){n.endpoint=p;var q=+j[1];if(q===0||q>=k){n.keepalive={timeout:q}}var r=+j[3];var s=+j[4];if(isNaN(r)||isNaN(s)||r<1e3){r=1e4;s=5*60*1e3}if(r>s){s=r}var t=Math.ceil(r+(s-r)*Math.random());n.retry={number:+j[2],timeout:t}}n.event="change";n.version=m?2:1}if(l&&l.data){var u=parseInt(l.data,10);o=isNaN(u)||u<500?500:u}var v=new f.default(n);var w=Date.now();function x(){w=Date.now();d.default.emit("websocket:reload")}var y=g.default.throttle(x,o);var z=function(){var a=null;var d=false;return{start:function(){if(a!==null){return}d=true;if(b.POLLING_ONLY_VISIBLE&&!h()){return}c.default.add("start polling");var e=b.STATUS_AUTO_CALL*1e3;a=window.setInterval(x,e);if(Date.now()-w>e){x()}},stop:function(b,e){if(b===void 0){b="stop polling"}if(e===void 0){e=false}d=e;if(a===null){return}c.default.add(b);window.clearInterval(a);a=null},get isActive(){return a!==null},get waitStartAfterVisible(){return d}}}();if(b.POLLING_ONLY_VISIBLE){var A=function(){if(!h()){z.stop(undefined,z.isActive)}else if(z.waitStartAfterVisible){z.start()}};A();document.addEventListener("visibilitychange",A)}function B(){if(v.connected||!v.isSupport()||!a.default.has("async_notify")){return}if(i){z.stop()}v.subscribe();v.connected=true}Object.assign(v,{onDeactivate:function(){v.connected=false;z.start()},onMailbox:function(){if(z.isActive){z.stop("update polling timeout");z.start()}y()},onDetached:function(){if(i){z.start()}},onAttached:function(){if(i){z.stop()}y()},onError:function(a){d.default.emit("websocket:disconnected");if(a&&a.code){e.default({chain:["notifier","error"],intervals:[[String(Math.abs(a.code)),"1"]]})}}});if(!i){z.start()}d.default.on("data",function(a){v.setRevision(a);B()});v.setRevision(d.default.revision||{});B()}exports.default=i});define("service/mailbox/setup",["exports","@mail-core/dashboard","service/ads-off","service/mailbox/listeners","service/subscriptions/mailbox.setup"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(c){if(!h){h=a.userKeeper.group("app-source-setup",function(){(0,e.default)(c);(0,f.default)(c);(0,b.sendAdsOffTargetGroup)();return Promise.resolve()})}return h};var e=g(c);var f=g(d);function g(a){return a&&a.__esModule?a:{default:a}}var h=void 0});define("data-source/source/setup",["exports","service/mailbox/setup"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={fetch:function a(c){return(0,b.default)(c.router)}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/letters-loader/index",["require","exports","@mail/xray","../../helpers/fast-deep-equal"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LettersLoader=void 0;a=__importDefault(a);b=__importDefault(b);var c=function(){function c(a,b){this.context=a;this.service=b;this._updateNeeded=false;this.promise=Promise.resolve({context:__assign({},this.context)});this.tryHandleSecureOpenError=this.tryHandleSecureOpenError.bind(this)}c.prototype.doRequest=function(a){var b=this;this.promise=this.promise.then(function(c){var d=c.context;return b.service.doRequest(b.context,a).then(function(a){return{context:d,response:a}}).catch(function(a){throw{error:a,context:d}})})};c.prototype.deriveContext=function(a){this.promise=this.promise.then(function(b){var c=b.response,d=b.context;return{response:c,context:a(c,d)}})};c.prototype.catchError=function(a){this.promise=this.promise.catch(function(b){var c=b.error,d=b.context;return{response:undefined,context:a(c,d)}})};c.prototype.getSecureFolderNotOpenResponse=function(a){return __assign(__assign({},a),{folder:a.folder||0,letters:[],lettersTotal:0,lastUpdateTime:this.service.getCurrentTS()})};c.prototype.tryHandleSecureOpenError=function(a,b){if(this.service.isSecureFolderNotOpenError(a)){return this.getSecureFolderNotOpenResponse(b)}throw a};c.prototype.setUpdateNeeded=function(a){this._updateNeeded=a};c.prototype.isUpdateNeeded=function(a){return!!(this._updateNeeded||a.folder!==this.context.folder||!b.default(a.filters,this.context.filters)||!b.default(a.sort,this.context.sort))};c.prototype.run=function(){return this.promise.then(function(a){var b=a.context;return b})};c.prototype.immediateContext=function(){return this.context};c.prototype.waitFor=function(a){this.promise=this.promise.then(function(b){return a.then(function(){return b})})};c.prototype.remove=function(a,b){var c=this;this.deriveContext(function(d,e){var f=[];var g={};for(var h=0,i=a;h<i.length;h++){var j=i[h];g[j]=true}for(var k=0,l=c.context.letters;k<l.length;k++){var m=l[k];if(g[m.id]){b(m)}else{f.push(m)}}return __assign(__assign({},e),{letters:f})})};c.prototype._sendThreadsStatusSmartRadar=function(b){if(!b){return}var c=b.length;var d=0;var e=0;var f=0;b.forEach(function(a){var b,c;var g=(b=a===null||a===void 0?void 0:a.flags)===null||b===void 0?void 0:b.unread;var h=(c=a===null||a===void 0?void 0:a.flags)===null||c===void 0?void 0:c.is_relevant;if(g){d++}if(h){e++}if(g&&h){f++}});a.default.send("threads_status_smart",{dwh:{count:c,priority_count:e,has_priority_letters:e>0,unread_count:d,priority_unread_count:f,has_priority_unread_letters:f>0}})};return c}();exports.LettersLoader=c});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("data-source/letters-loader/paginator",["require","exports","./index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PaginatorLoader=void 0;var b=function(a){__extends(b,a);function b(b,c){var d=this;var e=false;if(b.page===undefined){b.page=1;b.letters=[];e=true}d=a.call(this,b,c)||this;d.setUpdateNeeded(e);return d}b.prototype.empty=function(a){this.context={folder:a.folder,folders:this.service.getAllFolders(),filters:a.filters,sort:a.sort,letters:[],discounts:[],collectors:[],lastUpdateTime:this.service.getCurrentTS(),lettersTotal:0,persistThreadId:undefined,isLastPage:false,threadMeta:{currentId:undefined,changed:true},page:1}};b.prototype.navigate=function(a){var b=this;var c=a.folder,d=a.filters,e=a.sort;if(!this.isUpdateNeeded(a)){this.update(a);return}var f=this.service.getListLimit()*2+1;this.doRequest({folder:c,offset:0,limit:f,filters:d,sort:e});this.deriveContext(function(g,h){var i;if(b.service.isActionLocked()){return h}var j={currentId:a.thread,changed:false};return __assign(__assign({},h),{folder:c,filters:d,sort:e,folders:b.service.mapFolders(g.folders),collectors:b.service.mapCollectors(g.collectors),letters:b.service.mapThreads(g.threads,j,0),lettersTotal:g.threadsTotal,mboxSize:g.mboxSize,lastUpdateTime:b.service.getCurrentTS(),discounts:b.service.mapMessages((i=g.discounts)===null||i===void 0?void 0:i.messages),threadMeta:j,page:1,isLastPage:g.threads.length!==f})});this.deriveContext(function(a,c){b.service.unreadMessagesNotificationsFix(c);return c});this.catchError(this.tryHandleSecureOpenError)};b.prototype.update=function(a){var b=a.folder;if(this.isUpdateNeeded(a)){this.navigate(a);return}this.loadPage(__assign(__assign({},a),{page:this.context.page,folder:b}),true)};b.prototype.loadMore=function(a){var b=a.folder;if(this.isUpdateNeeded(a)){this.navigate(a);return}this.loadPage(__assign(__assign({},a),{page:this.context.page+1,folder:b}))};b.prototype.loadPage=function(a,b){var c=this;if(b===void 0){b=false}var d=a.page;var e=a.filters,f=a.sort;if(this.isUpdateNeeded(a)){this.navigate(a);return}var g=!b&&d<this.context.page?this.context.lettersTotal:undefined;var h=this.service.getListLimit();var i=Math.max((d-1)*h-1,0);var j=this.service.getListLimit()*2+1;this.doRequest({folder:this.context.folder,offset:i,limit:j,filters:e,sort:f});this.deriveContext(function(b,h){var k;if(c.service.isActionLocked()){return h}var l=!!b.threads.length;if(!l){d=c.context.page}var m={currentId:a.thread,changed:false};c._sendThreadsStatusSmartRadar(b.threads);return __assign(__assign({},h),{filters:e,sort:f,folder:c.context.folder,folders:c.service.mapFolders(b.folders),collectors:c.service.mapCollectors(b.collectors),letters:c.service.mapThreads(b.threads,m,i),lastUpdateTime:c.service.getCurrentTS(),discounts:c.service.mapMessages((k=b.discounts)===null||k===void 0?void 0:k.messages),lettersTotal:g!==undefined?g:b.threadsTotal,mboxSize:b.mboxSize,page:d,threadMeta:m,isLastPage:b.threads.length!==j})});this.deriveContext(function(a,b){c.service.unreadMessagesNotificationsFix(b);return b});this.catchError(this.tryHandleSecureOpenError)};b.prototype.getSecureFolderNotOpenResponse=function(b){return __assign(__assign({},a.prototype.getSecureFolderNotOpenResponse.call(this,b)),{page:1,isLastPage:true})};return b}(a.LettersLoader);exports.PaginatorLoader=b});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("data-source/letters-loader/status",["require","exports","./index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StatusLoader=void 0;var b=function(a){__extends(b,a);function b(b,c){var d=this;var e=false;if(b.page!==undefined){delete b.page;b.letters=[];e=true}d=a.call(this,b,c)||this;d.setUpdateNeeded(e);return d}b.prototype.empty=function(a){this.context={folder:a.folder,filters:a.filters,sort:a.sort,folders:this.service.getAllFolders(),letters:[],discounts:[],collectors:[],lastUpdateTime:this.service.getCurrentTS(),lettersTotal:0,persistThreadId:undefined,isLastPage:false,threadMeta:{currentId:undefined,changed:true}}};b.prototype._navigateWithoutErrorHandling=function(a){var b=this;var c=a.folder,d=a.filters,e=a.sort;if(!this.isUpdateNeeded(a)){this.update(a);return}var f=this.service.getListLimit();this.doRequest({folder:c,offset:0,limit:f,filters:d,sort:e});this.deriveContext(function(g,h){var i;if(b.service.isActionLocked()){return h}var j={currentId:a.thread,changed:false};b._sendThreadsStatusSmartRadar(g.threads);return __assign(__assign({},h),{folder:c,filters:d,sort:e,folders:b.service.mapFolders(g.folders),sharedMailboxes:b.service.mapSharedMailboxes(g.userGrants),collectors:b.service.mapCollectors(g.collectors),letters:b.service.mapThreads(g.threads,j,0),lettersTotal:g.threadsTotal,mboxSize:g.mboxSize,lastUpdateTime:b.service.getCurrentTS(),isLastPage:g.threads.length!==f,discounts:b.service.mapMessages((i=g.discounts)===null||i===void 0?void 0:i.messages),threadMeta:j})})};b.prototype.navigate=function(a){this._navigateWithoutErrorHandling(a);this.catchError(this.tryHandleSecureOpenError)};b.prototype._updateWithoutErrorHandling=function(a){var b=this;var c=a.filters,d=a.sort;if(this.isUpdateNeeded(a)){this.navigate(a);return}var e=this.service.getListLimit();this.doRequest({folder:this.context.folder,offset:0,limit:e,filters:c,sort:d});this.deriveContext(function(c,d){var f;if(b.service.isActionLocked()){return d}var g={currentId:a.thread,changed:false};b._sendThreadsStatusSmartRadar(c.threads);return __assign(__assign({},d),{folders:b.service.mapFolders(c.folders),sharedMailboxes:b.service.mapSharedMailboxes(c.userGrants),collectors:b.service.mapCollectors(c.collectors),lettersTotal:c.threadsTotal,mboxSize:c.mboxSize,lastUpdateTime:b.service.getCurrentTS(),isLastPage:c.threads.length!==e,discounts:b.service.mapMessages((f=c.discounts)===null||f===void 0?void 0:f.messages),letters:b.service.mergeThreadLists(b.context.letters,b.service.mapThreads(c.threads,g,0),{offset:0,limit:b.service.getListLimit(),persistThread:d.persistThreadId}),threadMeta:g})})};b.prototype.update=function(a){this._updateWithoutErrorHandling(a);this.catchError(this.tryHandleSecureOpenError)};b.prototype.loadMore=function(a){var b=this;var c=a.filters,d=a.sort;if(this.isUpdateNeeded(a)){this.navigate(a);return}var e=this.service.getListLimit();this.doRequest({folder:this.context.folder,offset:this.context.letters.length,limit:e,filters:c,sort:d});this.deriveContext(function(c,d){var f;if(b.service.isActionLocked()){return d}var g={currentId:a.thread,changed:false};b._sendThreadsStatusSmartRadar(c.threads);return __assign(__assign({},d),{folder:d.folder,folders:b.service.mapFolders(c.folders),sharedMailboxes:b.service.mapSharedMailboxes(c.userGrants),collectors:b.service.mapCollectors(c.collectors),letters:b.service.concatThreadLists(d.letters,b.service.mapThreads(c.threads,g,d.letters.length)),lettersTotal:c.threadsTotal,mboxSize:c.mboxSize,lastUpdateTime:b.service.getCurrentTS(),isLastPage:c.threads.length!==e,discounts:b.service.mapMessages((f=c.discounts)===null||f===void 0?void 0:f.messages),threadMeta:g})});this.catchError(this.tryHandleSecureOpenError)};return b}(a.LettersLoader);exports.StatusLoader=b});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();define("data-source/letters-loader/status-with-legacy-notify",["require","exports","./status"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StatusWithLegacyNotifyLoader=void 0;var b=function(a){__extends(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}b.prototype.navigate=function(b){var c=this;a.prototype._navigateWithoutErrorHandling.call(this,b);this.deriveContext(function(a,b){if(a){c.service.unreadMessagesNotificationsFix(b)}return b});this.catchError(this.tryHandleSecureOpenError)};b.prototype.update=function(b){var c=this;a.prototype._updateWithoutErrorHandling.call(this,b);this.deriveContext(function(a,b){c.service.unreadMessagesNotificationsFix(b);return b});this.catchError(this.tryHandleSecureOpenError)};b.prototype.loadMore=function(b){var c=this;a.prototype.loadMore.call(this,b);this.deriveContext(function(a,b){c.service.unreadMessagesNotificationsFix(b);return b})};return b}(a.StatusLoader);exports.StatusWithLegacyNotifyLoader=b});define("data-source/source/status",["exports","@mail-core/dashboard","data-source/actions","data-source/letters-loader/paginator","data-source/letters-loader/status","data-source/letters-loader/status-with-legacy-notify","data-source/match/match","data-source/utils","data-source/utils/paginator","route/utils/filter-query"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.emptyStatusFromRequest=o;var j=l(f);var k=l(i);function l(a){return a&&a.__esModule?a:{default:a}}function m(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var n=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function o(a){var b=(0,h.isPaginatorGlobalEnabled)(a.router)?new c.PaginatorLoader({},g.lettersLoaderIntegrationService):new d.StatusLoader({},g.lettersLoaderIntegrationService);b.empty({thread:a.params&&a.params.letter,folder:a.folder,filters:k.default.get(),sort:k.default.getSorting()});return b.immediateContext()}exports.default={match:(0,j.default)(["#attachment","#attachment-editor"]).exclude,fetch:function d(f,i,j,l){var o=(0,g.getStore)();var p=o.search;var q=j&&j.type;var r=f&&f.route&&f.route.is("#search #search-letter");var s=l&&l.status||{};var t=Promise.all([i("setup"),i("uiThreadsSettings")]);var u=(0,g.prevStatusIfActionLocked)(l);if(u){return u}var v=k.default.get();var w=k.default.getSorting();var x=parseInt(f.params.folder,10)||0;return a.userKeeper.group("app-fetch-status",function(){return t.then(function(a){var d=n(a,2),i=d[0],k=d[1];var o=(0,h.isPaginatorEnabled)(f.router,k)?new c.PaginatorLoader(s,g.lettersLoaderIntegrationService):new e.StatusWithLegacyNotifyLoader(s,g.lettersLoaderIntegrationService);if(!l||!l.status){o.navigate({thread:f.params.letter,filters:v,sort:w,folder:r?0:x});return o.run()}switch(q){case b.LOAD_MORE:if(j.prev){o.loadPage({page:(o.immediateContext().page||1)-1,folder:x,filters:v,sort:w,thread:f.params.letter})}else{o.loadMore({folder:x,filters:v,sort:w,thread:f.params.letter})}break;case b.LOAD_PAGE:o.loadPage({page:j.page,folder:x,filters:v,sort:w,thread:f.params.letter});break;case b.TOGGLE_THREADS_SETTING:case b.TOGGLE_METATHREADS_SETTING:case b.CHANGE_METATHREADS_SETTING:case b.TOGGLE_TO_MYSELF_METATHREAD:case b.EDIT_METATHREADS_SETTINGS:case b.TOGGLE_METATHREADS_SETTINGS:case b.HIDE_PRIORITY_MESSAGES:case b.CLOSE_PRIORITY_MESSAGES:case b.UPDATE_ALL:o.update({folder:x,filters:v,sort:w,thread:f.params.letter});break;case b.NAVIGATE:if(p&&!f.is("#search")&&!f.is("#search-letter")){p.clear()}o.navigate({filters:v,sort:w,folder:r?0:x,thread:f.params.letter});break;case b.DESTROY_THREADS_AND_MESSAGES:{var t=[].concat(m(j.models.messages),m(j.models.threads));o.remove(t.map(function(a){return a.id}),function(a){(0,g.destroyThreadOrMessage)(a)});break}case b.EXECUTE_JSSDK_ACTION:{return(0,g.prevStatus)(l)}default:{var u={folder:x,filters:v,sort:w,thread:f.params.letter};if(o.isUpdateNeeded(u)){o.update(u)}break}}return o.run()})},{score:"fetch",appendix:!q?"no-act":"act"})}}});define("data-source/source/suggest-search",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={match:["#search","#search-letter"],fetch:function a(b,c){return c("search").then(function(a){if(a&&a.query){return{suggestQuery:a.extraSuggestSearchQuery,baseQuery:a.query.query}}})}}});define("data-source/utils/letter-list-virtualization",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getOneLineLetterHeight=exports.getGenericItemHeight=exports.HEIGHT_3PANE_ONELINE=exports.HEIGHT_GENERIC_3PANE_PONY=exports.HEIGHT_GENERIC_3PANE=exports.HEIGHT_GENERIC_2PANE_PONY=exports.HEIGHT_GENERIC_2PANE=void 0;exports.HEIGHT_GENERIC_2PANE=48;exports.HEIGHT_GENERIC_2PANE_PONY=40;exports.HEIGHT_GENERIC_3PANE=100;exports.HEIGHT_GENERIC_3PANE_PONY=82;exports.HEIGHT_3PANE_ONELINE=exports.HEIGHT_GENERIC_3PANE_PONY;function a(a,b){if(a){if(b){return exports.HEIGHT_GENERIC_3PANE_PONY}return exports.HEIGHT_GENERIC_3PANE}if(b){return exports.HEIGHT_GENERIC_2PANE_PONY}return exports.HEIGHT_GENERIC_2PANE}exports.getGenericItemHeight=a;function b(b,c){if(b&&!c){return exports.HEIGHT_3PANE_ONELINE}return a(b,c)}exports.getOneLineLetterHeight=b});define("helpers/seedable-random",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function b(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function d(){return Math.floor(Math.random()*4294967296)}var e=function(){c(e,null,[{key:"randomSeed",value:function a(){return[d(),d(),d(),d()]}}]);function e(){var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[d(),d(),d(),d()],f=a(c,4),g=f[0],h=f[1],i=f[2],j=f[3];b(this,e);this.a=g;this.b=h;this.c=i;this.d=j}c(e,[{key:"random",value:function a(){var b=this.b<<9;var c=this.a*5;c=(c<<7|c>>>25)*9;this.c^=this.a;this.d^=this.b;this.b^=this.c;this.a^=this.d;this.c^=b;this.d=this.d<<11|this.d>>>21;return(c>>>0)/4294967296}}]);return e}();exports.default=e});define("helpers/suggest-search",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFormattedSuggestQueries=a;exports.getSearchRadarIntervals=b;function a(a){if(!a||!a.length){return""}return a.map(function(a){return"«"+a+"»"}).join(", ")}function b(a,b){var c=a.lettersTotal,d=a.suggestLettersTotal;var e=b>c;var f=!c&&e?b-1:b;var g=[["letter_rank",f]];if(d&&e){g.push(["from_suggest",1])}return g}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/utils/actual-letters",["require","exports","default-values","mail/Folder","mail/User"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isActualLettersEnabledInFolder=void 0;b=__importDefault(b);c=__importDefault(c);function d(d,e,f){var g,h,i,j;if(!a.HAS_PRIORITY_MESSAGES){return false}var k=(h=(g=d===null||d===void 0?void 0:d.model)===null||g===void 0?void 0:g.uiThreadsSettings)!==null&&h!==void 0?h:{};if((!k.metathreads||((i=k.metathreadsSettings)===null||i===void 0?void 0:i[b.default.NEWSLETTERS])===c.default.METATHREADS_STATES.OFF)&&f){return false}var l=false;switch((j=d===null||d===void 0?void 0:d.route)===null||j===void 0?void 0:j.id){case"#read-letter":{l=a.FORCE_SHOW_PRIORITY_MESSAGES_READ_LETTER;break}case"#letters":{l=a.FORCE_SHOW_PRIORITY_MESSAGES_LIST_LETTERS;break}}return l||k.actualLettersNewsletters&&(e===null||e===void 0?void 0:e.isNewsletters())||k.actualLettersInbox&&(e===null||e===void 0?void 0:e.isInbox())}exports.isActualLettersEnabledInFolder=d});define("feast-tpl!app/feast-tpl!ui-block/dataset-letters/dataset-letters.html",["feast"],function(a){return a.smartParse('<div qa:id="dataset-letters">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="realtouch" value="{_this.isTouchDevice()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="actualLettersEnabledInInbox" value="{attrs.router.model.uiThreadsSettings.actualLettersInbox}"/>\n\t<fn:var name="actualLettersEnabledInNewsletters" value="{attrs.router.model.uiThreadsSettings.actualLettersNewsletters}"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="transparent" test="attrs.transparent"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t<b:draggable\n\t\tenabled="{!realtouch}"\n\t\tremit:preparedragelement="preparedragelement"\n\t\tuse:mediator="todo-manager">\n\t\t\x3c!-- Content --\x3e\n\t\t\x3c!-- x-атрибуты нужны только для того, чтобы обновлять модели в кеше при их изменении --\x3e\n\t\t\x3c!-- Никакой завязки на них в коде dataset нету, x-* это просто способ показать, что атрибут не используется ни для чего кроме didUpdate --\x3e\n\t\t<b:dataset\n\t\t\tkey="{_this.isSearch() ? \'search\' : (\'folder_\' + attrs.folder.id)}"\n\t\t\tid="dataset"\n\t\t\tmodels="{attrs.models}"\n\t\t\tcompact="{attrs.compact}"\n\t\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\t\tselected="{attrs.selected}"\n\t\t\tselect-mode="{attrs[\'select-mode\']}"\n\t\t\titem-height="{_this.getItemHeight}"\n\t\t\titem-context="{_this.getItemContext}"\n\t\t\tpersist="{_this.getItemPersist}"\n\t\t\titems-update="{_this.handleItemsUpdate}"\n\t\t\thandle-new-range="{_this.onNewRange}"\n\t\t\tletter-not-found="{attrs[\'letter-not-found\']}"\n\t\t\tuse:mediator="metathreads-manager welcome-block-manager"\n\t\t\thandle-scroll="{_this.handleScroll}"\n\t\t\tx-realtouch="{realtouch}"\n\t\t\tx-ponymode="{ponymode}"\n\t\t\tx-transparent="{attrs.transparent}"\n\t\t\tx-compact="{attrs.compact}"\n\t\t\tx-thread="{attrs.thread}"\n\t\t\tx-actual-inbox="{actualLettersEnabledInInbox}"\n\t\t\tx-actual-newsletters="{actualLettersEnabledInNewsletters}"\n\t\t>\n\n\t\t\t<fn:match name="dataset-item" args="model, index, length, context">\n\t\t\t\t\x3c!-- Следующая модель --\x3e\n\t\t\t\t<fn:var name="next" value="{context.next}"/>\n\t\t\t\t\x3c!-- Модель расположена перед раскрытым метатредом --\x3e\n\t\t\t\t<fn:var name="isNextItemExpandedMetathread" value="{context.isNextItemExpandedMetathread}"/>\n\t\t\t\t\x3c!-- Модель является первой в списке писем --\x3e\n\t\t\t\t<fn:var name="isFirst" value="{context.isFirst}"/>\n\t\t\t\t\x3c!-- Модель является последней в списке писем --\x3e\n\t\t\t\t<fn:var name="isLast" value="{context.isLast}"/>\n\t\t\t\t\x3c!-- Предыдущая модель --\x3e\n\t\t\t\t<fn:var name="prev" value="{context.prev}"/>\n\t\t\t\t\x3c!-- Модель расположена после раскрытого метатреда --\x3e\n\t\t\t\t<fn:var name="isPrevItemExpandedMetathread" value="{context.isPrevItemExpandedMetathread}"/>\n\t\t\t\t<fn:var name="isPriority" value="{_this.isPriorityMessage(model)}"/>\n\t\t\t\t\x3c!-- Счетчик для остлеживания открытия метатреда --\x3e\n\t\t\t\t<fn:var name="metathreadExpandCounter" value="{context.metathreadExpandCounter}"/>\n\t\t\t\t\x3c!-- Параметр для остлеживания открытия метатреда --\x3e\n\t\t\t\t<fn:var name="metathreadLastToggle" value="{context.metathreadLastToggle}"/>\n\n\t\t\t\t\x3c!-- Распорки и скелетоны пагинатора --\x3e\n\t\t\t\t<fn:var name="skeletonIndex" value="{context.skeletonIndex}"/>\n\t\t\t\t<fn:var name="heightCompensation" value="{context.heightCompensation}"/>\n\n\t\t\t\t\x3c!-- Остальное --\x3e\n\t\t\t\t<fn:var name="sticky" value="{context.sticky}"/>\n\t\t\t\t<fn:var name="searchInExcludedFoldersUrl" value="{context.searchInExcludedFoldersUrl}"/>\n\t\t\t\t<fn:var name="suggestSearch" value="{context.suggestSearch}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="model.is(\'heightCompensation\')">\n\t\t\t\t\t\t\x3c!-- Распорка, компенсирующая высоту предыдущей страницы при переключении:Начало --\x3e\n\t\t\t\t\t\t<b:list-letter-height-compensation\n\t\t\t\t\t\t\tkey="{model.id}"\n\t\t\t\t\t\t\theight="{heightCompensation}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Распорка, компенсирующая высоту предыдущей страницы при переключении:Конец --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'skeletonLetter\')">\n\t\t\t\t\t\t\x3c!-- Письмо, которое грузится:Начало --\x3e\n\t\t\t\t\t\t<b:list-letter-skeleton\n\t\t\t\t\t\t\tkey="{model.id}"\n\t\t\t\t\t\t\tindex="{skeletonIndex}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Письмо, которое грузится:Конец--\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'promoBlockLetter\')">\n\t\t\t\t\t\t\x3c!-- 2promo promo-block-letter:Start --\x3e\n\t\t\t\t\t\t<b:promo-block-letter\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}" uid="{model.id}"\n\t\t\t\t\t\t\tno-margin-collapse\n\t\t\t\t\t\t\tuse:mediator="layout-manager advert-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- 2promo promo-block-letter:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'welcomeBlockLetter\')">\n\t\t\t\t\t\t\x3c!-- list-letter-welcome:Start --\x3e\n\t\t\t\t\t\t<b:list-letter-welcome\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}" uid="{model.id}"\n\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\tuse:mediator="layout-manager user-info welcome-block-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- list-letter-welcome:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'discountsBlockLetter\')">\n\t\t\t\t\t\t\x3c!-- discounts:Start --\x3e\n\t\t\t\t\t\t<b:discounts\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}" uid="{model.id}"\n\t\t\t\t\t\t\t\tdiscounts="{context.discounts}"\n\t\t\t\t\t\t\t\t3pane="{attrs.compact}"\n\t\t\t\t\t\t\t\tsearch="{_this.isSearch()}"\n\t\t\t\t\t\t\t\tthreadsEnabled="{attrs.threadsEnabled}"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\tfolder="{attrs.router.model.folder}"\n\t\t\t\t\t\t\t\tuse:mediator="layout-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- discounts:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'specProjectLetter\')">\n\t\t\t\t\t\t\x3c!-- spec-project-letter:Start --\x3e\n\t\t\t\t\t\t<b:spec-project-letter\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t\tno-delimeter\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- spec-project-letter:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'advModel\')">\n\t\t\t\t\t\t\x3c!-- Advertisement:Start --\x3e\n\t\t\t\t\t\t<b:letter-list-item-adv\n\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tfolder="{attrs.folder.id}"\n\t\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\t\tmetathreadLastToggle="{metathreadLastToggle}"\n\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\tindent="{model.is(\'inMetathread\')}"\n\t\t\t\t\t\t\tposition="{model.get(\'position\')}"\n\t\t\t\t\t\t\tindex="{model.get(\'index\')}"\n\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Advertisement:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'baitLetter\')">\n\t\t\t\t\t\t\x3c!-- AdBlock Bait:Start --\x3e\n\t\t\t\t\t\t<b:list-letter-bait key="{_this.getKey(model)}"/>\n\t\t\t\t\t\t\x3c!-- AdBlock Bait:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'spinnerLetter\')">\n\t\t\t\t\t\t\x3c!-- Spinner:Start --\x3e\n\t\t\t\t\t\t<b:list-letter-spinner\n\t\t\t\t\t\t\tkey="{\'spinner\' + attrs.folder.id}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\tuse:mediator="letters-loader"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\x3c!-- Spinner:End --\x3e\n\t\t\t\t\t<fn:when test="model.is(\'searchActionLetter\')">\n\t\t\t\t\t\t<b:list-letter-preview-action\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tuse:mediator="search-manager"\n\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\thref="{searchInExcludedFoldersUrl}"\n\t\t\t\t\t\t\tqueries="{suggestSearch}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'tipLetter\')">\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="attrs.folder.isSpam()">\n\t\t\t\t\t\t\t\t<b:list-letter-tip\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tuse:mediator="folders-actions layout-manager"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\ttype="spam:cleanup"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:when test="attrs.folder.isTrashLike()">\n\t\t\t\t\t\t\t\t<b:list-letter-tip\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tuse:mediator="folders-actions layout-manager"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\ttype="trash:cleanup"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.get(\'flags.metathread\')">\n\t\t\t\t\t\t\x3c!-- Metathread:Start --\x3e\n\t\t\t\t\t\t<b:metathread\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tindex="{index}"\n\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\t\ttouch="{realtouch}"\n\t\t\t\t\t\t\tselected="{attrs.selected[model.id]}"\n\t\t\t\t\t\t\tsticky="{sticky}"\n\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\trouter="{attrs.router}"\n\n\t\t\t\t\t\t\thas-selected="{attrs.metathreadsWithSelected[model.id]}"\n\t\t\t\t\t\t\tevent:details="model"\n\t\t\t\t\t\t\tqa:id="metathread"\n\t\t\t\t\t\t\tremit:scrollintomodel="scrollintomodel"\n\t\t\t\t\t\t\tuse:mediator="metathreads-manager letters-selection layout-manager folders-navigation"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- /Metathread:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'metathreadFooter\')">\n\t\t\t\t\t\t<b:metathread-footer\n\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\thide-footer-spacer="{isNextItemExpandedMetathread}"\n\n\t\t\t\t\t\t\t\tevent:details="model"\n\t\t\t\t\t\t\t\tremit:click-metathread-link="click:metathread-link"\n\t\t\t\t\t\t\t\tuse:mediator="layout-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- Thread:Start --\x3e\n\t\t\t\t\t\t\x3c!-- Показываем отступ в письмах если они относятся к метатреду  --\x3e\n\t\t\t\t\t\t\x3c!-- На 3pane они выглядят как в компактном виде --\x3e\n\t\t\t\t\t\t<fn:var name="indent" value="{model.isInMetathread()}"/>\n\t\t\t\t\t\t<fn:var name="isMetathread" value="{model.isInMetathread()}"/>\n\t\t\t\t\t\t<fn:var name="isSearch" value="{_this.isSearch()}"/>\n\n\t\t\t\t\t\t\x3c!-- Письмо выбрано? --\x3e\n\t\t\t\t\t\t<fn:var name="selected" value="{_this.isLetterSelected(model)}"/>\n\t\t\t\t\t\t\x3c!-- Письмо активно? --\x3e\n\t\t\t\t\t\t<fn:var name="active" value="{!attrs[\'select-mode\'] && _this.isLetterActive(model)}"/>\n\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="realtouch && attrs.compact">\n\t\t\t\t\t\t\t\t\x3c!-- touch 3pane --\x3e\n\t\t\t\t\t\t\t\t<b:list-letter-compact-touch\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tactive="{active}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t<fn:when test="realtouch">\n\t\t\t\t\t\t\t\t\x3c!-- touch 2pane --\x3e\n\t\t\t\t\t\t\t\t<b:list-letter-common-touch\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tactive="{active}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t<fn:when test="attrs.compact">\n\t\t\t\t\t\t\t\t\x3c!-- desktop 3pane --\x3e\n\t\t\t\t\t\t\t\t<b:list-letter-compact\n\t\t\t\t\t\t\t\t\tpriority="{isPriority}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode || isMetathread}"\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tactive="{active}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tshow-attaches="{_this.shouldShowLetterPreview(model)}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions layout-manager letter-attaches-preview unsubscribe-actions"\n\t\t\t\t\t\t\t\t\tlayout-mode="3pane"\n\t\t\t\t\t\t\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t\tunsubscribeList="{attrs.unsubscribeList}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\x3c!-- desktop 2pane  --\x3e\n\t\t\t\t\t\t\t\t<b:list-letter-common\n\t\t\t\t\t\t\t\t\tpriority="{isPriority}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tshow-attaches="{_this.shouldShowLetterPreview(model)}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tremit:openletter="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tremit:previewattach="click:previewattach"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions letter-attaches-preview layout-manager unsubscribe-actions"\n\t\t\t\t\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\t\t\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t\x3c!-- Thread:End --\x3e\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:match>\n\n\t\t\t<fn:match name="dataset-empty">\n\t\t\t\t<div bem:elem="empty">\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="attrs.search && !attrs[\'search-letter\']">\n\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\ttype="no-search"\n\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager layout-manager folders-navigation filter-manager settings-filters-manager compose-manager search-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:when test="attrs[\'letter-not-found\']">\n\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\ttype="no-letter" folder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager folders-navigation filter-manager settings-filters-manager compose-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\ttype="empty-folder"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager folders-navigation filter-manager settings-filters-manager compose-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\t\t\t</fn:match>\n\n\t\t\t<fn:match name="navigator" args="range">\n\t\t\t\t<b:paginator-container\n\t\t\t\t\tvisible="{attrs.paginator || attrs[\'nav-up\']}"\n\t\t\t\t\tpaginator="{attrs.paginator}"\n\t\t\t\t\tnav-up="{attrs.paginator || attrs[\'nav-up-enabled\']}"\n\n\t\t\t\t\tuse:mediator="layout-manager compose-manager"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="paginator">\n\t\t\t\t\t\t<b:paginator\n\t\t\t\t\t\t\tlength="{attrs.status.lettersTotal}"\n\t\t\t\t\t\t\tcurrent="{_this.getPaginatorPage(range, true)}"\n\t\t\t\t\t\t\tremit:navigate="paginator:navigate"\n\t\t\t\t\t\t\tuse:mediator="progress-bar-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="nav-up">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\tico="navigation:arrow_up"\n\t\t\t\t\t\t\ttitle="{i18n(\'Наверх\')}"\n\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\tsmall\n\t\t\t\t\t\t\tdisabled="{!attrs[\'nav-up\']}"\n\t\t\t\t\t\t\tqa:id="paginator-button-up"\n\t\t\t\t\t\t\tremit:click="paginator:up"\n\t\t\t\t\t\t\tcentered\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:paginator-container>\n\t\t\t</fn:match>\n\n\t\t</b:dataset>\n\t</b:draggable>\n</div>\n',"app/feast-tpl!ui-block/dataset-letters/dataset-letters.html")});define("feast-tpl!ui-block/dataset-letters/dataset-letters.html",["feast-tpl!app/feast-tpl!ui-block/dataset-letters/dataset-letters.html"],function(a){return a});define("helpers/get-go-to-action-display-mode",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getGoToActionHeight=exports.getGoToActionDisplayMode=void 0;function b(b,c,d,e){if(b===void 0){b=this.get("model")}if(c===void 0){c=this.get("pony-mode")}if(d===void 0){d=this.get("search")}if(e===void 0){e=this.is("in-thread")}if(d||e||!a.GO_TO_ACTION_BUTTOM){return"none"}try{var f=b.getGoToActionMeta();if(!f){return"none"}return f.description&&!c?"full":"compact"}catch(a){return"none"}}exports.getGoToActionDisplayMode=b;function c(a,c,d,e,f){var g=b(a,c,d,false);if(g==="none"){return 0}if(!e){return 32}if(!c&&g==="compact"){return-18}if(f&&!c&&g!=="compact"){return 20}return 0}exports.getGoToActionHeight=c});define("helpers/keys",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isNewTabClick=b;var a=1;function b(b){return b.metaKey||b.ctrlKey||b.button===a}});define("helpers/letter",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasLetterReplyAll=exports.checkReliable=exports.checkImportantReliable=exports.checkOfficial=exports.checkOfficialGreen=exports.isListLetterActionButtonsEnabled=exports.getLetterHref=exports.getLetterIdAndFolder=void 0;function b(a,b,c){var d=c.threadsEnabled,e=c.isSearch;var f=a.meta("thread_id")||a.get("thread_id")||a.id;var g=null;if(e&&!d&&!a.meta("thread_id")){g=a.get("folder");f="0:"+a.id+":"+(g||"0")}return{threadId:f,letterId:a.id,folderId:g||b.id}}exports.getLetterIdAndFolder=b;function c(a,c,d){var e=d.search?"#search-letter":"#read-letter";var f=d.router[e];var g=b(a,c,{threadsEnabled:d.threads,isSearch:d.search}),h=g.threadId,i=g.letterId,j=g.folderId;return f.getUrl({letter:h,folder:j,id:i},"inherit")}exports.getLetterHref=c;function d(b,c){var d;if(!b||typeof b.getFolder!=="function"||typeof((d=b.getFolder())===null||d===void 0?void 0:d.isParentalControl)!=="function"){return false}return a.ENABLE_LIST_LETTER_ACTION_BUTTONS&&!c&&b.getFolder().isParentalControl()}exports.isListLetterActionButtonsEnabled=d;function e(b){return a.SHOW_OFFICIAL_ON_LETTER_LIST&&!a.DISABLE_GREEN_OFFICIAL_ON_LETTER_LIST&&b.is("flags.official")}exports.checkOfficialGreen=e;function f(b){return a.SHOW_OFFICIAL_ON_LETTER_LIST&&(b.is("flags.official")||b.is("flags.official_newsletter"))}exports.checkOfficial=f;function g(b){return a.SHOW_RELIABLE_ON_LETTER_LIST&&!a.DISABLE_GREEN_RELIABLE_ON_LETTER_LIST&&b.is("flags.bimi_important_msg")}exports.checkImportantReliable=g;function h(b){return a.SHOW_RELIABLE_ON_LETTER_LIST&&(b.is("flags.bimi_important_msg")||b.is("flags.bimi_msg"))}exports.checkReliable=h;function i(a){if(!a){return false}return a.get("correspondents.to.length")+a.get("correspondents.cc.length")>1}exports.hasLetterReplyAll=i});define("feast-mod/brackets",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.brackets=function a(b){return"«"+b+"»"}});define("feast-mod/folder-name",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFolderName=b;exports.getMetathreadName=c;var a={500011:i18n("Соц. сети")};function b(b){var c=b.get("name");var d=a[b.get("id")];return d||c||""}function c(b){var c=b.get("metathread_data.folder");var d=b.get("metathread_data.folder_name");var e=a[c];return e||d||""}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/metathreads",["require","exports","@mail/features","feast-mod/brackets","feast-mod/folder-name","mail/User","RPC"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isMetathreadOnFromState=exports.getMetathreadSettingsFromState=exports.getModelCurrentFolder=exports.getRemoveButtonText=exports.getMarkAllReadText=exports.getShortname=exports.metathreadsToggle=void 0;a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);function f(b){return e.default.post("user/edit",{common_purpose_flags:{metathreads_on:b}}).then(function(){a.default.import({metathreads:{state:b}})})}exports.metathreadsToggle=f;function g(a){return b.brackets(c.getMetathreadName(a))}exports.getShortname=g;function h(){return i18n("Отметить всё прочитанным")}exports.getMarkAllReadText=h;function i(a,b){if(b===void 0){b=false}var c=g(a);return i18n("Удалить")+(b?"":" "+c)}exports.getRemoveButtonText=i;function j(a){var b;var c=a.isInMetathread&&a.isInMetathread();return c?a.getContainingMetathread().getFolder():(b=a.getFolder)===null||b===void 0?void 0:b.call(a)}exports.getModelCurrentFolder=j;function k(a){switch(a){case d.default.METATHREADS_STATES.ON:return{isOn:true,isHiddenOnLetterList:false};case d.default.METATHREADS_STATES.HIDDEN:return{isOn:true,isHiddenOnLetterList:true};case d.default.METATHREADS_STATES.OFF:return{isOn:false,isHiddenOnLetterList:false};default:return{isOn:false,isHiddenOnLetterList:false}}}exports.getMetathreadSettingsFromState=k;function l(a){switch(a){case d.default.METATHREADS_STATES.ON:case d.default.METATHREADS_STATES.HIDDEN:return true;case d.default.METATHREADS_STATES.OFF:return false;default:return false}}exports.isMetathreadOnFromState=l});define("helpers/new-letter-list",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isNewLetterListEnabled=void 0;function b(b){return b?a.NEW_LETTER_LIST_3PANE:a.NEW_LETTER_LIST}exports.isNewLetterListEnabled=b});define("models/dataset-model/dataset-model",["exports","Model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var e=b.default.extend({className:"models.DatasetModel",getPaymentMeta:function a(){return undefined}});e.createModel=function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:e;var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"datasetModel";var f=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"datasetModel";var g=b.all.get(c);if(!g){g=new b;g.set(d({id:c,datasetModel:true},f,true));b.all.set([g])}return g};e.isDatasetModel=function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"datasetModel";return b.is(c)};exports.default=e});define("models/bait-letter/bait-letter",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="baitLetter";var e=b.default.extend({className:"models.BaitLetter"});e.createBaitLetter=function a(c){return b.default.createModel(e,"bait::"+c,d)};e.isBait=function a(c){return b.default.isDatasetModel(c,d)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/discounts-block-letter/discounts-block-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b="discountsBlockLetter";var c=a.default.extend({className:"models.DiscountsBlockLetter"});c.createDiscountsBlock=function d(){var e="discountsBlockLetter";return a.default.createModel(c,e,b)};c.isDiscountsBlock=function c(d){return a.default.isDatasetModel(d,b)};exports.default=c});define("models/height-compensation-model/height-compensation-model",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="heightCompensation";var e=b.default.extend({className:"models.HeightCompensation"});e.createHeightCompensation=function a(c){var f=b.default.createModel(e,e.constructId(),d);f.set({height:c},{silent:true});return f};e.isHeightCompensation=function a(c){return b.default.isDatasetModel(c,d)};e.constructId=function a(){return"heightCompensation"};e.getCurrentHeightCompensation=function a(){return b.default.createModel(e,e.constructId(),d)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/promo-block-letter/promo-block-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.promoBlockLabel=void 0;a=__importDefault(a);exports.promoBlockLabel="promoBlockLetter";var b=a.default.extend({className:"models.PromoBlockLetter"});b.createPromoBlock=function c(){var d="promoBlockLetter";return a.default.createModel(b,d,exports.promoBlockLabel)};b.isPromoBlock=function b(c){return a.default.isDatasetModel(c,exports.promoBlockLabel)};exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/search-action-letter/search-action-letter",["require","exports","Model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchActionLetterLabel=void 0;a=__importDefault(a);var b=a.default.extend({className:"models.SearchActionLetter"});exports.searchActionLetterLabel="searchActionLetter";b.createSearchActionLetter=function a(c){var d;var e=c.withSuggestHeader,f=c.type;var g="searchActionLetter::"+f;var h=b.all.getSafe(g);h.set((d={id:g,withSuggestHeader:e,type:f},d[exports.searchActionLetterLabel]=true,d));if(!h){b.all.set([h])}return h};b.isSearchAction=function a(b){return b.is(exports.searchActionLetterLabel)};exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/spec-project-letter/spec-project-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.specProjectLetterLabel=void 0;a=__importDefault(a);exports.specProjectLetterLabel="specProjectLetter";var b=a.default.extend({className:"models.SpecProjectLetter"});b.createSpecProjectLetter=function c(d){var e="specProjectLetter::"+d;return a.default.createModel(b,e,exports.specProjectLetterLabel)};b.isSpecProjectLetter=function b(c){return a.default.isDatasetModel(c,exports.specProjectLetterLabel)};exports.default=b});define("models/spinner-letter/spinner-letter",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="spinnerLetter";var e=b.default.extend({className:"models.SpinnerLetter"});e.createSpinnerLetter=function a(){return b.default.createModel(e,"spinner",d)};e.isSpinner=function a(c){return b.default.isDatasetModel(c,d)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/tip-letter/tip-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.tipLetterLabel=void 0;a=__importDefault(a);exports.tipLetterLabel="tipLetter";var b=a.default.extend({className:"models.TipLetter"});b.createTipLetter=function c(d){var e=a.default.createModel(b,"tip:"+d,exports.tipLetterLabel);e.set("folder",d);return e};b.isTip=function b(c){return a.default.isDatasetModel(c,exports.tipLetterLabel)};exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/welcome-block-letter/welcome-block-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b="welcomeBlockLetter";var c=a.default.extend({className:"models.WelcomeBlockLetter",constructor:function(){a.default.prototype.constructor.apply(this,arguments);this.set({withGreeting:true,height:0})}});c.createWelcomeBlock=function d(){var e="welcomeBlockLetter";return a.default.createModel(c,e,b)};c.isWelcomeBlock=function c(d){return a.default.isDatasetModel(d,b)};exports.default=c});define("service/contextmenu",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a;exports.default={setup:function(b){var c=new b({router:app});c.renderTo(document.body);a=c},teardown:function(){a.destroy();a=null},show:function(a,b){var c=this.getInstance();c.onContextmenu(a,b)},getInstance:function(){return a}}});define("service/radars/decorator",["require","exports","./index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a.radarService.RadarDecorator});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("service/search-attaches/attachesList",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAttaches=exports.excludeAttaches=exports.normalizeAttaches=exports.validateAttachFromSearch=void 0;function a(a,b){if(!a){return false}var c=a.formName,d=a.partId,e=a.snippet;var f=(c===null||c===void 0?void 0:c.value)&&d;if(b){return!!(f&&(e===null||e===void 0?void 0:e.value))}return!!f}exports.validateAttachFromSearch=a;function b(a){if(!a){return null}return a.map(function(a){var b=__assign({},a.toJSON());b.partId=b.part_id;return b})}exports.normalizeAttaches=b;function c(a,b){return b.filter(function(b){return!a.some(function(a){return a.partId===b.partId})})}exports.excludeAttaches=c;function d(b,d,e){if(!b){return}var f=b.attachesCount,g=b.vertical;var h=null;if(e&&e.length){h=e}else{h=d}if(!h){return}var i=0;var j=h.filter(function(b){if(a(b,g)&&i<f){i++;return true}return false});var k=c(j,d);return{attachesList:j.length?j:null,moreAttachesList:k.length?k:null}}exports.getAttaches=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/search-attaches/getAttaches",["require","exports","@mail/xray","default-values","mail/Message","./attachesList"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchMessagesAttaches=exports.shouldShowLetterPreview=exports.getAllAttaches=exports.getSearchAttaches=void 0;a=__importDefault(a);c=__importDefault(c);var e=function(a){return a===null||a===void 0?void 0:a.map(function(a){var b=a;var c=a.name;if(typeof c==="string"){return b}b.formName=c;b.name=c===null||c===void 0?void 0:c.value;return b})};function f(a,b){if(a===void 0){a=this.get("model")}if(b===void 0){b=this.get("search")}if(b){var c=a.meta("search_attaches");if(c){return e(c)}}}exports.getSearchAttaches=f;function g(a,b){if(a===void 0){a=this.get("model")}if(b===void 0){b=this.get("search")}if(b){var c=a.get("all_attaches")||[];var f=e(c);return f.filter(function(a){return d.validateAttachFromSearch(a,false)})}if(h(a)){return a.get("attaches.list")}}exports.getAllAttaches=g;function h(a){if(a===void 0){a=this.get("model")}if(!(b.LETTER_PREVIEWS&&b.LETTER_PREVIEWS_CONFIG["show-previews"]&&a.get("attachments_count"))){return false}var c=Number(a.get("folder"));var d=b.LETTER_PREVIEWS_CONFIG["folders-list"]||[];return d.includes(c)}exports.shouldShowLetterPreview=h;function i(c){if(!b.LETTER_PREVIEW_RADAR){return}c.forEach(function(b){var c=b.thumbnails.image;var d=Object.values(c)[0];if(d.length>0){var e=new URL(d).hostname;e=e.replace(/\./g,"-");a.default.send("lp-host-"+e)}})}function j(e){if(e===void 0){e=this.get("model")}if(b.LETTER_PREVIEW_RADAR){a.default.send("lp-msg-attch-req")}if(!b.LETTER_PREVIEWS_CONFIG["go-on-server"]){return Promise.resolve(null)}var f=e.get("attaches.list");if(f.length>0){return Promise.resolve(d.normalizeAttaches(f))}else{var g=e.get("expand");return c.default.findAttaches(g).then(function(b){i(b.body);var c=e.setFormAttaches(g,b);a.default.send("previews_req_success");return d.normalizeAttaches(c)}).catch(function(b){a.default.send("previews_req_error",{rlog:"previews_req_error",rlog_message:JSON.stringify(b)})})}}exports.fetchMessagesAttaches=j});define("service/search-attaches/viewModes",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSearchAttachesHeight=exports.getAttachesModes=void 0;var b=a.ALL_ATTACHES_MAX_COUNT;var c;(function(a){a[a["incompact"]=2]="incompact";a[a["compact"]=1]="compact"})(c||(c={}));function d(a){var b=0;var c=0;var d=0;a.forEach(function(a){var e;var f=a.snippet,g=a.formName;if(f.color.length){c++;return}if(((e=g===null||g===void 0?void 0:g.color)===null||e===void 0?void 0:e.length)&&f.value){b++;return}d++});return{nameMatches:b,snippetMatches:c,hasNoSnippet:d}}function e(a,d,e,f,g){if(a===void 0){a=false}if(d===void 0){d=0}if(e===void 0){e=0}if(f===void 0){f=0}if(g===void 0){g=0}if(e){var h=e+f;return h<b?h:b}var i=a?c.compact:c.incompact;if(f||g){var j=f+g;return j<i?j:i}return d<i?d:i}function f(a,b,c){if(!b||!b.length){return}if(!c||!c.length){var f=e(a,b.length);return{vertical:false,attachesCount:f}}var g=d(c),h=g.nameMatches,i=g.snippetMatches,j=g.hasNoSnippet;var k=e(a,b.length,i,h,j);return{vertical:Boolean(i),attachesCount:k}}exports.getAttachesModes=f;function g(a){var b=a.vertical,c=a.attachesCount;if(!b){return 36}return c*48+(c-1)*8}exports.getSearchAttachesHeight=g});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/secure-folder",["require","exports","service/getModule","service/layer"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c={};function d(d){if(!d){return Promise.reject()}var e=d.get("id");return a.default("mediator/layout-manager").then(function(a){var c;var e=(c=a===null||a===void 0?void 0:a.default)===null||c===void 0?void 0:c.isLessThen("xs");return b.default.open("secure-folder",{model:d},{dimmer:true,compact:true,"close-on-esc":true,mobile:e})}).then(function(a){return new Promise(function(b){a.on("cancel",function(){delete c[e];b(false)});a.on("success",function(){delete c[e];b(true)})})})}exports.default=d});define("feast-tpl!app/feast-tpl!ui-block/button2/button2.html",["feast"],function(a){return a.smartParse('<span\n\tqa:id="button:{attrs.ico || attrs.title || attrs.text}"\n\tqa:state="{attrs.pressed ? \'pressed\' : (attrs.disabled ? \'disabled\' : \'normal\')}"\n\tpromo:id="{attrs.promoId}"\n\tdata-highlighted-class="button2_highlighted"\n>\n\t<fn:var name="title" value="{_this.getAvailableTitle()}"/>\n\t<fn:attr name="title" value="{title}" test="!!title"/>\n\n\t<fn:attr name="data-title-shortcut" value="{attrs[\'title-shortcut\']}" test="!attrs.disabled && attrs[\'title-shortcut\']"/>\n\n\t<fn:var name="size" value="{attrs.size || \'m\'}"/>\n\n\t<bem:mod name="has-ico" test="attrs.ico" />\n\t<bem:mod name="has-ico-hover" test="attrs[\'ico-hover\']" />\n\t<bem:mod name="has-ico-{attrs.icoSize}" test="attrs.ico" />\n\t<bem:mod name="{String(attrs.ico).replace(/:/, \'_\')}" test="attrs.ico" />\n\t<bem:mod name="rotate-ico" test="attrs[\'rotate-ico\']" />\n\n\t\x3c!-- Тип кнопки --\x3e\n\t<bem:mod name="base" test="!attrs.badge && !attrs.pure && !attrs.clean" />\n\t<bem:mod name="badge" test="attrs.badge" />\n\t<bem:mod name="pure" test="attrs.pure" />\n\t<bem:mod name="clean" test="attrs.clean" />\n\t<bem:mod name="invert" test="attrs.invert" />\n\n\t\x3c!-- Подвид типа кнопки --\x3e\n\t<bem:mod name="primary" test="attrs.primary" />\n\t<bem:mod name="primary-clean" test="attrs[\'primary-clean\']" />\n\t<bem:mod name="secondary" test="attrs.secondary" />\n\t<bem:mod name="in-dropmenu" test="attrs.dropmenu" />\n\t<bem:mod name="only-explanation" test="!attrs.text && attrs.explanation" />\n\n\t<bem:mod name="white" test="attrs.white" />\n\t<bem:mod name="always-bright" test="attrs[\'always-bright\']" />\n\n\t\x3c!-- Размер --\x3e\n\t<bem:mod name="short" test="attrs.short || (!attrs.text && !attrs.explanation)" />\n\t<bem:mod name="touch" test="attrs.touch" />\n\t<bem:mod name="compact" test="attrs.compact" />\n\t<bem:mod name="small" test="attrs.small" />\n\t<bem:mod name="medium" test="attrs.medium" />\n\t<bem:mod name="shadowless" test="attrs.shadowless" />\n\n\t\x3c!-- Выравнивание --\x3e\n\t<bem:mod name="ico-text-top" test="attrs[\'ico-text-top\']" />\n\t<bem:mod name="ico-arrow-down" test="attrs[\'ico-arrow-down\']" />\n\n\t<bem:mod name="nowrap" test="attrs[\'nowrap\']" />\n\n\t\x3c!-- Форма --\x3e\n\t<bem:mod name="round" test="attrs.round" />\n\t<bem:mod name="square" test="attrs.square" />\n\t<bem:mod name="fluid" test="attrs.fluid" />\n\t<bem:mod name="rounded" test="attrs.rounded" />\n\n\t\x3c!-- Шрифт --\x3e\n\t<bem:mod name="font-size-pony" test="attrs[\'font-size-pony\']" />\n\t<bem:mod name="text-overflow" test="attrs[\'text-overflow\']" />\n\n\t\x3c!-- Состояния --\x3e\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']" />\n\t<bem:mod name="pressed" test="attrs.pressed" />\n\t<bem:mod name="disabled" test="attrs.disabled" />\n\t<bem:mod name="highlighted" fn:if="attrs.highlighted" />\n\n\t<bem:mod name="safari" test="attrs.safari" />\n\n\t<fn:add-class name="js-shortcut" test="!attrs.disabled && attrs.shortcut" />\n\n\t<span bem:elem="highlighter" />\n\n\t<span\n\t\t\tbem:elem="wrapper"\n\t\t\tqa:id="button:wrapper"\n\t\t\tremit:click="click-radar"\n\t\t\tremit:keydown.enter.prevent.stop="keydown:enter"\n\t\t\tref="wrapper"\n\t>\n\t\t<bem:mod name="centered" test="attrs.centered || attrs.short" />\n\n\t\t<fn:attr\n\t\t\t\tname="tabindex"\n\t\t\t\tvalue="{attrs.disabled ? -1 : attrs[\'tab-index\']}"\n\t\t\t\ttest="attrs[\'tab-index\'] !== void 0"\n\t\t/>\n\n\t\t<span bem:elem="ico" fn:if="attrs.ico" qa:id="button-icon">\n\n\t\t\t\x3c!-- "Красный прыщик" на иконке кнопки --\x3e\n\t\t\t<b:notification-badge\n\t\t\t\tfn:if="attrs[\'notification-badge\'] && attrs.ico"\n\t\t\t\tshow="{true}"\n\t\t\t\tponymode="{attrs.compact}"\n\t\t\t\ttop="-1"\n\t\t\t\tponyTop="0"\n\t\t\t\tright="-2"\n\t\t\t\tradar-id="{attrs[\'notification-badge\']}"\n\t\t\t>\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<b:ico name="{attrs.ico}" fn:if="attrs.ico"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:notification-badge>\n\t\t\t<b:ico name="{attrs.ico}" size="{attrs.icoSize}" fn:if="attrs.ico && !attrs[\'notification-badge\']"/>\n\n\t\t\t<b:ico name="{attrs[\'ico-hover\']}" size="{size}" fn:if="attrs[\'ico-hover\']"/>\n\t\t</span>\n\n\t\t\x3c!-- Контент кнопки: текст или match --\x3e\n\t\t<fn:choose>\n\t\t\t<fn:when test="__vmatches[\'default\']">\n\t\t\t\t<fn:apply-match name="default"/>\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="txt"\n\t\t\t\t\tfn:if="!attrs.short && attrs.text"\n\t\t\t\t\tqa:id="button-text"\n\t\t\t\t>\n\t\t\t\t\t{attrs.text}\n\t\t\t\t</div>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\n\t\t\x3c!-- Элемент "Пояснение" --\x3e\n\t\t<span\n\t\t\tbem:elem="explanation"\n\t\t\tfn:if="!attrs.short && attrs.explanation"\n\t\t\tqa:id="button-explanation"\n\t\t>\n\t\t\t<bem:mod name="ellipsis"/>\n\t\t\t{attrs.explanation}\n\t\t</span>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/button2/button2.html")});define("feast-tpl!ui-block/button2/button2.html",["feast-tpl!app/feast-tpl!ui-block/button2/button2.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/ico/ico.html",["feast"],function(a){return a.smartParse('<svg\n\tqa:id="ico:{_this.getSvgName()}">\n\t<bem:mod name="{_this.getSvgName()}"/>\n\t<bem:mod name="{attrs.mod}"/>\n\t<bem:mod name="secondary" test="attrs.secondary"/>\n\t<bem:mod name="size" value="{attrs.size}" test="attrs.size"/>\n\n\t\x3c!--<use xlink:href="#{_this.getSvgURI()}"></use>--\x3e\n\n\t<fn:var name="vdom" value="{_this.getSvgVDom()}"/>\n\n\t<fn:vdom data="vdom && vdom.children"/>\n\n\t<fn:for data="_this.getVDomAttrPairs(vdom)" as="pair" key="key">\n\t\t<fn:attr name="{pair.key}" value="{pair.value}"/>\n\t</fn:for>\n</svg>\n',"app/feast-tpl!ui-block/ico/ico.html")});define("feast-tpl!ui-block/ico/ico.html",["feast-tpl!app/feast-tpl!ui-block/ico/ico.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("icons",["require","exports","default-values","./icons-pack/icons-mail","./icons-pack/icons-vk"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importStar(b);c=__importStar(c);if(a.VK){Object.assign(exports,b,c)}else{Object.assign(exports,b)}});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/ico/ico",["require","exports","feast","feast-tpl!./ico.html","icons"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.js2vdom=void 0;a=__importDefault(a);b=__importDefault(b);c=__importStar(c);var d={"16-archive":"navigation:archive","16-arrow-back":"navigation:drop_previous_big","16-arrow-down-small":"navigation:drop_down_small","16-arrow-down":"navigation:drop_down_big","16-arrow-up-small":"navigation:drop_up_small","16-arrow-up":"navigation:drop_up_big","16-attach":"status:attach","16-auth":"categories:access","16-burger":"navigation:menu","16-calendar-month":"navigation:calendar_month","16-check-read":"wysiwyg:mail_read","16-checked":"status:done","16-clock":"status:time","16-close":"actions:close_big","16-cloud":"categories:cloud","16-compose":"actions:compose","16-currency-ruble":"categories:currency_rouble","16-delete":"actions:delete","16-download":"actions:download","16-draft":"categories:drafts","16-fees":"categories:fees","16-flag":"actions:favorite_on","16-filter":"actions:filter","16-folder":"navigation:folder","16-folder-move":"action:folder_move","16-forward-small":"actions:forward_small","16-forward":"actions:forward","16-government":"categories:government","16-receipts":"categories:receipts","16-important-round":"status:warning_round","16-important-triangle":"status:warning_triangle","16-important":"status:error","16-inbox":"categories:mail","16-link":"status:link","16-lock-off":"status:lock_off_small","16-lock-on":"status:lock_on_small","16-minimize":"actions:window_minimize","16-more-hor":"navigation:more","16-more-vert":"navigation:more_vertical","16-orders":"navigation:cart","16-pin":"actions:pin","16-point":"status:unread","16-reminder":"navigation:notification","16-reply-all":"actions:reply_all","16-reply-forward-small":"actions:forward_reply_small","16-reply-small":"actions:reply_small","16-reply":"actions:reply","16-search":"navigation:search","16-select-all":"actions:select_all","16-setting":"navigation:settings","16-spam-off":"actions:like","16-spam-on":"actions:dislike","16-tickets":"categories:ticket","16-travel":"categories:flight","16-school":"categories:school","16-games":"categories:games","20-checked":"status:done_big"};var e={xs:3*4,s:5*4,m:5*4,l:5*4,xl:6*4,xxl:8*4};function f(a,b,c){var d={};var e=[];var g;var h;var i;var j;var k=Object.keys(b);for(i=0;i<k.length;i++){g=k[i];h=b[g];var l=g==="fill"&&c;if(h&&typeof h==="object"){if(Array.isArray(h)){for(j=0;j<h.length;j++){e.push(f(g,h[j],c))}}else{e.push(f(g,h,c))}}else if(!l){d[g]=h}}return{tag:a,attrs:d,children:e}}exports.js2vdom=f;function g(a){return a.toUpperCase().replace(/:/g,"_")}exports.default=a.default.Block.extend({name:"ico",template:b.default,blocks:{},immutable:true,defaults:{size:"s",secondary:false,"remove-fill":true},getSvgName:function(){var a={xs:12,s:16,m:16,l:20,xl:20,xxl:20};var b=this.get("name");var c=this.get("size");var d=a[c||"s"];return d!=null?d+"-"+b:b},getByOldName:function(){return this.getByName(d[this.getSvgName()])},getByName:function(a){if(a===void 0){a=null}a=g(a||this.get("name"));var b=c[a];var d=this.get("size");if(e[d]){b.svg.width=e[d];b.svg.height=e[d]}return b},getSvgVDom:function(){var a=this.getByOldName()||this.getByName();var b=this.get("name");var c=this.get("remove-fill");var d;if(!a&&b){console.error("Icon not found: "+b);return undefined}d=f("svg",a||{},c);if(d.children&&d.children[0]&&d.children[0].tag==="svg"){d=d.children[0]}return d},getVDomAttrPairs:function(a){return a&&a.attrs&&Object.keys(a.attrs).map(function(b){return{key:b,value:a.attrs[b]}})||[]}})});define("feast-tpl!app/feast-tpl!ui-block/notification-badge/notification-badge.html",["feast"],function(a){return a.smartParse('<div>\n\t<div bem:elem="badge" fn:if="attrs.show" qa:id="{attrs[\'test-id\']}" style="{attrs.placementStyles}">\n\t\t<bem:mod name="color_{attrs[\'colorMode\']}" test="attrs[\'colorMode\']"/>\n\t\t<bem:mod name="size_{attrs.size}" test="attrs.size"/>\n\t</div>\n\t<fn:apply-match name="content"/>\n</div>\n',"app/feast-tpl!ui-block/notification-badge/notification-badge.html")});define("feast-tpl!ui-block/notification-badge/notification-badge.html",["feast-tpl!app/feast-tpl!ui-block/notification-badge/notification-badge.html"],function(a){return a});define("ui-block/notification-badge/notification-badge",["exports","feast","feast-tpl!./notification-badge.html","service/radars/index"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=undefined;var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}var h=exports.blockSpec={name:"notification-badge",template:e.default,isolateEvents:false,defaults:{"test-id":"notification-badge"},attrChanged:{ponymode:function a(){this.setInlineStyles()},show:function a(b){if(b){this.setInlineStyles()}}},didMount:function a(){if(this.get("show")){this.setInlineStyles();var b=this.get("radar-id");if(b&&typeof b==="string"){(0,f.default)({type:b})}}},getCssRule:function a(b){var c=this.get(b);var d=this.get("pony-"+b);if(this.get("ponymode")&&typeof d!=="undefined"){return b+": "+d+"px;"}if(typeof c!=="undefined"){return b+": "+c+"px;"}return""},setInlineStyles:function a(){var b=this;this.set({placementStyles:["top","bottom","left","right"].reduce(function(a,c){return a+b.getCssRule(c)},"")})}};exports.default=d.default.Block.extend(h)});define("ui-block/button2/button2",["exports","feast","feast-tpl!./button2.html","helpers/browser","service/radars/decorator","ui-block/ico/ico","ui-block/notification-badge/notification-badge"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend((0,j.default)({events:[{name:"click-radar",rename:"click"}]})({name:"button2",template:h.default,defaults:{safari:i.default.safari,"hover-support":i.default.capabilities["hover-support"],icoSize:"s",centered:false,highlighted:false},blocks:{ico:k.default,"notification-badge":l.default},events:{"keydown:enter":"onKeydownEnter"},onKeydownEnter:function a(){var b=$(this.el);b.click()},focus:function a(){this.refs.wrapper.focus()},getAvailableTitle:function a(){if(this.is("shortcut")||this.is("short")||!this.is("text")){return this.get("title")||this.get("text")}else{return this.get("annotation")}}}))});define("feast-tpl!app/feast-tpl!ui-block/dataset/dataset.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="letterNotFound" value="{attrs[\'letter-not-found\']}"/>\n\t<bem:mod name="select-mode" value="{attrs[\'select-mode\'] ? \'on\' : \'off\'}"/>\n\n\t<fn:if test="!letterNotFound">\n\t\t<fn:var name="range" value="{_this.recalculateVisibleRange()}"/>\n\n\t\t<div bem:elem="items" qa:id="dataset-items" ref="items"></div>\n\n\t\t<fn:if test="__vmatches[\'navigator\']">\n\t\t\t<fn:apply-match name="navigator" args="range"/>\n\t\t</fn:if>\n\t</fn:if>\n\n\t<fn:if test="letterNotFound || !attrs.models.length">\n\t\t<fn:apply-match name="dataset-empty" />\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/dataset/dataset.html")});define("feast-tpl!ui-block/dataset/dataset.html",["feast-tpl!app/feast-tpl!ui-block/dataset/dataset.html"],function(a){return a});define("helpers/shallow-compare",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shallowCompare=a;function a(a,b){var c=Object.keys(a);var d=Object.keys(b);if(c.length!==d.length){return false}var e=void 0;for(var f=0;f<c.length;f++){e=c[f];if(a[e]!==b[e]){return false}}return true}});define("feast-tpl!app/feast-tpl!ui-block/scrollable/scrollable.html",["feast"],function(a){return a.smartParse('<div qa:id="scrollable">\n\t\x3c!-- Костыль, конечно.. Но верстка сайдбара не оставляет большого выбора. Используется в sidebar-folders --\x3e\n\t<bem:mod name="id" test="attrs.id" value="{attrs.id}"/>\n\n\t<bem:mod name="opaque" test="attrs.opaque"/>\n\t<bem:mod name="substrated" test="attrs.substrated"/>\n\t<bem:mod name="footer" test="attrs.footer"/>\n\t<bem:mod name="bright" test="attrs.bright"/>\n\t<bem:mod name="content" test="attrs.content"/>\n\t<bem:mod name="sidebar" test="attrs.sidebar"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\t<bem:mod name="full-height" test="attrs[\'full-height\']" />\n\t<bem:mod name="styled" />\n\t<bem:mod name="background-transparent" test="attrs[\'background-transparent\']" />\n\t<bem:mod name="background-new-tooltip" test="attrs[\'background-transparent\'] && _this.useNewToolbar()" />\n\n\t<bem:mod name="disable-horizontal-scroll" test="attrs[\'disable-horizontal-scroll\']"/>\n\n\t<bem:mod name="scroll-style" value="{attrs[\'scroll-style\']}"/>\n\n\t<div bem:elem="container" ref="container">\n\t\t<bem:mod name="left-gap" test="attrs[\'left-gap\']" />\n\t\t<fn:apply-match name="default"/>\n\n\t\t<div bem:elem="footer" fn:if="attrs.footer"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/scrollable/scrollable.html")});define("feast-tpl!ui-block/scrollable/scrollable.html",["feast-tpl!app/feast-tpl!ui-block/scrollable/scrollable.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/g-silent",["require","exports","cfg","modernizr-custom"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=function(){return undefined};function d(d){var e=d.el,f=d.holder,g=d.timeout,h=g===void 0?50:g;if(!a.default.build&&(!e||!f)){console.warn("gSilent function requires target elements as arguments");return c}if(a.default.build&&(!e||!f)){return c}if(!b.default.pointerevents){return c}var i=false;var j=function(a){if(i!==a){i=a;e.classList.toggle("g-silent",i)}};var k=null;var l=function(){k&&clearTimeout(k);k=setTimeout(function(){return j(false)},h)};var m=function(){j(true);l()};f.addEventListener("scroll",m,b.default.passiveeventlisteners?{passive:true}:false);f.addEventListener("resize",m);return function(){f.removeEventListener("scroll",m);f.removeEventListener("resize",m)}}exports.default=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/scrollable/scrollable",["require","exports","cfg","default-values","feast","feast-tpl!./scrollable.html","helpers/browser","helpers/g-silent","modernizr-custom","service/radars/index","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var j=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.webkitRequestAnimationFrame;var k=200;var l=!!(window.performance&&typeof performance.now==="function"&&typeof j==="function");var m={name:"scrollable",template:d.default,isolate:false,gSilentUnsubscribe:null,scrollUnsubscribe:null,wasPopstate:false,blocks:{},defaults:{name:"default",substrated:false,"measure-fps":false,silent:false,"scroll-style":"traditional","full-height":false},_scrollingPid:void 0,_scrollingFrames:0,_scrollingStartTs:0,didMount:function(){var a=this;this._lastScrollTop=0;this._scrollDirection=null;this.emitOnTop=parseInt(this.attrs["emit-ontop"],10)||null;this.emitOnBottom=parseInt(this.attrs["emit-onbottom"],10)||null;this.handleScrollChange=i.default.debounce(this.handleScrollChange,250,this);if(this.emitOnTop||this.emitOnBottom){var b=this.handleScroll.bind(this);this.el.addEventListener("scroll",b,g.default.passiveeventlisteners?{passive:true}:false);this.scrollUnsubscribe=function(){return a.el.removeEventListener("scroll",b)}}if(!e.default.isIE){this.gSilentUnsubscribe=f.default({el:this.refs.container||this.el.firstChild,holder:this.el})}this.handleScrollEnd=this.handleScrollEnd.bind(this);this.handleAnimationFrame=this.handleAnimationFrame.bind(this);this.broadcast("scrollable:mount",{scrollableElement:this.el,name:this.attrs.name})},didUnmount:function(){this.gSilentUnsubscribe&&this.gSilentUnsubscribe();this.scrollUnsubscribe&&this.scrollUnsubscribe();this.broadcast("scrollable:unmount",{scrollableElement:this.el,name:this.attrs.name})},getScrollDir:function(){return this._scrollDirection},getScrollPos:function(){var a={x:0,y:0};if(this.el&&typeof this.el.scrollLeft!="undefined"){a={x:this.el.scrollLeft,y:this.el.scrollTop}}return a},scrollTo:function(a,b){if(this.isMounted()){a=!a&&a!==0?false:parseInt(a,10);b=!b&&b!==0?false:parseInt(b,10);b!==false&&(this.el.scrollTop=b);a!==false&&(this.el.scrollLeft=a)}},reset:function(){this.scrollTo(0,0)},handleScroll:function(a){var b=a.target;var c=b.scrollTop;var d=b.scrollHeight;var e=b.offsetHeight;var f=c+e;var g=c-this._lastScrollTop>0;this._lastScrollTop=c;this._scrollDirection=g?"down":"up";if(!this.is("silent")){if(this.emitOnBottom&&g&&f+this.emitOnBottom>=d){this.broadcast("scroll:onbottom")}if(this.emitOnTop&&!g&&c<this.emitOnTop){this.broadcast("scroll:ontop")}this.broadcast("scroll:change",c)}this.handleScrollChange();if(!l||!this.is("measure-fps")){return}if(!this._scrollingPid){this._scrollingFrames=0;this._scrollingStartTs=performance.now();j(this.handleAnimationFrame)}window.clearTimeout(this._scrollingPid);this._scrollingPid=window.setTimeout(this.handleScrollEnd,k)},handleScrollChange:function(){var b=!!a.default.qa;if(b&&this.isMounted()&&this.el){this.el.setAttribute("data-qa-value",this._lastScrollTop)}},handleScrollEnd:function(){delete this._scrollingPid;if(this.destroyed||this.zombie){return}var a=(performance.now()-this._scrollingStartTs)/1e3;var c=Math.round(this._scrollingFrames/a);h.default({type:"fps_scroll_"+this.get("name"),value:c,intervals:[["old",c]]});if(b.IS_DEBUG){console.log("FPS",this.get("name"),c)}if(this.el.scrollTop===0&&this.wasPopstate){this.broadcast("scrollable:advontop");this.wasPopstate=false}this.broadcast("scroll:end")},handleAnimationFrame:function(){if(this._scrollingPid){this._scrollingFrames++;j(this.handleAnimationFrame)}},useNewToolbar:function(){return b.NEW_TOOLBAR}};var n=c.default.Block.extend(m);n.getScrollableBlock=function(a){var b=n.getInstances();return b.find(function(b){return b.contains(a)})};n.getScrollableElem=function(a){var b=n.getInstances().map(function(a){return a.el});return b.find(function(b){return b.contains(a)})};exports.default=n});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dataset/dataset",["require","exports","@mail/xray","default-values","feast","feast-tpl!./dataset.html","helpers/shallow-compare","mail/Folder","service/adv/config","service/smokescreen","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendAttachesRadar=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);i=__importDefault(i);var j=10;var k=16;var l=typeof window.requestAnimationFrame==="function";var m="scrollBehavior"in document.documentElement.style;function n(a){if(l){window.requestAnimationFrame(a);return}window.setTimeout(a,k)}function o(c){if(b.LETTER_PREVIEW_RADAR){var d=0;var e=c.find(function(a){return a.get("folder")});if(e){var g=Number(e.get("folder"));c.forEach(function(a){var b=a.get("attachments_count");var c=a.meta("previews");if(b&&!c){d+=b;a.meta("previews",true)}});if(g!==f.default.TOMYSELF&&g!==f.default.INBOX){g="oth"}if(d>0){a.default.send("lp-count-"+g,{v:d})}}}}exports.sendAttachesRadar=o;exports.default=c.default.Block.extend(h.withWelter({name:"dataset",template:d.default,performanceTrace:"track",isolateEvents:false,blocks:{},defaults:{models:[],"item-height":0,persist:false,"select-mode":false},attrChanged:{models:function(){delete this.scrollTop;this.handleScroll()},"x-ponymode":function(a){g.setRBParam("ponymode",a?1:0)}},handleSelected:function(a){var b=a.details;b.invert("selected")},handlePrepareDragElement:function(a,b,c){console.warn(this.block+"#handlePrepareDragElement — not implemented",c)},constructor:function(){c.default.Block.apply(this,arguments);this.handleScroll=this.handleScroll.bind(this);this.handleAnimationFrame=this.handleAnimationFrame.bind(this);this._visibleBlockMeasures={};this._itemsCached={};this.height=0;this._blockMeasures={};this._animation=undefined},didMount:function(){var a=this.el;var b=i.default.getScrollableBlock(this);if(b.el){a=b.el}this._scrollable=a||document.body;this.$on(this._scrollable,"scroll","handleScroll");this.handleScroll(true);if(window.addEventListener){window.addEventListener("resize",this.handleScroll)}},didUpdate:function(a){var b=this.is("select-mode");if(!b){for(var c in this.attrs){if(c==="key"||c==="models"){continue}if(a[c]!=this.attrs[c]){b=true;break}}}this.updateItems(b)},didUnmount:function(){window.removeEventListener("resize",this.handleScroll);for(var a in this._itemsCached){this.removeItemInstance(this._itemsCached[a])}this._itemsCached=undefined},handleScroll:function(a,b){if(a===void 0){a=null}if(b===void 0){b=false}if(!this._scrollable){return}var c=!a;var d=this._scrollable.scrollTop;var e=this.scrollTop;if(d<0){d=0}if(!b&&d===e){return}var f=this,g=f.visibleElementTop,h=f.visibleElementBottom;var i=this._scrollable.clientHeight;if(this._animation){return}if(g!==null&&h!==null&&g<d&&h>d+i){c=true}this.scrollTop=d;this.viewHeight=i;if(!c){this.updateItems()}this.callScrollEventHandler({scrollTop:d,dataset:this})},updateScroll:function(){this.handleScroll(null,true)},getHeightForItem:function(a){var b=this.get("item-height");if(typeof b==="function"){return b(a)}return b},getItemPersist:function(a){var b=this.get("persist");if(typeof b==="function"){return b(a)}return b===true},recalculateVisibleRange:function(){var a;var b=this.get("models");var c=parseInt(this.get("bottom-spacer"),10)||300;var d=parseInt(this.get("top-spacer"),10)||300;this._blockMeasures={};var e=this,f=e.visibleElementTop,g=e.visibleElementBottom;var h=this,i=h.viewHeight,j=h.scrollTop;var k=Math.max(j-d,0);var l=j+i+c;var m={models:[],offset:0,placeholder:{top:0,height:0}};f=null;g=null;var n;var o;var p=0;var q;for(var r=0;r<b.length;r++){q=b[r];n=this.getHeightForItem(q);o=this.getItemPersist(q);p+=n;m.placeholder.height+=n;this._blockMeasures[q.id]={offset:p,height:n};if(!o&&p<k){m.placeholder.top+=n}else if(o||p-n<=l){m.models.push({model:q,index:r});if(!o){if(f===null){f=p-n;m.offset=r}else{g=p}}}}this.visibleElementTop=f;this.visibleElementBottom=g;this.height=p;this._lastCalculatedRange=m;(a=this.get("handle-new-range"))===null||a===void 0?void 0:a(m);return m},updateItems:function(a){if(a===void 0){a=false}var b=this.recalculateVisibleRange();var d=this.refs.items;if(!d){return}d.style.height=b.placeholder.height+"px";d.style.paddingTop=b.placeholder.top+"px";var e={mounts:[],updates:[],partialUpdates:{}};var f;o(b.models.map(function(a){var b=a.model;return b}));for(var g=0;g<b.models.length;g++){f=this.createItemElement(a,e,b.models[g].model,b.models[g].index,b.models.length);if(f&&f!==d.children[g]){d.insertBefore(f,d.children[g])}}var h=d.children.length;var i=b.models.length;for(var g=i;g<h;g++){d.removeChild(d.children[i])}var j={};var k=Math.max(e.mounts.length,e.updates.length);var l;for(var g=0;g<k;g++){if(g<e.mounts.length){l=e.mounts[g];l.$handleEvent({type:"$mount"})}if(g<e.updates.length){c.default.Block.__callDidUpdate(e,g,j)}}this.collectGarbageFromCache(a);var m=this.get("items-update");if(m){m(!this._itemsUpdated);this._itemsUpdated=true}},collectGarbageFromCache:function(a){if(a===void 0){a=false}var b;for(var c in this._itemsCached){b=this._itemsCached[c];if(a&&b.hits===0){this.removeItemInstance(b);delete this._itemsCached[c]}if(b.hits>0){b.hits--}}},removeItemInstance:function(a,b){if(b===void 0){b=false}if(a.onRemove){a.onRemove()}c.default.vdom.destroy(a.virtualNode);if(b&&a.element&&a.element.parentNode){a.element.parentNode.removeChild(a.element)}},createItemElement:function(a,b,d,f,g){var h=this;var i=d.id+"__"+d.cid;var j=this.get("item-context")(d,f,g);var k=this._itemsCached[i];if(k){k.hits++;if(!a){a=!e.shallowCompare(j,k.context)}k.context=j;if(a){this.updateItemFragment(k,b,d,f,g)}return k.element}var l={tag:"MAIN",attrs:{},events:{},children:[],dom:{firstElementChild:null}};var m=this.getTemplateMatch("dataset-item");m(l,this.key+"::createItemElement::"+i,function(a){return a},b,d,f,g,j);if(!l.children.length){return undefined}l=c.default.vdom.create(l);k={key:i,context:j,element:l.dom.firstElementChild,virtualNode:l,hits:1};this._itemsCached[i]=k;if(d.on){var n=function(){if(h.isMounted()){h.removeItemInstance(k,true);delete h._itemsCached[i]}};d.on("destroy",n);k.onRemove=function a(){d.off("destroy",n)};d.on("destroy",n)}return k.element},updateItemFragment:function(a,b,d,e,f){var g={tag:"MAIN",attrs:{},events:{},children:[]};var h=this.getTemplateMatch("dataset-item");h(g,this.key+"::createItemElement::"+a.key,function(a){return a},b,d,e,f,a.context);a.virtualNode=c.default.vdom.update(a.virtualNode,g)},getLastCalculatedRange:function(){return this._lastCalculatedRange||this.recalculateVisibleRange()},callScrollEventHandler:function(a){var b=this.get("handle-scroll");if(typeof b==="function"){b(a)}},getBlockMeasuresByModelId:function(a){return this._blockMeasures[a]},getScrollTop:function(){return this.scrollTop||this._scrollable&&this._scrollable.scrollTop},getViewHeight:function(){return this.viewHeight},isScrolledToBottom:function(){var a=this.get("models");if(!a){return false}if(!a.length){return true}var b=a[a.length-1].id;var c=this.getBlockMeasuresByModelId(b);if(!c){return false}return this.getScrollTop()+this.getViewHeight()>=c.offset},scrollTo:function(a,b){var c=this._scrollable;if(!c){return}var d="smooth";var e="auto";if(b&&b.behavior!==undefined){d=b.behavior}if(b&&b.duration!==undefined){e=b.duration}var f=m&&d==="smooth"&&e==="auto";if(f){c.scrollTo({top:a,behavior:d});return Promise.resolve()}if(d==="instant"){c.scrollTop=a;return Promise.resolve()}if(e==="auto"){e=1e3}var g;var h=new Promise(function(a){g=a});var i=Date.now();var j={start:c.scrollTop,end:a,duration:e,promise:h,resolve:g,startTs:i,lastTs:i};if(!this._animation){n(this.handleAnimationFrame)}this._animation=j;return h},handleAnimationFrame:function(){var a=this,b=a._animation,c=a._scrollable,d=a.height;if(!b){return}var e=Date.now();var f=b.startTs+b.duration;if(Math.abs(e-f)<j||e>f){c.scrollTop=b.end;this._animation=undefined;this.handleScroll({},true);b.resolve();return}var g=e-b.lastTs;var h=b.end-b.start;var i=h*(g/b.duration);var k=c.scrollTop+i;k=Math.max(k,0);k=Math.min(k,d);c.scrollTop=k;b.lastTs=e;n(this.handleAnimationFrame)}}))});define("feast-tpl!app/feast-tpl!ui-block/discounts/discounts.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="3pane" test="attrs[\'3pane\']"/>\n\n\t<b:gallery\n\t\tcontrols="{_this.getGalleryControls()}"\n\t\tremit:scroll-end="gallery:scroll:end"\n\t\tremit:all-blocks-visible="all:blocks:visible"\n\t\tremit:all-blocks-rendered="gallery:blocks:rendered"\n\t>\n\t\t<fn:for data="attrs.discounts" as="discount" key="i">\n\t\t\t<b:discounts-item\n\t\t\t\t\tkey="{i}"\n\t\t\t\t\tdefaultVisible="{i < attrs.visibleItemsCount}"\n\t\t\t\t\ttitle="{discount.shop}"\n\t\t\t\t\tvalue="{discount.sale.discount}"\n\t\t\t\t\ttext="{discount.description}"\n\t\t\t\t\tendDate="{discount.sale.end_date}"\n\t\t\t\t\timage="{_this.getThreadImage(discount.message_id)}"\n\t\t\t\t\tcolors="{_this.getDiscountColors(discount.from)}"\n\t\t\t\t\tpromocodes="{discount.promocodes}"\n\t\t\t\t\tpromoDiscount="{discount.is_promo}"\n\t\t\t\t\tnew="{_this.isNewDiscount(discount.message_id)}"\n\t\t\t\t\thref="{_this.getThreadHref(discount.message_id)}"\n\t\t\t\t\t3pane="{attrs[\'3pane\']}"\n\t\t\t\t\twidth="{attrs[\'width\']}"\n\t\t\t\t\tmodel="{_this.getModel(discount.message_id)}"\n\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<fn:if test="attrs.discounts.length && !attrs.disableDiscountsBlock">\n\t\t\t<b:discounts-item\n\t\t\t\t\tkey="settings"\n\t\t\t\t\ttitle="{i18n(\'Скидки\')}"\n\t\t\t\t\ttext="{i18n(\'Почта находит скидки в рассылках и показывает здесь, чтобы вы их не потеряли.\')}"\n\t\t\t\t\t3pane="{attrs[\'3pane\']}"\n\t\t\t\t\tswitch="{!!attrs.router.model.uiThreadsSettings.discounts}"\n\t\t\t\t\tremit:switch="discounts:switch"\n\t\t\t\t\tdisabled="{attrs[\'_progress\']}"\n\t\t\t\t\twidth="{attrs[\'width\']}"\n\t\t\t\t\tsystem\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs.discounts.length">\n\t\t\t<b:discounts-item\n\t\t\t\t\tkey="settings"\n\t\t\t\t\ttitle="{i18n(\'Нет скидок\')}"\n\t\t\t\t\ttext="{i18n(\'Возможно, вам не приходили письма со скидками, или скидки перестали действовать\')}"\n\t\t\t\t\t3pane="{attrs[\'3pane\']}"\n\t\t\t\t\twidth="{attrs[\'width\']}"\n\t\t\t\t\tsystem\n\t\t\t/>\n\t\t</fn:if>\n\t</b:gallery>\n</div>\n',"app/feast-tpl!ui-block/discounts/discounts.html")});define("feast-tpl!ui-block/discounts/discounts.html",["feast-tpl!app/feast-tpl!ui-block/discounts/discounts.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("feast-mod/letter-date",["require","exports","@mail/xray","cfg","cfgUser","default-values","utils/util","./utils"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.scheduleDate=exports.getLocaleDateFull=exports.letterDate=exports.letterMonthYearDate=exports.letterMonthDate=exports.letterHours=exports.letterAttachLinkDate=exports.getCorrectedTimestampMS=exports.getCorrectedTimestamp=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var g=null;var h=null;var i=null;var j=155e10;var k=24*60*60*1e3;function l(a){a=parseInt(a,10);if(typeof g==="number"){return a+g}if(d.DISABLE_TIME_CORRECTION){return a}var e=c.default.get("initialUser")||{};h=typeof e.timezone_autodetect==="boolean"?e.timezone_autodetect:true;if(h===true){var f=b.default.clientTimestamp-(d.DEBUG_SERVER_TIMESTAMP>0?d.DEBUG_SERVER_TIMESTAMP:b.default.serverTimestamp);if(f>k||d.IGNORE_LOCAL_TIME){f=0}g=Math.round(f/1e4)*10}else{g=e.timezone_offset+(new Date).getTimezoneOffset()*60;i=e.timezone_offset}return a+g}exports.getCorrectedTimestamp=l;var m=function(a){return l(Math.round(a/1e3))*1e3};exports.getCorrectedTimestampMS=m;var n=function(a){return f.formatDate(new Date(l(a)*1e3),[["day","numeric"],["month","long"],["year","numeric"],["hour","numeric"],["minute","2-digit"]],{literalBefore:{hour:", "}})};exports.letterAttachLinkDate=n;var o=function(a){return a?f.formatDate(new Date(a),[["hour","numeric"],["minute","2-digit"]]):""};exports.letterHours=o;var p=function(a){try{if(a instanceof Date){var b=exports.getCorrectedTimestampMS(a.getTime());return new Date(b)}else if(e.isPositiveNumber(a)){a=l(a)*1e3;return new Date(a)}else{return null}}catch(a){return null}};var q=function(a,b,c){var d=p(a);return d instanceof Date?f.formatDate(d,[["day","numeric"],["month","long"],["year",c?"numeric":undefined]]).replace(/([^\d\s]{3})[^\d\s]+/,b?"$&":"$1"):""};var r=function(a,b){return q(a,b,false)};exports.letterMonthDate=r;var s=function(a,b){return q(a,b,true)};exports.letterMonthYearDate=s;var t=function(a){return(new Date).getFullYear()===a.getFullYear()};function u(c,e){var k=false;var m=null;try{var n=window.app.route.model;k=n.folder&&n.folder.isOutbox();m=n.folder&&n.folder.id}catch(a){}var o=c;c=(e?c:l(c))*1e3;var p=h?new Date:new Date(exports.getCorrectedTimestampMS(Date.now()));var q=new Date(c);function r(a){return f.formatDate(a,[["day","numeric"],["month","long"]]).replace(/([^\d\s]{3})[^\d\s]+/,"$1")}var s=r(q);var u=r(p);if(!k){var v=d.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP>j&&c>d.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP;var w=d.LETTER_FROM_FUTURE_LOG_DATES.includes(s);if(v||w){var x={};if(v){x.dff=1}if(w){x.dill=1}var y={i:x};if(d.LETTER_FROM_FUTURE_LOG_KAKTAM){x.kaktam=1;y.rlog="octavius_future_date";y.rlog_message={isDateFromFuture:v,isDateInLogList:w,originalTimeValue:o,time:c,now:p,date:q,dateFormatted:s,nowFormatted:u,clientTimestamp:b.default.clientTimestamp,serverTimestamp:b.default.serverTimestamp,xHost:b.default.xHost,timezoneOffset:g,timezoneAutodetectSetting:h,userTimezoneOffsetFromSettings:i,getTimezoneOffset:(new Date).getTimezoneOffset()*60,folderId:m,href:window.location.href,dateNow:Date.now()}}a.default.send("future-date",y)}}if(!t(q)){return f.formatDate(q,[["day","2-digit"],["month","2-digit"],["year","2-digit"]])}if(s===u){return exports.letterHours(c)}return s}exports.letterDate=u;var v=function(a){return f.isToday(new Date(a.getFullYear(),a.getMonth(),a.getDate()+1))};function w(a){var b=f.isToday(a);if(b||v(a)){return f.capitalize(b?f.NAMED_DAYS.TODAY:f.NAMED_DAYS.YESTERDAY)+", "+f.formatDate(a,[["hour","numeric"],["minute","2-digit"]])}return f.formatDate(a,[["day","numeric"],["month","long"],["year",t(a)?undefined:"numeric"],["hour","numeric"],["minute","2-digit"]],{literalBefore:{hour:", "}})}var x=function(a,b){return w(new Date((b?a:l(a))*1e3))};exports.getLocaleDateFull=x;var y=function(a){return i18n("Письмо будет отправлено {date}",{date:f.capitalize(w(new Date(l(a)*1e3)))})};exports.scheduleDate=y});define("feast-tpl!app/feast-tpl!ui-block/discounts-item/discounts-item.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="width-small" test="attrs[\'width\'] === \'small\'" />\n\t<bem:mod name="3pane" test="attrs[\'3pane\']" />\n\t<div bem:elem="wrap">\n\t\t<bem:mod name="has-hover" test="attrs.href" />\n\t\t<a remit:click="discounts-click" bem:elem="inner">\n\t\t\t<fn:var name="hasTagBlock" value="{attrs.value || attrs.endDate}" />\n\t\t\t<fn:var name="promocode" value="{_this.getLastPromocode()}" />\n\t\t\t<fn:var name="salesValue" value="{String(attrs.value.size) + \' \' + attrs.value.currency}" />\n\t\t\t\x3c!-- Цвета для промо-скидок --\x3e\n\t\t\t<fn:var name="promoColors" value="{attrs.promoDiscount && attrs.colors}" />\n\t\t\t<fn:var name="promoColorsThemed"\n\t\t\t\tvalue="{attrs[\'dark-mode\'] ? promoColors && promoColors.dark : promoColors && promoColors.light}" />\n\t\t\t<fn:var name="discountBackground" value="{promoColorsThemed && promoColorsThemed.background}" />\n\t\t\t<fn:var name="tagBackground" value="{promoColorsThemed && promoColorsThemed.tag_background}" />\n\t\t\t<fn:var name="tagText" value="{promoColorsThemed && promoColorsThemed.tag_text}" />\n\n\t\t\t<fn:attr name="href" value="{attrs.href}" fn:if="attrs.href" />\n\n\t\t\t<bem:mod name="no-text-clamp" test="!hasTagBlock" />\n\n\t\t\t<fn:attr name="style" value="background-color: {discountBackground};" fn:if="discountBackground" />\n\n\t\t\t<div bem:elem="cross-container" fn:if="!attrs.system">\n\t\t\t\t<b:ico name="actions:close_big" size="xs" secondary remit:click.prevent.stop="mark:unpinned"\n\t\t\t\t\tevent:details="{model:attrs.model}" />\n\t\t\t</div>\n\n\t\t\t<div bem:elem="header">\n\t\t\t\t<b:avatar src="{(attrs.system ? _this.getBrandLogo() : attrs.image) || attrs.defaultImage}" size="s"\n\t\t\t\t\twith-border="{false}" />\n\n\t\t\t\t<div bem:elem="title" data-title-mode="overflow">\n\t\t\t\t\t<fn:attr name="title" value="{attrs.title}" />\n\n\t\t\t\t\t{attrs.title}\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="new" fn:if="attrs.new">\n\t\t\t\t\t{i18n(\'Новая\')}\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="switch" fn:if="attrs.switch !== undefined">\n\t\t\t\t\t<b:react-2kit-async component="Switch" compact checked="{!!attrs.switch}"\n\t\t\t\t\t\tdisabled="{!!attrs.disabled}" onChange="{_this.handleSwitch}" use:mediator="themes-manager" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="tag-block" fn:if="hasTagBlock">\n\t\t\t\t<span bem:elem="tag" fn:if="attrs.value" ref="tag">\n\t\t\t\t\t<fn:attr name="style" value="background-color: {tagBackground};" fn:if="tagBackground" />\n\n\t\t\t\t\t<span bem:elem="value" data-title-mode="overflow">\n\t\t\t\t\t\t<fn:attr name="style" value="color: {tagText};" fn:if="tagText" />\n\t\t\t\t\t\t<fn:attr name="title" value="{salesValue}" />\n\t\t\t\t\t\t{salesValue}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div bem:elem="promocode" remit:click.prevent.stop="promocode-click">\n\t\t\t\t\t<bem:mod name="hidden" test="!attrs.promocodes || !attrs.promocodes.length" />\n\t\t\t\t\t<bem:mod name="copy-hidden" test="!_this.isCopySupported()" />\n\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t{i18n(\'Промокод\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="promocode-value">\n\t\t\t\t\t\t{promocode}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="copy" ref="copy-promocode">\n\t\t\t\t\t\t<fn:attr name="style" value="background-color: {tagBackground};" fn:if="tagText" />\n\t\t\t\t\t\t{i18n(\'Копировать промокод\')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<span bem:elem="end-date" ref="end-date" fn:if="!attrs.promocodes || !attrs.promocodes.length">\n\t\t\t\t\t<bem:mod name="hidden" test="attrs.endDate.is_default" />\n\t\t\t\t\t{attrs.endDate | formatDate}\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="text" data-title-mode="overflow">\n\t\t\t\t<bem:mod name="line-clamp" test="hasTagBlock" />\n\t\t\t\t<bem:mod name="system" test="attrs.system" />\n\t\t\t\t<fn:attr name="title" value="{attrs.text}" />\n\n\t\t\t\t{attrs.text}\n\t\t\t</div>\n\t\t</a>\n\t</div>\n</div>',"app/feast-tpl!ui-block/discounts-item/discounts-item.html")});define("feast-tpl!ui-block/discounts-item/discounts-item.html",["feast-tpl!app/feast-tpl!ui-block/discounts-item/discounts-item.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/copyToClipboard",["require","exports","service/radars/index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isCopySupported=void 0;a=__importDefault(a);var b=function(){var a;return typeof((a=navigator===null||navigator===void 0?void 0:navigator.clipboard)===null||a===void 0?void 0:a.writeText)==="function"};exports.isCopySupported=b;exports.default=function(b){if(!exports.isCopySupported()){a.default("no-clipboard");return Promise.reject()}return navigator.clipboard.writeText(b)}});define("feast-tpl!app/feast-tpl!ui-block/avatar/avatar.html",["feast"],function(a){return a.smartParse('<div qa:id="selected:{!!attrs.selected}">\n\t<bem:mod name="rounded"/>\n\t<bem:mod name="selectable" test="attrs.selectable"/>\n\t<bem:mod name="selected" test="attrs.selected"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="size_{attrs.size}" test="attrs.size"/>\n\t<bem:mod name="ico" test="!attrs.src" />\n\t<bem:mod name="anonymous" test="attrs.anonymous" />\n\n\t<span bem:elem="img">\n\t\t<bem:mod name="ico" test="!attrs.src" />\n\t\t<bem:mod name="with-border" test="attrs[\'with-border\']" />\n\t\t<fn:if test="attrs.src">\n\t\t\t<fn:attr name="style" value="{_this.getImage()} {_this.getBgColor()} {_this.getIcoColor()}"/>\n\t\t</fn:if>\n\t\t<fn:if test="!attrs.src">\n\t\t\t<fn:attr name="style" value="{_this.getBgColor()} {_this.getIcoColor()}" />\n\t\t\t<fn:if test="attrs.ico">\n\t\t\t\t<b:ico name="{attrs.ico}" size="{attrs[\'ico-size\']}" />\n\t\t\t</fn:if>\n\t\t</fn:if>\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/avatar/avatar.html")});define("feast-tpl!ui-block/avatar/avatar.html",["feast-tpl!app/feast-tpl!ui-block/avatar/avatar.html"],function(a){return a});define("ui-block/avatar/avatar",["exports","feast","feast-tpl!./avatar.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"avatar",template:e.default,immutable:true,blocks:{ico:f.default},defaults:{"with-border":true},getImage:function a(){return'background-image: url("'+this.get("src")+'");'},getBgColor:function a(){return"background-color: "+(this.get("bg-color")||"transparent")+";"},getIcoColor:function a(){var b="";if(this.get("ico-color")){b="fill: "+this.get("ico-color")+";"}return b},didMount:function a(){this.el.classList.add("stop-animate")}})});define("feast-tpl!app/feast-tpl!ui-block/react-2kit-async/react-2kit-async.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:attr name="class" value="{attrs[\'class-name\']}" test="!!attrs[\'class-name\']"/>\n</div>\n',"app/feast-tpl!ui-block/react-2kit-async/react-2kit-async.html")});define("feast-tpl!ui-block/react-2kit-async/react-2kit-async.html",["feast-tpl!app/feast-tpl!ui-block/react-2kit-async/react-2kit-async.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("ui-block/react-async/react-async-core",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ReactAsyncCore=void 0;var a=function(){function a(b,c,d){var e=this;if(c===void 0){c=[]}if(d===void 0){d={}}this._options=d;this._loadPromise=Promise.resolve();this._depsLoaded=true;this._props={};this._mounted=false;this._componentGetter=b;c.push(["react",new Promise(function(a,b){require(["react"],a,b)}).then(__importStar)],["react-dom",new Promise(function(a,b){require(["react-dom"],a,b)}).then(__importStar)],["@mail/vkui/2kit",new Promise(function(a,b){require(["@mail/vkui/2kit"],a,b)}).then(__importStar)]);if(this._options.useErrorBoundary){c.push(["ui-react",new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar)])}if(this._options.customNode){c.push(["",Promise.resolve(this._options.customNode).then(function(a){e._customNode=a})])}var f=c.filter(function(b){var c=b[0];return!c||!(c in a._depsMap)});if(f.length){this._depsLoaded=false;this._loadPromise=Promise.all(f.map(function(a){var b=a[1];return b})).then(function(b){e._depsLoaded=true;b.forEach(function(b,c){var d=f[c][0];if(d){a._depsMap[d]=b}})})}}a.prototype.loadPromise=function(){return this._loadPromise};a.prototype.depsLoaded=function(){return this._depsLoaded};a.prototype.getDep=function(b){return a._depsMap[b]};a.prototype.setProps=function(a){this._props=a;if(this._mounted){this._renderReact()}};a.prototype._mountWhenDepsLoaded=function(a){this._node=this._customNode||a;this._renderReact()};a.prototype.mount=function(a){var b=this;this._mounted=true;if(this.depsLoaded()){this._mountWhenDepsLoaded(a);return}this.loadPromise().then(function(){b._mountWhenDepsLoaded(a)})};a.prototype.umount=function(){var a=this._node;this._mounted=false;if(a&&this._depsLoaded){this.getDep("react-dom").unmountComponentAtNode(a)}};a.prototype.getComponent=function(){var a;return(a=this._componentRef)===null||a===void 0?void 0:a.current};a.prototype._renderReact=function(){var a;if(!this._depsLoaded||!this._mounted){return}var b=this.getDep("react");var c=this.getDep("react-dom");this._componentRef=b.createRef();var d=b.createElement(this._componentGetter(this),__assign(__assign({},this._props),{_node:this._node,ref:this._componentRef}),null);var e=d;if(this._options.useErrorBoundary){e=b.createElement(this.getDep("ui-react").default.ErrorBoundary,{id:(a=this._options.blockRadarId)!==null&&a!==void 0?a:"react"},d)}c.render(e,this._node)};a._depsMap={};return a}();exports.ReactAsyncCore=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/react-2kit-async/react-2kit-async",["require","exports","feast","feast-tpl!./react-2kit-async.html","ui-block/react-async/react-async-core"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"react-2kit-async",template:b.default,defaults:{component:null},constructor:function(){var b=this;a.default.Block.apply(this,arguments);this._reactAsyncCore=new c.ReactAsyncCore(function(a){return a.getDep("@mail/vkui/2kit")[b.get("component")]},[],{provideTheme:true})},didMount:function(){this._setProps();this._reactAsyncCore.mount(this.el)},didUnmount:function(){this._reactAsyncCore.umount()},set:function(){a.default.Block.prototype.set.apply(this,arguments);this._setProps()},getComponent:function(){return this._reactAsyncCore.getComponent()},_setProps:function(){if(this.isMounted()){var a=__assign({},this.getAttrsSnapshot());this._reactAsyncCore.setProps(a)}}})});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/discounts-item/discounts-item",["require","exports","@mail/xray","cfg","feast","feast-mod/letter-date","feast-tpl!./discounts-item.html","helpers/copyToClipboard","mail/Message","service/notify","service/radars/index","ui-block/avatar/avatar","ui-block/ico/ico","ui-block/react-2kit-async/react-2kit-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importStar(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var m=c.default.Block.extend({name:"discounts-item",template:e.default,blocks:{avatar:j.default,ico:k.default,"react-2kit-async":l.default},notVisualAttributes:{defaultVisible:true},mods:{formatDate:function(a){if(a.is_default){return""}return i18n("до {date}",{date:d.letterMonthDate(a.date,true)})}},defaults:{title:i18n("Название скидки"),text:i18n("Краткое описание скидки с условиями, при которых она действительна."),image:undefined,colors:{},defaultImage:b.default.get("urls.avatarUrl")+"/pic?width=90&height=90",disabled:false,width:"default",endDateNewLine:false},events:{"discounts-click":"handleClick","promocode-click":"handlePromocodeClick"},isCopySupported:f.isCopySupported,constructor:function(){c.default.Block.apply(this,arguments);this.handleSwitch=this.handleSwitch.bind(this)},didMount:function(){var a=this.refs["tag"];var b=this.refs["end-date"];if(!a||!b){return}if(a.getBoundingClientRect().top!==b.getBoundingClientRect().top){this.set({endDateNewLine:true})}},handlePromocodeClick:function(){var a=this;if(f.isCopySupported()){f.default(this.get("promocodes")[0]).then(function(){h.default.add({qa:"discount-copy-promocode",text:i18n("Промокод скопирован")});var b=g.default.all.get(a.get("model").id);i.default({type:"discount_promocode_copy",dwh:{letterId:b===null||b===void 0?void 0:b.get("id"),jsonld:b===null||b===void 0?void 0:b.get("discount.from_jsonld")}})}).catch(function(){i.default("discount_promocode_copy_error")})}},handleSwitch:function(b){a.default.send("discounts_switch_"+b,{i:{"from-item":1}});this.broadcast("switch",b)},getBrandLogo:function(){return b.default.get("urls.logoLetterUrl")},handleClick:function(){if(!this.is("href")||!this.is("model")){return}var b=g.default.all.get(this.get("model").id);var c=b.get("thread_id");var d=b.get("flags.unread");a.default.send("open_discount_thread",{dwh:{from:"discount_block",threadId:c,letterId:b.get("id"),unread:d,defaultVisible:this.get("defaultVisible"),jsonld:b.get("discount.from_jsonld"),relevant:b.get("flags.is_relevant")}})},getLastPromocode:function(){var a=this.get("promocodes");return a&&a[0]&&a[0].toUpperCase()}});exports.default=m});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/discounts/discounts",["require","exports","@mail/flags","data-source/actions","default-values","feast","feast-tpl!./discounts.html","helpers/data-source-dispatch","helpers/getCurrentTimestamp","helpers/letter","mail/Message","ui-block/discounts-item/discounts-item","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);i=__importDefault(i);j=__importDefault(j);var l=d.default.Block.extend({name:"discounts",template:e.default,blocks:{"discounts-item":j.default},lazyBlocks:{gallery:k.lazyUIGallery},defaults:{_progress:false,discounts:[],disableDiscountsBlock:true,visibleItemsCount:0},events:{"discounts:switch":"handleDiscountsSwitch","gallery:scroll:end":"handleGalleryScrollEnd","all:blocks:visible":"handleGalleryScrollEnd","gallery:blocks:rendered":"handleGalleryBlocksRendered"},getDiscountColors:function(a){return c.PROMO_DISCOUNTS_COLORS[a]},getThreadImage:function(a){var b=i.default.all.get(a);return b===null||b===void 0?void 0:b.get("correspondents.from.0.avatars.default")},getThreadHref:function(a){var b=i.default.all.get(a);var c=this.get("folder");return h.getLetterHref(b,c,{router:this.get("router"),threads:this.is("threadsEnabled"),search:this.is("search")})},getModel:function(a){return i.default.all.get(a)},handleDiscountsSwitch:function(a){var c=this;this.set("_progress",true);f.default({type:b.TOGGLE_DISCOUNTS,state:!!a.details}).then(function(){c.set("_progress",false)})},getGalleryControls:function(){var a=["touch"];if(this.is("3pane")){a.push("arrows_bottom","pages");if(c.DISCOUNTS_MOUSE_SCROLL=="all"){a.push("mouse")}}else{a.push("arrows_middle");if(c.DISCOUNTS_MOUSE_SCROLL=="all"||c.DISCOUNTS_MOUSE_SCROLL=="2pane"){a.push("mouse")}}return a.join(",")},handleGalleryScrollEnd:function(){var b=a.default.get(c.DISCOUNTS_FLAG_NAME);if(!b.getCount("show")){b.save({hit:true})}},handleGalleryBlocksRendered:function(a){if(this.isMounted()){this.set({visibleItemsCount:a.details.visibleItemsCount})}},isNewDiscount:function(a){var b=i.default.all.get(a);var d=b===null||b===void 0?void 0:b.get("date");var e=g.getCurrentTimestamp();return(b===null||b===void 0?void 0:b.get("flags.unread"))&&d&&e<d+c.DELAY_FOR_NEW_DISCOUNT},didMount:function(){this.set({disableDiscountsBlock:!!a.default.get(c.DISCOUNTS_FLAG_NAME).getCount("show")})}});exports.default=l});define("feast-tpl!app/feast-tpl!ui-block/draggable/draggable.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:apply-match name="default"/>\n</div>\n',"app/feast-tpl!ui-block/draggable/draggable.html")});define("feast-tpl!ui-block/draggable/draggable.html",["feast-tpl!app/feast-tpl!ui-block/draggable/draggable.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/draggable/draggable",["require","exports","feast","feast-tpl!./draggable.html"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=Math.abs;var d=Math.max;var e="draggable";function f(a){a.preventDefault();a.stopPropagation()}function g(a,b,c){a&&a.dragHandleEvent&&a.dragHandleEvent({type:b,target:c,currentTarget:a})}exports.default=a.default.Block.extend({name:"draggable",template:b.default,defaults:{tolerance:10,enabled:true},notVisualAttributes:{tolerance:true,enabled:true},attrChanged:{enabled:function(a){this.toggleDraggable(a)}},didMount:function(){if(this.is("enabled")){this.toggleDraggable(true)}},toggleDraggable:function(a){var b=this;if(a){this._drag=null;this._handleDragAwaiting=function(a){return b.handleDragAwaiting(a)};this._handleDragMove=function(a){return b.handleDragMove(a)};this._handleDragEnd=function(a){return b.handleDragEnd(a)};this.$on(this.el,"mousedown",this._handleDragAwaiting)}if(!a){this.cancelDrag(true);this.$off(this.el,"mousedown",this._handleDragAwaiting)}},handleDragAwaiting:function(a){if(a.button!==0){return}var b=this.getIdByEl(a.target);if(typeof b==="undefined"){return}this._drag={active:false,clientX:a.clientX,clientY:a.clientY,target:a.target};this.$on(document,"mousemove",this._handleDragMove);this.$on(document,"mouseup",this._handleDragEnd)},handleDragMove:function(a){var b=this._drag;var h=a.target;var i=a.clientX;var j=a.clientY;var k=5;if(!b.active&&d(c(b.clientX-i),c(b.clientY-j))<this.get("tolerance")){return}f(a);if(!b.active){b.active=true;b.el=document.createElement("div");b.el.style.position="fixed";b.el.style.zIndex="10000";this.prepareDragElement(b.el,a);document.body.appendChild(b.el);document.body.classList.add(e);this.broadcast("drag:start");this.el.addEventListener("click",f,true)}b.el.style.left=i+k+"px";b.el.style.top=j+k+"px";var l=document.elementFromPoint(i,j);do{if(l===null||l===void 0?void 0:l.dragHandleEvent){break}}while(l&&(l=l.parentNode));if(b.overEl!==l){g(b.overEl,"dragleave",h);b.overEl=l;g(b.overEl,"dragenter",h)}g(l,"dragmove",h)},handleDragEnd:function(a){if(!this._drag||!this._drag.active){this.cancelDrag(true)}if(this._drag){f(a);g(this._drag.overEl,"drop",a.target);this.cancelDrag(false)}},cancelDrag:function(a){var b=this;var c;this.$off(document,"mousemove",this._handleDragMove);this.$off(document,"mouseup",this._handleDragEnd);if(a){(c=this.el)===null||c===void 0?void 0:c.removeEventListener("click",f,true)}if(!a){this.timerId=setTimeout(function(){var a;(a=b.el)===null||a===void 0?void 0:a.removeEventListener("click",f,true)},0)}if(this._drag){this._drag.el&&this._drag.el.parentNode&&this._drag.el.parentNode.removeChild(this._drag.el);this._drag=null;document.body.classList.remove(e);this.broadcast("drag:end")}},getIdByEl:function(a){a=a.closest("[data-draggable-id]");var b;if(a){b=a.dataset.draggableId}return b},prepareDragElement:function(a,b){var c=this.getIdByEl(this._drag.target);if(typeof c!=="undefined"){this.broadcast("preparedragelement",{el:a,id:c},b)}},didUnmount:function(){if(this.is("enabled")){this.toggleDraggable(false)}clearTimeout(this.timerId)}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html",["feast"],function(a){return a.smartParse('<div qa:id="native-adv">\n\t<bem:mod name="rounded" test="attrs.rounded"/>\n\n\t<fn:choose>\n\n\t\t\t<fn:when test="attrs.compact">\n\t\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t\t<bem:mod name="compact-indent" test="attrs.indent"/>\n\t\t\t\t<fn:choose>\n\n\t\t\t\t\t<fn:when test="attrs.ponymode || attrs.indent">\n\t\t\t\t\t\t\x3c!-- 3pane && (ponymode || inMetathread) --\x3e\n\t\t\t\t\t\t<div bem:elem="container" bem:mod="compact_compressed">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- 3pane && !(ponymode || inMetathread) --\x3e\n\t\t\t\t\t\t<div bem:elem="container" bem:mod="compact">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\n\t\t\t\t</fn:choose>\n\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t\t<bem:mod name="indent" test="attrs.indent"/>\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="attrs.ponymode">\n\t\t\t\t\t\t\x3c!-- 2pane && ponymode --\x3e\n\t\t\t\t\t\t<div bem:elem="container" bem:mod="compressed">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- 2pane && !ponymode --\x3e\n\t\t\t\t\t\t<div bem:elem="container">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:otherwise>\n\n\t</fn:choose>\n\n\t<fn:if test="!attrs[\'no-delimeter\']">\n\t\t<b:delimeter full/>\n\t\t<b:delimeter last/>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html")});define("feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/delimeter/delimeter.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="last" test="attrs.last"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\t<bem:mod name="indent" test="attrs.indent"/>\n\t<bem:mod name="indentRight" test="attrs.indentRight"/>\n\t<bem:mod name="full" test="attrs.full"/>\n</div>\n',"app/feast-tpl!ui-block/delimeter/delimeter.html")});define("feast-tpl!ui-block/delimeter/delimeter.html",["feast-tpl!app/feast-tpl!ui-block/delimeter/delimeter.html"],function(a){return a});define("ui-block/delimeter/delimeter",["exports","feast","feast-tpl!./delimeter.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"delimeter",template:d.default,blocks:{}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html",["feast"],function(a){return a.smartParse('<div>\n    <fn:if test="!_this.needAnimate()">\n\n        <bem:mod name="compact" test="attrs.compact"/>\n\n        <fn:choose>\n            <fn:when test="attrs.compact">\n                <div bem:elem="avatar-container">\n                    <fn:choose>\n                        <fn:when test="attrs.ponymode">\n                            <div bem:elem="avatar"></div>\n                        </fn:when>\n                        <fn:otherwise>\n                            <div bem:elem="avatar" bem:mod="compact"></div>\n                        </fn:otherwise>\n                    </fn:choose>\n                </div>\n                <div bem:elem="text">\n                    <div bem:elem="string" bem:mod="1"></div>\n                    <div bem:elem="string" bem:mod="2"></div>\n                    <div bem:elem="string" bem:mod="3"></div>\n                </div>\n            </fn:when>\n            <fn:otherwise>\n                <div bem:elem="avatar-container">\n                    <div bem:elem="avatar"></div>\n                </div>\n                <div bem:elem="text">\n                    <div bem:elem="string" bem:mod="1"></div>\n                    <div bem:elem="string" bem:mod="2"></div>\n                </div>\n            </fn:otherwise>\n        </fn:choose>\n    </fn:if>\n</div>',"app/feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html")});define("feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html"],function(a){return a});define("ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder",["exports","default-values","feast","feast-tpl!./letter-list-item-adv-placeholder.html"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"letter-list-item-adv-placeholder",template:e.default,needAnimate:function b(){return a.LIST_ADVERT_ANIMATION}})});define("ui-block/letter-list-item-adv/letter-list-item-adv",["exports","default-values","feast","feast-tpl!./letter-list-item-adv.html","mrg-xray","service/adv/config","service/adv/index","service/radars/decorator","service/smokescreen","ui-block/delimeter/delimeter","ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder"],function(exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var k=r(b);var l=r(c);var m=r(d);var n=r(f);var o=r(g);var p=r(i);var q=r(j);function r(a){return a&&a.__esModule?a:{default:a}}var s=0;var t={};function u(a){try{if(a&&a!==document.body&&a!==document.activeElement){a.focus()}}catch(a){}}exports.default=k.default.Block.extend((0,o.default)({id:"adv",explicit:"radar"})((0,h.withWelter)({name:"letter-list-item-adv",template:l.default,immutable:true,mods:{},blocks:{delimeter:p.default,"letter-list-item-adv-placeholder":q.default},defaults:{},events:{},delayHandler:null,shouldPrefetch:true,attrChanged:{hidden:function a(b){if(b){this.el.style.display="none"}else{this.el.style.display=""}}},isCompact:function a(){return this.is("compact")||this.is("touch")},getAdvName:function a(){return this.isCompact()?"list3pane":"list2pane"},didUpdate:function a(){this.broadcast("render:adv",{advRender:this._updatePlacementBound,advName:this.name})},didMount:function a(){var b=this;var c=this.isCompact();var d=this.getAdvName();var g=this.get("router");var h=this.get("index");var i=this.refs["adv-content"];var j=f.Adman.placement(d);this.radar(["try-render",c?"3pane":"2pane"]);if(!j){return}var k=t[d];this.needAnimate()&&k&&i.appendChild(k);var l=j._slot.id,o=j._throttling,p=j._handlePageVisibility,q=j.autoUpdate._timeout,r=j._expId;var u=l.split(".")[0];var v=u+"."+s++;var w=d+v;var x=Object.assign({},e.slotsConfig[d],{id:v,forceFail:f.Adman.slot(u).forceFail});e.slotsConfig[w]=x;this._slotId=v;var y=f.Adman.addSlots(x);var z=y[v];this._slot=z;if(this.get("indent")){f.Adman.clearCache();(0,e.setRBParam)("in3paneMetathread",c?1:0);this.shouldPrefetch=false}else{(0,e.setRBParam)("in3paneMetathread",0);this.shouldPrefetch=true}var A=f.Adman.addPlacements({siteZone:e.getSiteZone,name:w,radarName:d,slot:v,autoUpdate:q,renderThrottling:o,handlePageVisibility:p,renderOnCreate:false,expId:r,rbParams:e.getRBParams,renderOptions:{customInsert:this.needAnimate()&&this.customInsert.bind(this)}});var B=A[w];e.placementsConfig[w]=B;z.on("adv-fetch-success",function(){n.default.successSlotHandler(z,B);b.radar(["adman-fetch","success",c?"3pane":"2pane"])});z.on("adv-fetch-fail",function(){n.default.failSlotHandler(z,B,false,h);b.radar(["adman-fetch","fail",c?"3pane":"2pane"])});z.on("adv-fetch-force-fail",function(){n.default.failSlotHandler(z,B,true,h);b.radar(["adman-fetch-force","fail",c?"3pane":"2pane"])});g.on("beforeroute",function(){return z.removeAllListeners()});B.on("adv-render-fail",function(a){a=a||{};a.banner=a.banner||{};a.error=a.error||{message:"no error object"};var d={slotId:a.id,bannerId:a.banner.banner,stack:a.error.stack,error:a.error.message};(0,m.default)("adman-render_fail_"+(c?"3pane":"2pane")+"&v=1&rlog=octavius_js_banner_errors&rlog_message="+JSON.stringify(d));b.radar(["adman-render","fail",c?"3pane":"2pane"])});this._renderPlacementBinded=this.renderPlacement.bind(this,w);this._updatePlacementBound=this.renderPlacement.bind(this,w,true);this.broadcast("render:adv",{advRender:this._renderPlacementBinded,advName:this.complexName})},didUnmount:function a(){var b=this.getAdvName();var c=b+(this._slotId?this._slotId:"");var d=f.Adman.placement(b);var e=this.isCompact();d.autoUpdate.stop();this.radar(["unmount",e?"3pane":"2pane"]);this.broadcast("render:remove",c);if(this._slotId){f.Adman.removePlacements([c])}},customInsert:function a(b,c){if(!b||!c){return}var d=this.getAdvName();var e=t[d];var f=function a(){try{b.removeChild(e)}catch(a){b.innerHTML=""}b.classList.remove("advert-appearence");t[d]=c};if(e){if(e.offsetParent){e.addEventListener("animationend",f);setTimeout(function a(){if(c.offsetHeight){e.classList.add("advert-removing");b.classList.add("advert-appearence")}else{setTimeout(a,100)}},100)}}else{t[d]=c}},renderPlacement:function a(b){var c=this;var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var e=this.isCompact();this.radar(["render-adv",e?"3pane":"2pane"]);var g=f.Adman.placement(b);var h=document.activeElement;var i=this.refs["adv-content"];g.attachToContainer(i);g.wakeUp();var j=function a(b){g.renderToContainer(i,b,!d).then(function(a){c.radar(["get-banner","success",e?"3pane":"2pane"]);if(a){c.radar(["get-banner","has",e?"3pane":"2pane"])}else{c.radar(["get-banner","has-not",e?"3pane":"2pane"])}}).catch(function(a){if(!a.forceFail){c.radar(["get-banner","fail",e?"3pane":"2pane"]);console.error(a)}}).then(function(){u(h)})};this.broadcast("native:render",{placement:g,placementRender:j})},needAnimate:function b(){var c=this.get("position");return c===0&&a.LIST_ADVERT_ANIMATION}})))});define("feast-mod/file-size",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fileSize=d;exports.fileSizeRange=e;var a={B:i18n("байт"),KB:i18n("КБ"),MB:i18n("МБ"),GB:i18n("ГБ"),TB:i18n("TБ")};var b=Object.freeze({KB:1024,MB:Math.pow(1024,2),GB:Math.pow(1024,3),TB:Math.pow(1024,4)});var c=function a(b,c,d,e){var f=(Math.round(b*Math.pow(10,c))/Math.pow(10,c)).toString().split(".");if(e){for(var g=f[0].length-3;g>=0;g-=3){f[0]=f[0].slice(0,Math.max(0,g))+e+f[0].slice(g)}}return f[0]+(f[1]?d+f[1]:"")};function d(d){if(d>=b.TB){d=c(d/b.TB,2,".","")+" "+a.TB}else if(d>=b.GB){d=c(d/b.GB,2,".","")+" "+a.GB}else if(d>=b.MB){d=c(d/b.MB,2,".","")+" "+a.MB}else if(d>=b.KB){d=c(d/b.KB,0)+" "+a.KB}else{d=c(d,0)+" "+a.B}return d}function e(a){switch(true){case a<=b.KB:return"1kb";case a<=b.MB:return"1mb";case a<=25*b.MB:return"25mb";case a<=b.GB:return"1gb";case a<=2*b.GB:return"2gb";default:return"over"}}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{_this.getAttachTitle()}"\n\tqa:id="attach:true"\n>\n\t<fn:choose>\n\t\t\t\t<fn:when test="attrs.model.isAttachmentsLoaded()">\n\t\t\t\t\t<fn:var name="attachments"\n\t\t\t\t\t\t\tvalue="{attrs.model.getAttachmentsList()}"/>\n\n\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tremit:contextmenu.stop\n\t\t\t\t\t\tremit:click.prevent\n\n\t\t\t\t\t\tcomponent="AttachmentDropdown"\n\n\t\t\t\t\t\tonChange="{_this.attachmentDropdownChange.bind(_this)}"\n\t\t\t\t\t\toverlayContainer="{document.getElementById(\'portal-overlay\')}"\n\t\t\t\t\t\titems="{_this.getAttachmentItems()}"\n\t\t\t\t\t\topen="{attrs[\'expand-attachment-dropdown\']}"\n\t\t\t\t\t\tbuttonSize="{attrs.small ? \'small\' : null}"\n\t\t\t\t\t\tponyMode="{attrs.ponymode}"\n\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t/>\n\n\t\t\t\t</fn:when>\n\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tremit:contextmenu.stop\n\t\t\t\t\t\tremit:click="attachment-button:expanded"\n\t\t\t\t\t\tcomponent="AttachmentButton"\n\t\t\t\t\t\tponyMode="{attrs.ponymode}"\n\t\t\t\t\t\tsmall="{attrs.small}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n</span>\n\n',"app/feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html")});define("feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/attach-icon/attach-icon.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="{attrs.name}"/>\n\t<b:react-async\n\t\tcomponent="AttachIcon"\n\t\ticonType="{_this.getIconType()}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/attach-icon/attach-icon.html")});define("feast-tpl!ui-block/attach-icon/attach-icon.html",["feast-tpl!app/feast-tpl!ui-block/attach-icon/attach-icon.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/react-async/react-async.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:attr name="class" value="{attrs[\'class-name\']}" test="!!attrs[\'class-name\']"/>\n</div>\n',"app/feast-tpl!ui-block/react-async/react-async.html")});define("feast-tpl!ui-block/react-async/react-async.html",["feast-tpl!app/feast-tpl!ui-block/react-async/react-async.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/react-async/react-async",["require","exports","cfg","feast","feast-tpl!./react-async.html","ui-block/react-async/react-async-core"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"react-async",template:c.default,defaults:{component:null,themeId:"default"},constructor:function(){var a=this;b.default.Block.apply(this,arguments);this._reactAsyncCore=new d.ReactAsyncCore(function(b){var c,d;var e=a.get("component");var f=b.getDep("ui-react");return(c=f[e])!==null&&c!==void 0?c:(d=f)===null||d===void 0?void 0:d.default[e]},[["ui-react",new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar)]],{useErrorBoundary:this.get("useErrorBoundary"),blockRadarId:this.get("blockRadarId"),customNode:this.get("customNode")})},didMount:function(){this._setProps();this._reactAsyncCore.mount(this.el)},didUnmount:function(){this._reactAsyncCore.umount()},set:function(){b.default.Block.prototype.set.apply(this,arguments);this._setProps()},getComponent:function(){return this._reactAsyncCore.getComponent()},_setProps:function(){if(this.isMounted()){var b=this.getAttrsSnapshot();b.qaEnabled=!!a.default.get("qa");b.darkMode=this.get("darkMode");this._reactAsyncCore.setProps(b)}}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/attach-icon/attach-icon",["require","exports","feast","feast-tpl!./attach-icon.html","ui-block/react-async/react-async"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"attach-icon",template:b.default,blocks:{"react-async":c.default},getParams:function(){return{type:"image"}},getIconType:function(){if(this.attrs.name){return this.attrs.name}return""}})});define("feast-tpl!app/feast-tpl!ui-block/dropdown/dropdown.html",["feast"],function(a){return a.smartParse('<div qa:state="{attrs.ponymode && \'pony-mode\'}">\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="touch-nav" test="attrs[\'touch-nav\']"/>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="collapsed" test="!attrs.expanded"/>\n\t<bem:mod name="expand-top" test="attrs[\'expand-top\']"/>\n\t<bem:mod name="expand-left" test="attrs[\'calculated-expand-left\']"/>\n\t<bem:mod name="expand-center" test="attrs[\'expand-center\']"/>\n\t<bem:mod name="no-relative" test="attrs[\'no-relative\']"/>\n\t<bem:mod name="nav-folders" test="attrs[\'nav-folders\']"/>\n\t<bem:mod name="{attrs.name}" test="attrs.name"/>\n\n\t<bem:mod name="scroll-style" value="{attrs[\'scroll-style\']}"/>\n\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="pony-mode" test="attrs.ponymode"/>\n\n\t<fn:match name="ctrl" args="attrs">\n\t\t<b:button2\n\t\t\tqa:id="dropdown-button"\n\t\t\tremit:click="ctrl-click"\n\t\t\tpromoId="{attrs.promoId}"\n\t\t\tshortcut="{attrs.shortcut}"\n\t\t\ttitle-shortcut="{attrs[\'title-shortcut\']}"\n\t\t\ttitle="{attrs.title}"\n\t\t\tannotation="{attrs.annotation}"\n\t\t\ttext="{attrs.text}"\n\t\t\tico="{attrs.ico}"\n\t\t\trotate-ico="{attrs[\'rotate-ico\']}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tshort="{attrs.short}"\n\t\t\tico-text-top="{attrs[\'ico-text-top\']}"\n\t\t\tpure="{attrs.pure}"\n\t\t\tpressed="{attrs.expanded}"\n\t\t\tsecondary="{attrs.secondary}"\n\t\t\tsize="{attrs.size}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tclean="{attrs.clean}"\n\t\t\tfont-size-pony="{attrs[\'font-size-pony\']}"\n\t\t\tnotification-badge="{attrs[\'notification-badge\']}"\n\t\t\talways-bright="{attrs[\'always-bright\']}"\n\t\t\tcentered\n\t\t\thighlighted="{attrs.highlighted}"\n\t\t/>\n\t</fn:match>\n\n\t<fn:match name="items">\n\t\t<div bem:elem="item">Item 1</div>\n\t\t<div bem:elem="item">Item 2</div>\n\t\t<div bem:elem="hr"/>\n\t\t<div bem:elem="item">Item 3</div>\n\t</fn:match>\n\n\t<fn:apply-match name="ctrl" args="attrs"/>\n\n\t<div qa:id="dropdown-list" bem:elem="menu" remit:click="list-click" ref="list">\n\t\t<fn:apply-match name="items" args="_this"/>\n\t</div>\n\n\t<fn:apply-match name="footer"/>\n</div>\n',"app/feast-tpl!ui-block/dropdown/dropdown.html")});define("feast-tpl!ui-block/dropdown/dropdown.html",["feast-tpl!app/feast-tpl!ui-block/dropdown/dropdown.html"],function(a){return a});define("service/submenu",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=void 0;exports.default={setup:function b(c){var d=new c({router:app});d.renderTo(document.body);a=d},teardown:function b(){a.destroy();a=null},open:function a(b,c,d){var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var f=this.getInstance();f.set(e);return f.setSubmenu(b,c,d)},close:function a(){var b=this.getInstance();if(b){b.hide()}},destroy:function a(){var b=this.getInstance();if(b){b.destroyBlock()}},getInstance:function b(){return a}}});define("feast-tpl!app/feast-tpl!ui-block/layout/layout.html",["feast"],function(a){return a.smartParse('<span qa:state="{attrs.type}" xmlns:fn="http://www.w3.org/1999/html">\n\t<fn:var name="isDragIconShown" value="{attrs.isDragIconShown}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\n\t<bem:mod name="size" value="{attrs.size}"/>\n\t<bem:mod name="type" value="{attrs.type}"/>\n\t<bem:mod name="vertical-fit" test="attrs[\'vertical-fit\']"/>\n\t<bem:mod name="bordered" test="attrs.bordered"/>\n\t<bem:mod name="letter" test="attrs.letter"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="right-padded" test="attrs[\'hide-ads\'] && !attrs[\'show-todo\']"/>\n\n\t\x3c!-- Костыль исключительно для IE11/Edge 14. НЕ ИСПОЛЬЗОВАТЬ ДЛЯ НОРМАЛЬНОЙ ЛОГИКИ (тк потом отпилим) --\x3e\n\t<bem:mod name="left_shortcut" test="attrs[\'is-shortcut-left\']"/>\n\t<bem:mod name="right_shortcut" test="attrs[\'right-column\'] < 60"/>\n\n\t<fn:attr name="style" value="{_this._getInlineStyle()}"/>\n\n\t<fn:match name="main-frame" args="layout">\n\t\t<div bem:elem="content-column">\n\t\t\t<fn:if test="layout.type === \'3pane\' || app.route.is(\'#letters #search\')">\n\t\t\t\t<div bem:elem="sidebar" ref="sidebar-column" bem:mod="size-{attrs[\'sidebar-column\']}">\n\t\t\t\t\t<div bem:elem="column" bem:mod="sidebar">\n\t\t\t\t\t\t<div bem:elem="column-wrapper">\n\t\t\t\t\t\t\t<fn:apply-match name="main-frame-sidebar" attrs="layout"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tfn:if="attrs[\'sidebar-resizable\'] && layout.type == \'3pane\'"\n\t\t\t\t\t\t\t\tbem:elem="resizer"\n\t\t\t\t\t\t\t\tbem:mod="sidebar"\n\t\t\t\t\t\t\t\tref="sidebar-column-resizer"\n\t\t\t\t\t\t\t\tpromo:id="{isDragIconShown ? \'sidebar-column-resizer-wrapper\' : \'sidebar-column-resizer\'}"\n\t\t\t\t\t\t\t\tqa:id="resizer-3pane"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<bem:mod name="with-icon" test="isDragIconShown"/>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="icon-wrapper"\n\t\t\t\t\t\t\t\tbem:mod="sidebar-column"\n\t\t\t\t\t\t\t\tfn:if="isDragIconShown"\n\t\t\t\t\t\t\t\tpromo:id="{isDragIconShown ? \'sidebar-column-resizer\' : \'\'}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<bem:mod name="compact" test="ponyMode"/>\n\n\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\tname="navigation_drag_indicator"\n\t\t\t\t\t\t\t\t\tfn:if="isDragIconShown"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="layout.type === \'3pane\' || app.route.is(\'#read-letter #search-letter\')">\n\t\t\t\t<div bem:elem="content">\n\t\t\t\t\t<fn:apply-match name="main-frame-content" args="layout"/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t<fn:apply-match name="head"/>\n\n\t<fn:if test="attrs[\'left-column\']">\n\t\t<div bem:elem="column" bem:mod="left" qa:id="sidebar" ref="left-column">\n\t\t\t<div bem:elem="column-wrapper">\n\t\t\t\t<fn:apply-match name="left-column"/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tbem:elem="resizer"\n\t\t\t\tbem:mod="left"\n\t\t\t\tref="left-column-resizer"\n\t\t\t\tfn:if="attrs.resizable"\n\t\t\t\tqa:id="resizer"\n\t\t\t\tpromo:id="{isDragIconShown ? \'left-column-resizer-wrapper\': \'left-column-resizer\'}"\n\t\t\t>\n\t\t\t\t<bem:mod name="with-icon" test="isDragIconShown"/>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="icon-wrapper"\n\t\t\t\t\tpromo:id="{isDragIconShown ? \'left-column-resizer\' : \'\'}"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="compact" test="ponyMode"/>\n\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="navigation_drag_indicator"\n\t\t\t\t\t\tfn:if="isDragIconShown"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="main-frame">\n\t\t<fn:apply-match name="main-frame"/>\n\t</div>\n\n\t<fn:if test="__vmatches[\'right-column\'] && attrs[\'right-column\']">\n\t\t<div bem:elem="column" bem:mod="right" qa:id="advert-column">\n\t\t\t<bem:mod name="right-indented" test="attrs[\'right-column-indented\']"/>\n\t\t\t<fn:apply-match name="right-column"/>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:apply-match name="foot"/>\n\t<fn:apply-match name="dimmer"/>\n</span>\n',"app/feast-tpl!ui-block/layout/layout.html")});define("feast-tpl!ui-block/layout/layout.html",["feast-tpl!app/feast-tpl!ui-block/layout/layout.html"],function(a){return a});define("helpers/column-resizer",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResizeWatcher=void 0;var a=function(){function a(a,b,c){var d=this;this.resizeWatchMouseDown=function(a){a.preventDefault();d.dX=0;d.clientX=a.clientX;d.toggleMouseListeners(true)};this.resizeWatchMouseMove=function(a){d.dX=a.clientX-d.clientX;d.clientX=a.clientX;d.updateWidth(d.width+d.dX)};this.resizeWatchMouseUp=function(a){a.preventDefault();d.toggleMouseListeners(false);var b=d.width+d.dX;d.dX=0;d.updateWidth(b,true)};this.resizer=a;this.getWidth=b;this.clientX=0;this.width=this.getWidth();this.dX=0;this._updateWidth=c;this.resizeWatchAttach()}a.prototype.destroy=function(){this.resizer.removeEventListener("mousedown",this.resizeWatchMouseDown)};a.prototype.updateWidth=function(a,b){if(b===void 0){b=false}var c=Math.round(a);this._updateWidth(c,b)};a.prototype.setWidth=function(a){this.width=a};a.prototype.toggleMouseListeners=function(a){var b=a?document.addEventListener:document.removeEventListener;b("mousemove",this.resizeWatchMouseMove);b("mouseup",this.resizeWatchMouseUp)};a.prototype.resizeWatchAttach=function(){this.resizer.addEventListener("mousedown",this.resizeWatchMouseDown)};return a}();exports.ResizeWatcher=a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layout/layout",["require","exports","default-values","feast","feast-tpl!./layout.html","helpers/column-resizer","service/smokescreen"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockDescription=exports.LayoutEvents=void 0;b=__importDefault(b);c=__importDefault(c);var f=4;var g;(function(a){a["LayoutResize"]="layout:resize"})(g=exports.LayoutEvents||(exports.LayoutEvents={}));exports.blockDescription={name:"layout",template:c.default,isolateEvents:false,blocks:{},defaults:{"left-column":0,"right-column":0,"right-column-padding":a.NEW_LETTER_LIST?12:8,"right-column-indented":a.ADVERT_SIDEBAR_ROUNDED,"sidebar-column":0,"is-shortcut-left":false,"is-shortcut-right":false,"is-advert-scroll":false,"vertical-fit":false,resizable:false,type:"2pane",id:null,group:null},performanceTrace:true,didUpdate:function(){this.updateColumnSizes();this.registerResize3pane()},updateColumnSizes:function(a){if(a===void 0){a={}}var b=this.getLeftColumnWidth(a.left);var c=this.getRightColumnWidth();var d=this.getSidebarColumnWidth(a.sidebar);this.el.style.setProperty("--left-column-width",b+"px");this.el.style.setProperty("--right-column-width",c+"px");this.el.style.setProperty("--sidebar-column-width",d+"px")},getLeftColumnWidth:function(a){return(a||this.get("left-column"))*f},getRightColumnWidth:function(){return this.get("right-column")*f+this.get("right-column-padding")},getSidebarColumnWidth:function(a){return(a||this.get("sidebar-column"))*f},didMount:function(){this.onResize=this.onResize.bind(this);this.updateColumnSizes();if(this.is("resizable")){this.registerResize()}},didUnmount:function(){var a,b;(a=this.resizeWatcher)===null||a===void 0?void 0:a.destroy();(b=this.resizeWatcherSidebar)===null||b===void 0?void 0:b.destroy()},registerResize:function(){var a=this;var b=this.refs["left-column"];var c=this.refs["left-column-resizer"];if(b&&c){this.resizeWatcher=new d.ResizeWatcher(c,function(){return b.getBoundingClientRect().width},function(b,c){a.broadcast(g.LayoutResize,{column:"left",width:b,id:a.get("id"),group:a.get("group"),resizeEnd:c});return false})}this.registerResize3pane()},registerResize3pane:function(){var a=this;var b;(b=this.resizeWatcherSidebar)===null||b===void 0?void 0:b.destroy();var c=this.refs["sidebar-column"];var e=this.refs["sidebar-column-resizer"];if(this.is("sidebar-resizable")&&e){this.resizeWatcherSidebar=new d.ResizeWatcher(e,function(){return c.getBoundingClientRect().width},function(b,c){a.broadcast(g.LayoutResize,{column:"sidebar",width:b,id:a.get("id"),group:a.get("group"),resizeEnd:c});return false})}},onResize:function(b,c){var d,e;if(c){this.el.classList.toggle("layout_resizing",true)}this.updateColumnSizes(b);(d=this.resizeWatcher)===null||d===void 0?void 0:d.setWidth(b.left*4);(e=this.resizeWatcherSidebar)===null||e===void 0?void 0:e.setWidth(b.sidebar*4);this.el.classList.toggle("layout_left_shortcut",b.left<a.SHORTCUT_LEFT_COLUMN_LIMIT)},onResizeEnd:function(){this.el.classList.toggle("layout_resizing",false)},_getInlineStyle:function(){var a="max-width: "+this.get("max-width")+"px;";var b="--left-column-width: "+this.getLeftColumnWidth()+"px;";var c="--right-column-width: "+this.getRightColumnWidth()+"px;";var d="--sidebar-column-width: "+this.getSidebarColumnWidth()+"px;";return a+" "+b+" "+c+" "+d}};var h=b.default.Block.extend(e.withWelter(exports.blockDescription));h.getLayoutById=function(a){var b=h.getInstances();return b.find(function(b){return b.get("id")===a})};exports.default=h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dropdown/dropdown",["require","exports","feast","feast-tpl!./dropdown.html","helpers/browser","service/radars/decorator","service/submenu","ui-block/button2/button2","ui-block/layout/layout","ui-block/scrollable/scrollable","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);exports.default=a.default.Block.extend(d.default()({name:"dropdown",template:b.default,defaults:{expanded:false,"disable-expand-top":false,"disable-expand-center":false,"expand-top":false,"expand-left":false,"expand-center":false,"scroll-style":"normal","calculated-expand-left":false,"hover-support":c.default.capabilities["hover-support"],"auto-close":true},blocks:{button2:f.default},events:{"ctrl-click":"handleToggle","list-click":"handleListClick"},didMount:function(){var a=this;var b=h.default.getScrollableBlock(this);var c=g.default.getLayoutById("main");this.container=b&&b.el||c&&c.el||document.body;this.hide=this.hide.bind(this);this.onEscape=function(b){b.stopImmediatePropagation();a.hide()};window.addEventListener("resize",this.hide)},didUnmount:function(){window.removeEventListener("resize",this.hide)},getUnblockedDirections:function(a){var b=this;return a.filter(function(a){return!b.is("disable-expand-"+a)})},getHorizontalDirections:function(){return this.get("expand-left")?["left","right"]:["right","left"]},getPreferredHorizontalDirection:function(a,b,c){var d=this.getHorizontalDirections();var e=b.width;var f={left:c.right-a.left,right:a.right-c.left};var g=d.find(function(a){return f[a]-e>0});if(g){return g}return d[0]},attrChanged:{expanded:function(a){var b=this;this[a?"$on":"$off"](this.el.ownerDocument,"click","handleOutsideTap");this[a?"$on":"$off"](this.el.ownerDocument,"contextmenu","handleOutsideTap");this[a?"$on":"$off"](this.refs.list,"scroll","closeSubmenu");this[a?"$one":"$off"](this.el.ownerDocument.defaultView,"resize","closeSubmenu");i.lazyMailKeymaster().then(i.uniqCallback(this,function(c){if(a){c("escape",b.onEscape)}else{c.unbind("escape",b.onEscape)}}));if(a&&!this.is("touch-nav")){this.set({"expand-top":false,"expand-center":false,"calculated-expand-left":false});this.refs.list.style["max-height"]=null;this.refs.list.style.left=null;this.refs.list.style.right=null;var c=["bottom","top","center"];var d=["center","bottom","top"];var e=this.refs.list.getBoundingClientRect();var f=this.refs.list.parentNode.getBoundingClientRect();var g=this.container.getBoundingClientRect();var h=e.height,j=e.width;var k=g.bottom-f.bottom-h;var l=f.top-g.top-h;var m=8;var n=2;var o=m+n;var p=this.getPreferredHorizontalDirection(g,e,f);var q=p==="left";this.set("calculated-expand-left",q);var r={bottom:{space:k-o,activate:function(a){var c=-a;var d=h-c;b.refs.list.style["max-height"]=d+"px"}},top:{space:l-o,activate:function(a){b.set("expand-top",true);var c=-a;var d=h-c;b.refs.list.style["max-height"]=d+"px"}},center:{space:g.height-h-o*2,activate:function(){b.set("expand-center",true);var a=-f.top+g.top+o;var c=q?-j:0;var d=g.height-o*2;b.refs.list.style.top=a+"px";b.refs.list.style.left=c+"px";b.refs.list.style["max-height"]=d+"px"}}};var s=this.getUnblockedDirections(c);if(s.length===0){console.warn("Нет направления, куда мог бы открыться дропдаун");return}var t=s.some(function(a){var b=r[a];if(b.space<0){return false}b.activate(b.space,true);return true});if(t){return}var u=this.getUnblockedDirections(d);var v=u[0];var w=r[v];w.activate(w.space,false)}this.broadcast("dropdown-change-state",{state:a})}},handleListClick:function(a){if(this.is("auto-close")&&this.is("expanded")){this.handleToggle(a)}},handleOutsideTap:function(a){if(!this.el.contains(a.target)){this.hide()}},handleToggle:function(a){var b=this.is("expanded");if(!a.isDefaultPrevented()||b){a.preventDefault();this.invert("expanded");this.broadcast("dropdown-change-state",{state:!b})}},hide:function(){this.set("expanded",false)},closeSubmenu:function(){e.default.close()}}))});define("feast-tpl!app/feast-tpl!ui-block/list/list.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="shortcut" test="attrs.shortcut"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\n\t<fn:match name="default">\n\t\t<div bem:elem="item">Item 1</div>\n\t\t<div bem:elem="item">Item 2</div>\n\t\t<div bem:elem="hr"/>\n\t\t<div bem:elem="item">Item 3</div>\n\t</fn:match>\n\n\t<fn:apply-match name="default"/>\n</div>\n',"app/feast-tpl!ui-block/list/list.html")});define("feast-tpl!ui-block/list/list.html",["feast-tpl!app/feast-tpl!ui-block/list/list.html"],function(a){return a});define("ui-block/list/list",["exports","feast","feast-tpl!./list.html","helpers/browser"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list",template:e.default,events:{},defaults:{"hover-support":f.default.capabilities["hover-support"]}})});define("feast-tpl!app/feast-tpl!ui-block/list-item/list-item.html",["feast"],function(a){return a.smartParse('<div remit:click="click-radar" data-qa-id="{attrs[\'qa-id\']}">\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="nested" test="attrs.nested"/>\n\t<bem:mod name="selected" test="attrs.selected"/>\n\t<bem:mod name="markable" test="attrs.markable"/>\n\t<bem:mod name="shortcut" test="attrs.shortcut"/>\n\t<bem:mod name="paddingless" test="attrs.paddingless"/>\n\t<bem:mod name="pure" test="attrs.pure"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t<fn:attr name="title" value="{attrs.title}" test="!!attrs.title"/>\n\n\t<fn:add-class name="js-shortcut" test="!attrs.disabled && attrs.shortcut"/>\n\n\t<fn:match name="default">Item 1</fn:match>\n\n\t\x3c!-- Галочка --\x3e\n\t<fn:if test="attrs.markable">\n\t\t<div bem:elem="mark" qa:id="mark" qa:state="{attrs.marked ? \'marked\' : \'hidden\'}">\n\t\t\t<bem:mod name="hidden" test="!attrs.marked"/>\n\n\t\t\t<b:ico name="status:done"/>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:apply-match name="default"/>\n</div>\n',"app/feast-tpl!ui-block/list-item/list-item.html")});define("feast-tpl!ui-block/list-item/list-item.html",["feast-tpl!app/feast-tpl!ui-block/list-item/list-item.html"],function(a){return a});define("ui-block/list-item/list-item",["exports","feast","feast-tpl!./list-item.html","helpers/browser","service/radars/decorator","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,i.default)({events:[{name:"click-radar",rename:"click"}]})({name:"list-item",template:g.default,events:{},blocks:{ico:j.default},defaults:{"hover-support":h.default.capabilities["hover-support"],selected:false,markable:false,marked:false},onSubmenuShow:function a(){this.set("selected",true)},onSubmenuHide:function a(){this.set("selected",false)},onDestroy:function a(){this.onSubmenuHide()}}))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-common/list-letter-abstract",["require","exports","@mail/smokescreen","default-values","feast-mod/correspondents","feast-mod/letter-date","mail/Folder","mail/Thread","service/smokescreen"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.withWelterLetterPart=exports.withWelterLetter=exports.handleIntersectViewport=exports.getUnsubscribeSender=exports.rootQaId=exports.getSnippetValue=exports.hasBadge=exports.isImportant=exports.getCategory=exports.getCounter=exports.getSubjectTooltip=exports.getDateTooltip=exports.getCorrespondentTooltip=exports.getCorrespondent=exports.isProbablyPhishing=exports.getImageSrc=exports.getSubject=void 0;a=__importDefault(a);e=__importDefault(e);f=__importDefault(f);var h=["to","cc"];function i(){var a=this.get("model");return a.get("subject")||i18n("<Без темы>")}exports.getSubject=i;function j(a,b,c){if(c){var d=a.get("folder");switch(+d){case e.default.SENT:case e.default.DRAFTS:case e.default.OUTBOX:return"to"}}return b}function k(){var a=this.get("model");var b=j(a,this.get("main-field"),this.get("search"));return c.correspondentsAvatarFromMessage(a,b)}exports.getImageSrc=k;function l(){var a=this.get("model");return b.PHISHING_ALERT&&a.get("flags.maybe_phishing")}exports.isProbablyPhishing=l;function m(a){if(a===void 0){a=false}var b=this.get("model");var d=j(b,this.get("main-field"),this.get("search"));if(d==="from"){if(this.isProbablyPhishing()){return c.correspondentsEmailsFromMessage(b)}return c.correspondentsFromMessage(b,d,a)}return h.reduce(function(d,e){var f=c.correspondentsFromMessage(b,e,a);if(f){d.push(f)}return d},[]).join(", ")}exports.getCorrespondent=m;function n(){var a=this.get("model");var b=j(a,this.get("main-field"),this.get("search"));var d;if(b==="from"){d=c.getCorrespondentsFromMessage(a).map(function(a){return c.correspondentFull(a)})}else{d=h.reduce(function(b,d){b=b.concat(c.getCorrespondentsFromMessage(a,d).map(function(a){return c.correspondentFull(a)}));return b},[])}if(d.length===0){return i18n("Получатель не указан")}if(d.length<=3){return d.join(", ")}if(d.length>3){var e=d.length-3;d.length=3;return d.join(", ")+" "+i18n("и ещё")+" "+c.correspondentsCount(e)}}exports.getCorrespondentTooltip=n;function o(a){var b=this.get("model");return d.getLocaleDateFull(b.get("date"),a)}exports.getDateTooltip=o;function p(){var a=130;var b=this.getSubject();if(b.length>a){b=b.slice(0,a)+"…"}return b}exports.getSubjectTooltip=p;function q(){var a=this.get("model");var b=a.get("length");return b>1?b:0}exports.getCounter=q;function r(){var a=this.get("model");var b=a.get("transaction_category");var c=a.getFolder();if(b&&!c.isSpam()&&!this.shouldHideTransactionCategory()){return b}return null}exports.getCategory=r;function s(){var a=this.get("model");return a.isHigh()}exports.isImportant=s;function t(){return!this.get("disable-subject")&&(this.getCounter()||this.getCategory()||this.isImportant())}exports.hasBadge=t;function u(){var a=this.get("model");return this.get("search")?a.meta("search_snippet.value"):a.get("snippet")}exports.getSnippetValue=u;function v(){var a=this.get("model");if(!(a instanceof f.default)&&!this.is("search")){return(this.is("in-metathread")?"metathread-":"")+"letter-item:priority-subject:"+this.getSubject()}return(this.is("in-metathread")?"metathread-":"")+"letter-item:subject:"+this.getSubject()}exports.rootQaId=v;function w(a,d){var e;if(a===void 0){a=this.get("model")}try{var f=d||this.get("unsubscribeList");if(!b.LL_UNSUBSCRIBE_NEWSLETTERS||!f||!a.is("flags.unread")){return null}var g=a.get("id");var h=(e=c.getCorrespondentsFromMessage(a,"from"))===null||e===void 0?void 0:e[0];var i=f.find(function(a){return a.id===g&&a.sender===(h===null||h===void 0?void 0:h.email)});return i?h:null}catch(a){return null}}exports.getUnsubscribeSender=w;function x(a){if(a===void 0){a=this.get("model")}var b=this.getUnsubscribeSender(a);if(b){this.broadcast("letter:intersect:viewport",{uid:a.get("id"),sender:b})}}exports.handleIntersectViewport=x;exports.withWelterLetter=a.default.createWelterDecorator(function(a){return __assign(__assign({},a),{minSize:1,maxSize:3,depth:3,tags:{a:30,div:40,span:30},attrs:{className:30,id:30,"data-id":30,"data-draggable-id":30,title:30,href:[333,function(a,b){if(b.tag==="a"){return"/inbox/1:"+a()+":0/?"}}]},enabled:function(a){return a.get("welter")!==false}})},g.withWelter);exports.withWelterLetterPart=a.default.createWelterDecorator(function(a){return __assign(__assign({},a),{tags:{a:20,span:80}})},exports.withWelterLetter)});define("ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview",["exports","feast","feast-mod/file-size","feast-tpl!./list-letter-attach-status-preview.html","mail/Attachment","mail/Message","mail/Thread","service/radars/decorator","service/radars/index","ui-block/attach-icon/attach-icon","ui-block/button2/button2","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item","ui-block/list-letter-common/list-letter-abstract","ui-block/react-async/react-async"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var q=E(a);var r=E(c);var s=E(d);var t=E(e);var u=E(f);var v=E(g);var w=E(h);var x=E(i);var y=E(j);var z=E(k);var A=E(l);var B=E(m);var C=E(n);var D=E(p);function E(a){return a&&a.__esModule?a:{default:a}}var F=q.default.Block.extend((0,o.withWelterLetterPart)((0,v.default)({id:"attach-preview",events:[{name:"attachment-button:expanded",rename:"btn-expanded"},{name:"attachments:openviewer",rename:"openviewer"}],explicit:true})({name:"list-letter-attach-status-preview",rootClassName:"ll-asa",template:r.default,immutable:true,isolate:true,isolateEvents:true,blocks:{ico:A.default,dropdown:z.default,"list-item":C.default,button2:y.default,list:B.default,"react-async":D.default,"attach-icon":x.default},defaults:{model:null,"expand-attachment-dropdown":false,size:null},events:{"attachment-button:expanded":"onAttachmentDropdownExpanded"},getAttachTitle:function a(){return i18n("С вложениями")},attachmentDropdownChange:function a(b){(0,w.default)(["letters_letter-item_attach-preview",b?"open":"close"]);this.set("expand-attachment-dropdown",b)},onAttachmentDropdownExpanded:function a(b){var c=this;b.preventDefault();var d=this.get("model");var e=d instanceof u.default?d.get("expand"):d.id;var f=d.get("folder");t.default.findOne({id:e,folder_id:f}).then(function(){c.set("expand-attachment-dropdown",true)})},getAttachmentSize:function a(c){return(0,b.fileSize)(c.get("size"))},getPreviewSrc:function a(b){return b.getThumbnailUrl(s.default.THUMBNAIL_SIZE_DEFAULT)},getAttachmentItems:function a(){var b=this;var c=this.get("model");var d=c.getAttachmentsList();if(d.length){return d.map(function(a){return{extension:a.getExtension(),title:a.get("name")+" "+b.getAttachmentSize(a),src:b.getPreviewSrc(a),onClick:function d(){var e=c.get("expand");var f=c instanceof u.default?t.default.get(e):c;b.broadcast("attachments:openviewer",{message:f,attachment:a,from:"ll-stst-prvw"})}}})}return[{title:i18n("Файл был удалён")}]}})));F.resetAttachmentDropdown=function(){F.getInstances().forEach(function(a){var b=a.get("expand-attachment-dropdown");if(b){(0,w.default)(["attachment-dropdown","close-expanded"]);a.set("expand-attachment-dropdown",false)}})};exports.default=F});define("feast-tpl!app/feast-tpl!ui-block/list-letter-bait/list-letter-bait.html",["feast"],function(a){return a.smartParse("<a></a>\n","app/feast-tpl!ui-block/list-letter-bait/list-letter-bait.html")});define("feast-tpl!ui-block/list-letter-bait/list-letter-bait.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-bait/list-letter-bait.html"],function(a){return a});define("ui-block/list-letter-bait/list-letter-bait",["exports","feast","feast-tpl!./list-letter-bait.html","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend((0,c.withWelterLetter)({name:"list-letter-bait",template:e.default,immutable:true}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-common/list-letter-abstract-payment-die",["require","exports","default-values","mail/Message","utils/util"],function(require,exports,a,b,c){"use strict";var d;Object.defineProperty(exports,"__esModule",{value:true});exports.shouldShowUniversalPaymentDie=exports.shouldHideTransactionCategory=exports.paymentDieHasPicture=exports.getPaymentDieDisplayMode=exports.removeFolderId=exports.isExpired=exports.SKINS=exports.onceShownMap=void 0;b=__importDefault(b);exports.onceShownMap={};exports.SKINS=b.default.PAYMENT_META_SKINS;var e=function(a){return Date.now()>a*1e3};exports.isExpired=e;var f=function(a,b){return b.some(function(b){return!!a[b]})};var g=(d={},d[exports.SKINS.PROMO]=function(a){return f(a,["description","receiver"])},d[exports.SKINS.DATASET]=function(a){return f(a,["address","period","payer","description"])},d[exports.SKINS.GIBDD]=function(a){var b=f(a,["article_koap_description","violation_place"]);var d=f(a,["car_number","driver_license","CTC","date_violation","receiver"]);var e=c.isPositiveNumber(a.date_deadline);return b&&(d||e)},d[exports.SKINS.MOBILES_PAYMENT]=function(a){return!!(a.phone&&a.recharge_threshold)},d[exports.SKINS.SIMPLE]=function(a){return!!a.comment},d[exports.SKINS.MONETA]=function(a){return!!(a.receipt_data&&a.provider)},d[exports.SKINS.MOS_RU]=function(a){return!!(a.receipt_data&&a.provider)},d);function h(a){return a.replace(/:\d+$/,"")}exports.removeFolderId=h;function i(b,c,d,e,f){if(b===void 0){b=this.get("model")}if(c===void 0){c=this.get("hidden-payment-dies")}if(d===void 0){d=this.get("pony-mode")}if(e===void 0){e=this.get("search")}if(f===void 0){f=this.is("in-thread")}if(e||f||!a.SHOW_LIST_LETTER_PAYMENT_DIES||a.LIST_LETTER_PAYMENT_DIES_CLOSEABLE&&c[h(b.id)]===""){return"none"}try{var i=b.getPaymentMeta();if(!i||i.skin===exports.SKINS.UNIVERSAL){return"none"}return g[i.skin](i)&&!d?"full":"compact"}catch(a){return"none"}}exports.getPaymentDieDisplayMode=i;function j(){var b=this.get("model").getPaymentMeta();var c=this.get("layout-mode")==="2pane";var d=!!(b.skin===exports.SKINS.PROMO&&b.preview_image);var e=!!(a.LIST_LETTER_PAYMENT_DIES_GMAP&&b.skin===exports.SKINS.GIBDD&&b.latitude&&b.longitude);return c&&(d||e)}exports.paymentDieHasPicture=j;function k(){var a=this,b=a.meta,c=a["in-thread"];if(!b){return false}return c||this.getPaymentDieDisplayMode()==="full"&&!j.call(this)&&!(b.skin===exports.SKINS.MOBILES_PAYMENT&&b.provider_logo)}exports.shouldHideTransactionCategory=k;function l(b,c){if(b===void 0){b=this.get("model")}if(c===void 0){c=this.is("in-thread")}try{var d=b.getPaymentMeta();if(!d||!a.PAYMENT_LETTER_UNIVERSAL){return false}return!c&&d.skin===exports.SKINS.UNIVERSAL}catch(a){return false}}exports.shouldShowUniversalPaymentDie=l});define("feast-tpl!app/feast-tpl!ui-block/list-letter-common/list-letter-common.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n\ta11y:tooltip-direction="letter-bottom"\n>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\t<fn:var name="paymentDieDisplayMode" value="{_this.getPaymentDieDisplayMode()}" />\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}"/>\n\n\t<fn:var name="metadata" value="{_this.getTransactionMetadata()}" />\n\t<fn:var name="showOrder" value="{_this.showOrder(attrs.model, metadata)}" />\n\t<fn:var name="unsubscribeSender" value="{_this.getUnsubscribeSender()}" />\n\t<fn:var name="showUniversalDie" value="{_this.shouldShowUniversalPaymentDie()}" />\n\t<fn:var name="showUnsubscribe" value="{unsubscribeSender && !showUniversalDie && !showOrder && !metadata && (paymentDieDisplayMode === \'none\')}" />\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}" test="attrs.href"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-uidl-id" value="{data.get(\'last\')}"/>\n\t\x3c!-- TODO: выяснить зачем это нужно, в dom этого нет --\x3e\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="ponyMode"\n\t/>\n\n\t<bem:mod\n\t\tname="has-indent"\n\t\ttest="attrs[\'indent\']"\n\t/>\n\n\t<bem:mod\n\t\tname="normal"\n\t\ttest="!attrs[\'indent\']"\n\t/>\n\n\t<bem:mod\n\t\tname="active"\n\t\ttest="attrs.selected"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<bem:mod name="reliable" test="_this.checkOfficialGreen(attrs.model) && attrs.isThreadWithReliableMark"/>\n\t<bem:mod name="official" test="_this.checkImportantReliable(attrs.model) && attrs.isThreadWithReliableMark"/>\n\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Read status:Start --\x3e\n\t<div bem:elem="read-status" qa:id="unread">\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t<b:read-status\n\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\tmodel="{data}"\n\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t/>\n\t</div>\n\t\x3c!-- Read status:End --\x3e\n\n\t\x3c!-- Avatar:Start --\x3e\n\t<div bem:elem="avatar" qa:id="avatar">\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t<b:avatar\n\t\t\t\tcentered\n\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\tdisable-hover="{attrs[\'disable-avatar-hover\']}"\n\t\t\t\tdisable-select="{attrs[\'disable-select\']}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tstate="{attrs.selected}"\n\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\tpriority="{attrs[\'priority\']}"\n\t\t\t\tlight-priority="{attrs[\'priority\'] && ponyMode}"\n\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t/>\n\t</div>\n\t\x3c!-- Avatar:End --\x3e\n\n\t\x3c!-- Container:Start --\x3e\n\t<div bem:elem="container">\n\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content">\n\t\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t<div bem:elem="item">\n\t\t\t\t<bem:mod name="correspondent"/>\n\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t<b:correspondent\n\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t\ttitle="{_this.getCorrespondentTooltip()}"\n\t\t\t\t\tdangerous="{_this.isProbablyPhishing()}"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t<div bem:elem="item" qa:id="flagged">\n\t\t\t\t<bem:mod name="flag"/>\n\n\t\t\t\t<b:flag-status\n\t\t\t\t\tstate="{data.is(\'flags.flagged\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t>\n\t\t\t\t<bem:mod name="badge"/>\n\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\x3c!-- Title:Start --\x3e\n\t\t\t<div bem:elem="item" ref="title">\n\t\t\t\t<bem:mod name="title"/>\n\n\t\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="subject"\n\t\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t\t<b:subject\n\t\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="snippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\n\t\t\t\t\t<b:snippet\n\t\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\t\x3c!-- Это, чтобы не показывать тултип в Safari --\x3e\n\t\t\t\t<div></div>\n\t\t\t</div>\n\t\t\t\x3c!-- Title:End --\x3e\n\n\t\t\t\x3c!-- PaymentButton:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="paymentDieDisplayMode === \'compact\'">\n\t\t\t\t<b:payment-button\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tstandalone\n\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\tpony-mode="{attrs[\'pony-mode\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- PaymentButton:End --\x3e\n\n\t\t\t\x3c!--- Unsubscribe: Start --\x3e\n\t\t\t<b:unsubscribe\n\t\t\t\tfn:if="showUnsubscribe"\n\t\t\t\tlayout-mode="2pane"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tunsubscribeSender="{unsubscribeSender}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\t/>\n\t\t\t\x3c!--- Unsubscribe: End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="attrs.showfolder">\n\t\t\t\t<bem:mod name="folder"/>\n\t\t\t\t<fn:var name="folder" value="{data.getFolder()}"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{data.get(\'send_date\') | scheduleDate}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{folder.get(\'name\')}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Folder:End --\x3e\n\n\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t<fn:if test="!attrs[\'disable-attach\']">\n\t\t\t\t<div bem:elem="item">\n\t\t\t\t\t<bem:mod name="attach-status"/>\n\n\t\t\t\t\t<b:attach-status\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tfn:if="data.is(\'flags.attach\')"\n\t\t\t\t\t\tuse:mediator="attachments-manager pony-mode"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\x3c!-- Schedule:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="!attrs.showfolder && data.isSchedule()">\n\t\t\t\t<b:schedule-status\n\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<fn:var name="isSchedule" value="{!!data.isSchedule()}" />\n\t\t\t<fn:var name="letterDate" value="{_this.letterDate(data.get(\'date\'), isSchedule)}" />\n\t\t\t<div bem:elem="item" title="{_this.getDateTooltip(isSchedule)}" qa:id="time:{letterDate}">\n\t\t\t\t<bem:mod name="date" />\n\t\t\t\t{letterDate}\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\n\t\t\x3c!-- PaymentDie:Start --\x3e\n\t\t<div bem:elem="payment-die-container" fn:if="paymentDieDisplayMode === \'full\'">\n\t\t\t<b:payment-die\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tlayout-mode="2pane"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- PaymentDie:End --\x3e\n\n\t\t\x3c!-- SearchAttaches:Start --\x3e\n\t\t<fn:var name="searchAttaches" value="{_this.getSearchAttaches()}"/>\n\t\t<fn:var name="allAttaches" value="{_this.getAllAttaches()}"/>\n\t\t<fn:var\n\t\t\tname="attachesModes"\n\t\t\tvalue="{_this.getAttachesModes(false, allAttaches, searchAttaches)}"\n\t\t/>\n\t\t<fn:var\n\t\t\tname="attachesList"\n\t\t\tvalue="{_this.getAttaches(attachesModes, allAttaches, searchAttaches).attachesList}"\n\t\t/>\n\n\t\t<fn:var\n\t\t\tname="moreAttachesList"\n\t\t\tvalue="{_this.getAttaches(attachesModes, allAttaches, searchAttaches).moreAttachesList}"\n\t\t/>\n\n\t\t<b:preview-attaches\n\t\t\tfn:if="attachesList && allAttaches"\n\t\t\tremit:attach="previewattach"\n\t\t\tremit:more="previewattach"\n\t\t\tremit:moreinvalid="openletter"\n\t\t\tmodel="{attrs.model}"\n\t\t\tattaches-list="{attachesList}"\n\t\t\tmore-attaches-list="{moreAttachesList}"\n\t\t\tlayout-mode="2pane"\n\t\t\tall-count="{allAttaches.length}"\n\t\t\tvertical="{attachesModes.vertical}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t/>\n\t\t\x3c!-- SearchAttaches:End --\x3e\n\n\t\t\x3c!-- AttachesPreview:Start --\x3e\n\t\t<fn:var name="messagesAttaches" value="{attrs.messagesAttaches}"/>\n\t\t<fn:var name="showAttaches" value="{attrs[\'show-attaches\'] && _this.getAttachesPreviewCondition()}"/>\n\n\t\t<fn:var\n\t\t\tname="attachesModes"\n\t\t\tvalue="{_this.getAttachesModes(false, messagesAttaches)}"\n\t\t/>\n\n\t\t<fn:var\n\t\t\tname="attachesForRender"\n\t\t\tvalue="{_this.getAttaches(attachesModes, messagesAttaches)}"\n\t\t/>\n\n\t\t<fn:if test="showAttaches">\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="messagesAttaches">\n\t\t\t\t\t<b:preview-attaches\n\t\t\t\t\t\tfn:if="messagesAttaches"\n\t\t\t\t\t\tremit:attach="previewattach"\n\t\t\t\t\t\tremit:more="previewattach"\n\t\t\t\t\t\tremit:moreinvalid="openletter"\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tattaches-list="{attachesForRender.attachesList}"\n\t\t\t\t\t\tmore-attaches-list="{attachesForRender.moreAttachesList}"\n\t\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\t\tall-count="{messagesAttaches.length}"\n\t\t\t\t\t\tvertical="{attachesModes.vertical}"\n\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\x3c!-- Заглушка, пока аттачи не загрузились --\x3e\n\t\t\t\t\t<b:stub\n\t\t\t\t\t\tattachesCount="{data.get(\'attachments_count\')}"\n\t\t\t\t\t\tisCompact="{false}"\n\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:if>\n\t\t\x3c!-- AttachesPreview:End --\x3e\n\n\t\t\x3c!-- ListLetterOrder:Start --\x3e\n\t\t<b:order\n\t\t\tfn:if="metadata && showOrder"\n\t\t\tuse:mediator="orders-manager"\n\t\t\tmetadata="{metadata}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t/>\n\t\t\x3c!-- ListLetterOrder:End --\x3e\n\n\t\t\x3c!-- ListLetterPaymentUniversalDie:Start --\x3e\n\t\t<b:payment-universal-die\n\t\t\tfn:if="showUniversalDie"\n\t\t\tmodel="{attrs.model}"\n\t\t\tlayout-type="{attrs[\'layout-type\']}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t/>\n\t\t\x3c!-- ListLetterPaymentUniversalDie:End --\x3e\n\t</div>\n\t\x3c!-- Container:End --\x3e\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter ponymode="{ponyMode}" indent="{attrs.indent}" last/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-common/list-letter-common.html")});define("feast-tpl!ui-block/list-letter-common/list-letter-common.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-common/list-letter-common.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/radar-utils",["require","exports","data-source/utils/actual-letters"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getModelDataWithRelevant=exports.getLetterData=exports.getModelData=exports.renameRadarOnStatusToggle=void 0;function b(a,b){var c=a.get("model");var d=!c.is("flags."+b);return"toggle_"+b+"_"+d}exports.renameRadarOnStatusToggle=b;function c(a){var b=a.get("model");return{id:b&&b.id,model:b}}exports.getModelData=c;function d(a){var b=a.get("letter");return{id:a.get("letter-id")||b&&b.id,model:b}}exports.getLetterData=d;function e(b){var c;var d=b.get("router");var e=b.get("model");return __assign({id:e&&e.id,model:e,show_relevant:+a.isActualLettersEnabledInFolder(d,(c=e===null||e===void 0?void 0:e.getFolder)===null||c===void 0?void 0:c.call(e),e===null||e===void 0?void 0:e.get("flags.newsletter")),priority:+e.get("flags.is_relevant"),folder_id:e.get("folder")},e.get("actual_probability")&&{ml_model:e.get("actual_probability").split(":")[0]})}exports.getModelDataWithRelevant=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/emoji",["require","exports","@mail-core/dashboard","default-values","twemoji"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.emojiFallback=void 0;c=__importDefault(c);var d={base:"https://img.imgsmail.ru/hb/e.mail.ru/static/",folder:"emoji",ext:".svg",className:"emoji",attributes:function(){return{"data-type":"emoji-icon-fallback"}},callback:function(a,b){var c=b.base,d=b.size,e=b.ext;return""+c+d+"/"+a+e}};var e={parse:function(a){if(!a){return""}return c.default.parse(a,d)},selector:'[data-type="emoji-icon-fallback"]'};var f=function(c,d){if(b.EMOJI_FALLBACK&&c){a.userKeeper.time("emoji-fallback");e.parse(c);a.userKeeper.timeEnd("emoji-fallback",{appendix:d})}};exports.emojiFallback=f;exports.default=e});define("feast-tpl!app/feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html",["feast"],function(a){return a.smartParse('<button remit:click="click:btn" qa:id="selected:{!!attrs.state}">\n\t\x3c!-- не заменять button на span, он нужен чтобы фокус попадал в него и при снятии выделения с письма - фокус тоже уходил --\x3e\n\n\t<bem:mod name="is-active" test="attrs.state" />\n\t<bem:mod name="size_{attrs.size}" />\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']" />\n\t<bem:mod name="disabled" test="attrs[\'disable-select\']" />\n\t<bem:mod name="centered" test="attrs.centered" />\n\t<bem:mod name="priority" test="attrs.priority" />\n\t<bem:mod name="light-priority" test="attrs[\'light-priority\']" />\n\n\t<div bem:elem="container" qa:id="touch:{!!attrs.touch}">\n\t\t\x3c!-- Чекбокс на тач устройствах --\x3e\n\t\t<bem:mod name="touch" test="attrs[\'touch\']" />\n\n\t\t<fn:var name="checked" value="{attrs.state}" />\n\t\t<span bem:elem="checkbox" fn:if="!attrs[\'touch\']">\n\t\t\t\x3c!-- disabled в чекбоксе потому что рулим его состоянием сверху --\x3e\n\t\t\t<b:checkbox checked="{checked}" disabled />\n\t\t</span>\n\n\t\t<div bem:elem="img-container">\n\t\t\t<span bem:elem="img" style="{_this.getImgSrc()}" />\n\t\t\t<fn:if test="_this.checkReliable(attrs.model) && attrs.isThreadWithReliableMark">\n\t\t\t\t<span bem:elem="reliable-icon" bem:mod="size_common">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{attrs[\'dark-mode\'] ? \'STATUS_RELIABLE_SENDER_DARK\' : \'STATUS_RELIABLE_SENDER_LIGHT\'}"\n\t\t\t\t\t\tdata-test-id="reliable-icon"\n\t\t\t\t\t\tremove-fill="{false}"\n\t\t\t\t\t\tsize="original"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="_this.checkOfficial(attrs.model) && attrs.isThreadWithReliableMark">\n\t\t\t\t<span bem:elem="official-icon" bem:mod="size_common">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{attrs[\'dark-mode\'] ? \'STATUS_OFFICIAL_SENDER_DARK\' : \'STATUS_OFFICIAL_SENDER_LIGHT\'}"\n\t\t\t\t\t\tdata-test-id="official-icon"\n\t\t\t\t\t\tremove-fill="{false}"\n\t\t\t\t\t\tsize="original"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\t\t</div>\n\t</div>\n</button>\n',"app/feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html")});define("feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/checkbox/checkbox.html",["feast"],function(a){return a.smartParse('<div qa:id="checkbox">\n\t<label bem:elem="label">\n\t\t<input\n\t\t\ttype="checkbox"\n\t\t\tbem:elem="input"\n\t\t\tremit:change="toggle"\n\t\t/>\n\n\t\t<fn:var name="state" value="{attrs.checked ? \'checked\' : attrs.disabled ? \'disabled\' : \'base\'}"/>\n\n\t\t<div\n\t\t\tbem:elem="box"\n\t\t\tqa:id="box:{state}"\n\t\t>\n\t\t\t<bem:mod name="checked" test="attrs.checked"/>\n\t\t\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t\t\t<b:ico name="checked"/>\n\t\t</div>\n\t\t<div\n\t\t\tbem:elem="text"\n\t\t\tfn:if="attrs.label"\n\t\t>\n\t\t\t{attrs.label}\n\t\t</div>\n\t</label>\n</div>\n',"app/feast-tpl!ui-block/checkbox/checkbox.html")});define("feast-tpl!ui-block/checkbox/checkbox.html",["feast-tpl!app/feast-tpl!ui-block/checkbox/checkbox.html"],function(a){return a});define("ui-block/checkbox/checkbox",["exports","feast","feast-tpl!./checkbox.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"checkbox",template:e.default,blocks:{ico:f.default},defaults:{checked:false,disabled:false,label:""},events:{toggle:"onToggle"},onToggle:function a(){if(!this.is("disabled")){this.invert("checked");this.broadcast("toggle-checkbox")}}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-avatar/list-letter-avatar",["require","exports","default-values","feast","feast-tpl!./list-letter-avatar.html","helpers/letter","ui-block/checkbox/checkbox","ui-block/list-letter-common/list-letter-abstract"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);exports.default=b.default.Block.extend(f.withWelterLetterPart({name:"list-letter-avatar",rootClassName:"ll-av",template:c.default,immutable:true,isolate:true,blocks:{checkbox:e.default},events:{"click:btn":"onClick"},defaults:{"disable-select":false,"disable-hover":false,"img-src":a.DEFAULT_AVATAR_SRC,indent:false,size:"common",state:false,priority:false,"light-priority":false,isThreadWithReliableMark:a.THREAD_WITH_RELIABLE_MARK},didMount:function(){this.el.classList.add("stop-animate")},onClick:function(a){if(!this.is("disable-select")){a.stopPropagation();this.broadcast("toggle",this,a)}},getImgSrc:function(){return'background-image: url("'+(this.get("img-src")||a.DEFAULT_AVATAR_SRC)+'");'},checkReliable:d.checkReliable,checkOfficial:d.checkOfficial}))});define("feast-mod/list-counter-format",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a;function a(a){if(!a){return 0}return a>99?"99+":a}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-badge/list-letter-badge.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="unread" test="attrs.unread"/>\n\t<fn:var\n\t\tname="text"\n\t\tvalue="{attrs.counter | formatCounter}"\n\t\ttest="attrs.counter > 1"\n\t/>\n\t<fn:choose>\n\t\t<fn:when test="attrs.compact">\n\t\t\t<fn:if test="attrs.important">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="important"\n\t\t\t\t\tshort\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs.category || text">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="{attrs.category}"\n\t\t\t\t\tshort="{!text}"\n\t\t\t\t\ttext="{text}"\n\t\t\t\t\tpromoid="{text ? \'thread-badge\' : \'\'}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:when>\n\t\t<fn:otherwise>\n\t\t\t<fn:if test="attrs.category || text">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="{attrs.category}"\n\t\t\t\t\tshort="{!text}"\n\t\t\t\t\ttext="{text}"\n\t\t\t\t\tpromoid="{text ? \'thread-badge\' : \'\'}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs.important">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="important"\n\t\t\t\t\tshort\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</div>\n',"app/feast-tpl!ui-block/list-letter-badge/list-letter-badge.html")});define("feast-tpl!ui-block/list-letter-badge/list-letter-badge.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-badge/list-letter-badge.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/letter-category/letter-category.html",["feast"],function(a){return a.smartParse('<div\n\tqa:id="category:{attrs.name}"\n\tpromo:id="{attrs.promoid || \'\'}"\n>\n\t<bem:mod name="{attrs.name}"/>\n\n\t<b:badge\n\t\ttransparent="{attrs.flat}"\n\t\ttext="{_this.getText()}"\n\t\ttitle="{_this.getTitle()}"\n\t\tico="{_this.getIco()}"\n\t\tshort="{attrs.short}"\n\t\tsize="{attrs.size || \'l\'}"/>\n</div>\n',"app/feast-tpl!ui-block/letter-category/letter-category.html")});define("feast-tpl!ui-block/letter-category/letter-category.html",["feast-tpl!app/feast-tpl!ui-block/letter-category/letter-category.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/badge/badge.html",["feast"],function(a){return a.smartParse('<span title="{attrs.title}">\n\t<fn:var name="short" value="{!attrs.text || attrs.short}"/>\n\n\t<bem:mod name="size" value="{attrs.size || \'m\'}"/>\n\t<bem:mod name="strong" test="attrs.strong"/>\n\t<bem:mod name="ico" test="attrs.ico"/>\n\t<bem:mod name="android" test="attrs.android"/>\n\n\t<bem:mod name="secondary" test="attrs.secondary"/>\n\t<bem:mod name="short" test="!attrs.text || attrs.short"/>\n\t<bem:mod name="square" test="attrs.square === void 0 ? short : short && attrs.square"/>\n\t<bem:mod name="transparent" test="attrs.transparent"/>\n\n\t<span bem:elem="ico" fn:if="attrs.ico">\n\t\t<b:ico name="{attrs.ico}"/>\n\t</span>\n\t<fn:if test="attrs.text && !attrs.short">\n\t\t<span bem:elem="text" qa:id="badge-text">{attrs.text}</span>\n\t</fn:if>\n</span>\n',"app/feast-tpl!ui-block/badge/badge.html")});define("feast-tpl!ui-block/badge/badge.html",["feast-tpl!app/feast-tpl!ui-block/badge/badge.html"],function(a){return a});define("ui-block/badge/badge",["exports","feast","feast-tpl!./badge.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"badge",template:e.default,blocks:{ico:f.default},defaults:{android:navigator.userAgent.match(/Android/i),transparent:false}})});define("feast-tpl!app/feast-tpl!ui-block/ico-map/ico-map.html",["feast"],function(a){return a.smartParse("<div />","app/feast-tpl!ui-block/ico-map/ico-map.html")});define("feast-tpl!ui-block/ico-map/ico-map.html",["feast-tpl!app/feast-tpl!ui-block/ico-map/ico-map.html"],function(a){return a});define("ui-block/ico-map/ico-map",["exports","feast","feast-tpl!./ico-map.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.transactionsMap=undefined;var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=exports.transactionsMap={order:{ico:"orders",text:i18n("Заказы")},travel:{ico:"travel",text:i18n("Путешествия")},finance:{ico:"currency-ruble",text:i18n("Финансы")},registration:{ico:"auth",text:i18n("Учётные записи")},event:{ico:"tickets",text:i18n("Билеты")},fees:{ico:"fees",text:i18n("Штрафы и налоги")},important:{ico:"important",text:i18n("Важное")},more:{ico:"more-hor",text:i18n("Ещё")},unread:{ico:"point",text:i18n("Непрочитанные")},flagged:{ico:"flag",text:i18n("Помеченные флажком")},attach:{ico:"attach",text:i18n("С вложениями")}};exports.default=c.default.Block.extend({name:"ico-map",template:d.default,blocks:{}})});define("ui-block/letter-category/letter-category",["exports","feast","feast-tpl!./letter-category.html","ui-block/badge/badge","ui-block/ico-map/ico-map"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"letter-category",template:f.default,blocks:{badge:g.default},defaults:{name:"default",title:"",ico:""},getIco:function a(){var b=d.transactionsMap[this.get("name")];return b&&b.ico},getText:function a(){var b=d.transactionsMap[this.get("name")];return this.get("text")||b&&b.text},getTitle:function a(){var b=d.transactionsMap[this.get("name")];return b&&b.text}})});define("ui-block/list-letter-badge/list-letter-badge",["exports","feast","feast-mod/list-counter-format","feast-tpl!./list-letter-badge.html","ui-block/letter-category/letter-category"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"list-letter-badge",rootClassName:"ll-b",template:g.default,immutable:true,isolate:true,isolateEvents:true,blocks:{"letter-category":h.default},defaults:{category:null,important:false,counter:0,compact:false,unread:false},mods:{formatCounter:f.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{attrs.title}"\n\tqa:state="{attrs.dangerous ? \'dangerous\' : \'\'}"\n\tqa:id="{attrs[\'qa-id\']}"\n>\n\t<bem:mod name="dangerous" test="attrs.dangerous"/>\n\n\t{attrs.state | correspondent}\n</span>\n',"app/feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html")});define("feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-correspondent/list-letter-correspondent",["require","exports","feast","feast-mod/correspondents","feast-tpl!./list-letter-correspondent.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);exports.default=a.default.Block.extend({name:"list-letter-correspondent",rootClassName:"ll-crpt",template:c.default,immutable:true,isolate:true,isolateEvents:true,defaults:{state:"",dangerous:false},mods:{correspondent:b.correspondent}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html",["feast"],function(a){return a.smartParse('<button\n\ttype="button"\n\tremit:click.stop="toggle"\n\tqa:id="flagged:{attrs.state}"\n\ttitle="{_this.getTitle()}"\n\tdisabled="{attrs[\'disable-hover\']}"\n>\n\t<bem:mod name="is-active" test="attrs.state"/>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\n\t<span bem:elem="icon">\n\t\t<b:ico name="{attrs.state ? \'actions:favorite_on\' : \'actions:favorite_off\'}"/>\n\t</span>\n</button>\n',"app/feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html")});define("feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html"],function(a){return a});define("ui-block/list-letter-flag-status/list-letter-flag-status",["exports","feast","feast-tpl!./list-letter-flag-status.html","ui-block/ico/ico","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,d.withWelterLetterPart)({name:"list-letter-flag-status",rootClassName:"ll-fs",template:f.default,immutable:true,isolate:true,blocks:{ico:g.default},defaults:{state:false,"disable-hover":false},notVisualAttributes:{model:true,"disable-hover":true},getTitle:function a(){return this.get("state")?i18n("Снять флажок"):i18n("Пометить флажком")}}))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-folder/list-letter-folder.html",["feast"],function(a){return a.smartParse('<div title="{attrs.title}">\n\t{attrs.text}\n</div>\n\n',"app/feast-tpl!ui-block/list-letter-folder/list-letter-folder.html")});define("feast-tpl!ui-block/list-letter-folder/list-letter-folder.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-folder/list-letter-folder.html"],function(a){return a});define("ui-block/list-letter-folder/list-letter-folder",["exports","feast","feast-tpl!./list-letter-folder.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"list-letter-folder",rootClassName:"ll-f",template:d.default,isolate:true,isolateEvents:true,defaults:{title:"",text:""}})});define("ui-block/list-letter-order/list-letter-abstract-order",["require","exports","feast-mod/correspondents","../../default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.showOrder=exports.getTransactionMetadata=void 0;function c(a,b){if(a===void 0){a=this.get("model")}if(b===void 0){b=this.get("search")}if(!b&&a){var c=a.get("transaction_metadata");return c?c.getAttributes():null}}exports.getTransactionMetadata=c;function d(c,d){var e,f;if(!d||!c){return false}var g=(f=(e=a.getCorrespondentsFromMessage(c))===null||e===void 0?void 0:e[0])===null||f===void 0?void 0:f.email;if(!b.TRANSACTION_HEADER||typeof g!=="string"){return false}var h=Object.values(b.TRANSACTION_HEADER).find(function(a){return a.shops.some(function(a){return new RegExp(a).test(g)})});return b.LIST_LETTER_ORDER&&h&&!!(d&&d.item_list&&d.item_list.length)}exports.showOrder=d});define("feast-tpl!app/feast-tpl!ui-block/list-letter-order/list-letter-order.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-orders">\n\t<fn:var name="linkValue" value="{_this.getOrderLink()}"/>\n\t<fn:var name="linkText" value="{linkValue && _this.getLinkText()}"/>\n\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\n\t<span bem:elem="items">\n\t\t{_this.getItems()}\n\t</span>\n\n\t<b:link\n\t\tqa:id="ll-orders-link"\n\t\tfn:if="linkValue"\n\t\tremit:click.prevent="clicklink"\n\t\tevent:details="{url: linkValue}"\n\t\tuse:mediator="orders-manager"\n\t\ttext="{linkText}"\n\t\thref="{linkValue}"\n\t\ttarget="_blank"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-order/list-letter-order.html")});define("feast-tpl!ui-block/list-letter-order/list-letter-order.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-order/list-letter-order.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/link/link.html",["feast"],function(a){return a.smartParse('<a remit:click="click-radar">\n\t<fn:attr name="href" value="{attrs.href}" test="attrs.href"/>\n\t<fn:attr name="target" value="{attrs.target}" test="attrs.target"/>\n\t<fn:attr name="rel" value="noopener noreferer" test="!attrs.unsafe"/>\n\n\t<bem:mod name="contrast" test="attrs.contrast" />\n\t<bem:mod name="hovered" test="attrs.hovered" />\n\t<bem:mod name="disabled" test="attrs.disabled" />\n\t<bem:mod name="secondary" test="attrs.secondary" />\n\t{attrs.text}</a>\n',"app/feast-tpl!ui-block/link/link.html")});define("feast-tpl!ui-block/link/link.html",["feast-tpl!app/feast-tpl!ui-block/link/link.html"],function(a){return a});define("ui-block/link/link",["exports","feast","feast-tpl!./link.html","service/radars/decorator"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend((0,f.default)({events:["click-radar"]})({name:"link",template:e.default,defaults:{disabled:false,hovered:false,href:null,target:null,text:"",unsafe:false,secondary:false},blocks:{}}))});define("ui-block/list-letter-order/list-letter-order",["exports","feast","feast-tpl!./list-letter-order.html","service/radars/index","ui-block/link/link"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var j={orderHref:i18n("Перейти к заказу"),shopHref:i18n("Перейти в магазин")};exports.default=e.default.Block.extend({name:"list-letter-order",rootClassName:"ll-order",template:f.default,blocks:{link:h.default},didMount:function a(){(0,g.default)("list_letter_order_show")},getItems:function a(){var b=this.get("metadata"),c=b.item_list;var d=c.length;var e="";c.forEach(function(a,b){var c=a.name;if(c){e+=b<d-1?c+", ":""+c}});return e},getOrderLink:function a(){var b=this.get("metadata"),c=b.order_href,d=b.order_list_href;return c||d},getLinkText:function a(){return this.get("metadata").order_href?j.orderHref:j.shopHref}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html",["feast"],function(a){return a.smartParse('<div on-click="_this.handleClick(evt)" qa:id="{_this.getQaId()}">\n\t<fn:var name="meta" value="{attrs.model.getPaymentMeta()}" />\n\t<bem:mod name="default-size" test="attrs.standalone && (attrs[\'layout-mode\'] === \'2pane\') && !attrs[\'pony-mode\']" />\n\n\t<bem:mod name="{meta.status}" test="meta && meta.status" />\n\t<bem:mod name="bold" test="attrs[\'pony-mode\']" />\n\t<bem:mod name="oneline" test="attrs.oneline" />\n\n\t<span>\n\t\t{_this.getTitle()}\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html")});define("feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html"],function(a){return a});define("helpers/add-merchant-param",["exports","@mail/xray"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a,c){var d=void 0;try{d=new URL(a)}catch(c){b.default.send("merchant_parse_error_oct");return a}var e=d.searchParams.get("data");if(!e){e="{}"}var f=void 0;try{f=JSON.parse(e)}catch(c){b.default.send("merchant_parse_error_oct");return a}if(!f.merchant_param){f.merchant_param={}}Object.keys(c).forEach(function(a){f.merchant_param[a]=c[a]});var g=JSON.stringify(f);d.searchParams.set("data",g);return d.href}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/getFeaturesStringByPrefix",["require","exports","@mail/features"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=function(b){return Object.keys(a.default.list).filter(function(a){return a.startsWith(b)}).map(function(b){var c=a.default.getAsString(b);var d=!a.default.has(b);if(d){return"-"+b}else{return""+b+(c?":"+c:"")}}).join(" ")}});define("helpers/opener",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(b){var c;var d="_blank";if(a.USE_SINGLE_TAB&&(a.USE_SINGLE_TAB_WHITELIST_REGEXP===null||a.USE_SINGLE_TAB_WHITELIST_REGEXP===void 0?void 0:a.USE_SINGLE_TAB_WHITELIST_REGEXP.test(b))&&!(a.USE_SINGLE_TAB_BLACKLIST_REGEXP===null||a.USE_SINGLE_TAB_BLACKLIST_REGEXP===void 0?void 0:a.USE_SINGLE_TAB_BLACKLIST_REGEXP.test(b))){d="_self"}if(a.URL_EXTRA_PARAMS){var e=new URL(b,window.location.origin);for(var f=0,g=Object.entries(a.URL_EXTRA_PARAMS);f<g.length;f++){var h=g[f],i=h[0],j=h[1];e.searchParams.append(i,j===null||j===void 0?void 0:j.toString())}b=e.toString()}if(a.IS_CHROME){window.open(b,d,"toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes, noopener=true")}else{c=window.open(b,d);if(c){c.focus()}if(c){c.opener=null}}}exports.default=b});define("helpers/payment",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MERCHANT_TYPES=exports.MESSAGE_TYPES=exports.PaymentStatus=void 0;var a;(function(a){a["awaiting"]="awaiting";a["success"]="success";a["error"]="error"})(a=exports.PaymentStatus||(exports.PaymentStatus={}));exports.MESSAGE_TYPES={CHANGE_PAYMENT_STATUS:"CHANGE_PAYMENT_STATUS",PAYMENT_IN_PROGRESS:"PAYMENT_IN_PROGRESS",FINISH_GROUP_FINE_PAY:"FINISH_GROUP_FINE_PAY"};exports.MERCHANT_TYPES={MONETA:"moneta"}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-payment-button/list-letter-payment-button",["require","exports","data-source/actions","default-values","feast","feast-tpl!./list-letter-payment-button.html","helpers/add-merchant-param","helpers/data-source-dispatch","helpers/getFeaturesStringByPrefix","helpers/object-to-query","helpers/opener","helpers/payment","helpers/querystring","service/layer","service/radars/index","service/storage","ui-block/list-letter-common/list-letter-abstract-payment-die","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);exports.default=c.default.Block.extend({name:"list-letter-payment-button",rootClassName:"ll-pb",template:d.default,immutable:true,isolate:true,isolateEvents:true,blocks:{},defaults:{},mods:{},constructor:function(){c.default.Block.apply(this,arguments);this.onPostMessage=this.onPostMessage.bind(this)},didMount:function(){var a=this.get("model").id;if(!this.is("standalone")||o.onceShownMap.hasOwnProperty(a)){return}o.onceShownMap[a]="";var b=this.get("model").getPaymentMeta(),c=b.skin,d=b.merchant_id;m.default({type:"ll-pd-show-"+c,dwh:{uidl:a,displayMode:"compact",layoutMode:this.get("layout-mode"),ponyMode:this.is("pony-mode"),merchantId:d}})},getTitle:function(){var a=this.get("model").getPaymentMeta();switch(a.status){case j.PaymentStatus.awaiting:return i18n("Идёт оплата");case j.PaymentStatus.success:return i18n("Оплачено")}switch(a.skin){case o.SKINS.SIMPLE:return i18n("Помочь");case o.SKINS.MOBILES_PAYMENT:return i18n("Пополнить");case o.SKINS.GIBDD:var b=a.date_deadline_discount,c=a.amount,d=a.amount_with_discount;var e=p.isNumber(b)&&!o.isExpired(b)&&p.isPositiveNumber(d);var f=e?d:c;return i18n("Оплатить {amount} ₽",{amount:f.replace(".",",")});default:if(!a.amount){return i18n("Оплатить")}return i18n("Оплатить {amount} ₽",{amount:a.amount.replace(".",",")})}},onPostMessage:function(b){var c=b.details,d=c.message,e=c.layer;if(d.m_type==="iframeClose"){e.broadcast("layer:close")}var g=this.get("model");var h=g.getPaymentMeta();if(h.skin===o.SKINS.GIBDD){if(d.type===j.MESSAGE_TYPES.PAYMENT_IN_PROGRESS&&d.status==="loading"){n.default.set("fines_shapshot",null)}if(d.type===j.MESSAGE_TYPES.FINISH_GROUP_FINE_PAY){f.default({type:a.UPDATE_ALL})}}if(d.type!==j.MESSAGE_TYPES.CHANGE_PAYMENT_STATUS){return}g.setPaymentMeta(__assign(__assign({},h),{status:d.status}));m.default({type:"ll-pb-status-change-"+h.skin,dwh:{uidl:this.get("model").id}})},handleClick:function(a){var c=this.get("model").getPaymentMeta(),d=c.skin,e=c.payment_url,f=c.status,g=c.merchant_id;if([j.PaymentStatus.awaiting,j.PaymentStatus.success].includes(f)){return}a.preventDefault();var h=this.get("model").id;switch(d){case o.SKINS.MONETA:var k={dimmer:true,from:"list"};var n=b.LAYER_IFRAME_PARAMS[o.SKINS.MONETA]||{};var p=this._modifyPaymentUrl(e);l.default.open("moneta",__assign({url:p},n),k);break;case o.SKINS.MOS_RU:i.default(e);break;default:var q=d===o.SKINS.GIBDD?"gibdd_group":d;l.default.openIframeLayer({paramsKey:q,additionalParams:{url:this._modifyPaymentUrl(e)},factoryParams:{"close-on-esc":true},onPostMessage:this.onPostMessage})}var r=d===o.SKINS.GIBDD?"_gd-exp":"";m.default({type:"ll-pb-click-"+d+r,dwh:{uidl:h,displayMode:this.is("standalone")?"compact":"full",layoutMode:this.get("layout-mode"),ponyMode:this.is("pony-mode"),merchantId:g}})},getQaId:function(){var a=this.get("model").getPaymentMeta().status;var b=this.is("standalone")?":standalone":"";var c=a&&a!=="error"?":"+a:"";return"payment-button"+b+c},_modifyPaymentUrl:function(a){var b=e.default(a,{from:"list",mp:"web"});var c=b.split("?"),d=c[0],f=c[1];var i=this.get("model").getPaymentMeta().skin;var j="";var l="die-list";if(i===o.SKINS.GIBDD){j=g.default("gibdd");l="die-list_gd-exp"}var m=__assign(__assign({},k.default(f)),{from:l,mp:"web",ftrs:j});return d+"?"+h.default(m)}})});define("feast-mod/text",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lowerCase=a;function a(a){return a.toLowerCase()}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html",["feast"],function(a){return a.smartParse('<div qa:id="{_this.getQaId()}">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="titleArray" value="{_this.getTitle()}" />\n\t<fn:var name="subtitleArray" value="{_this.getSubtitle()}" />\n\t<fn:var name="iconData" value="{_this.getIconData()}" />\n\t<fn:var name="hasPicture" value="{_this.hasPicture()}" />\n\t<fn:var name="showImg" value="{attrs[\'show-img\']}" />\n\t<fn:var name="imgSrc" value="{attrs[\'img-src\']}" />\n\t<fn:var name="shouldShowCross" value="{_this.shouldShowCross()}" />\n\n\t<bem:mod name="{attrs[\'layout-mode\']}" />\n\t<bem:mod name="closeable" test="shouldShowCross" />\n\n\t\x3c!-- Image:Start --\x3e\n\t<div\n\t\tbem:elem="img-container"\n\t\tfn:if="hasPicture"\n\t>\n\t\t<bem:mod name="hidden" test="!showImg" />\n\n\t\t<img\n\t\t\tsrc="{imgSrc}"\n\t\t\tbem:elem="img"\n\t\t\tremit:load="load-img"\n\t\t\tremit:error="error-img"\n\t\t\tqa:id="img:{_this.meta.skin}"\n\t\t>\n\t\t\t<bem:mod name="{_this.meta.skin}" />\n\t\t</img>\n\t</div>\n\t\x3c!-- Image:End --\x3e\n\n\t\x3c!-- Icon:Start --\x3e\n\t<div bem:elem="icon-container" fn:if="!showImg" qa:id="icon:{iconData.name}">\n\t\t<bem:mod name="{attrs[\'icon-container-mode\']}" test="!hasPicture" />\n\t\t<bem:mod name="{iconData.category}" test="iconData.category" />\n\t\t<bem:mod name="placeholder" test="hasPicture" />\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="iconData.url">\n\t\t\t\t<img bem:elem="img-icon" src="{iconData.url}" />\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:ico name="{iconData.name}" />\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\t\x3c!-- Icon:End --\x3e\n\n\t\x3c!-- Content:Start --\x3e\n\t<div bem:elem="content-container">\n\n\t\t\x3c!-- Title:Start --\x3e\n\t\t<div bem:elem="text-container" qa:id="title">\n\t\t\t<bem:mod name="title" />\n\n\t\t\t<fn:for data="titleArray" as="titleElement">\n\t\t\t\t<span bem:elem="text" key="{titleElement.text}" qa:id="{titleElement.id}">\n\t\t\t\t\t<bem:mod name="title" />\n\t\t\t\t\t{titleElement.text}\n\t\t\t\t</span>\n\t\t\t</fn:for>\n\t\t</div>\n\t\t\x3c!-- Title:End --\x3e\n\n\t\t\x3c!-- Subtitle:Start --\x3e\n\t\t<div bem:elem="text-container" fn:if="subtitleArray && subtitleArray.length" qa:id="subtitle">\n\t\t\t<bem:mod name="subtitle" />\n\n\t\t\t<fn:for data="subtitleArray" as="subtitleElement">\n\t\t\t\t<span\n\t\t\t\t\tfn:if="subtitleElement.description"\n\t\t\t\t\tbem:elem="text"\n\t\t\t\t\tkey="{subtitleElement.description}"\n\t\t\t\t\tqa:id="{subtitleElement.id}:description"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="subtitle" />\n\t\t\t\t\t<bem:mod name="description" />\n\n\t\t\t\t\t{subtitleElement.description}&nbsp;\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="text" key="{subtitleElement.text}" qa:id="{subtitleElement.id}">\n\t\t\t\t\t<fn:var name="isCarNumber" value="{subtitleElement.id === \'car_number\'}" />\n\n\t\t\t\t\t<bem:mod name="subtitle" />\n\t\t\t\t\t<bem:mod name="car-number" test="isCarNumber" />\n\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="isCarNumber">\n\t\t\t\t\t\t\t<fn:value mod="lowerCase">subtitleElement.text</fn:value>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:when test="subtitleElement.id === \'date_violation\'">\n\t\t\t\t\t\t\t<fn:value mod="letterMonthYearDate">subtitleElement.text</fn:value>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t{subtitleElement.text}\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</span>\n\t\t\t</fn:for>\n\t\t</div>\n\t\t\x3c!-- Subtitle:End --\x3e\n\n\t\t\x3c!-- PaymentButton:Start --\x3e\n\t\t<div bem:elem="button-container">\n\t\t\t<b:payment-button\n\t\t\t\toneline\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tlayout-mode="{attrs[\'layout-mode\']}"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- PaymentButton:End --\x3e\n\n\t</div>\n\t\x3c!-- Content:End --\x3e\n\n\t<div bem:elem="cross-container" fn:if="shouldShowCross">\n\t\t<b:ico\n\t\t\tname="actions:close"\n\t\t\tsecondary\n\t\t\tremit:click="cross-click"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html")});define("feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html"],function(a){return a});define("ui-block/list-letter-payment-die/list-letter-payment-die",["exports","data-source/actions","default-values","feast","feast-mod/letter-date","feast-mod/text","feast-tpl!./list-letter-payment-die.html","RPC","service/radars/index","ui-block/ico/ico","ui-block/ico-map/ico-map","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-payment-button/list-letter-payment-button","../../helpers/data-source-dispatch"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=u(c);var o=u(f);var p=u(g);var q=u(h);var r=u(i);var s=u(l);var t=u(m);function u(a){return a&&a.__esModule?a:{default:a}}var v;function w(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var x=(v={},w(v,k.SKINS.PROMO,"order"),w(v,k.SKINS.DATASET,"finance"),w(v,k.SKINS.GIBDD,"fees"),w(v,k.SKINS.MOBILES_PAYMENT,"finance"),w(v,k.SKINS.SIMPLE,"dobro"),w(v,k.SKINS.MONETA,"finance"),w(v,k.SKINS.MOS_RU,"finance"),v);var y="actions:favorite_alt";var z={car_number:i18n("Номер авто"),driver_license:i18n("Номер ВУ"),CTC:i18n("СТС"),date_violation:i18n("Дата нарушения"),receiver:i18n("Постановление")};exports.default=n.default.Block.extend({name:"list-letter-payment-die",rootClassName:"ll-pd",template:o.default,immutable:true,isolate:true,isolateEvents:true,blocks:{ico:r.default,"payment-button":s.default},defaults:{"layout-mode":"2pane","icon-container-mode":"narrow","img-src":"","show-img":false},events:{"load-img":"handleImgLoad","error-img":"handleImgError","cross-click":"handleCrossClick"},mods:{letterMonthYearDate:d.letterMonthYearDate,lowerCase:e.lowerCase},constructor:function a(){n.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},getQaId:function a(){return"payment-die:"+this.meta.skin},didMount:function a(){var b=this;if(this.hasPicture()){this._getImgSrc().then(function(a){return b._initImgLoading(a)})}var c=this.meta,d=c.skin,e=c.merchant_id;var f=this.get("model"),g=f.id;if(k.onceShownMap.hasOwnProperty(g)){return}k.onceShownMap[g]="";(0,q.default)({type:"ll-pd-show-"+d,dwh:{uidl:g,displayMode:"full",layoutMode:this.get("layout-mode"),ponyMode:false,merchantId:e}})},_getFirstTruthyMetaField:function a(b){var c=this.meta;var d=b.find(function(a){return!!c[a]});return d?{id:d,text:c[d]}:null},getTitle:function a(){var b=this.meta;switch(b.skin){case k.SKINS.PROMO:var c=this._getFirstTruthyMetaField(["description","receiver"]);return[c.id==="receiver"?{id:c.id,text:i18n("Заказ № {orderNumber}",{orderNumber:c.text})}:c];case k.SKINS.DATASET:return[this._getFirstTruthyMetaField(["address","period","payer","description"])];case k.SKINS.GIBDD:return[this._getFirstTruthyMetaField(["article_koap_description","violation_place"])];case k.SKINS.MOBILES_PAYMENT:var d=b.phone,e=b.recharge_threshold;return[{id:"balance_warning",text:i18n("Баланс {phone} меньше {rechargeThreshold} руб",{phone:d,rechargeThreshold:e})}];case k.SKINS.SIMPLE:return[this._getFirstTruthyMetaField(["comment"])];case k.SKINS.MONETA:var f="";var g=b.account_number,h=b.provider_category,i=b.provider;if(i){f=i}if(h){f=f?f+", "+h:h}if(g){f=f?i18n("{monetaTitle}, л/с {accountNumber}",{"unsafe-monetaTitle":f,"unsafe-accountNumber":g}):i18n("л/с {accountNumber}",{"unsafe-accountNumber":g})}return[{id:"moneta_title",text:f}];case k.SKINS.MOS_RU:var j=b.description||"";return[{id:"mosru_title",text:j}]}},getSubtitle:function a(){var b=this.meta,c=b.skin,e=b.car_number,f=b.date_violation,g=b.date_deadline,h=b.date_deadline_discount;if(c!==k.SKINS.GIBDD){return[]}if(e&&f){return[{id:"car_number",text:e},{id:"date_violation",text:f}]}var i=this._getFirstTruthyMetaField(["car_number","driver_license","CTC","date_violation","receiver"]);if(i){var j=i.id,l=i.text;return[{id:j,description:z[j]+":",text:l}]}return(0,k.isExpired)(h)?[{id:"no-discount",description:i18n("Оплатить до")+":",text:(0,d.letterMonthDate)(g*1e3,true)}]:[{id:"discount",description:i18n("Оплатить со скидкой до")+":",text:(0,d.letterMonthDate)(h*1e3,true)}]},getIconData:function a(){var b=this.get("model");var c=this.meta,d=c.skin,e=c.provider_logo;if(d===k.SKINS.MOBILES_PAYMENT&&e){return{name:"provider-logo",url:e}}var f=b.get("transaction_category")||x[d];return{category:f,name:d===k.SKINS.SIMPLE&&!j.transactionsMap.hasOwnProperty(f)?y:j.transactionsMap[f].ico}},hasPicture:k.paymentDieHasPicture,_getImgSrc:function a(){var c=this.meta;switch(c.skin){case k.SKINS.PROMO:return Promise.resolve(c.preview_image);case k.SKINS.GIBDD:if(!b.LIST_LETTER_PAYMENT_DIES_GMAP){return Promise.reject()}var d=b.LIST_LETTER_PAYMENT_DIES_GMAP.mapSize,e=b.LIST_LETTER_PAYMENT_DIES_GMAP.zoom;return p.default.get("gibdd/gmap/base64",{latitude:'"'+c.latitude+'"',longitude:'"'+c.longitude+'"',map_size:'"'+d+'"',zoom:'"'+e+'"'},{cache:true}).then(function(a){var b=a.body;return"data:image/png;base64,"+b.base64_map}).catch(function(a){(0,q.default)({type:"ll-pd-gmap-err"});throw a})}},_initImgLoading:function a(b){this.set("img-src",b)},handleImgLoad:function a(){this.set("show-img",true)},handleImgError:function a(){var b=this.meta.skin;(0,q.default)({type:"ll-pd-img-err-"+b})},shouldShowCross:function a(){return b.LIST_LETTER_PAYMENT_DIES_CLOSEABLE},handleCrossClick:function b(c){c.preventDefault();var d=(0,k.removeFolderId)(this.get("model").id);var e=this.meta,f=e.skin,g=e.status,h=e.merchant_id;(0,q.default)({type:"ll-pd-close",intervals:[[f,1]],dwh:{uidl:d,displayMode:"full",layoutMode:this.get("layout-mode"),ponyMode:false,status:g||"new",merchantId:h}});(0,t.default)({type:a.HIDE_PAYMENT_DIE,uidl:d})}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html",["feast"],function(a){return a.smartParse('<div qa:id="{_this.getTestId()}">\n\t<fn:var name="description" value="{_this.getDescription()}" />\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}" />\n\n\t<bem:mod name="column" test="attrs[\'layout-type\'] === \'3pane\'" />\n\t<bem:mod name="row" test="attrs[\'layout-type\'] === \'2pane\'" />\n\n\t<span\n\t\tfn:if="!(ponyMode && attrs[\'layout-type\'] === \'3pane\')"\n\t\tbem:elem="description"\n\t\tqa:id="description"\n\t>\n\t\t{description}\n\t</span>\n\t<b:payment-button\n\t\tmodel="{attrs.model}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html")});define("feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html",["feast"],function(a){return a.smartParse('<div\n\tremit:click="payment-button:click"\n\tqa:id="{_this.getTestId()}"\n>\n\t<fn:var name="meta" value="{attrs.model.getPaymentMeta()}" />\n\t<fn:var name="status" value="{meta.status}" />\n\t<fn:var name="shouldShowButton" value="{_this.shouldShowButton()}" />\n\n\t<bem:mod name="{status}" test="!shouldShowButton" />\n\t<bem:mod name="default" test="shouldShowButton" />\n\n\t<span>\n\t\t{_this.getTitle()}\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html")});define("feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button",["require","exports","feast","feast-tpl!./list-letter-payment-universal-button.html","helpers/opener","helpers/payment","helpers/querystring-add","service/layer","service/radars/index"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=a.default.Block.extend({name:"list-letter-payment-universal-button",rootClassName:"ll-pub",template:b.default,events:{"payment-button:click":"onClick"},constructor:function(){a.default.Block.apply(this,arguments);this.onPostMessage=this.onPostMessage.bind(this)},getTitle:function(){var a,b,c,e;var f=(a=this.get("model"))===null||a===void 0?void 0:a.getPaymentMeta();if(!f){return""}var g=f.status,h=f.amount,i=f.buttons,j=f.status_texts;var k=j===null||j===void 0?void 0:j[g];switch(g){case d.PaymentStatus.awaiting:return k||i18n("Идёт оплата");case d.PaymentStatus.success:return k||i18n("Оплачено")}var l=(b=i===null||i===void 0?void 0:i.payment)===null||b===void 0?void 0:b.text_on_list;if(l){return l}var m=(e=(c=i===null||i===void 0?void 0:i.payment)===null||c===void 0?void 0:c.text)!==null&&e!==void 0?e:i18n("Оплатить");return""+m+(h?" "+h+" ₽":"")},shouldShowButton:function(){var a=this.get("model").getPaymentMeta();if(!a){return true}return!a.status||a.status===d.PaymentStatus.error},onPostMessage:function(a){var b=a.details,c=b.message,e=b.layer;var f=this.get("model");var h=f.getPaymentMeta();if(typeof h!=="object"||typeof c!=="object"){return}var i=h.skin,j=h.merchant_id,k=h.merchant_type,l=h.amount,m=h.version;var n=c.status,o=c.type,p=c.m_type;if(p==="iframeClose"){e.broadcast("layer:close")}if(o===d.MESSAGE_TYPES.CHANGE_PAYMENT_STATUS){f.setPaymentMeta(__assign(__assign({},h),{status:n}));return g.default({type:"ll-pub_stts_chng_"+j+"_"+n,dwh:{uidl:f.id,skin:i,amount:l,status:n,merchant_id:j,merchant_type:k,version:m}})}},onClick:function(a){var b=this.get("model");var e=b.getPaymentMeta();if(typeof e!=="object"){return}var h=e.skin,i=e.amount,j=e.status,k=e.buttons.payment,l=k.url,m=k.iframe_size,n=e.version,o=e.merchant_id,p=e.merchant_type;if(j===d.PaymentStatus.awaiting||j===d.PaymentStatus.success){return}a.preventDefault();if(!m){c.default(l);return}var q=m.split("x"),r=q[0],s=q[1];var t={uidl:b.id,skin:h,amount:i,status:j,merchant_id:o,merchant_type:p,version:n};var u={url:this._modifyPaymentUrl(l,n),width:r,height:s};if(p===d.MERCHANT_TYPES.MONETA){f.default.open("moneta",__assign(__assign({},u),{"close-on-esc":true,dwhMetrics:t}),{dimmer:true})}else{f.default.openIframeLayer({additionalParams:u,factoryParams:{"close-on-esc":true},onPostMessage:this.onPostMessage})}g.default({type:"ll-pub_clck_"+o,dwh:t})},_modifyPaymentUrl:function(a,b){return e.default(a,{from:"die_oct_ll_"+b,mp:"web"})},getTestId:function(){var a,b;var c=(b=(a=this.get("model"))===null||a===void 0?void 0:a.getPaymentMeta())===null||b===void 0?void 0:b.status;return"ll-pay-uni-btn:"+(c!==null&&c!==void 0?c:"btn")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die",["require","exports","feast","feast-tpl!./list-letter-payment-universal-die.html","service/radars/index","ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"list-letter-payment-universal-die",template:b.default,rootClassName:"ll-pud",constructor:function(){a.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},blocks:{"payment-button":d.default},didMount:function(){var a=this.meta,b=a.skin,d=a.merchant_id,e=a.merchant_type,f=a.amount,g=a.status,h=a.version;var i=this.get("model").id;c.default({type:"ll-pud_shw_"+d,dwh:{uidl:i,skin:b,amount:f,status:g,merchant_id:d,merchant_type:e,version:h}})},getDescription:function(){var a,b,c,d,e;var f=(c=(b=(a=this.meta)===null||a===void 0?void 0:a.description)===null||b===void 0?void 0:b.map(function(a){return a===null||a===void 0?void 0:a.value}))===null||c===void 0?void 0:c.filter(function(a){return a});var g=f===null||f===void 0?void 0:f.join(", ");var h=(d=this===null||this===void 0?void 0:this.meta)===null||d===void 0?void 0:d.header;return(e=g||h)!==null&&e!==void 0?e:""},getTestId:function(){var a;var b=(a=this.meta)===null||a===void 0?void 0:a.merchant_type;return"ll-pay-uni-die:"+b}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-preview-attaches">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="allCount" value="{attrs[\'all-count\']}"/>\n\t<fn:var name="model" value="{attrs[\'model\']}"/>\n\t<fn:var name="attachesList" value="{attrs[\'attaches-list\']}"/>\n\t<fn:var name="moreAttachesList" value="{attrs[\'more-attaches-list\']}"/>\n\t<fn:var name="isCompact" value="{attrs[\'layout-mode\'] === \'3pane\'}"/>\n\t<fn:var name="compactMode" value="{isCompact ? \'compact\' : \'incompact\'}"/>\n\t<fn:var name="pony" value="{attrs[\'pony-mode\'] ? \'pony\' : \'normal\'}"/>\n\t<fn:var name="location" value="{attrs[\'metathread\'] ? \'meta\' : \'folder\'}"/>\n\n\t<fn:var name="vertical" value="{attrs.vertical}"/>\n\n\t<bem:mod name="vertical" test="vertical"/>\n\t<bem:mod name="horizontal" test="!vertical"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="mode" value="{compactMode + \'_\' + pony + \'_\' + location}"/>\n\n\t\x3c!-- Аттач с кнопкой ЕЩЕ --\x3e\n\t<fn:match name="attachWithMore" args="moreCount">\n\t\t<fn:var name="attach" value="{attachesList[attachesList.length - 1]}"/>\n\t\t<fn:var name="extension" value="{_this.getAttachmentExtension(attach.name.value)}"/>\n\n\t\t<b:preview-attaches-item\n\t\t\t\tmodel="{model}"\n\t\t\t\tlast-attach="true"\n\t\t\t\tattach="{attach}"\n\t\t\t\tvertical="{vertical}"\n\t\t\t\thasMore="{moreCount}"\n\t\t\t\tisCompact="{isCompact}"\n\t\t\t\tremit:click="attach"\n\t\t\t\tevent:details="{hasSnippet: vertical, ext: extension}"\n\t\t\t\tuse:mediator="attachments-manager"\n\t\t/>\n\n\t\t<b:preview-attaches-more\n\t\t\t\tfn:if="moreCount"\n\t\t\t\tmodel="{model}"\n\t\t\t\tmore-count="{moreCount}"\n\t\t\t\titems="{moreAttachesList}"\n\t\t\t\tvertical="{vertical}"\n\t\t\t\tpony-mode="{attrs[\'pony-mode\']}"\n\t\t\t\tremit:click="more"\n\t\t\t\tremit:moreinvalid="moreinvalid"\n\t\t\t\tuse:mediator="attachments-manager"\n\t\t\t\tevent:details="{hasSnippet: vertical}"\n\t\t/>\n\t</fn:match>\n\n\t<fn:if test="attachesList && attachesList.length">\n\t\t<fn:var name="moreCount" value="{allCount - attachesList.length}"/>\n\n\t\t\x3c!-- Если аттачей > 1, то сначала в цикле рисуем n-1 аттач --\x3e\n\t\t<fn:for data="attachesList" as="attach" key="key">\n\t\t\t<fn:var name="lastItem" value="{(attachesList.length - 1) === key}"/>\n\n\t\t\t<b:preview-attaches-item\n\t\t\t\tfn:if="!lastItem"\n\t\t\t\tkey="{key}"\n\t\t\t\tmodel="{model}"\n\t\t\t\tattach="{attach}"\n\t\t\t\tvertical="{vertical}"\n\t\t\t\tisCompact="{isCompact}"\n\t\t\t\tremit:click="attach"\n\t\t\t\tevent:details="{hasSnippet: vertical, ext: extension}"\n\t\t\t\tuse:mediator="attachments-manager"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="vertical && moreCount">\n\t\t\t\t\x3c!-- Если последний (или единственный) аттач - это большой аттач с ЕЩЕ, --\x3e\n\t\t\t\t\x3c!-- то рисуем его в контейнере для flex-direction: raw --\x3e\n\t\t\t\t<div bem:elem="container">\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="attachWithMore"\n\t\t\t\t\t\t\targs="moreCount"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<fn:apply-match\n\t\t\t\t\t\tname="attachWithMore"\n\t\t\t\t\t\targs="moreCount"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html")});define("feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html"],function(a){return a});define("service/search-attaches/utils",["exports","utils/extension"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAttachmentExtension=e;exports.getAttachmentIconByExt=f;exports.getAttachmentIcon=g;exports.getAttachmentId=h;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d={archive:"ATTACH_ARCHIVE","android-package":"ATTACH_ANDROID",audio:"ATTACH_AUDIO",calendar:"ATTACH_CALENDAR",chart:"ATTACH_CHART",document:"ATTACH_DOC",ebook:"ATTACH_EBOOK",email:"ATTACH_MAIL",exec:"ATTACH_EXE",html:"ATTACH_HTML",json:"ATTACH_JSON",markdown:"ATTACH_MARKDOWN",pdf:"ATTACH_PDF",picture:"ATTACH_PICTURE",playlist:"ATTACH_PLAYLIST",presentation:"ATTACH_PRESENTATION",source:"ATTACH_SOURCE",spreadsheet:"ATTACH_SPREADSHEET",text:"ATTACH_TEXT",vcard:"ATTACH_VCARD",video:"ATTACH_VIDEO","web-feed":"ATTACH_WEBFEED"};function e(a){return b.default.getExtByName(a)}function f(a){var c=b.default.extToPrimitiveKind[a];if(!c){c=b.default.extToPrimitiveKind[b.default.extensionAliases[a]]}return d[c]||"ATTACH_UNKNOWN"}function g(a){var b=e(a.value);return f(b)}function h(a){return a.slice(a.indexOf(";")+1)}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html",["feast"],function(a){return a.smartParse('<span qa:id="ll-preview-attaches-item">\n\t<fn:var name="last" value="{attrs[\'last-attach\']}"/>\n\t<fn:var name="vertical" value="{attrs[\'vertical\']}"/>\n\t<fn:var name="formName" value="{attrs[\'attach\'].formName}"/>\n\t<fn:var name="snippet" value="{attrs[\'attach\'].snippet}"/>\n\t<fn:var name="showMoreButton" value="{attrs.hasMore}"/>\n\t<fn:var name="iconName" value="{_this.getAttachmentIcon(formName)}"/>\n\t<fn:var name="isCompact" value="{attrs.isCompact}"/>\n\n\t<bem:mod name="vertical" test="vertical"/>\n\t<bem:mod name="vertical-more" test="vertical && showMoreButton"/>\n\t<bem:mod name="not-last-vertical" test="!last && vertical"/>\n\t<bem:mod name="horizontal" test="!vertical"/>\n\t<bem:mod name="last-without-more" test="last && !showMoreButton"/>\n\t<bem:mod name="mode" value="{isCompact ? \'compact\' : \'incompact\'}"/>\n\n\t<div bem:elem="icon">\n\t\t<bem:mod name="grey"/>\n\t\t<bem:mod name="doc" test="iconName === \'ATTACH_DOC\'"/>\n\t\t<bem:mod name="pdf" test="iconName === \'ATTACH_PDF\'"/>\n\t\t<bem:mod name="presentation" test="iconName === \'ATTACH_PRESENTATION\'"/>\n\t\t<bem:mod name="spreadsheet" test="iconName === \'ATTACH_SPREADSHEET\'"/>\n\n\t\t<b:ico name="{iconName}"/>\n\t</div>\n\n\t<fn:if test="formName">\n\t\t<div bem:elem="content" qa:id="{_this.getQaId()}">\n\t\t\t<b:highlighter\n\t\t\t\ttext="{formName.value}"\n\t\t\t\tcolor="{formName.color}"\n\t\t\t/>\n\n\t\t\t<div\n\t\t\t\tbem:elem="snippet"\n\t\t\t\tfn:if="vertical && snippet.value"\n\t\t\t\tqa:id="ll-preview-attaches-snippet"\n\t\t\t>\n\t\t\t\t<b:highlighter\n\t\t\t\t\ttext="{snippet.value}"\n\t\t\t\t\tcolor="{snippet.color}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n</span>\n',"app/feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html")});define("feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/highlighter/highlighter.html",["feast"],function(a){return a.smartParse('<span>\n\t<fn:var name="splitted" value="{_this.splitter(attrs.text, attrs.color)}" />\n\n\t<fn:for data="splitted" as="part" key="index">\n\t\t<span key="{attrs.text}{part}{index}" bem:elem="item">\n\t\t\t<bem:mod name="light" test="index % 2" />\n\t\t\t<fn:value>part</fn:value>\n\t\t</span>\n\t</fn:for>\n</span>',"app/feast-tpl!ui-block/highlighter/highlighter.html")});define("feast-tpl!ui-block/highlighter/highlighter.html",["feast-tpl!app/feast-tpl!ui-block/highlighter/highlighter.html"],function(a){return a});define("ui-block/highlighter/highlighter",["exports","feast","feast-tpl!./highlighter.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=0;var g=1;exports.default=c.default.Block.extend({name:"highlighter",template:d.default,blocks:{},splitter:function a(b,c){var d=[];var e=void 0;var h=void 0;var i=true;var j=void 0;if(!b){return d}if(!c){d.push(b);return d}if(i){e=0;for(var k=0;k<c.length;k++){j=c[k];if(j[f]<e||j[g]>b.length||j[f]>j[g]){i=false}e=j[g]}}if(i){e=0;for(var l=0;l<c.length;l++){j=c[l];h=b.substring(e,j[0]);d.push(h);h=b.substring(j[0],j[1]);d.push(h);e=j[1]}if(e<b.length){h=b.substring(e,b.length);d.push(h)}}else{d.push(b)}return d}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item",["require","exports","feast","feast-tpl!./list-letter-preview-attaches-item.html","service/search-attaches/utils","ui-block/highlighter/highlighter","ui-block/ico/ico"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);exports.default=a.default.Block.extend({name:"list-letter-preview-attaches-item",rootClassName:"ll-sai",template:b.default,blocks:{ico:e.default,highlighter:d.default},defaults:{"layout-mode":"2pane",vertical:false,"last-attach":false},events:{click:"onAttachClick"},getAttachmentIcon:c.getAttachmentIcon,onAttachClick:function(a){a.preventDefault();var b=this.get("model");var d=this.get("attach");var e=d.partId;var f=c.getAttachmentId(e);var g=b.get("expand")||b.get("id");this.broadcast("attachments:openviewer",{message:b,attachment:d,attachmentId:f,msgId:g,from:"ll-prvw-itm"})},getQaId:function(){var a=this.get("attach").formName;return"ll-preview-attaches-item:"+(a===null||a===void 0?void 0:a.value)}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html",["feast"],function(a){return a.smartParse('<span>\n\t<fn:var name="count" value="{attrs[\'more-count\']}"/>\n\t<fn:var name="vertical" value="{attrs[\'vertical\']}"/>\n\n\t<bem:mod name="vertical" test="vertical"/>\n\n\t<b:react-async\n\t\tremit:contextmenu.stop\n\t\tremit:click.prevent\n\t\tqa:id="ll-preview-attaches-more"\n\n\t\tcomponent="AttachmentDropdown"\n\n\t\tonChange="{_this.attachmentDropdownChange.bind(_this)}"\n\t\toverlayContainer="{document.getElementById(\'portal-overlay\')}"\n\t\titems="{_this.getAttachmentItems()}"\n\t\topen="{attrs[\'dropdown-open\']}"\n\t\tponyMode="{attrs[\'pony-mode\']}"\n\t\tmode="search"\n\t\tbuttonSize="{vertical && \'large\'}"\n\t\tmoreCount="{count}"\n\t\tuse:mediator="themes-manager"\n\t/>\n</span>\n',"app/feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html")});define("feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more",["require","exports","feast","feast-tpl!./list-letter-preview-attaches-more.html","service/search-attaches/utils"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var d=a.default.Block.extend({name:"list-letter-preview-attaches-more",rootClassName:"ll-sam",template:b.default,attachmentDropdownChange:function(a){this.set("dropdown-open",a)},getAttachmentItems:function(){var a=this;var b=this.get("items");return b.reduce(function(b,d){var e,f;return b.concat({title:(e=d.formName)===null||e===void 0?void 0:e.value,extension:c.getAttachmentExtension((f=d.formName)===null||f===void 0?void 0:f.value),onClick:function(b){b.preventDefault();var e=a.get("model");var f=d.partId;var g=c.getAttachmentId(f);var h=e.get("expand")||e.get("id");if(g.split(";").length>2){a.broadcast("moreinvalid");return}a.broadcast("attachments:openviewer",{message:e,attachment:d,attachmentId:g,msgId:h,from:"ll-prvw-more"})}})},[])}});d.resetAttachmentDropdown=function(){d.getInstances().forEach(function(a){var b=a.get("dropdown-open");if(b){a.set("dropdown-open",false)}})};exports.default=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-attaches/list-letter-preview-attaches",["require","exports","feast","feast-tpl!./list-letter-preview-attaches.html","service/search-attaches/utils","ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item","ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);exports.default=a.default.Block.extend({name:"list-letter-preview-attaches",rootClassName:"ll-sa",template:b.default,blocks:{"preview-attaches-item":d.default,"preview-attaches-more":e.default},defaults:{"layout-mode":"2pane"},getAttachmentExtension:c.getAttachmentExtension})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-preview-stub">\n\t<fn:var name="attachesStubs" value="{_this.getArrayOfAttachesStubs()}"/>\n\t<fn:var name="compactMode" value="{attrs.isCompact ? \'compact\' : \'incompact\'}"/>\n\t<fn:var name="pony" value="{attrs[\'pony-mode\'] ? \'pony\' : \'normal\'}"/>\n\t<fn:var name="location" value="{attrs[\'metathread\'] ? \'meta\' : \'folder\'}"/>\n\n\t<bem:mod name="layoutMode" value="{compactMode + \'_\' + pony + \'_\' + location}"/>\n\n\t<fn:for data="attachesStubs" as="stub">\n\t\t<div key="{stub.key}" bem:elem="item">\n\t\t\t<bem:mod name="mode" value="{compactMode + \'_\' + stub.type}"/>\n\t\t</div>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html")});define("feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-stub/list-letter-preview-stub",["require","exports","default-values","feast","feast-tpl!./list-letter-preview-stub.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"list-letter-preview-stub",rootClassName:"ll-preview-stub",template:c.default,getArrayOfAttachesStubs:function(){var b=this.get("attachesCount");var c=this.get("isCompact");var d=[];var e=a.LETTER_PREVIEWS_CONFIG["stubs-count"];var f=c?e-1:e;var g=Math.min(f,b);for(var h=0;h<g;h++){d.push({type:"normal",key:h})}if(b>f){d.push({type:"small",key:d.length})}return d}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html",["feast"],function(a){return a.smartParse('<span\n\tremit:click.stop="toggle"\n\tqa:id="unread:{attrs.state}"\n\ttitle="{_this.getTitle()}"\n\tdisabled="{attrs[\'disable-hover\']}"\n>\n\t<bem:mod name="is-active" test="attrs.state"/>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\t<bem:mod name="shift" test="attrs.shift"/>\n\t<bem:mod name="dotSize" value="{attrs.dotSize}" test="attrs.dotSize"/>\n\n\t<span bem:elem="ico" fn:if="_this.getIconName()">\n\t\t<b:ico name="{_this.getIconName()}"/>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html")});define("feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html"],function(a){return a});define("ui-block/list-letter-read-status/list-letter-read-status",["exports","feast","feast-tpl!./list-letter-read-status.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockData=undefined;var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}var h=exports.blockData={name:"list-letter-read-status",rootClassName:"ll-rs",template:e.default,immutable:true,isolate:true,defaults:{model:null,state:false,"disable-hover":false,"is-forwarded":false,"is-replied":false},notVisualAttributes:{model:true,"disable-hover":true},blocks:{ico:f.default},getTitle:function a(){return this.get("state")?i18n("Пометить прочитанным"):i18n("Пометить непрочитанным")},getIconName:function a(){if(this.get("is-forwarded")&&this.get("is-replied")){return"mail_20:actions:forward_reply_small"}if(this.get("is-forwarded")){return"mail_20:actions:forward_small"}if(this.get("is-replied")){return"mail_20:actions:reply_small"}return false}};exports.default=d.default.Block.extend(h)});define("feast-tpl!app/feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{_this.getFormattedDate(attrs.date)}"\n>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\n\t<span bem:elem="icon">\n\t\t<b:ico name="status:time"/>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html")});define("feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html"],function(a){return a});define("ui-block/list-letter-schedule-status/list-letter-schedule-status",["exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-schedule-status.html","ui-block/ico/ico","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=i(a);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,e.withWelterLetterPart)({name:"list-letter-schedule-status",rootClassName:"ll-ss",template:g.default,immutable:true,isolate:true,blocks:{ico:h.default},defaults:{state:false,"disable-hover":false},notVisualAttributes:{model:true,"disable-hover":true},getFormattedDate:function a(c){return(0,b.scheduleDate)(c)}}))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html",["feast"],function(a){return a.smartParse('<fn:choose>\n\t<fn:when test="!attrs.search">\n\t\t<span bem:elem="normal">\n\t\t\t{attrs.value}\n\t\t</span>\n\t</fn:when>\n\n\t<fn:otherwise>\n\t\t<span bem:elem="search">\n\t\t\t<b:highlighter\n\t\t\t\ttext="{attrs.value}"\n\t\t\t\tcolor="{attrs.color}"\n\t\t\t/>\n\t\t</span>\n\t</fn:otherwise>\n</fn:choose>\n',"app/feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html")});define("feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html"],function(a){return a});define("ui-block/list-letter-snippet/list-letter-snippet",["exports","feast","feast-tpl!./list-letter-snippet.html","ui-block/highlighter/highlighter"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list-letter-snippet",rootClassName:"ll-sp",template:e.default,immutable:true,isolate:true,isolateEvents:true,defaults:{search:false,value:"",color:null},blocks:{highlighter:f.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-subject/list-letter-subject.html",["feast"],function(a){return a.smartParse('<fn:choose>\n\t<fn:when test="!attrs.search">\n\t\t<span bem:elem="normal">\n\t\t\t{attrs.subject}\n\t\t</span>\n\t</fn:when>\n\n\t<fn:otherwise>\n\t\t<span bem:elem="search">\n\t\t\t<b:highlighter\n\t\t\t\ttext="{attrs.subject}"\n\t\t\t\tcolor="{attrs.color}"\n\t\t\t/>\n\t\t</span>\n\t</fn:otherwise>\n</fn:choose>\n',"app/feast-tpl!ui-block/list-letter-subject/list-letter-subject.html")});define("feast-tpl!ui-block/list-letter-subject/list-letter-subject.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-subject/list-letter-subject.html"],function(a){return a});define("ui-block/list-letter-subject/list-letter-subject",["exports","feast","feast-tpl!./list-letter-subject.html","ui-block/highlighter/highlighter"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list-letter-subject",rootClassName:"ll-sj",template:e.default,immutable:true,isolate:true,isolateEvents:true,defaults:{search:false,subject:"",color:null},blocks:{highlighter:f.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-unsubscribe"\n\t bem:elem="button"\n\t remit:click.prevent.stop="unsubscribe:ll:click"\n\t event:details="{sender: attrs.unsubscribeSender}"\n>\n\t<bem:mod name="3pane" test="attrs[\'layout-mode\'] === \'3pane\'"/>\n\t<span promo:id="ll-unsubscribe">\n\t\t{i18n(\'Отписаться\')}\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html")});define("feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-unsubscribe/list-letter-unsubscribe",["require","exports","feast","feast-tpl!./list-letter-unsubscribe.html","service/radars/decorator","service/radars/index"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend(c.default({events:[]})({name:"list-letter-unsubscribe",rootClassName:"ll-unsubscribe",template:b.default,defaults:{unsubscribeSender:null},events:{"unsubscribe:ll:click":"onClick"},blocks:{},didMount:function(){var a;d.default({type:"unsub_unread_newsl_ll_show",dwh:{sender:(a=this.get("unsubscribeSender"))===null||a===void 0?void 0:a.email}})},onClick:function(a){var b=a.details.sender;this.broadcast("unsubscribe:from:ll",{sender:b});d.default({type:"unsub_unread_newsl_ll_clck",dwh:{sender:b.email}})}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-common/list-letter-common",["require","exports","default-values","feast","feast-mod/letter-date","feast-tpl!./list-letter-common.html","helpers/letter","helpers/radar-utils","service/emoji","service/radars/decorator","service/search-attaches/attachesList","service/search-attaches/getAttaches","service/search-attaches/viewModes","ui-block/delimeter/delimeter","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-order/list-letter-abstract-order","ui-block/list-letter-order/list-letter-order","ui-block/list-letter-payment-button/list-letter-payment-button","ui-block/list-letter-payment-die/list-letter-payment-die","ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die","ui-block/list-letter-preview-attaches/list-letter-preview-attaches","ui-block/list-letter-preview-stub/list-letter-preview-stub","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/list-letter-unsubscribe/list-letter-unsubscribe"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);h=__importDefault(h);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);exports.default=b.default.Block.extend(p.withWelterLetter(h.default({id:"letter-item",events:[{name:"clickavatar",rename:function(a){return a.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function(a){return f.renameRadarOnStatusToggle(a,"unread")}},{name:"togglestatus:flagged",rename:function(a){return f.renameRadarOnStatusToggle(a,"flagged")}}]})({name:"list-letter-common",rootClassName:"llc",template:d.default,immutable:true,isolate:true,performanceTrace:true,blocks:{delimeter:l.default,"read-status":B.default,avatar:n.default,badge:o.default,correspondent:r.default,"flag-status":s.default,"schedule-status":C.default,subject:E.default,snippet:D.default,"attach-status":m.default,folder:t.default,"payment-die":x.default,"payment-button":w.default,"preview-attaches":z.default,order:v.default,stub:A.default,unsubscribe:F.default,"payment-universal-die":y.default},defaults:{selected:false,"disable-subject":false,search:false,indent:false,messagesAttaches:null,fetchAttaches:false,"layout-mode":"2pane",isThreadWithReliableMark:a.THREAD_WITH_RELIABLE_MARK},notVisualAttributes:{"list-index":true},mods:{letterDate:c.letterDate,scheduleDate:c.scheduleDate},constructor:function(){b.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},didMount:function(){this.handleIntersectViewport();g.emojiFallback(this.refs.title,"ll-cmn")},didUpdate:function(){g.emojiFallback(this.refs.title,"ll-cmn")},getAttachesPreviewCondition:function(){var a=this.get("fetchAttaches")&&!this.get("messagesAttaches");return!a&&q.getPaymentDieDisplayMode.call(this)==="none"},getSubject:p.getSubject,getImageSrc:p.getImageSrc,isProbablyPhishing:p.isProbablyPhishing,getCorrespondent:p.getCorrespondent,getCorrespondentTooltip:p.getCorrespondentTooltip,getDateTooltip:p.getDateTooltip,getCounter:p.getCounter,getCategory:p.getCategory,getAllAttaches:j.getAllAttaches,getSearchAttaches:j.getSearchAttaches,getAttaches:i.getAttaches,getAttachesModes:k.getAttachesModes,isImportant:p.isImportant,hasBadge:p.hasBadge,getSnippetValue:p.getSnippetValue,getPaymentDieDisplayMode:q.getPaymentDieDisplayMode,shouldShowUniversalPaymentDie:q.shouldShowUniversalPaymentDie,shouldHideTransactionCategory:q.shouldHideTransactionCategory,showOrder:u.showOrder,getTransactionMetadata:u.getTransactionMetadata,rootQaId:p.rootQaId,letterDate:c.letterDate,getUnsubscribeSender:p.getUnsubscribeSender,handleIntersectViewport:p.handleIntersectViewport,checkOfficialGreen:e.checkOfficialGreen,checkImportantReliable:e.checkImportantReliable})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\t\tname="active"\n\t\t\ttest="attrs.selected || attrs.active"\n\t/>\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\t<bem:mod\n\t\tname="swipe-actions-visible"\n\t\ttest="attrs[\'swipe-actions-visible\']"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="attrs[\'pony-mode\']"\n\t/>\n\n\t<bem:mod\n\t\tname="swipe-actions-animated"\n\t\ttest="attrs[\'swipe-actions-animated\']"\n\t/>\n\n\t<bem:mod\n\t\tname="has-indent"\n\t\ttest="attrs[\'indent\']"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected || attrs.active"/>\n\t</div>\n\n\t<fn:match name="header">\n\t\t\x3c!-- Header:Start --\x3e\n\t\t<div bem:elem="header">\n\t\t\t\x3c!-- Read status:Start --\x3e\n\t\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t\t<b:read-status\n\t\t\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Read status:End --\x3e\n\n\t\t\t\x3c!-- Avatar:Start --\x3e\n\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t<b:avatar\n\t\t\t\t\tcentered\n\t\t\t\t\tstate="{attrs.selected}"\n\t\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\ttouch\n\t\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Avatar:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Header:End --\x3e\n\t</fn:match>\n\n\t<fn:match name="content">\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content">\n\n\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t<div bem:elem="item">\n\t\t\t\t<bem:mod name="correspondent"/>\n\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t<b:correspondent\n\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t<div bem:elem="item" qa:id="flagged">\n\t\t\t\t<bem:mod name="flag"/>\n\n\t\t\t\t<b:flag-status\n\t\t\t\t\tstate="{data.is(\'flags.flagged\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t>\n\t\t\t\t<bem:mod name="badge"/>\n\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\x3c!-- Title:Start --\x3e\n\t\t\t<div bem:elem="item" ref="title">\n\t\t\t\t<bem:mod name="title"/>\n\n\t\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="subject"\n\t\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\t\tqa:id="subject"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t\t<b:subject\n\t\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="snippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\n\t\t\t\t\t<b:snippet\n\t\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Title:End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="attrs.showfolder">\n\t\t\t\t<bem:mod name="folder"/>\n\t\t\t\t<fn:var name="folder" value="{data.getFolder()}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Folder:End --\x3e\n\n\t\t\t\x3c!-- Schedule:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="!attrs.showfolder && data.isSchedule()">\n\t\t\t\t<b:schedule-status\n\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t<fn:if test="!attrs[\'disable-attach\']">\n\t\t\t\t<div bem:elem="item">\n\t\t\t\t\t<bem:mod name="attach-status"/>\n\n\t\t\t\t\t<b:attach-status\n\t\t\t\t\t\tfn:if="data.is(\'flags.attach\')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<div bem:elem="item">\n\t\t\t\t<bem:mod name="date"/>\n\t\t\t\t{data.get(\'date\') | letterDate}\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\t</fn:match>\n\n\t<b:swipeable\n\t\tuse:mediator="swipe-manager"\n\t\tremit:underlay-changed="underlay:changed"\n\t\tremit:animation-changed="animation:changed"\n\t\tremit:pan-changed="pan:changed"\n\t\tmax-offset="170"\n\t\tid="swipeable"\n\t>\n\n\t\t<fn:match name="swipe-underlay">\n\t\t\t\x3c!-- Подложка контейнера --\x3e\n\t\t\t<b:letter-swipe-actions\n\t\t\t\tmodel="{data}"\n\t\t\t\tremit:action-unread="togglestatus:unread"\n\t\t\t\tremit:action-flagged="togglestatus:flagged"\n\t\t\t\tremit:action-move="move"\n\t\t\t\tremit:action-remove="remove"\n\t\t\t\tremit:action-spam="spam"\n\t\t\t\tremit:action-unspam="unspam"\n\t\t\t\tuse:mediator="layout-manager"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-content-fading">\n\t\t\t<fn:apply-match name="header"/>\n\t\t</fn:match>\n\t\t<fn:match name="swipe-content">\n\t\t\t<fn:apply-match name="content"/>\n\t\t</fn:match>\n\t</b:swipeable>\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter ponymode="{ponyMode}" indent="{attrs.indent}" last/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html")});define("feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html",["feast"],function(a){return a.smartParse('<div remit:click.prevent>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageFolder" value="{message.getFolder()}"/>\n\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t\x3c!-- Непрочитанность --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2 ico="point"\n\t\t\t\ttouch\n\t\t\t\tpure\n\t\t\t\tremit:mousedown.prevent="action-unread"/>\n\t</div>\n\n\t\x3c!-- Пометить флажком --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2 ico="flag"\n\t\t\t\ttouch\n\t\t\t\tpure\n\t\t\t\tremit:mousedown.prevent="action-flagged"\n\t\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t<div bem:elem="swipe-actions-element">\n\t\t<div bem:elem="swipe-actions-element">\n\t\t\t<b:button2 ico="folder-move"\n\t\t\t\t\ttouch\n\t\t\t\t\tpure\n\t\t\t\t\tremit:mousedown.prevent="click:move"\n\t\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\n\t\x3c!-- Удалить --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2 ico="delete"\n\t\t\t\ttouch\n\t\t\t\tpure\n\t\t\t\tremit:mousedown.prevent="action-remove"\n\t\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t\x3c!-- Спам/не спам --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2 ico="spam-on"\n\t\t\t\t   touch\n\t\t\t\t   pure\n\t\t\t\t   remit:mousedown.prevent="action-spam"\n\t\t\t\t   fn:if="!messageFolder.isSpam()"\n\t\t\t\t   centered\n\t\t/>\n\t\t<b:button2 ico="spam-off"\n\t\t\t\t   touch\n\t\t\t\t   pure\n\t\t\t\t   remit:mousedown.prevent="action-unspam"\n\t\t\t\t   fn:if="messageFolder.isSpam()"\n\t\t\t\t   centered\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html")});define("feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html",["feast-tpl!app/feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html"],function(a){return a});define("ui-block/letter-swipe-actions/letter-swipe-actions",["exports","feast","feast-tpl!./letter-swipe-actions.html","service/layer","ui-block/button2/button2"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"letter-swipe-actions",template:f.default,blocks:{button2:h.default},events:{"click:move":"onMove"},onMove:function a(){var b=this.get("model");g.default.open("move-to-folder",{letter:b},{dimmer:true,mobile:true,resolvable:false})}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{_this.getAttachTitle()}"\n\tqa:id="attach:true"\n>\n\t<bem:mod name="compact" test="attrs[\'compact\']"/>\n\n\t<b:ico name="attach"/>\n</span>\n\n',"app/feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html")});define("feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html"],function(a){return a});define("ui-block/list-letter-attach-status/list-letter-attach-status",["exports","feast","feast-tpl!./list-letter-attach-status.html","ui-block/ico/ico","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,d.withWelterLetterPart)({name:"list-letter-attach-status",rootClassName:"ll-as",template:f.default,immutable:true,isolate:true,isolateEvents:true,blocks:{ico:g.default},getAttachTitle:function a(){return i18n("С вложениями")}}))});define("feast-tpl!app/feast-tpl!ui-block/swipeable/swipeable.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="animated" test="attrs.animated"/>\n\t<bem:mod name="swiped" test="attrs.underlay"/>\n\n\t<fn:if test="attrs.underlay">\n\t\t<div bem:elem="underlay">\n\t\t\t<fn:apply-match name="swipe-underlay"/>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="content-fading" ref="content-fading"/>\n\t<fn:apply-match name="swipe-content-fading"/>\n\n\t<div bem:elem="content-wrapper">\n\t\t<div bem:elem="content" ref="content">\n\t\t\t<fn:apply-match name="swipe-content"/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/swipeable/swipeable.html")});define("feast-tpl!ui-block/swipeable/swipeable.html",["feast-tpl!app/feast-tpl!ui-block/swipeable/swipeable.html"],function(a){return a});define("ui-block/swipeable/swipeable",["exports","../../lazy.modules","feast","feast-tpl!./swipeable.html","helpers/browser","service/radars/decorator"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(b);var g=j(c);var h=j(d);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}var k=h.default.capabilities["touch-support"];var l=function a(b){return b.SUPPORT_POINTER_EVENTS?"pointerdown":"touchstart"};var m=350;exports.default=f.default.Block.extend((0,i.default)({})({name:"swipeable",template:g.default,isolate:false,immutable:true,touchEventsReady:false,notVisualAttributes:{disabled:true},blocks:{},attrChanged:{disabled:function a(b){this.touchEventsReady&&this.watchSwipe(!b)},animated:function a(b){var c=this;clearTimeout(this.timeouts.animated);this.broadcast("animation-changed",{value:b});if(b){this.timeouts.animated=setTimeout(function(){return c.set("animated",false)},m)}},underlay:function a(b){this.broadcast("underlay-changed",{value:b})}},constructor:function a(){f.default.Block.prototype.constructor.apply(this,arguments);this.timeouts={}},didMount:function b(){var c=this;this._insiders=[];this._pos={x:0,y:0};this.addInsideTarget(this.el);if(k){(0,a.lazyHammerJS)().then((0,a.uniqCallback)(this,function(a){if(!c.isMounted()){return}c.Hammer=a;c.handleTouchStart=function(){c.activateTouchEvents()};c.el.addEventListener(l(a),c.handleTouchStart,true)}))}},didUnmount:function a(){k&&this.Hammer&&this.el.removeEventListener(l(this.Hammer),this.handleTouchStart,true);Object.values(this.timeouts).forEach(function(a){window.clearTimeout(a)});if(this.touchEventsReady){this.watchOutsideClick(false);this.watchSwipe(false);this._insiders=[]}},activateTouchEvents:function a(){var b=this.Hammer;this.mc=new b.Manager(this.el,{recognizers:b.defaults.preset,inputClass:b.SUPPORT_POINTER_EVENTS?b.PointerEventInput:b.TouchInput});this.mc.get("pan").set({direction:b.DIRECTION_HORIZONTAL});this.mc.get("swipe").set({direction:b.DIRECTION_HORIZONTAL});this.touchEventsReady=true;this.el.removeEventListener(l(b),this.handleTouchStart,true);this.watchSwipe(!this.is("disabled"))},watchSwipe:function a(b){var c=this;b=b===void 0?true:!!b;if(b){this.mc.on("panleft panright",function(a){return c.onPan(a)});this.mc.on("panstart",function(a){return c.onPanStart(a)});this.mc.on("panend",function(a){return c.onPanEnd(a)});this.mc.on("swiperight swipeleft",function(a){return c.onSwipe(a)})}else{this.mc.off("panleft panright panstart panend");this.mc.off("swiperight swipeleft")}},onSwipe:function a(b){var c=this.refs.content.offsetWidth;var d=b.offsetDirection==2?-1:1;this.set("animated",true);this.setContainerPos(c*d);if(d<0){this.swipeX(false)}},onPanStart:function a(b){this.isHPanned=Math.abs(b.deltaX)>Math.abs(b.deltaY);if(this.isHPanned){this.set("animated",false);this.broadcast("pan-changed",{value:true});this._lastPanX=0}},onPan:function a(b){if(this.isHPanned){var c=b.deltaX-this._lastPanX;this._lastPanX=b.deltaX;this.moveContainerX(c)}},onPanEnd:function a(b){if(this.isHPanned){this.broadcast("pan-changed",{value:false});if(-b.deltaX>=this.getSwipeWidth()/5){this.swipeX(false)}else if(b.deltaX){this.reset()}else{this.swipeX(true)}}},swipeX:function a(b){var c=this.refs.content.offsetWidth;var d=c*(b?1:-1);this.set("animated",true);this.setContainerPos(d);this.watchOutsideClick(!b)},moveContainerX:function a(b){if(b>0&&this._pos.x>=0){b=b/(6*b)}this.setContainerPos(this._pos.x+b)},setContainerPos:function a(b,c){var d=this;var e=this.getSwipeWidth();var f=b>0?1:-1;b=!b&&b!==0?this._pos.x:Math.min(Math.abs(b),e);b=b*f;this._pos.x=b;this._pos.y=c;if(b===0){this.timeouts.underlay=window.setTimeout(function(){return d.set("underlay",false)},m)}else{this.set("underlay",true)}this.timeouts.position=window.setTimeout(function(){var a=Math.max(0,1+1.5*b/e);d.refs["content-fading"].style.opacity=a;d.refs.content.style.opacity=a;d.refs.content.style[h.default.prefixedCSS("transform")]="translate3d("+b+"px,0,0) scale3d(1,1,1)"},10)},getSwipeWidth:function a(){var b=this.el.offsetWidth;var c=this.attrs["max-offset"]?parseInt(this.attrs["max-offset"],10):b;return Math.min(c,b)},watchOutsideClick:function a(b){b=b===void 0?true:!!b;this[b?"$on":"$off"](this.el.ownerDocument,"touchstart","onOutsideClick");this[b?"$on":"$off"](this.el.ownerDocument,"mousedown","onOutsideClick")},onOutsideClick:function a(b){var c=this._insiders.some(function(a){return a.contains(b.target)});if(!c){this.reset();this.watchOutsideClick(false)}},addInsideTarget:function a(b){this._insiders.push(b)},reset:function a(){if(!this.touchEventsReady){return}this.set("animated",true);this.setContainerPos(0,0);this.watchOutsideClick(false)}}))});define("ui-block/list-letter-common-touch/list-letter-common-touch",["exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-common-touch.html","helpers/radar-utils","service/radars/decorator","service/emoji","ui-block/delimeter/delimeter","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/list-letter-attach-status/list-letter-attach-status","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/swipeable/swipeable"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var u=K(a);var v=K(c);var w=K(e);var x=K(g);var y=K(h);var z=K(i);var A=K(j);var B=K(k);var C=K(m);var D=K(n);var E=K(o);var F=K(p);var G=K(q);var H=K(r);var I=K(s);var J=K(t);function K(a){return a&&a.__esModule?a:{default:a}}exports.default=u.default.Block.extend((0,l.withWelterLetter)((0,w.default)({id:"letter-item",events:[{name:"clickavatar",rename:function a(b){return b.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function a(b){return(0,d.renameRadarOnStatusToggle)(b,"unread")}},{name:"togglestatus:flagged",rename:function a(b){return(0,d.renameRadarOnStatusToggle)(b,"flagged")}},{name:"remove",data:d.getModelData},{name:"spam",data:d.getModelData},{name:"unspam",data:d.getModelData}]})({name:"list-letter-common-touch",rootClassName:"llc-t",template:v.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"read-status":F.default,avatar:A.default,badge:B.default,correspondent:C.default,"flag-status":D.default,subject:I.default,snippet:H.default,"attach-status":z.default,"schedule-status":G.default,folder:E.default,"letter-swipe-actions":y.default,swipeable:J.default,delimeter:x.default},defaults:{selected:false,"disable-subject":false,search:false,"swipe-actions-visible":false,indent:false,"layout-mode":"2pane"},events:{"pan:changed":"onPanChanged","underlay:changed":"onUnderlayChanged","animation:changed":"onAnimationChanged"},mods:{letterDate:b.letterDate,scheduleDate:b.scheduleDate},didMount:function a(){(0,f.emojiFallback)(this.refs.title,"ll-cmn-t")},didUpdate:function a(){(0,f.emojiFallback)(this.refs.title,"ll-cmn-t")},getSubject:l.getSubject,getImageSrc:l.getImageSrc,isProbablyPhishing:l.isProbablyPhishing,getCorrespondent:l.getCorrespondent,getCorrespondentTooltip:l.getCorrespondentTooltip,getCounter:l.getCounter,getCategory:l.getCategory,isImportant:l.isImportant,hasBadge:l.hasBadge,getSnippetValue:l.getSnippetValue,rootQaId:l.rootQaId,shouldHideTransactionCategory:function a(){return false},onPanChanged:function a(b){this.set("swipe-actions-touched",b.details.value)},onAnimationChanged:function a(b){this.set("swipe-actions-animated",b.details.value)},onUnderlayChanged:function a(b){this.set("swipe-actions-visible",b.details.value)}})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-compact/list-letter-compact.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="indent" value="{attrs.indent}"/>\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\t<fn:var name="avatarIndent" value="{_this.getAvatarIndent()}"/>\n\t<fn:var name="paymentDieDisplayMode" value="{_this.getPaymentDieDisplayMode()}" />\n\t<fn:var name="unsubscribeSender" value="{_this.getUnsubscribeSender()}" />\n\t<fn:var name="showUniversalDie" value="{_this.shouldShowUniversalPaymentDie()}" />\n\t<fn:var name="showUnsubscribe" value="{unsubscribeSender && !showUniversalDie && (paymentDieDisplayMode === \'none\')}" />\n\n\t<fn:if test="paymentDieDisplayMode === \'full\'">\n\t\t<fn:var name="paymentDieWithIndent" value="{attrs[\'payment-die-with-indent\']}"/>\n\t</fn:if>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-uidl-id" value="{data.get(\'last\')}"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="ponyMode"\n\t/>\n\n\t<bem:mod\n\t\tname="has-indent"\n\t\ttest="indent"\n\t/>\n\n\t<bem:mod\n\t\tname="active"\n\t\ttest="attrs.selected || attrs.active"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t\x3c!-- Container:Start --\x3e\n\t<div bem:elem="container">\n\n\t\t<bem:mod\n\t\t\tname="pony-mode"\n\t\t\ttest="ponyMode"\n\t\t/>\n\n\t\t<div bem:elem="background">\n\t\t\t<bem:mod name="active" test="attrs.selected || attrs.active"/>\n\t\t</div>\n\n\t\t\x3c!-- Remember: match должен быть ДО apply-match --\x3e\n\t\t<fn:match name="badge">\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="badge"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t>\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tcompact\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\t\t</fn:match>\n\n\t\t\x3c!-- Header:Start --\x3e\n\t\t<div bem:elem="header">\n\t\t\t\x3c!-- Read status:Start --\x3e\n\t\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t\t<b:read-status\n\t\t\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tshift="{ponyMode}"\n\t\t\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Read status:End --\x3e\n\n\t\t\t\x3c!-- Avatar:Start --\x3e\n\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t<b:avatar\n\t\t\t\t\tstate="{attrs.selected}"\n\t\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\t\tindent="{avatarIndent}"\n\t\t\t\t\tsize="{ponyMode ? \'common\' : \'compact\'}"\n\t\t\t\t\tpriority="{attrs[\'priority\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Avatar:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Header:End --\x3e\n\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content">\n\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\x3c!-- Row:Start --\x3e\n\t\t\t<div bem:elem="row">\n\n\t\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t\t<div bem:elem="date"\n\t\t\t\t\t title="{_this.getDateTooltip()}"\n\t\t\t\t>\n\t\t\t\t\t{data.get(\'date\') | letterDate}\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Date:End --\x3e\n\n\t\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t\t<div bem:elem="correspondent">\n\t\t\t\t\t<b:correspondent\n\t\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t\t\ttitle="{_this.getCorrespondentTooltip()}"\n\t\t\t\t\t\tdangerous="{_this.isProbablyPhishing()}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Row:End --\x3e\n\n\t\t\t\x3c!-- Row:Start --\x3e\n\t\t\t<div bem:elem="row" ref="main">\n\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\n\t\t\t\t<fn:apply-match name="badge" fn:if="!ponyMode"/>\n\n\t\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="subject"\n\t\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\t\tqa:id="subject"\n\t\t\t\t\ttitle="{_this.getSubjectTooltip()}"\n\t\t\t\t>\n\t\t\t\t\t<b:subject\n\t\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\t\x3c!-- ListLetterPaymentUniversalDie:Start --\x3e\n\t\t\t\t<b:payment-universal-die\n\t\t\t\t\tfn:if="showUniversalDie"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tlayout-type="{attrs[\'layout-type\']}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- ListLetterPaymentUniversalDie:End --\x3e\n\n\t\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="snippet"\n\t\t\t\t\tfn:if="!((attrs.search || showUniversalDie) && ponyMode) && !(ponyMode && showUnsubscribe)"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\t\t\t\t\t<bem:mod name="overflow" test="showUnsubscribe" />\n\n\t\t\t\t\t<b:snippet\n\t\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\t\x3c!-- ListLetterUnsubscribe:Start --\x3e\n\t\t\t\t<b:unsubscribe\n\t\t\t\t\tfn:if="showUnsubscribe"\n\t\t\t\t\tlayout-mode="3pane"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\tunsubscribeSender="{unsubscribeSender}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- ListLetterUnsubscribe:End --\x3e\n\n\t\t\t\t\x3c!-- Panel:Start --\x3e\n\t\t\t\t<div bem:elem="panel">\n\t\t\t\t\t<fn:var name="hasAttach" value="{data.is(\'flags.attach\')}"/>\n\t\t\t\t\t<fn:var name="isFlagged" value="{data.is(\'flags.flagged\')}"/>\n\t\t\t\t\t<fn:var name="isSchedule" value="{data.isSchedule()}"/>\n\n\t\t\t\t\t<bem:mod name="active" test="attrs.selected || attrs.active"/>\n\t\t\t\t\t<bem:mod name="is-flagged" test="isFlagged"/>\n\t\t\t\t\t<bem:mod name="non-empty" test="hasAttach || isFlagged || isSchedule || _this.hasBadge()"/>\n\t\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\n\t\t\t\t\t\x3c!-- Schedule:Start --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t\tfn:if="isSchedule"\n\t\t\t\t\t\tbem:elem="panel-item"\n\t\t\t\t\t\tbem:mod="schedule-status"\n\t\t\t\t\t>\n\t\t\t\t\t\t<b:schedule-status\n\t\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t\t\t<fn:if test="hasAttach && !attrs[\'disable-attach\']">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="panel-item"\n\t\t\t\t\t\t\tbem:mod="attach-status"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:attach-status/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="panel-item"\n\t\t\t\t\t\tbem:mod="flag"\n\t\t\t\t\t\tqa:id="flagged"\n\t\t\t\t\t>\n\t\t\t\t\t\t<b:flag-status\n\t\t\t\t\t\t\tstate="{isFlagged}"\n\t\t\t\t\t\t\tmodel="{data}"\n\t\t\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t\t\t<fn:apply-match name="badge" fn:if="ponyMode"/>\n\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Panel:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Row:End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="folder" fn:if="attrs.showfolder">\n\t\t\t\t<fn:var name="folder" value="{data.getFolder()}"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{data.get(\'send_date\') | scheduleDate}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{folder.get(\'name\')}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Folder:End --\x3e\n\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\n\t</div>\n\t\x3c!-- Container:End --\x3e\n\n\t\x3c!-- PaymentDie:Start --\x3e\n\t<div bem:elem="payment-die-container" fn:if="paymentDieDisplayMode && paymentDieDisplayMode !== \'none\'">\n\t\t<bem:mod name="noindent" test="paymentDieWithIndent === false" />\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\t\t<bem:mod name="compact" test="paymentDieDisplayMode === \'compact\'" />\n\t\t<bem:mod name="metathread" test="attrs[\'in-metathread\']" />\n\n\n\t\t<fn:if test="paymentDieDisplayMode === \'compact\'">\n\t\t\t<b:payment-button\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tstandalone\n\t\t\t\tlayout-mode="3pane"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<fn:if test="paymentDieDisplayMode === \'full\'">\n\t\t\t<b:payment-die\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tlayout-mode="3pane"\n\t\t\t\ticon-container-mode="{(paymentDieWithIndent === false) ? \'wide\' : \'narrow\'}"\n\t\t\t/>\n\t\t</fn:if>\n\t</div>\n\t\x3c!-- PaymentDie:End --\x3e\n\n\t\x3c!-- AttachesPreview:Start --\x3e\n\t<fn:var name="messagesAttaches" value="{attrs.messagesAttaches}"/>\n\t<fn:var name="showAttaches" value="{attrs[\'show-attaches\'] && _this.getAttachesPreviewCondition()}"/>\n\n\t<fn:var\n\t\tname="attachesModes"\n\t\tvalue="{_this.getAttachesModes(true, messagesAttaches)}"\n\t/>\n\n\t<fn:var\n\t\tname="attachesForRender"\n\t\tvalue="{_this.getAttaches(attachesModes, messagesAttaches)}"\n\t/>\n\n\t<fn:if test="showAttaches">\n\t\t<fn:choose>\n\t\t\t<fn:when test="messagesAttaches">\n\t\t\t\t<b:preview-attaches\n\t\t\t\t\tfn:if="messagesAttaches"\n\t\t\t\t\tremit:attach="previewattach"\n\t\t\t\t\tremit:more="previewattach"\n\t\t\t\t\tremit:moreinvalid="openletter"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tattaches-list="{attachesForRender.attachesList}"\n\t\t\t\t\tmore-attaches-list="{attachesForRender.moreAttachesList}"\n\t\t\t\t\tlayout-mode="3pane"\n\t\t\t\t\tall-count="{messagesAttaches.length}"\n\t\t\t\t\tvertical="{attachesModes.vertical}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\tmetathread="{attrs[\'in-metathread\']}"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- Заглушка, пока аттачи не загрузились --\x3e\n\t\t\t\t<b:stub\n\t\t\t\t\tattachesCount="{data.get(\'attachments_count\')}"\n\t\t\t\t\tisCompact="{true}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\tmetathread="{attrs[\'in-metathread\']}"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n\t\x3c!-- AttachesPreview:End --\x3e\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter compact full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter last compact ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-compact/list-letter-compact.html")});define("feast-tpl!ui-block/list-letter-compact/list-letter-compact.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-compact/list-letter-compact.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-compact/list-letter-compact",["require","exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-compact.html","helpers/radar-utils","service/emoji","service/radars/decorator","service/search-attaches/attachesList","service/search-attaches/viewModes","ui-block/delimeter/delimeter","ui-block/list-letter-attach-status/list-letter-attach-status","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-payment-button/list-letter-payment-button","ui-block/list-letter-payment-die/list-letter-payment-die","ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die","ui-block/list-letter-preview-attaches/list-letter-preview-attaches","ui-block/list-letter-preview-stub/list-letter-preview-stub","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/list-letter-unsubscribe/list-letter-unsubscribe"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);f=__importDefault(f);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);exports.default=a.default.Block.extend(m.withWelterLetter(f.default({id:"letter-item",events:[{name:"clickavatar",rename:function(a){return a.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function(a){return d.renameRadarOnStatusToggle(a,"unread")}},{name:"togglestatus:flagged",rename:function(a){return d.renameRadarOnStatusToggle(a,"flagged")}}]})({name:"list-letter-compact",rootClassName:"llct",template:c.default,immutable:true,isolate:true,performanceTrace:true,blocks:{delimeter:i.default,"read-status":w.default,avatar:k.default,badge:l.default,correspondent:o.default,"flag-status":p.default,subject:z.default,snippet:y.default,"attach-status":j.default,"schedule-status":x.default,folder:q.default,"payment-die":s.default,"payment-button":r.default,"preview-attaches":u.default,stub:v.default,unsubscribe:A.default,"payment-universal-die":t.default},defaults:{selected:false,"disable-subject":false,search:false,messagesAttaches:null,fetchAttaches:false,"layout-mode":"3pane"},notVisualAttributes:{"list-index":true},mods:{letterDate:b.letterDate,scheduleDate:b.scheduleDate},constructor:function(){a.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},didMount:function(){this.handleIntersectViewport();e.emojiFallback(this.refs.main,"ll-cmp")},didUpdate:function(){e.emojiFallback(this.refs.main,"ll-cmp")},getAttachesPreviewCondition:function(){var a=this.get("fetchAttaches")&&!this.get("messagesAttaches");return!a&&n.getPaymentDieDisplayMode.call(this)==="none"},getSubject:m.getSubject,getImageSrc:m.getImageSrc,isProbablyPhishing:m.isProbablyPhishing,getCorrespondent:m.getCorrespondent,getCorrespondentTooltip:m.getCorrespondentTooltip,getDateTooltip:m.getDateTooltip,getSubjectTooltip:m.getSubjectTooltip,getSnippetValue:m.getSnippetValue,getCounter:m.getCounter,getCategory:m.getCategory,getAttaches:g.getAttaches,getAttachesModes:h.getAttachesModes,isImportant:m.isImportant,hasBadge:m.hasBadge,getPaymentDieDisplayMode:n.getPaymentDieDisplayMode,shouldShowUniversalPaymentDie:n.shouldShowUniversalPaymentDie,shouldHideTransactionCategory:n.shouldHideTransactionCategory,getUnsubscribeSender:m.getUnsubscribeSender,handleIntersectViewport:m.handleIntersectViewport,getAvatarIndent:function(){if(this.is("pony-mode")){if(this.is("indent")){return"left"}return"right"}return false},rootQaId:m.rootQaId})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\t<bem:mod\n\t\tname="swipe-actions-visible"\n\t\ttest="attrs[\'swipe-actions-visible\']"\n\t/>\n\t<bem:mod\n\t\tname="swipe-actions-animated"\n\t\ttest="attrs[\'swipe-actions-animated\']"\n\t/>\n\t<bem:mod\n\t\tname="active"\n\t\ttest="attrs.active"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="ponyMode"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.active"/>\n\t</div>\n\n\t<fn:match name="header">\n\t\t\x3c!-- Header:Start --\x3e\n\t\t<div bem:elem="header">\n\n\t\t\t\x3c!-- Avatar:Start --\x3e\n\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t<b:avatar\n\t\t\t\t\tstate="{attrs.selected}"\n\t\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\ttouch\n\t\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\t\tsize="compact"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Avatar:End --\x3e\n\n\t\t\t\x3c!-- Read status:Start --\x3e\n\t\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t\t<b:read-status\n\t\t\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Read status:End --\x3e\n\n\t\t</div>\n\t\t\x3c!-- Header:End --\x3e\n\t</fn:match>\n\n\t<fn:match name="content">\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content" ref="content">\n\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t<div bem:elem="correspondent">\n\t\t\t\t<b:correspondent\n\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="subject"\n\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\tqa:id="subject"\n\t\t\t>\n\t\t\t\t<b:subject\n\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="snippet"\n\t\t\t\tqa:id="snippet"\n\t\t\t>\n\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\n\t\t\t\t<b:snippet\n\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="folder" fn:if="attrs.showfolder">\n\t\t\t\t<fn:var name="folder" value="{data.getFolder()}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\n\t\t\x3c!-- Meta:Start --\x3e\n\t\t<div bem:elem="meta">\n\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<div bem:elem="date">\n\t\t\t\t{data.get(\'date\') | letterDate}\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="badge"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t>\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tcompact\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\x3c!-- Panel:Start --\x3e\n\t\t\t<div bem:elem="panel">\n\t\t\t\t\x3c!-- Все 3 иконки одновременно не помещаются в колонку, нужно придумать решение --\x3e\n\n\t\t\t\t\x3c!-- Schedule:End --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="data.isSchedule()"\n\t\t\t\t\tbem:elem="schedule-status"\n\t\t\t\t>\n\t\t\t\t\t<b:schedule-status\n\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t\t<fn:if test="data.is(\'flags.attach\') && !attrs[\'disable-attach\']">\n\t\t\t\t\t<div bem:elem="attach-status">\n\t\t\t\t\t\t<b:attach-status/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="flag"\n\t\t\t\t\tfn:if="data.is(\'flags.flagged\')"\n\t\t\t\t\tqa:id="flagged"\n\t\t\t\t>\n\t\t\t\t\t<b:flag-status\n\t\t\t\t\t\tstate="{true}"\n\t\t\t\t\t\tmodel="{data}"\n\t\t\t\t\t\tdisable-hover\n\t\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Panel:End --\x3e\n\n\t\t</div>\n\t\t\x3c!-- Meta:End --\x3e\n\t</fn:match>\n\n\t<b:swipeable\n\t\tuse:mediator="swipe-manager"\n\t\tremit:underlay-changed="underlay:changed"\n\t\tremit:animation-changed="animation:changed"\n\t\tremit:pan-changed="pan:changed"\n\t\tmax-offset="170"\n\t\tid="swipeable"\n\t>\n\t\t<fn:match name="swipe-underlay">\n\t\t\t\x3c!-- Подложка контейнера --\x3e\n\t\t\t<b:letter-swipe-actions\n\t\t\t\tmodel="{data}"\n\t\t\t\tcompact\n\t\t\t\tremit:action-unread="togglestatus:unread"\n\t\t\t\tremit:action-flagged="togglestatus:flagged"\n\t\t\t\tremit:action-move="move"\n\t\t\t\tremit:action-remove="remove"\n\t\t\t\tremit:action-spam="spam"\n\t\t\t\tremit:action-unspam="unspam"\n\t\t\t\tuse:mediator="layout-manager"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-content-fading">\n\t\t\t<fn:apply-match name="header"/>\n\t\t</fn:match>\n\t\t<fn:match name="swipe-content">\n\t\t\t<fn:apply-match name="content"/>\n\t\t</fn:match>\n\t</b:swipeable>\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter ponymode="{ponyMode}" indent="{attrs.indent}" last/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html")});define("feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html"],function(a){return a});define("ui-block/list-letter-compact-touch/list-letter-compact-touch",["exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-compact-touch.html","service/radars/decorator","service/emoji","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/list-letter-attach-status/list-letter-attach-status","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/swipeable/swipeable"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var s=H(a);var t=H(c);var u=H(d);var v=H(f);var w=H(g);var x=H(h);var y=H(i);var z=H(k);var A=H(l);var B=H(m);var C=H(n);var D=H(o);var E=H(p);var F=H(q);var G=H(r);function H(a){return a&&a.__esModule?a:{default:a}}exports.default=s.default.Block.extend((0,j.withWelterLetter)((0,u.default)({events:["clickavatar","togglestatus:unread","togglestatus:flagged","remove","spam","unspam"]})({name:"list-letter-compact-touch",rootClassName:"llct-t",template:t.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"read-status":C.default,avatar:x.default,badge:y.default,correspondent:z.default,"flag-status":A.default,subject:F.default,snippet:E.default,"attach-status":w.default,"schedule-status":D.default,folder:B.default,"letter-swipe-actions":v.default,swipeable:G.default},defaults:{selected:false,"disable-subject":false,search:false,"swipe-actions-visible":false,"layout-mode":"3pane"},events:{"pan:changed":"onPanChanged","underlay:changed":"onUnderlayChanged","animation:changed":"onAnimationChanged"},mods:{letterDate:b.letterDate,scheduleDate:b.scheduleDate},didMount:function a(){(0,e.emojiFallback)(this.refs.content,"ll-cmp-t")},didUpdate:function a(){(0,e.emojiFallback)(this.refs.content,"ll-cmp-t")},getSubject:j.getSubject,getImageSrc:j.getImageSrc,isProbablyPhishing:j.isProbablyPhishing,getCorrespondent:j.getCorrespondent,getCorrespondentTooltip:j.getCorrespondentTooltip,getCounter:j.getCounter,getCategory:j.getCategory,isImportant:j.isImportant,hasBadge:j.hasBadge,getSnippetValue:j.getSnippetValue,rootQaId:j.rootQaId,shouldHideTransactionCategory:function a(){return false},onPanChanged:function a(b){this.set("swipe-actions-touched",b.details.value)},onAnimationChanged:function a(b){this.set("swipe-actions-animated",b.details.value)},onUnderlayChanged:function a(b){this.set("swipe-actions-visible",b.details.value)}})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html",["feast"],function(a){return a.smartParse('<div style="height: {attrs.height}px;"></div>\n',"app/feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html")});define("feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html"],function(a){return a});define("ui-block/list-letter-height-compensation/list-letter-height-compensation",["exports","feast","feast-tpl!./list-letter-height-compensation.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"list-letter-height-compensation",template:d.default,immutable:true,defaults:{height:0}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html",["feast"],function(a){return a.smartParse('<div qa:id="list-letter-preview-action">\n\t<fn:var name="compact" value="{attrs.compact}"/>\n\t<fn:var name="folder" value="{attrs.folder}"/>\n\n\t<fn:var\n\t\tname="i18nContext"\n\t\tvalue="По запросу «заказч» ничего не найдено, мы показали похожие результаты по «заказчик»"\n\t/>\n\n\t<bem:mod name="compact" test="compact"/>\n\n\t<fn:var name="queries" value="{attrs.queries}"/>\n\t<fn:var name="hasQuery" value="{queries && queries.baseQuery && queries.suggestQuery}"/>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.model.get(\'type\') === \'suggestSeparator\'">\n\t\t\t<div\n\t\t\t\t\tfn:if="hasQuery"\n\t\t\t\t\tbem:elem="item"\n\t\t\t>\n\t\t\t\t<bem:mod name="compact"/>\n\n\t\t\t\t{i18n(\'Поиск по похожим запросам\')}\n\t\t\t\t<b>\n\t\t\t\t\t{_this.getFormattedSuggestQueries(queries.suggestQuery)}\n\t\t\t\t</b>\n\t\t\t</div>\n\t\t</fn:when>\n\t\t<fn:otherwise>\n\t\t\t\x3c!-- Показываем текст саджестов в первом хедере, --\x3e\n\t\t\t\x3c!-- только если вообще нет писем в основной выдаче --\x3e\n\t\t\t<fn:if test="attrs.model.get(\'type\') === \'suggestHeader\' && hasQuery">\n\n\t\t\t\t\x3c!-- Формируем текст строки в разных i18n --\x3e\n\t\t\t\t\x3c!-- с передачей контекста вторым аргументом (пример для переводчиков) --\x3e\n\t\t\t\t\x3c!-- чтобы не использовать <fn:value output="raw"> и unsafe --\x3e\n\t\t\t\t<div>\n\t\t\t\t\t{i18n(\'По запросу\', i18nContext)}\n\n\t\t\t\t\t<b bem:elem="query">\n\t\t\t\t\t\t{queries.baseQuery}\n\t\t\t\t\t</b>\n\n\t\t\t\t\t{i18n(\'ничего не найдено, мы показали похожие результаты по\', i18nContext)}\n\n\t\t\t\t\t<b>\n\t\t\t\t\t\t{_this.getFormattedSuggestQueries(queries.suggestQuery)}\n\t\t\t\t\t</b>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<a\n\t\t\t\t\tfn:if="_this.shouldSuggestSearchInExcludedFolders()"\n\t\t\t\t\tbem:elem="message"\n\t\t\t\t\tremit:click.prevent="search:set-in-excluded-folders"\n\t\t\t\t\tevent:details="true"\n\t\t\t\t\tqa:id="search-action-enable-in-excluded-folders"\n\t\t\t\t\thref="{attrs.href}"\n\t\t\t>\n\t\t\t\t{i18n(\'Искать в папках «Спам» и «Корзина»\')}\n\t\t\t</a>\n\t\t</fn:otherwise>\n\t</fn:choose>\n\n\t<b:delimeter last full/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html")});define("feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-action/list-letter-preview-action",["require","exports","default-values","feast","feast-tpl!./list-letter-preview-action.html","helpers/suggest-search","service/radars/decorator","service/radars/index","ui-block/delimeter/delimeter"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend(e.default({events:[{name:"search:set-in-excluded-folders",rename:"search:excluded"}]})({name:"list-letter-preview-action",template:c.default,defaults:{"pony-mode":false},blocks:{delimeter:g.default},getFormattedSuggestQueries:d.getFormattedSuggestQueries,didMount:function(){var a=this.get("model");var b=a.get("type");if(b==="suggestHeader"||b==="suggestSeparator"){f.default("suggest_search_query_show")}},shouldSuggestSearchInExcludedFolders:function(){return!a.FORBID_EXCLUDED_FOLDERS_SEARCH}}))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Прикидываемся письмом на списке, чтобы заполучить сладенькие стили --\x3e\n\t<fn:add-class name="llct"/>\n\n\t<fn:var name="isCompactPonyMode" value="{attrs.compact && attrs[\'pony-mode\']}"/>\n\n\t<bem:mod name="compact" test="attrs.compact && !isCompactPonyMode"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\'] && !isCompactPonyMode"/>\n\t<bem:mod name="compact-pony-mode" test="isCompactPonyMode"/>\n\n\t<div bem:elem="row-avatar">\n\t\t<span bem:elem="avatar"/>\n\t</div>\n\n\t<div bem:elem="row-from">\n\t\t<fn:choose>\n\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t<fn:when test="!attrs.compact">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(1)}"/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t<fn:otherwise>\n\t\t\t\t<span bem:elem="multiline">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(3)}"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(4)}"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(5)}"/>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\n\t<div bem:elem="row-subject" fn:if="!attrs.compact">\n\t\t<span bem:elem="line">\n\t\t\t<bem:mod name="width-l-{_this.getRandomSize(2)}"/>\n\t\t</span>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html")});define("feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html"],function(a){return a});define("ui-block/list-letter-skeleton/list-letter-skeleton",["exports","feast","feast-tpl!./list-letter-skeleton.html","helpers/seedable-random"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var i=f.default.randomSeed();exports.default=d.default.Block.extend({name:"list-letter-skeleton",template:e.default,immutable:true,defaults:{index:0,compact:false,"pony-mode":false},getRandomSize:function a(b){var c=this.get("index");var d=[].concat(h(i));d[0]%=b*c;d[1]%=b*c;d[2]%=b*c;d[3]%=b*c;var e=new f.default(d);var g=Math.floor(e.random()*9007199);return g%3+1}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html",["feast"],function(a){return a.smartParse('<a qa:id="letter-spinner" qa:state="visible:{!attrs.hidden}">\n\t\x3c!-- Прикидываемся письмом на списке, чтобы заполучить вожделенные стили --\x3e\n\t<fn:add-class name="llct"/>\n\n\t\x3c!-- Стили запишем тут, чтобы перебить стили из  --\x3e\n\t<bem:mod name="default"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="ponyMode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="compactAndPonyMode" test="attrs.compact && attrs[\'pony-mode\']"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:spinner small color="additional"/>\n</a>\n',"app/feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html")});define("feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/spinner/spinner.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="inline" test="attrs.inline"/>\n\t<bem:mod name="small" test="attrs.small"/>\n\n\t<div bem:elem="icon">\n\t\t<fn:if test="attrs.size">\n\t\t\t<bem:mod name="size-{attrs.size}" test="attrs.size"/>\n\t\t</fn:if>\n\t\t<fn:if test="attrs.color">\n\t\t\t<bem:mod name="color-{attrs.color}" test="attrs.color"/>\n\t\t</fn:if>\n\n\t\t<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64">\n\t\t\t<defs>\n\t\t\t\t<path id="spinner-path" d="M0 0h32v32H0z"></path>\n\t\t\t\t<mask id="spinner-mask">\n\t\t\t\t\t<path fill="#fff" d="M0 0h64v64H0z"></path>\n\t\t\t\t\t<use fill="#020202" xlink:href="#spinner-path" transform="rotate(-146 32 32)"></use>\n\t\t\t\t\t<use fill="#040404" xlink:href="#spinner-path" transform="rotate(-144 32 32)"></use>\n\t\t\t\t\t<use fill="#060606" xlink:href="#spinner-path" transform="rotate(-142 32 32)"></use>\n\t\t\t\t\t<use fill="#080808" xlink:href="#spinner-path" transform="rotate(-140 32 32)"></use>\n\t\t\t\t\t<use fill="#0A0A0A" xlink:href="#spinner-path" transform="rotate(-138 32 32)"></use>\n\t\t\t\t\t<use fill="#0C0C0C" xlink:href="#spinner-path" transform="rotate(-136 32 32)"></use>\n\t\t\t\t\t<use fill="#0E0E0E" xlink:href="#spinner-path" transform="rotate(-134 32 32)"></use>\n\t\t\t\t\t<use fill="#101010" xlink:href="#spinner-path" transform="rotate(-132 32 32)"></use>\n\t\t\t\t\t<use fill="#131313" xlink:href="#spinner-path" transform="rotate(-130 32 32)"></use>\n\t\t\t\t\t<use fill="#151515" xlink:href="#spinner-path" transform="rotate(-128 32 32)"></use>\n\t\t\t\t\t<use fill="#171717" xlink:href="#spinner-path" transform="rotate(-126 32 32)"></use>\n\t\t\t\t\t<use fill="#191919" xlink:href="#spinner-path" transform="rotate(-124 32 32)"></use>\n\t\t\t\t\t<use fill="#1B1B1B" xlink:href="#spinner-path" transform="rotate(-122 32 32)"></use>\n\t\t\t\t\t<use fill="#1D1D1D" xlink:href="#spinner-path" transform="rotate(-120 32 32)"></use>\n\t\t\t\t\t<use fill="#1F1F1F" xlink:href="#spinner-path" transform="rotate(-118 32 32)"></use>\n\t\t\t\t\t<use fill="#212121" xlink:href="#spinner-path" transform="rotate(-116 32 32)"></use>\n\t\t\t\t\t<use fill="#242424" xlink:href="#spinner-path" transform="rotate(-114 32 32)"></use>\n\t\t\t\t\t<use fill="#262626" xlink:href="#spinner-path" transform="rotate(-112 32 32)"></use>\n\t\t\t\t\t<use fill="#282828" xlink:href="#spinner-path" transform="rotate(-110 32 32)"></use>\n\t\t\t\t\t<use fill="#2A2A2A" xlink:href="#spinner-path" transform="rotate(-108 32 32)"></use>\n\t\t\t\t\t<use fill="#2C2C2C" xlink:href="#spinner-path" transform="rotate(-106 32 32)"></use>\n\t\t\t\t\t<use fill="#2E2E2E" xlink:href="#spinner-path" transform="rotate(-104 32 32)"></use>\n\t\t\t\t\t<use fill="#303030" xlink:href="#spinner-path" transform="rotate(-102 32 32)"></use>\n\t\t\t\t\t<use fill="#323232" xlink:href="#spinner-path" transform="rotate(-100 32 32)"></use>\n\t\t\t\t\t<use fill="#353535" xlink:href="#spinner-path" transform="rotate(-98 32 32)"></use>\n\t\t\t\t\t<use fill="#373737" xlink:href="#spinner-path" transform="rotate(-96 32 32)"></use>\n\t\t\t\t\t<use fill="#393939" xlink:href="#spinner-path" transform="rotate(-94 32 32)"></use>\n\t\t\t\t\t<use fill="#3B3B3B" xlink:href="#spinner-path" transform="rotate(-92 32 32)"></use>\n\t\t\t\t\t<use fill="#3D3D3D" xlink:href="#spinner-path" transform="rotate(-90 32 32)"></use>\n\t\t\t\t\t<use fill="#3F3F3F" xlink:href="#spinner-path" transform="rotate(-88 32 32)"></use>\n\t\t\t\t\t<use fill="#414141" xlink:href="#spinner-path" transform="rotate(-86 32 32)"></use>\n\t\t\t\t\t<use fill="#434343" xlink:href="#spinner-path" transform="rotate(-84 32 32)"></use>\n\t\t\t\t\t<use fill="#464646" xlink:href="#spinner-path" transform="rotate(-82 32 32)"></use>\n\t\t\t\t\t<use fill="#484848" xlink:href="#spinner-path" transform="rotate(-80 32 32)"></use>\n\t\t\t\t\t<use fill="#4A4A4A" xlink:href="#spinner-path" transform="rotate(-78 32 32)"></use>\n\t\t\t\t\t<use fill="#4C4C4C" xlink:href="#spinner-path" transform="rotate(-76 32 32)"></use>\n\t\t\t\t\t<use fill="#4E4E4E" xlink:href="#spinner-path" transform="rotate(-74 32 32)"></use>\n\t\t\t\t\t<use fill="#505050" xlink:href="#spinner-path" transform="rotate(-72 32 32)"></use>\n\t\t\t\t\t<use fill="#525252" xlink:href="#spinner-path" transform="rotate(-70 32 32)"></use>\n\t\t\t\t\t<use fill="#545454" xlink:href="#spinner-path" transform="rotate(-68 32 32)"></use>\n\t\t\t\t\t<use fill="#575757" xlink:href="#spinner-path" transform="rotate(-66 32 32)"></use>\n\t\t\t\t\t<use fill="#595959" xlink:href="#spinner-path" transform="rotate(-64 32 32)"></use>\n\t\t\t\t\t<use fill="#5B5B5B" xlink:href="#spinner-path" transform="rotate(-62 32 32)"></use>\n\t\t\t\t\t<use fill="#5D5D5D" xlink:href="#spinner-path" transform="rotate(-60 32 32)"></use>\n\t\t\t\t\t<use fill="#5F5F5F" xlink:href="#spinner-path" transform="rotate(-58 32 32)"></use>\n\t\t\t\t\t<use fill="#616161" xlink:href="#spinner-path" transform="rotate(-56 32 32)"></use>\n\t\t\t\t\t<use fill="#636363" xlink:href="#spinner-path" transform="rotate(-54 32 32)"></use>\n\t\t\t\t\t<use fill="#656565" xlink:href="#spinner-path" transform="rotate(-52 32 32)"></use>\n\t\t\t\t\t<use fill="#686868" xlink:href="#spinner-path" transform="rotate(-50 32 32)"></use>\n\t\t\t\t\t<use fill="#6A6A6A" xlink:href="#spinner-path" transform="rotate(-48 32 32)"></use>\n\t\t\t\t\t<use fill="#6C6C6C" xlink:href="#spinner-path" transform="rotate(-46 32 32)"></use>\n\t\t\t\t\t<use fill="#6E6E6E" xlink:href="#spinner-path" transform="rotate(-44 32 32)"></use>\n\t\t\t\t\t<use fill="#707070" xlink:href="#spinner-path" transform="rotate(-42 32 32)"></use>\n\t\t\t\t\t<use fill="#727272" xlink:href="#spinner-path" transform="rotate(-40 32 32)"></use>\n\t\t\t\t\t<use fill="#747474" xlink:href="#spinner-path" transform="rotate(-38 32 32)"></use>\n\t\t\t\t\t<use fill="#767676" xlink:href="#spinner-path" transform="rotate(-36 32 32)"></use>\n\t\t\t\t\t<use fill="#797979" xlink:href="#spinner-path" transform="rotate(-34 32 32)"></use>\n\t\t\t\t\t<use fill="#7B7B7B" xlink:href="#spinner-path" transform="rotate(-32 32 32)"></use>\n\t\t\t\t\t<use fill="#7D7D7D" xlink:href="#spinner-path" transform="rotate(-30 32 32)"></use>\n\t\t\t\t\t<use fill="#7F7F7F" xlink:href="#spinner-path" transform="rotate(-28 32 32)"></use>\n\t\t\t\t\t<use fill="#818181" xlink:href="#spinner-path" transform="rotate(-26 32 32)"></use>\n\t\t\t\t\t<use fill="#838383" xlink:href="#spinner-path" transform="rotate(-24 32 32)"></use>\n\t\t\t\t\t<use fill="#858585" xlink:href="#spinner-path" transform="rotate(-22 32 32)"></use>\n\t\t\t\t\t<use fill="#878787" xlink:href="#spinner-path" transform="rotate(-20 32 32)"></use>\n\t\t\t\t\t<use fill="#8A8A8A" xlink:href="#spinner-path" transform="rotate(-18 32 32)"></use>\n\t\t\t\t\t<use fill="#8C8C8C" xlink:href="#spinner-path" transform="rotate(-16 32 32)"></use>\n\t\t\t\t\t<use fill="#8E8E8E" xlink:href="#spinner-path" transform="rotate(-14 32 32)"></use>\n\t\t\t\t\t<use fill="#909090" xlink:href="#spinner-path" transform="rotate(-12 32 32)"></use>\n\t\t\t\t\t<use fill="#929292" xlink:href="#spinner-path" transform="rotate(-10 32 32)"></use>\n\t\t\t\t\t<use fill="#949494" xlink:href="#spinner-path" transform="rotate(-8 32 32)"></use>\n\t\t\t\t\t<use fill="#969696" xlink:href="#spinner-path" transform="rotate(-6 32 32)"></use>\n\t\t\t\t\t<use fill="#989898" xlink:href="#spinner-path" transform="rotate(-4 32 32)"></use>\n\t\t\t\t\t<use fill="#9B9B9B" xlink:href="#spinner-path" transform="rotate(-2 32 32)"></use>\n\t\t\t\t\t<use fill="#9D9D9D" xlink:href="#spinner-path"></use>\n\t\t\t\t\t<use fill="#9F9F9F" xlink:href="#spinner-path" transform="rotate(2 32 32)"></use>\n\t\t\t\t\t<use fill="#A1A1A1" xlink:href="#spinner-path" transform="rotate(4 32 32)"></use>\n\t\t\t\t\t<use fill="#A3A3A3" xlink:href="#spinner-path" transform="rotate(6 32 32)"></use>\n\t\t\t\t\t<use fill="#A5A5A5" xlink:href="#spinner-path" transform="rotate(8 32 32)"></use>\n\t\t\t\t\t<use fill="#A7A7A7" xlink:href="#spinner-path" transform="rotate(10 32 32)"></use>\n\t\t\t\t\t<use fill="#A9A9A9" xlink:href="#spinner-path" transform="rotate(12 32 32)"></use>\n\t\t\t\t\t<use fill="#ACACAC" xlink:href="#spinner-path" transform="rotate(14 32 32)"></use>\n\t\t\t\t\t<use fill="#AEAEAE" xlink:href="#spinner-path" transform="rotate(16 32 32)"></use>\n\t\t\t\t\t<use fill="#B0B0B0" xlink:href="#spinner-path" transform="rotate(18 32 32)"></use>\n\t\t\t\t\t<use fill="#B2B2B2" xlink:href="#spinner-path" transform="rotate(20 32 32)"></use>\n\t\t\t\t\t<use fill="#B4B4B4" xlink:href="#spinner-path" transform="rotate(22 32 32)"></use>\n\t\t\t\t\t<use fill="#B6B6B6" xlink:href="#spinner-path" transform="rotate(24 32 32)"></use>\n\t\t\t\t\t<use fill="#B8B8B8" xlink:href="#spinner-path" transform="rotate(26 32 32)"></use>\n\t\t\t\t\t<use fill="#BABABA" xlink:href="#spinner-path" transform="rotate(28 32 32)"></use>\n\t\t\t\t\t<use fill="#BDBDBD" xlink:href="#spinner-path" transform="rotate(30 32 32)"></use>\n\t\t\t\t\t<use fill="#BFBFBF" xlink:href="#spinner-path" transform="rotate(32 32 32)"></use>\n\t\t\t\t\t<use fill="#C1C1C1" xlink:href="#spinner-path" transform="rotate(34 32 32)"></use>\n\t\t\t\t\t<use fill="#C3C3C3" xlink:href="#spinner-path" transform="rotate(36 32 32)"></use>\n\t\t\t\t\t<use fill="#C5C5C5" xlink:href="#spinner-path" transform="rotate(38 32 32)"></use>\n\t\t\t\t\t<use fill="#C7C7C7" xlink:href="#spinner-path" transform="rotate(40 32 32)"></use>\n\t\t\t\t\t<use fill="#C9C9C9" xlink:href="#spinner-path" transform="rotate(42 32 32)"></use>\n\t\t\t\t\t<use fill="#CBCBCB" xlink:href="#spinner-path" transform="rotate(44 32 32)"></use>\n\t\t\t\t\t<use fill="#CECECE" xlink:href="#spinner-path" transform="rotate(46 32 32)"></use>\n\t\t\t\t\t<use fill="#D0D0D0" xlink:href="#spinner-path" transform="rotate(48 32 32)"></use>\n\t\t\t\t\t<use fill="#D2D2D2" xlink:href="#spinner-path" transform="rotate(50 32 32)"></use>\n\t\t\t\t\t<use fill="#D4D4D4" xlink:href="#spinner-path" transform="rotate(52 32 32)"></use>\n\t\t\t\t\t<use fill="#D6D6D6" xlink:href="#spinner-path" transform="rotate(54 32 32)"></use>\n\t\t\t\t\t<use fill="#D8D8D8" xlink:href="#spinner-path" transform="rotate(56 32 32)"></use>\n\t\t\t\t\t<use fill="#DADADA" xlink:href="#spinner-path" transform="rotate(58 32 32)"></use>\n\t\t\t\t\t<use fill="#DCDCDC" xlink:href="#spinner-path" transform="rotate(60 32 32)"></use>\n\t\t\t\t\t<use fill="#DFDFDF" xlink:href="#spinner-path" transform="rotate(62 32 32)"></use>\n\t\t\t\t\t<use fill="#E1E1E1" xlink:href="#spinner-path" transform="rotate(64 32 32)"></use>\n\t\t\t\t\t<use fill="#E3E3E3" xlink:href="#spinner-path" transform="rotate(66 32 32)"></use>\n\t\t\t\t\t<use fill="#E5E5E5" xlink:href="#spinner-path" transform="rotate(68 32 32)"></use>\n\t\t\t\t\t<use fill="#E7E7E7" xlink:href="#spinner-path" transform="rotate(70 32 32)"></use>\n\t\t\t\t\t<use fill="#E9E9E9" xlink:href="#spinner-path" transform="rotate(72 32 32)"></use>\n\t\t\t\t\t<use fill="#EBEBEB" xlink:href="#spinner-path" transform="rotate(74 32 32)"></use>\n\t\t\t\t\t<use fill="#EDEDED" xlink:href="#spinner-path" transform="rotate(76 32 32)"></use>\n\t\t\t\t\t<use fill="#F0F0F0" xlink:href="#spinner-path" transform="rotate(78 32 32)"></use>\n\t\t\t\t\t<use fill="#F2F2F2" xlink:href="#spinner-path" transform="rotate(80 32 32)"></use>\n\t\t\t\t\t<use fill="#F4F4F4" xlink:href="#spinner-path" transform="rotate(82 32 32)"></use>\n\t\t\t\t\t<use fill="#F6F6F6" xlink:href="#spinner-path" transform="rotate(84 32 32)"></use>\n\t\t\t\t\t<use fill="#F8F8F8" xlink:href="#spinner-path" transform="rotate(86 32 32)"></use>\n\t\t\t\t\t<use fill="#FAFAFA" xlink:href="#spinner-path" transform="rotate(88 32 32)"></use>\n\t\t\t\t\t<use fill="#FCFCFC" xlink:href="#spinner-path" transform="rotate(90 32 32)"></use>\n\t\t\t\t\t<use fill="#FEFEFE" xlink:href="#spinner-path" transform="rotate(92 32 32)"></use>\n\t\t\t\t</mask>\n\t\t\t</defs>\n\t\t\t<path d="M54.6 47.6c-1.98-1.98-5.09-1.98-7.07 0-8.56 8.56-22.6 8.56-31.1 0-8.56-8.56-8.56-22.6 0-31.1 4.54-5.58-3.25-10.7-7.07-7.07-12.4 12.4-12.4 32.8 0 45.3 12.4 12.4 32.8 12.4 45.3 0 1.98-1.98 1.98-5.09 0-7.07zM32 54c-12.1 0-22-9.9-22-22s9.9-22 22-22c2.8 0 5-2.2 5-5s-2.2-5-5-5C14.4 0 0 14.4 0 32s14.4 32 32 32c7.16-.736 5.26-9.84 0-10z" mask="url(#spinner-mask)"></path>\n\t\t</svg>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/spinner/spinner.html")});define("feast-tpl!ui-block/spinner/spinner.html",["feast-tpl!app/feast-tpl!ui-block/spinner/spinner.html"],function(a){return a});define("ui-block/spinner/spinner",["exports","feast","feast-tpl!./spinner.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"spinner",template:d.default,blocks:{}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-spinner/list-letter-spinner",["require","exports","feast","feast-tpl!./list-letter-spinner.html","ui-block/spinner/spinner"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"list-letter-spinner",template:b.default,immutable:true,defaults:{hidden:true},attrChanged:{hidden:function(a){var b;(b=this.get("model"))===null||b===void 0?void 0:b.set("visible",!a);this.broadcast("state:toggle")}},blocks:{spinner:c.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-tip/list-letter-tip.html",["feast"],function(a){return a.smartParse('<div qa:id="list-letter-tip">\n\t<fn:var name="compact" value="{attrs.compact}"/>\n\t<fn:var name="folder" value="{attrs.folder}"/>\n\n\t<bem:mod name="rounded" test="attrs.rounded" />\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="compact" test="compact"/>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.type === \'spam:cleanup\'">\n\t\t\t\x3c!-- Плашка об очистке папки Спам --\x3e\n\t\t\t<fn:var name="message"\n\t\t\t\t\tvalue="{i18n(\'Письма, перемещённые в Спам более месяца назад, будут автоматически удаляться.\')}"/>\n\t\t\t<fn:var name="primaryText" value="{i18n(\'Очистить папку\')}"/>\n\t\t\t<fn:var name="secondaryLink" value="{attrs[\'spam:cleanup:secondary-link\']}"/>\n\t\t\t<fn:var name="secondaryText" value="{i18n(\'Подробнее\')}"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="compact">\n\t\t\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t\t\t<div bem:elem="message">{message}</div>\n\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<b:link href="{secondaryLink}"\n\t\t\t\t\t\t\t\ttext="{secondaryText}"\n\t\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'help-disabled\'] && !attrs.mobile"\n\t\t\t\t\t\t\t\tqa:id="controls-more"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t\t\t<div bem:elem="message">\n\t\t\t\t\t\t{message}\n\t\t\t\t\t\t<b:link text="{secondaryText}"\n\t\t\t\t\t\t\t\thref="{secondaryLink}"\n\t\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'help-disabled\'] && !attrs.mobile"\n\t\t\t\t\t\t\t\tqa:id="controls-more"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:when>\n\n\t\t<fn:when test="attrs.type === \'trash:cleanup\'">\n\t\t\t\x3c!-- Плашка об очистке папки Корзина --\x3e\n\t\t\t<fn:var name="message"\n\t\t\t\t\tvalue="{i18n(\'Письма, перемещённые в Корзину более месяца назад, будут автоматически удаляться.\')}"/>\n\t\t\t<fn:var name="primaryText" value="{i18n(\'Очистить папку\')}"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t\t<fn:when test="compact">\n\t\t\t\t\t<div bem:elem="message">{message}</div>\n\t\t\t\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t\t\t<div bem:elem="message">{message}</div>\n\t\t\t\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:when>\n\t</fn:choose>\n\n\t<b:delimeter last full fn:if="!attrs.borderless"/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-tip/list-letter-tip.html")});define("feast-tpl!ui-block/list-letter-tip/list-letter-tip.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-tip/list-letter-tip.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/folder",["require","exports","default-values","mail/SharedMailbox"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isSharedMailbox=exports.virtualFolderData=exports.hasParentPrivateFolders=exports.isParentPrivateFolder=exports.isDeleteFromFolderDisabled=void 0;b=__importDefault(b);function c(b){return a.DISABLE_DELETE_FROM_TRASH&&b.isTrashLike()}exports.isDeleteFromFolderDisabled=c;function d(b){return a.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS.includes(b.id)}exports.isParentPrivateFolder=d;function e(b){return!!a.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS.length&&b.some(function(a){return d(a)})}exports.hasParentPrivateFolders=e;function f(a){var b=a.type,c=a.name;return{archive:false,child:false,children:true,id:b,name:c,only_web:false,open:true,parent:"-1",security:false,system:true,type:b}}exports.virtualFolderData=f;var g=function(a){var c,d,e;var f=(c=a.get("owner"))===null||c===void 0?void 0:c.email;return f&&((e=(d=b.default.all.getMailboxByEmail(f))===null||d===void 0?void 0:d.get("shared_items"))===null||e===void 0?void 0:e.box)};exports.isSharedMailbox=g});define("ui-block/list-letter-tip/list-letter-tip",["exports","cfg","default-values","feast","feast-tpl!./list-letter-tip.html","helpers/folder","ui-block/delimeter/delimeter"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=k(a);var h=k(c);var i=k(d);var j=k(f);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"list-letter-tip",template:i.default,defaults:{"help-disabled":b.SPAM_HELP_DISABLED,"spam:cleanup:secondary-link":g.default.get("urls.helpUrl")+"/mail-help/security/spam","pony-mode":false},blocks:{delimeter:j.default},isRemoveVisible:function a(){return!(0,e.isDeleteFromFolderDisabled)(this.get("folder"))}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html",["feast"],function(a){return a.smartParse('<div qa:id="list-letter-welcome">\n\t<fn:var name="is3pane" value="{attrs.type === \'3pane\'}"/>\n\t<fn:var name="weatherData" value="{_this.getWeatherData()}"/>\n\t<fn:var name="withGreeting" value="{attrs.model && attrs.model.get(\'withGreeting\')}"/>\n\n\t<bem:mod name="{attrs.type}"/>\n\t<bem:mod name="ponymode" test="attrs.ponyMode"/>\n\t<bem:mod name="hidden" test="!attrs.model || !attrs.model.is(\'visible\')"/>\n\n\t<fn:if test="!is3pane">\n\t\t<div bem:elem="mainline">\n\t\t\t<a bem:elem="logo" href="{attrs.marusiaUrl}" target="_blank" remit:click="logo" qa:id="logo">\n\t\t\t\t<fn:attr name="style" value="{_this.getImage()}"/>\n\t\t\t</a>\n\n\t\t\t<span bem:elem="header">{_this.getHeader()}</span>\n\n\t\t\t<span bem:elem="secondary">\n\t\t\t\t<span bem:elem="date" fn:if="withGreeting">\n\t\t\t\t\t{_this.getDate()}\n\t\t\t\t</span>\n\n\t\t\t\t<a\n\t\t\t\t\tfn:if="weatherData"\n\t\t\t\t\thref="{weatherData.link}"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\tbem:elem="weather"\n\t\t\t\t\tremit:click="weather"\n\t\t\t\t\tqa:id="weather"\n\t\t\t\t>\n\t\t\t\t\t<img\n\t\t\t\t\t\tbem:elem="weather-icon"\n\t\t\t\t\t\tsrc="{attrs.weatherUrl}{weatherData.now_pict}.svg"\n\t\t\t\t\t\ttitle="{weatherData.now_description}"\n\t\t\t\t\t/>\n\t\t\t\t\t{weatherData.now_temp}°\n\t\t\t\t</a>\n\t\t\t</span>\n\n\t\t\t<span\n\t\t\t\tbem:elem="expand"\n\t\t\t\tfn:if="attrs.skillsEnabled"\n\t\t\t\tremit:click="expand"\n\t\t\t>\n\t\t\t\t{i18n(\'Подробнее\')}\n\t\t\t</span>\n\n\t\t\t<span bem:elem="more">\n\t\t\t\t<b:list-letter-welcome-dropdown-actions\n\t\t\t\t\tuse:mediator="welcome-block-manager"\n\t\t\t\t/>\n\t\t\t</span>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:if test="is3pane">\n\t\t<div bem:elem="mainline">\n\t\t\t<a bem:elem="logo" href="{attrs.marusiaUrl}" target="_blank" remit:click="logo" qa:id="logo">\n\t\t\t\t<fn:attr name="style" value="{_this.getImage()}"/>\n\t\t\t</a>\n\n\t\t\t<span bem:elem="mainline-content">\n\t\t\t\t<span bem:elem="content-row">\n\t\t\t\t\t<span bem:elem="header">\n\t\t\t\t\t\t<bem:mod name="compact" test="!withGreeting"/>\n\t\t\t\t\t\t{_this.getHeader()}\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<a\n\t\t\t\t\t\tfn:if="weatherData && !withGreeting"\n\t\t\t\t\t\thref="{weatherData.link}"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\tbem:elem="weather"\n\t\t\t\t\t\tbem:mod="in-header"\n\t\t\t\t\t\tremit:click="weather"\n\t\t\t\t\t\tqa:id="weather"\n\t\t\t\t\t>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tbem:elem="weather-icon"\n\t\t\t\t\t\t\tsrc="{attrs.weatherUrl}{weatherData.now_pict}.svg"\n\t\t\t\t\t\t\ttitle="{weatherData.now_description}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{weatherData.now_temp}°\n\t\t\t\t\t</a>\n\n\t\t\t\t\t<span bem:elem="more">\n\t\t\t\t\t\t<b:list-letter-welcome-dropdown-actions\n\t\t\t\t\t\t\tuse:mediator="welcome-block-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="secondary" fn:if="withGreeting">\n\t\t\t\t\t<span bem:elem="date">\n\t\t\t\t\t\t{_this.getDate(true)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<a\n\t\t\t\t\t\tfn:if="weatherData && withGreeting"\n\t\t\t\t\t\thref="{weatherData.link}"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\tbem:elem="weather"\n\t\t\t\t\t\tremit:click="weather"\n\t\t\t\t\t\tqa:id="weather"\n\t\t\t\t\t>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tbem:elem="weather-icon"\n\t\t\t\t\t\t\tsrc="{attrs.weatherUrl}{weatherData.now_pict}.svg"\n\t\t\t\t\t\t\ttitle="{weatherData.now_description}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{weatherData.now_temp}°\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="suggestions">\n\t\t<bem:mod name="expanded" test="attrs.expanded"/>\n\n\t\t<b:list-letter-welcome-suggestions\n\t\t\tuse:mediator="welcome-block-manager layout-manager"\n\t\t\titems="{_this.getSuggestions()}"\n\t\t/>\n\t</div>\n\n\t<fn:if test="is3pane">\n\t\t<span\n\t\t\tbem:elem="expand"\n\t\t\tfn:if="attrs.skillsEnabled"\n\t\t\tremit:click="onExpandClick"\n\t\t>\n\t\t\t{i18n(\'Показать больше\')}\n\t\t</span>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html")});define("feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t\x3c!-- Content --\x3e\n\t<b:dropdown\n\t\tdisable-expand-center\n\t\texpand-left\n\t\tico="navigation:more_vertical"\n\t\tponymode="{attrs[\'pony-mode\']}"\n\t\tpure\n\t\tshort\n\t\tradar-id="more"\n\t\tremit:dropdown-change-state="dropdown-change"\n\t>\n\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t<b:list>\n\t\t\t\t\x3c!-- Закрепить --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.pin"\n\t\t\t\t\tqa:id="pin"\n\t\t\t\t\tradar-id="pin"\n\t\t\t\t\tremit:click="welcomeblock:pin"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Закрепить\')}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Выбрать город --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.selectGeo"\n\t\t\t\t\tqa:id="selectGeo"\n\t\t\t\t\tradar-id="geo"\n\t\t\t\t\tremit:click="welcomeblock:selectgeo"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Выбрать город\')}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Скрыть до завтра --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.snooze"\n\t\t\t\t\tqa:id="snooze"\n\t\t\t\t\tradar-id="snooze"\n\t\t\t\t\tremit:click="welcomeblock:snooze"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Скрыть до завтра\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html")});define("feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions",["require","exports","feast","feast-tpl!./list-letter-welcome-dropdown-actions.html","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Events=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g;(function(a){a["PIN"]="welcomeblock:pin";a["SELECT_GEO"]="welcomeblock:selectgeo";a["SNOOZE"]="welcomeblock:snooze"})(g=exports.Events||(exports.Events={}));exports.default=a.default.Block.extend({name:"list-letter-welcome-dropdown-actions",rootClassName:"wlcm-d-a",template:b.default,immutable:true,isolate:true,isolateEvents:true,blocks:{dropdown:c.default,ico:d.default,list:e.default,"list-item":f.default},defaults:{compact:false,pin:false,selectGeo:true,snooze:true}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="ponymode" test="attrs.ponyMode"/>\n\n\t<fn:match name="item" args="item, index">\n\t\t<span\n\t\t\tbem:elem="item"\n\t\t\tkey="{index}"\n\t\t\tremit:click="suggestion:click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="item-icon">\n\t\t\t\t<img src="{item.icon}"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="item-content">\n\t\t\t\t<span bem:elem="item-title">\n\t\t\t\t\t<fn:value>item.title</fn:value>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="item-text">\n\t\t\t\t\t<fn:value>item.text</fn:value>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</span>\n\t</fn:match>\n\n\t<div bem:elem="container">\n\t\t<fn:for data="attrs.items" as="item" key="index">\n\t\t\t<fn:apply-match name="item" args="item, index"/>\n\t\t</fn:for>\n\t</div>\n\n\t<div bem:elem="arrow" style="left: 8px;">\n\t\t<b:ico name="navigation:arrow_list_previous" size="s"/>\n\t</div>\n\n\t<div bem:elem="arrow" style="right: 8px;">\n\t\t<b:ico name="navigation:arrow_list_next" size="s"/>\n\t</div>\n\n</div>\n',"app/feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html")});define("feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions",["require","exports","feast","feast-tpl!./list-letter-welcome-suggestions.html","ui-block/ico/ico"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Events=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d;(function(a){a["SuggestionClick"]="suggestion:click"})(d=exports.Events||(exports.Events={}));exports.default=a.default.Block.extend({name:"list-letter-welcome-suggestions",template:b.default,immutable:true,defaults:{items:[],events:d,ponyMode:false},blocks:{ico:c.default},events:{}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-welcome/list-letter-welcome",["require","exports","default-values","feast","feast-tpl!./list-letter-welcome.html","service/radars/decorator","ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions","../../feast-mod/utils"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Events=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var h={night:i18n("Доброй ночи"),morning:i18n("Доброе утро"),day:i18n("Добрый день"),evening:i18n("Добрый вечер")};var i;(function(a){a["MOUNT"]="listletterwelcome:mount";a["SHOW"]="listletterwelcome:show";a["HIDE"]="listletterwelcome:hide"})(i=exports.Events||(exports.Events={}));var j=false;var k=false;exports.default=b.default.Block.extend(d.default({id:"ll-wlcm",events:["weather","logo"],explicit:true})({name:"list-letter-welcome",template:c.default,immutable:true,defaults:{expanded:false,type:"2pane",ponyMode:false,marusiaLogo:a.MARUSIA_LOGO,marusiaUrl:a.MARUSIA_URL,weatherUrl:a.WEATHER_URL,skillsEnabled:false},blocks:{"list-letter-welcome-dropdown-actions":e.default,"list-letter-welcome-suggestions":f.default},events:{logo:"onLogoClick",expand:"onExpandClick"},attrChanged:{model:function(a,b){b===null||b===void 0?void 0:b.off("change",this.onModelChange);a.on("change",this.onModelChange)}},constructor:function(){b.default.Block.apply(this,arguments);this.onModelChange=this.onModelChange.bind(this)},didMount:function(){this.broadcast(i.MOUNT)},didUpdate:function(){var a=this.get("model");if(a===null||a===void 0?void 0:a.is("visible")){if(!j){j=true;this.radar("show")}}else if(!k){k=true;this.radar("hide")}},didUnmount:function(){this.broadcast(i.HIDE)},onModelChange:function(a){var b;if((b=a.changed)===null||b===void 0?void 0:b.hasOwnProperty("hidden")){this.broadcast(a.changed.hidden?i.HIDE:i.SHOW)}},onLogoClick:function(){},onExpandClick:function(){this.set("expanded",!this.get("expanded"))},getImage:function(){return'background-image: url("'+this.get("marusiaLogo")+'");'},getUsername:function(){var a=this.get("current-user");if(!a){return""}return a.get("name.first")},getHeader:function(){var a=this.getUsername();var b=this.get("model");if(!(b===null||b===void 0?void 0:b.is("withGreeting"))){return this.getDate(this.get("type")==="3pane")}if(a){return i18n("{hello}, {username}",{hello:this.getGreeting(),username:a})}else{return i18n("Доброе утро")}},getGreeting:function(){var a=new Date;var b=a.getHours();switch(true){case b<6:return h.night;case b<12:return h.morning;case b<18:return h.day;default:return h.evening}},getDate:function(a){return g.capitalize(g.formatDate(new Date,[["weekday","long"],["day","numeric"],["month","long"]],{literalAfter:{weekday:", ",day:" "}})).replace(/([^\d\s]{3})[^\d\s]+$/,a?"$1":"$&")},getWeatherData:function(){var a=this.get("model");return a===null||a===void 0?void 0:a.get("weatherData")},getSuggestions:function(){return[{skill:"music",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_music.svg",title:"Музыка",text:"Поставь что-нибудь весёлое"},{skill:"answers",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_fact.svg",title:"Ответы",text:"Где находится Эльбрус?"},{skill:"calc",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_calculator.svg",title:"Калькулятор",text:"Сложи числа"},{skill:"timer",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_timer.svg",title:"Таймер",text:"Установи таймер"}]}}))});define("feast-tpl!app/feast-tpl!ui-block/metathread/metathread.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="model" value="{attrs.model}"/>\n\t<fn:var name="folderId" value="{model.get(\'metathread_data.folder\')}" />\n\t<fn:var name="folderName" value="{model.get(\'metathread_data.folder_name\')}" />\n\t\x3c!-- Метатред первый в списке писем --\x3e\n\t<fn:var name="isFirst" value="{attrs.first}"/>\n\t\x3c!-- Метатред без отступа? --\x3e\n\t<fn:var name="disableSpacer" value="{attrs[\'disable-spacer\']}"/>\n\t\x3c!-- Метатред последний в списке писем --\x3e\n\t<fn:var name="isLast" value="{attrs.last}"/>\n\t\x3c!-- Метатред раскрыт, если model.isExpanded --\x3e\n\t<fn:var name="isExpanded" value="{model.isExpanded()}"/>\n\t\x3c!-- 3pane --\x3e\n\t<fn:var name="isCompact" value="{attrs.compact}"/>\n\t\x3c!-- Компактный вид --\x3e\n\t<fn:var name="ponymode" value="{attrs.ponymode}"/>\n\t\x3c!-- Укороченный дропдаун --\x3e\n\t<fn:var name="isShortDropdown" value="{attrs[\'short-dropdown\']}"/>\n\t\x3c!-- Укороченный текст --\x3e\n\t<fn:var name="isShortText" value="{attrs[\'short-text\']}"/>\n\t\x3c!-- Выбран галкой --\x3e\n\t<fn:var name="isSelected" value="{attrs.selected}"/>\n\t\x3c!-- Прилип --\x3e\n\t<fn:var name="isSticky" value="{_this.isStickyEnabled() && isExpanded && attrs.sticky}"/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="first" test="isFirst" />\n\t<bem:mod name="last" test="isLast" />\n\t<bem:mod name="expanded" test="isExpanded" />\n\t<bem:mod name="collapsed" test="!isExpanded" />\n\t<bem:mod name="sticky" test="isSticky" />\n\t<bem:mod name="first-sticky" test="isFirst && isSticky"/>\n\t<bem:mod name="active" test="isSelected"/>\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\n\t\x3c!-- Содержимое --\x3e\n\t<div bem:elem="spacer" fn:if="!isFirst && !disableSpacer">\n\t\t\x3c!-- <bem:mod name="before" /> --\x3e\n\t</div>\n\n\t<div bem:elem="contain">\n\t\t<fn:choose>\n\t\t\t<fn:when test="!isCompact">\n\t\t\t\t<b:metathread-head-common\n\t\t\t\t\texpanded="{isExpanded}"\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\tmodel="{model}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\tselected="{isSelected}"\n\t\t\t\t\tisFirstSelected="{attrs.isFirstSelected}"\n\t\t\t\t\tisLastSelected="{attrs.isLastSelected}"\n\t\t\t\t\thas-selected="{attrs[\'has-selected\']}"\n\t\t\t\t\tshort-text="{isShortText}"\n\t\t\t\t\tsticky="{isSticky}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tnewSelection="{attrs.newSelection}"\n\t\t\t\t\tsmallUnreadBtn="{attrs.smallUnreadBtn}"\n\t\t\t\t\tredirectUrl="{attrs.redirectExp && _this.getUrl()}"\n\n\t\t\t\t\tevent:details="model"\n\t\t\t\t\tremit:click="click:metathread-item"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tremit:avatar="click:metathreadavatar"\n\t\t\t\t\tremit:link="click:metathread-link"\n\t\t\t\t\tremit:cleanmaster="click:cleanmaster"\n\t\t\t\t\tremit:scrollintoself="scrollintoself"\n\t\t\t\t\tremit:disable="click:disable"\n\t\t\t\t\tuse:mediator="letters-actions folders-actions"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="isCompact && isExpanded">\n\t\t\t\t<b:metathread-head-compact-expanded\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\tmodel="{model}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\tselected="{isSelected}"\n\t\t\t\t\thas-selected="{attrs[\'has-selected\']}"\n\t\t\t\t\tshort-dropdown="{isShortDropdown}"\n\t\t\t\t\tsticky="{isSticky}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tredirectUrl="{attrs.redirectExp && _this.getUrl()}"\n\n\t\t\t\t\tevent:details="model"\n\t\t\t\t\tremit:click="click:metathread-item"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tremit:avatar="click:metathreadavatar"\n\t\t\t\t\tremit:link="click:metathread-link"\n\t\t\t\t\tremit:cleanmaster="click:cleanmaster"\n\t\t\t\t\tremit:scrollintoself="scrollintoself"\n\t\t\t\t\tremit:disable="click:disable"\n\t\t\t\t\tuse:mediator="letters-actions folders-actions layout-manager"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:metathread-head-compact\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\tmodel="{model}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\tselected="{isSelected}"\n\t\t\t\t\tshort-dropdown="{isShortDropdown}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tredirectUrl="{attrs.redirectExp && _this.getUrl()}"\n\n\t\t\t\t\tevent:details="model"\n\t\t\t\t\tremit:click="click:metathread-item"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tremit:avatar="click:metathreadavatar"\n\t\t\t\t\tremit:link="click:metathread-link"\n\t\t\t\t\tremit:cleanmaster="click:cleanmaster"\n\t\t\t\t\tremit:scrollintoself="scrollintoself"\n\t\t\t\t\tuse:mediator="letters-actions folders-actions"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\n\t\t\x3c!-- Разделители вокруг расхлопнутого метатреда --\x3e\n\t\t<b:delimeter compact="{isCompact}" ponymode="{ponymode}" qa:id="qqq1" indentRight="{attrs.newSelection}" />\n\t\t<b:delimeter last compact="{isCompact}" ponymode="{ponymode}" qa:id="qqq2" indentRight="{attrs.newSelection}" />\n\t</div>\n\n\t\x3c!-- Разделитель для предыдущего письма в открытом и закрытом состоянии --\x3e\n\t<b:delimeter full="{isExpanded}" compact="{isCompact}" ponymode="{ponymode}" qa:id="qqq3" indentRight="{attrs.newSelection}"/>\n</div>\n',"app/feast-tpl!ui-block/metathread/metathread.html")});define("feast-tpl!ui-block/metathread/metathread.html",["feast-tpl!app/feast-tpl!ui-block/metathread/metathread.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/metathread-head-common/metathread-head-common.html",["feast"],function(a){return a.smartParse('<a qa:id="{_this.rootQaId()}" qa:state="{_this.rootQaState()}">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="title" value="{_this.getName()}"/>\n\t<fn:var name="new_cnt" value="{_this.getNewCount()}"/>\n\t<fn:var name="isunread" value="{_this.hasUnread()}"/>\n\t<fn:var name="senders" value="{_this.getSenders()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="sticky" value="{attrs.sticky}"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t<fn:attr name="href" value="{attrs.redirectUrl}" test="attrs.redirectUrl"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="collapsed" test="!attrs.expanded"/>\n\t<bem:mod name="pony-mode" test="ponymode"/>\n\t<bem:mod name="sticky" test="sticky"/>\n\t<bem:mod name="not-sticky" test="!sticky"/>\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\t<bem:mod name="active" test="attrs.selected"/>\n\n\t\x3c!-- Блок, погнали! --\x3e\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Значок непрочитанности --\x3e\n\t\x3c!-- Read status:Start --\x3e\n\t<div bem:elem="read-status" qa:id="unread">\n\t\t<b:read-status\n\t\t\tstate="{isunread}"\n\t\t\tis-forwarded="{false}"\n\t\t\tis-replied="{false}"\n\t\t\tdotSize="{attrs.smallUnreadBtn ? \'small\' : \'normal\'}"\n\t\t\tmodel="{data}"\n\t\t\tremit:toggle.prevent.stop="metathreadtogglestatus:unread"\n\t\t/>\n\t</div>\n\t\x3c!-- Read status:End --\x3e\n\n\t\x3c!-- Иконка метатреда --\x3e\n\t\x3c!-- Avatar:Start --\x3e\n\t<div bem:elem="avatar" qa:id="avatar">\n\t\t<b:metathread-avatar\n\t\t\tcentered\n\t\t\tmodel="{data}"\n\t\t\tsize="common"\n\t\t\tstate="{attrs.selected}"\n\t\t\ttype="{type}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tremit:toggle="avatar"\n\t\t/>\n\t</div>\n\t\x3c!-- Avatar:End --\x3e\n\n\t\x3c!-- Содержимое элемента --\x3e\n\t\x3c!-- Content:Start --\x3e\n\t<div bem:elem="content">\n\n\t\t\x3c!-- Название папки метатреда --\x3e\n\t\t\x3c!-- Title:Start --\x3e\n\t\t<div\n\t\t\tbem:elem="item"\n\t\t\tbem:mod="title"\n\t\t\tqa:id="title">\n\t\t\t<b:metathread-title\n\t\t\t\ttitle="{title}"\n\t\t\t\ttype="{type}"\n\t\t\t\tunread="{isunread}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t/>\n\t\t</div>\n\n\t\t\x3c!-- Toolbar: Start --\x3e\n\t\t<fn:choose>\n\t\t\t\x3c!-- Свёрнут --\x3e\n\t\t\t\x3c!-- Collapsed:Start --\x3e\n\t\t\t<fn:when test="!attrs.expanded">\n\t\t\t\t\x3c!-- Количество новых писем в треде: NEW --\x3e\n\t\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="new_cnt"\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="new_cnt"\n\t\t\t\t\tqa:id="new_cnt">\n\t\t\t\t\t<b:metathread-badge counter="{new_cnt}"/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="snippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="data.isToMyself()">\n\t\t\t\t\t\t\t<b:metathread-snippet-tomyself senders="{senders}" />\n\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t<b:metathread-snippet senders="{senders}" />\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Время отправки последнего письма в папке --\x3e\n\t\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="date"\n\t\t\t\t\tqa:id="date">\n\t\t\t\t\t<b:letter-date date="{data.get(\'date\')}"/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Date:End --\x3e\n\t\t\t</fn:when>\n\t\t\t\x3c!-- Collapsed:End --\x3e\n\n\t\t\t\x3c!-- Развёрнут --\x3e\n\t\t\t\x3c!-- Expanded: Start --\x3e\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- Удалить все письма из папки --\x3e\n\t\t\t\t\x3c!-- Не показываем эту кнопку для метатреда "Письма себе" --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="!attrs[\'has-selected\']"\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="button"\n\t\t\t\t\tqa:id="delete"\n\t\t\t\t\tfn:if="!data.isToMyself()"\n\t\t\t\t>\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tcompact="{ponymode}"\n\t\t\t\t\t\tico="actions:delete"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\ttext="{_this.getRemoveButtonText()}"\n\t\t\t\t\t\tremit:click.prevent.stop="metathread:deleteall"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Пометить все письма прочитанным --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="isunread && !attrs[\'has-selected\']"\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="button"\n\t\t\t\t\tqa:id="read-all">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tcompact="{ponymode}"\n\t\t\t\t\t\tico="status:read"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\ttext="{_this.getMarkAllReadText()}"\n\t\t\t\t\t\tremit:click.prevent.stop="metathread:readall"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Ещё --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="more"\n\t\t\t\t\tqa:id="more"\n\t\t\t\t\tremit:click.prevent.stop\n\t\t\t\t>\n\t\t\t\t\t<b:metathread-dropdown-actions\n\t\t\t\t\t\tmodel="{data}"\n\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\tcleanmaster="{!data.isToMyself()}"\n\t\t\t\t\t\tdisable="{data.isToMyself() && !attrs[\'hide-disable-to-myself-metathread\']}"\n\n\t\t\t\t\t\tremit:cleanmaster="cleanmaster"\n\t\t\t\t\t\tremit:navigate="link"\n\t\t\t\t\t\tremit:disable="disable"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Expanded: End --\x3e\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t\t\x3c!-- Toolbar: End --\x3e\n\t</div>\n\t\x3c!-- Content:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/metathread-head-common/metathread-head-common.html")});define("feast-tpl!ui-block/metathread-head-common/metathread-head-common.html",["feast-tpl!app/feast-tpl!ui-block/metathread-head-common/metathread-head-common.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-letter-date/list-letter-date.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:value mod="letterDate">attrs.date</fn:value>\n</div>\n',"app/feast-tpl!ui-block/list-letter-date/list-letter-date.html")});define("feast-tpl!ui-block/list-letter-date/list-letter-date.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-date/list-letter-date.html"],function(a){return a});define("ui-block/list-letter-date/list-letter-date",["exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-date.html"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list-letter-date",rootClassName:"ll-d",template:e.default,immutable:true,isolate:true,isolateEvents:true,defaults:{date:""},mods:{letterDate:b.letterDate}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-avatar/metathread-avatar.html",["feast"],function(a){return a.smartParse('<button\n\ttype="button"\n\tremit:click.stop="toggle"\n\tqa:id="selected:{!!attrs.state}"\n>\n\t<bem:mod name="is-active" test="attrs.state"/>\n\t<bem:mod name="size_{attrs.size}"/>\n\t<bem:mod name="type_{attrs.type}"/>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\t<bem:mod name="disabled" test="attrs[\'disable-select\']"/>\n\t<bem:mod name="centered" test="attrs.centered"/>\n\n\t<div\n\t\tbem:elem="container"\n\t\ttitle="{_this.getTitle()}"\n\t\tpromo:id="{_this.getPromoIcoId()}"\n\t>\n\t\t\x3c!-- Чекбокс на тач устройствах --\x3e\n\t\t<bem:mod name="touch" test="attrs[\'touch\']"/>\n\n\t\t<span\n\t\t\tbem:elem="checkbox"\n\t\t\tfn:if="!attrs[\'touch\']"\n\t\t>\n\t\t\t<b:checkbox checked="{attrs.state}"/>\n\t\t</span>\n\n\t\t<span bem:elem="img">\n\t\t\t<b:ico\n\t\t\t\tname="{_this.getIco()}"\n\t\t\t\tsize="{_this.getIcoSize()}"/>\n\t\t</span>\n\t</div>\n</button>\n',"app/feast-tpl!ui-block/metathread-avatar/metathread-avatar.html")});define("feast-tpl!ui-block/metathread-avatar/metathread-avatar.html",["feast-tpl!app/feast-tpl!ui-block/metathread-avatar/metathread-avatar.html"],function(a){return a});define("ui-block/metathread-avatar/metathread-avatar",["exports","feast","feast-tpl!./metathread-avatar.html","ui-block/checkbox/checkbox","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"metathread-avatar",rootClassName:"mt-a",template:f.default,immutable:true,isolate:true,defaults:{indent:false,model:null,state:false,size:"common",type:"social","disable-select":false,"disable-hover":false},notVisualAttributes:{indent:true,model:true,state:false,type:false,"disable-select":false,"disable-hover":true},blocks:{ico:h.default,checkbox:g.default},METATHREAD_TYPES:{social:"navigation:users",newsletters:"categories:mailings",tomyself:"categories:self_mail",news:"categories:subscriptions",official:"categories:government",receipts:"categories:receipts",school:"categories:school",games:"categories:games"},METATHREAD_PROMO_ICO_IDS:{official:"octavius-tooltip-government-metathread-ico"},didMount:function a(){this.el.classList.add("stop-animate")},getTitle:function a(){if(this.get("disable-select")){return false}return this.get("state")?i18n("Снять выделение"):i18n("Выделить")},getIco:function a(){return this.METATHREAD_TYPES[this.get("type")]},getIcoSize:function a(){if(this.get("size")==="common"){return"s"}return"xl"},getPromoIcoId:function a(){return this.METATHREAD_PROMO_ICO_IDS[this.get("type")]}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-badge/metathread-badge.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var\n\t\tname="text"\n\t\tvalue="New"\n\t\ttest="attrs.counter > 0"/>\n\n\t<b:letter-category text="{text}" fn:if="text"/>\n</div>\n',"app/feast-tpl!ui-block/metathread-badge/metathread-badge.html")});define("feast-tpl!ui-block/metathread-badge/metathread-badge.html",["feast-tpl!app/feast-tpl!ui-block/metathread-badge/metathread-badge.html"],function(a){return a});define("ui-block/metathread-badge/metathread-badge",["exports","feast","feast-tpl!./metathread-badge.html","ui-block/letter-category/letter-category"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"metathread-badge",rootClassName:"mt-b",template:e.default,immutable:true,isolate:true,isolateEvents:true,blocks:{"letter-category":f.default},defaults:{counter:0},mods:{}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t\x3c!-- Content --\x3e\n\t<b:dropdown\n\t\tdisable-expand-center\n\t\texpand-left\n\t\tico="navigation:more_vertical"\n\t\tponymode="{attrs[\'pony-mode\']}"\n\t\tpure\n\t\tshort\n\t\tradar-id="ctrl"\n\t\tremit:dropdown-change-state="dropdown-change"\n\t>\n\t\t<fn:match name="items" args="dropdownArgs" remit:click.prevent>\n\t\t\t<b:list>\n\t\t\t\t\x3c!-- Удалить все письма из папки --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.deleteall"\n\t\t\t\t\tqa:id="deleteall"\n\t\t\t\t\tremit:click="deleteall"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="actions:delete"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getRemoveButtonText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Пометить все письма прочитанным --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.readall"\n\t\t\t\t\tqa:id="readall"\n\t\t\t\t\tremit:click="readall"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="status:read"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getMarkAllReadText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Настроить Рассылки --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="cleanmaster"\n\t\t\t\t\tremit:click.prevent="cleanmaster"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t\tfn:if="attrs.cleanmaster"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="navigation:settings"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getCleanmasterText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Перейти в папку метатреда --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="navigate"\n\t\t\t\t\tremit:click.prevent="navigate"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="navigation:folder"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getNavigationText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Отключить метатред --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="disable"\n\t\t\t\t\tremit:click.prevent="disable"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t\tfn:if="attrs.disable"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="navigation:settings"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getDisableText()}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html")});define("feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html",["feast-tpl!app/feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html"],function(a){return a});define("ui-block/metathread-dropdown-actions/metathread-dropdown-actions",["exports","feast","feast-tpl!./metathread-dropdown-actions.html","helpers/metathreads","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=n(a);var i=n(b);var j=n(d);var k=n(e);var l=n(f);var m=n(g);function n(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"metathread-dropdown-actions",rootClassName:"mt-d-a",template:i.default,immutable:true,isolate:true,isolateEvents:true,blocks:{dropdown:j.default,ico:k.default,list:l.default,"list-item":m.default},defaults:{compact:false,deleteall:false,model:null,"pony-mode":false,readall:false,cleanmaster:true,disable:false},getCleanmasterText:function a(){return i18n("Настроить рассылки")},getNavigationText:function a(){var b=this.get("model");if(b.isToMyself()){return i18n("Перейти в папку")}return i18n("Перейти в папку")+(" "+(0,c.getShortname)(b))},getRemoveButtonText:function a(){return(0,c.getRemoveButtonText)(this.get("model"))},getDisableText:function a(){var b=this.get("model");if(b.isToMyself()){return i18n("Отключить группировку")}},getMarkAllReadText:c.getMarkAllReadText})});define("ui-block/metathread-head-common/metathread-head-abstract",["exports","data-source/actions","helpers/data-source-dispatch","helpers/metathreads","mail/Folder"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFolder=h;exports.getType=i;exports.getName=j;exports.getNewCount=k;exports.getRemoveButtonText=l;exports.getMarkAllReadText=m;exports.hasUnread=n;exports.getSenders=o;exports.onMetathreadReadAll=p;exports.onMetathreadDeleteAll=q;exports.rootQaId=r;exports.rootQaState=s;exports.sendersCount=t;exports.getSendersTooltip=u;var e=g(b);var f=g(d);function g(a){return a&&a.__esModule?a:{default:a}}function h(){var a=this.get("model");var b=a.get("metathread_data.folder");return f.default.get(b)}function i(){return this.get("model").get("metathread_data.category")}function j(){return this.get("model").get("metathread_data.folder_name")}function k(){return this.get("model").get("metathread_data.new_cnt")}function l(){return(0,c.getRemoveButtonText)(this.get("model"),this.is("short-text"))}function m(){return(0,c.getMarkAllReadText)()}function n(){return this.get("model").get("flags.unread")}function o(){var a=this.get("model").get("metathread_data.last_senders");var b=this.hasUnread();if(!b){a.forEach(function(a){a.unread=false})}return a}function p(){var b=this.get("model");if(this.is("sticky")){this.broadcast("scrollintoself")}(0,e.default)({type:a.TOGGLE_METATHREAD,state:false,model:b});this.broadcast("read",{model:this.getFolder()})}function q(){this.broadcast("clear",{model:this.getFolder()})}function r(){var a=this.get("model").get("metathread_data.folder");return"metathread-item:folder:"+a}function s(){var a=this.is("expanded");return a?"expanded":"collapsed"}function t(a){return i18n.plural(a,[i18n("{count} отправителей",{count:a}),i18n("{count} отправитель",{count:a}),i18n("{count} отправителя",{count:a})])}function u(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"name";if(a.length<=8){return a.map(function(a){return a[b]}).join(", ")}if(a.length>8){var c=a.length-8;return a.filter(function(a,b){return b<8}).map(function(a){return a[b]}).join(", ")+i18n(" и ещё")+t(c)}}});define("feast-tpl!app/feast-tpl!ui-block/metathread-snippet/metathread-snippet.html",["feast"],function(a){return a.smartParse('<div qa:id="metathread-snippet">\n\t<fn:var name="lastIdx" value="{attrs.senders.length - 1}"/>\n\n\t<fn:for\n\t\tdata="attrs.senders"\n\t\tas="sender"\n\t\tkey="idx">\n\t\t<span bem:elem="sender" key="{attrs.id + \':\' + idx}">\n\t\t\t<bem:mod name="unread" test="sender.unread"/>\n\t\t\t<fn:value>sender.name</fn:value>\n\t\t\t<fn:value>idx !== lastIdx ? \', \' : \'\'</fn:value>\n\t\t</span>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/metathread-snippet/metathread-snippet.html")});define("feast-tpl!ui-block/metathread-snippet/metathread-snippet.html",["feast-tpl!app/feast-tpl!ui-block/metathread-snippet/metathread-snippet.html"],function(a){return a});define("ui-block/metathread-snippet/metathread-snippet",["exports","feast","feast-tpl!./metathread-snippet.html","service/emoji"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"metathread-snippet",rootClassName:"mt-snt",template:e.default,immutable:true,isolate:true,defaults:{senders:[]},didMount:function a(){(0,c.emojiFallback)(this.el,"ms")},didUpdate:function a(){(0,c.emojiFallback)(this.el,"ms")}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html",["feast"],function(a){return a.smartParse('<div qa:id="metathread-snippet">\n\t<fn:var name="senders" value="{_this.getSenders()}" />\n\t<fn:var name="lastIdx" value="{senders.length - 1}" />\n\n\t<bem:mod name="preview" test="attrs.preview" />\n\t<bem:mod name="compact" test="attrs.compact" />\n\n\t<fn:for data="senders" as="sender" key="idx">\n\t\t<span bem:elem="subject" key="{attrs.id + \':\' + idx}">\n\t\t\t<bem:mod name="unread" test="sender.unread" />\n\t\t\t<bem:mod name="compact" test="attrs.compact" />\n\t\t\t<bem:mod name="preview" test="attrs.preview" />\n\n\t\t\t<span bem:elem="subject-value">\n\t\t\t\t<bem:mod name="preview" test="attrs.preview" />\n\t\t\t\t<fn:value>sender.subject</fn:value>\n\t\t\t</span>\n\n\t\t\t<span fn:if="idx !== lastIdx">,&nbsp;</span>\n\t\t</span>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html")});define("feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html",["feast-tpl!app/feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html"],function(a){return a});define("ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself",["exports","service/emoji","default-values","feast","feast-tpl!./metathread-snippet-tomyself.html"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=g(c);var f=g(d);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"metathread-snippet",rootClassName:"mt-snt-tmslf",template:f.default,immutable:true,isolate:true,defaults:{senders:[],"max-count":b.METATHREAD_TOMYSELF_SNIPPET_ITEMS_MAX_COUNT},getSenders:function a(){var b=this.get("max-count");var c=this.is("preview");var d=this.get("senders");var e=typeof b!=="undefined"&&!c;return e?d.slice(0,b):d},didMount:function b(){(0,a.emojiFallback)(this.el,"mst")},didUpdate:function b(){(0,a.emojiFallback)(this.el,"mst")}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-title/metathread-title.html",["feast"],function(a){return a.smartParse('<span qa:id="metathread-title">\n\t<bem:mod name="{attrs.type}"/>\n\t<bem:mod name="unread" test="attrs.unread"/>\n\t<bem:mod name="ponymode" test="attrs[\'pony-mode\']"/>\n\t{attrs.title}\n</span>\n',"app/feast-tpl!ui-block/metathread-title/metathread-title.html")});define("feast-tpl!ui-block/metathread-title/metathread-title.html",["feast-tpl!app/feast-tpl!ui-block/metathread-title/metathread-title.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/metathread-title/metathread-title",["require","exports","feast","feast-tpl!./metathread-title.html"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"metathread-title",rootClassName:"mt-t",template:b.default,immutable:true,isolate:true,defaults:{"pony-mode":false,title:"",type:"social",unread:false}})});define("ui-block/metathread-head-common/metathread-head-common",["exports","default-values","feast","feast-tpl!./metathread-head-common.html","service/radars/decorator","ui-block/button2/button2","ui-block/list-letter-date/list-letter-date","ui-block/list-letter-read-status/list-letter-read-status","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-badge/metathread-badge","ui-block/metathread-dropdown-actions/metathread-dropdown-actions","ui-block/metathread-head-common/metathread-head-abstract","ui-block/metathread-snippet/metathread-snippet","ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself","ui-block/metathread-title/metathread-title"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var o=A(b);var p=A(c);var q=A(d);var r=A(e);var s=A(f);var t=A(g);var u=A(h);var v=A(i);var w=A(j);var x=A(l);var y=A(m);var z=A(n);function A(a){return a&&a.__esModule?a:{default:a}}exports.default=o.default.Block.extend((0,q.default)({id:"head",events:[{name:"metathreadtogglestatus:unread",rename:function a(b){return(b.is("expanded")?"expanded":"collapsed")+"_"+(b.get("model").is("flags.unread")?"read":"unread")+"_"+b.get("model").getMetathreadFolder()}},"clear","read"]})({name:"metathread-head-common",rootClassName:"mt-h-c",template:p.default,immutable:true,isolate:true,performanceTrace:true,blocks:{button2:r.default,"letter-date":s.default,"metathread-avatar":u.default,"metathread-badge":v.default,"metathread-dropdown-actions":w.default,"metathread-snippet":x.default,"metathread-snippet-tomyself":y.default,"metathread-title":z.default,"read-status":t.default},defaults:{first:false,expanded:false,model:null,"pony-mode":false,selected:false,"short-text":false,"hide-disable-to-myself-metathread":a.HIDE_DISABLE_TO_MYSELF_METATHREAD},notVisualAttributes:{model:true},events:{"metathread:readall":"onMetathreadReadAll","metathread:deleteall":"onMetathreadDeleteAll"},getFolder:k.getFolder,getType:k.getType,getName:k.getName,getNewCount:k.getNewCount,getSenders:k.getSenders,getRemoveButtonText:k.getRemoveButtonText,getMarkAllReadText:k.getMarkAllReadText,hasUnread:k.hasUnread,onMetathreadReadAll:k.onMetathreadReadAll,onMetathreadDeleteAll:k.onMetathreadDeleteAll,rootQaId:k.rootQaId,rootQaState:k.rootQaState}))});define("feast-tpl!app/feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html",["feast"],function(a){return a.smartParse('<a qa:id="{_this.rootQaId()}" qa:state="collapsed">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="title" value="{_this.getName()}"/>\n\t<fn:var name="new_cnt" value="{_this.getNewCount()}"/>\n\t<fn:var name="isunread" value="{_this.hasUnread()}"/>\n\t<fn:var name="senders" value="{_this.getSenders()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="avatar_size" value="{_this.getAvatarSize()}"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t<fn:attr name="href" value="{attrs.redirectUrl}" test="attrs.redirectUrl"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="pony-mode" test="ponymode"/>\n\t<bem:mod name="pony-mode-active" test="ponymode && attrs.selected"/>\n\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\t<bem:mod name="active" test="attrs.selected"/>\n\n\t\x3c!-- Блок, погнали! --\x3e\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Левая колонка элемента --\x3e\n\t<div bem:elem="header">\n\t\t\x3c!-- Значок непрочитанности --\x3e\n\t\t\x3c!-- Read status:Start --\x3e\n\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t<b:read-status\n\t\t\t\tdotSize="{attrs.smallUnreadBtn ? \'small\' : \'normal\'}"\n\t\t\t\tstate="{isunread}"\n\t\t\t\tis-forwarded="{false}"\n\t\t\t\tis-replied="{false}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tshift="{ponymode}"\n\t\t\t\tremit:toggle.prevent.stop="metathreadtogglestatus:unread"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Read status:End --\x3e\n\n\t\t\x3c!-- Иконка метатреда --\x3e\n\t\t\x3c!-- Avatar:Start --\x3e\n\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t<b:metathread-avatar\n\t\t\t\tmodel="{data}"\n\t\t\t\tsize="{avatar_size}"\n\t\t\t\tstate="{attrs.selected}"\n\t\t\t\ttype="{type}"\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tdisable-hover="{attrs.touch}"\n\t\t\t\tremit:toggle="avatar"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Avatar:End --\x3e\n\t</div>\n\n\t\x3c!-- Содержимое элемента --\x3e\n\t\x3c!-- Content:Start --\x3e\n\t<div bem:elem="content" ref="content">\n\t\t\x3c!-- Row:Start --\x3e\n\t\t<div bem:elem="row" bem:mod="1">\n\t\t\t\x3c!-- Название папки метатреда --\x3e\n\t\t\t\x3c!-- Title:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="title"\n\t\t\t\tqa:id="title">\n\t\t\t\t<b:metathread-title\n\t\t\t\t\ttitle="{title}"\n\t\t\t\t\ttype="{type}"\n\t\t\t\t\tunread="{isunread}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t\x3c!-- Время отправки последнего письма в папке --\x3e\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="date"\n\t\t\t\tqa:id="date">\n\t\t\t\t<b:letter-date date="{data.get(\'date\')}"/>\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Row:End --\x3e\n\n\t\t\x3c!-- Row:Start --\x3e\n\t\t<div bem:elem="row" bem:mod="2">\n\t\t\t\x3c!-- Список отправителей последних писем --\x3e\n\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="snippet"\n\t\t\t\tqa:id="snippet"\n\t\t\t\ttitle="{_this.getSendersTooltip(senders, data.isToMyself() ? \'subject\' : \'name\')}"\n\t\t\t>\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.isToMyself()">\n\t\t\t\t\t\t<b:metathread-snippet-tomyself senders="{senders}" compact />\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:metathread-snippet senders="{senders}" />\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\x3c!-- Количество новых писем в треде: NEW --\x3e\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tfn:if="new_cnt"\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="new_cnt"\n\t\t\t\tqa:id="new_cnt">\n\t\t\t\t<b:metathread-badge counter="{new_cnt}"/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Row:End --\x3e\n\t\t\x3c!-- Toolbar: End --\x3e\n\t</div>\n\t\x3c!-- Content:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html")});define("feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html",["feast-tpl!app/feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html"],function(a){return a});define("ui-block/metathread-head-compact/metathread-head-compact",["exports","feast","feast-tpl!./metathread-head-compact.html","service/radars/decorator","ui-block/list-letter-date/list-letter-date","ui-block/list-letter-read-status/list-letter-read-status","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-badge/metathread-badge","ui-block/metathread-head-common/metathread-head-abstract","ui-block/metathread-snippet/metathread-snippet","ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself","ui-block/metathread-title/metathread-title","service/emoji"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var m=w(a);var n=w(b);var o=w(c);var p=w(d);var q=w(e);var r=w(f);var s=w(g);var t=w(i);var u=w(j);var v=w(k);function w(a){return a&&a.__esModule?a:{default:a}}exports.default=m.default.Block.extend((0,o.default)({id:"item-metathread",events:["clickavatar","togglestatus:unread","remove"]})({name:"metathread-head-compact",rootClassName:"mt-h-compact",template:n.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"letter-date":p.default,"metathread-avatar":r.default,"metathread-badge":s.default,"metathread-snippet":t.default,"metathread-snippet-tomyself":u.default,"metathread-title":v.default,"read-status":q.default},defaults:{first:false,model:null,"pony-mode":false,selected:false},notVisualAttributes:{model:true},events:{"metathread:readall":"onMetathreadReadAll","metathread:deleteall":"onMetathreadDeleteAll"},didMount:function a(){(0,l.emojiFallback)(this.refs.content,"mhc")},didUpdate:function a(){(0,l.emojiFallback)(this.refs.content,"mhc")},getFolder:h.getFolder,getType:h.getType,getName:h.getName,getNewCount:h.getNewCount,getSenders:h.getSenders,getSendersTooltip:h.getSendersTooltip,getRemoveButtonText:h.getRemoveButtonText,getMarkAllReadText:h.getMarkAllReadText,hasUnread:h.hasUnread,onMetathreadReadAll:h.onMetathreadReadAll,onMetathreadDeleteAll:h.onMetathreadDeleteAll,rootQaId:h.rootQaId,rootQaState:h.rootQaState,getAvatarSize:function a(){if(this.is("pony-mode")){return"common"}return"compact"}}))});define("feast-tpl!app/feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html",["feast"],function(a){return a.smartParse('<a qa:id="{_this.rootQaId()}" qa:state="expanded">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="title" value="{_this.getName()}"/>\n\t<fn:var name="isunread" value="{_this.hasUnread()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="sticky" value="{attrs.sticky}"/>\n\t<fn:var name="isShortDropdown" value="{attrs[\'short-dropdown\']}"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t<fn:attr name="href" value="{attrs.redirectUrl}" test="attrs.redirectUrl"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="pony-mode" test="ponymode"/>\n\t<bem:mod name="sticky" test="sticky"/>\n\t<bem:mod name="not-sticky" test="!sticky"/>\n\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\t<bem:mod name="active" test="attrs.selected"/>\n\n\t\x3c!-- Блок, погнали! --\x3e\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Значок непрочитанности --\x3e\n\t\x3c!-- Read status:Start --\x3e\n\t<div bem:elem="read-status" qa:id="unread">\n\t\t<b:read-status\n\t\t\tdotSize="{attrs.smallUnreadBtn ? \'small\' : \'normal\'}"\n\t\t\tstate="{isunread}"\n\t\t\tis-forwarded="{false}"\n\t\t\tis-replied="{false}"\n\t\t\tmodel="{data}"\n\t\t\tshift="{ponymode}"\n\t\t\tremit:toggle.prevent.stop="metathreadtogglestatus:unread"\n\t\t/>\n\t</div>\n\t\x3c!-- Read status:End --\x3e\n\n\t\x3c!-- Иконка метатреда --\x3e\n\t\x3c!-- Avatar:Start --\x3e\n\t<div bem:elem="avatar" qa:id="avatar">\n\t\t<b:metathread-avatar\n\t\t\tcentered\n\t\t\tmodel="{data}"\n\t\t\tsize="common"\n\t\t\tstate="{attrs.selected}"\n\t\t\ttype="{type}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tremit:toggle="avatar"\n\t\t/>\n\t</div>\n\t\x3c!-- Avatar:End --\x3e\n\n\t<div bem:elem="content">\n\t\t\x3c!-- Название папки метатреда --\x3e\n\t\t\x3c!-- Title:Start --\x3e\n\t\t<div\n\t\t\tbem:elem="item"\n\t\t\tbem:mode="title"\n\t\t\tqa:id="title">\n\t\t\t<b:metathread-title\n\t\t\t\ttitle="{title}"\n\t\t\t\ttype="{type}"\n\t\t\t\tunread="{isunread}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Title:End --\x3e\n\n\t\t\x3c!-- Ещё --\x3e\n\t\t\x3c!-- More:Start --\x3e\n\t\t<div\n\t\t\tbem:elem="item"\n\t\t\tbem:mod="more"\n\t\t\tqa:id="more"\n\t\t\tremit:click.prevent.stop\n\t\t>\n\n\t\t\t<b:metathread-dropdown-actions\n\t\t\t\tcompact="{isShortDropdown}"\n\t\t\t\tdeleteall="{!data.isToMyself() && !attrs[\'has-selected\']}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\treadall="{isunread && !attrs[\'has-selected\']}"\n\t\t\t\tcleanmaster="{!data.isToMyself() && !attrs.mobile}"\n\t\t\t\tdisable="{data.isToMyself() && !attrs[\'hide-disable-to-myself-metathread\']}"\n\n\t\t\t\tremit:cleanmaster="cleanmaster"\n\t\t\t\tremit:deleteall="metathread:deleteall"\n\t\t\t\tremit:navigate="link"\n\t\t\t\tremit:readall="metathread:readall"\n\t\t\t\tremit:disable="disable"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- More:End --\x3e\n\t</div>\n</a>\n',"app/feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html")});define("feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html",["feast-tpl!app/feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html"],function(a){return a});define("ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded",["exports","default-values","feast","feast-tpl!./metathread-head-compact-expanded.html","service/radars/decorator","ui-block/list-letter-read-status/list-letter-read-status","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-dropdown-actions/metathread-dropdown-actions","ui-block/metathread-head-common/metathread-head-abstract","ui-block/metathread-title/metathread-title"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=q(b);var k=q(c);var l=q(d);var m=q(e);var n=q(f);var o=q(g);var p=q(i);function q(a){return a&&a.__esModule?a:{default:a}}exports.default=j.default.Block.extend((0,l.default)({id:"item-metathread",events:["clickavatar","togglestatus:unread","remove"]})({name:"metathread-head-compact-expanded",rootClassName:"mt-h-compact-expanded",template:k.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"metathread-avatar":n.default,"metathread-dropdown-actions":o.default,"metathread-title":p.default,"read-status":m.default},defaults:{first:false,model:null,"pony-mode":false,selected:false,"short-dropdown":false,"hide-disable-to-myself-metathread":a.HIDE_DISABLE_TO_MYSELF_METATHREAD},notVisualAttributes:{model:true},events:{"metathread:readall":"onMetathreadReadAll","metathread:deleteall":"onMetathreadDeleteAll"},getFolder:h.getFolder,getType:h.getType,getName:h.getName,hasUnread:h.hasUnread,onMetathreadReadAll:h.onMetathreadReadAll,onMetathreadDeleteAll:h.onMetathreadDeleteAll,rootQaId:h.rootQaId,rootQaState:h.rootQaState}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/metathread/metathread",["require","exports","@mail/xray","data-source/actions","default-values","feast","feast-tpl!./metathread.html","helpers/browser","helpers/data-source-dispatch","helpers/keys","mail/Folder","service/radars/decorator","service/secure-folder","ui-block/delimeter/delimeter","ui-block/metathread-head-common/metathread-head-common","ui-block/metathread-head-compact/metathread-head-compact","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.block=void 0;a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);exports.block={name:"metathread",template:e.default,performanceTrace:"track",isolateEvents:false,mods:{},blocks:{delimeter:l.default,"metathread-head-common":m.default,"metathread-head-compact":n.default,"metathread-head-compact-expanded":o.default},defaults:{compact:false,expanded:false,first:false,model:null,ponymode:false,selected:false,"short-dropdown":false,"short-text":false,sticky:false,redirectExp:c.METATHREAD_REDIRECT},events:{"click:metathread-item":"onMetathreadItemClick",scrollintoself:"scrollIntoSelf"},onMetathreadItemClick:function(d){var e=this;var f,h,i;if(d.isDefaultPrevented()||d.isPropagationStopped()){return}var j=this.get("model");var k=(f=d===null||d===void 0?void 0:d.details)===null||f===void 0?void 0:f.getMetathreadFolder();if(!j.isExpanded()&&k!=null){a.default.send("letter-metathread-open",{dwh:{folder:j.getMetathreadFolderName(),folderID:k,ponymode:((h=this.props)===null||h===void 0?void 0:h.compact)||((i=this.attrs)===null||i===void 0?void 0:i.compact)?"3pane":"2pane"}})}if(c.METATHREAD_REDIRECT){this.onMetathreadItemClickRedirect(d);return}if(this.is("sticky")){this.scrollIntoSelf();return}g.default({type:b.TOGGLE_METATHREAD,state:!j.isExpanded(),model:j}).then(function(){var b,c;var d=!j.isExpanded()?"collapse":"expanded";a.default.send("letter-metathread-"+d,{dwh:{folder:j.getMetathreadFolderName(),folderID:k,ponymode:((b=e.props)===null||b===void 0?void 0:b.compact)||((c=e.attrs)===null||c===void 0?void 0:c.compact)?"3pane":"2pane"}})});this.broadcast("expand:toggle")},onMetathreadItemClickRedirect:function(b){var c=this;var d;var e=(d=b===null||b===void 0?void 0:b.details)===null||d===void 0?void 0:d.getMetathreadFolder();a.default.send("metathread-redirect",{dwh:{folder:e}});var f=b.originalEvent;if(f&&h.isNewTabClick(f)){return}var g=this.get("router");if(!g){return}b.preventDefault();i.default.findOne(e).then(function(a){(a.isSecureOpen()?Promise.resolve(true):k.default(a)).then(function(a){if(!a){return}g.nav(c.getUrl());c.broadcast("navigate:with:back:to:parent",{id:"#letters",params:{folder:e}})})})},getUrl:function(){var a=this.get("router");if(!a){return null}var b=this.get("model").getMetathreadFolder();return a.getUrl("#letters",{folder:b},c.METATHREAD_BACK_TO_INBOX&&{"to-parent-button":"1"})},scrollIntoSelf:function(){this.broadcast("scrollintomodel",{index:this.get("index")})},getMetathreadId:function(){return this.get("model").getMetathreadFolder()},isStickyEnabled:function(){return!c.IS_NATIVE_STICKY_DISABLED&&f.default.capabilities["sticky-support"]}};exports.default=d.default.Block.extend(j.default({events:[{name:"click:metathreadavatar",rename:function(a){return(a.is("selected")?"deselect_":"select_")+a.getMetathreadId()}},{name:"click:cleanmaster",rename:function(a){return"contextmenu_cleanmaster_"+a.getMetathreadId()}},{name:"click:metathread-link",rename:function(a){return"contextmenu_folder_"+a.getMetathreadId()}},{name:"click:metathread-item",rename:function(a){return(a.is("compact")?"3pane":"2pane")+"_"+(a.get("model").isExpanded()?"collapse":"expand")+"_"+a.getMetathreadId()}},{name:"scrollintomodel",rename:"scroll-to-sticky"}]})(exports.block))});define("feast-tpl!app/feast-tpl!ui-block/metathread-footer/metathread-footer.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="metathread" value="{attrs.model.get(\'metathread\')}"/>\n\t<fn:var name="folderId" value="{metathread.getMetathreadFolder()}"/>\n\t<fn:var name="folderName" value="{metathread.getMetathreadFolderName()}"/>\n\t\x3c!-- Поддержана ли "Загрузить ещё"? --\x3e\n\t<fn:var name="canLoadMore" value="{_this.canLoadMore()}"/>\n\n\t\x3c!-- Content --\x3e\n\t<div bem:elem="folder">\n\t\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="canLoadMore">\n\t\t\t\t<b:link\n\t\t\t\t\t\tqa:id="more-link"\n\t\t\t\t\t\ttext="{i18n(\'Загрузить ещё\')}"\n\t\t\t\t\t\tremit:click.prevent="more-link-click"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:link\n\t\t\t\t\t\tqa:id="folder-link"\n\t\t\t\t\t\thref="{_this.getLinkHref()}"\n\t\t\t\t\t\ttext="{_this.getGoToFolderText()}"\n\t\t\t\t\t\tunsafe\n\t\t\t\t\t\tremit:click="folder-link-click"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\n\t\x3c!-- Разделитель между футером метатреда и списком писем под ним --\x3e\n\t<div bem:elem="spacer"\n\t\t qa:id="metathread-spacer-after:folder:{folderId}"\n\t\t fn:if="!attrs[\'hide-footer-spacer\']">\n\t</div>\n\n\t\x3c!-- Верхний бордер --\x3e\n\t<b:delimeter ponymode="{ponymode}" compact="{attrs.compact}" indent/>\n</div>\n',"app/feast-tpl!ui-block/metathread-footer/metathread-footer.html")});define("feast-tpl!ui-block/metathread-footer/metathread-footer.html",["feast-tpl!app/feast-tpl!ui-block/metathread-footer/metathread-footer.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/metathread-footer/metathread-footer",["require","exports","data-source/actions","default-values","feast","feast-tpl!./metathread-footer.html","helpers/data-source-dispatch","pilotjs","service/radars/decorator","ui-block/delimeter/delimeter","ui-block/link/link"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);exports.default=c.default.Block.extend(g.default({id:"metathread-footer",events:[{name:"more-link-click",rename:function(a){return"load-more_"+a.getMetathreadId()}},{name:"folder-link-click",rename:function(a){return"folder_"+a.getMetathreadId()}}]})({name:"metathread-footer",template:d.default,blocks:{delimeter:h.default,link:i.default},defaults:{model:null,ponymode:false,router:null,"short-text":false},events:{"more-link-click":"handleLoadMoreClick"},constructor:function(){c.default.Block.apply(this,arguments);this.renderFromModel=this.renderFromModel.bind(this)},renderFromModel:function(){this.render()},didMount:function(){var a;(a=this.get("model").get("metathread"))===null||a===void 0?void 0:a.on("change",this.renderFromModel)},didUnmount:function(){var a;(a=this.get("model").get("metathread"))===null||a===void 0?void 0:a.off("change",this.renderFromModel)},handleLoadMoreClick:function(){e.default({type:a.LOAD_MORE_METATHREAD,model:this.get("model").get("metathread"),priority:f.default.Loader.PRIORITY_LOW})},canLoadMore:function(){var a=this.get("model").get("metathread");if(a.isLimitReached()){return false}var c=a.getLimit();var d=Math.ceil(c/b.METATHREAD_LIMIT);return d<b.METATHREAD_LOAD_MORE_COUNT_MAX},getLinkHref:function(){var a=this.get("router");return a.getUrl("#letters",{folder:this.getMetathreadId()})},getGoToFolderText:function(){var a=i18n("Перейти в папку");if(this.is("short-text")){return a}var b=this.get("model").get("metathread").getMetathreadFolderName();return a+(" «"+b+"»")},getMetathreadId:function(){return this.get("model").get("metathread").getMetathreadFolder()}}))});define("feast-tpl!app/feast-tpl!ui-block/octopus/octopus.html",["feast"],function(a){return a.smartParse('<div qa:id="octopus">\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="compact" test="type === \'no-select\'"/>\n\t<bem:mod name="full" test="type !== \'no-select\'"/>\n\t<bem:mod name="full-height" test="attrs[\'full-height\']"/>\n\t<bem:mod name="transparent" test="attrs.transparent"/>\n\t<bem:mod name="fixed" test="attrs.fixed"/>\n\n\t<div bem:elem="icon" qa:id="{type}:icon">\n\t\t<bem:mod name="{type}"/>\n\t\t<fn:attr name="style" value="background-image: url({_this.getIcon()});"/>\n\t</div>\n\n\t<div bem:elem="text" qa:id="{type}:text">\n\t\t<fn:choose>\n\t\t\t<fn:when test="type === \'empty-inbox-folder\'">\n\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t{i18n(\'Писем нет\')}\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'empty-folder\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'В папке нет писем.\')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tfn:if="_this.shouldDisplayFilter()"\n\t\t\t\t\t\t\tremit:click.prevent="settingsfilters:create"\n\t\t\t\t\t\t\tevent:details="{models: [], folder: attrs.folder.id}"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать фильтр\')}"\n\t\t\t\t\t\t\tqa:id="create-filter"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'trash\'">\n\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t{i18n(\'В корзине пусто\')}\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'spam\'">\n\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t<fn:value output="raw">messages.noSpam</fn:value>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'no-drafts\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<fn:value output="raw">messages.noDrafts</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'no-templates\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'У вас нет шаблонов писем.\')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<b:link\n\t\t\t\t\t\tcontrast\n\t\t\t\t\t\tremit:click.prevent="compose:new"\n\t\t\t\t\t\ttext="{i18n(\'Создать шаблон\')}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'no-filter\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Ничего не найдено\')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<b:link\n\t\t\t\t\t\tcontrast\n\t\t\t\t\t\tremit:click.prevent="filterclick"\n\t\t\t\t\t\tevent:details="\'all\'"\n\t\t\t\t\t\ttext="{i18n(\'Сбросить фильтр\')}"/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'no-search\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'По вашему запросу ничего не найдено\')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<fn:if test="attrs[\'show-search-in-excluded-folders\'] && attrs[\'search-has-operands\']">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="search:set-in-excluded-folders"\n\t\t\t\t\t\t\tevent:details="true"\n\t\t\t\t\t\t\ttext="{i18n(\'Искать в папках «Спам» и «Корзина»\')}"\n\t\t\t\t\t\t\tqa:id="search-octopus-enable-in-excluded-folders"\n\t\t\t\t\t\t\thref="{attrs[\'search-in-excluded-folders-url\']}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'no-select\'">\n\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t{i18n(\'Письма не выбраны\')}\n\t\t\t\t</span>\n\t\t\t\t<fn:if\n\t\t\t\t\ttest="_this.isAllreadButtonVisible()  && !attrs[\'read-all-in-progress\']">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="mark:allreaded"\n\t\t\t\t\t\t\ttext="{i18n(\'Отметить все письма прочитанными\')}"\n\t\t\t\t\t\t\tqa:id="mark-all-readed"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'secure-folder\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Доступ в папку запрещён.\')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<b:link\n\t\t\t\t\t\tcontrast\n\t\t\t\t\t\tremit:click.prevent="secure:opencurrent"\n\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'secure-search\'">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{messages.secureSearch}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="secure:open"\n\t\t\t\t\t\t\tevent:details="_this.getSearchSecureTargetFolderId()"\n\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="type === \'no-letter\'">\n\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t{i18n(\'Письмо не найдено\')}\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\t\t</fn:choose>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/octopus/octopus.html")});define("feast-tpl!ui-block/octopus/octopus.html",["feast-tpl!app/feast-tpl!ui-block/octopus/octopus.html"],function(a){return a});define("helpers/allread-button-visible",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isAllreadButtonVisible=void 0;function b(b,c){if(!b.all&&!b.unread){return false}var d=c.folder;if(!d.get("messages_unread")){return false}if(a.ALL_READ_BUTTON){return true}var e=d?d.isMetathread():false;if(e&&a.ALL_READ_METATHREADS_ONLY){return true}return false}exports.isAllreadButtonVisible=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/octopus/octopus",["require","exports","data-source/actions","data-source/index","default-values","feast","feast-tpl!./octopus.html","helpers/allread-button-visible","helpers/data-source-dispatch","mail/Folder","service/mailbox/loader","service/radars/decorator","service/radars/index","service/secure-folder","ui-block/link/link"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);var n={"empty-inbox-folder":"ic_empty-folder","empty-folder":"ic_empty-folder","no-select":"ic_no-select","no-templates":"ic_no-templates","no-drafts":"ic_no-templates","no-filter":"ic_empty-folder","no-search":"ic_no-search",spam:"ic_spam",trash:"ic_trash","secure-folder":"ic_lock","secure-search":"ic_lock","no-letter":"ic_no-letter"};exports.default=d.default.Block.extend(j.default({events:["settingsfilters:create","compose:new","filterclick","secure:opencurrent","mark:allreaded",{name:"search:set-in-excluded-folders",rename:"search:excluded"}]})({name:"octopus",template:e.default,defaults:{fallback:0&&!c.IS_CHROME,type:"empty-inbox-folder"},_autoShow:true,blocks:{link:m.default},isSearchSecureNotOpen:function(){var a=this.get("router");var b=a&&a.model.search.error;return b instanceof i.SecureFolderNotOpenError},getSearchSecureTargetFolderId:function(){if(!this.isSearchSecureNotOpen()){return null}var a=this.get("router");var b=a.model.search.error;return b.getFolderId()},getSearchSecureTargetFolderName:function(){var a=this.getSearchSecureTargetFolderId();var b=h.default.all.get(a);if(b){return b.get("name")}return""},getMessages:function(){return{noSpam:i18n("В вашей почте{br}нет спама",{"unsafe-br":"<br />"}),noDrafts:i18n("У вас нет незаконченных{br}или неотправленных писем",{"unsafe-br":"<br />"}),secureSearch:i18n("Доступ в папку «{folderName}» запрещён.",{folderName:this.getSearchSecureTargetFolderName()})}},getType:function(){var a=this.get("type");var b=this.get("folder");switch(a){case"empty-folder":{if(!b.isSecureOpen()){return"secure-folder"}if(b.isInbox()&&!b.isRoot()){return"empty-folder"}if(b.isInbox()){return"empty-inbox-folder"}if(b.isTrashLike()&&b.isRoot()){return"trash"}if(b.isSpam()&&b.isRoot()){return"spam"}if(b.isTemplates()){return"no-templates"}if(b.isDrafts()&&b.isRoot()){return"no-drafts"}break}case"no-filter":{if(!b.isSecureOpen()){return"secure-folder"}return a}case"no-search":{if(this.isSearchSecureNotOpen()){return"secure-search"}return a}case"no-select":case"no-letter":{return a}}return"empty-folder"},getIconType:function(){return n[this.getType()]},getIcon:function(){return""+c.OCTAVIUS_PLACEHOLDERS_PATH+this.getIconType()+".svg"},isAllreadButtonVisible:function(){return f.isAllreadButtonVisible(this.get("filter"),this.get("model"))},didMount:function(){var c=this;var d=this.get("router");var e=this.get("folder");var f=this.getSearchSecureTargetFolderId();if(this.isSearchSecureNotOpen()||e&&!e.isSecureOpen()&&this._autoShow){this._autoShow=false;l.default(e||h.default.all.get(f)).then(function(e){if(d&&d.route.is("#search #search-letter")){return b.default.dispatch({type:a.UPDATE_SEARCH})}if(e){c.destroy();g.default({type:a.UPDATE_ALL})}})}k.default({chain:["mount","octopus"],dwh:{type:this.get("type")}})},isInSharedMailbox:function(){var a=this.get("folder");return a===null||a===void 0?void 0:a.isShareTake()},shouldDisplayFilter:function(){return!c.FORBID_FILTERS&&!this.isInSharedMailbox()&&!this.is("mobile")}}))});define("feast-tpl!app/feast-tpl!ui-block/paginator/paginator.html",["feast"],function(a){return a.smartParse('<span qa:id="paginator">\n\t<fn:var name="pages" value="{_this.getPages()}"/>\n\n\t<b:paginator-button\n\t\tico="navigation:drop_previous"\n\t\ttitle="Предыдущая страница"\n\t\taction="prev"\n\t\tdisabled="{attrs.disabled || attrs.current == 1}"\n\t\tremit:action="button-action"\n\t\tqa:id="paginator-button-prev"\n\t/>\n\n\t<b:paginator-button\n\t\tico="navigation:drop_next"\n\t\ttitle="Следующая страница"\n\t\taction="next"\n\t\tdisabled="{attrs.disabled || attrs.current == pages[pages.length - 1] || !attrs.length}"\n\t\tremit:action="button-action"\n\t\tqa:id="paginator-button-next"\n\t/>\n\n\t<fn:for data="_this.getPages()" as="index">\n\t\t<b:paginator-button\n\t\t\tkey="{index}"\n\t\t\ttext="{index}"\n\t\t\tindex="{index}"\n\t\t\tpressed="{index == attrs.current}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tremit:action="button-action"\n\t\t\tqa:id="paginator-button-page_{index}"\n\t\t/>\n\t</fn:for>\n</span>\n',"app/feast-tpl!ui-block/paginator/paginator.html")});define("feast-tpl!ui-block/paginator/paginator.html",["feast-tpl!app/feast-tpl!ui-block/paginator/paginator.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/paginator-button/paginator-button.html",["feast"],function(a){return a.smartParse('<span>\n\t<fn:match name="paginator-text" args="text">\n\t\t<span bem:elem="text">\n\t\t\t{text}\n\t\t</span>\n\t</fn:match>\n\n\t<b:button2\n\t\tico="{attrs.ico}"\n\t\ttitle="{attrs.title}"\n\t\tpressed="{attrs.pressed}"\n\t\tdisabled="{attrs.disabled}"\n\t\tpure\n\t\tshort\n\t\tsmall\n\t\tremit:click="action"\n\t\tevent:details="{page: attrs.index, type: attrs.action || \'click\'}"\n\t\tcentered\n\t>\n\t\t<fn:apply-match name="paginator-text" args="attrs.text"/>\n\t</b:button2>\n</span>\n',"app/feast-tpl!ui-block/paginator-button/paginator-button.html")});define("feast-tpl!ui-block/paginator-button/paginator-button.html",["feast-tpl!app/feast-tpl!ui-block/paginator-button/paginator-button.html"],function(a){return a});define("ui-block/paginator-button/paginator-button",["exports","feast","feast-tpl!./paginator-button.html","ui-block/button2/button2"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"paginator-button",template:e.default,immutable:true,blocks:{button2:f.default}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/paginator/paginator",["require","exports","default-values","feast","feast-tpl!./paginator.html","../paginator-button/paginator-button"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=5;exports.default=b.default.Block.extend({name:"paginator",template:c.default,immutable:true,blocks:{"paginator-button":d.default},defaults:{length:0,current:1},events:{"button-action":"onButtonAction"},onButtonAction:function(a){var b=a.details;var c=this.get("current");var d=b.page,e=b.type;var f=this.getPages();if(!f.length){return}var g;switch(e){case"prev":{g=c-1;if(g<1){return}break}case"next":{g=c+1;if(g>f[f.length-1]){return}break}default:{g=d;break}}this.broadcast("navigate",{page:g})},getPages:function(){var b=this.get("length");var c=this.get("current");var d=Math.ceil(b/a.LIST_LIMIT);var f=c;var g=Math.floor(e/2);var h=f-g;var i=f+g;if(i>d){h-=i-d;i-=i-d}if(h<1){i=Math.min(i-h+1,d);h=1}return Array.from({length:i-h+1},function(a,b){return h+b})}})});define("feast-tpl!app/feast-tpl!ui-block/paginator-container/paginator-container.html",["feast"],function(a){return a.smartParse('<span qa:id="paginator-container">\n\t\x3c!-- Формула для вычисления смещения блока на 2pane --\x3e\n\t<fn:var name="offset2Pane" value="{attrs[\'right-column\'] + attrs[\'right-offset\']}"/>\n\t\x3c!-- Формула для вычисления смещения блока на 3pane --\x3e\n\t<fn:var name="offset3Pane" value="var(--left-column-width) + {(attrs[\'sidebar-column\'] - 60)}px"/>\n\n\t<fn:choose>\n\t\t\x3c!-- Пагинатор, большой экран --\x3e\n\t\t<fn:when test="attrs.type === \'2pane\' && attrs[\'max-breakpoint\']">\n\t\t\t<fn:attr name="style" value="right: calc((100% - {_this.getMaxLayoutWidth()}px) / 2 + {offset2Pane}px);"/>\n\t\t</fn:when>\n\n\t\t\x3c!-- Пагинатор, все остальные брейкпоинты --\x3e\n\t\t<fn:when test="attrs.type === \'2pane\' && !attrs[\'max-breakpoint\']">\n\t\t\t<fn:attr name="style" value="right: {offset2Pane}px;"/>\n\t\t</fn:when>\n\n\t\t\x3c!-- Кнопка "Наверх", большой экран --\x3e\n\t\t<fn:when test="attrs.type === \'3pane\' && attrs[\'max-breakpoint\']">\n\t\t\t<bem:mod name="offset" value="3pane_max" />\n\t\t</fn:when>\n\n\t\t\x3c!-- Кнопка "Наверх", все остальные брейкпоинты --\x3e\n\t\t<fn:when test="attrs.type === \'3pane\' && !attrs[\'max-breakpoint\']">\n\t\t\t<bem:mod name="offset" value="3pane_common" />\n\t\t</fn:when>\n\t</fn:choose>\n\n\t<bem:mod name="visible" test="attrs.visible"/>\n\t<bem:mod name="hidden" test="!attrs.visible"/>\n\n\t<span\n\t\tfn:if="attrs.paginator && (attrs.type === \'2pane\')"\n\t\tbem:elem="block"\n\t>\n\t\t<fn:apply-match name="paginator"/>\n\t</span>\n\n\t<span bem:elem="block" fn:if="attrs[\'nav-up\']">\n\t\t<fn:apply-match name="nav-up"/>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/paginator-container/paginator-container.html")});define("feast-tpl!ui-block/paginator-container/paginator-container.html",["feast-tpl!app/feast-tpl!ui-block/paginator-container/paginator-container.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/paginator-container/paginator-container",["require","exports","default-values","feast","feast-tpl!./paginator-container.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"paginator-container",template:c.default,defaults:{type:"3pane","right-column":0,"left-column":0,"sidebar-column":0,"right-offset":0,"max-breakpoint":false,visible:!a.NEW_TOOLBAR},broadcastVisibilityEvent:function(a){if(a){this.broadcast("show")}else{this.broadcast("hide")}},didMount:function(){this.broadcastVisibilityEvent(this.is("visible"))},didUpdate:function(a){var b=this.is("visible");if(a.visible!==b){this.broadcastVisibilityEvent(b)}},didUnmount:function(){this.broadcastVisibilityEvent(false)},getMaxLayoutWidth:function(){return a.MAX_LAYOUT_WIDTH}})});define("feast-tpl!app/feast-tpl!ui-block/paginator-debugger/paginator-debugger.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="keys" value="{Object.keys(attrs.state).sort()}"/>\n\n\t<fn:for data="keys" as="name">\n\t\t<span bem:elem="pair" key="{name}">\n\t\t\t\t<span bem:elem="name">{name}:</span>\n\t\t\t\t<span bem:elem="value">{attrs.state[name]}</span>\n\t\t</span>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/paginator-debugger/paginator-debugger.html")});define("feast-tpl!ui-block/paginator-debugger/paginator-debugger.html",["feast-tpl!app/feast-tpl!ui-block/paginator-debugger/paginator-debugger.html"],function(a){return a});define("ui-block/paginator-debugger/paginator-debugger",["exports","feast","feast-tpl!./paginator-debugger.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"paginator-debugger",template:d.default,immutable:true})});define("feast-tpl!app/feast-tpl!ui-block/promo-block-letter/promo-block-letter.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="no-margin-collapse" test="attrs[\'no-margin-collapse\']"/>\n\n\t<div\n\t\tclass="promo-block-letter-wrapper"\n\t\tbem:elem="container"\n\t\tref="container"\n\t\tqa:id="promo-block-letter-wrapper"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/promo-block-letter/promo-block-letter.html")});define("feast-tpl!ui-block/promo-block-letter/promo-block-letter.html",["feast-tpl!app/feast-tpl!ui-block/promo-block-letter/promo-block-letter.html"],function(a){return a});define("ui-block/promo-block-letter/promo-block-letter",["exports","feast","feast-tpl!./promo-block-letter.html","service/promo"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"promo-block-letter",template:e.default,attrChanged:{support3pane:function a(){var b=this.refs.container&&this.refs.container.children.length;if(b){this.update()}},hidden:function a(b){if(b){this.el.style.display="none"}else{this.el.style.display=""}}},update:function a(){f.default.update()},didMount:function a(){var b={childList:true,subtree:true};var c=this.mutationCallback.bind(this);this.observer=new MutationObserver(c);this.observer.observe(this.el,b);this.update()},didUnmount:function a(){this.observer.disconnect()},mutationCallback:function a(){this.broadcast("promoblockletter:render")}})});define("feast-tpl!app/feast-tpl!ui-block/spec-project-letter/spec-project-letter.html",["feast"],function(a){return a.smartParse('<div>\n\t<div\n\t\tref="spec-project-letter"\n\t\tqa:id="spec-project-letter"\n\t/>\n\t<b:delimeter last fn:if="!attrs[\'no-delimeter\']"/>\n</div>\n',"app/feast-tpl!ui-block/spec-project-letter/spec-project-letter.html")});define("feast-tpl!ui-block/spec-project-letter/spec-project-letter.html",["feast-tpl!app/feast-tpl!ui-block/spec-project-letter/spec-project-letter.html"],function(a){return a});define("ui-block/spec-project-letter/spec-project-letter",["exports","feast","feast-tpl!./spec-project-letter.html","service/adv/index","ui-block/delimeter/delimeter"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"spec-project-letter",template:f.default,blocks:{delimeter:h.default},attrChanged:{hidden:function a(b){if(b){this.el.style.display="none"}else{this.el.style.display=""}}},constructor:function a(){e.default.Block.apply(this,arguments);this._renderPlacementBound=this.renderPlacement.bind(this)},isCompact:function a(){return this.is("compact")||this.is("touch")},didUpdate:function a(){this.broadcast("render:adv",{advRender:this._renderPlacementBound,advName:this.name})},didMount:function a(){this.broadcast("render:adv",{advRender:this._renderPlacementBound,advName:this.name})},didUnmount:function a(){this.broadcast("render:remove",this.name)},renderPlacement:function a(){var b=this;var d=this.isCompact();if(d===this.isPrevIsCompact){return}this.isPrevIsCompact=d;var e=this.refs["spec-project-letter"];var f=c.Adman.placement(d?"specline3pane":"specline2pane");e.innerHTML="";g.default.setVisibleAdv(this.name,false);if(!f){return}var h=function a(c){f.renderToContainer(e,c,false).then(function(a){if(a&&a.html){g.default.setVisibleAdv(b.name,true)}else{g.default.setVisibleAdv(b.name,false)}}).catch(function(a){console.log(a);g.default.setVisibleAdv(b.name,true);b.broadcast("specline:error")})};this.broadcast("specline:render",{placement:f,placementRender:h})}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dataset-letters/dataset-letters",["require","exports","@mail/features","data-source/actions","data-source/utils/actual-letters","data-source/utils/letter-list-virtualization","data-source/utils/paginator","default-values","feast","feast-tpl!./dataset-letters.html","helpers/data-source-dispatch","helpers/get-go-to-action-display-mode","helpers/keys","helpers/letter","helpers/metathreads","helpers/new-letter-list","mail/Folder","mail/Message","mail/Thread","models/bait-letter/bait-letter","models/dataset-model/dataset-model","models/discounts-block-letter/discounts-block-letter","models/height-compensation-model/height-compensation-model","models/metathread/metathread","models/promo-block-letter/promo-block-letter","models/search-action-letter/search-action-letter","models/spec-project-letter/spec-project-letter","models/spinner-letter/spinner-letter","models/tip-letter/tip-letter","models/welcome-block-letter/welcome-block-letter","service/contextmenu","service/radars/decorator","service/radars/index","service/search-attaches/getAttaches","service/search-attaches/viewModes","service/secure-folder","service/smokescreen","ui-block/button2/button2","ui-block/dataset/dataset","ui-block/discounts/discounts","ui-block/draggable/draggable","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-bait/list-letter-bait","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-common-touch/list-letter-common-touch","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-compact-touch/list-letter-compact-touch","ui-block/list-letter-height-compensation/list-letter-height-compensation","ui-block/list-letter-order/list-letter-abstract-order","ui-block/list-letter-preview-action/list-letter-preview-action","ui-block/list-letter-skeleton/list-letter-skeleton","ui-block/list-letter-spinner/list-letter-spinner","ui-block/list-letter-tip/list-letter-tip","ui-block/list-letter-welcome/list-letter-welcome","ui-block/metathread/metathread","ui-block/metathread-footer/metathread-footer","ui-block/octopus/octopus","ui-block/paginator/paginator","ui-block/paginator-container/paginator-container","ui-block/paginator-debugger/paginator-debugger","ui-block/promo-block-letter/promo-block-letter","ui-block/spec-project-letter/spec-project-letter","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockDescription=exports.DatasetLettersEvents=void 0;a=__importDefault(a);g=__importDefault(g);h=__importDefault(h);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);H=__importDefault(H);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);da=__importDefault(da);ea=__importDefault(ea);fa=__importDefault(fa);ga=__importDefault(ga);ha=__importDefault(ha);ia=__importDefault(ia);ja=__importDefault(ja);var ka=60;var la=100;var ma={mount:"umh_mount",update:"umh_update",resize:"umh_resize"};var na={once:"hc_once",update:"hc_update",always:"hc_always"};var oa={"list-letter-tip":{modelValidator:A.default.isTip,selector:I.selector(".list-letter-tip"),heightCalculationMode:na.always},"list-letter-search-action":{modelValidator:x.default.isSearchAction,selector:I.selector(".list-letter-search-action"),heightCalculationMode:na.always},"promo-block-letter":{modelValidator:w.default.isPromoBlock,selector:I.selector(".promo-block-letter"),heightCalculationMode:na.always},"spec-project-letter":{modelValidator:y.default.isSpecProjectLetter,selector:I.selector(".spec-project-letter"),heightCalculationMode:na.always}};var pa;(function(a){a["NewRange"]="new:range"})(pa=exports.DatasetLettersEvents||(exports.DatasetLettersEvents={}));exports.blockDescription={name:"dataset-letters",template:h.default,performanceTrace:"track",defaults:{stickyMap:{},search:false,"current-page-override":undefined,paginator:false,"nav-up":false,"nav-up-enabled":f.ENABLE_NAV_UP||f.CAN_ENABLE_PAGINATOR},blocks:{draggable:M.default,dataset:K.default,"letter-list-item-adv":N.default,metathread:ba.default,"metathread-footer":ca.default,octopus:da.default,paginator:ea.default,"paginator-container":fa.default,button2:J.default,"list-letter-common":R.default,"list-letter-common-touch":S.default,"list-letter-compact":T.default,"list-letter-compact-touch":U.default,"list-letter-bait":P.default,"list-letter-spinner":Z.default,"list-letter-tip":_.default,"list-letter-preview-action":X.default,"promo-block-letter":ha.default,"spec-project-letter":ia.default,"list-letter-skeleton":Y.default,"list-letter-height-compensation":V.default,"list-letter-welcome":aa.default,discounts:L.default},attrChanged:{folder:function(){var a=this;setImmediate(function(){return a.preloadThreads()})},compact:function(a){!a&&this.set("stickyMap",{})},"current-page-override":function(a){this.setPaginatorDebugState({"current-page-override":a})}},events:{preparedragelement:"onPrepareDragElement","click:letter":"onLetterClick","click:avatar":"onAvatarClick","click:metathreadavatar":"onAvatarClick","click:previewattach":"onPreviewAttachClick",rightclick:"onRightClick",scrollintomodel:"onScrollIntoModelByIndex","paginator:navigate":"onPaginatorNavigate","paginator:up":"onPaginatorUp"},constructor:function(){g.default.Block.apply(this,arguments);this.getItemHeight=this.getItemHeight.bind(this);this.getItemPersist=this.getItemPersist.bind(this);this.getItemContext=this.getItemContext.bind(this);this.handleItemsUpdate=this.handleItemsUpdate.bind(this);this.onNewRange=this.onNewRange.bind(this);this.handleScroll=this.handleScroll.bind(this);this.handleWindowResize=this.handleWindowResize.bind(this);this.updateModelHeights=this.updateModelHeights.bind(this);this._footerOffsets={};this._modelHeights={};this._specialModels=[];this._forcePaginator=false;if(f.IS_DEBUG){this._debugPaginatorState={};this._debugPaginator=new ga.default({state:this._debugPaginatorState});this._debugPaginator.renderTo(document.body)}},preloadThreads:function(){var b;if(!this.isMounted()){return}var c=a.default.get("datalist-preload-threads");var d=this.get("models");if(!d||!c){return}var e;var g;var h;b=c.data.split(","),e=b[0],g=b[1],h=b[2];e=Number(e);g=Number(g);h=Number(h);var i=function(a,b){b=d[a];if(!b){return j=b,"break"}if(g<1&&h<1){return j=b,"break"}if(b instanceof q.default&&!b.is("flags.metathread")){if(g-- >0||b.is("flags.unread")&&h-- >0){var c={force_custom_thread:f.FORCE_CUSTOM_THREAD};if(f.OCTAVIUS_PREFETCH){c.octavius_prefetch=1}setTimeout(function(){return b.fetch(c)},10)}e--}j=b};var j;for(var k=0,l=void 0;e>0;k++){var m=i(k,l);l=j;if(m==="break")break}},onPrepareDragElement:function(a){var b=a.details;var c=g.default.Mediator.get("letters-selection");var d=document.createElement("div");var e=q.default.all.get(b.id)||v.default.all.get(b.id);if(e){c.select(e);d.textContent=c.getModels().length+" items";d.style.cssText="padding: 5px 10px; background: #ccc;";b.el.appendChild(d)}return false},isPriorityMessage:function(a){var b=m.getModelCurrentFolder(a);if(!b){return false}if(b.isSpam()){return false}var d=this.get("router");return c.isActualLettersEnabledInFolder(d,b,a.get("flags.newsletter"))&&a instanceof q.default&&a.get("flags.is_relevant")&&a.get("flags.unread")},getScrollableEl:function(){var a;return(a=this.el)===null||a===void 0?void 0:a.closest(I.selector(".scrollable"))},onAvatarClick:function(a){var b=a.originalEvent&&a.originalEvent.details;var c=a.details;if(a.details.model){c=a.details.model}if(!b||b&&!b.get("swipe-actions-visible")){this.broadcast("selected:toggle",c,a.originalEvent)}a.preventDefault()},openDraft:function(a){var b=this;return p.default.fetchData({id:a.get("expand")||a.get("id"),folder_id:a.get("folder")},true,true).then(function(a){p.default.set([a]);b.broadcast("compose:draft",new p.default(a))}).catch(function(a){E.default({type:"open_draft_fail",rlog:"open_draft_fail",rlog_message:a})})},onLetterClick:function(a){if(a.isDefaultPrevented()){return}var b=a.originalEvent;if(b&&k.isNewTabClick(b)){return}else{a.preventDefault()}var d=a.details.model;var e=d.getFolder();if(this.get("compact")&&this.get("select-mode")){this.broadcast("selected:toggle",d,a.originalEvent)}else if(e.isOutbox()){this.broadcast("compose:schedule",d)}else if(e.isTemplates()){this.broadcast("compose:template",d)}else if(e.isDrafts()){this.openDraft(d)}else{this.goToLetter(d)}var g=m.getModelCurrentFolder(d).id;var h=this.is("search");var i=this.get("router");var j=__assign(__assign(__assign({message_id:d.get("id"),priority:+d.get("flags.is_relevant"),folder_id:g,need_hide_emoji_in_subject:d.get("hide_emoji_in_subject"),need_hide_emoji_in_snippet:d.get("hide_emoji_in_snippet"),need_hide_emoji_in_correspondent:d.get("hide_emoji_in_correspondent"),show_relevant:+c.isActualLettersEnabledInFolder(i,e,d.get("flags.newsletter"))},d.get("actual_probability")&&{ml_model:d.get("actual_probability").split(":")[0]}),d.get("flags.bimi_msg")&&{reliable:true}),(d.get("flags.official")||d.get("flags.official_newsletter"))&&{official:true});E.default({chain:["thread","letter","open"],dwh:j,data:__assign({unread:d.get("flags.unread"),ui_index:d.meta("_ui-index"),search:h},j)});if(f.DISCOUNTS_BLOCK&&i.model.uiThreadsSettings.discounts&&i.model.folder.isNewsletters()&&d.get("flags.pinned")&&d.get("discount")){E.default({chain:["open","discount","thread"],dwh:{from:"letter_list",threadId:d.get("id"),letterId:d.get("expand")||d.get("id"),unread:d.get("flags.unread"),jsonld:d.get("discount.from_jsonld"),relevant:d.get("flags.is_relevant")}})}},getLetterHref:function(a,b){return l.getLetterHref(a,b,{router:this.get("router"),search:this.is("search"),threads:this.is("threadsEnabled")})},goToLetter:function(a){var b=this;var c=m.getModelCurrentFolder(a);if(!c.isSecureOpen()){H.default(c).then(function(c){c&&b.goToLetter(a)});return}var d=this.get("router");var e=this.getLetterHref(a,c);d.nav(e,{initiator:"popstate"})},onRightClick:function(a){O.default.resetAttachmentDropdown();if(!this.is("touch")&&!this.is("search")){this.setDetailsForRightClick(a);C.default.show(a)}},setDetailsForRightClick:function(a){if(a.details.model){a.details=a.details.model}a.details.folders=this.get("folders");a.details.isLetterSelected=this.isLetterSelected(a.details)},onPreviewAttachClick:function(a){var b=a.details,c=a.originalEvent;if(!b||!c||!c.details||!c.originalEvent){return}var d=b.index;var e=c.details,f=e.hasSnippet,g=e.ext,h=c.originalEvent.type;var i=[["letter_position",d+1],["hasSnippet",f]];if(g){i.push(["extension",g])}var j=this.get("router");var k=j.model.search.search_id;var l=Math.floor(Date.now()/1e3);E.default({chain:["search_attaches_click_"+h],intervals:i,dwh:{search_id:k,timestamp:l}})},updateSpecialModels:function(){this._specialModels.length=0;var a=this.get("models");for(var b=0;b<a.length;b++){var c=a[b];var d=Object.keys(oa);for(var e=0;e<d.length;e++){var f=d[e];var g=oa[f];if(g.modelValidator(c)){this._specialModels.push({type:f,model:c})}}}},didMount:function(){this.debouncedhandleWindowResize=ja.default.debounce(this.handleWindowResize,la,this);window.addEventListener("resize",this.debouncedhandleWindowResize);this.updateModelHeights(ma.mount)},didUpdate:function(a){this.updateSpecialModels();this.updateModelHeights(ma.update);var b=this.get("current-page-override")!==undefined||a["current-page-override"]!==undefined;this.updatePaginatorVisibility(this.ids.dataset.getScrollTop(),b)},didUnmount:function(){window.removeEventListener("resize",this.debouncedhandleWindowResize);if(this._debugPaginator){this._debugPaginator.destroy()}},handleWindowResize:function(){this.updateModelHeights(ma.resize)},updateModelHeights:function(a){var b=this._specialModels;for(var c=0;c<b.length;c++){var d=b[c];var e=d.model.get("id");var f=oa[d.type];var g=document.querySelector(I.selector(f.selector));if(g){var h=na;var i=ma;var j=false;switch(f.heightCalculationMode){case h.once:if(a===i.mount){j=true}break;case h.update:if(a===i.mount||a===i.update){j=true}break;case h.always:if(a===i.mount||a===i.update||a===i.resize){j=true}break}if(j){this._modelHeights[e]=g.getBoundingClientRect().height}}}},isSearch:function(){return this.is("search")||this.is("search-letter")},getItemHeight:function(a){var b;var c=this.is("compact");var e=this.is("pony-mode")||!!(c&&((b=a.isInMetathread)===null||b===void 0?void 0:b.call(a)));var f=this.isSearch();var g=a.get("id");var h=this._modelHeights[g];if(h){return h}if(u.default.isHeightCompensation(a)){return a.get("height")}if(r.default.isBait(a)||z.default.isSpinner(a)||w.default.isPromoBlock(a)||y.default.isSpecProjectLetter(a)||B.default.isWelcomeBlock(a)&&!a.is("visible")){return 0}if(B.default.isWelcomeBlock(a)){if(!c){return 74}else{return 90}}if(t.default.isDiscountsBlock(a)){if(c){return 224}else{return 200}}if(v.default.isMetathread(a)&&a.isExpanded()&&n.isNewLetterListEnabled(c)&&c){if(e){return d.HEIGHT_GENERIC_2PANE_PONY}return d.HEIGHT_GENERIC_2PANE}if(v.default.isMetathread(a)&&a.isExpanded()&&!n.isNewLetterListEnabled(c)||v.default.isMetathreadFooter(a)){if(!c){if(e){return 52}return 60}if(c){if(e){return 52}return 60}}var i=0;var k=l.isListLetterActionButtonsEnabled(a,f);if(k){if(c){i=e?24:12}else{i=e?26:24}}var m=j.getGoToActionHeight(a,e,f,c,k);var o=j.getGoToActionDisplayMode(a,e,f,false)==="none";var p=f?{}:this.get("hidden-payment-dies")||{};var q=o?Q.getPaymentDieDisplayMode(a,p,e,f,false):"none";var s=0;if(q==="full"&&!c){s=a.getPaymentMeta().skin===Q.SKINS.GIBDD?98:70}else if(q!=="none"&&c){switch(q){case"compact":{s=34;break}case"full":{s=a.getPaymentMeta().skin===Q.SKINS.GIBDD?98:70;break}}}var x=F.shouldShowLetterPreview(a)&&o?a.get("attachments_count"):0;var A=!!x;var C=A?{length:x}:F.getAllAttaches(a,f);var D=!(f&&c);var E=0;if(C&&C.length&&D){var H=F.getSearchAttaches(a,f);var I=G.getAttachesModes(c,C,H);E=G.getSearchAttachesHeight(I)}var J=W.getTransactionMetadata(a,f);var K=0;if(W.showOrder(a,J)&&!c&&o){K=20}var L=0;if(Q.shouldShowUniversalPaymentDie(a,false)&&o){if(!c){L=32}else if(k&&!e){L=20}}var M=0;if(n.isNewLetterListEnabled(c)&&f&&c){M=e?6:10}return d.getGenericItemHeight(c,e)+i+s+m+E+K+L+M},getItemPersist:function(a){return v.default.isMetathread(a)&&a.isExpanded()},getItemContext:function(a,b,c){var d=this.get("models");var e=d[b-1];var f=d[b+1];var g=this.get("stickyMap");return{prev:e,next:f,isFirst:b===0,isLast:b===c-1||b===c-2&&f&&f.is("spinnerLetter"),isNextItemExpandedMetathread:f&&this.isModelExpandedMetathread(f),isPrevItemExpandedMetathread:e&&e.is("metathreadFooter"),sticky:g&&g[a.id],searchInExcludedFoldersUrl:this.get("search-in-excluded-folders-url"),suggestSearch:this.get("router").model.suggestSearch,skeletonIndex:a.get("index"),heightCompensation:a.get("height"),metathreadLastToggle:a.get("metathreadLastToggle"),discounts:this.get("router").model.discounts,threadsEnabled:this.is("threadsEnabled")}},handleItemsUpdate:function(a){this.updateSpecialModels();this.updateModelHeights(a?ma.mount:ma.update)},updatePaginatorVisibility:function(a,b){if(b===void 0){b=this.get("current-page-override")!==undefined}if(!this.isMounted()){return}var c=this.get("status");var d=this.get("router");if(!c||!Object.keys(c).length){return}var g=c.page===1;var h=c.letters.length>0;var i=!g||c.letters.length>f.LIST_LIMIT;var j=!!a;var k=this._forcePaginator;if(!e.isPaginatorGlobalEnabled(d)){this.set({paginator:false,"nav-up":j});return}var l=i&&(j||b||k);var m=h&&j;this.set({paginator:l,"nav-up":m})},handleScroll:function(a){var b=a.dataset,c=a.scrollTop;if(!this.isMounted()){return}var d=this.get("router");this.updatePaginatorVisibility(c);if(e.isPaginatorGlobalEnabled(d)){this.updatePaginatorPage(c);this.saveCurrentPageHeightOnScroll()}var f=b.isScrolledToBottom();if(b.isScrolledToBottom()!==!!this._scrolledToBottom){this._scrolledToBottom=f;this.render()}var g=this.get("metathreads");if(!g||!Object.keys(g).length){return}var h=this.get("stickyMap");var i=[];var j={};var k=[];var l;var m;var n;var o;var p;var q;var r;var s;var t;var u;for(var w in g){l=v.default.all.get(w);m=b.getBlockMeasuresByModelId(w);o=m!==void 0;n=o&&m.offset-m.height;q=l.getFooterModel();r=b.getBlockMeasuresByModelId(q.id);u=r!==void 0;if(u){this._footerOffsets[l.id]=r.offset-r.height}s=this._footerOffsets[l.id];p=o&&c<=n;t=!s||c<=s;j[l.id]=l.isExpanded()&&!p&&t;if(j[l.id]){k.push(l.id)}}for(var w in h){if(h[w]){i.push(w)}}if(k.join(",")!==i.join(",")){this.set("stickyMap",j)}},onScrollIntoModelByIndex:function(a){if(!a.originalEvent){return}var b=this.ids.dataset;var c=a.originalEvent.details.index;var d=this.get("models");var e=d&&d[c];var f=e&&b.getBlockMeasuresByModelId(e.id);var g=this.getItemHeight(e)+ka;var h=f?f.offset-g:0;b.scrollTo(h)},getMainField:function(a){var b=o.default.get(a.get("folder"));if((b===null||b===void 0?void 0:b.isOutbox())||(b===null||b===void 0?void 0:b.isSent())||(b===null||b===void 0?void 0:b.isDrafts())){return"to"}return"from"},isTouchDevice:function(){return f.TOUCH_MODE},isLetterSelected:function(a){var b,c,d;var e=this.get("select-folder");var f=this.get("selected");if(s.default.isDatasetModel(a)){return false}return(f===null||f===void 0?void 0:f[a.id])||!((b=a.isInMetathread)===null||b===void 0?void 0:b.call(a))&&!((c=a.is)===null||c===void 0?void 0:c.call(a,"flags.metathread"))&&e||((d=a.isInMetathread)===null||d===void 0?void 0:d.call(a))&&a.getContainingMetathread()&&f[a.getContainingMetathread().id]},isLetterActive:function(a){var b=this.get("thread");return b===a.id},isModelExpandedMetathread:function(a){return a&&v.default.isMetathread(a)&&a.isExpanded()},getKey:function(a){var b=a.id;if(a.isInMetathread&&a.isInMetathread()){return a.get("folder")+":"+b}return b},getPaginatorPage:function(a,b){return this.get("paginator-page-getter")(a,b)},getLastCalculatedRange:function(){return this.ids.dataset.getLastCalculatedRange()},getCurrentPageOverride:function(){return this.get("current-page-override")},isScrolledToBottom:function(){return this.ids.dataset.isScrolledToBottom()},getStatus:function(){return this.get("status")},getModels:function(){return this.get("models")},getScrollTop:function(){return this.ids.dataset.getScrollTop()},getRouter:function(){return this.get("router")},is3Pane:function(){return this.is("compact")},isPonyMode:function(){return this.is("pony-mode")},getBlockMeasuresByModelId:function(a){return this.ids.dataset.getBlockMeasuresByModelId(a)},onNewRange:function(a){this.broadcast(pa.NewRange,{start:a.offset})},onPaginatorNavigate:function(a,c){var g=this;var h=a.details;if(c===void 0){c=false}var j=Math.max(h.page,1);var k=this.getPaginatorPage();var l=k===j;if(!l){this.set("current-page-override",j)}if(!c){this.radar("paginator_nav");this.radar(["paginator_nav",j])}this.broadcast("save-current-page-height",{saveOnlyIfExact:false});var m=function(){return i.dispatchAndWait({type:b.LOAD_PAGE,page:j}).then(function(a){return a&&a.status})};var n=function(){var a=d.getGenericItemHeight(g.is("compact"),g.is("pony-mode"));var b=e.getMemoizedPageHeight(j-1);var c=b?b+a:(j-1)*f.LIST_LIMIT*a;return g.ids.dataset.scrollTo(c,{notify:true,behavior:"smooth",duration:200})};var o=function(){g.set("current-page-override",undefined);g._forcePaginator=true;g.ids.dataset.updateScroll();g._forcePaginator=false;return Promise.resolve()};if(l){return n()}var p=this.get("router");if(!e.isPaginatorGlobalEnabled(p)){return n().then(o)}return Promise.all([n(),m()]).then(o).catch(function(a){if(f.IS_DEBUG){console.error(a)}require(["trackJS"],function(b){b.sendRadar("p_paginator_error",{error:a,targetPage:j,currentPage:k},"octavius_paginator-error")});o()})},onPaginatorUp:function(){this.radar("nav-up");if(this.is("search")||this.is("search-letter")){return this.ids.dataset.scrollTo(0,{notify:true,behavior:"smooth",duration:200})}this.onPaginatorNavigate({details:{page:1}},true)},updatePaginatorPage:function(a){if(!this.isMounted()||this.is("search")||this.is("search-letter")){return}this.broadcast("update-on-scroll",{scrollTop:a})},saveCurrentPageHeightOnScroll:function(){if(!this.isMounted()){return}this.broadcast("save-current-page-height",{saveOnlyIfExact:true})},setPaginatorDebugState:function(a){var b=this;if(this._debugPaginator){this._debugPaginatorState=__assign(__assign({},this._debugPaginatorState),a);window.setTimeout(function(){if(b.isMounted()&&b._debugPaginator){b._debugPaginator.set("state",b._debugPaginatorState)}},16)}},highlightElementForDebug:function(a){if(!this._debugPaginator){return}var b=document.styleSheets[0];if(window.__highlightedRule){b.removeRule(b.rules.length-1)}var c='[data-id="'+a.id+'"], [data-id="'+a.id+'"] > *';b.addRule(c,"background-color: rgba(255, 0, 0, 0.2) !important;");window.__highlightedRule=true},isEnableAttach:function(){var a=this.get("folder");return a.checkGrant(o.default.SHARE_GRANTS.view_attachment)},shouldShowLetterPreview:F.shouldShowLetterPreview};exports.default=g.default.Block.extend(D.default({id:function(a){if(a.zombie||!a.attrs){E.default(["radar","decorator","zombie","error"]);return"zombie"}return a.is("search")?"search":"letters"},explicit:true})(exports.blockDescription))});define("feast-tpl!app/feast-tpl!ui-block/search-panel/search-panel.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="ponyMode" value="{attrs.ponyMode}"/>\n\t<fn:var name="columnWidth" value="{attrs.rightColumn}"/>\n\t\x3c!-- Если активная панель - во всю ширину, если у нас только кнопка - шириной с кнопку, если поле - шириной с колонку --\x3e\n\t<fn:var name="searchColumnWidth" value="{attrs.active ? \'100%\' : attrs.onlyIcon ? \'auto\' : columnWidth + \'px\'}"/>\n\n\t<bem:mod name="active" test="attrs.active" />\n\t<bem:mod name="only-icon" test="attrs.onlyIcon" />\n\t<bem:mod name="hide" test="attrs.hide" />\n\t<bem:mod name="size_{attrs.size}" />\n\t<bem:mod name="type" value="{attrs.layoutType}"/>\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\t<fn:attr name="style" value="max-width:{attrs.maxWidth}px;"/>\n\n\t<div\n\t\tbem:elem="wrapper"\n\t\tqa:id="search-panel{attrs.active ? \':active\' : \'\'}"\n\t\tstyle="width: {searchColumnWidth};"\n\t>\n\t\t<bem:mod name="active" test="attrs.active" />\n\t\t<bem:mod name="inactive" test="!attrs.active" />\n\n\t\t<fn:if test="attrs.active">\n\t\t\t<div bem:elem="left-col" ref="left-col">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:mousedown="back"\n\t\t\t\t\t\tnowrap\n\t\t\t\t\t\tradar-id="back"\n\t\t\t\t\t\ttext="{i18n(\'Сбросить поиск\')}"\n\t\t\t\t\t\tico="arrow-back"\n\t\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\tshort="{attrs.leftColumn <= 50}"\n\t\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\n\t\t<div bem:elem="right-col" ref="right-col">\n\t\t\t<fn:if test="!attrs.onlyIcon">\n\t\t\t\t<b:search-panel-button\n\t\t\t\t\tremit:click.stop="expandSearchPanel"\n\t\t\t\t\tshortcut="/"\n\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\tshort="{columnWidth < 240}"\n          compact="{ponyMode}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs.onlyIcon">\n\t\t\t\t<b:button2\n\t\t\t\t\tremit:click.stop="expandSearchPanel"\n\t\t\t\t\tico="search"\n\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\tpure\n\t\t\t\t\twhite="{!attrs.whiteTheme}"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\n\t\t<b:react-async\n\t\t\t\tid="search-panel"\n\t\t\t\tactive="{attrs.active}"\n\t\t\t\tclass-name="search-panel__layer"\n\t\t\t\tcomponent="SearchPanelInput"\n\t\t\t\tonBlur="{_this.handleSearchPanelBlur}"\n\t\t\t\tsearch="{attrs.store.search}"\n\t\t\t\tsize="{attrs.size}"\n\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\tcategories="{attrs.categories}"\n\t\t\t\tuse:mediator="themes-manager"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/search-panel/search-panel.html")});define("feast-tpl!ui-block/search-panel/search-panel.html",["feast-tpl!app/feast-tpl!ui-block/search-panel/search-panel.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/search-panel-button/search-panel-button.html",["feast"],function(a){return a.smartParse('<div type="button">\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t<span bem:elem="text" qa:id="{attrs.short ? \'button-short-text\' : \'button-text\'}">\n\t\t<fn:if test="attrs.short">\n\t\t\t{i18n(\'Поиск\')}\n\t\t</fn:if>\n\t\t<fn:if test="!attrs.short">\n\t\t\t{i18n(\'Поиск по почте\')}\n\t\t</fn:if>\n\t</span>\n\n\t<span bem:elem="icon" qa:id="button-icon">\n    <b:ico name="{attrs.compact ? \'navigation:search:s\' : \'navigation:search\'}"/>\n\t</span>\n</div>\n\n',"app/feast-tpl!ui-block/search-panel-button/search-panel-button.html")});define("feast-tpl!ui-block/search-panel-button/search-panel-button.html",["feast-tpl!app/feast-tpl!ui-block/search-panel-button/search-panel-button.html"],function(a){return a});define("ui-block/search-panel-button/search-panel-button",["exports","feast","feast-tpl!./search-panel-button.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"search-panel-button",template:e.default,blocks:{ico:f.default}})});define("ui-block/search-panel/consts",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchEventEnd=exports.SearchEventStart=exports.SearchPanelFeastName=void 0;exports.SearchPanelFeastName="search-panel";var a;(function(a){a["BLUR"]="search-panel:blur";a["FOCUS"]="search-panel:focus"})(a=exports.SearchEventStart||(exports.SearchEventStart={}));var b;(function(a){a["BLUR"]="searchpanel:blur";a["FOCUS"]="searchpanel:focus"})(b=exports.SearchEventEnd||(exports.SearchEventEnd={}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/search-panel/search-panel",["require","exports","default-values","feast","feast-tpl!./search-panel.html","service/radars/decorator","service/radars/index","ui-block/react-async/react-async","ui-block/search-panel-button/search-panel-button","./consts"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchPanelConfig=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.searchPanelConfig={name:h.SearchPanelFeastName,template:c.default,blocks:{"search-panel-button":g.default,"react-async":f.default},events:{expandSearchPanel:"expandSearchPanel"},defaults:{categories:a.SEARCH_CATEGORIES},constructor:function(){b.default.Block.apply(this,arguments);this.handleSearchPanelBlur=this.handleSearchPanelBlur.bind(this)},getSearchInput:function(){return this.ids["search-panel"].getComponent()},expandSearchPanel:function(){var a=this.is("active");this.set("active",true);var b=this.getSearchInput();if(b){if(a){b.focus()}else{b.focusAfterExpand()}e.default("srch-expand");this.broadcast(h.SearchEventStart.FOCUS)}},focus:function(){var a;this.set("active",true);(a=this.getSearchInput())===null||a===void 0?void 0:a.focus()},handleSearchPanelBlur:function(){this.broadcast(h.SearchEventStart.BLUR)},reset:function(){var a;if(!this.is("active")){return}(a=this.getSearchInput())===null||a===void 0?void 0:a.blur();this.set("active",false);this.broadcast(h.SearchEventStart.BLUR);this.get("store").search.clear()}};exports.default=b.default.Block.extend(d.default()(exports.searchPanelConfig))});define("feast-tpl!app/feast-tpl!ui-block/sidebar-search/sidebar-search.html",["feast"],function(a){return a.smartParse('<div\n\tqa:id="sidebar-search"\n\ta11y:tooltip-direction="left"\n>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\n\t<b:sidebar\n\t\tid="sidebar"\n\t\topen-left\n\t\tponymode="{ponyMode}"\n\t\tshort="{short}"\n\t>\n\t\t<fn:match name="sidebar-top-menu" args="isShort, isOpen">\n\t\t\t\x3c!-- Шапка сайдбара --\x3e\n\t\t\t<div bem:elem="header">\n\t\t\t\t\x3c!-- Бургер/Скрыть --\x3e\n\t\t\t\t<a\n\t\t\t\t\tfn:if="isShort || isOpen"\n\t\t\t\t\tbem:elem="menu-item"\n\t\t\t\t\tremit:click="sidebar:toggle"\n\t\t\t\t\tqa:id="burger-button"\n\t\t\t\t\ttitle="{!isOpen && i18n(\'Все фильтры\')}"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="menu-ico">\n\t\t\t\t\t\t<b:ico name="{attrs.ponymode ? \'navigation:menu_s\' : \'navigation:menu\'}" size="m"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="menu-text">{i18n(\'Скрыть\')}</span>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-content" args="isShort, isOpen">\n\t\t\t<b:react-async\n\t\t\t\tclass-name="search-sidebar__layer"\n\t\t\t\tcomponent="SearchSidebar"\n\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t\tonSearchPanelFocus="{_this.handleSearchPanelFocus}"\n\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\tnanoMode="{ponyMode}"\n\t\t\t\tsearch="{attrs.store.search}"\n\t\t\t\tshortcut="{isShort}"\n\t\t\t\tcategories="{attrs.categories}"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:sidebar>\n</div>\n\n',"app/feast-tpl!ui-block/sidebar-search/sidebar-search.html")});define("feast-tpl!ui-block/sidebar-search/sidebar-search.html",["feast-tpl!app/feast-tpl!ui-block/sidebar-search/sidebar-search.html"],function(a){return a});define("feast-mod/letter-count",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.letterCount=void 0;function a(a){return i18n.plural(a,[i18n("{count} писем",{count:a}),i18n("{count} письмо",{count:a}),i18n("{count} письма",{count:a})])}exports.letterCount=a});define("feast-tpl!app/feast-tpl!ui-block/nav-folders/nav-folders.html",["feast"],function(a){return a.smartParse('<div qa:id="folders">\n\n\t<b:nav\n\t\tmodels="{attrs.models}"\n\t\tshort="{attrs.short}"\n\t\tclean="{attrs.clean}"\n\t\ttouch="{attrs.touch}"\n\t\ttouch-nav="{attrs[\'touch-nav\']}"\n\t\tpony-mode="{attrs.ponymode}"\n\t\thas-parent-private-folders="{attrs[\'has-parent-private-folders\']}"\n\t>\n\n\t\t<fn:match name="nav-head"></fn:match>\n\n\t\t<fn:match name="nav-item" args="folder">\n\t\t\t<fn:var name="level" value="{_this.getLimitedFolderLevel(folder)}"/>\n\t\t\t<fn:var name="expanded" value="{_this.isFolderExpanded(folder)}"/>\n\t\t\t<fn:var name="url" value="{_this.getFolderUrl(folder)}"/>\n\t\t\t<fn:var name="title" value="{_this.getTitle(folder)}"/>\n\n\t\t\t<fn:var name="shortcut" value="{_this.folder2shortcutMap[folder.get(\'type\')]}" test="attrs.sidebar && _this.isShortcut(folder)"/>\n\n\t\t\t<fn:if test="this.isOtherUserFoldersContainer(folder) && !attrs.short">\n\t\t\t\t<hr bem:elem="hr"/>\n\t\t\t</fn:if>\n\n\t\t\t<b:immutable-virtual-block\n\t\t\t\tkey="{folder.id}"\n\t\t\t\tname="nav-item-folder"\n\t\t\t\tmodel="{folder}"\n\t\t\t\ttitle="{title}"\n\t\t\t\tdata-title="{_this.getFolderTitle(folder)}"\n\t\t\t\tactive="{attrs.active}"\n\t\t\t\tsystem="{attrs.system}"\n\t\t\t\tshortcut="{shortcut}"\n\t\t\t\thighlight="{attrs.highlight}"\n\t\t\t\ticomap="{_this.getFolder2IcoMap()}"\n\t\t\t\tisShortcut="{_this.isShortcut(folder)}"\n\t\t\t\tfolder-ico="{_this.getFolderIco(folder)}"\n\t\t\t\tshow-clear="{_this.isClearBtnVisible(folder)}"\n\t\t\t\tchild-level="{level}"\n\t\t\t\tis-expand-controls-visible="{_this.isFolderExpandControlsVisible(folder)}"\n\t\t\t\texpanded="{expanded}"\n\t\t\t\tis-parents-expanded="{_this.isFolderParentsExpanded(folder)}"\n\t\t\t\tnav-short="{attrs.short}"\n\t\t\t\tcounters-off="{attrs[\'counters-off\']}"\n\t\t\t\turl="{url}"\n\t\t\t\tunread="{(expanded && !attrs.short || folder.isDrafts() && attrs.short) ? _this.getUnreadCount(folder) : _this.unreadWithChild(folder)}"\n\t\t\t\ttouch-nav="{attrs[\'touch-nav\']}"\n\t\t\t\tavatarSrc="{_this.getAvatar(folder)}"\n\t\t\t\thas-parent-private-folders="{attrs[\'has-parent-private-folders\']}"\n\t\t\t\thas-virtual-containers="{attrs[\'has-virtual-containers\']}"\n\t\t\t>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tqa:id="{attrs.model.id}"\n\t\t\t\t\tdata-folder-link-id="{attrs.model.id}"\n\t\t\t\t\tqa:state="level:{attrs[\'child-level\']}"\n\t\t\t\t\tremit:mousedown="folderclickstart"\n\t\t\t\t\tremit:touchstart="folderclickstart"\n\t\t\t\t\tremit:mouseenter="folderhover"\n\t\t\t\t\tremit:click="folderclick"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tevent:details="attrs.model">\n\n\t\t\t\t\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t\t\t\t\t<fn:attr name="href" value="{attrs.url}" test="attrs.url"/>\n\t\t\t\t\t<fn:attr name="title" value="{attrs[\'data-title\']}" test="attrs[\'data-title\']"/>\n\t\t\t\t\t<fn:attr name="data-title" value="{attrs[\'data-title\']}" test="attrs[\'data-title\']"/>\n\n\t\t\t\t\t<fn:var name="folder" value="{attrs.model}"/>\n\t\t\t\t\t<fn:var name="active" value="{attrs.active == attrs.model.id}"/>\n\n\t\t\t\t\t<bem:mod name="active" test="active" />\n\t\t\t\t\t<bem:mod name="shortcut" test="attrs.isShortcut" />\n\t\t\t\t\t<bem:mod name="highlight" test="attrs.highlight == attrs.model.id" />\n\t\t\t\t\t<bem:mod name="expanded" test="!(attrs[\'is-parents-expanded\'] && attrs.model.get(\'children\'))" value="{attrs.expanded}"/>\n\t\t\t\t\t<bem:mod name="child-level" value="{attrs[\'child-level\']}"/>\n\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="folder"\n\t\t\t\t\t\tqa:id="selected:{active ? \'true\' :\'false\'}"\n\t\t\t\t\t>\n\t\t\t\t\t\t\x3c!-- класс для стилей, дата атрибут для тестов --\x3e\n\t\t\t\t\t\t<bem:mod name="parent" test="attrs.model.get(\'children\')" />\n\t\t\t\t\t\t<fn:attr name="data-parent" value="{attrs.model.get(\'children\') ? \'true\' : \'false\'}"/>\n\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\x3c!-- Разворот папок --\x3e // TODO: here\n\t\t\t\t\t\t\t<fn:when test="attrs[\'is-expand-controls-visible\']">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-ico" qa:id="folder-arrow">\n\t\t\t\t\t\t\t\t\t<fn:if test="attrs.expanded">\n\t\t\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\t\tremit:click.prevent.stop="foldertoggle"\n\t\t\t\t\t\t\t\t\t\t\tico="navigation:drop_down_big"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="arrow-up"\n\t\t\t\t\t\t\t\t\t\t\tbadge\n\t\t\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Свернуть\')}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t<fn:if test="!attrs.expanded">\n\t\t\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\t\tremit:click.prevent.stop="foldertoggle"\n\t\t\t\t\t\t\t\t\t\t\tico="navigation:drop_next_big"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="arrow-down"\n\t\t\t\t\t\t\t\t\t\t\tbadge\n\t\t\t\t\t\t\t\t\t\t\tico-arrow-down\n\t\t\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Развернуть\')}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\x3c!-- Иконка папок --\x3e\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<div bem:elem="folder-ico" qa:id="folder-ico">\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{attrs[\'folder-ico\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{attrs[\'folder-ico\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\n\t\t\t\t\t\t<fn:if test="attrs[\'has-virtual-containers\'] && attrs[\'child-level\'] === 0 && attrs.avatarSrc">\n\t\t\t\t\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\t\tsrc="{attrs.avatarSrc}"\n\t\t\t\t\t\t\t\t\tsize="xs"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t<fn:if test="folder.id === attrs[\'parent-private-folders-container-id\']">\n\t\t\t\t\t\t\t<div bem:elem="hidden-folders-icon" qa:id="hidden-folders-icon">\n\t\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\t\tico="status:lock_on_small"\n\t\t\t\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\t\t\t\tsize="xs"\n\t\t\t\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\x3c!-- Название папки --\x3e\n\t\t\t\t\t\t<div bem:elem="folder-name" qa:id="folder-name:name:{attrs.model.get(\'name\')}">\n\t\t\t\t\t\t\t<bem:mod name="secure" test="attrs.model.get(\'security\')"/>\n\t\t\t\t\t\t\t<bem:mod name="shared" test="attrs.model.isShared()"/>\n\t\t\t\t\t\t\t<bem:mod name="shared-give" test="attrs.model.isShareGive()"/>\n\n\t\t\t\t\t\t\t<div bem:elem="folder-name__txt" qa:id="folder-name">\n\t\t\t\t\t\t\t\t<fn:value>attrs.title</fn:value>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<fn:if test="attrs.model.isSecure()">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-name__lock">\n\t\t\t\t\t\t\t\t\t\x3c!-- Замок если папка запаролена --\x3e\n\t\t\t\t\t\t\t\t\t<fn:if test="!attrs.model.isSecureOpen()">\n\t\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\t\tname="{attrs.icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t\t\tmod="{attrs.icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\x3c!-- Замок если папка распаролена --\x3e\n\t\t\t\t\t\t\t\t\t<fn:if test="attrs.model.isSecureOpen()">\n\t\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\t\tname="{attrs.icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t\t\tmod="{attrs.icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t<fn:if test="attrs.model.isShareGive()">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-name__shared">\n\t\t\t\t\t\t\t\t\t\x3c!-- Значок расшаренной папки --\x3e\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{attrs.icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{attrs.icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- Кнопка Очистить для корзины и спама, если там есть письма --\x3e\n\t\t\t\t\t\t<fn:if test="attrs[\'show-clear\']">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="folder-clear"\n\t\t\t\t\t\t\t\tqa:id="folder-clear"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\tradar-id="clear-{folder.isTrashLike() ? \'trash\' : \'spam\'}"\n\t\t\t\t\t\t\t\t\tremit:click.prevent="clear"\n\t\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\t\ttext="{i18n(\'Очистить\')}"\n\t\t\t\t\t\t\t\t\tbadge\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\x3c!-- Счетчик непрочитанных --\x3e\n\t\t\t\t\t\t<fn:if test="!attrs[\'counters-off\'] && attrs.unread && !folder.isTrashLike() && !folder.isSpam() && !folder.isArchive()">\n\t\t\t\t\t\t\t<div bem:elem="folder-badge" data-folder-id="{folder.id}">\n\t\t\t\t\t\t\t\t<fn:var name="unreadLimit" value="{attrs[\'nav-short\'] ? 99 : 999}"/>\n\t\t\t\t\t\t\t\t<b:badge\n\t\t\t\t\t\t\t\t\t\ttext="{attrs.unread > unreadLimit ? unreadLimit + \'+\' : attrs.unread}"\n\t\t\t\t\t\t\t\t\t\tsize="{attrs[\'nav-short\'] ? attrs.ponymode ? \'xxs_alt\' : \'s_alt\' : \'m\'}"\n\t\t\t\t\t\t\t\t\t\ttransparent="{attrs.short}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</b:immutable-virtual-block>\n\t\t\t<fn:if test="!attrs.short && attrs[\'has-virtual-containers\'] && _this.isMyFoldersContainerExpanded() && _this.isLastOfMyFolders(folder)">\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="new-folder-btn-wrapper"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\t\t\t\t\t<b:new-folder-btn\n\t\t\t\t\t\tkey="{folder.id}"\n\t\t\t\t\t\tisSidebar="{!!attrs.sidebar}"\n\t\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\n\t\t<fn:match name="nav-foot">\n\t\t\t<fn:if test="!attrs.short && !attrs[\'has-virtual-containers\']">\n\t\t\t\t<hr bem:elem="hr"/>\n\n\t\t\t\t<b:new-folder-btn\n\t\t\t\t\tisSidebar="{!!attrs.sidebar}"\n\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs[\'touch\'] && attrs[\'touch-nav\']">\n\t\t\t\t<a bem:elem="item" remit:click.prevent.stop="settings:click" href="/settings/">\n\t\t\t\t\t<table bem:elem="folder">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td bem:elem="folder-ico">\n\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\tname="setting"\n\t\t\t\t\t\t\t\t\tmod="setting"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td bem:elem="folder-name">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-name__txt">\n\t\t\t\t\t\t\t\t\t<fn:value>i18n("Настройки")</fn:value>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</a>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\t</b:nav>\n</div>\n',"app/feast-tpl!ui-block/nav-folders/nav-folders.html")});define("feast-tpl!ui-block/nav-folders/nav-folders.html",["feast-tpl!app/feast-tpl!ui-block/nav-folders/nav-folders.html"],function(a){return a});(function(a,b,c,d){"use strict";var e=["","webkit","Moz","MS","ms","o"];var f=b.createElement("div");var g="function";var h=Math.round;var i=Math.abs;var j=Date.now;function k(a,b,c){return setTimeout(s(a,c),b)}function l(a,b,c){if(Array.isArray(a)){m(a,c[b],c);return true}return false}function m(a,b,c){var e;if(!a){return}if(a.forEach){a.forEach(b,c)}else if(a.length!==d){e=0;while(e<a.length){b.call(c,a[e],e,a);e++}}else{for(e in a){a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}}}function n(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace");var d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace";var f=a.console&&(a.console.warn||a.console.log);if(f){f.call(a.console,e,d)}return b.apply(this,arguments)}}var o;if(typeof Object.assign!=="function"){o=function a(b){if(b===d||b===null){throw new TypeError("Cannot convert undefined or null to object")}var c=Object(b);for(var e=1;e<arguments.length;e++){var f=arguments[e];if(f!==d&&f!==null){for(var g in f){if(f.hasOwnProperty(g)){c[g]=f[g]}}}}return c}}else{o=Object.assign}var p=n(function a(b,c,e){var f=Object.keys(c);var g=0;while(g<f.length){if(!e||e&&b[f[g]]===d){b[f[g]]=c[f[g]]}g++}return b},"extend","Use `assign`.");var q=n(function a(b,c){return p(b,c,true)},"merge","Use `assign`.");function r(a,b,c){var d=b.prototype,e;e=a.prototype=Object.create(d);e.constructor=a;e._super=d;if(c){o(e,c)}}function s(a,b){return function c(){return a.apply(b,arguments)}}function t(a,b){if(typeof a==g){return a.apply(b?b[0]||d:d,b)}return a}function u(a,b){return a===d?b:a}function v(a,b,c){m(z(b),function(b){a.addEventListener(b,c,false)})}function w(a,b,c){m(z(b),function(b){a.removeEventListener(b,c,false)})}function x(a,b){while(a){if(a==b){return true}a=a.parentNode}return false}function y(a,b){return a.indexOf(b)>-1}function z(a){return a.trim().split(/\s+/g)}function A(a,b,c){if(a.indexOf&&!c){return a.indexOf(b)}else{var d=0;while(d<a.length){if(c&&a[d][c]==b||!c&&a[d]===b){return d}d++}return-1}}function B(a){return Array.prototype.slice.call(a,0)}function C(a,b,c){var d=[];var e=[];var f=0;while(f<a.length){var g=b?a[f][b]:a[f];if(A(e,g)<0){d.push(a[f])}e[f]=g;f++}if(c){if(!b){d=d.sort()}else{d=d.sort(function a(c,d){return c[b]>d[b]})}}return d}function D(a,b){var c,f;var g=b[0].toUpperCase()+b.slice(1);var h=0;while(h<e.length){c=e[h];f=c?c+g:b;if(f in a){return f}h++}return d}var E=1;function F(){return E++}function G(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}var H=/mobile|tablet|ip(ad|hone|od)|android/i;var I="ontouchstart"in a;var J=D(a,"PointerEvent")!==d;var K=I&&H.test(navigator.userAgent);var L="touch";var M="pen";var N="mouse";var O="kinect";var P=25;var Q=1;var R=2;var S=4;var T=8;var U=1;var V=2;var W=4;var X=8;var Y=16;var Z=V|W;var _=X|Y;var aa=Z|_;var ba=["x","y"];var ca=["clientX","clientY"];function da(a,b){var c=this;this.manager=a;this.callback=b;this.element=a.element;this.target=a.options.inputTarget;this.domHandler=function(b){if(t(a.options.enable,[a])){c.handler(b)}};this.init()}da.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler);this.evTarget&&v(this.target,this.evTarget,this.domHandler);this.evWin&&v(G(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&w(this.element,this.evEl,this.domHandler);this.evTarget&&w(this.target,this.evTarget,this.domHandler);this.evWin&&w(G(this.element),this.evWin,this.domHandler)}};function ea(a){var b;var c=a.options.inputClass;if(c){b=c}else if(J){b=za}else if(K){b=Ha}else if(!I){b=ua}else{b=La}return new b(a,fa)}function fa(a,b,c){var d=c.pointers.length;var e=c.changedPointers.length;var f=b&Q&&d-e===0;var g=b&(S|T)&&d-e===0;c.isFirst=!!f;c.isFinal=!!g;if(f){a.session={}}c.eventType=b;ga(a,c);a.emit("hammer.input",c);a.recognize(c);a.session.prevInput=c}function ga(a,b){var c=a.session;var d=b.pointers;var e=d.length;if(!c.firstInput){c.firstInput=ja(b)}if(e>1&&!c.firstMultiple){c.firstMultiple=ja(b)}else if(e===1){c.firstMultiple=false}var f=c.firstInput;var g=c.firstMultiple;var h=g?g.center:f.center;var k=b.center=ka(d);b.timeStamp=j();b.deltaTime=b.timeStamp-f.timeStamp;b.angle=oa(h,k);b.distance=na(h,k);ha(c,b);b.offsetDirection=ma(b.deltaX,b.deltaY);var l=la(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=l.x;b.overallVelocityY=l.y;b.overallVelocity=i(l.x)>i(l.y)?l.x:l.y;b.scale=g?qa(g.pointers,d):1;b.rotation=g?pa(g.pointers,d):0;b.maxPointers=!c.prevInput?b.pointers.length:b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers;ia(c,b);var m=a.element;if(x(b.srcEvent.target,m)){m=b.srcEvent.target}b.target=m}function ha(a,b){var c=b.center;var d=a.offsetDelta||{};var e=a.prevDelta||{};var f=a.prevInput||{};if(b.eventType===Q||f.eventType===S){e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0};d=a.offsetDelta={x:c.x,y:c.y}}b.deltaX=e.x+(c.x-d.x);b.deltaY=e.y+(c.y-d.y)}function ia(a,b){var c=a.lastInterval||b,e=b.timeStamp-c.timeStamp,f,g,h,j;if(b.eventType!=T&&(e>P||c.velocity===d)){var k=b.deltaX-c.deltaX;var l=b.deltaY-c.deltaY;var m=la(e,k,l);g=m.x;h=m.y;f=i(m.x)>i(m.y)?m.x:m.y;j=ma(k,l);a.lastInterval=b}else{f=c.velocity;g=c.velocityX;h=c.velocityY;j=c.direction}b.velocity=f;b.velocityX=g;b.velocityY=h;b.direction=j}function ja(a){var b=[];var c=0;while(c<a.pointers.length){b[c]={clientX:h(a.pointers[c].clientX),clientY:h(a.pointers[c].clientY)};c++}return{timeStamp:j(),pointers:b,center:ka(b),deltaX:a.deltaX,deltaY:a.deltaY}}function ka(a){var b=a.length;if(b===1){return{x:h(a[0].clientX),y:h(a[0].clientY)}}var c=0,d=0,e=0;while(e<b){c+=a[e].clientX;d+=a[e].clientY;e++}return{x:h(c/b),y:h(d/b)}}function la(a,b,c){return{x:b/a||0,y:c/a||0}}function ma(a,b){if(a===b){return U}if(i(a)>=i(b)){return a<0?V:W}return b<0?X:Y}function na(a,b,c){if(!c){c=ba}var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function oa(a,b,c){if(!c){c=ba}var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.atan2(e,d)*180/Math.PI}function pa(a,b){return oa(b[1],b[0],ca)+oa(a[1],a[0],ca)}function qa(a,b){return na(b[0],b[1],ca)/na(a[0],a[1],ca)}var ra={mousedown:Q,mousemove:R,mouseup:S};var sa="mousedown";var ta="mousemove mouseup";function ua(){this.evEl=sa;this.evWin=ta;this.pressed=false;da.apply(this,arguments)}r(ua,da,{handler:function a(b){var c=ra[b.type];if(c&Q&&b.button===0){this.pressed=true}if(c&R&&b.which!==1){c=S}if(!this.pressed){return}if(c&S){this.pressed=false}this.callback(this.manager,c,{pointers:[b],changedPointers:[b],pointerType:N,srcEvent:b})}});var va={pointerdown:Q,pointermove:R,pointerup:S,pointercancel:T,pointerout:T};var wa={2:L,3:M,4:N,5:O};var xa="pointerdown";var ya="pointermove pointerup pointercancel";if(a.MSPointerEvent&&!a.PointerEvent){xa="MSPointerDown";ya="MSPointerMove MSPointerUp MSPointerCancel"}function za(){this.evEl=xa;this.evWin=ya;da.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}r(za,da,{handler:function a(b){var c=this.store;var d=false;var e=b.type.toLowerCase().replace("ms","");var f=va[e];var g=wa[b.pointerType]||b.pointerType;var h=g==L;var i=A(c,b.pointerId,"pointerId");if(f&Q&&(b.button===0||h)){if(i<0){c.push(b);i=c.length-1}}else if(f&(S|T)){d=true}if(i<0){return}c[i]=b;this.callback(this.manager,f,{pointers:c,changedPointers:[b],pointerType:g,srcEvent:b});if(d){c.splice(i,1)}}});var Aa={touchstart:Q,touchmove:R,touchend:S,touchcancel:T};var Ba="touchstart";var Ca="touchstart touchmove touchend touchcancel";function Da(){this.evTarget=Ba;this.evWin=Ca;this.started=false;da.apply(this,arguments)}r(Da,da,{handler:function a(b){var c=Aa[b.type];if(c===Q){this.started=true}if(!this.started){return}var d=Ea.call(this,b,c);if(c&(S|T)&&d[0].length-d[1].length===0){this.started=false}this.callback(this.manager,c,{pointers:d[0],changedPointers:d[1],pointerType:L,srcEvent:b})}});function Ea(a,b){var c=B(a.touches);var d=B(a.changedTouches);if(b&(S|T)){c=C(c.concat(d),"identifier",true)}return[c,d]}var Fa={touchstart:Q,touchmove:R,touchend:S,touchcancel:T};var Ga="touchstart touchmove touchend touchcancel";function Ha(){this.evTarget=Ga;this.targetIds={};da.apply(this,arguments)}r(Ha,da,{handler:function a(b){var c=Fa[b.type];var d=Ia.call(this,b,c);if(!d){return}this.callback(this.manager,c,{pointers:d[0],changedPointers:d[1],pointerType:L,srcEvent:b})}});function Ia(a,b){var c=B(a.touches);var d=this.targetIds;if(b&(Q|R)&&c.length===1){d[c[0].identifier]=true;return[c,c]}var e,f,g=B(a.changedTouches),h=[],i=this.target;f=c.filter(function(a){return x(a.target,i)});if(b===Q){e=0;while(e<f.length){d[f[e].identifier]=true;e++}}e=0;while(e<g.length){if(d[g[e].identifier]){h.push(g[e])}if(b&(S|T)){delete d[g[e].identifier]}e++}if(!h.length){return}return[C(f.concat(h),"identifier",true),h]}var Ja=2500;var Ka=25;function La(){da.apply(this,arguments);var a=s(this.handler,this);this.touch=new Ha(this.manager,a);this.mouse=new ua(this.manager,a);this.primaryTouch=null;this.lastTouches=[]}r(La,da,{handler:function a(b,c,d){var e=d.pointerType==L,f=d.pointerType==N;if(f&&d.sourceCapabilities&&d.sourceCapabilities.firesTouchEvents){return}if(e){Ma.call(this,c,d)}else if(f&&Oa.call(this,d)){return}this.callback(b,c,d)},destroy:function a(){this.touch.destroy();this.mouse.destroy()}});function Ma(a,b){if(a&Q){this.primaryTouch=b.changedPointers[0].identifier;Na.call(this,b)}else if(a&(S|T)){Na.call(this,b)}}function Na(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches;var e=function(){var a=d.indexOf(c);if(a>-1){d.splice(a,1)}};setTimeout(e,Ja)}}function Oa(a){var b=a.srcEvent.clientX,c=a.srcEvent.clientY;for(var d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d];var f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(f<=Ka&&g<=Ka){return true}}return false}var Pa=D(f.style,"touchAction");var Qa=Pa!==d;var Ra="compute";var Sa="auto";var Ta="manipulation";var Ua="none";var Va="pan-x";var Wa="pan-y";var Xa=$a();function Ya(a,b){this.manager=a;this.set(b)}Ya.prototype={set:function(a){if(a==Ra){a=this.compute()}if(Qa&&this.manager.element.style&&Xa[a]){this.manager.element.style[Pa]=a}this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];m(this.manager.recognizers,function(b){if(t(b.options.enable,[b])){a=a.concat(b.getTouchAction())}});return Za(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent;var c=a.offsetDirection;if(this.manager.session.prevented){b.preventDefault();return}var d=this.actions;var e=y(d,Ua)&&!Xa[Ua];var f=y(d,Wa)&&!Xa[Wa];var g=y(d,Va)&&!Xa[Va];if(e){var h=a.pointers.length===1;var i=a.distance<2;var j=a.deltaTime<250;if(h&&i&&j){return}}if(g&&f){return}if(e||f&&c&Z||g&&c&_){return this.preventSrc(b)}},preventSrc:function(a){this.manager.session.prevented=true;a.preventDefault()}};function Za(a){if(y(a,Ua)){return Ua}var b=y(a,Va);var c=y(a,Wa);if(b&&c){return Ua}if(b||c){return b?Va:Wa}if(y(a,Ta)){return Ta}return Sa}function $a(){if(!Qa){return false}var b={};var c=a.CSS&&a.CSS.supports;["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=c?a.CSS.supports("touch-action",d):true});return b}var _a=1;var ab=2;var bb=4;var cb=8;var db=cb;var eb=16;var fb=32;function gb(a){this.options=o({},this.defaults,a||{});this.id=F();this.manager=null;this.options.enable=u(this.options.enable,true);this.state=_a;this.simultaneous={};this.requireFail=[]}gb.prototype={defaults:{},set:function(a){o(this.options,a);this.manager&&this.manager.touchAction.update();return this},recognizeWith:function(a){if(l(a,"recognizeWith",this)){return this}var b=this.simultaneous;a=jb(a,this);if(!b[a.id]){b[a.id]=a;a.recognizeWith(this)}return this},dropRecognizeWith:function(a){if(l(a,"dropRecognizeWith",this)){return this}a=jb(a,this);delete this.simultaneous[a.id];return this},requireFailure:function(a){if(l(a,"requireFailure",this)){return this}var b=this.requireFail;a=jb(a,this);if(A(b,a)===-1){b.push(a);a.requireFailure(this)}return this},dropRequireFailure:function(a){if(l(a,"dropRequireFailure",this)){return this}a=jb(a,this);var b=A(this.requireFail,a);if(b>-1){this.requireFail.splice(b,1)}return this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){var b=this;var c=this.state;function d(c){b.manager.emit(c,a)}if(c<cb){d(b.options.event+hb(c))}d(b.options.event);if(a.additionalEvent){d(a.additionalEvent)}if(c>=cb){d(b.options.event+hb(c))}},tryEmit:function(a){if(this.canEmit()){return this.emit(a)}this.state=fb},canEmit:function(){var a=0;while(a<this.requireFail.length){if(!(this.requireFail[a].state&(fb|_a))){return false}a++}return true},recognize:function(a){var b=o({},a);if(!t(this.options.enable,[this,b])){this.reset();this.state=fb;return}if(this.state&(db|eb|fb)){this.state=_a}this.state=this.process(b);if(this.state&(ab|bb|cb|eb)){this.tryEmit(b)}},process:function(a){},getTouchAction:function(){},reset:function(){}};function hb(a){if(a&eb){return"cancel"}else if(a&cb){return"end"}else if(a&bb){return"move"}else if(a&ab){return"start"}return""}function ib(a){if(a==Y){return"down"}else if(a==X){return"up"}else if(a==V){return"left"}else if(a==W){return"right"}return""}function jb(a,b){var c=b.manager;if(c){return c.get(a)}return a}function kb(){gb.apply(this,arguments)}r(kb,gb,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return b===0||a.pointers.length===b},process:function(a){var b=this.state;var c=a.eventType;var d=b&(ab|bb);var e=this.attrTest(a);if(d&&(c&T||!e)){return b|eb}else if(d||e){if(c&S){return b|cb}else if(!(b&ab)){return ab}return b|bb}return fb}});function lb(){kb.apply(this,arguments);this.pX=null;this.pY=null}r(lb,kb,{defaults:{event:"pan",threshold:10,pointers:1,direction:aa},getTouchAction:function(){var a=this.options.direction;var b=[];if(a&Z){b.push(Wa)}if(a&_){b.push(Va)}return b},directionTest:function(a){var b=this.options;var c=true;var d=a.distance;var e=a.direction;var f=a.deltaX;var g=a.deltaY;if(!(e&b.direction)){if(b.direction&Z){e=f===0?U:f<0?V:W;c=f!=this.pX;d=Math.abs(a.deltaX)}else{e=g===0?U:g<0?X:Y;c=g!=this.pY;d=Math.abs(a.deltaY)}}a.direction=e;return c&&d>b.threshold&&e&b.direction},attrTest:function(a){return kb.prototype.attrTest.call(this,a)&&(this.state&ab||!(this.state&ab)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX;this.pY=a.deltaY;var b=ib(a.direction);if(b){a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}});function mb(){kb.apply(this,arguments)}r(mb,kb,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ua]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ab)},emit:function(a){if(a.scale!==1){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}});function nb(){gb.apply(this,arguments);this._timer=null;this._input=null}r(nb,gb,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Sa]},process:function(a){var b=this.options;var c=a.pointers.length===b.pointers;var d=a.distance<b.threshold;var e=a.deltaTime>b.time;this._input=a;if(!d||!c||a.eventType&(S|T)&&!e){this.reset()}else if(a.eventType&Q){this.reset();this._timer=k(function(){this.state=db;this.tryEmit()},b.time,this)}else if(a.eventType&S){return db}return fb},reset:function(){clearTimeout(this._timer)},emit:function(a){if(this.state!==db){return}if(a&&a.eventType&S){this.manager.emit(this.options.event+"up",a)}else{this._input.timeStamp=j();this.manager.emit(this.options.event,this._input)}}});function ob(){kb.apply(this,arguments)}r(ob,kb,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ua]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ab)}});function pb(){kb.apply(this,arguments)}r(pb,kb,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Z|_,pointers:1},getTouchAction:function(){return lb.prototype.getTouchAction.call(this)},attrTest:function(a){var b=this.options.direction;var c;if(b&(Z|_)){c=a.overallVelocity}else if(b&Z){c=a.overallVelocityX}else if(b&_){c=a.overallVelocityY}return this._super.attrTest.call(this,a)&&b&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&i(c)>this.options.velocity&&a.eventType&S},emit:function(a){var b=ib(a.offsetDirection);if(b){this.manager.emit(this.options.event+b,a)}this.manager.emit(this.options.event,a)}});function qb(){gb.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0}r(qb,gb,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ta]},process:function(a){var b=this.options;var c=a.pointers.length===b.pointers;var d=a.distance<b.threshold;var e=a.deltaTime<b.time;this.reset();if(a.eventType&Q&&this.count===0){return this.failTimeout()}if(d&&e&&c){if(a.eventType!=S){return this.failTimeout()}var f=this.pTime?a.timeStamp-this.pTime<b.interval:true;var g=!this.pCenter||na(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp;this.pCenter=a.center;if(!g||!f){this.count=1}else{this.count+=1}this._input=a;var h=this.count%b.taps;if(h===0){if(!this.hasRequireFailures()){return db}else{this._timer=k(function(){this.state=db;this.tryEmit()},b.interval,this);return ab}}}return fb},failTimeout:function(){this._timer=k(function(){this.state=fb},this.options.interval,this);return fb},reset:function(){clearTimeout(this._timer)},emit:function(){if(this.state==db){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input)}}});function rb(a,b){b=b||{};b.recognizers=u(b.recognizers,rb.defaults.preset);return new ub(a,b)}rb.VERSION="2.0.7";rb.defaults={domEvents:false,touchAction:Ra,enable:true,inputTarget:null,inputClass:null,preset:[[ob,{enable:false}],[mb,{enable:false},["rotate"]],[pb,{direction:Z}],[lb,{direction:Z},["swipe"]],[qb],[qb,{event:"doubletap",taps:2},["tap"]],[nb]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var sb=1;var tb=2;function ub(a,b){this.options=o({},rb.defaults,b||{});this.options.inputTarget=this.options.inputTarget||a;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=a;this.input=ea(this);this.touchAction=new Ya(this,this.options.touchAction);vb(this,true);m(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]);a[3]&&b.requireFailure(a[3])},this)}ub.prototype={set:function(a){o(this.options,a);if(a.touchAction){this.touchAction.update()}if(a.inputTarget){this.input.destroy();this.input.target=a.inputTarget;this.input.init()}return this},stop:function(a){this.session.stopped=a?tb:sb},recognize:function(a){var b=this.session;if(b.stopped){return}this.touchAction.preventDefaults(a);var c;var d=this.recognizers;var e=b.curRecognizer;if(!e||e&&e.state&db){e=b.curRecognizer=null}var f=0;while(f<d.length){c=d[f];if(b.stopped!==tb&&(!e||c==e||c.canRecognizeWith(e))){c.recognize(a)}else{c.reset()}if(!e&&c.state&(ab|bb|cb)){e=b.curRecognizer=c}f++}},get:function(a){if(a instanceof gb){return a}var b=this.recognizers;for(var c=0;c<b.length;c++){if(b[c].options.event==a){return b[c]}}return null},add:function(a){if(l(a,"add",this)){return this}var b=this.get(a.options.event);if(b){this.remove(b)}this.recognizers.push(a);a.manager=this;this.touchAction.update();return a},remove:function(a){if(l(a,"remove",this)){return this}a=this.get(a);if(a){var b=this.recognizers;var c=A(b,a);if(c!==-1){b.splice(c,1);this.touchAction.update()}}return this},on:function(a,b){if(a===d){return}if(b===d){return}var c=this.handlers;m(z(a),function(a){c[a]=c[a]||[];c[a].push(b)});return this},off:function(a,b){if(a===d){return}var c=this.handlers;m(z(a),function(a){if(!b){delete c[a]}else{c[a]&&c[a].splice(A(c[a],b),1)}});return this},emit:function(a,b){if(this.options.domEvents){wb(a,b)}var c=this.handlers[a]&&this.handlers[a].slice();if(!c||!c.length){return}b.type=a;b.preventDefault=function(){b.srcEvent.preventDefault()};var d=0;while(d<c.length){c[d](b);d++}},destroy:function(){this.element&&vb(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null}};function vb(a,b){var c=a.element;if(!c.style){return}var d;m(a.options.cssProps,function(e,f){d=D(c.style,f);if(b){a.oldCssProps[d]=c.style[d];c.style[d]=e}else{c.style[d]=a.oldCssProps[d]||""}});if(!b){a.oldCssProps={}}}function wb(a,c){var d=b.createEvent("Event");d.initEvent(a,true,true);d.gesture=c;c.target.dispatchEvent(d)}o(rb,{INPUT_START:Q,INPUT_MOVE:R,INPUT_END:S,INPUT_CANCEL:T,STATE_POSSIBLE:_a,STATE_BEGAN:ab,STATE_CHANGED:bb,STATE_ENDED:cb,STATE_RECOGNIZED:db,STATE_CANCELLED:eb,STATE_FAILED:fb,DIRECTION_NONE:U,DIRECTION_LEFT:V,DIRECTION_RIGHT:W,DIRECTION_UP:X,DIRECTION_DOWN:Y,DIRECTION_HORIZONTAL:Z,DIRECTION_VERTICAL:_,DIRECTION_ALL:aa,Manager:ub,Input:da,TouchAction:Ya,TouchInput:Ha,MouseInput:ua,PointerEventInput:za,TouchMouseInput:La,SingleTouchInput:Da,Recognizer:gb,AttrRecognizer:kb,Tap:qb,Pan:lb,Swipe:pb,Pinch:mb,Rotate:ob,Press:nb,on:v,off:w,each:m,merge:q,extend:p,assign:o,inherit:r,bindFn:s,prefixed:D});var xb=typeof a!=="undefined"?a:typeof self!=="undefined"?self:{};xb.Hammer=rb;if(typeof define==="function"&&define.amd){define("hammerjs/hammer",function(){return rb})}else if(typeof module!="undefined"&&module.exports){module.exports=rb}else{a[c]=rb}})(window,document,"Hammer");define("hammerjs",["hammerjs/hammer"],function(a){return a});define("helpers/folder-to-ico-map",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFolderType=c;exports.getFolderIco=d;var a={inbox:"categories:mail",sent:"actions:reply",drafts:"categories:drafts",templates:"navigation:folder",spam:"actions:dislike",trash:"actions:delete",archive:"actions:archive",user:"navigation:folder",social:"navigation:users",promotions:"categories:discounts",newsletters:"categories:mailings",tomyself:"categories:self_mail",news:"categories:subscriptions",official:"categories:government",receipts:"categories:receipts",school:"categories:school",games:"categories:games",outbox:"status:time",folder:"navigation:folder",shared:"navigation:user_s",child_trash:"actions:delete",parental_control:"navigation:tip","lock-on":"status:lock_on_small","lock-off":"status:lock_off_small","lock-on_fill":"mail_20:status:lock_on_small","lock-off_fill":"mail_20:status:lock_off_small"};exports.default=a;var b=exports.folder2icoMapHelperPonyMode={inbox:"categories:mail_s",sent:"actions:reply_s",drafts:"categories:drafts_s",templates:"navigation:folder_s",spam:"actions:dislike_s",trash:"actions:delete_s",archive:"actions:archive_s",user:"navigation:folder_s",social:"navigation:users_s",promotions:"categories:discounts",newsletters:"categories:mailings_s",tomyself:"categories:self_mail_s",news:"categories:subscriptions_s",official:"categories:government_s",receipts:"categories:receipts_s",school:"categories:school_s",games:"categories:games_s",outbox:"status:time_s",folder:"navigation:folder_s",shared:"navigation:user_s",child_trash:"actions:delete_s",parental_control:"navigation:tip_s","lock-on":"status:lock_on_small","lock-off":"status:lock_off_small","lock-on_fill":"mail_20:status:lock_on_small","lock-off_fill":"mail_20:status:lock_off_small"};function c(a){var b=a.get("type");if(b==="archive"&&!a.isArchive()){b="user"}if(a.isArchive()){b="archive"}return b}function d(b){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a;var e=c(b);return b.isSystem()||b.isArchive()?d[e]||d.folder:d.folder}});var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-avatar-path",["require","exports","cfg"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);function b(b){var c=b.email,d=b.name,e=__rest(b,["email","name"]);var f=a.default.get("urls.avatarUrl");var g;if("size"in e){var h=e.size;g="width="+h+"&height="+h}else{var i=e.width,j=e.height;g="width="+i+"&height="+j}var k="&email="+encodeURIComponent(c)+(d?"&name="+encodeURIComponent(d):"");return f+"/pic?"+g+k}exports.default=b});define("feast-tpl!app/feast-tpl!ui-block/nav/nav.html",["feast"],function(a){return a.smartParse('<nav>\n\t<bem:mod name="short" test="attrs.short"/>\n\t<bem:mod name="expanded" test="!attrs.short"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="clean" test="attrs.clean"/>\n\t<bem:mod name="touch-nav" test="attrs[\'touch-nav\']"/>\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\n\t\x3c!-- Для nav.spec.js--\x3e\n\t<fn:match name="nav-item" args="item">\n\t\t<span\n\t\t\tbem:elem="item"\n\t\t\tkey="{item.id}">\n\n\t\t\t<bem:mod name="active" test="item.active" />\n\t\t\t<bem:mod name="shortcut" test="attrs.short" />\n\n\t\t\t<table bem:elem="folder">\n\t\t\t\t<tr>\n\t\t\t\t\t<td bem:elem="folder-ico">\n\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\tname="{item.icon}"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<fn:if test="!attrs.short">\n\t\t\t\t\t\t<td bem:elem="folder-name">\n\t\t\t\t\t\t\t<div bem:elem="folder-name__txt">\n\t\t\t\t\t\t\t\t<fn:value>item.title</fn:value>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</span>\n\t</fn:match>\n\n\t<fn:apply-match name="nav-head"/>\n\n\n\t<fn:var name="myFoldersItem" value="{_this.getMyFoldersItem(attrs.models)}"/>\n\n\t<fn:if test="attrs[\'has-parent-private-folders\']">\n\t\t<fn:apply-match name="nav-item" args="_this.getParentPrivateFoldersItem()" />\n\t\t<fn:for data="_this.getParentPrivateFolders(attrs.models)" as="item">\n\t\t\t<fn:if test="!item.hidden">\n\t\t\t\t<fn:apply-match name="nav-item" args="item" />\n\t\t\t</fn:if>\n\t\t</fn:for>\n\t\t<hr bem:elem="hr"/>\n\t</fn:if>\n\n\t<fn:if test="!!myFoldersItem">\n\t\t<fn:apply-match name="nav-item" args="myFoldersItem"/>\n\t</fn:if>\n\t<fn:for data="_this.getCommonFolders(attrs.models)" as="item">\n\t\t<fn:if test="!item.hidden">\n\t\t\t<fn:apply-match name="nav-item" args="item" myFoldersItem="myFoldersItem"/>\n\t\t</fn:if>\n\t</fn:for>\n\n\t<fn:apply-match name="nav-foot"/>\n</nav>\n',"app/feast-tpl!ui-block/nav/nav.html")});define("feast-tpl!ui-block/nav/nav.html",["feast-tpl!app/feast-tpl!ui-block/nav/nav.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/nav/nav",["require","exports","default-values","feast","feast-tpl!./nav.html","helpers/browser","helpers/folder","mail/Folder","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"nav",template:c.default,defaults:{"hover-support":d.default.capabilities["hover-support"]},blocks:{ico:g.default},getMyFoldersItem:function(){var b=this.get("models");if(!f.default.all.hasSharedTake.call(b)&&!this.get("has-parent-private-folders")){return null}var c=this.get("has-parent-private-folders")?i18n("Детские папки"):i18n("Мои папки");if(this.myFoldersItem&&this.myFoldersItem.get("name")===c){return this.myFoldersItem}this.myFoldersItem=new f.default(e.virtualFolderData({type:a.NAV_MY_FOLDERS_CONTAINER_ID,name:c}));return this.myFoldersItem},getParentPrivateFoldersItem:function(){if(!this.get("has-parent-private-folders")){return null}if(this.parentPrivateFoldersItem){return this.parentPrivateFoldersItem}this.parentPrivateFoldersItem=new f.default(e.virtualFolderData({type:a.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID,name:i18n("Скрытые папки")}));return this.parentPrivateFoldersItem},getParentPrivateFolders:function(a){return a.filter(function(a){return e.isParentPrivateFolder(a)})},getCommonFolders:function(a){return a.filter(function(a){return!e.isParentPrivateFolder(a)})}})});define("feast-tpl!app/feast-tpl!ui-block/new-folder-btn/new-folder-btn.html",["feast"],function(a){return a.smartParse('<div data-qa-id="new-folder-btn">\n\t<bem:mod name="in-sidebar" test="attrs.isSidebar"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\n\t<div bem:elem="button-wrapper">\n\t\t<b:button2\n\t\t\tbem:elem="btn"\n\t\t\tremit:click="openPopup"\n\t\t\tshort="{attrs.short}"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tdropmenu="{!attrs.isSidebar}"\n\t\t\tnowrap\n\t\t\ttext-overflow\n\t\t\tfluid\n\t\t\tpure\n\t\t\tico="{attrs.ponymode ? \'actions:add\' : \'actions:add_big\'}"\n\t\t\ttext="{i18n(\'Новая папка\')}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/new-folder-btn/new-folder-btn.html")});define("feast-tpl!ui-block/new-folder-btn/new-folder-btn.html",["feast-tpl!app/feast-tpl!ui-block/new-folder-btn/new-folder-btn.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/new-folder-btn/new-folder-btn",["require","exports","feast","feast-tpl!./new-folder-btn.html","ui-block/button2/button2"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"new-folder-btn",template:b.default,events:{openPopup:"openPopup"},blocks:{button2:c.default},didMount:function(){var a=this;new Promise(function(a,b){require(["mediator/folders-actions"],a,b)}).then(__importStar).then(function(b){var c=b.default;c.register(a)})},openPopup:function(){this.broadcast("add",{model:{params:{isSidebar:this.get("isSidebar")}}})}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/nav-folders/nav-folders",["require","exports","@mail/xray","default-values","feast","feast-mod/folder-name","feast-mod/letter-count","feast-mod/letters-count","feast-tpl!./nav-folders.html","hammerjs","helpers/browser","helpers/folder","helpers/folder-to-ico-map","helpers/get-avatar-path","helpers/keys","mail/Folder","service/auth","service/contextmenu","service/radars/decorator","service/radars/index","service/secure-folder","service/smokescreen","service/storage","ui-block/avatar/avatar","ui-block/badge/badge","ui-block/button2/button2","ui-block/ico/ico","ui-block/nav/nav","ui-block/new-folder-btn/new-folder-btn"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);k=__importStar(k);l=__importDefault(l);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);var B="folders:expanded";var C=u.default.get(B)||{};var D=i.default.capabilities["touch-support"];exports.default=z.default.extend(q.default({explicit:"radar"})({name:"nav-folders",template:g.default,isolateEvents:false,blocks:{ico:y.default,nav:z.default,button2:x.default,badge:w.default,"new-folder-btn":A.default,avatar:v.default},folder2shortcutMap:{inbox:"g,i",drafts:"g,d",sent:"g,s"},displayedShortcut:["parental_control","inbox","sent","drafts","outbox","archive","spam","trash","child_trash"],events:{foldertoggle:"onFolderClick",folderclick:"onFolderLinkClick",rightclick:"onRightClick"},defaults:{short:false,active:null,"handle-drop":false,router:null,"counters-off":false,"with-clear":false,mobile:b.TOUCH_MODE,hasSharedFolders:false,lastOfMyFoldersId:false,"has-parent-private-folders":false,"has-virtual-containers":false,"parent-private-folders-container-id":b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID},attrChanged:{active:function(a){var c=n.default.all.get(a);if(c){var d=c.get("parent");if(this.isFolderInMyFoldersContainer(c)){d=b.NAV_MY_FOLDERS_CONTAINER_ID}else if(j.isParentPrivateFolder(c)){d=b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID}if(d!=-1&&!C[d]){this.toggleFolderExpand(d)}}},models:function(){var a=this.get("models");var b=n.default.all.hasSharedTake.call(a);var c=b||j.hasParentPrivateFolders(a);if(c||c!==this.get("has-virtual-containers")||j.hasParentPrivateFolders(a)!==this.get("has-parent-private-folders")){this.set({"has-parent-private-folders":j.hasParentPrivateFolders(a),"has-virtual-containers":c,lastOfMyFoldersId:this.getLastOfMyFoldersId()})}}},didMount:function(){var a=this;this._dragExpandedFolders=[];this.highlight=null;if(D){var b=new h.default.Manager(this.el);var c=new h.default.Press({time:500});b.add(c);b.on("press",function(b){var c=b.target.closest("[data-folder-link-id]");if(c){var d=n.default.all.get(c.dataset.folderLinkId);var e=__assign(__assign({},b),{originalEvent:b.srcEvent,details:d});a.onRightClick(e)}})}},$handleEvent:function(a){var b=this;c.default.Block.prototype.$handleEvent.call(this,a);if(this.mounted&&this.get("handle-drop")&&(a.type==="$created"||a.type==="$mount")){this.el.dragHandleEvent=function(a){return b.dragHandleEvent(a)}}},didUnmount:function(){this.el.dragHandleEvent=null},dragHandleEvent:function(a){var b=this;var d=a.target;var e=null;if(!this.el){return}if(a.type==="drop"){var f=n.default.all.get(this.highlight);f&&this.broadcast("drop",f)}else{var g=t.default.lookup("nav__item");while(d!==document){if(typeof d.className==="string"&&d.className.includes(g)){var h=c.default.Block.get(d);e=h?h.get("model").id:null;break}d=d.parentNode}}if(this.highlight!==e){this.highlight=e}switch(a.type){case"dragleave":case"drop":clearTimeout(this._dragFolderExpandTimer);this._lastFolderId=null;this._dragCollapseTimeout=setTimeout(function(){while(b._dragExpandedFolders.length){b.toggleFolderExpand(b._dragExpandedFolders.pop())}},600);break;case"dragenter":clearTimeout(this._dragCollapseTimeout);break;case"dragmove":if(e&&this._lastFolderId!==e){clearTimeout(this._dragFolderExpandTimer);this._lastFolderId=e;if(!this.isExpanded(e)){this._dragFolderExpandTimer=setTimeout(function(){b.toggleFolderExpand(e);b._dragExpandedFolders.push(e)},600)}}break}if(this.get("short")){switch(a.type){case"dragenter":clearTimeout(this._onDragOverTimer);this._onDragOverTimer=setTimeout(function(){b.broadcast("drag:over")},1e3);break;case"dragleave":case"drop":clearTimeout(this._onDragOverTimer);this.highlight=null;break}}},onFolderClick:function(a){var b=a.details;var c=b.get("model").id;this.toggleFolderExpand(c)},toggleFolderExpand:function(a){var b=true;if(C[a]){C[a]=false;b=false}else{C[a]=true}u.default.set(B,C);this.radar([b?"expand":"collapse"]);this.render()},isExpanded:function(a){if(C[a]===undefined){if(this.isMyFoldersContainerById(a)||this.isParentPrivateFoldersContainerById(a)){C[a]=true;return C[a]}var b=n.default.all.get(a);if(b&&b.getChildLevel()!==b.getMaxChildLevel()){C[a]=!b.get("security")}}return C[a]||false},isFolderParentsExpanded:function(a){if(!this.get("has-virtual-containers")&&a.isRoot()){return true}if(this.get("has-virtual-containers")){if(this.isFoldersContainer(a)){return true}if(a.isRoot()){return this.isMyFoldersContainerExpanded()}}var c=a.get("parent");var d=n.default.all.get(c);var e=d.getChildLevel();var f=e>=Math.min(d.getMaxChildLevel(),b.FOLDER_MAX_CHILD_LEVEL_UI);var g=this.isExpanded(c)||f;return g?this.isFolderParentsExpanded(d):false},isFolderExpanded:function(a){if(this.is("touch-nav")){return true}if(this.is("expand-all")){return true}if(this.get("has-parent-private-folders")&&a.isRoot()&&j.isParentPrivateFolder(a)&&!this.isParentPrivateFoldersContainer(a)){return this.isExpanded(b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID)&&(!a.get("children")||this.isExpanded(a.id))}if(this.isFolderInMyFoldersContainer(a)){return this.isMyFoldersContainerExpanded()&&(!a.get("children")||this.isExpanded(a.id))}if(a.isRoot()&&!a.get("children")){return true}if(!this.isFolderParentsExpanded(a)){return false}if(a.getChildLevel()===a.getMaxChildLevel()){return true}if(!a.isParent()){return true}return this.isExpanded(a.id)},getFolderUrl:function(a){var b=this.get("router");var c=a.get("id");if(a.isServiceShared()){c=this.getFirstSubFolderId(c)||c}if(this.isMyFoldersContainerById(c)){c=n.default.INBOX}var d=null;if(this.get("showBackToParentFolder")&&c==b.route.params.folder){d={"to-parent-button":1}}return b&&b.getUrl("#letters",{folder:c},d)},onFolderLinkClick:function(c){var d=this;if(c.isDefaultPrevented()){return}var e=c.details.id;if(this.get("has-virtual-containers")){var f=n.default.all.get(e);var g=f===null||f===void 0?void 0:f.get("parent");switch(true){case this.isMyFoldersContainerById(e):{g=b.NAV_MY_FOLDERS_CONTAINER_ID;e=n.default.INBOX;break}case this.isParentPrivateFoldersContainerById(e):{g=b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID;e=this.getFirstParentControlFolder();break}case f===null||f===void 0?void 0:f.isServiceShared():{g=f.get("id");e=this.getFirstSubFolderId(e)||e;break}}if(!C[g]){this.toggleFolderExpand(g)}}var h=c.originalEvent;if(h&&m.isNewTabClick(h)){return}else{c.preventDefault()}var i=this.get("router");if(!i){return}n.default.findOne(e).then(function(b){d.radar(b.get("type"));a.default.send("select_metathread_folder_navigate",{dwh:{category:e,name:b.get("name")}});if(b.isSecureOpen()){d.goToFolder(e);return}s.default(b).then(function(a){return a&&d.goToFolder(e)})});return true},goToFolder:function(b){if(!this.isMounted()){return}var c=this.get("router");var e=null;if(this.get("showBackToParentFolder")&&b==c.route.params.folder){e={"to-parent-button":1}}c&&c.go("#letters",{folder:b},e,{force:true});var f=d.getFolderName(n.default.all.get(b));a.default.send("go_to_folder",{i:{id:b},dwh:{id:b,name:f,folderPos:n.default.all.indexOf(b),foldersQty:n.default.all.length}});r.default({chain:["go","to","folder"],data:{folder:b}});var g=n.default.all.get(b);if(g.isShareTake()){a.default.send("open_shared_folder")}},getMyFoldersContainerMessagesCount:function(){if(this.isMyFoldersContainerExpanded()){return 0}return n.default.all.reduce(function(a,b){if(b.isShareTake()){return a}if(!b.isRoot()){return a}if(j.isParentPrivateFolder(b)){return a}return a+f.countUnreadMod(b,true)},0)},getParentPrivateFoldersContainerMessagesCount:function(){if(this.isExpanded(b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID)){return 0}return n.default.all.reduce(function(a,b){if(!b.isRoot()){return a}if(!j.isParentPrivateFolder(b)){return a}return a+f.countUnreadMod(b,true)},0)},unreadWithChild:function(a){if(this.isMyFoldersContainer(a)){return this.getMyFoldersContainerMessagesCount()}if(this.isParentPrivateFoldersContainer(a)){return this.getParentPrivateFoldersContainerMessagesCount()}return f.countUnreadMod(a)},getUnreadCount:function(a){if(this.isMyFoldersContainer(a)){return this.getMyFoldersContainerMessagesCount()}if(this.isParentPrivateFoldersContainer(a)){return this.getParentPrivateFoldersContainerMessagesCount()}return this.isFolderExpanded(a)?f.countUnreadMod(a,false):f.countUnreadMod(a)},getTotalCount:function(a){return this.isFolderExpanded(a)?f.countTotalMod(a,false):f.countTotalMod(a)},isShortcut:function(a){var b=a.get("type");return a.get("system")&&this.displayedShortcut.includes(b)&&!a.isShareTake()},onRightClick:function(a){if(this.get("has-virtual-containers")){var b=a.details.id;var c=this.isMyFoldersContainerById(b)||this.isParentPrivateFoldersContainerById(b)||this.isOtherUserFoldersContainerById(b);if(c){a.preventDefault();return}}if(!this.get("touch")){p.default.show(a)}},getFolderType:k.getFolderType,getFolder2IcoMap:function(){return this.is("ponymode")?k.folder2icoMapHelperPonyMode:k.default},getFolderIco:function(a){return k.getFolderIco(a,this.getFolder2IcoMap())},getFolderTitle:function(a){if(this.is("mobile")){return null}if(this.is("short")){return a.get("name")}if(!a.isSecureOpen()){return i18n("{folderName}, защищено паролем",{folderName:a.get("name")})}if(this.isFoldersContainer(a)&&this.isFolderExpanded(a)){return a.get("name")}var b=this.getTotalCount(a);var c=this.getUnreadCount(a);var d=a.get("name");if(!b&&!c){return d+", "+i18n("нет писем")}if(b){var f=e.letterCount(b);d+=", "+f}if(c){var g={count:c};var f=i18n.plural(c,[i18n("{count} непрочитанных",g),i18n("{count} непрочитанное",g),i18n("{count} непрочитанных",g)]);d+=", "+f}return d},isClearBtnVisible:function(a){return this.attrs["with-clear"]&&(a.isTrashLike()||a.isSpam())&&a.get("messages_total")!==0&&a.checkGrant(n.default.SHARE_GRANTS.remove)&&!j.isDeleteFromFolderDisabled(a)},isMyFoldersContainer:function(a){var b=a.get("id");return this.isMyFoldersContainerById(b)},isMyFoldersContainerById:function(a){return a===b.NAV_MY_FOLDERS_CONTAINER_ID},isMyFoldersContainerExpanded:function(){return this.isExpanded(b.NAV_MY_FOLDERS_CONTAINER_ID)},isOtherUserFoldersContainerById:function(a){var b=n.default.all.get(a);return b&&b.isRoot()&&b.isShareTake()},isOtherUserFoldersContainer:function(a){return a.isServiceShared()},isParentPrivateFoldersContainerById:function(a){return a===b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID},isParentPrivateFoldersContainer:function(a){return this.isParentPrivateFoldersContainerById(a.get("id"))},isFoldersContainer:function(a){return this.isMyFoldersContainer(a)||this.isOtherUserFoldersContainer(a)||this.isParentPrivateFoldersContainer(a)},getFolderLevel:function(a){if(!this.get("has-virtual-containers")){return a.getChildLevel()}if(this.isMyFoldersContainer(a)||this.isParentPrivateFoldersContainer(a)){return 0}if(a.isShareTake()){return a.getChildLevel()}return a.getChildLevel()+1},getLimitedFolderLevel:function(a){var c=this.getFolderLevel(a);return Math.min(b.FOLDER_MAX_CHILD_LEVEL_UI,c)},isLastOfMyFolders:function(a){return a.get("id")===this.get("lastOfMyFoldersId")},getAvatar:function(a){var b;var c;if(this.isMyFoldersContainer(a)){var d=o.default.user;b=d.getEmail();c=d.getFullName()}else{var d=a.get("owner");b=d.email;c=d.name}if(!b){return null}return l.default({email:b,name:c,size:45})},getTitle:function(a){if(this.isOtherUserFoldersContainer(a)){var b=a.get("owner").email;return b}return a.get("name")},isFolderExpandControlsVisible:function(a){var c=a.getChildLevel();return a.get("children")&&!this.is("touch-nav")&&!this.is("short")&&!this.is("expand-all")&&b.FOLDER_MAX_CHILD_LEVEL_UI>c&&a.getMaxChildLevel()>c},getLastOfMyFoldersId:function(){var a=this.get("models")||[];a=a.filter(function(a){return!j.isParentPrivateFolder(a)});var b=Array.prototype.findIndex.call(a,function(a){return a.isShareTake()});if(b===-1){return a[a.length-1].get("id")}return a[b-1].get("id")},getFirstSubFolderId:function(a){var b=this.get("models")||[];var c=Array.prototype.find.call(b,function(b){return b.get("parent")===a});return c===null||c===void 0?void 0:c.get("id")},getFirstParentControlFolder:function(){var a=this.get("models")||[];var b=Array.prototype.find.call(a,j.isParentPrivateFolder);return b===null||b===void 0?void 0:b.get("id")},isFolderInMyFoldersContainer:function(a){return this.get("has-virtual-containers")&&a.isRoot()&&!a.isShareTake()&&!j.isParentPrivateFolder(a)&&!this.isParentPrivateFoldersContainer(a)}}))});define("feast-tpl!app/feast-tpl!ui-block/sidebar/sidebar.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="open" value="{short && attrs.open}" />\n\t<fn:var name="shortcut" value="{short && !attrs.open}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\t<fn:var name="widget" value="{attrs.widget}"/>\n\t<fn:var name="isSearch" value="{attrs.isSearch}"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod name="short" test="short"/>\n\t<bem:mod name="open" test="open"/>\n\t<bem:mod name="closed" test="!open"/>\n\t<bem:mod name="pony-mode" test="ponyMode"/>\n\t<bem:mod name="widget" test="widget"/>\n\t<bem:mod name="search" test="isSearch"/>\n\n\t\x3c!-- Список папок компактный (шорткаты) --\x3e\n\t<div\n\t\tfn:if="_this.hasShortMenu()"\n\t\tbem:elem="short"\n\t\tqa:id="short"\n\t\tref="short"\n\t>\n\t\t<bem:mod name="fixed"/>\n\n\t\t<div ref="top-menu-short">\n\t\t\t<fn:apply-match name="sidebar-top-menu" args="true, open"/>\n\t\t</div>\n\n\t\t<b:scrollable\n\t\t\tid="scrollShort"\n\t\t\tref="scrollShort"\n\t\t\tscroll-style="{attrs[\'short-scroll-style\']}"\n\t\t\tponymode="{ponyMode}"\n\t\t\tdisable-horizontal-scroll\n\t\t>\n\t\t\t<div ref="content-short">\n\t\t\t\t<fn:apply-match name="sidebar-content" args="true, open"/>\n\t\t\t</div>\n\t\t</b:scrollable>\n\n\t\t<div ref="bottom-menu-short" bem:elem="bottom-menu">\n\t\t\t<bem:mod name="css-vars-fallback" test="attrs[\'css-vars-fallback\']"/>\n\n\t\t\t<fn:apply-match name="sidebar-bottom-menu" args="true"/>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Список полный или раскрытый --\x3e\n\t<fn:if test="_this.hasFullMenu()" animated>\n\t\t<div\n\t\t\tref="full"\n\t\t\tbem:elem="full"\n\t\t\tqa:id="full"\n\t\t>\n\t\t\t<bem:mod name="fixed" test="!open"/>\n\t\t\t<bem:mod name="left" test="attrs[\'open-left\']"/>\n\t\t\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()" />\n\n\t\t\t<div ref="top-menu-full">\n\t\t\t\t<fn:apply-match name="sidebar-top-menu" args="false, open"/>\n\t\t\t</div>\n\n\t\t\t<b:scrollable\n\t\t\t\tid="scrollFull"\n\t\t\t\tref="scrollFull"\n\t\t\t\tponymode="{ponyMode}"\n\t\t\t\tsidebar\n\t\t\t>\n\t\t\t\t<div ref="content-full">\n\t\t\t\t\t<fn:apply-match name="sidebar-content" args="false, open"/>\n\t\t\t\t</div>\n\t\t\t</b:scrollable>\n\n\t\t\t<div ref="bottom-menu-full" bem:elem="bottom-menu">\n\t\t\t\t<bem:mod name="css-vars-fallback" test="attrs[\'css-vars-fallback\']"/>\n\n\t\t\t\t<fn:apply-match name="sidebar-bottom-menu" args="false, open"/>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:apply-match name="sidebar-bottom-widget" args="shortcut" fn:if="widget"/>\n</div>\n',"app/feast-tpl!ui-block/sidebar/sidebar.html")});define("feast-tpl!ui-block/sidebar/sidebar.html",["feast-tpl!app/feast-tpl!ui-block/sidebar/sidebar.html"],function(a){return a});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();define("helpers/debounce-frame",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ConcatFrameDebouncer=exports.FrameDebouncer=void 0;var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.webkitRequestAnimationFrame;var b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.webkitCancelAnimationFrame;var c=function(a){return window.setTimeout(a,0)};var d=a||c;var e=function(){};var f=function(){function c(a){var b=this;this.fn=a;this.pending=false;this._handle=function(){b.pending=false;if(b.destroyed){return}b.fn.apply(b,b.args);b.args=undefined}}c.prototype.saveArgs=function(a){this.args=a};c.prototype.requestDebouncedFrame=function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}this.saveArgs(a);if(this.pending){return}this.pending=true;this.requestID=d(this._handle)};c.prototype.destroy=function(){this.requestDebouncedFrame=e;this.destroyed=true;if(d===a){b(this.requestID)}else{window.clearTimeout(this.requestID)}};return c}();exports.FrameDebouncer=f;var g=function(a){__extends(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}b.prototype.saveArgs=function(a){this.args=this.args?[this.args[0].concat(a)]:a};return b}(f);exports.ConcatFrameDebouncer=g});var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/sidebar/sidebar",["require","exports","@mail/xray","default-values","feast","feast-tpl!./sidebar.html","helpers/debounce-frame","resize-observer-polyfill","service/promo","service/radars/decorator","ui-block/ico/ico","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);function k(a,b){var c,d;var e=parseInt(getComputedStyle(b).getPropertyValue("--vkui--octavius_size_sidebar_padding_top--regular"))||12;var f=b.offsetHeight-e;var g=f;var h=a.header,i=a.content,j=a.footer,k=a.themesWidget;var l=h.el.offsetHeight;g-=l;g-=j.minSize;var m=(d=(c=k===null||k===void 0?void 0:k.el)===null||c===void 0?void 0:c.offsetHeight)!==null&&d!==void 0?d:0;g-=m;var n=j.minSize;var o=i.el.offsetHeight-g;if(o>0){return{header:l,themesWidget:m,footer:n}}else{var p=-o;return{header:l,themesWidget:m,footer:j.minSize+p}}}exports.default=c.default.Block.extend(h.default({explicit:"radar"})({name:"sidebar",template:d.default,blocks:{ico:i.default,scrollable:j.default},events:{"sidebar:toggle":"onToggleOpenState"},defaults:{open:false,"open-left":false,ponymode:false,short:false,isSearch:false,"css-vars-fallback":b.CSS_VARS_FALLBACK},attrChanged:{open:function(a){this[a?"$on":"$off"](this.el.ownerDocument,"mousedown",this.onOutsideClick);a&&this.radar("open")},short:function(a){if(!a){this.close()}}},constructor:function(){c.default.Block.prototype.constructor.apply(this,arguments);this.subscribeToResize=this.subscribeToResize.bind(this);this.onResizeFull=this.onResizeFull.bind(this);this.onResizeShort=this.onResizeShort.bind(this);this.onOutsideClick=this.onOutsideClick.bind(this);var a=new e.ConcatFrameDebouncer(this.onResizeFull);var b=new e.ConcatFrameDebouncer(this.onResizeShort);this.resizeObserver=new f.default(function(b){a.requestDebouncedFrame(b)});this.shortResizeObserver=new f.default(function(a){b.requestDebouncedFrame(a)});this.resizeDebouncer=a;this.shortResizeDebouncer=a},onResizeFull:function(){if(!this.hasFullMenu()){return}this.broadcast("resize-full",k(this.getFullBlocks(),this.refs.full))},onResizeShort:function(b){if(!this.isMounted()){a.default.send("sidebar-resize-after-unmount",{rlog:"octavius-sidebar-update-err",rlog_message:{name:"sidebar-resize-after-unmount",state:{zombie:this.zombie,destroyed:this.destroyed,mounted:this.mounted,unmountCalled:this.unmountCalled},entries:b===null||b===void 0?void 0:b.map(function(a){var b;return(b=a===null||a===void 0?void 0:a.target)===null||b===void 0?void 0:b.className}),err:new Error("empty")}});return}if(!this.hasShortMenu()){return}this.broadcast("resize-short",k(this.getShortBlocks(),this.refs.short))},getShortBlocks:function(){return{header:{el:this.refs["top-menu-short"]},content:{el:this.refs["content-short"]},footer:{el:this.refs["bottom-menu-short"],minSize:this.get("short-footer-min-height")}}},getFullBlocks:function(){return{header:{el:this.refs["top-menu-full"]},content:{el:this.refs["content-full"]},footer:{el:this.refs["bottom-menu-full"],minSize:this.get("footer-min-height")}}},didMount:function(){this.subscribeToResize("mount")},didUpdate:function(){this.subscribeToResize("update")},didUnmount:function(){this.unmountCalled=true;this.resizeDebouncer.destroy();this.shortResizeDebouncer.destroy();this.resizeObserver.disconnect();this.shortResizeObserver.disconnect()},onToggleOpenState:function(){this.invert("open");if(this.get("open")){setTimeout(function(){g.default.update()},1e3)}},onOutsideClick:function(a){var b=this;if(!this.el.contains(a.target)){setTimeout(function(){b.close()},300)}},subscribeToResize:function(b){var c=this;if(!this.isMounted()){a.default.send("sidebar-subscribe-after-unmount",{rlog:"octavius-sidebar-update-err",rlog_message:{name:"sidebar-subscribe-after-unmount",initiator:b,state:{zombie:this.zombie,destroyed:this.destroyed,mounted:this.mounted,unmountCalled:this.unmountCalled},err:new Error("empty")}})}if(this.hasShortMenu()){__spreadArrays([this.refs.short],Object.values(this.getShortBlocks()).map(function(a){return a.el})).forEach(function(a){return c.shortResizeObserver.observe(a)})}if(this.hasFullMenu()){__spreadArrays([this.refs.full],Object.values(this.getFullBlocks()).map(function(a){return a.el})).forEach(function(a){return c.resizeObserver.observe(a)})}},hasShortMenu:function(){return this.is("short")},hasFullMenu:function(){return!this.is("short")||this.is("open")},open:function(){this.set("open",true)},close:function(){this.set("open",false)},getFullScrollable:function(){return this.ids.scrollFull},useNewToolbar:function(){return b.NEW_TOOLBAR}}))});define("ui-block/sidebar-search/sidebar-search",["exports","feast","feast-tpl!./sidebar-search.html","ui-block/badge/badge","ui-block/ico/ico","ui-block/nav-folders/nav-folders","ui-block/react-async/react-async","ui-block/sidebar/sidebar","../../default-values"],function(exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var i=p(a);var j=p(b);var k=p(c);var l=p(d);var m=p(e);var n=p(f);var o=p(g);function p(a){return a&&a.__esModule?a:{default:a}}exports.default=i.default.Block.extend({name:"sidebar-search",template:j.default,blocks:{badge:k.default,ico:l.default,"react-async":n.default,sidebar:o.default,"nav-folders":m.default},defaults:{folders:null,ponymode:false,store:{},short:false,categories:h.SEARCH_CATEGORIES},constructor:function a(){i.default.Block.apply(this,arguments);this.handleSearchPanelFocus=this.handleSearchPanelFocus.bind(this)},handleSearchPanelFocus:function a(){this.broadcast("search-sidebar:focus")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/search-manager",["require","exports","data-source/utils","default-values","feast","helpers/suggest-search","mail/Folder","mobx","pilotjs","service/adv/config","service/radars/index","state-tree/search/search","ui-block/dataset-letters/dataset-letters","ui-block/list-letter-preview-action/list-letter-preview-action","ui-block/octopus/octopus","ui-block/search-panel/search-panel","ui-block/sidebar-search/sidebar-search"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);exports.default=c.default.Mediator.create("search-manager",{defaults:function(){this._lazyReactionSetup=false},components:{router:{class:g.default,events:["beforeroute","routeend"]},"search-panel":{class:n.default,events:["search-panel:focus","search-panel:blur","back"],attrs:{active:function(a){return a.isActive()}}},"sidebar-search":{class:o.default,events:["search-sidebar:focus"]},octopus:{class:m.default,events:["search:set-in-excluded-folders"],attrs:{"show-search-in-excluded-folders":function(a){return a.shouldSuggestExcludedFolders()},"search-in-excluded-folders-url":function(a){return a.getInExcludedFoldersUrl()},"search-has-operands":function(a){return a.hasOperands()}}},"list-letter-search-action":{class:l.default,events:["search:set-in-excluded-folders"]},"dataset-letters":{class:k.default,events:["click:letter"],attrs:{"search-in-excluded-folders":function(a){return a.isInExcludedFolders()},"search-in-excluded-folders-url":function(a){return a.getInExcludedFoldersUrl()},"search-has-operands":function(a){return a.hasOperands()}}}},handleEvent:function(c){var d=c.type;var e=this.get("router");var f=this.components["search-panel"][0];switch(d){case"click:letter":this.sendSearchPositionRadar(c);break;case"searchpanel:focus":this._isFocused=true;break;case"searchsidebar:focus":f.focus();return false;case"searchpanel:blur":this._isFocused=false;break;case"search:setinexcludedfolders":var g=c.details;var i=a.getStore();var j=i&&i.search;if(j){j.setInExcludedFolders(g)}break;case"beforeroute":if(e.route.is("#search")){h.deleteRBParam("exp_id");h.deleteRBParam("search_query")}break;case"routeend":if(e.route.is("#search")){if(b.ADV_SEARCH_EXP_ID){h.setRBParam("exp_id",b.ADV_SEARCH_EXP_ID)}var k=e.request.query.q_query;if(b.ADV_SEARCH_SEND_QUERY&&k){h.setRBParam("search_query",k)}}break;case"back":f.reset();if(e.route.is("#search #search-letter")){e.go("#letters")}break}},getSearch:function(){var b=a.getStore();return b&&b.search},isActive:function(){var a=this.get("router");var c=this.getSearch();var d=!c||c.empty;if(a.route.is("#search")){return true}else if(a.route.is("#search-letter")){return b.SEARCH_PANEL_PORTAL||this._isFocused||this.isLoading()}else{return this._isFocused||!d}},isLoading:function(){var a=this;var b=this.getSearch();if(b&&!this._lazyReactionSetup){this._lazyReactionSetup=true;f.reaction(function(){return b.progress},function(){a.updateAll()})}return b&&b.progress},isInExcludedFolders:function(){var a=this.getSearch();return a&&a.in_excluded_folders},shouldSuggestExcludedFolders:function(){if(b.FORBID_EXCLUDED_FOLDERS_SEARCH){return false}var a=this.getSearch();if(!a){return false}if(this.isInExcludedFolders()){return false}var c=a.currentMailbox,d=a.isMyMailboxSelected;if(d){return true}return e.default.all.toArray().some(function(a){var b;return a.isShareTake()&&((b=a.get("owner"))===null||b===void 0?void 0:b.email)===c.email&&(a.isSpam()||a.isTrash())})},getInExcludedFoldersUrl:function(){var a=this.getSearch();var b=Object.assign({},a.routerQuery);b[j.QueryKeysMap.IN_EXCLUDED_FOLDERS]=1;var c=g.default.queryString.stringify(b);return"?"+c},hasOperands:function(){var a=this.getSearch();return!!(a&&a.hasOperands)},sendSearchPositionRadar:function(a){var c=this.get("router");if(!c.route.is("#search")){return}var e=a.details&&a.details.index||0;var f=Math.floor(Date.now()/1e3);var g=c.model.search,h=g.search_id,j=g.doneRelevantSearch;i.default({chain:["search_letter_click"],value:e});var k=b.RELEVANT_SEARCH;if(k.group){var l=j?[["suc",e]]:void 0;var m=j?j.group:k.group;i.default({chain:["search_position_g_"+m],intervals:l,value:e})}var n=d.getSearchRadarIntervals(c.model.search,e);i.default({chain:["search_position"],intervals:n,dwh:{search_id:h,timestamp:f}})}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/adv-letter/adv-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.advModelLabel=void 0;a=__importDefault(a);exports.advModelLabel="advModel";var b=a.default.extend({className:"models.AdvLetter"});b.createAdvLetter=function c(d,e,f,g,h,i){var j=a.default.createModel(b,"adv::"+d+"_"+e+"_"+g,exports.advModelLabel);j.set("inMetathread",h,true);j.set("metathreadLastToggle",i,true);j.set("position",e);j.set("index",f);return j};b.isAdv=function b(c){return a.default.isDatasetModel(c,exports.advModelLabel)};exports.default=b});define("models/skeleton-letter/skeleton-letter",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="skeletonLetter";var e=b.default.extend({className:"models.SkeletonLetter"});e.createSkeletonLetter=function a(c){var f=b.default.createModel(e,e.constructId(c),d);f.set({index:c},{silent:true});f.meta("_ui-index",c);return f};e.isSkeleton=function a(c){return b.default.isDatasetModel(c,d)};e.constructId=function a(b){return"skeleton::"+b};exports.default=e});define("data-source/source/ui-letters",["exports","data-source/utils/letter-list-virtualization","data-source/utils/paginator","default-values","helpers/parse","helpers/seedable-random","mail/Folder","mediator/search-manager","models/adv-letter/adv-letter","models/bait-letter/bait-letter","models/discounts-block-letter/discounts-block-letter","models/height-compensation-model/height-compensation-model","models/metathread/metathread","models/promo-block-letter/promo-block-letter","models/search-action-letter/search-action-letter","models/skeleton-letter/skeleton-letter","models/spec-project-letter/spec-project-letter","models/spinner-letter/spinner-letter","models/tip-letter/tip-letter","models/welcome-block-letter/welcome-block-letter","service/adv/config","service/adv/index","service/smokescreen"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var w=N(e);var x=N(f);var y=N(g);var z=N(h);var A=N(i);var B=N(j);var C=N(k);var D=N(l);var E=N(m);var F=N(n);var G=N(o);var H=N(p);var I=N(q);var J=N(r);var K=N(s);var L=N(u);var M=N(v);function N(a){return a&&a.__esModule?a:{default:a}}function O(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var P=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var Q=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var R=function a(b){var c=b.filter(function(a){return typeof a==="boolean"});if(c.length>0){return c[c.length-1]}return false};var S=function a(b,e,f,g,h){var i=g?c.ADV_LIST_METATHREAD_CONFIG:c.ADV_LIST_DEFAULT_CONFIG;var j=g?c.ADV_LIST_METATHREAD_SPECIFIC_CONFIG:c.ADV_LIST_FOLDER_CONFIG;if(c.HIDE_TOYS===c.BL_PROP_NAME){return}var k=!(0,d.parseStringToBoolean)(i.mimic)&&M.default.isEnabled();var l=t.slotsConfig.list2pane,m=l===undefined?{}:l,n=t.slotsConfig.list3pane,o=n===undefined?{}:n;var p=!!m.mimicId&&!!o.mimicId;if(k&&!p){return}var q=e.support3pane,r=e.type;var s=q&&r==="3pane";var v=!!u.Adman.placement("list2pane");var w=!!u.Adman.placement("list3pane");var x=(0,d.parseStringToBoolean)(i.enable);var y=j[f]||{"2pane":{},"3pane":{}};var A=s?w:v;var B=(0,d.parseStringToBoolean)(y.enable);var C=s?"3pane":"2pane";var D=Q({},i[C],y[C]);var E=(0,d.parseStringToBoolean)(D.enable);if(!A||!R([x,B,E])){return}var F=D.start,G=D.interval,H=D.minLetters;var I=parseInt(F,10);var J=parseInt(G,10);var K=parseInt(H||F,10);if(b.length<K){return}for(var L=0,N=I;N<b.length;N+=J,L++){var O=z.default.createAdvLetter(f,N,L,C,g,h);b.splice(N,0,O)}};var T=w.default.randomSeed();function U(a,b,c){return!a&&(b===x.default.TRASH||b===x.default.CHILD_TRASH||b===x.default.SPAM)&&c.length}function V(a,b){a.unshift(J.default.createTipLetter(b))}exports.default={match:["#letters","#read-letter","#search","#search-letter"],defaults:[],fetch:function d(e,f){var g=e.route&&e.route.is("#search #search-letter");var h=e.params.folder;return Promise.all([g?f("search"):f("status"),f("metathreads"),f("uiLayout"),f("uiThreadsSettings"),f("discounts")]).then(function(d){var f=P(d,5),i=f[0],j=f[1],k=f[2],l=f[3],m=f[4];var n=i.letters||[];var o=i.suggestLetters;var p=!!(n&&n.length);var q=!!(o&&o.length);var r=i.page===1;var s=typeof i.page==="number";var t=n.slice();var u=new w.default(T);var v=void 0;var z=void 0;var J=void 0;var N=void 0;var Q=void 0;var R=void 0;if(r||!s){if(U(g,h,n)){V(t,h)}var W=q&&!p;var X=W?"suggestHeader":"header";if((p||q)&&g&&y.default.shouldSuggestExcludedFolders()){t.unshift(F.default.createSearchActionLetter({withSuggestHeader:W,type:X}))}}if(!g||c.ADV_SEARCH_SEND_QUERY){S(t,k,h)}var Y=(0,b.calcSkeletonsAtStart)(i);if(!g&&s&&l.paginator){for(N=0;N<Y;N++){J=G.default.createSkeletonLetter((i.offset||0)+Y-N-1);t.unshift(J)}var Z=k.support3pane&&k.type==="3pane";var _=(0,a.getGenericItemHeight)(Z,k.ponyMode)*Y;var aa=(0,b.getMemoizedPageHeight)(i.page-1)||0;var ba=Math.max(aa-_,0);var ca=C.default.createHeightCompensation(ba);if(p){t.unshift(ca)}}var da=void 0;var ea=void 0;var fa=L.default.isAdvVisible("spec-project-letter");for(N=0;N<t.length;N++){J=t[N];if(g){J.meta("_ui-index",N)}var ga=x.default.all.get(h);var ha=ga&&ga.isShareTake();if(!g&&D.default.isMetathread(J)){if(ha){t.splice(N,1);continue}v=j[J.id];z=v&&v.threads;if(!z){continue}R=J.get("lastToggle");z=z.slice();Q=z.length;while(Q--){var ia=z[Q];if(!ia.get("advModel")){ia.setContainingMetathread(J)}}if(!fa){S(z,k,J.get("metathread_data.folder"),true,R)}t.splice.apply(t,[N+1,0].concat(z,[J.getFooterModel()]));N+=z.length+1;continue}if(p&&!g&&M.default.isEnabled()&&u.random()<=.34){t.splice.apply(t,[N+1,0].concat([A.default.createBaitLetter(N)]));N+=1}}if(q&&(r||!s)){if(p){t.push(F.default.createSearchActionLetter({type:"suggestSeparator"}))}t.push.apply(t,O(o))}if(p){t.push(I.default.createSpinnerLetter())}if(h===x.default.INBOX&&p&&!g&&!c.WELCOME_BLOCK_DISABLED){t.unshift(K.default.createWelcomeBlock())}if(m&&p){t.unshift(B.default.createDiscountsBlock())}if(h===x.default.INBOX&&p&&!g){t.unshift(E.default.createPromoBlock())}if(p&&!g){t.unshift(H.default.createSpecProjectLetter(h))}if((0,b.isPaginatorEnabled)(e.router,l)&&!g&&typeof i.lettersTotal==="number"){da=(0,b.calcLastLetterIndex)(i);ea=(0,b.calcSkeletonsAtEnd)(i);for(N=da;N<da+ea;N++){t.push(G.default.createSkeletonLetter(N))}}return t})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/UserEditMetathreads",["require","exports","Action","mail/User","mail/Folder","RPC"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=a.default.extend({className:"mail.UserEditMetathreads",_isMetathreadsError:function(a){return"error"in a},prepare:function(a){if(typeof a!=="object"||!a){return{error:true,message:"invalid_params"}}var d=Object.keys(b.default.METATHREADS_STATES).map(function(a){return b.default.METATHREADS_STATES[a]});var e=Object.keys(a).every(function(b){return c.default.OWN_METATHREADS_IDS.includes(+b)&&d.includes(a[b])});if(!e){return{error:true,message:"invalid_metathread"}}return Object.keys(a).map(function(b){return{folder_id:+b,state:a[b]}})},operation:function(a){if(this._isMetathreadsError(a)){return Promise.reject(a)}return d.default.call(b.default.url("editMetathreadsSettings"),{metathread_visible:a})}});a.default.register("mail.UserEditMetathreads",e);e.version="0.1.0";exports.default=e;return e});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/ui-threads-settings",["require","exports","@mail/flags","@mail-core/dashboard","data-source/actions","data-source/match/match","default-values","helpers/metathreads","mail/actions/UserEditMetathreads","mail/Folder","mail/User","service/notify","service/radars/index"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);function l(){if(a.default.get("priority-messages-newsletters").isExist()){return a.default.get("priority-messages-newsletters").state}if(a.default.get("priority-messages").state===false&&a.default.get("priority-messages").count.show){return false}return e.ACTUAL_LETTERS_DEFAULT_NEWSLETTERS}exports.default={match:d.default(["#attachment","#attachment-editor"]).exclude,defaults:{metathreadsSettings:{}},fetch:function(d,m,n,o){var p=n&&n.type;var q=o&&o.uiThreadsSettings;if(!q){return b.userKeeper.group("app-fetch-ui-thd-stg-no-prev",function(){return Promise.all([m("authUser")]).then(function(b){var c=b[0];return{threads:a.default.get("threads").state,metathreads:c.get("common_purpose_flags.metathreads_on"),toMyself:a.default.get("to-myself").state,paginator:a.default.get("octavius-paginator").state,actualLettersInbox:a.default.get("priority-messages").count.show?a.default.get("priority-messages").state:e.ACTUAL_LETTERS_DEFAULT_INBOX,actualLettersNewsletters:l(),metathreadsSettings:i.default.getMetathreadsSettingsFromVisibility(c.get("metathreads_visible")),discounts:!!a.default.get(e.DISCOUNTS_FLAG_NAME).state}})},{score:"fetch"})}var r=function(a,b){var c={};if(typeof b!=="boolean"){return c}Object.values(h.default.OWN_METATHREADS_IDS).forEach(function(d){if(a.includes(d)){return}c[d]=b?i.default.METATHREADS_STATES.ON:i.default.METATHREADS_STATES.OFF});return c};var s=function(a){if(typeof a!=="boolean"){return}var b=r([h.default.TOMYSELF,h.default.PROMOTIONS],a);return f.metathreadsToggle(a).then(function(){return __assign(__assign({},q),{metathreads:a,metathreadsSettings:b})})};var t=function(a){if(e.HIDE_METATHREADS){return q}var b=q.metathreadsSettings;var c=__assign(__assign({},b),a);var d=f.isMetathreadOnFromState(c[h.default.TOMYSELF]);var i=h.default.OWN_METATHREADS_IDS.some(function(a){return a!==h.default.TOMYSELF&&f.isMetathreadOnFromState(c[a])});return g.default.execute(a).then(function(){return __assign(__assign({},q),{metathreadsSettings:c,toMyself:d,metathreads:i})}).catch(function(a){var b=a.error;var c=b.status,d=b.message;var e=[c,d].filter(function(a){return a}).join("_");k.default(["glng-user-edit-mthrds-err",e]);j.default.error({unique:true});return q})};return b.userKeeper.group("app-fetch-ui-thd-stg",function(){var b;switch(p){case c.TOGGLE_THREADS_SETTING:{var d=a.default.get("threads");var f=!q.threads;return d.save({state:f}).then(function(){return __assign(__assign({},q),{threads:f})})}case c.TOGGLE_METATHREADS_SETTING:{var g=!q.metathreads;return s(g)}case c.CHANGE_METATHREADS_SETTING:{var g=n&&n.state;return s(g)}case c.EDIT_METATHREADS_SETTINGS:{var j=n&&n.settings;return t(j)}case c.TOGGLE_METATHREADS_SETTINGS:{var g=n&&n.state;var j=r([h.default.PROMOTIONS],g);return t(j)}case c.TOGGLE_TO_MYSELF_METATHREAD:{var l=n&&n.state;var m=q.metathreadsSettings;var o=__assign(__assign({},m),(b={},b[h.default.TOMYSELF]=l?i.default.METATHREADS_STATES.ON:i.default.METATHREADS_STATES.OFF,b));return a.default.get("to-myself").save({state:l}).then(function(){return __assign(__assign({},q),{toMyself:l,metathreadsSettings:o})})}case c.TOGGLE_PAGINATOR:{var u=n&&n.state;return a.default.get("octavius-paginator").save({state:u}).then(function(){return __assign(__assign({},q),{paginator:u})})}case c.TOGGLE_ACTUAL_MESSAGES_IN_INBOX:{var v=n&&n.state;var w=a.default.get("priority-messages");return w.save({state:v,hit:!w.count.show}).then(function(){return __assign(__assign({},q),{actualLettersInbox:v})})}case c.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS:{var x=n&&n.state;var w=a.default.get("priority-messages-newsletters");return w.save({state:x}).then(function(){return __assign(__assign({},q),{actualLettersNewsletters:x})})}case c.ENABLE_ACTUAL_MESSAGES:{var y=a.default.get("priority-messages-newsletters").save({state:true});var z=a.default.get("priority-messages");var A=z.save({state:true,hit:!z.count.show});var B=a.default.get("actual-letters-badge").save({state:true,time:true});k.default("settings_ad_actual_letters_hide");return Promise.all([y,A,B]).then(function(){return __assign(__assign({},q),{actualLettersNewsletters:true,actualLettersInbox:true})})}case c.TOGGLE_DISCOUNTS:{var C=n&&n.state;return a.default.get(e.DISCOUNTS_FLAG_NAME).save({state:C}).then(function(){return __assign(__assign({},q),{discounts:C})})}default:return q}},{score:"fetch",appendix:!p?"no-act":"act"})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/CleanmasterUnreadManage",["require","exports","Action","RPC"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=a.default.extend({className:"mail.CleanmasterUnreadManage",_isCleanmasterError:function(a){return"error"in a},prepare:function(a){if(typeof a!=="object"||!a){return{error:true,message:"invalid_params"}}var b=Object.keys(c.Methods).map(function(a){return c.Methods[a]});var d=a.method;if(!b.includes(d)){return{error:true,message:"invalid_method"}}if(d===c.Methods.Unsubscribe){return this._prepareUnsubscribe(a)}return a},operation:function(a){if(this._isCleanmasterError(a)){return Promise.reject(a)}if(a.method===c.Methods.Unread){return this._unread()}return this._unsubscribe(a)},_prepareUnsubscribe:function(a){if(!Array.isArray(a.emails)){return{error:true,message:"invalid_emails"}}return a},_unread:function(){return b.default.get("golang/messages/services/cleanmaster/unread")},_unsubscribe:function(a){return b.default.call("golang/messages/services/cleanmaster/unsubscribe",{emails:a.emails})}});c.Methods={Unsubscribe:"unsubscribe",Unread:"unread"};a.default.register("mail.Cleanmaster",c);c.version="0.1.0";exports.default=c;return c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/unsubscribe",["require","exports","default-values","service/radars/index","service/storage"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.STORAGE_KEY=void 0;b=__importDefault(b);c=__importDefault(c);exports.STORAGE_KEY="unsubscribe-list";var d={_notCountSameUid:{},_ignoreCounter:{},countUnsubscribeView:function(d,e,f,g){var h;var i;if(d===void 0){d={counter:{},list:[]}}if(this._notCountSameUid[g]){return d}var j=(i=d.counter[g])!==null&&i!==void 0?i:0;var k=j+1;this._notCountSameUid[g]=true;var l=__assign(__assign({},d),{counter:__assign(__assign({},d.counter),(h={},h[g]=k,h))});if(k===a.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT){this._ignoreCounter[g]=true;b.default({type:"unsub_sndrs_show_limit",dwh:{sender:g}})}var m=this.getActualSenders(l,e,f);c.default.set(exports.STORAGE_KEY,l);return __assign(__assign({},l),{actualSenders:m})},hideSenders:function(a,b,d,e){var f;var g=(f=a.hidden)!==null&&f!==void 0?f:[];if(e.every(function(a){return g.includes(a)})){return a}var h=__assign(__assign({},a),{hidden:__spreadArrays(g,e)});var i=this.getActualSenders(h,b,d);c.default.set(exports.STORAGE_KEY,h);return __assign(__assign({},h),{actualSenders:i})},_calculateActualSenders:function(b,c,d){var e=this;var f=c.map(function(a){var b,c,e,f;var g=(e=(c=(b=a.get("correspondents"))===null||b===void 0?void 0:b.from)===null||c===void 0?void 0:c[0])===null||e===void 0?void 0:e.email;var h=(f=a.get("flags"))===null||f===void 0?void 0:f.unread;if(h&&d.includes(g)){return{sender:g,id:a.get("id")}}}).filter(function(c){var d,f,g;if(!c){return false}var h=c.sender;var i=(d=b===null||b===void 0?void 0:b.hidden)===null||d===void 0?void 0:d.some(function(a){return a===h});if(!h||i){return false}var j=(g=(f=b===null||b===void 0?void 0:b.counter)===null||f===void 0?void 0:f[h])!==null&&g!==void 0?g:0;return e._ignoreCounter[h]||j<a.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT});return f.filter(function(a,b){return f.findIndex(function(b){return b.sender===a.sender})===b}).slice(0,a.LL_UNSUBSCRIBE_NEWSLETTERS_SENDERS_LIMIT)},getActualSenders:function(a,b,c,d){var e=this;var f;var g=a!==null&&a!==void 0?a:{list:[]};var h=b!==null&&b!==void 0?b:[];var i=c!==null&&c!==void 0?c:{};var j=(f=d!==null&&d!==void 0?d:g.list)!==null&&f!==void 0?f:[];var k=Object.values(i).map(function(a){return a===null||a===void 0?void 0:a.threads}).filter(function(a){return a});var l=[];__spreadArrays([h],k).forEach(function(a){return l.push.apply(l,e._calculateActualSenders(g,a,j))});return l}};exports.default=d});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/unsubscribe-list",["require","exports","data-source/actions","data-source/match/match","default-values","mail/actions/CleanmasterUnreadManage","service/radars/index","service/storage","service/unsubscribe"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);exports.default={match:b.default(["#attachment","#attachment-editor"]).exclude,defaults:{},fetch:function(b,h,i,j){if(!c.LL_UNSUBSCRIBE_NEWSLETTERS){return Promise.resolve({})}var k=j===null||j===void 0?void 0:j.unsubscribeList;var l=k!==null&&k!==void 0?k:f.default.get(g.STORAGE_KEY);switch(i===null||i===void 0?void 0:i.type){case a.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST:{if(!(j===null||j===void 0?void 0:j.status)){return}var m=j.status.letters,n=j.metathreads;return Promise.resolve(g.default.hideSenders(l,m,n,i.senders))}case a.HIDE_UNSUBSCRIBE_SENDER:{if(!(j===null||j===void 0?void 0:j.status)){return}var m=j.status.letters,n=j.metathreads;var o=i.senders;e.default({type:"hide_unsub_sndrs",dwh:{senders:o}});return Promise.resolve(g.default.hideSenders(l,m,n,o))}case a.COUNT_UNSUBSCRIBE_VIEW:{var m=j.status.letters,n=j.metathreads;return Promise.resolve(g.default.countUnsubscribeView(l,m,n,i.sender))}case a.TOGGLE_METATHREAD:case a.TOGGLE_METATHREADS_SETTING:case a.LOAD_MORE_METATHREAD:case a.TOGGLE_THREADS_SETTING:case a.NAVIGATE:case a.UPDATE_ALL:{if(l){return Promise.all([h("status"),h("metathreads")]).then(function(a){var b=a[0],c=a[1];var d=g.default.getActualSenders(l,b.letters,c);return __assign(__assign({},l),{actualSenders:d})})}}}var p=!(l===null||l===void 0?void 0:l.timestamp);var q=Math.floor(Date.now()/1e3);var r=!k||p||q-l.timestamp>c.LL_UNSUBSCRIBE_NEWSLETTERS_INTERVAL;if(!r){return l}return Promise.all([h("status"),h("metathreads")]).then(function(a){var b=a[0],c=a[1];return d.default.execute({method:d.default.Methods.Unread}).then(function(a){return a.result}).then(function(a){var d,h;e.default({type:"clnmstr_unread_ds"});var i=a.body;var j=b.letters;var k=g.default.getActualSenders(l,j,c,i);var m={list:i,counter:(d=l===null||l===void 0?void 0:l.counter)!==null&&d!==void 0?d:{},hidden:(h=l===null||l===void 0?void 0:l.hidden)!==null&&h!==void 0?h:[],timestamp:q};f.default.set(g.STORAGE_KEY,m);return __assign(__assign({},m),{actualSenders:k})}).catch(function(a){var b=a.error;e.default({chain:["clnmstr_unread_ds_err",b.status,b.message]});return{}})})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/vk",["require","exports","@mail/xray","default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getShopName=exports.getVkChatHref=exports.getVkChatId=exports.vkConnectChecker=void 0;a=__importDefault(a);var c={_promise:null,_fetch:function(){return new Promise(function(b){var c=new XMLHttpRequest;c.open("GET","https://vk.com/feed2.php?act=widget",true);c.withCredentials=true;c.onload=function(){a.default.send("vk-connect_request_ok");var d=null;try{d=JSON.parse(c.response)}catch(b){d={};a.default.send("vk-connect_request-parse-error")}if(c.status!==200||!d.friends){a.default.send("vk-connect_unauthorized");return b({authorized:false})}a.default.send("vk-connect_authorized");b({authorized:true})};c.onerror=function(){a.default.send("vk-connect_request_fail");b({authorized:false})};c.send()})},check:function(){if(!this._promise){this._promise=this._fetch()}return this._promise}};exports.vkConnectChecker=c;var d=function(a){if(!b.VK_MESSENGER_CHAT_ID_BY_EMAIL||b.DISABLE_VK_MESSENGER){return null}return b.VK_MESSENGER_CHAT_ID_BY_EMAIL[a.toLowerCase()]};var e=function(a){var b=d(a);if(!b){return null}return b.id};exports.getVkChatId=e;var f=function(a){var b=d(a);if(!b){return null}return b.name};exports.getShopName=f;var g=function(a){if(!a){return null}return""+b.VK_MESSENGER_CHAT_HREF_BASE+a};exports.getVkChatHref=g});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/vkMessenger",["require","exports","data-source/match/match","default-values","feast-mod/correspondents","helpers/vk"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={match:a.default(["#read-letter","#search-letter"]),fetch:function(a,c){var e=this;if(b.DISABLE_VK_MESSENGER){return}var f=[c("letter"),b.VK_MESSENGER_CHECK_VK_AUTH?d.vkConnectChecker.check():Promise.resolve({authorized:true})];return Promise.all(f).then(function(a){var b=a[0],c=a[1].authorized;if(!c||!b){return}return e.processThreads([b])})},processThreads:function(a){if(!a){return}a.forEach(function(a){var b=c.getCorrespondentsFromMessage(a,"from",".0.email");var e=a.get("transaction_metadata");if(!b||!e||e.get("vk_chat_href")!==undefined){return}var f=d.getVkChatId(b);var g=d.getShopName(b);if(!f){return}e.set({vk_chat_id:f,vk_chat_href:d.getVkChatHref(f),shop_name:g})})}}});define("data-source/index",["exports","@mail-core/logger","Action","data-source/actions","data-source/data-source","data-source/discounts/index","data-source/server-error","data-source/utils/logger","default-values","Emitter","helpers/delete-emoji-in-string","mail/Folder","mail/Message","mail/Thread","Model","pilotjs","service/mailbox/loader","service/notify","service/page-lifecycle","service/radars/index","./source/aliases","./source/attachment","./source/attachment-temporary","./source/authUser","./source/bills-count","./source/collectors","./source/folder","./source/folders","./source/hidden-payment-dies","./source/jssdk-action","./source/letter","./source/letter-neighbours","./source/letters","./source/message","./source/metathreads","./source/pushManager","./source/request","./source/route","./source/router","./source/search","./source/setup","./source/status","./source/suggest-search","./source/swBox","./source/ui-layout","./source/ui-letters","./source/ui-threads-settings","./source/unsubscribe-list","./source/vkMessenger","./utils"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var X=Na(b);var Y=Na(d);var Z=Na(e);var _=Na(f);var aa=Na(i);var ba=Na(k);var ca=Na(l);var da=Na(m);var ea=Na(n);var fa=Na(o);var ga=Na(p);var ha=Na(q);var ia=Na(r);var ja=Na(s);var ka=Na(t);var la=Na(u);var ma=Na(v);var na=Na(w);var oa=Na(x);var pa=Na(y);var qa=Na(z);var ra=Na(A);var sa=Na(B);var ta=Na(C);var ua=Na(D);var va=Na(E);var wa=Na(F);var xa=Na(G);var ya=Na(H);var za=Na(I);var Aa=Na(J);var Ba=Na(K);var Ca=Na(L);var Da=Na(M);var Ea=Na(N);var Fa=Na(O);var Ga=Na(P);var Ha=Na(Q);var Ia=Na(R);var Ja=Na(S);var Ka=Na(T);var La=Na(U);var Ma=Na(V);function Na(a){return a&&a.__esModule?a:{default:a}}var Oa=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function Pa(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var Qa=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function Ra(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}var Sa=function a(b,c,d){if(b===null)b=Function.prototype;var e=Object.getOwnPropertyDescriptor(b,c);if(e===undefined){var f=Object.getPrototypeOf(b);if(f===null){return undefined}else{return a(f,c,d)}}else if("value"in e){return e.value}else{var g=e.get;if(g===undefined){return undefined}return g.call(d)}};function Ta(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var Ua=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var Va={request:Aa.default,router:Ca.default,route:Ba.default,setup:Ea.default,authUser:na.default,pushManager:za.default,swBox:Ha.default,folder:qa.default,folders:ra.default,uiLayout:Ia.default,uiThreadsSettings:Ka.default,letter:ua.default,letters:wa.default,metathreads:ya.default,uiLetters:Ja.default,discounts:Z.default,status:Fa.default,search:Da.default,suggestSearch:Ga.default,message:xa.default,attachment:la.default,attachmentTemporary:ma.default,jssdkAction:ta.default,letterNeighbours:va.default,collectors:pa.default,aliases:ka.default,hiddenPaymentDies:sa.default,billsCount:oa.default,unsubscribeList:La.default,vkMessenger:Ma.default};var Wa=da.default.prototype.valueValidator;da.default.prototype.valueValidator=function(a,b,c,d){if(b==="subject"&&d.get("flags.newsletter")&&(0,j.hasEmoji)(a)){d.set("hide_emoji_in_subject",true);if(h.HIDE_EMOJI_IN_SUBJECT){return Wa.call(this,(0,j.deleteEmoji)(a),b,c,d)}}if(b==="snippet"&&d.get("flags.newsletter")&&(0,j.hasEmoji)(a)){d.set("hide_emoji_in_snippet",true);if(h.HIDE_EMOJI_IN_SNIPPET){return Wa.call(this,(0,j.deleteEmoji)(a),b,c,d)}}if(b==="correspondents"&&d.get("flags.newsletter")&&a.from&&a.from[0]&&(0,j.hasEmoji)(a.from[0].name)){d.set("hide_emoji_in_correspondent",true);if(h.HIDE_EMOJI_IN_CORRESPONDENT){a.from[0].name=(0,j.deleteEmoji)(a.from[0].name);return Wa.call(this,a,b,c,d)}}if(b==="metathread_data"&&h.HIDE_EMOJI_IN_CORRESPONDENT){var e=a;e.last_senders=e.last_senders.map(function(a){if((0,j.hasEmoji)(a.name)){return Ua({},a,{name:(0,j.deleteEmoji)(a.name)||i18n("<Не указано>")})}return a});return Wa.call(this,e,b,c,d)}return Wa.call(this,a,b,c,d)};var Xa=Object.keys(Va).map(function(a){return Va[a].reaction&&[a,Va[a].reaction]}).filter(function(a){return a});var Ya=/^(not_exists|invalid)$/;var Za=void 0;var $a=void 0;var _a=new g.DataSourceLogger;var ab=null;var bb=function a(){return ab.fetch()};var cb=false;var db=void 0;var eb=new Promise(function(a){db=a});function fb(){if(cb){return}cb=true;db()}var gb=function(a){Ta(b,a);function b(){Pa(this,b);var a=Ra(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));aa.default.apply(a);a.updateAllPid=null;a.updateAll=a.updateAll.bind(a);a.scheduleUpdateAll=a.scheduleUpdateAll.bind(a);return a}Qa(b,[{key:"getData",value:function a(){var b=Ua({},Za);b.model=b;return b}},{key:"loadPromise",value:function a(){return eb}},{key:"getLoader",value:function a(){return ab}},{key:"updateAll",value:function a(){if(X.default.active){if(h.IS_DEBUG){console.warn("[data-source] Отменён вызов updateAll, поскольку выполняется "+X.default.active+" действий.")}return Promise.resolve(Za)}if(this.updateAllPid){window.clearTimeout(this.updateAllPid);this.updateAllPid=null}return this.dispatch({type:c.UPDATE_ALL,priority:fa.default.Loader.PRIORITY_LOW})}},{key:"scheduleUpdateAll",value:function a(){var b=this;if(this.updateAllPid){window.clearTimeout(this.updateAllPid)}this.updateAllPid=window.setTimeout(function(){b.updateAllPid=null;b.updateAll()},h.STATUS_DEBOUNCE_TIMEOUT);if(h.IS_DEBUG){console.warn("Запланирован вызов updateAll.")}}},{key:"dispatch",value:function a(c){Sa(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"dispatch",this).call(this,c);return ab.dispatch(c)}}]);return b}(Y.default);var hb=new gb;if(h.LOG_DATASOURCE_PROBLEMS){hb.on("beforeaction",function(a){try{_a.addEntry(a)}catch(a){}});eb.then(function(){_a.stopLogging()})}ab=new fa.default.Loader(Va,{persist:true,processing:function a(b,c,d){fb();Xa.forEach(function(a){var c=Oa(a,2),e=c[0],f=c[1];d=f(b,d,{type:"FETCHED"},{fetch:bb,previousData:Za[e]})});Za=d;Za.store=(0,W.getStore)();if(h.IS_DEBUG){console.warn("[data-source] "+c.type+(" "+(c.uid||"")),c,d)}hb.notifyNextData(b,c,d);return d},processingModelError:function b(d,e,f,g,i){if(h.IS_DEBUG){console.error("Ошибка загрузки модели:",d,e)}if((0,p.isJSSDKCompliantObject)(e)){var j=e.get("status");if(j===500&&Za===$a){(0,ja.default)(["processing","error","server"]);window.setTimeout(function(){return(0,_.default)()},50);throw e}}if(i&&i.type===c.EXECUTE_JSSDK_ACTION){return null}(0,ja.default)(["processing","error",d]);if(!e||!e.get||!e.get("status")){ha.default.error({unique:true});if(h.IS_DEBUG){console.error(e)}(0,a.coreLoggerDispatchError)(e?e:new Error("Unknown datasource error in: "+d),{modelName:d});return Promise.reject("some_network_error")}switch(d){case"attachmentTemporary":{return[]}case"folders":{ha.default.error({unique:true});return ba.default.all}case"status":case"letters":{if(Ya.test(e.get("body.folder.error"))){if(i&&i.type===c.NAVIGATE){f.redirectTo(f.router.getUrl("#letters",{}),true)}else{f.router.nav(f.router.getUrl("#letters",{}))}var k=(0,O.emptyStatusFromRequest)(f);if(d==="letters"){return k.letters}return k}ha.default.error({unique:true});return[]}case"letter":{if(Ya.test(e.get("body.id.error"))){return new da.default({NoMsg:1})}var l=f.params&&f.params.letter;ha.default.error({unique:true});return da.default.all.get(l)||new da.default({NoMsg:1})}case"message":{if(Ya.test(e.get("body.id.error"))){return new ca.default({NoMsg:1})}ha.default.error({unique:true});return new ca.default({NoMsg:1})}case"search":{return Ua({},(Za||{}).search,{letters:[]})}case"metathreads":{return[]}}(0,ja.default)(["processing","error","unhandled"]);return new ea.default}});Za=ab.defaults();$a=Za;Za.store=(0,W.getStore)();ga.default.on("websocket:reload",hb.scheduleUpdateAll);ga.default.on("any:reload",hb.scheduleUpdateAll);X.default.on("complete",hb.scheduleUpdateAll);ia.default.on("pagelifecycle:reload",hb.scheduleUpdateAll);ab.setDebug(h.IS_DEBUG);exports.default=hb});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/jssdk-config/setupMailboxLimits",["require","exports","default-values","mail/Attachment","service/auth"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.kilabytesToBytes=void 0;b=__importDefault(b);c=__importDefault(c);function d(a){return a*1024}exports.kilabytesToBytes=d;var e=null;function f(c){b.default.MAX_AS_LINK_SIZE=a.MAX_CLOUD_STOCK_SIZE_LIMIT;var e=c.get("common_purpose_flags.enabled_mbox_quotas");var f=c.get("mbox_quotas");if(a.MAX_ATTACHES_SIZE_LIMIT!==null&&!e){b.default.MAX_SIZE=a.MAX_ATTACHES_SIZE_LIMIT}if(e&&f){b.default.MAX_SIZE=d(f.attach);b.default.MAX_AS_LINK_SIZE=d(f.link_attach)}}var g=function(a,b){return f(b)};function h(){var a=c.default.user;f(a);e===null||e===void 0?void 0:e.off("change",g);a.on("change",g);e=a}function i(){c.default.on("login",h)}exports.default=i});define("helpers/get-attachments-more-text",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAttachmentsMoreText=void 0;var a=function(a){return" "+i18n.plural(a,[i18n("и ещё {count} файлов",{count:a}),i18n("и ещё {count} файл",{count:a}),i18n("и ещё {count} файла",{count:a})])};exports.getAttachmentsMoreText=a});define("helpers/get-fwd-message",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFwdMessage=void 0;var a=function(a,b){var c=b-1;return c>0?i18n.plural(c,[i18n("Fwd: {forwardName} (+{count} писем)",{forwardName:a,count:c}),i18n("Fwd: {forwardName} (+{count} письмо)",{forwardName:a,count:c}),i18n("Fwd: {forwardName} (+{count} письма)",{forwardName:a,count:c})]):i18n("Fwd: {forwardName}",{forwardName:a})};exports.getFwdMessage=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/create-message-form-data",["require","exports","default-values","mail/MessageFormData","service/auth","service/jssdk-config/setupMailboxLimits","./get-attachments-more-text","./get-fwd-message"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createMessageFormData=exports.getMessageFormDataOptions=void 0;b=__importDefault(b);c=__importDefault(c);var g=function(){var b={helpers:{getAttachmentsMoreText:e.getAttachmentsMoreText,getFwdMessage:f.getFwdMessage},params:{ATTACHMENTS_RESTORE:a.RESTORE_EXPIRED_ATTACHMENTS,ATTACHMENTS_EXPIRATION_TIME:a.RESTORE_EXPIRED_ATTACHMENTS?a.RESTORE_EXPIRED_ATTACHMENTS_TIME:null}};var g=c.default.user;var h=g.get("common_purpose_flags.enabled_mbox_quotas");var i=g.get("mbox_quotas");if(a.MAX_ATTACHES_SIZE_LIMIT!==null&&!h){b.params.MAX_SPACE_LEFT=a.MAX_ATTACHES_SIZE_LIMIT}if(h&&i){b.params.MAX_SPACE_LEFT=d.kilabytesToBytes(i.attach)}return b};exports.getMessageFormDataOptions=g;var h=function(a){var c=exports.getMessageFormDataOptions(),d=c.params,e=c.helpers;return new b.default(__assign(__assign({},d),a),e)};exports.createMessageFormData=h});define("helpers/signature",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getHTMLSignature=e;exports.cleanHTMLSignature=f;exports.getSignatures=g;var a=exports.NEW_LINE="<div><br/></div>";var b=exports.replaceBR=function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return b.replace(/<br>/g,c)};var c=exports.trimBRNL=function c(d){return d.replace(/^(<br>)+|(<br>)+$/g,function(c){return b(c,a)})};var d=exports.trimBR=function a(c){return c.replace(/^(<br>)+|(<br>)+$/g,function(a){return b(a)})};function e(a){var b=a.get("signs").filter(function(a){return a.active})[0]||{};var c=b.sign_html||"";c='<div data-signature-widget="container" data-signature-id="current">'+'<div data-signature-widget="content">'+c+"</div></div>";return c}function f(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return a.replace('data-signature-id="current"',"")}function g(a){return a.get("signs").map(function(a){a.sign_html=c(a.sign_html||"");return a})}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};define("mediator/layout-manager/utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.snapToMinSize=exports.limitWidths2pane=exports.limitWidths3pane=exports.transformSizes=exports.limitWidths=exports.clamp=exports.defaultMaxSizes=exports.defaultMinSizes=exports.pick=void 0;function a(a,b){return b.reduce(function(b,c){b[c]=a[c];return b},{})}exports.pick=a;var b=15;var c=["left","sidebar","content","right"];var d=["left","main","right"];exports.defaultMinSizes={left:b,main:150,sidebar:70,content:150,right:60};var e=a(exports.defaultMinSizes,c);var f=a(exports.defaultMinSizes,d);exports.defaultMaxSizes={left:416/4,sidebar:Infinity,content:Infinity,main:1632/4,right:60};var g=a(exports.defaultMaxSizes,c);var h=a(exports.defaultMaxSizes,d);function i(a){var b=function(a,b){return a+b};return Object.values(a).reduce(b)}function j(a,b){return Object.keys(a).reduce(function(c,d){c[d]=b(d,a[d]);return c},{})}function k(a,b,c){if(b<a){return a}if(b>c){return c}return b}exports.clamp=k;function l(a,b,c){var d=c.minSizes,e=c.maxSizes,f=c.priorityColumns;var g=j(a,function(a,b){if(!b){return d[a]}return k(d[a],b,e[a])});var h=__assign(__assign({},d),g);var l=i(h);if(l<=b){return h}var m=i(d);if(m>b){console.error("minSizes provided are not suitable for current width! "+JSON.stringify({minSizes:d,availableWidth:b}))}var n=__assign({},d);var o=b-m;var p=["right","content","main","sidebar","left"];var q=f||Object.keys(a);var r=q.concat(p.filter(function(b){return!a.hasOwnProperty(b)}));r.forEach(function(b){if(o<=0){return}var c=k(d[b],a[b],Math.min(exports.defaultMaxSizes[b],d[b]+o));n[b]=c;o-=c-d[b]});return n}exports.limitWidths=l;function m(a,b,c){var d={left:b.left(a.left)};var e=c==="3pane"?"content":"main";d[e]=a[e]+(a.left-d.left);return __assign(__assign({},a),d)}exports.transformSizes=m;function n(b,d,f){if(f===void 0){f={}}var h=f.minSizes,i=h===void 0?e:h,j=f.maxSizes,k=j===void 0?g:j,m=__rest(f,["minSizes","maxSizes"]);return l(a(b,["left","sidebar"]),d,__assign(__assign({},m),{minSizes:a(i,c),maxSizes:a(k,c)}))}exports.limitWidths3pane=n;function o(b,c,e){var g=e===void 0?{}:e,i=g.minSizes,j=i===void 0?f:i,k=g.maxSizes,m=k===void 0?h:k;return l(a(b,["left"]),c,{minSizes:a(j,d),maxSizes:a(m,d)})}exports.limitWidths2pane=o;function p(a,b,c){if(a<=b){return c}return a}exports.snapToMinSize=p});(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("mqmatch",["exports"],b):(a=a||self,b(a.mqMatch={}))})(this,function(exports){"use strict";var a=function(){function a(){var a=this;this._queries={};this._handlers=[];this._handleMediaQueryChange=function(){var b=a.getCurrentMatches();var c=b.join(",");if(a._lastFiredSnapshot!==undefined&&a._lastFiredSnapshot===c){return}a._lastFiredSnapshot=c;for(var d=0,e=a._handlers;d<e.length;d++){var f=e[d];f(b)}}}a.prototype.getCurrentMatches=function(){var a=this;return Object.keys(this._queries).filter(function(b){return a._queries[b].query.matches}).sort()};a.prototype.getCurrentSnapshot=function(){var a=this;return Object.keys(this._queries).map(function(b){return{key:b,raw:a._queries[b].value,parsed:a._queries[b].query.media,matches:a._queries[b].query.matches}})};a.prototype.on=function(a,b){if(a!=="change"){return}if(this._handlers.indexOf(b)===-1){this._handlers.push(b)}};a.prototype.off=function(a,b){if(a!=="change"){return}var c=this._handlers.indexOf(b);if(c!==-1){this._handlers.splice(c,1)}};a.prototype.register=function(a,b){if(b===undefined){b=a}if(this._queries[a]){return}var c=matchMedia(b);if(typeof c.addEventListener==="function"){c.addEventListener("change",this._handleMediaQueryChange)}else{c.addListener(this._handleMediaQueryChange)}this._queries[a]={value:b,query:c};if(c.matches){this._handleMediaQueryChange()}};a.prototype.unregister=function(a){if(!this._queries[a]){return}var b=this._queries[a].query;if(typeof b.removeEventListener==="function"){b.removeEventListener("change",this._handleMediaQueryChange)}else{b.removeListener(this._handleMediaQueryChange)}delete this._queries[a];if(b.matches){this._handleMediaQueryChange()}};a.prototype.destroy=function(){var a=this;this._handlers.length=0;Object.keys(this._queries).forEach(function(b){return a.unregister(b)})};return a}();function b(){return new a}exports.createMediaQueryMatch=b;Object.defineProperty(exports,"__esModule",{value:true})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/vkMessengerLoader",["require","exports","data-source/actions","default-values","helpers/data-source-dispatch","logger","mediator/layout-manager/utils","service/getModule","service/storage","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";var i;Object.defineProperty(exports,"__esModule",{value:true});exports.vkMessengerLoader=exports.logger=void 0;c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);exports.logger=d.default.getScope("vk-messenger-loader");var j=null;var k=((i=h.default===null||h.default===void 0?void 0:h.default.getSelectedModel())===null||i===void 0?void 0:i.isDarkMode())||false;var l=e.defaultMinSizes.right*4;exports.vkMessengerLoader={isLoaded:function(){return!!j},open:function(a){return f.default("vk-messenger").then(function(b){exports.logger.add("open",a);j=b.vkMessenger;return j.open(__assign({darkMode:k,offset:l,onClose:exports.vkMessengerLoader.onClose},a))})},setThemeMode:function(a){exports.logger.add("setThemeMode, darkMode:",a);k=a;if(j){j.setThemeMode(a)}},setOffset:function(a){exports.logger.add("setOffset, offset:",a);l=a;if(j){j.setOffset(a)}},restoreOnReload:function(){exports.logger.add("try restoreOnReload");if(b.VK_MESSENGER_RESTORE_ON_REFRESH_DISABLED){exports.logger.add("restoreOnReload: feature disabled");return}var a=g.default.get(b.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY);if(!a){exports.logger.add("restoreOnReload: no active chat id",a);return}exports.logger.add("restoreOnReload: open chat for:",a);exports.vkMessengerLoader.open({chatId:a})},isOpen:function(){return exports.vkMessengerLoader.isLoaded()&&j.isOpen()},onClose:function(){c.default({type:a.UPDATE_ALL})}}});define("feast-tpl!app/feast-tpl!ui-block/ad-feedback/ad-feedback.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:choose>\n\t\t<fn:when test="attrs[\'step\'] === 2">\n\t\t\t<b:react-async\n\t\t\t\tcomponent="AdFeedback2step"\n\t\t\t\tsmall="{attrs[\'right-column\'] <= 160}"\n\t\t\t\tindented="{attrs[\'indented\']}"\n\t\t\t\tonNotInterestingClick="{_this.onNotInterestingClick}"\n\t\t\t\tonAlreadyPurchasedClick="{_this.onAlreadyPurchasedClick}"\n\t\t\t\tonOtherClick="{_this.onOtherClick}"\n\t\t\t\tonCancelClick="{_this.onCancelClick}"\n\t\t\t/>\n\t\t</fn:when>\n\t\t<fn:otherwise>\n\t\t\t<b:react-async\n\t\t\t\tcomponent="AdFeedback"\n\t\t\t\tisFirstVersion="{_this.isFirstVersion()}"\n\t\t\t\tdisabled="{attrs[\'disabled\']}"\n\t\t\t\tsmall="{attrs[\'right-column\'] <= 160}"\n\t\t\t\tindented="{attrs[\'indented\']}"\n\t\t\t\ttitle="{_this.getTextData().title}"\n\t\t\t\tnegativeButtonText="{_this.getTextData().negativeButtonText}"\n\t\t\t\tpositiveButtonText="{_this.getTextData().positiveButtonText}"\n\t\t\t\tunknownButtonText="{_this.getTextData().unknownButtonText}"\n\t\t\t\tonPositiveClick="{_this.onActionPositiveClick}"\n\t\t\t\tonNegativeClick="{_this.onActionNegativeClick}"\n\t\t\t\tonUnknownClick="{_this.onActionUnknownClick}"\n\t\t\t/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</div>\n',"app/feast-tpl!ui-block/ad-feedback/ad-feedback.html")});define("feast-tpl!ui-block/ad-feedback/ad-feedback.html",["feast-tpl!app/feast-tpl!ui-block/ad-feedback/ad-feedback.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/ad-feedback/ad-feedback",["require","exports","@mail/xray","default-values","feast","feast-tpl!./ad-feedback.html","service/adv/index","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=c.default.Block.extend({name:"ad-feedback",template:d.default,blocks:{"react-async":f.default},defaults:{disabled:true,step:1},immutable:true,storedDwh:null,constructor:function(){c.default.Block.apply(this,arguments);this.onActionPositiveClick=this.onActionPositiveClick.bind(this);this.onActionNegativeClick=this.onActionNegativeClick.bind(this);this.onActionUnknownClick=this.onActionUnknownClick.bind(this);this.on1StepClick=this.on1StepClick.bind(this);this.onNotInterestingClick=this.onNotInterestingClick.bind(this);this.onAlreadyPurchasedClick=this.onAlreadyPurchasedClick.bind(this);this.onOtherClick=this.onOtherClick.bind(this);this.onCancelClick=this.onCancelClick.bind(this)},didMount:function(){var b=this;a.default.send("ad-feedback-show",{dwh:{state:"ad-feedback-show"}});e.default.on("sidebar:visible",function(){return b.handleSidebarAdVisible()})},destroyElement:function(){e.default.setFeedbackUnactive();this.el.parentNode.removeChild(this.el)},handleSidebarAdVisible:function(){this.set("disabled",false)},sendFeedback:function(b,c){var d={dwh:__assign({state:b},c)};a.default.send(b,d)},onActionPositiveClick:function(){var a=e.default.dwhData;this.sendFeedback("ad-feedback-positive",a);this.destroyElement()},onActionNegativeClick:function(){var a=e.default.dwhData;this.sendFeedback("ad-feedback-negative",a);this.on1StepClick(a)},onActionUnknownClick:function(){var a=e.default.dwhData;this.sendFeedback("ad-feedback-unknown",a);this.destroyElement()},getTextData:function(){var a=b.ADVERT_FEEDBACK_TEXTS.title,c=b.ADVERT_FEEDBACK_TEXTS.positiveButtonText,d=b.ADVERT_FEEDBACK_TEXTS.negativeButtonText,e=b.ADVERT_FEEDBACK_TEXTS.unknownButtonText;return{title:a||i18n("Вам интересны похожие предложения?"),positiveButtonText:c||i18n("Интересны"),negativeButtonText:d||i18n("Не моё"),unknownButtonText:e}},on1StepClick:function(a){var c=b.ADVERT_FEEDBACK_CONFIG2.step2enable;if(c){this.set("step",2);e.default.setFeedback2Step();this.storedDwh=a;this.sendFeedback("ad-feedback-2-show",a)}else{this.destroyElement()}},onNotInterestingClick:function(){this.sendFeedback("ad-feedback-2-not-intr",this.storedDwh);this.destroyElement()},onAlreadyPurchasedClick:function(){this.sendFeedback("ad-feedback-2-alrd-prchsd",this.storedDwh);this.destroyElement()},onOtherClick:function(){this.sendFeedback("ad-feedback-2-other",this.storedDwh);this.destroyElement()},onCancelClick:function(){this.sendFeedback("ad-feedback-2-cancel",this.storedDwh);this.destroyElement()}})});define("feast-tpl!app/feast-tpl!ui-block/application-mail/application-mail.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- FMAIL-17519 Новый тулбар для кросспроектной навигации --\x3e\n\t<fn:var name="useNewToolbar" value="{_this.useNewToolbar()}" />\n\t<bem:mod name="pony-mode" test="attrs.ponymode"/>\n\n\t<div bem:elem="overlay">\n\t\t<div bem:elem="wrap">\n\n\t\t\t\x3c!-- Флаг, что письмо не найдено --\x3e\n\t\t\t<fn:var name="letterNotFound" value="{attrs.letter && attrs.letter.isNew() && attrs.letter.is(\'NoMsg\')}" />\n\t\t\t\x3c!-- То сути означает, включен ли новый список писем --\x3e\n\t\t\t<fn:var name="isThreadRounded" value="{_this.isThreadRounded()}" />\n\t\t\t\x3c!-- Отдельный сайдбар и хедер для мобильного вебвью FMAIL-14049 --\x3e\n\t\t\t<fn:var name="webviewMobileMode" value="{attrs.mobile && (attrs[\'is-webview\'] || attrs[\'is-octavius-mobile\']) }" />\n\n\t\t\t\x3c!-- DON\'T REMOVE: <b:layer-window /> --\x3e\n\t\t\t<fn:if test="webviewMobileMode">\n\t\t\t\t<b:webview-mobile-header\n\t\t\t\t\t\tuse:mediator="letters-selection letters-actions layout-manager compose-manager search-manager pony-mode translator-manager filter-manager user-info themes-manager mobile-sidebar-manager"\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t/>\n\t\t\t\t<b:mobile-sidebar\n\t\t\t\t\t\tuse:mediator="settings-manager mobile-sidebar-manager"\n\t\t\t\t\t\tfolder-active="{attrs.route.is(\'#search #search-letter\') ? undefined : attrs.model.folder.id}"\n\t\t\t\t\t\tmodels="{attrs.model.folders}"\n\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="!webviewMobileMode">\n\t\t\t\t\x3c!-- Синий тулбар --\x3e\n\t\t\t\t<b:portal-menu\n\t\t\t\t\t\tfn:if="!useNewToolbar"\n\t\t\t\t\t\tuse:mediator="letters-selection letters-actions layout-manager compose-manager search-manager pony-mode translator-manager filter-manager user-info themes-manager"\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tstore="{attrs.store}"\n\n\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\tmodels="{attrs.model.letters}"\n\t\t\t\t\t\tletterNeighbours="{attrs.model.letterNeighbours}"\n\n\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\tshowBackToParentFolder="{attrs.showBackToParentFolder}"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- Только поиск от ex. cиниго тулбара --\x3e\n\t\t\t\t<b:react-async\n\t\t\t\t\tfn:if="useNewToolbar && _this.useReactSearchPanel()"\n\t\t\t\t\tcustomNode="{_this.usePortalSearchPanel() ? __PH.getSearchPlaceholder() : null}"\n\t\t\t\t\tcomponent="SearchPanel"\n\t\t\t\t\tuseMediators="{[\'search-manager\',\'layout-manager\',\'themes-manager\',\'letters-selection\',\'pony-mode\']}"\n\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\tremit:click="search"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<div bem:elem="layout" bem:mod="main">\n\t\t\t\t<b:layout\n\t\t\t\t\t\tvertical-fit\n\t\t\t\t\t\tresizable="{attrs[\'user-resize\']}"\n\t\t\t\t\t\tsidebar-resizable="{attrs[\'user-resize-3pane\']}"\n\t\t\t\t\t\tbordered="{_this.showLayoutBorders()}"\n\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\tuse:mediator="layout-manager letters-selection thread-scroller search-manager todo-manager"\n\t\t\t\t\t\tid="main"\n\t\t\t\t\t\tgroup="main"\n\t\t\t\t\t\tqa:id="main"\n\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\t\tponymode="{attrs.uiLayout.ponyMode}"\n\t\t\t\t\t\tisDragIconShown="{_this.isDragIconShown()}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="left-column" args="layout">\n\t\t\t\t\t\t<fn:var name="isSearch" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\t\t\t\t\t\t\x3c!-- Левая колонка --\x3e\n\t\t\t\t\t\t<fn:if test="attrs.route.is(\'#letters #read-letter #search #search-letter\')">\n\t\t\t\t\t\t\t<b:sidebar-folders\n\t\t\t\t\t\t\t\t\tis-search="{isSearch}"\n\t\t\t\t\t\t\t\t\tuse:mediator="themes-manager pony-mode compose-manager layout-manager user-info"\n\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\tfolder-active="{attrs.route.is(\'#search #search-letter\') ? undefined : attrs.model.folder.id}"\n\t\t\t\t\t\t\t\t\tmodels="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\t\t\t\t\tbillsCount="{attrs.model.billsCount}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="main-frame-sidebar" args="layout">\n\t\t\t\t\t\t<fn:var name="touch" value="{layout.isLessThen(\'xs\')}"/>\n\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\' || touch}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<fn:var name="isSearch" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tfn:if="useNewToolbar"\n\n\t\t\t\t\t\t\tclass-name="only-new-toolbar new-menu"\n\n\t\t\t\t\t\t\thasLetters="{attrs.uiLetters.length && !letterNotFound}"\n\n\t\t\t\t\t\t\tcomponent="ListLetterHeaderActions"\n\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\tstore="{attrs.store}"\n\n\t\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\tmodels="{attrs.model.letters}"\n\t\t\t\t\t\t\tletterNeighbours="{attrs.model.letterNeighbours}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Список писем --\x3e\n\t\t\t\t\t\t<b:letter-list\n\t\t\t\t\t\t\t\tqa:id="letter-list-{isSearch ? \'search\' : attrs.model.folder.id}"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\tmetathreads="{attrs.metathreads}"\n\t\t\t\t\t\t\t\tmodels="{attrs.uiLetters}"\n\t\t\t\t\t\t\t\tstatus="{attrs.status}"\n\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\tlayout="{layout}"\n\t\t\t\t\t\t\t\thidden-payment-dies="{attrs.hiddenPaymentDies}"\n\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\t\t\tunsubscribeList="{attrs.unsubscribeList}"\n\t\t\t\t\t\t\t\tshowBackToParentFolder="{attrs.showBackToParentFolder}"\n\t\t\t\t\t\t\t\tuse:mediator="letters-loader letters-navigation pony-mode"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<b:renovator\n\t\t\t\t\t\t\tuse:mediator="routes-manager layout-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="main-frame-content" args="layout">\n\t\t\t\t\t\t<fn:var name="touch" value="{layout.isLessThen(\'xs\')}"/>\n\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\' || touch}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Письма выбраны в 3pane --\x3e\n\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\tname="previewSelectedLetters"\n\t\t\t\t\t\t\t\tvalue="{!letterNotFound && _this.checkShowLetterPreview3Pane(layout.selectMode)}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div bem:elem="letter-content" qa:id="letter-content">\n\t\t\t\t\t\t\t<bem:mod name="3pane-preview" test="previewSelectedLetters"/>\n\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\tfn:if="useNewToolbar"\n\n\t\t\t\t\t\t\t\tclass-name="only-new-toolbar new-menu content-header"\n\n\t\t\t\t\t\t\t\tcomponent="LetterHeaderActions"\n\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\tstore="{attrs.store}"\n\n\t\t\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\tmodels="{attrs.model.letters}"\n\t\t\t\t\t\t\t\tletterNeighbours="{attrs.model.letterNeighbours}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<b:letter-list-item-adv\n\t\t\t\t\t\t\t\tfn:if="_this.isAdvEnable() && !compact"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\tponymode="{attrs.uiLayout.ponyMode}"\n\t\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t\x3c!-- Письма выбраны в 3pane --\x3e\n\t\t\t\t\t\t\t\t<fn:when test="previewSelectedLetters">\n\t\t\t\t\t\t\t\t\t<b:panel-with-selected use:mediator="letters-selection themes-manager">\n\t\t\t\t\t\t\t\t\t\t<fn:match name="empty">\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="!(attrs.route.is(\'#search-letter #search\') && !attrs.model.search.length) && attrs.letters.length">\n\t\t\t\t\t\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype="no-select"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager letters-actions folders-navigation filter-manager"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t\t</b:panel-with-selected>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<b:scrollable\n\t\t\t\t\t\t\t\t\t\t\tname="letter-content"\n\t\t\t\t\t\t\t\t\t\t\temit-onbottom="100"\n\t\t\t\t\t\t\t\t\t\t\tsubstrated="{!isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tbright="{!isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="thread-scroller advert-manager"\n\t\t\t\t\t\t\t\t\t\t\tleft-gap="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tbackground-transparent="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\x3c!-- TODO: нужен рефактиринг условий, избавиться от сложный условий --\x3e\n\t\t\t\t\t\t\t\t\t\t\x3c!-- Письмо не найдено --\x3e\n\t\t\t\t\t\t\t\t\t\t<fn:if test="letterNotFound">\n\t\t\t\t\t\t\t\t\t\t\t<fn:var name="touch" value="{layout.isLessThen(\'xs\')}"/>\n\t\t\t\t\t\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\' || touch}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="(layout.type === \'3pane\' && !layout.selectMod) && attrs.route.is(\'#read-letter #search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t<b:panel-with-selected use:mediator="letters-selection">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<fn:match name="empty">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b:octopus type="no-letter" use:mediator="layout-manager"/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t\t\t\t\t</b:panel-with-selected>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="((layout.type === \'2pane\' && !layout.selectMod) && attrs.route.is(\'#read-letter #search-letter\'))">\n\t\t\t\t\t\t\t\t\t\t\t\t<b:letter-list\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tqa:id="letter-list-{attrs.model.folder.id}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlayout="{layout}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{false}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels="{attrs.uiLetters}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tletter-not-found="{letterNotFound}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmetathreads="{attrs.metathreads}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tunsubscribeList="{attrs.unsubscribeList}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowBackToParentFolder="{attrs.showBackToParentFolder}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-loader letters-navigation pony-mode"/>\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\t<fn:if test="!letterNotFound">\n\t\t\t\t\t\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\'}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="!attrs.route.is(\'#search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t<fn:if test="(layout.type !== \'3pane\' || !layout.selectMode ) && attrs.route.is(\'#read-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:thread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="!_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions thread-manager thread-scroller compose-manager layout-manager pony-mode themes-manager folders-actions"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#read-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.message}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisDragIconShown="{layout.type === \'3pane\' && _this.isDragIconShown()}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent="Thread"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuseMediators="{[\'letters-actions\', \'thread-manager\', \'thread-scroller\', \'compose-manager\', \'layout-manager\', \'pony-mode\', \'themes-manager\', \'folders-actions\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#read-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.message}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisDragIconShown="{layout.type === \'3pane\' && _this.isDragIconShown()}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="attrs.route.is(\'#search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t<fn:if test="(layout.type !== \'3pane\' || !layout.selectMode ) && attrs.route.is(\'#search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:thread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="!_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions search-manager thread-manager thread-scroller compose-manager layout-manager pony-mode themes-manager"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#search-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tautoread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.id}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent="Thread"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuseMediators="{[\'letters-actions\', \'thread-manager\', \'thread-scroller\', \'compose-manager\', \'layout-manager\', \'pony-mode\', \'themes-manager\', \'folders-actions\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#search-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tautoread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.id}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t</b:scrollable>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="right-column" args="layout">\n\t\t\t\t\t\t<fn:var name="isSearch" value="{attrs.route.is(\'#search\') || attrs.route.is(\'#search-letter\') && (layout.type === \'3pane\')}"/>\n\t\t\t\t\t\t<fn:var name="isAdvertScroll" value="{layout[\'is-advert-scroll\']}"/>\n\n\t\t\t\t\t\t<div bem:elem="overflow-container" fn:if="!layout[\'hide-ads\']">\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t<fn:when test="isAdvertScroll">\n\t\t\t\t\t\t\t\t\t<b:advert-column\n\t\t\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="advert-manager"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<b:slot qa:id="right-column-adv" use:mediator="layout-manager"/>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="overflow-container"\n\t\t\t\t\t\t\tfn:if="layout[\'show-todo\'] && !isSearch"\n\t\t\t\t\t\t\tqa:id="right-column-todo"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:todo\n\t\t\t\t\t\t\t\tuse:mediator="todo-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="dimmer" args="layout">\n\t\t\t\t\t\t<fn:if test="layout.dimmer">\n\t\t\t\t\t\t\t<b:dimmer />\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t</b:layout>\n\t\t\t</div>\n\n\t\t\t\x3c!-- Контейнер для порталов реакта, для оверлея тултипа --\x3e\n\t\t\t\x3c!-- Тут будем рисовать всякие оверлеи, например использовать как портал для react элементов --\x3e\n\t\t\t\x3c!-- Используется для тултипа, который в дропдауне при нажатии на скрепку, аттачи к письму --\x3e\n\t\t\t<div bem:elem="portal-overlay" id="portal-overlay"></div>\n\t\t</div>\n\t</div>\n\n\t<b:shortcut />\n\t<b:counters/>\n\t\x3c!-- Скрытый фрейм для загрузки аттачей --\x3e\n\t\x3c!-- Один на страницу, у него всегда name=download-frame --\x3e\n\t<b:download-frame/>\n\n\t\x3c!-- Прогрессбар --\x3e\n\t<span bem:elem="progress">\n\t\t<b:progress\n\t\t\tuse:mediator="progress-bar-manager"\n\t\t\tmin="0"\n\t\t\tmax="100"\n\t\t/>\n\t</span>\n\n\t\x3c!-- Загрузчик vk messenger (покажет, если нужно) --\x3e\n\t<b:react-async\n\t\tcomponent="VkMessengerProvider"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/application-mail/application-mail.html")});define("feast-tpl!ui-block/application-mail/application-mail.html",["feast-tpl!app/feast-tpl!ui-block/application-mail/application-mail.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/tooltip/tooltip.html",["feast"],function(a){return a.smartParse('<div qa:id="tooltip" data-container-id="tooltip-container">\n\t<b:tooltip-overlay\n\t\tcontent="{attrs.content}"\n\t\thint="{attrs.hint}"\n\t\thidden="{attrs.hidden}"\n\t\tquick-switch="{attrs[\'quick-switch\']}"\n\t\ttarget="{attrs.target}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/tooltip/tooltip.html")});define("feast-tpl!ui-block/tooltip/tooltip.html",["feast-tpl!app/feast-tpl!ui-block/tooltip/tooltip.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\t<bem:mod name="break-word" test="attrs[\'break-word\']"/>\n\n\t<div bem:elem="content">\n\t\t{attrs.content}\n\t</div>\n\t<div fn:if="attrs.hint" bem:elem="hint">\n\t\t{attrs.hint}\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html")});define("feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html",["feast-tpl!app/feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html"],function(a){return a});define("ui-block/tooltip-overlay/tooltip-overlay",["exports","default-values","feast","feast-extension/a11y","feast-tpl!./tooltip-overlay.html","service/smokescreen"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=h(b);var g=h(d);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend({name:"tooltip-overlay",template:g.default,defaults:{"break-word":a.WORD_BREAK_IN_TOOLTIP},attrChanged:{hidden:function a(b,c){if(c&&!b){this.setCoordinates();if(!this.get("quick-switch")){this.el.style.animation="scaling 0.2s cubic-bezier(0.270, 0.010, 0.000, 1.000)";return}}if(b){this.el.style.animation="";this.el.style.left="0px";this.el.style.top="0px"}}},getTargetType:function a(){var b=this.get("target");var d="bottom";var f=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"left");var g=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"right");var h=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"top");var i=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"letter-bottom");if(b.closest(f)){d="left"}if(b.closest(g)){d="right"}if(b.closest(h)){d="top"}if(b.closest(i)){d="letter-bottom"}return d},setCoordinates:function a(){var b=void 0;var c=void 0;var d=this.get("target");var f=4;var g=8;var h=void 0;var i=void 0;var j=void 0;var k=void 0;var l=window.innerWidth;var m=window.innerHeight;var n=this.el.offsetWidth;var o=this.el.offsetHeight;var p=1;var q=(0,e.selector)(".js-letter-list-item");var r=d.getBoundingClientRect();var s=this.getTargetType();switch(s){case"letter-bottom":var t=d.closest(q);var u=t.getBoundingClientRect();i=r.right-d.offsetWidth/2-n/2>g;h=r.right-d.offsetWidth/2+n/2<l-g;j=u.bottom+o<m-g;if(h&&i){b=r.right-d.offsetWidth/2-n/2}else if(!i){b=g}else{b=l-n-g}if(j){c=u.bottom+p}else{c=u.top-o-p}break;case"letter-subject":t=d.closest(q);u=t.getBoundingClientRect();b=r.left;j=u.bottom+o<m-g;if(j){c=u.bottom+p}else{c=u.top-o-p}break;case"bottom":b=r.right-d.offsetWidth/2-n/2;c=r.bottom+f;i=b>g;h=b+n<l-g;j=c+o<m-g;if(!i){b=g}else if(!h){b=l-n-g}if(!j){c=r.top-o-f}break;case"top":b=r.right-d.offsetWidth/2-n/2;c=r.top-o-f;i=b>g;h=b+n<l-g;k=c-o>g;if(!i){b=g}else if(!h){b=l-n-g}if(!k){c=r.bottom+f}break;case"right":b=r.right+f;c=r.top+d.offsetHeight/2-o/2;break;case"left":b=r.left-n-f;c=r.top+d.offsetHeight/2-o/2;break}this.el.style.left=b+"px";this.el.style.top=c+"px"}})});define("ui-block/tooltip/tooltip",["exports","default-values","feast","feast-tpl!./tooltip.html","service/adv/locator","service/smokescreen","ui-block/tooltip-overlay/tooltip-overlay"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=j(b);var h=j(c);var i=j(f);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"tooltip",template:h.default,blocks:{"tooltip-overlay":i.default},defaults:{disabled:a.DISABLE_TOOLTIPS,hidden:true,content:"",hint:"",target:null,"quick-switch":false},target:null,lastTarget:null,isQuickSwitch:false,quickSwitchTimeout:20,delay:400,titleMaxLength:130,didMount:function a(){this.$on(document,"mouseover","onMouseOver");this.show=this.show.bind(this)},onMouseOver:function a(b){var c=b.target;while(c&&c!==document){var e=c.getAttribute("title")||c.getAttribute("data-title");if(!e){c=c.parentNode;continue}var f=c.classList;var g=false;for(var h=0;h<f.length;++h){if(d.locator.isWelter(f[h])){g=true;break}}if(!f.length||g){this.hideBrowserTooltip(c);c=c.parentNode;continue}if(this.target!==c){if(this.target){this.hide()}this.target=c;if(this.lastTarget){this.$off(this.lastTarget,"mouseleave","hide");this.$off(this.lastTarget,"mousedown","hide");this.$off(document,"keydown","hide");this.$off(this.lastTarget,"click","onClick");if(this.scrollable){this.$off(this.scrollable,"scroll","hide");this.scrollable=null}this.lastTarget=null}if(c.matches('[type="file"]')){return}this.hideBrowserTooltip();this.scrollable=this.getScrollable();this.$on(this.target,"mouseleave","hide");this.$on(this.target,"mousedown","hide");this.$on(document,"keydown","hide");this.$on(this.target,"click","onClick");if(this.scrollable){this.$on(this.scrollable,"scroll","hide")}this.set("quick-switch",this.isQuickSwitch);this.showTimeout=setTimeout(this.show,this.isQuickSwitch?0:this.delay)}break}},onClick:function a(b){var c=this;setTimeout(function(){if(document.body.contains(b.target)){c.hideBrowserTooltip(b.target)}},20)},getScrollable:function a(){var b=this.target;var c=(0,e.selector)(".scrollable");while(b!==document){if(b.matches(c)){return b}b=b.parentNode}},hideBrowserTooltip:function a(b){var c=this.target||b;while(c&&c!==document){if(c.hasAttribute("title")){var d=c.getAttribute("title");c.setAttribute("data-title",d);c.removeAttribute("title")}c=c.parentNode}},setBrowserTooltip:function a(){var b=this.target;while(b&&b!==document){if(b.hasAttribute("data-title")){var c=b.getAttribute("data-title");b.setAttribute("title",c);b.removeAttribute("data-title")}b=b.parentNode}},hide:function a(){var b=this;clearTimeout(this.showTimeout);this.set({content:"",hint:"",target:null,hidden:true});this.setBrowserTooltip();this.lastTarget=this.target;this.target=null;clearTimeout(this.switchTimeout);this.isQuickSwitch=true;this.switchTimeout=setTimeout(function(){b.isQuickSwitch=false},this.quickSwitchTimeout)},show:function a(){if(this.is("disabled")){return}var b=this.getTitle();var c=this.getShortcut();var d=this.getMode();if(b){switch(d){case"overflow":if(this.target.offsetWidth>=this.target.scrollWidth&&this.target.offsetHeight>=this.target.scrollHeight){return}break}this.set({hint:c,content:b,target:this.target});this.set("hidden",false)}},getTitle:function a(){if(!this.target){return""}return this.target.getAttribute("data-title")||this.target.getAttribute("title")||""},getShortcut:function a(){if(!this.target){return""}return this.target.getAttribute("data-title-shortcut")||""},getMode:function a(){if(!this.target){return"auto"}return this.target.getAttribute("data-title-mode")||"auto"},didUnmount:function a(){this.$off(document,"mouseover","onMouseOver");if(this.lastTarget){this.$off(this.lastTarget,"mouseleave","hide");this.$off(this.lastTarget,"mousedown","hide");this.$off(document,"keydown","hide");this.$off(this.lastTarget,"click","onClick");if(this.scrollable){this.$off(this.scrollable,"scroll","hide")}this.lastTarget=null}}})});define("service/title",["exports","ui-block/tooltip/tooltip"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={setup:function a(){var c=new b.default({router:app});c.renderTo(document.body);this.setup=function(){}}}});define("feast-tpl!app/feast-tpl!ui-block/advert-column/advert-column.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="native-scroll" test="attrs[\'native-scroll\']"/>\n\t<bem:mod name="css-scroll" test="attrs[\'css-scroll\']"/>\n\t<bem:mod name="indented" test="attrs[\'indented\']"/>\n\t<bem:mod name="indented-new-letter-list" test="attrs[\'indented\'] && attrs[\'new-letter-list\']"/>\n\t<bem:mod name="ad-feedback" test="attrs[\'ad-feedback-target\']"/>\n\n\t<div bem:elem="noads-button-container">\n\t\t<b:noads-button\n\t\t\tfn:if="attrs[\'ads-off-target\']"\n\t\t/>\n\t</div>\n\t<b:ad-feedback\n\t\tfn:if="attrs[\'ad-feedback-target\']"\n\t\tqa:id="right-column-feedback"\n\t\tuse:mediator="layout-manager"\n\t\tindented="{attrs[\'indented\']}"\n\t/>\n\t<b:slot qa:id="right-column-adv" use:mediator="layout-manager advert-manager" />\n</div>\n',"app/feast-tpl!ui-block/advert-column/advert-column.html")});define("feast-tpl!ui-block/advert-column/advert-column.html",["feast-tpl!app/feast-tpl!ui-block/advert-column/advert-column.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-oauth",["require","exports","default-values","service/radars/index"],function(require,exports,a,b){"use strict";var c;Object.defineProperty(exports,"__esModule",{value:true});exports.OAuthFeature=void 0;b=__importDefault(b);var d;(function(a){a["Calls"]="calls";a["CloudDnD"]="cloud-dnd";a["Default"]="default"})(d=exports.OAuthFeature||(exports.OAuthFeature={}));var e=(c={},c[d.Calls]=["calls.api"],c[d.CloudDnD]=["cloud.openapi.dnd"],c[d.Default]=[],c);function f(c){if(c===void 0){c=d.Default}return new Promise(function(b,d){new Promise(function(a,b){require(["@mail/oauth"],a,b)}).then(__importStar).then(function(f){f.init({clientId:a.OAUTH_CLIENT_ID,scopes:e[c]});f.auth(function(a){var c=a.status,e=a.access_token;if(c!==f.AUTH_CONNECTED){d(c)}b(e)})}).catch(function(a){d(a)})}).catch(function(a){b.default({type:"oauth-err_"+c,rlog:"octavius_error_oauth",rlog_message:a});return Promise.reject(a)})}exports.default=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/quota",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.handleQuotaErr=void 0;a=__importDefault(a);var b=function(b,c,d){return b().then(function(a){return a}).catch(function(b){a.default.send("union_quota",{i:"error",rlog:"union_quota_err",rlog_message:{err:b,placement:c,expId:d}})})};exports.handleQuotaErr=b});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/request-api-oauth",["require","exports","helpers/get-oauth","request","service/radars/index","service/storage","uuid"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.requestApiOAuth=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=function(a){return"Bearer "+a};var g=function(a){return a.status===401};var h="oauth-token";var i=false;function j(a,b){var c=e.default();a["X-Request-Id"]=c;if(b){a[b]=c}}function k(e,k,l){if(l===void 0){l={}}var m=l.authorizationFormatter,n=m===void 0?f:m,o=l.isAuthError,p=o===void 0?g:o,q=l.headers,r=q===void 0?{}:q,s=l.customRequestIdHeader,t=l.oauthFeature,u=l.canceller,v=__rest(l,["authorizationFormatter","isAuthError","headers","customRequestIdHeader","oauthFeature","canceller"]);var w=d.default.get(h);var x=i?Promise.resolve(w):a.default(t).then(function(a){d.default.set(h,a);i=true;return a});return x.then(function(a){var c=__assign(__assign({},r),{Authorization:n(a)});j(c,s);var d=b.default(e,k,__assign(__assign({},v),{headers:c,withoutRequestId:true}));u===null||u===void 0?void 0:u.set(d);return d}).catch(function(f){if(p(f)&&i){c.default({type:"oauth-request_retry",intervals:[[t]]});return a.default(t).then(function(a){d.default.set(h,a);var c=__assign(__assign({},r),{Authorization:n(a)});j(c,s);return b.default(e,k,__assign(__assign({},v),{headers:c,withoutRequestId:true}))})}var g=f.error,l=f.responseText,m=f.status;if(g==="parsererror"&&l===""&&m===200){return Promise.resolve(f.data)}return Promise.reject(f)})}exports.requestApiOAuth=k;exports.default=k});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/cloud",["require","exports","default-values","helpers/get-oauth","helpers/quota","helpers/request-api-oauth","service/radars/index"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isQuotaGroup=exports.EntityType=exports.PromiseStatus=exports.Errors=void 0;d=__importDefault(d);e=__importDefault(e);var f;(function(a){a["ResponseNotOK"]="response_not_ok";a["RequestError"]="request_err";a["ResponseNoAuth"]="response_no_auth";a["ResponseParentNotFound"]="response_parent_not_found";a["RequestAborted"]="request_aborted"})(f=exports.Errors||(exports.Errors={}));var g;(function(a){a["fulfilled"]="fulfilled";a["rejected"]="rejected"})(g=exports.PromiseStatus||(exports.PromiseStatus={}));var h;(function(a){a["UserInfo"]="user/info";a["Create"]="private/create";a["Share"]="private/share";a["MakeDirectory"]="private/mkdir";a["List"]="private/list";a["Move"]="private/move";a["AgreeLa"]="user/agree-la";a["Delete"]="private/delete";a["Quota"]="user/quota"})(h||(h={}));var i;(function(a){a["directory"]="d";a["file"]="f"})(i=exports.EntityType||(exports.EntityType={}));var j=function(){return a.QUOTA_GROUP.includes(a.ADV_EXP_ID)};exports.isQuotaGroup=j;var k=null;var l=null;var m=function(){function g(){this.ABORT_STATUS_CODE=0;this.NO_AUTH_STATUS_CODE=403;this.PARENT_NOT_FOUND_CODE=404}g.prototype.getRequestParams=function(a){var c=this;if(a===void 0){a="GET"}var d=function(a){return a.status===c.NO_AUTH_STATUS_CODE};return{type:a,processData:false,customRequestIdHeader:"X-Req-ID",isAuthError:d,oauthFeature:b.OAuthFeature.CloudDnD}};g.prototype.getResponseInfo=function(a){var b=a||{},c=b.status,d=b.body,e=b.options,f=b.url;return{status:c,body:d,options:e,url:f}};g.prototype.getErrorInfo=function(a){var b=a||{},c=b.status,d=b.url,e=b.error,f=b.responseText,g=b.statusText,h=b.body;return{status:c,url:d,errorText:e,responseText:f,statusText:g,body:h}};g.prototype.isAgreedLA=function(){var b=this;if(k){return Promise.resolve(k)}var c=""+a.CLOUD_OPEN_API_URL+h.UserInfo;var g=__assign({force:true},this.getRequestParams());return d.default(c,null,g).then(function(a){var b;b=(a===null||a===void 0?void 0:a.body)||{},k=b["agreed-la"],l=b.upload_url;return k}).catch(function(a){var c=a.status;var d=f.RequestError;if(typeof c==="number"){e.default(["cld-openapi-user-info-err",c]);var g=c===b.NO_AUTH_STATUS_CODE||c===b.PARENT_NOT_FOUND_CODE;d=g?f.ResponseNoAuth:f.ResponseNotOK}else{e.default("cld-openapi-user-info-err-nost")}return Promise.reject({type:d,err:b.getResponseInfo(a)})})};g.prototype.prepareFolder=function(b,c){if(c===void 0){c=a.CLOUD_LOAD_DIRECTORY}if(b.length<=1){return Promise.resolve(c)}var d=(new Date).toLocaleString().replace(/:/g,"-");var e=c+"/"+d;return this.createFolder(e)};g.prototype.withCreateFolder=function(a,b){var c=this;return this.getFoldersTree().then(function(d){var e=d===null||d===void 0?void 0:d.map(function(a){var b=a.path;return b});var f=e===null||e===void 0?void 0:e.find(function(b){return b===a});if(!f){return c.createFolder(a).then(b)}return b(a)})};g.prototype.getErrorByStatus=function(a){var b=this,c=b.NO_AUTH_STATUS_CODE,d=b.PARENT_NOT_FOUND_CODE,e=b.ABORT_STATUS_CODE;switch(a){case e:return f.RequestAborted;case c:return f.ResponseNoAuth;case d:return f.ResponseParentNotFound;default:return f.ResponseNotOK}};g.prototype.createFiles=function(b,c,d){var e=this;if(c===void 0){c=a.CLOUD_LOAD_DIRECTORY}if(d===void 0){d={}}var g=__spreadArrays(b).sort(function(a,b){return a.size-b.size}),h=g[0],i=g.slice(1);var j=function(a){return e.prepareFolder(b,a).then(function(a){return e.createFile(h,a,d).then(function(b){var c=i.map(function(b){return e.createFile(b,a)});return Promise.allSettled(__spreadArrays([Promise.resolve(b)],c))}).catch(function(b){var c=b.type;if([f.ResponseParentNotFound,f.ResponseNoAuth].includes(c)){return Promise.reject(b)}var d=i.map(function(b){return e.createFile(b,a)});return Promise.allSettled(__spreadArrays([Promise.reject(b)],d))})})};return this.withCreateFolder(c,j).catch(function(a){var b=i.map(function(){return Promise.reject(__assign(__assign({},a),{type:a.type+"_1st"}))});return Promise.allSettled(__spreadArrays([Promise.reject(a)],b))})};g.prototype.createFile=function(a,b,c){var g=this;if(b===void 0){b=""}if(c===void 0){c={}}var h=__assign(__assign({force:true},this.getRequestParams("PUT")),c);if(!l){return Promise.reject({type:f.RequestError,err:"no upload_url"})}var i=""+l+b+"/"+a.name.normalize("NFC");return d.default(i,a,h).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var c=f.RequestError;if(typeof b==="number"){e.default(["cld-openapi-create-file-err",b]);c=g.getErrorByStatus(b)}else{e.default("cld-openapi-create-file-err-nost")}return Promise.reject({type:c,err:g.getResponseInfo(a)})})};g.prototype.createWebLink=function(b){var c=this;var g=__assign({force:true},this.getRequestParams("POST"));var i=""+a.CLOUD_OPEN_API_URL+h.Share+b;return d.default(i,null,g).then(function(a){var b;return(b=a===null||a===void 0?void 0:a.body)===null||b===void 0?void 0:b.url}).catch(function(a){var b=a.status;var d=f.RequestError;if(typeof b==="number"){e.default(["cld-openapi-create-weblink-err",b]);d=b===c.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}else{e.default("cld-openapi-create-weblink-err-nost")}return Promise.reject({type:d,err:c.getResponseInfo(a)})})};g.prototype.createFolder=function(b){var c=this;var g=__assign({force:true},this.getRequestParams("POST"));var i=""+a.CLOUD_OPEN_API_URL+h.MakeDirectory+b;return d.default(i,null,g).then(function(a){var b;return(b=a===null||a===void 0?void 0:a.body)===null||b===void 0?void 0:b.path}).catch(function(a){var b=a.status;var d=f.RequestError;if(typeof b==="number"){e.default(["cld-openapi-mkdir-err",b]);d=c.getErrorByStatus(b)}else{e.default("cld-openapi-mkdir-err-nost")}return Promise.reject({type:d,err:c.getResponseInfo(a)})})};g.prototype.getFolderContent=function(b){var c=this;if(b===void 0){b="/"}var g=""+a.CLOUD_OPEN_API_URL+h.List+b;var i=__assign({force:true},this.getRequestParams());return d.default(g,null,i).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var d=f.RequestError;if(b){e.default(["cld-openapi-list-err",b]);d=b===c.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}return Promise.reject({type:d,err:a})})};g.prototype.getFoldersTree=function(){return this.getFolderContent().then(function(a){var b,c;return(c=(b=a.list)===null||b===void 0?void 0:b.filter(function(a){return a.kind==="folder"}))===null||c===void 0?void 0:c.map(function(a){return a})})};g.prototype.move=function(b,c,g){var i=this;if(g===void 0){g=false}if(b===c){return Promise.resolve(null)}var j=""+a.CLOUD_OPEN_API_URL+h.Move;var k=__assign({force:true},this.getRequestParams("POST"));var l={src_path:b,dst_path:c,overwrite:g};return d.default(j,JSON.stringify(l),k).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var c=f.RequestError;if(b){e.default(["cld-openapi-move-err",b]);c=b===i.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}return Promise.reject({type:c,err:a})})};g.prototype.delete=function(b){var c=this;var g=""+a.CLOUD_OPEN_API_URL+h.Delete+b;var i=__assign({force:true},this.getRequestParams("POST"));return d.default(g,null,i).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var d=f.RequestError;if(b){e.default(["cld-openapi-delete-err",b]);d=b===c.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}return Promise.reject({type:d,err:a})})};g.prototype.agreeLa=function(){var b=""+a.CLOUD_OPEN_API_URL+h.AgreeLa;var c=this.getRequestParams("POST");return d.default(b,null,c).catch(function(a){return Promise.reject({err:a})})};g.prototype.getUserQuota=function(){var b=this;var c=""+a.CLOUD_OPEN_API_URL+h.Quota;var e=this.getRequestParams();return d.default(c,null,e).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){return Promise.reject(b.getErrorInfo(a))})};g.prototype.getQuotaDWH=function(a,b){var d=this.getUserQuota.bind(this);return c.handleQuotaErr(d,a,b).then(function(c){if(!c){return}var d=c.quota,e=c.used.total;return{client_id:"UA-43037165-12",size_quota:e,free_quota:d-e,placement:a,group:b}})};return g}();exports.default=new m});define("helpers/can-show-noads-button",["require","exports","default-values","service/ads-off","service/cloud"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=function(){return a.NOADS_BUTTON_SHOW_FORCE||a.NOADS_BUTTON_SHOW_EXP&&(b.isAdsOffTargetGroup()||c.isQuotaGroup())};exports.default=d});define("feast-tpl!app/feast-tpl!ui-block/noads-button/noads-button.html",["feast"],function(a){return a.smartParse('<div\n\tqa:id="right-column-noads"\n\tpromo:id="right-column-noads"\n>\n\t<fn:var name="isDefaultTheme" value="{attrs[\'isDefaultTheme\']}"/>\n\t<div bem:elem="button">\n\t\t<b:react-async\n\t\t\tcomponent="NoadsButton"\n\t\t\ttext="{_this.getButtonContent()}"\n\t\t\tisDefaultTheme="{isDefaultTheme}"\n\t\t\tonClick="{_this.onActionClick}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/noads-button/noads-button.html")});define("feast-tpl!ui-block/noads-button/noads-button.html",["feast-tpl!app/feast-tpl!ui-block/noads-button/noads-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/noads-button/noads-button",["require","exports","@mail/xray","default-values","feast","feast-tpl!./noads-button.html","service/ads-off","service/cloud","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);exports.default=c.default.Block.extend({name:"noads-button",template:d.default,immutable:true,blocks:{"react-async":g.default},events:{"action:click":"onActionClick"},dwh:null,constructor:function(){c.default.Block.apply(this,arguments);this.onActionClick=this.onActionClick.bind(this)},didMount:function(){var c=this;require(["mediator/layout-manager","mediator/themes-manager"],function(a,b){a.default.register(c);b.default.register(c)});this.getDwhPromise().then(function(b){b&&a.default.send("union_quota",{i:"placement_view",dwh:b})});a.default.send("noads_button_show_"+b.ADV_EXP_ID)},onActionClick:function(){a.default.send("noads_button_click_"+b.ADV_EXP_ID);this.getDwhPromise().then(function(b){b&&a.default.send("union_quota",{i:"placement_click",dwh:b})});e.onComplete(b.QUOTA_AD_URL)},getButtonContent:function(){var a=this.getTextFromExpId(),b=a.short,c=a.long;return this.get("isSmallAdvColumnRight")?b:c},getTextFromExpId:function(){if(b.ADV_OFF_MONTH_GROUP.includes(b.ADV_EXP_ID)){return{short:i18n("Месяц без рекламы"),long:i18n("Месяц без рекламы бесплатно")}}return{short:i18n("Можно без рекламы?"),long:i18n("А можно без рекламы?")}},getDwhPromise:function(){if(!this.dwh){this.dwh=f.default.getQuotaDWH("noads_btn",b.ADV_EXP_ID)}return this.dwh}})});define("feast-tpl!app/feast-tpl!ui-block/slot/slot.html",["feast"],function(a){return a.smartParse('<div\n\tstyle="width: {attrs[\'right-column\']}px"\n>\n\t<div ref="el"/>\n</div>\n',"app/feast-tpl!ui-block/slot/slot.html")});define("feast-tpl!ui-block/slot/slot.html",["feast-tpl!app/feast-tpl!ui-block/slot/slot.html"],function(a){return a});define("ui-block/slot/slot",["exports","@mail/adman","feast","feast-tpl!./slot.html","service/adv/index","service/smokescreen"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(a);var g=j(b);var h=j(c);var i=j(d);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend((0,e.withWelter)({name:"slot",template:h.default,immutable:true,blocks:{},attrChanged:{"right-column":function a(b,c){var d=this;this.refs.el.style.width=b+"px";if(b===c){return}var e=function a(){var b=d.isMounted();if(b){d.refs.el.style.visibility="visible"}return b};var f=function a(b,c){if(e()){i.default.onPlacementRender(b,c)}};var g=i.default.toggleActiveSidebarPlacement(b);if(g){this.refs.el.style.visibility="hidden";g.attachToContainer(this.refs.el);g.render(true,false).then(f.bind(this,g),e)}}},didMount:function a(){var b=this;i.default.toggleActiveSidebarPlacement(this.get("right-column"));d.sidebarPlacementsList.forEach(function(a){if(i.default.getActiveSidebarPlacement()!==a){return}var c=f.default.placement(a);if(!c){return}c.attachToContainer(b.refs.el);c.wakeUp();c.render(true,false).then(i.default.onPlacementRender.bind(i.default,c),function(){return null})})},didUnmount:function a(){if(f.default.placement("sidebar")){f.default.placement("sidebar").destroy()}if(f.default.placement("sidebar-small")){f.default.placement("sidebar-small").destroy()}}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/advert-column/advert-column",["require","exports","default-values","feast","feast-tpl!./advert-column.html","helpers/can-show-noads-button","service/ads-off","service/adv/index","ui-block/ad-feedback/ad-feedback","ui-block/noads-button/noads-button","ui-block/slot/slot"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);exports.default=b.default.Block.extend({name:"advert-column",defaults:{"ads-off-target":d.default(),"ad-feedback-target":!e.isAdsOffTargetGroup()&&f.default.showAdFeedback(),"new-letter-list":a.NEW_LETTER_LIST,indented:a.ADVERT_SIDEBAR_ROUNDED},template:c.default,blocks:{slot:i.default,"noads-button":h.default,"ad-feedback":g.default},didMount:function(){this.broadcast("adcolumn:mount")}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu/contextmenu.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\n\t<div\n\t\tbem:elem="container"\n\t\tstyle="{_this.setStyle()}"\n\t\tremit:click.prevent="menu-toggle"\n\t>\n\t\t<div bem:elem="block" ref="block"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/contextmenu/contextmenu.html")});define("feast-tpl!ui-block/contextmenu/contextmenu.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu/contextmenu.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html",["feast"],function(a){return a.smartParse('<div qa:id="contextmenu-correspondents">\n\t<fn:var name="contacts" value="{attrs.model.contacts || []}"/>\n\t<fn:var name="isSingle" value="{contacts.length === 1}"/>\n\n\t<b:list>\n\t\t<b:list-item\n\t\t\tref="js-copy"\n\t\t\tqa:id="copy"\n\t\t\tradar-id="copy"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="copy">\n\t\t\t\t<b:ico name="actions:copy" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{isSingle ? i18n(\'Копировать адрес\') : i18n(\'Копировать адреса\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="compose"\n\t\t\tremit:click="compose:to"\n\t\t\tevent:details="contacts"\n\t\t\tradar-id="compose"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="compose">\n\t\t\t\t<b:ico name="compose" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Написать письмо\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="call"\n\t\t\tfn:if="_this.canCallTo(contacts)"\n\t\t\tremit:click="call:to"\n\t\t\tevent:details="contacts"\n\t\t\tradar-id="call"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="call">\n\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Позвонить\')}</span>\n\t\t</b:list-item>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html")});define("feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html"],function(a){return a});define("ui-block/contextmenu-correspondents/contextmenu-correspondents",["exports","default-values","feast","feast-tpl!./contextmenu-correspondents.html","helpers/opener","service/calls","service/compose","ui-block/list/list","ui-block/list-item/list-item","lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=q(b);var k=q(c);var l=q(d);var m=q(e);var n=q(f);var o=q(g);var p=q(h);function q(a){return a&&a.__esModule?a:{default:a}}exports.default=j.default.Block.extend({name:"contextmenu-correspondents",template:k.default,blocks:{list:o.default,"list-item":p.default},events:{"compose:to":"onComposeCreateTo","call:to":"onCallTo"},defaults:{type:"correspondents",model:{clipboardText:"",contacts:[],type:"correspondents"}},didMount:function a(){var b=this;var c=this.refs["js-copy"];var d=this.get("model");c.setAttribute("data-clipboard-text",d.clipboardText);(0,i.lazyClipboard)().then((0,i.uniqCallback)(this,function(a){b.clipboard=b.isMounted()?new a(c):null}))},destroyClipboard:function a(){this.clipboard&&this.clipboard.destroy();this.clipboard=null},didUnmount:function a(){this.destroyClipboard()},onBeforeHide:function a(){this.destroyClipboard()},onComposeCreateTo:function a(b){var c=b.details;var d="default"in n.default&&"open"in n.default.default?n.default.default:n.default;d.open({correspondents:{to:c}})},canCallTo:function b(c){return a.CALLS_P2P_OUTGOING&&m.default.getCallsAPIClient().canCallTo(c.map(function(a){return a.email})).some(function(a){return a.canCall})},onCallTo:function a(b){var c=b.details;m.default.getCallsAPIClient().callTo(c.map(function(a){return a.email})).then(function(a){if(a.redirectUrl){(0,l.default)(a.redirectUrl)}})}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="contextmenu">\n\t<fn:var name="folder" value="{attrs.model}"/>\n\t<fn:var name="metathreadToMyselfEnabled" value="{attrs[\'to-myself-enabled\']}"/>\n\t<fn:var name="icomap" value="{_this.folder2icoMap}"/>\n\n\t<b:list>\n\t\t<fn:if test="attrs[\'new-tab-available\']">\n\t\t\t<b:list-item\n\t\t\t\tremit:click="newtab"\n\t\t\t\tqa-id="newtab"\n\t\t\t\tradar-id="newtab"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t</b:list-item>\n\n\t\t\t<div bem:elem="hr"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.get(\'security\') && !folder.get(\'open\')">\n\t\t\t<b:list-item\n\t\t\t\tqa-id="unlock"\n\t\t\t\tradar-id="unlock"\n\t\t\t\tremit:click="unlock"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="lock-off">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\tmod="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Разблокировать\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.get(\'security\') && folder.get(\'open\')">\n\t\t\t<b:list-item\n\t\t\t\tremit:click="lock"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t\tqa-id="lock"\n\t\t\t\tradar-id="lock"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="lock-on">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\tmod="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Заблокировать\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tremit:click="read"\n\t\t\tevent:details="{model:folder}"\n\t\t\tqa-id="read"\n\t\t\tradar-id="read"\n\t\t>\n\t\t\t<bem:mod name="disabled" test="folder.get(\'messages_unread\') === 0 || !folder.is(\'open\')"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Пометить все письма прочитанными\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tremit:click="clear"\n\t\t\tevent:details="{model:folder}"\n\t\t\tqa-id="clear"\n\t\t\tradar-id="clear"\n\t\t>\n\t\t\t<bem:mod name="disabled" test="!_this.isEnableClear()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="clear">\n\t\t\t\t<b:ico name="navigation:folder_hidden" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Очистить содержимое\')}</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<b:list-item\n\t\t\tremit:click="edit"\n\t\t\tevent:details="{model:folder}"\n\t\t\tradar-id="edit"\n\t\t\tqa-id="edit"\n\t\t>\n\t\t\t\x3c!-- выключаем редактирование на некоторых папках --\x3e\n\t\t\t<bem:mod name="disabled" test="_this.isDisableEdit()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="edit">\n\t\t\t\t<b:ico name="actions:edit" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Редактировать папку\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tremit:click="remove"\n\t\t\tevent:details="{model:folder}"\n\t\t\tradar-id="remove"\n\t\t\tqa-id="delete"\n\t\t>\n\t\t\t<bem:mod name="disabled" test="!_this.isEnableRemove()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Удалить папку\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tremit:click="add"\n\t\t\tevent:details="{model: _this.canAddSubfolder() ? folder : _this.getDisplayParentFolder()}"\n\t\t\tqa-id="create"\n\t\t>\n\t\t\t\x3c!-- выключаем создание вложенной папки на некоторых папках --\x3e\n\t\t\t<bem:mod name="disabled" test="_this.isDisableCreate()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="newfolder">\n\t\t\t\t<b:ico name="actions:add_big" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{_this.getCreateText()}</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="attrs[\'folders-share-enabled\'] && !attrs.mobile">\n\t\t\t<div bem:elem="hr"/>\n\t\t\t<fn:if test="_this.showDenySharedFolder()">\n\t\t\t\t<b:list-item\n\t\t\t\t\t\tqa-id="deny"\n\t\t\t\t\t\tradar-id="deny"\n\t\t\t\t\t\tremit:click="sharefolders:denysharedfolder"\n\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico" bem:mod="deny-share">\n\t\t\t\t\t\t<b:ico name="status:block" size="s"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Отказаться от папки\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</fn:if>\n\n\t\t\t<b:list-item\n\t\t\t\tqa-id="share"\n\t\t\t\tradar-id="share"\n\t\t\t\tremit:click="sharefolders:opensharefolders"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t>\n\t\t\t\t\x3c!-- некоторыми папками нельзя поделиться --\x3e\n\t\t\t\t<bem:mod name="disabled" test="_this.isDisableShare()"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="share">\n\t\t\t\t\t<b:ico name="navigation:users" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Настроить доступ к папкам\')}</span>\n\t\t\t</b:list-item>\n\n\t\t\t<b:list-item\n\t\t\t\tqa-id="shareOpportunities"\n\t\t\t\tradar-id="shareOpportunities"\n\t\t\t\tremit:click="shareopportunities:openshareopportunities"\n\t\t\t>\n\t\t\t\t\x3c!-- некоторыми папками нельзя поделиться --\x3e\n\t\t\t\t<bem:mod name="disabled" test="_this.isDisableShareOpportunities()"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="share">\n\t\t\t\t\t<b:ico name="categories:mailings" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Предоставить возможности\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t\x3c!-- пункт контекстного меню для метатреда "письма себе" --\x3e\n\t\t<fn:if test="folder.isToMyself()">\n\t\t\t<div bem:elem="hr"/>\n\n\t\t\t<b:list-item\n\t\t\t\tqa-id="tomyself-disable"\n\t\t\t\tradar-id="tomyself-disable"\n\t\t\t\tremit:click="disable:tomyself"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t>\n\t\t\t\t\x3c!-- дизейблим этот пункт, если метатред уже отключен --\x3e\n\t\t\t\t\x3c!-- (такое возможно, когда мы паролим папку "Письма себе" и отключаем метатред) --\x3e\n\t\t\t\t<bem:mod name="disabled" test="!metathreadToMyselfEnabled"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="share">\n\t\t\t\t\t<b:ico name="categories:self_mail" size="s" />\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="text">{i18n(\'Отключить группировку писем себе\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html")});define("feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-folder/contextmenu-folder",["require","exports","default-values","feast","feast-tpl!./contextmenu-folder.html","helpers/folder","helpers/folder-to-ico-map","helpers/opener","mail/Folder","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);exports.default=b.default.Block.extend({name:"contextmenu-folder",template:c.default,blocks:{list:h.default,"list-item":i.default},events:{newtab:"onNewTab"},folder2icoMap:e.default,defaults:{type:"folder",model:null,"folders-share-enabled":a.FOLDERS_SHARE_ENABLED,"new-tab-available":!a.USE_SINGLE_TAB},didMount:function(){var a=this;require(["mediator/share-folders-manager/share-folders-manager","mediator/layout-manager","mediator/folders-actions"],function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}b.forEach(function(b){var c=b.default;c.register(a)})})},isDisableEdit:function(){var a=this.get("model");return!a.isEditable()},showDenySharedFolder:function(){var a=this.get("model");return a.isShareTake()&&!d.isSharedMailbox(a)},isDisableShare:function(){var a=this.get("model");return!a.isSharable()},isDisableShareOpportunities:function(){var a=this.get("model");return a.isShareTake()},canAddSubfolder:function(){var a=this.get("model");return a.canAddSubfolder()},isDisableCreate:function(){var a=this.get("model");if(a.isShareTake()){return!this.canAddSubfolder()}return false},getCreateText:function(){var a=this.get("model");var b=i18n("Добавить вложенную папку");if(a.isShareTake()){return b}return this.canAddSubfolder()?b:i18n("Добавить папку")},getDisplayParentFolder:function(){var a=this.get("model");var b=function(a){return g.default.get(a.get("parent"))};var c=b(a);while(c&&c.getChildLevel()>=g.default.MAX_CHILD_LEVEL){c=b(c)}return c||null},onNewTab:function(a){a.preventDefault();var b=this.get("router");var c=this.get("model");var d=b.getUrl("#letters",{folder:c.get("id")});f.default(d)},isEnableClear:function(){var a=this.get("model");return a.isClearable()&&!d.isDeleteFromFolderDisabled(a)},isEnableRemove:function(){var a=this.get("model");return a.isRemovable(true)}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-message/contextmenu-message.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{message && message.getFolder()}"/>\n\t<fn:var name="isMetaThread" value="{message && message.get(\'flags.metathread\')}" />\n\n\t<b:list>\n\t\t\x3c!-- Условие: "Открыть в новой вкладки" ИЛИ "Выделить все письма" --\x3e\n\t\t<fn:if test="_this.isNewTabAvailable() || (!isMetaThread && _this.hasSelectButton())">\n\t\t\t\x3c!-- Открыть в новой вкладке --\x3e\n\t\t\t<fn:if test="_this.isNewTabAvailable()">\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="newtab"\n\t\t\t\t\tremit:click="newtab"\n\t\t\t\t\tradar-id="newtab"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</fn:if>\n\n\t\t\t\x3c!-- Выделить все письма --\x3e\n\t\t\t<fn:if test="!isMetaThread && _this.hasSelectButton()">\n\t\t\t\t<fn:if test="!attrs.deselectAll">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tqa:id="select:all"\n\t\t\t\t\t\tremit:click="select:all"\n\t\t\t\t\t\tradar-id="select-all"\n\t\t\t\t\t>\n\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t\t{i18n(\'Выделить все письма\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\n\t\t\t\t<fn:if test="attrs.deselectAll">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tqa:id="select:drop"\n\t\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\t\tradar-id="deselect"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t\t{i18n(\'Снять выделение\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t</fn:if>\n\n\t\t\t<div bem:elem="hr" />\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="remove"\n\t\t\t\tremit:click="remove"\n\t\t\t\tevent:details="{model: message, parentThread: _this.getParentThread()}"\n\t\t\t\tradar-id="remove"\n\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tqa:id="archive"\n\t\t\tremit:click="archive"\n\t\t\tevent:details="{model: message, parentThread: _this.getParentThread()}"\n\t\t\tradar-id="archive"\n\n\t\t\tfn:if="!folder.isArchive() && !attrs[\'archive-disabled\']"\n\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="archive">\n\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'В архив\')}</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="_this.shouldDisplaySpam()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="spam"\n\t\t\t\tremit:click="spam"\n\t\t\t\tevent:details="{model: message, parentThread: _this.getParentThread()}"\n\t\t\t\tradar-id="spam"\n\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="spam-on">\n\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Спам\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.isSpam() && !attrs.deselectAll && !folder.isShareTake()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="unspam"\n\t\t\t\tremit:click="unspam"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="unspam"\n\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="spam-off">\n\t\t\t\t\t<b:ico name="spam-off" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Не спам\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tqa:id="move"\n\t\t\tid="move-to"\n\t\t\tremit:click.stop.prevent="click:move"\n\t\t\tradar-id="move"\n\t\t\tnested\n\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t>\n\t\t\t<span bem:elem="ico">\n\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Переместить в папку\')}</span>\n\t\t\t<span bem:elem="nested">\n\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<fn:if test="!message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:unread"\n\t\t\t\tremit:click="mark:unreaded"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="unread"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить непрочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:read"\n\t\t\t\tremit:click="mark:readed"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="read"\n\n\t\t\t\tdata-shortcut="q"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t<b:ico name="status_read" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить прочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!message.is(\'flags.flagged\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:flagged"\n\t\t\t\tremit:click="mark:flagged"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="flag"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="flag">\n\t\t\t\t\t<b:ico name="actions:favorite_on" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить флажком\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.is(\'flags.flagged\') && _this.isEnableMark()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:unflagged"\n\t\t\t\tremit:click="mark:unflagged"\n\t\t\t\tevent:details="{model: message}"\n\t\t\t\tradar-id="unflag"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unflag">\n\t\t\t\t\t<b:ico name="actions:favorite_off" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Снять флажок\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs.deselectAll && _this.isShowCallsButton()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="calls:invite"\n\n\t\t\t\tremit:click="calls:invite"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="calls-invite"\n\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Предложить звонок\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs.deselectAll && _this.isShowCallendarButton()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="create:calendar-event"\n\t\t\t\tremit:click="calendar:create"\n\t\t\t\tevent:details="{model:message, createContent:\'web_email_letter_context_menu\'}"\n\t\t\t\tradar-id="calendar-create"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="calendar-month" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Создать событие\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.shouldDisplayFilter()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="create:filter"\n\t\t\t\tremit:click="settingsfilters:create"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="filter-create"\n\n\t\t\t\tdisabled="{!_this.isEnableFilterCreate()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="filter">\n\t\t\t\t\t<b:ico name="actions:filter" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Создать фильтр\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<fn:if test="_this.shouldDisplaySearch()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="search:from"\n\t\t\t\tremit:click="search:from"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="search"\n\t\t\t>\n\t\t\t\t<bem:mod name="disabled" test="attrs.isSearchDisabled"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="search" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Найти все письма\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-message/contextmenu-message.html")});define("feast-tpl!ui-block/contextmenu-message/contextmenu-message.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-message/contextmenu-message.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu/contextmenu-abstract",["require","exports","@mail/smokescreen","helpers/folder","mail/Folder","service/smokescreen"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.withWelterContextMenu=exports.isEnableFilterCreate=exports.isEnableMove=exports.isRemoveVisible=exports.isEnableRemove=exports.isEnableMoveToArchive=exports.isEnableMoveToSpam=exports.isEnableMark=exports.checkFolderGrant=exports.isContainedInMetaThread=exports.hasSelectButton=void 0;a=__importDefault(a);c=__importDefault(c);function e(){var a=this.get("selectable");return a&&!this.isContainedInMetaThread()}exports.hasSelectButton=e;function f(){var a=this.get("router");var b=a&&a.model&&a.model.folder;var c=this.get("model");var d=c&&c.getFolder();return d!==b}exports.isContainedInMetaThread=f;function g(a){var b=this.get("model");return b.checkGrant(a)}exports.checkFolderGrant=g;function h(){return this.checkFolderGrant(c.default.SHARE_GRANTS.mark_as_important)}exports.isEnableMark=h;function i(){return this.checkFolderGrant(c.default.SHARE_GRANTS.move_to_spam)}exports.isEnableMoveToSpam=i;function j(){return this.checkFolderGrant(c.default.SHARE_GRANTS.move_to_archive)}exports.isEnableMoveToArchive=j;function k(){return this.checkFolderGrant(c.default.SHARE_GRANTS.remove)}exports.isEnableRemove=k;function l(){return!b.isDeleteFromFolderDisabled(this.get("model").getFolder())}exports.isRemoveVisible=l;function m(){return this.checkFolderGrant(c.default.SHARE_GRANTS.move)}exports.isEnableMove=m;function n(){var a=this.get("model");var b=a.getFolder();return!b.isShareTake()}exports.isEnableFilterCreate=n;exports.withWelterContextMenu=a.default.createWelterDecorator(function(a){return __assign({},a)},d.withWelter)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-message/contextmenu-message",["require","exports","default-values","feast","feast-tpl!./contextmenu-message.html","mail/Folder","mail/Thread","service/layer","service/submenu","ui-block/contextmenu/contextmenu-abstract","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);exports.default=b.default.Block.extend(h.withWelterContextMenu({name:"contextmenu-message",template:c.default,blocks:{list:i.default,"list-item":j.default},events:{"click:move":"onClickMove"},defaults:{type:"message",model:null,selectable:true,"archive-disabled":a.ARCHIVE_DISABLED,"invite-call":a.CALLS&&!a.CALLS_DISABLE_LETTER_CALL},hasSelectButton:h.hasSelectButton,isContainedInMetaThread:h.isContainedInMetaThread,checkFolderGrant:h.checkFolderGrant,isEnableMark:h.isEnableMark,isEnableMoveToSpam:h.isEnableMoveToSpam,isEnableMoveToArchive:h.isEnableMoveToArchive,isEnableRemove:h.isEnableRemove,isEnableMove:h.isEnableMove,isEnableFilterCreate:h.isEnableFilterCreate,isRemoveVisible:h.isRemoveVisible,didMount:function(){var a=this;require(["mediator/letters-actions","mediator/letters-selection","mediator/settings-filters-manager","mediator/calendar-manager","mediator/calls-manager","mediator/layout-manager"],function(b,c,d,e,f,g){var h=b.default;var i=c.default;var j=d.default;var k=e.default;var l=f.default;var m=g.default;h.register(a);i.register(a);j.register(a);k.register(a);l.register(a);m.register(a)});var b=this.get("model");if(b&&b.hasOwnProperty("folders")){this.set("folders",b.folders)}if(b&&b.hasOwnProperty("selectable")){this.set("selectable",b.selectable)}},isNewTabAvailable:function(){return!a.USE_SINGLE_TAB&&this.get("model")instanceof e.default},isShowCallendarButton:function(){var b=this.get("model");var c=a.FEATURE_UNSUBSCRIBE&&b&&b.get("flags.newsletter")&&a.DISABLE_LETTER_CALENDAR_NEWSLETTERS;return!this.is("disable-create-event")&&!c},isShowCallsButton:function(){var b=this.get("model");var c=a.FEATURE_UNSUBSCRIBE&&b&&b.get("flags.newsletter")&&a.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS;return this.is("invite-call")&&!c},getParentThread:function(){var a=this.get("extraDetails");return a===null||a===void 0?void 0:a.parentThread},onClickMove:function(){var a=this.ids["move-to"];var b={folders:this.get("folders"),model:this.get("model"),parentThread:this.getParentThread()};if(this.is("mobile")){f.default.open("move-to-folder",b,{dimmer:true,mobile:true,resolvable:false})}else{g.default.open("moveto-folder",b,a)}a.set("selected",true)},isEnableCall:function(){return this.checkFolderGrant(d.default.SHARE_GRANTS.reply)},shouldDisplayFilter:function(){return!a.FORBID_FILTERS&&!this.get("deselectAll")&&!this.is("mobile")},shouldDisplaySearch:function(){return!this.is("mobile")},shouldDisplaySpam:function(){var b=this.get("model").getFolder();return!a.FORBID_SPAM&&!b.isSpam()&&!this.get("deselectAll")}}))});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{message && message.getFolder()}"/>\n\n\t<b:list>\n\t\t<fn:if test="_this.isNewTabAvailable()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="newtab"\n\t\t\t\tremit:click="metathreadnewtab"\n\t\t\t\tradar-id="newtab"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t</b:list-item>\n\n\t\t\t<div bem:elem="hr" />\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t<b:list-item\n\t\t\t\tremit:click="remove"\n\t\t\t\tqa:id="remove"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="remove"\n\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tqa:id="archive"\n\t\t\tremit:click="archive"\n\t\t\tevent:details="{model:message}"\n\t\t\tradar-id="archive"\n\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\n\t\t\tfn:if="!folder.isArchive() && !attrs[\'archive-disabled\']"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="archive">\n\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'В архив\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="move"\n\t\t\tid="move-to"\n\t\t\tremit:click.stop.prevent="click:move"\n\t\t\tradar-id="move"\n\t\t\tnested\n\t\t>\n\t\t\t<span bem:elem="ico">\n\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Переместить в папку\')}</span>\n\t\t\t<span bem:elem="nested">\n\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<fn:if test="!message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:unread"\n\t\t\t\tremit:click="metathreadtogglestatus:unread"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="unread"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить непрочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:read"\n\t\t\t\tremit:click="metathreadtogglestatus:unread"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="read"\n\n\t\t\t\tdata-shortcut="q"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить прочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html")});define("feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-metathread/contextmenu-metathread",["require","exports","default-values","feast","feast-tpl!./contextmenu-metathread.html","helpers/folder","helpers/opener","mail/Folder","mail/Thread","service/submenu","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.default=b.default.Block.extend({name:"contextmenu-metathread",template:c.default,blocks:{list:i.default,"list-item":j.default},events:{metathreadnewtab:"onNewtab","click:move":"onClickMove"},defaults:{type:"metathread",model:null,"archive-disabled":a.ARCHIVE_DISABLED},didMount:function(){var a=this;require(["mediator/letters-actions","mediator/letters-selection","mediator/settings-filters-manager","mediator/calendar-manager"],function(b,c,d,e){var f=b.default;var g=c.default;var h=d.default;var i=e.default;f.register(a);g.register(a);h.register(a);i.register(a)});var b=this.get("model");if(b&&b.folders){this.set("folders",b.folders)}},onNewtab:function(a){a.preventDefault();var b=this.get("router");var c=this.get("model");var d=b.getUrl("#letters",{folder:c.get("metathread_data.folder")});e.default(d)},isNewTabAvailable:function(){return!a.USE_SINGLE_TAB&&this.get("model")instanceof g.default},onClickMove:function(){var a=this.ids["move-to"];var b={folders:this.get("folders"),model:this.get("model"),selectedMetathreads:true};h.default.open("moveto-folder",b,a);a.set("selected",true)},isEnableMoveToArchive:function(){var a=this.get("model");var b=a.get("metathread_data.folder");return b.checkGrant(f.default.SHARE_GRANTS.move_to_archive)},isEnableRemove:function(){var a=this.get("model");var b=a.get("metathread_data.folder");return b.checkGrant(f.default.SHARE_GRANTS.remove)},isRemoveVisible:function(){return!d.isDeleteFromFolderDisabled(this.get("model").get("metathread_data.folder"))}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="folder" value="{attrs.model && attrs.model.getFolder()}"/>\n\t<fn:var name="stats" value="{_this.getSelectedStats()}"/>\n\n\t<b:list>\n\t\t\x3c!-- Выделить все письма --\x3e\n\t\t<fn:if test="_this.hasSelectButton() && attrs.selectable">\n\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="select:all"\n\t\t\t\t\tremit:click="select:all"\n\t\t\t\t\tradar-id="select-all"\n\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\']"\n\t\t\t\t\tnested\n\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Выделить все письма\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-select:all"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="select:drop"\n\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\tradar-id="deselect"\n\t\t\t\t\tfn:if="attrs[\'if-folder-selected\']"\n\t\t\t\t\tnested\n\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Снять выделение\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-select:drop"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\n\t\t\t<div bem:elem="hr"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="remove"\n\t\t\t\t\tremit:click="remove"\n\t\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\t\tradar-id="remove"\n\t\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-remove"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!folder.isArchive() && !attrs[\'archive-disabled\'] && (!stats || stats.noarchive)">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="archive"\n\t\t\t\t\tremit:click="archive"\n\t\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\t\tradar-id="archive"\n\t\t\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="archive">\n\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'В архив\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-archive"\n\t\t\t\t\t> {stats.all} </span>\n\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.shouldDisplaySpam(stats)">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="spam"\n\t\t\t\t\tremit:click="spam"\n\t\t\t\t\tevent:details="{model:attrs.selected}"\n\t\t\t\t\tradar-id="spam"\n\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t\t<span bem:elem="ico" bem:mod="spam-on">\n\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Спам\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\'] && !stats.metathread"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-spam"\n\t\t\t\t\t> {stats.nospam} </span>\n\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.isSpam() && !folder.isShareTake() && (!stats || !attrs[\'if-folder-selected\'])">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="unspam"\n\t\t\t\t\tremit:click="unspam"\n\t\t\t\t\tevent:details="{model:attrs.selected}"\n\t\t\t\t\tradar-id="unspam"\n\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="spam-off">\n\t\t\t\t\t<b:ico name="spam-off" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Не спам\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\'] && !stats.metathread"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-unspam"\n\t\t\t\t\t> {stats.spam} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="move"\n\t\t\t\tid="move-to"\n\t\t\t\tremit:click.stop.prevent="click:move"\n\t\t\t\tevent:details="{selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="move"\n\t\t\t\tnested\n\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t>\n\t\t\t<span bem:elem="ico">\n\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Переместить в папку\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-click:move"\n\t\t\t\t> {stats.all} </span>\n\n\t\t\t</span>\n\t\t\t<span bem:elem="nested">\n\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:unread"\n\t\t\t\tremit:click="mark:unreaded"\n\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="unread"\n\t\t\t\tfn:if="!stats || stats.read > 0"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Пометить непрочитанным\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-mark:unread"\n\t\t\t\t> {stats.read} </span>\n\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:read"\n\t\t\t\tremit:click="mark:readed"\n\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="read"\n\t\t\t\tdata-shortcut="q"\n\n\t\t\t\tfn:if="!stats || stats.unread > 0"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Пометить прочитанным\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-mark:read"\n\t\t\t\t> {stats.unread} </span>\n\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:flagged"\n\t\t\t\tremit:click="mark:flagged"\n\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="flag"\n\n\t\t\t\tfn:if="!stats || stats.noflagged > 0"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="flag">\n\t\t\t\t\t<b:ico name="actions:favorite_on" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Пометить флажком\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-mark:flagged"\n\t\t\t\t> {stats.noflagged} </span>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:unflagged"\n\t\t\t\tremit:click="mark:unflagged"\n\t\t\t\tevent:details="{model: attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="unflag"\n\n\t\t\t\tfn:if="!stats || stats.flagged > 0"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unflag">\n\t\t\t\t\t<b:ico name="actions:favorite_off" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Снять флажок\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-mark:unflagged"\n\t\t\t\t\t> {stats.flagged} </span>\n\t\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="_this.shouldDisplayFilter(stats)">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="create:filter"\n\t\t\t\t\tremit:click="settingsfilters:create"\n\t\t\t\t\tevent:details="{model:attrs.selected}"\n\t\t\t\t\tradar-id="filter-create"\n\n\t\t\t\t\tdisabled="{!_this._isEnableFilterCreate()}"\n\t\t\t>\n\t\t\t\t<bem:mod name="disabled" test="attrs[\'if-folder-selected\'] || stats.metathread"/>\n\t\t\t\t<span bem:elem="ico" bem:mod="filter">\n\t\t\t\t\t<b:ico name="actions:filter" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Создать фильтр\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\'] && !stats.metathread"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-create:filter"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html")});define("feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-selected-stats",["require","exports","mail/Folder","models/metathread/metathread"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);function c(c,e){if(!c){return}var f=c.filter(function(a){return a.getFolder&&!b.default.isMetathreadFooter(a)});var g={all:0,unread:0,read:0,flagged:0,noflagged:0,spam:0,nospam:0,noarchive:0,metathread:0,fromTrustedMailer:0};f.forEach(function(b){var c=b.getFolder();if(b.get("flags.metathread")){var f=b.get("metathread_data.folder");c=a.default.get(f);d(g,c);g.metathread++}else if(!e){b.is("flags.unread")?g.unread++:g.read++;b.is("flags.flagged")?g.flagged++:g.noflagged++;g.all++;if(b.is("flags.newsletter")&&b.is("flags.show_definitely_spam")&&b.is("flags.have_unsubscribe_list")){g.fromTrustedMailer++}}c.isSpam()?g.spam++:g.nospam++;!c.isArchive()&&g.noarchive++});if(e){d(g,e)}return g}exports.default=c;function d(a,b){a.unread+=b.get("messages_unread");a.read+=b.get("messages_total")-b.get("messages_unread");a.flagged+=b.get("messages_flagged");a.noflagged+=b.get("messages_total")-b.get("messages_flagged");a.all+=b.get("messages_total")}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-selection/contextmenu-selection",["require","exports","default-values","feast","feast-tpl!./contextmenu-selection.html","helpers/get-selected-stats","service/submenu","ui-block/contextmenu/contextmenu-abstract","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);exports.default=b.default.Block.extend(f.withWelterContextMenu({name:"contextmenu-selection",template:c.default,blocks:{list:g.default,"list-item":h.default},events:{"click:move":"onClickMove"},defaults:{type:"selection",model:null,selectable:true,"archive-disabled":a.ARCHIVE_DISABLED},hasSelectButton:f.hasSelectButton,isContainedInMetaThread:f.isContainedInMetaThread,checkFolderGrant:f.checkFolderGrant,isEnableMark:f.isEnableMark,isEnableMoveToSpam:f.isEnableMoveToSpam,isEnableMoveToArchive:f.isEnableMoveToArchive,isEnableRemove:f.isEnableRemove,isEnableMove:f.isEnableMove,isEnableFilterCreate:f.isEnableFilterCreate,isRemoveVisible:f.isRemoveVisible,didMount:function(){var a=this;require(["mediator/letters-actions","mediator/letters-selection","mediator/settings-filters-manager"],function(b,c,d){var e=b.default;var f=c.default;var g=d.default;if(a.isMounted()){e.register(a);f.register(a);g.register(a)}});var b=this.get("model");if(b&&b.get("selectable")){this.set("selectable",b.get("selectable"))}},getSelectedStats:function(){return d.default(this.get("selected"),this.get("selected-folder"))},onClickMove:function(){var a=this.ids["move-to"];var b=this.get("model");var c=[];if(b&&b.hasOwnProperty("folders")){c=b.folders}var d={folders:c,model:this.get("selected"),lettersFoldersIds:this.get("letters-folders-ids"),selectedMetathreads:this.get("selected-metathreads"),selection:this.get("if-folder-selected")};e.default.open("moveto-folder",d,a);a.set("selected",true)},shouldDisplayFilter:function(b){return!a.FORBID_FILTERS&&!this.get("if-folder-selected")&&(!b||!b.metathread)},shouldDisplaySpam:function(b){return!a.FORBID_SPAM&&!this.get("model").getFolder().isSpam()&&!this.get("if-folder-selected")&&(!b||!b.metathread)}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu/contextmenu",["require","exports","default-values","feast","feast-tpl!./contextmenu.html","lazy.modules","mail/Folder","mail/Message","mail/Thread","service/radars/decorator","service/smokescreen","service/submenu","ui-block/contextmenu-correspondent/contextmenu-correspondent","ui-block/contextmenu-correspondents/contextmenu-correspondents","ui-block/contextmenu-folder/contextmenu-folder","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-metathread/contextmenu-metathread","ui-block/contextmenu-selection/contextmenu-selection"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);var q={thread:n.default,letter:n.default,selection:p.default,folder:m.default,metathread:o.default,correspondent:k.default,correspondents:l.default};var r=document.getElementsByClassName(i.default.lookup("scrollable"));exports.default=b.default.Block.extend(h.default({id:function(a){var b;return"contextmenu-"+((b=a===null||a===void 0?void 0:a.block)===null||b===void 0?void 0:b.get("type"))},explicit:true})({name:"contextmenu",template:c.default,blocks:{},events:{"menu-toggle":"onMenuClick"},defaults:{type:"",expanded:false,x:0,y:0},notVisualAttributes:{type:true},attrChanged:{expanded:function(a){var b=this;this[a?"$on":"$off"](this.el.ownerDocument,"click","handleOutside");this[a?"$on":"$off"](this.el.ownerDocument.defaultView,"resize","handleOutside");this[a?"$on":"$off"](this.el.ownerDocument.defaultView,"blur","handleOutside");[].forEach.call(r,function(c){b[a?"$one":"$off"](c,"scroll","handleOutside")});if(!a){j.default.close()}}},didMount:function(){var a=this;require(["mediator/letters-selection"],function(b){var c=b.default;if(a.isMounted()){c.register(a)}});this.onEscape=function(b){b.stopImmediatePropagation();a.hide()}},didUnmount:function(){this.destroyBlock()},onContextmenu:function(a,b){a.preventDefault();this.createMenu(a,b);this.setCoordinates(a);this.show()},setCoordinates:function(a){var b=a.originalEvent;var c=this.refs.block;var d=4;var e=8;var f=b.clientX;var g=b.clientY;var h=window.innerWidth;var i=window.innerHeight;var j=c.offsetWidth;var k=c.offsetHeight;var l=h-f-e-d>j;var m=f-e-d>j;var n=i-g>k;var o;var p;if(l){o=f+d}else if(m){o=f-j-d}else{o=h-j-e}if(n){p=g}else{p=g-(k-(i-g))}this.set({x:o,y:p})},createMenu:function(a,b){var c=this.getEventType(a);var d=q[c];var e=this.get("type");if(!d){return}if(c===e){this.block.set({model:a.details,extraDetails:b});return}this.destroyBlock();var f="default"in d&&"blockName"in d.default&&"render"in d.default?d.default:d;var g=new f({model:a.details,router:this.get("router"),extraDetails:b},this.getChildContext());this.block=g;g.renderTo(this.refs.block)},show:function(){var a=this;this.set("expanded",false);Promise.resolve(this.block.onShow&&this.block.onShow()).then(function(){a.set("expanded",true);a.radar("show");d.lazyMailKeymaster().then(d.uniqCallback(a,function(b){b("escape",a.onEscape)}))})},hide:function(){this.set("expanded",false);this.onHide()},setStyle:function(){return"left: "+this.get("x")+"px;top: "+this.get("y")+"px"},handleOutside:function(a){if(a&&a.button===2&&a.type!=="contextmenu"){a.preventDefault();return}if(a.target.window){this.hide();return}if(!this.el.contains(a.target)){this.hide()}},getBlock:function(){return this.block},destroyBlock:function(){if(!this.block){return}this.block.onDestroy&&this.block.onDestroy();this.block.destroy();this.set("type","");this.block=null;this.refs.block.innerHTML="";j.default.destroy()},getEventType:function(a){var b=a.details;var c="";if(!b){return c}if(b instanceof e.default){c="folder"}if(b instanceof f.default){c="letter"}if(b instanceof g.default){c="thread"}if(String(b.id).match("multithreadFixId")){c="metathread"}if(b.type==="correspondent"){c="correspondent"}if(b.type==="correspondents"){c="correspondents"}if(this.checkIfSelection(b)){c="selection"}return c},checkIfSelection:function(b){var c=this.isSelectedMatchToClicked(b);return a.ENABLE_ACTION_OVER_SELECTED&&b&&b.isLetterSelected&&!c},isSelectedMatchToClicked:function(a){var b=this.get("selected-map");var c=this.get("selected-length");return b[a.id]&&c===1},onHide:function(){var a=this;if(!this.block){return}this.block.onBeforeHide&&this.block.onBeforeHide();d.lazyMailKeymaster().then(d.uniqCallback(this,function(b){b.unbind("escape",a.onEscape)}))},onMenuClick:function(a){if(!a.isDefaultPrevented()||this.is("expanded")){a.preventDefault();this.hide()}}}))});define("feast-tpl!app/feast-tpl!ui-block/counters/counters.html",["feast"],function(a){return a.smartParse('<div style="position: absolute; left: -100000px; top: -100000px;">\n\t<fn:if test="attrs.vkcid">\n\t\t<script type="text/javascript">\n\t\t\tvar _tmr = _tmr || [];\n\t\t\t_tmr.push({\n\t\t\t\ttype: \'setUserParams\',\n\t\t\t\tparams: {\n\t\t\t\t\tVKConnectID: {attrs.vkcid}\n\t\t\t\t}\n\t\t\t});\n\t\t<\/script>\n\t</fn:if>\n\t<div ref="counter-tns"/>\n\t<div ref="counter-li"/>\n\t<div ref="counter-top"/>\n\t<div ref="counter-top-hit"/>\n</div>\n',"app/feast-tpl!ui-block/counters/counters.html")});define("feast-tpl!ui-block/counters/counters.html",["feast-tpl!app/feast-tpl!ui-block/counters/counters.html"],function(a){return a});define("ui-block/counters/counters",["exports","@mail/adman","cfgUser","feast","feast-tpl!./counters.html"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"counters",template:h.default,blocks:{},defaults:{vkcid:f.default.get("initialUser.vkc_user_id")},getPlacements:function a(){return["counter-tns","counter-li","counter-top","counter-top-hit"].map(function(a){return e.default.placement(a)})},didMount:function a(){var b=this;this.getPlacements().forEach(function(a){if(a){a.attachToContainer(b.refs[a.name]).wakeUp()}})},didUnmount:function a(){this.getPlacements().forEach(function(a){if(a){a.sleep()}})}})});define("feast-tpl!app/feast-tpl!ui-block/dimmer/dimmer.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="color" value="{attrs.color}" test="attrs.color"/>\n</div>\n',"app/feast-tpl!ui-block/dimmer/dimmer.html")});define("feast-tpl!ui-block/dimmer/dimmer.html",["feast-tpl!app/feast-tpl!ui-block/dimmer/dimmer.html"],function(a){return a});define("ui-block/dimmer/dimmer",["exports","feast","feast-tpl!./dimmer.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"dimmer",template:d.default,blocks:{},defaults:{color:""}})});define("feast-tpl!app/feast-tpl!ui-block/download-frame/download-frame.html",["feast"],function(a){return a.smartParse('<iframe name="{attrs.name}"/>\n',"app/feast-tpl!ui-block/download-frame/download-frame.html")});define("feast-tpl!ui-block/download-frame/download-frame.html",["feast-tpl!app/feast-tpl!ui-block/download-frame/download-frame.html"],function(a){return a});define("ui-block/download-frame/download-frame",["exports","feast","feast-tpl!./download-frame.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DOWNLOAD_IFRAME_NAME=undefined;var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=exports.DOWNLOAD_IFRAME_NAME="download-frame";exports.default=c.default.Block.extend({name:"download-frame",template:d.default,blocks:{},defaults:{name:f}})});define("feast-tpl!app/feast-tpl!ui-block/layer-window/layer-window.html",["feast"],function(a){return a.smartParse('<div use:mediator="layout-manager">\n\t<fn:var name="hideHeadline" value="{attrs[\'hide-headline\']}" />\n\n\t<bem:mod name="hidden" test="!attrs.active"/>\n\x3c!-- Выглядит так, что это с точки зрения текущего дизайна только лишнее FMAIL-15984 --\x3e\n\x3c!--\t<bem:mod name="mobile-full" test="attrs.mobile && !attrs.compact"/>--\x3e\n\t<bem:mod name="mobile-compact" test="attrs.mobile && !!attrs.compact"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t\x3c!-- Потому что на планшетах нам не нужен "мобильный" вид, используем десктопный. Но z-index надо переписать --\x3e\n\t<bem:mod name="foreground" test="attrs.foreground"/>\n\n\t\x3c!-- Затемнение на заднем фоне --\x3e\n\t<div bem:elem="dimmer">\n\t\t<b:dimmer\n\t\t\tfn:if="attrs.dimmer && attrs.active"\n\t\t\tcolor="{attrs[\'dimmer-color\']}"\n\t\t/>\n\t</div>\n\n\t\x3c!-- Контейнер, чтобы dimmer не попадал в скролл, он же ловит клики "как бы" по диммеру --\x3e\n\t<div bem:elem="container" remit:click="dimmer:click" ref="container">\n\t\t<bem:mod name="silent" test="attrs.silent"/>\n\t\t<bem:mod name="hide-headline" test="hideHeadline"/>\n\t\t\x3c!-- Дополнительные отступы --\x3e\n\t\t<div bem:elem="spacer" fn:if="!attrs.mobile">\n\t\t\t<bem:mod name="hide-headline" test="hideHeadline"/>\n\t\t</div>\n\n\t\t\x3c!-- Место рендера блока --\x3e\n\t\t<div bem:elem="block" ref="block" qa:id="layer-window-block"/>\n\n\t\t\x3c!-- Место показа нотификаций поверх лейера --\x3e\n\t\t<b:notify-stack id="notify-stack" fixed/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/layer-window/layer-window.html")});define("feast-tpl!ui-block/layer-window/layer-window.html",["feast-tpl!app/feast-tpl!ui-block/layer-window/layer-window.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/notify-stack/notify-stack.html",["feast"],function(a){return a.smartParse('<div qa:id="notify">\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="fixed" test="attrs.fixed"/>\n\n    <fn:add-class name="slide-in" test="attrs.animated"/>\n\n\t<fn:if test="attrs.items">\n\t\t<fn:for data="attrs.items" as="data">\n\t\t\t<fn:if test="data">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.item">\n\t\t\t\t\t\t<div key="notify-{data[\'_key\']}" ref="{data[\'_key\']}" style="margin: 8px 0;"/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:notify\n\t\t\t\t\t\t\t\tkey="notify-{data[\'_key\']}"\n\t\t\t\t\t\t\t\tref="{data[\'_key\']}"\n\t\t\t\t\t\t\t\ttype="{data.type}"\n\t\t\t\t\t\t\t\ttext="{data.text}"\n\t\t\t\t\t\t\t\tsecondary-text="{data.secondaryText}"\n\t\t\t\t\t\t\t\ticon="{data.icon}"\n\t\t\t\t\t\t\t\ticon-size="{data.iconSize}"\n\t\t\t\t\t\t\t\tqa:id="{data.qa}"\n\t\t\t\t\t\t\t\tduration="{data.duration}"\n\t\t\t\t\t\t\t\tactions="{data.actions}"\n\t\t\t\t\t\t\t\tsecondary-actions="{data.secondaryActions}"\n\t\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\t\tinline="{data.inline}"\n\t\t\t\t\t\t\t\tdirection="{data.direction}"\n\t\t\t\t\t\t\t\tshortcut="{data.shortcut}"\n\t\t\t\t\t\t\t\tanimated\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</fn:for>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/notify-stack/notify-stack.html")});define("feast-tpl!ui-block/notify-stack/notify-stack.html",["feast-tpl!app/feast-tpl!ui-block/notify-stack/notify-stack.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/notify/notify.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="type" value="{attrs.type}" test="attrs.type"/>\n\t<bem:mod name="inline" test="attrs.inline"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="direction" value="{attrs.direction}" test="attrs.direction"/>\n\t<bem:mod name="hasntactions" test="!attrs.actions || !attrs.actions.length"/>\n\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t<fn:var name="secondaryActions" value="{attrs[\'secondary-actions\']}"/>\n\t<fn:var name="hasSecondaryActions" value="{secondaryActions && secondaryActions.length}"/>\n\t<fn:var name="multiline" value="{!!attrs[\'secondary-text\'] || hasSecondaryActions}"/>\n\n\t<fn:if test="!attrs.closed" animated>\n\t\t<div bem:elem="body">\n\t\t\t<div\n\t\t\t\tbem:elem="icon"\n\t\t\t\tfn:if="attrs.icon"\n\t\t\t>\n\t\t\t\t<b:ico name="{attrs.icon}" size="{attrs[\'icon-size\'] || \'s\'}"/>\n\t\t\t</div>\n\t\t\t<div bem:elem="content">\n\t\t\t\t<span bem:elem="message">\n\t\t\t\t\t<span bem:elem="message__text" qa:id="message">\n\t\t\t\t\t\t\x3c!--<bem:mod name="center" test="attrs.touch && !hasAction"/>--\x3e\n\t\t\t\t\t\t<fn:value>attrs.text</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="actions">\n\t\t\t\t\t<span bem:elem="actions-sub">\n\t\t\t\t\t\t<fn:for data="attrs.actions" test="attrs.actions" as="item"\n\t\t\t\t\t\t\t\tkey="index">\n\t\t\t\t\t\t\t<a bem:elem="action" remit:click="action" qa:id="action"\n\t\t\t\t\t\t\t   event:details="item.event"\n\t\t\t\t\t\t\t   key="{index}">\n\t\t\t\t\t\t\t\t<fn:if test="item.link">\n\t\t\t\t\t\t\t\t\t<fn:attr name="href" value="{item.link}"/>\n\t\t\t\t\t\t\t\t\t<fn:attr name="target" value="_blank"/>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t<span bem:elem="{item.text}" qa:id="action-text">\n\t\t\t\t\t\t\t\t<fn:value>item.text</fn:value>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</fn:for>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="secondary"\n\t\t\t\t\tfn:if="attrs[\'secondary-text\'] && !hasSecondaryActions"\n\t\t\t\t>\n\t\t\t\t\t{attrs[\'secondary-text\']}\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="secondary"\n\t\t\t\t\tfn:if="hasSecondaryActions"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="actions">\n\t\t\t\t\t\t<span bem:elem="actions-sub">\n\t\t\t\t\t\t\t<fn:for data="secondaryActions"\n\t\t\t\t\t\t\t\t\ttest="hasSecondaryActions"\n\t\t\t\t\t\t\t\t\tas="item"\n\t\t\t\t\t\t\t\t\tkey="index"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<a bem:elem="action"\n\t\t\t\t\t\t\t\t   remit:click="action:secondary"\n\t\t\t\t\t\t\t\t   qa:id="action:secondary:{index}"\n\t\t\t\t\t\t\t\t   event:details="item.event"\n\t\t\t\t\t\t\t\t   key="{index}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:if test="item.link">\n\t\t\t\t\t\t\t\t\t\t<fn:attr name="href" value="{item.link}"/>\n\t\t\t\t\t\t\t\t\t\t<fn:attr name="target" value="_blank"/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t<span bem:elem="{item.text}" qa:id="secondary-action-text">\n\t\t\t\t\t\t\t\t\t\t{item.text}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</fn:for>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<fn:if test="!attrs[\'hide-close-button\']">\n\t\t\t\t<div bem:elem="ico-close">\n\t\t\t\t\t<bem:mod name="multiline" test="multiline"/>\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\tico="actions:close"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\tremit:click="notify-close"\n\t\t\t\t\t\t\tcentered\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/notify/notify.html")});define("feast-tpl!ui-block/notify/notify.html",["feast-tpl!app/feast-tpl!ui-block/notify/notify.html"],function(a){return a});define("ui-block/notify/notify",["exports","default-values","feast","feast-tpl!./notify.html","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(b);var g=j(c);var h=j(d);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend({name:"notify",template:g.default,isolateEvents:false,blocks:{button2:h.default,ico:i.default},events:{"notify-close":"close"},defaults:{duration:0,closed:false,"hide-close-button":a.HIDE_NOTIFY_CLOSE_BUTTON},didMount:function a(){this.delay()},delay:function a(){var b=this;window.clearTimeout(this._id);var c=this.get("duration");if(c){this._id=setTimeout(function(){return b.close()},c*1e3)}},close:function a(){window.clearTimeout(this._id);if(this.destroyed||this.get("closed")){return}this.set("closed",true);this.broadcast("closed")}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/notify-stack/notify-stack",["require","exports","feast","feast-tpl!./notify-stack.html","ui-block/notify/notify"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=400;window.__notifyDebugList=[];exports.default=a.default.Block.extend({name:"notify-stack",_notifyKey:0,blocks:{notify:c.default},events:{closed:"handleClose"},defaults:{items:null,animated:false},attrChanged:{animated:function(a){var b=this;clearTimeout(this._animatedTimeout);if(a){this._animatedTimeout=setTimeout(function(){return b.set("animated",false)},d)}}},template:b.default,activeByContent:{},didMount:function(){this.set("items",__spreadArrays(this.get("items")||[]),true)},handleClose:function(a){var b=this;setTimeout(function(){return b.remove(a.details)},d);return false},add:function(b){var c=this;if(!this.isMounted()){return}var d=++this._notifyKey;var e=Object.assign({},b,{_key:d});var f=Object.assign({},e);if(window.__notifyDebugList.length>500){window.__notifyDebugList=[]}window.__notifyDebugList.push(f);var g=e.unique,h=e.onTop,i=h===void 0?false:h;var j=g&&this.getContentId(e);var k=[].concat(this.get("items")||[]);if(g){var l=this.activeByContent[j];if(l){return l}}if(i){k.unshift(e)}else{k.push(e)}e.idx=d;this.set({animated:true,items:k});if(e.item){e.item.renderComponentToNode(this.refs[d]);e.item.props.onDestroy=function(){c.remove(e)}}else{var m=a.default.Block.get(this.refs[d]);if(!m){return}m.idx=d;if(g){this.activeByContent[j]=m}return m}},remove:function(a){if(!this.isMounted()){return}var b=a.idx||a;if(b){var c=[].concat(this.get("items"));var d=c.findIndex(function(a){return a.idx===b});if(d<0){return}var e=this.getContentId(c[d]);delete this.activeByContent[e];c.splice(d,1);this.set("items",c)}},getContentId:function(a){return a.type+":"+a.text},setData:function(a,b){if(!this.isMounted()){return}var c=[].concat(this.get("items"));var d=c.findIndex(function(b){return b.idx===a});if(d<0){return}c[d]=__assign(__assign({},c[d]),b);this.set({items:c})}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-window/layer-window",["require","exports","default-values","feast","feast-tpl!./layer-window.html","lazy.modules","service/adv/index","service/notify","service/radars/index","ui-block/dimmer/dimmer","ui-block/notify-stack/notify-stack"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importStar(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var j=function(){e.default.wakeUp.apply(e.default,e.SLOTS_EXCEPT_SENT);e.default.updateOnAction()};exports.default=b.default.Block.extend({name:"layer-window",template:c.default,isolateEvents:false,_layerKey:0,blocks:{dimmer:h.default,"notify-stack":i.default},events:{"dimmer:click":"onDimmerClick"},defaults:{active:false,"close-on-dimmer":true,"close-on-esc":true,compact:false,dimmer:false,silent:false,"dimmer-color":"",fullscreen:false,mobile:false,foreground:a.TOUCH_MODE,"reject-on-close":false,"reject-on-dimmer":false,resolvable:false,"hide-headline":false},attrChanged:{"close-on-esc":function(a){d.lazyMailKeymaster().then(d.uniqCallback(this,function(b){b.setScope(a?"all":"layer-no-shortcuts")}))},mobile:function(a){if(!this.block){return}if(this.block.is("responsive")){this.block.set("mobile",a);return}a?this.hide():this.show()},slim:function(a){if(!this.block){return}this.block.set("slim",a)},active:function(a){var b=this;d.lazyMailKeymaster().then(d.uniqCallback(this,function(c){if(a&&b.is("close-on-esc")||a&&b.is("reject-on-dimmer")){c("escape",b.onEscape)}else{c.unbind("escape",b.onEscape)}}))}},didMount:function(){var a=this;f.default.setup(this.ids["notify-stack"],"layer-window");require(["mediator/layout-manager"],function(b){var c=b.default;c.register(a)});this.onEscape=function(b){b.stopImmediatePropagation();a.onHide("escape")}},setLayer:function(a,c){var d=b.default.Mediator.getAll();d.forEach(function(b){b.registerComponent(a.prototype.name,a)});var e=new a(__assign(__assign({},c),{mobile:this.is("mobile"),slim:this.is("slim")}));var f=this.getBlockPromise(e);e.on("layer:hide",this.onHide.bind(this,"action_hide"));e.on("layer:close",this.onHide.bind(this,"action_close"));e.on("layer:dimmer:click",this.onDimmerClick.bind(this));e.renderTo(this.refs.block);this.block=e;d.forEach(function(a){a.register(e)});this.show();return f},getBlockPromise:function(a){var b=this;if(!this.is("resolvable")){return Promise.resolve(a)}this._layerResolved=false;return new Promise(function(c,d){b._rejectLayer=d;b._resolveLayer=c;a.on("layer:resolve",function(d){a.off("layer:resolve",c);b._layerResolved=true;var e=d.details,f=e.resolveData,g=e.close;if(g){b.onHide("action_close")}c(f)})})},onHide:function(a){if(a===void 0){a="unknown"}if(!this.is("active")){return}var b=this.block.name;if(this.block.onBeforeHide){var c=this.block.onBeforeHide();if(c===null||c===void 0?void 0:c.stopHiding){return}}this.block.destroy();this.block=null;this.hide();if(this.is("resolvable")){if(this.is("reject-on-close")){!this._layerResolved&&this._rejectLayer()}else{!this._layerResolved&&this._resolveLayer()}}g.default([b,"hide",a]);if(this.showTS){g.default([b,"visible"],new Date-this.showTS)}this.broadcast("window:close");j()},onDimmerClick:function(a){if(!this.is("close-on-dimmer")){return}if(a.target!==this.refs.container){return}this.onHide("dimmer")},show:function(){this.showTS=new Date;this.set("active",true);this.block.set("visible",true);g.default([this.block.name,"show"]);e.default.sleep.apply(e.default,e.SLOTS_EXCEPT_SENT)},hide:function(){this.set("active",false);if(this.block){this.block.set("visible",false)}},getBlock:function(){return this.block}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list/letter-list.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="layout" value="{attrs.layout}"/>\n\t<fn:var name="route" value="{attrs.route}"/>\n\t<fn:var name="router" value="{attrs.router}"/>\n\t<fn:var name="models" value="{attrs.models}"/>\n\t<fn:var name="status" value="{attrs.status}"/>\n\t<fn:var name="metathreads" value="{attrs.metathreads}"/>\n\t\x3c!-- Вынести страницу с ошибкой в отдельный блок --\x3e\n\t<fn:var name="letterNotFound" value="{attrs[\'letter-not-found\']}" />\n\t<fn:var name="transparent" value="{attrs.transparent && layout.isLessThen(\'xs\')}"/>\n\t<fn:var name="empty" value="{!models.length || letterNotFound}"/>\n\t<fn:var name="touch" value="{attrs.touch}"/>\n\t<fn:var name="compact" value="{attrs.compact}"/>\n\t<fn:var name="folders" value="{attrs.folders}"/>\n\t<fn:var name="folder" value="{attrs.folder}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\t<fn:var name="unsubscribeList" value="{attrs.unsubscribeList}"/>\n\t<fn:var name="useNewLetterList" value="{_this.useNewLetterList()}"/>\n\t<fn:var name="search" value="{route.is(\'#search #search-letter\')}"/>\n\n\t<bem:mod name="has-letters" test="!empty"/>\n\t<bem:mod name="touch" test="touch"/>\n\t<bem:mod name="transparent" test="transparent"/>\n\t<bem:mod name="empty-touch" test="empty && touch"/>\n\n\t<b:scrollable\n\t\t\tfn:if="!useNewLetterList"\n\t\t\tname="dataset-letters"\n\t\t\temit-onbottom="760"\n\t\t\temit-ontop="760"\n\t\t\tfooter="{!empty && !transparent}"\n\t\t\tsubstrated\n\t\t\tbright\n\t\t\tmeasure-fps\n\t\t\tfull-height\n\t\t\tsilent="{_this.isScrollableSilent()}"\n\t\t\tuse:mediator="letters-loader scrollable-manager letter-list-adv-optimizer advert-manager"\n\t>\n\t\t<b:dataset-letters\n\t\t\t\tuse:mediator="letters-shortcut letters-selection letters-actions letters-loader compose-manager flags search-manager paginator-manager welcome-block-manager unsubscribe-actions"\n\t\t\t\tkey="{search ? \'search\' : (\'folder_\' + folder.id)}"\n\t\t\t\trouter="{router}"\n\t\t\t\tfolder="{folder}"\n\t\t\t\tthread="{route.is(\'#search #search-letter\') ? route.params.id : route.params.letter}"\n\t\t\t\tfolders="{folders}"\n\t\t\t\tmodels="{models}"\n\t\t\t\tstatus="{status}"\n\t\t\t\tmetathreads="{metathreads}"\n\t\t\t\tcompact="{compact}"\n\t\t\t\ttouch="{touch}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tdark-mode="{darkMode}"\n\t\t\t\tselect-mode="{layout.selectMode}"\n\t\t\t\tletter-not-found="{letterNotFound}"\n\t\t\t\tsearch="{search}"\n\t\t\t\tsearch-letter="{route.is(\'#search-letter\')}"\n\t\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\t\tunsubscribeList="{unsubscribeList}"\n\t\t\t\tshowBackToParentFolder="{attrs[\'showBackToParentFolder\']}"\n\t\t/>\n\t</b:scrollable>\n\n\t<b:draggable\n\t\tfn:if="useNewLetterList"\n\t\tenabled="{!_this.isTouchDevice()}"\n\t\tremit:preparedragelement="preparedragelement"\n\t\tuse:mediator="todo-manager"\n\t>\n\t\t\x3c!-- TODO: завернуть class-name в selector() --\x3e\n\t\t<b:react-async\n\t\t\tclass-name="letter-list__react"\n\t\t\tid="reactList"\n\t\t\tblockRadarId="llist"\n\t\t\tuseErrorBoundary\n\t\t\tcomponent="DatasetLetters"\n\t\t\tqaEnabled="{attrs[\'qa-enabled\']}"\n\t\t\tuseMediators="{[\'letters-shortcut\', \'letters-selection\', \'letters-actions\', \'letters-loader\', \'compose-manager\', \'flags\', \'search-manager\', \'paginator-manager\', \'welcome-block-manager\', \'unsubscribe-actions\', \'themes-manager\', \'folders-navigation\']}"\n\t\t\tmodels="{models}"\n\t\t\tonScrollToBottom="{_this.onScrollToBottom}"\n\t\t\tonScroll="{_this.onScroll}"\n\t\t\trouter="{router}"\n\t\t\tfolder="{folder}"\n\t\t\tthread="{route.is(\'#search #search-letter\') ? route.params.id : route.params.letter}"\n\t\t\tfolders="{folders}"\n\t\t\tstatus="{status}"\n\t\t\tmetathreads="{metathreads}"\n\t\t\tcompact="{compact}"\n\t\t\ttouch="{touch}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t\tselect-mode="{layout.selectMode}"\n\t\t\tletter-not-found="{letterNotFound}"\n\t\t\tsearch="{search}"\n\t\t\tsearch-letter="{route.is(\'#search-letter\')}"\n\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\tunsubscribeList="{unsubscribeList}"\n\t\t\tshowBackToParentFolder="{attrs[\'showBackToParentFolder\']}"\n\t\t/>\n\t\t<b:paginator-container\n\t\t\tvisible="{attrs[\'nav-up\']}"\n\t\t\tnav-up="{attrs[\'nav-up-enabled\']}"\n\n\t\t\tuse:mediator="layout-manager compose-manager"\n\t\t>\n\t\t\t<fn:match name="nav-up">\n\t\t\t\t<b:button2\n\t\t\t\t\tico="navigation:arrow_up"\n\t\t\t\t\ttitle="{i18n(\'Наверх\')}"\n\t\t\t\t\tpure\n\t\t\t\t\tdisabled="{!attrs[\'nav-up\']}"\n\t\t\t\t\tqa:id="paginator-button-up"\n\t\t\t\t\tremit:click="paginator:up"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</fn:match>\n\t\t</b:paginator-container>\n\t</b:draggable>\n</div>\n',"app/feast-tpl!ui-block/letter-list/letter-list.html")});define("feast-tpl!ui-block/letter-list/letter-list.html",["feast-tpl!app/feast-tpl!ui-block/letter-list/letter-list.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/headless-counter",["require","exports","@mail/xray","default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendHeadCheckRadar=void 0;a=__importDefault(a);function c(c){if(!b.HEADLESS_COUNTER){return}try{if(!document.head||!document.body){a.default.send("headless_counter",{rlog:"octavius_headless_log",rlog_message:{id:c,body:!!document.body,head:!!document.head}})}}catch(b){a.default.send("headless_counter_error",{rlog:"octavius_headless_log",rlog_message:{id:c,error:b}})}}exports.sendHeadCheckRadar=c});define("mediator/letters-loader/vars",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LettersLoaderEvents=void 0;var a;(function(a){a["onBottom"]="scroll:onbottom";a["loadMore"]="lettersloader:loadmore"})(a=exports.LettersLoaderEvents||(exports.LettersLoaderEvents={}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-list/letter-list",["require","exports","cfg","data-source/utils/paginator","default-values","feast","feast-tpl!./letter-list.html","helpers/headless-counter","helpers/new-letter-list","mediator/letters-loader/vars","ui-block/dataset-letters/dataset-letters","ui-block/react-async/react-async","ui-block/scrollable/scrollable","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);var m=l.lazyHelpersVisibilityWatcher().then(function(a){return new a.VisibilityAlertWatcher({name:"letter-list"})});exports.default=d.default.Block.extend({name:"letter-list",template:e.default,events:{preparedragelement:"onPrepareDragElement","paginator:up":"onPaginatorUp"},blocks:{scrollable:k.default,"dataset-letters":i.default,"react-async":j.default},defaults:{models:[],"nav-up-enabled":c.ENABLE_NAV_UP,"qa-enabled":a.default.get("qa")},constructor:function(){d.default.Block.apply(this,arguments);this.onScrollToBottom=this.onScrollToBottom.bind(this);this.onScroll=this.onScroll.bind(this);this.onPrepareDragElement=this.onPrepareDragElement.bind(this);this.onPaginatorUp=this.onPaginatorUp.bind(this);f.sendHeadCheckRadar("letter-list-constructor")},didMount:function(){var a=this;m.then(function(b){a.visibilityWatcher=true;b.schedule(function(){return a.el})});f.sendHeadCheckRadar("letter-list-mount")},didUnmount:function(){var a=this;m.then(function(b){if(a.visibilityWatcher){a.visibilityWatcher=false;b.unschedule()}})},useNewLetterList:function(){return g.isNewLetterListEnabled(this.get("compact"))},onScrollToBottom:function(a){this.broadcast(h.LettersLoaderEvents.loadMore,a)},onScroll:function(a){var b=a.scrollTop>0;if(this.get("nav-up")!==b){this.set("nav-up",b)}},onPaginatorUp:function(){var a,b;(b=(a=this.ids.reactList)===null||a===void 0?void 0:a.getComponent())===null||b===void 0?void 0:b.scrollToTop()},onPrepareDragElement:function(a){var b,c;(c=(b=this.ids.reactList)===null||b===void 0?void 0:b.getComponent())===null||c===void 0?void 0:c.onPrepareDragElement(a)},isScrollableSilent:function(){var a=this.get("router");return b.isPaginatorGlobalEnabled(a)&&!this.get("route").is("#search #search-letter")},isTouchDevice:function(){return c.TOUCH_MODE}})});define("feast-tpl!app/feast-tpl!ui-block/list-nested/list-nested.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested">\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\n\t<div bem:elem="content" ref="block"></div>\n</div>\n',"app/feast-tpl!ui-block/list-nested/list-nested.html")});define("feast-tpl!ui-block/list-nested/list-nested.html",["feast-tpl!app/feast-tpl!ui-block/list-nested/list-nested.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested-moveto-folder">\n\t<b:list ref="list">\n\t\t<div/>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html")});define("feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html",["feast-tpl!app/feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/Filter",["require","exports","utils/util","RPC","RPCModel"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=c.default.extend({className:"filters.Filter",findUrl:"filters",addSeveralUrl:"filters/add",changeOrderUrl:"/cgi-bin/settings/ajax_filters_order?func_name=move",switchEnabledUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=switch_filter",confirmForwardUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email",resendConfirmUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email_resend",editUrl:"filters/edit",removeUrl:"filters/remove",searchUrl:"filters/search",messagesMatchUrl:"filters/messages/match",defaults:{id:null,enabled:true,applyToSpam:false,continue:false,conditionsOr:false,isAutoFilter:false,isForAlias:false,maillistId:0,conditions:[],actions:{remove:false,move:0,read:false,flag:false,forward:[],notify:[],reply:"",reject:false,replace_category:null},apply_folders:[]},isShareGive:function(){return this.get("share")==="give"},isShareTake:function(){return this.get("share")==="take"},isOwn:function(){return!this.isShareTake()},checkGrant:function(a){var b;var c=this.get("owner");if(!c){return true}return Boolean((b=c.filters_grants)===null||b===void 0?void 0:b[a])},isOwner:function(a){var b=this.get("owner");return b&&b.email===a},isAuthor:function(a){var b=this.get("author");return b&&b.email===a},isForward:function(){var a,b;var c=this.get("actions");return!!((a=c===null||c===void 0?void 0:c.forward)===null||a===void 0?void 0:a.length)&&!c.reply&&!c.remove&&!c.flag&&!c.read&&!c.reject&&+c.move===0&&((b=this.get("conditions"))===null||b===void 0?void 0:b.length)===0&&this.get("continue")},isEditable:function(a){var b,c,e,f,g,h,i;if(a===void 0){a={}}var j=a.email;var k=true;if(this.isShareTake()){k=this.checkGrant(d.SHARE_GRANTS.edit_filter);if(j&&this.isAuthor(j)){k=this.checkGrant(d.SHARE_GRANTS.add_filter)}if(((c=(b=this.get("actions"))===null||b===void 0?void 0:b.forward)===null||c===void 0?void 0:c.length)||((f=(e=this.get("actions"))===null||e===void 0?void 0:e.notify)===null||f===void 0?void 0:f.length)||((g=this.get("actions"))===null||g===void 0?void 0:g.reply)||((h=this.get("actions"))===null||h===void 0?void 0:h.reject)||((i=this.get("actions"))===null||i===void 0?void 0:i.remove)){k=false}}return k},isRemovable:function(a){if(a===void 0){a={}}var b=a.email;var c=true;if(this.isShareTake()){c=this.checkGrant(d.SHARE_GRANTS.remove_filter);if(b&&this.isAuthor(b)){c=this.checkGrant(d.SHARE_GRANTS.add_filter)}}return c}});d.fetchMessagesMatch=function(a){return b.default.call(d.url("messagesMatch"),a)};a.default.extend(d,{SHARE_TAKE:"take",SHARE_GIVE:"give",SHARE_GRANTS:{add_filter:"add_filter",edit_filter:"edit_filter",remove_filter:"remove_filter"}});d.version="1.0.0";exports.default=d;return d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/actions/SaveSeveral",["require","exports","RPC","Action","filters/Filter"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=b.default.extend({prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){a.filters.forEach(function(a){if(a.actions.notify&&!a.actions.notify.length){delete a.actions.notify}if(a.actions.replace_category===null){delete a.actions.replace_category}});return a},operation:function(b){return a.default.call(c.default.url("addSeveral"),b).then(function(a){return d.processResult(b,a)})}});d.processResult=function(a,b){return c.default.map(a.filters.map(function(a,c){a.id=b.get("body."+c);a.apply_folders=b.get("data.apply_folders");return a}))};b.default.register("filters.SaveSeveral",d);d.version="0.1.0";exports.default=d;return d});define("mail/actions/CategoryChange",function(require){"use strict";var a=require("Action");var b=require("RPC");var c=require("mail/Folder");var d=require("mail/Message");const e=new Set(["official","news","newsletter","social","promotions","receipts","school","games"]);var f=function(a){return e.has(a)};var g=function(a){switch(a){case"official":return c.OFFICIAL;case"news":return c.NEWS;case"newsletter":return c.NEWSLETTERS;case"social":return c.SOCIAL;case"promotions":return c.PROMOTIONS;case"school":return c.SCHOOL;case"games":return c.GAMES;case"receipts":return c.RECEIPTS}};var h=a.extend({prepare:function(a){this._models={};var b={ids:a.ids,drop_category:a.drop_category||false,add_filter:a.add_filter||false};if(a.category){b.category=a.category}if(a.folder_password){b.folder_password=a.folder_password}if(a.ids&&Array.isArray(a.ids)){a.ids.forEach(function(a){var b=d.all.get(a);if(!b){return}this._models[a]=b}.bind(this))}return b},_validate:function(a){var b={};if(!a.ids){b.ids="required"}if(!a.category&&!a.drop_category){b.category="required"}if(a.category&&a.drop_category){b.drop_category="redundant"}if(Object.keys(b).length){return b}return null},operation:function(d){var e=this._validate(d);if(e){return Promise.reject(e)}return b.post("messages/services/category/change",d).then(function(a){var b=a.get("body");if(Array.isArray(b)){b.forEach(function(a){var b=this._models[a];if(b){var e=d.category;var h=b.getFolder();var i;var j;if(d.drop_category){j=null;i=h.isMetathread()?c.INBOX:h.get("id")}else if(f(e)){j=null;i=g(e)}else{j=e;i=h.isMetathread()?c.INBOX:h.get("id")}b.set({transaction_category:j,folder:i})}}.bind(this))}return a}.bind(this)).catch(function(b){if(b.get("status")===449){var e=b.get("body.auth.folder_password.id");if(e){return c.findOne(e).then(function(b){return a.waitFor("folderSecure",[b]).then(function(){return this.operation(d)}.bind(this))}.bind(this))}}return Promise.reject(b)}.bind(this))}});a.register("mail.CategoryChange",h);h.isMetathreadCategory=f;h.getMetathreadFolder=g;h.version="0.1.0";return h});define("ui-block/list-nested-category-feedback/list-nested-category-feedback",["exports","@mail/features","default-values","Emitter","feast","feast-tpl!./list-nested-category-feedback.html","filters/actions/SaveSeveral","mail/actions/CategoryChange","service/getModule","service/notify","service/radars/index"],function(exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var k=t(a);var l=t(c);var m=t(d);var n=t(e);var o=t(f);var p=t(g);var q=t(h);var r=t(i);var s=t(j);function t(a){return a&&a.__esModule?a:{default:a}}exports.default=m.default.Block.extend({name:"list-nested-category-feedback",template:n.default,events:{},defaults:{html:"",model:null,folders:null},didUnmount:function a(){this.unrenderUI()},attrChanged:{model:function a(b,c){if(this.ui&&b===c){this.update()}else{this.renderUI()}},metathreads:function a(){if(this.ui){this.update()}},"dark-mode":function a(){if(this.ui){this.update()}}},update:function a(){this.ui.injectDependencies(this.getParams());this.ui.render()},renderUI:function a(){var b=this;this.unrenderUI();(0,q.default)("category.feedback").then(function(a){b.ui=new a.CategoryFeedback(b.refs.list,{model:b.get("model"),listMode:true,externalTooltip:b.createFilterNotify});b.ui.injectDependencies(b.getParams());b.ui.render();b.broadcast("resize",null,null,true)})},unrenderUI:function a(){this.ui&&this.ui.destroy();this.ui=null},getParams:function a(){return{CategoryChange:p.default,SaveSeveral:o.default,isOctavius:true,isDarkMode:this.is("dark-mode"),features:k.default,bridge:this.getBridge(),metathreads:this.is("metathreads")}},createFilterNotify:function a(c){var d=c.header,e=c.text,f=c.action;return new Promise(function(a,c){var g=r.default.add({text:d+". "+e,actions:[{text:f}],qa:"create-filter-notify",duration:b.CATEGORY_FEEDBACK_SUBMENU_NOTIFY_DURATION,inline:false});if(!g){c();return}g.on("action",function(){a();g.close()});g.on("closed",c)})},getBridge:function a(){if(!this._bridge){this._bridge=new l.default;this._bridge.on("radar",function(a){var b=a.chain;(0,s.default)(["submenu"].concat(b))})}return this._bridge}})});define("feast-tpl!app/feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested-moveto-folder">\n\t<fn:var name="model" value="{attrs.model}" />\n\t<fn:var name="lettersFoldersIds" value="{attrs.lettersFoldersIds}" />\n\t<fn:var name="folder" value="{model && model.getFolder()}"/>\n\t<fn:var name="folders" value="{attrs.folders}" />\n\t<fn:var name="icomap" value="{_this.folder2icoMap}"/>\n\n\t<b:list>\n\t\t<fn:if test="_this.showMyFoldersContainer()">\n\t\t\t<b:list-item\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tqa:id="{_this.getMyFoldersContainerId()}"\n\t\t\t\tkey="{_this.getMyFoldersContainerId()}"\n\t\t\t>\n\t\t\t\t<bem:mod name="child-level" value="0"/>\n\t\t\t\t<bem:mod name="disabled"/>\n\n\t\t\t\t<fn:attr name="title" value="{_this.getMyFoldersContainerName()}"/>\n\n\t\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tsrc="{_this.getMyFoldersContainerAvatar()}"\n\t\t\t\t\t\tsize="xs"/>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Название папки --\x3e\n\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t<div bem:elem="text-txt">\n\t\t\t\t\t\t<fn:value>_this.getMyFoldersContainerName()</fn:value>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\n\t\t<fn:for data="folders" as="f" key="idx">\n\t\t\t<fn:var name="showFolder" value="{_this.showFolder(f)}"/>\n\n\t\t\t<fn:if test="showFolder">\n\n\t\t\t\t<fn:var name="id" value="{f.get(\'id\')}"/>\n\n\t\t\t\t<b:list-item\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tqa:id="{f.get(\'id\')}"\n\n\t\t\t\t\tremit:click="move"\n\t\t\t\t\tevent:details="{\'model\': attrs.model, \'id\': id, \'selection\': attrs.selection, \'parentThread\': attrs.parentThread}"\n\n\t\t\t\t\tkey="{id}"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="child-level" value="{_this.getLimitedFolderLevel(f)}"/>\n\t\t\t\t\t<bem:mod name="disabled" test="_this.isDisabled(f)"/>\n\n\t\t\t\t\t<fn:attr name="title" value="{f.get(\'name\')}"/>\n\n\t\t\t\t\t<fn:var name="isSharedVirtualDir" value="{f.isShareTake() && f.isRoot()}"/>\n\n\t\t\t\t\t<fn:if test="isSharedVirtualDir">\n\t\t\t\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\tsrc="{_this.getSharedTakeDirAvatar(f)}"\n\t\t\t\t\t\t\t\tsize="xs"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="!isSharedVirtualDir">\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<fn:var name="ico" value="{_this.getFolderIco(f)}"/>\n\n\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\tname="{ico}"\n\t\t\t\t\t\t\t\tmod="{ico}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:if>\n\n\n\t\t\t\t\t\x3c!-- Название папки --\x3e\n\t\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t\t<bem:mod name="ico" test="f.get(\'security\')"/>\n\n\t\t\t\t\t\t<div bem:elem="text-txt">\n\t\t\t\t\t\t\t<fn:value>f.get(\'name\')</fn:value>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<fn:if test="f.get(\'security\')">\n\t\t\t\t\t\t\t<div bem:elem="text-ico">\n\t\t\t\t\t\t\t\t\x3c!-- Замок если папка запаролена --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="!f.get(\'open\')">\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\x3c!-- Замок если папка распаролена --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="f.get(\'open\')">\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t<fn:if test="f.isSharedGive()">\n\t\t\t\t\t\t\t<div bem:elem="text-ico">\n\t\t\t\t\t\t\t\t\x3c!-- Значок расшаренной папки --\x3e\n\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\tname="{icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t\tmod="{icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</div>\n\t\t\t\t</b:list-item>\n\t\t\t</fn:if>\n\t\t</fn:for>\n\n\t\t\x3c!-- Кнопка "Новая папка" --\x3e\n\t\t<fn:if test="attrs[\'allow-new-folder\']">\n\t\t\t<div bem:elem="hr"/>\n\n\t\t\t<b:list-item\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tqa:id="new-folder-btn"\n\t\t\t\tremit:click="add"\n\t\t\t\tevent:details="{model: {moveLetters: true, letterCurrentFolder: _this.getMessagesFolders()[0]}}"\n\t\t\t>\n\t\t\t\t<bem:mod name="disabled" test="_this.disableCreateFolder()"/>\n\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="{attrs.ponymode ? \'actions:add\' : \'actions:add_big\'}"/>\n\t\t\t\t</span>\n\n\t\t\t\t\x3c!-- Текст кнопки --\x3e\n\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t<div bem:elem="text-txt">\n\t\t\t\t\t\t<fn:value>i18n(\'Новая папка\')</fn:value>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html")});define("feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html",["feast-tpl!app/feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-nested-moveto-folder/list-nested-moveto-folder",["require","exports","default-values","feast","feast-tpl!./list-nested-moveto-folder.html","helpers/folder-to-ico-map","helpers/get-avatar-path","mail/Folder","service/auth"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importStar(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"list-nested-moveto-folder",template:c.default,events:{},defaults:{model:null,folders:null,selection:false,"allow-new-folder":false,"allow-move":true},folder2icoMap:d.default,getFolderIco:d.getFolderIco,hasSharedFolders:false,attrChanged:{models:function(){var a=this.get("folders");this.hasSharedFolders=f.default.all.hasSharedTake.call(a)}},didMount:function(){var a=this;if(this.is("allow-move")){require(["mediator/letters-actions"],function(b){var c=b.default;c.register(a)})}},getMessagesFolders:function(){var a=this.get("model");if(a&&!Array.isArray(a)){var b=a.get("folder");if(a.get("flags.metathread")){b=a.get("metathread_data.folder")}return[f.default.get(b)]}var c=this.get("lettersFoldersIds");return c.map(function(a){return f.default.get(a)})},showFolder:function(a){var b=this.getMessagesFolders()[0];if(b===null||b===void 0?void 0:b.isShareTake()){if(!a.isShareTake()){return false}if(a.get("owner").email!==b.get("owner").email){return false}return true}if(a.isShareTake()){return false}return true},isDisabled:function(a){var b=this;if(a.isShareTake()&&a.isRoot()){return true}if(!a.checkGrant(f.default.SHARE_GRANTS.move)){return true}var c=this.getMessagesFolders();return c.some(function(c){if(a.isSpam()&&(!c.checkGrant(f.default.SHARE_GRANTS.move_to_spam)||b.get("selectedMetathreads"))){return true}if(a.isArchive()&&!c.checkGrant(f.default.SHARE_GRANTS.move_to_archive)){return true}if(a.isTrashLike()&&!c.checkGrant(f.default.SHARE_GRANTS.remove)){return true}return a.id==c.id})},getFolderLevel:function(a){if(!this.hasSharedFolders){return a.getChildLevel()}if(this.isMyFoldersContainer(a)){return 0}if(a.isShareTake()){return a.getChildLevel()}return a.getChildLevel()+1},getLimitedFolderLevel:function(b){var c=this.getFolderLevel(b);return Math.min(a.FOLDER_MAX_CHILD_LEVEL_UI,c)},getAvatar:function(a,b){return e.default({email:a,name:b,size:45})},getMyFoldersContainerAvatar:function(){var a=g.default.user;var b=a.getEmail();var c=a.get("nick");if(!b||!c){return null}return this.getAvatar(b,c)},getSharedTakeDirAvatar:function(a){var b=a.get("owner");var c=b.email;var d=b.name;if(!c||!d){return null}return this.getAvatar(c,d)},showMyFoldersContainer:function(){var a=this.getMessagesFolders()[0];return this.hasSharedFolders&&!(a===null||a===void 0?void 0:a.isShareTake())},isMyFoldersContainer:function(a){var b=a.get("id");return this.getMyFoldersContainerId()===b},getMyFoldersContainerId:function(){return a.NAV_MY_FOLDERS_CONTAINER_ID},getMyFoldersContainerName:function(){return i18n("Мои папки")},disableCreateFolder:function(){var a=this.getMessagesFolders()[0];if(!a.isShareTake()){return false}return f.default.all.toArray().filter(function(b){var c,d;return((c=a.get("owner"))===null||c===void 0?void 0:c.email)===((d=b.get("owner"))===null||d===void 0?void 0:d.email)}).every(function(a){return!(a.canAddSubfolder()&&a.checkGrant(f.default.SHARE_GRANTS.move))})}})});define("feast-tpl!app/feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested-sorting">\n\t<fn:var name="sortings" value="{_this.sortings}" />\n\t<fn:var name="touch" value="{attrs.touch}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}" />\n\n\t<bem:mod name="touch" test="touch" />\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t<fn:match name="item" args="item, key, isSelected, text, touch">\n\t\t<fn:var name="type" value="{item.type}" />\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tdisabled="{isDisabled}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\t\t\tqa:id="{type}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="text"> {text} </span>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t<b:list\n\t\ttouch="{touch}"\n\t\tqa:id="sortings-dropdown"\n\t\tremit:item-click="list:item-click"\n\t>\n\t\t<fn:for data="sortings" as="item">\n\t\t\t<fn:var name="key" value="{item.text}" />\n\t\t\t<fn:var name="text" value="{item.text}" />\n\t\t\t<fn:var name="isSelected" value="{attrs.sortingType === item.type}" />\n\t\t\t<fn:apply-match name="item" args="item, key, isSelected, text, touch" />\n\t\t</fn:for>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html")});define("feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html",["feast-tpl!app/feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html"],function(a){return a});define("ui-block/list-nested-sorting/sorting",["require","exports"],function(require,exports){"use strict";var a,b;Object.defineProperty(exports,"__esModule",{value:true});exports.LetterSortings=exports.SortingTextForControl=exports.SortingText=exports.isDefaultSorting=exports.SortingType=void 0;exports.SortingType={dateDesc:"D",dateAsc:"d",fromAsc:"f",fromDesc:"F",subjectAsc:"s",subjectDesc:"S"};var c=function(a){return a===exports.SortingType.dateDesc};exports.isDefaultSorting=c;exports.SortingText=(a={},a[exports.SortingType.dateDesc]=i18n("Сначала новые"),a[exports.SortingType.dateAsc]=i18n("Сначала старые"),a[exports.SortingType.fromAsc]=i18n("Автор: от А до Я"),a[exports.SortingType.fromDesc]=i18n("Автор: от Я до А"),a[exports.SortingType.subjectAsc]=i18n("Тема: от А до Я"),a[exports.SortingType.subjectDesc]=i18n("Тема: от Я до А"),a);exports.SortingTextForControl=(b={},b[exports.SortingType.dateDesc]=i18n("Сначала новые"),b[exports.SortingType.dateAsc]=i18n("Сначала старые"),b[exports.SortingType.fromAsc]=i18n("Автор: А - Я"),b[exports.SortingType.fromDesc]=i18n("Автор: Я - А"),b[exports.SortingType.subjectAsc]=i18n("Тема: А - Я"),b[exports.SortingType.subjectDesc]=i18n("Тема: Я - А"),b);function d(a){this.type=a||exports.SortingType.dateDesc;this.text=exports.SortingText[this.type];this.controlText=exports.SortingTextForControl[this.type]}exports.default=d;exports.LetterSortings=[new d(exports.SortingType.dateDesc),new d(exports.SortingType.dateAsc),new d(exports.SortingType.fromAsc),new d(exports.SortingType.fromDesc),new d(exports.SortingType.subjectAsc),new d(exports.SortingType.subjectDesc)]});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-nested-sorting/list-nested-sorting",["require","exports","feast","feast-tpl!./list-nested-sorting.html","service/radars/decorator","ui-block/list/list","ui-block/list-item/list-item","ui-block/list-nested/list-nested","./sorting"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=a.default.Block.extend(c.default({id:"filter",explicit:true})({name:"list-nested-sorting",template:b.default,events:{"list:item-click":"onSortingClick"},blocks:{list:d.default,"list-nested":f.default,"list-item":e.default},defaults:{sortingType:"D"},sortings:g.LetterSortings,onSortingClick:function(a){var b=a.details;var c="sorting_"+b.type+"_click";this.radar(c);this.broadcast("sortingclick",b.type)},didMount:function(){var a=this;require(["mediator/filter-manager"],function(b){var c=b.default;c.register(a)})}}))});define("ui-block/list-nested/list-nested",["exports","feast","feast-tpl!./list-nested.html","helpers/browser","ui-block/list-nested-category-feedback/list-nested-category-feedback","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/list-nested-sorting/list-nested-sorting"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n={"moveto-folder":k.default,"category-feedback":j.default,sorting:l.default};exports.default=g.default.Block.extend({name:"list-nested",template:h.default,events:{resize:"onContentResize"},defaults:{expanded:false,"hover-support":i.default.capabilities["hover-support"]},setCoordinates:function a(b){var c=b.el.getBoundingClientRect();var d=this.refs.block;var e=4;var f=window.innerWidth;var g=window.innerHeight;var h=d.offsetWidth;var i=d.offsetHeight;var j=f-c.right>h;var k=!j;var l=g-c.top>i;var m=void 0;var n=void 0;var o=void 0;var p=c.top-2*e;if(j){m=c.right}if(k){m=c.left-h}if(l){o="none"}if(!l){n=i-(g-c.top);o=i-n+"px"}d.style.left=m+"px";d.style.top=p+"px";d.style["max-height"]=""+o},onContentResize:function a(){this.setCoordinates(this.control)},setSubmenu:function a(b,c,d){var e=n[b];if(!e||!d){return}this.destroyBlock();var f=new e(Object.assign({},c,{router:this.get("router")}));this.block=f;this.control=d;f.renderTo(this.refs.block);this.setCoordinates(d);this.show();return f},show:function a(){if(!this.block||!this.control){return}this.block.onShow&&this.block.onShow();this.control.onSubmenuShow&&this.control.onSubmenuShow();this.set("expanded",true)},hide:function a(){if(!this.block||!this.control){return}this.block.onHide&&this.block.onHide();this.control.onSubmenuHide&&this.control.onSubmenuHide();this.set("expanded",false)},destroyBlock:function a(){if(!this.block||!this.control){return}this.block.onDestroy&&this.block.onDestroy();this.control.onDestroy&&this.control.onDestroy();this.block=null;this.refs.block.innerHTML="";this.refs.block.removeAttribute("style")}})});define("feast-tpl!app/feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="sidebar-content">\n\t\t<b:nav-folders\n\t\t\t\tref="navFolders"\n\t\t\t\tuse:mediator="letters-actions folders-actions user-info letters-loader pony-mode folders-navigation"\n\t\t\t\tremit:folderclick="folder:click"\n\t\t\t\tactive="{attrs[\'folder-active\']}"\n\t\t\t\thandle-drop\n\t\t\t\tmodels="{attrs.models}"\n\t\t\t\trouter="{attrs.router}"\n\t\t\t\tsidebar\n\t\t\t\twith-clear\n\t\t/>\n\n\t\t<div bem:elem="divider" />\n\n\t\t<div bem:elem="footer" qa:id="mobile-sidebar-footer">\n\t\t\t<fn:if test="!attrs[\'hide-settings-button\']">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="settings-button"\n\t\t\t\t\t\tico="navigation:settings"\n\t\t\t\t\t\tremit:click="settings:click"\n\t\t\t\t\t\ttext="Настройки"\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\tpure\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<b:button2\n\t\t\t\t\tqa:id="contacts-button"\n\t\t\t\t\tico="categories:addressbook_webview"\n\t\t\t\t\tremit:click="contacts:open"\n\t\t\t\t\ttext="Контакты"\n\t\t\t\t\tfluid\n\t\t\t\t\tpure\n\t\t\t/>\n\t\t\t<fn:if test="attrs[\'show-reload-button\']">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="reload-button"\n\t\t\t\t\t\tico="actions:postpone_alt"\n\t\t\t\t\t\tremit:click="reload:click"\n\t\t\t\t\t\ttext="Обновить страницу"\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\tpure\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t<fn:if test="_this.isOpen()" animated>\n\t\t<div bem:elem="wrapper" remit:click="mobilesidebar:close">\n\t\t\t<div bem:elem="content" qa:id="mobile-sidebar" remit:click.prevent.stop>\n\t\t\t\t<bem:mod name="open" test="attrs.open"/>\n\n\t\t\t\t<div bem:elem="header">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\tqa:id="close"\n\t\t\t\t\t\t\tico="navigation:arrow_list_previous"\n\t\t\t\t\t\t\tremit:click="mobilesidebar:close"\n\t\t\t\t\t\t\ttext="Свернуть"\n\t\t\t\t\t\t\tpure\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<b:scrollable\n\t\t\t\t\t\tid="scrollShort"\n\t\t\t\t\t\tref="scrollShort"\n\t\t\t\t\t\tscroll-style="{attrs[\'short-scroll-style\']}"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tdisable-horizontal-scroll\n\t\t\t\t>\n\t\t\t\t\t<fn:apply-match name="sidebar-content"/>\n\t\t\t\t</b:scrollable>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html")});define("feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html",["feast-tpl!app/feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/mobile-sidebar/mobile-sidebar",["require","exports","default-values","feast","feast-tpl!./mobile-sidebar.html","helpers/opener","ui-block/button2/button2","ui-block/nav-folders/nav-folders","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"mobile-sidebar",template:c.default,blocks:{"nav-folders":f.default,button2:e.default,scrollable:g.default},events:{"folder:click":"onFolderClick","reload:click":"onReloadClick","contacts:open":"onContactsClick"},defaults:{open:false,"folder-active":undefined,"hide-settings-button":a.HIDE_SETTINGS_BUTTON,"show-reload-button":a.SHOW_RELOAD_BUTTON},attrChanged:{"folder-active":function(){this.broadcast("mobilesidebar:close")}},onFolderClick:function(a){var b=a.details.id;if(b==this.get("folder-active")){this.broadcast("mobilesidebar:close")}},onReloadClick:function(){location.reload()},onContactsClick:function(){d.default(a.MOBILE_ADDRESSBOOK_URL)},isOpen:function(){return this.is("open")}})});define("feast-tpl!app/feast-tpl!ui-block/panel-with-selected/panel-with-selected.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="active" test="attrs.selected.length" />\n\t<bem:mod name="one" test="attrs.selected.length == 1" />\n\t<bem:mod name="two" test="attrs.selected.length == 2" />\n\t<bem:mod name="more" test="attrs.selected.length > 2" />\n\n\t<div bem:elem="empty" fn:if="!attrs.selected.length">\n\t\t<fn:apply-match name="empty" />\n\t</div>\n\n\t<fn:if test="attrs.selected.length && attrs[\'selected-last-thread\']">\n\t\t<fn:choose>\n\t\t\t<fn:when test="attrs[\'is-metathread\']">\n\t\t\t\t<b:metathread-preview model="{attrs[\'selected-last-thread\']}" />\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:thread\n\t\t\t\t\tfn:if="!_this.useNewThread()"\n\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\tmodel="{attrs[\'selected-last-thread\']}"\n\t\t\t\t\texpand-letter-id="{attrs[\'expand-letter-id\']}"\n\t\t\t\t\tpreview-mode\n\t\t\t\t/>\n\t\t\t\t<b:react-async\n\t\t\t\t\tfn:if="_this.useNewThread()"\n\t\t\t\t\tcomponent="Thread"\n\t\t\t\t\tuseMediators="{[\'themes-manager\']}"\n\t\t\t\t\tmodel="{attrs[\'selected-last-thread\']}"\n\t\t\t\t\texpand-letter-id="{attrs[\'expand-letter-id\']}"\n\t\t\t\t\tpreview-mode\n\t\t\t\t/>\n\t\t\t\t<fn:if test="!attrs[\'dark-mode\']">\n\t\t\t\t\t<div bem:elem="gradient"></div>\n\t\t\t\t</fn:if>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/panel-with-selected/panel-with-selected.html")});define("feast-tpl!ui-block/panel-with-selected/panel-with-selected.html",["feast-tpl!app/feast-tpl!ui-block/panel-with-selected/panel-with-selected.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/metathread-preview/metathread-preview.html",["feast"],function(a){return a.smartParse('<div qa:id="metathread-preview">\n\t<fn:var name="message" value="{attrs.model}" />\n\t<fn:var name="ponymode" value="{attrs.ponymode}"/>\n\n\t<fn:var name="metathreadData" value="{_this.getMetathreadData()}"/>\n\t<fn:var name="title" value="{metathreadData.folder_name}"/>\n\t<fn:var name="type" value="{metathreadData.category}"/>\n\t<fn:var name="unread" value="{metathreadData.flags.unread}"/>\n\n\t<div bem:elem="header">\n\t\t<div bem:elem="avatar" qa:id="metathread-avatar">\n\t\t\t<b:metathread-avatar\n\t\t\t\tindent="{ponymode ? \'right\' : false}"\n\t\t\t\tmodel="{message}"\n\t\t\t\tsize="common"\n\t\t\t\tdisable-select\n\t\t\t\tdisable-hover\n\t\t\t\ttype="{type}"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div bem:elem="title" qa:id="metathread-title">\n\t\t\t<b:metathread-title\n\t\t\t\ttitle="{title}"\n\t\t\t\ttype="{type}"\n\t\t\t\tunread="{unread}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="snippet">\n\t\t<fn:choose>\n\t\t\t<fn:when test="message.isToMyself()">\n\t\t\t\t<b:metathread-snippet-tomyself senders="{metathreadData.last_senders}" preview />\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:metathread-snippet senders="{metathreadData.last_senders}" />\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/metathread-preview/metathread-preview.html")});define("feast-tpl!ui-block/metathread-preview/metathread-preview.html",["feast-tpl!app/feast-tpl!ui-block/metathread-preview/metathread-preview.html"],function(a){return a});define("ui-block/metathread-preview/metathread-preview",["exports","feast","feast-tpl!./metathread-preview.html","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-snippet/metathread-snippet","ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself","ui-block/metathread-title/metathread-title"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"metathread-preview",template:h.default,defaults:{model:null},blocks:{"metathread-avatar":i.default,"metathread-title":l.default,"metathread-snippet":j.default,"metathread-snippet-tomyself":k.default},getMetathreadData:function a(){return this.get("model").get("metathread_data")}})});define("feast-tpl!app/feast-tpl!ui-block/thread/thread.html",["feast"],function(a){return a.smartParse('<div qa:id="thread" data-transaction-category="{attrs.model.get(\'transaction_category\')}">\n\t<fn:var name="message" value="{attrs.model}" />\n\t<fn:var name="messageSubject" value="{message.get(\'subject\') || i18n(\'<Без темы>\')}" />\n\t<fn:var name="folders" value="{attrs.folders}" />\n\t<fn:var name="isDisableEdit" value="{attrs.route.params.part}" />\n\t<fn:var name="compressed" value="{attrs.ponymode}"/>\n\t<fn:var name="metadata" value="{message.get(\'transaction_metadata\')}" />\n\t<fn:var name="actualLettersEnabled" value="{_this.actualLettersEnabled()}"/>\n\t<fn:var name="reliableSender" value="{message.get(\'messages.0.headers.X-Mailru-Bimi-Organization\')}"/>\n\n\t<bem:mod name="preview" test="attrs[\'preview-mode\']"/>\n\t<bem:mod name="fluid" test="!attrs.compact"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="rounded" test="attrs.rounded"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="no-divider" test="attrs.noDivider"/>\n\t<bem:mod name="compressed" test="attrs.ponymode"/>\n\n\t<div bem:elem="header">\n\t\t<fn:if test="!attrs[\'preview-mode\']">\n\t\t\t<div bem:elem="meta-header">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="_this.parentalControlDieEnabled()">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="parent-filter"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.getMessageFolder().isSpam() && message.get(\'messages.0.flags.blacklist_spam\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="spam-blacklist"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="attrs.showOfficialSender && _this.isOfficialSender(message)">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="official-sender"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tsender="{reliableSender}"\n\t\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t\t\tdata-test-id="official-sender-promo"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.isShowPromoPush() && message.meta(\'unread-on-open\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="promo-push-header"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="actualLettersEnabled && this.get(\'actualReasonFeedback\') && message.get(\'actual_reason\') && message.meta(\'unread-on-open\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="actual-reason-feedback"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.isShowCategoryFeedbackPlate() && message.meta(\'unread-on-open\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="category-feedback"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="attrs.showReliableSender && _this.isReliableSender(message)">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="reliable-sender"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tsender="{reliableSender}"\n\t\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t\t\tdata-test-id="reliable-sender-promo"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\n\t\t\t\x3c!-- FMAIL-7550: плашка над письмом для отправителей выбранных доменов --\x3e\n\t\t\t<b:promo-domain-die\n\t\t\t\tmodel="{message}"\n\t\t\t\tsenderEmail="{_this.getSenderEmail(message)}"\n\t\t\t\treceivers="{_this.getReceivers(message)}"\n\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<div bem:elem="subject-line">\n\t\t\t<b:thread-subject\n\t\t\t\tkey="{messageSubject}"\n\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\tsubject="{messageSubject}"\n\t\t\t/>\n\n\t\t\t<fn:if test="!attrs[\'disable-category\'] && !message.getFolder().isSpam() && !attrs.mobile">\n\t\t\t\t<fn:if test="message.get(\'transaction_category\')">\n\t\t\t\t\t<fn:var name="category" value="{message.get(\'transaction_category\')}"/>\n\t\t\t\t</fn:if>\n\n\t\t\t\t\x3c!-- OCTAVIUS-3672 --\x3e\n\t\t\t\t\x3c!-- Скрываем категорию event или fees, если есть соответствующая плашка --\x3e\n\t\t\t\t<fn:var name="hideCategory" value="{_this.isHideCategory(message)}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="attrs[\'category-feedback\']  && !message.getFolder().isShareTake()">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="category"\n\t\t\t\t\t\t\tfn:if="_this.hasCategory(message) && !hideCategory"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- Смена категории письма, включая письма в метатредах --\x3e\n\t\t\t\t\t\t\t<b:category-feedback\n\t\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\t\tuse:mediator="settings-manager themes-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="category"\n\t\t\t\t\t\t\tfn:if="category && !hideCategory"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- Плашка категории в письме --\x3e\n\t\t\t\t\t\t\t<b:letter-category name="{category}" short="{attrs.touch}"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</div>\n\n\t\t<fn:var name="resendData" value="{_this.getResendData()}" />\n\n\t\t<fn:if test="!attrs.isResendDropdownDisabled && resendData">\n\t\t\t<b:react-async\n\t\t\t\tcomponent="ResendDropdown"\n\t\t\t\tclass-name="thread__resend-dropdown"\n\t\t\t\tresendFrom="{resendData.from}"\n\t\t\t\tresendTo="{resendData.to}"\n\t\t\t\tresendDate="{resendData.date}"\n\t\t\t\treceivedDate="{resendData.receivedDate}"\n\t\t\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.getJsonLdInfo() || metadata.getAttributes() || message.getCalendarIcsEvent()">\n\t\t\t<b:letter-meta\n\t\t\t\tmodel="{message}"\n\t\t\t\tmetadata="{metadata}"\n\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\tcalendar="{_this.getFirstCalendarAttach()}"\n\t\t\t\tremit:render="letter-meta:render"\n\t\t\t\tremit:letterclick="letter-meta:letterclick"\n\t\t\t\tuse:mediator="themes-manager layout-manager"\n\t\t\t/>\n\t\t</fn:if>\n\t</div>\n\n\t<fn:if test="attrs.hasDraft">\n\t\t<fn:var name="draft" value="{attrs.draft}" />\n\t\t<div bem:elem="letter">\n\t\t\t<bem:mod name="first"/>\n\t\t\t<bem:mod name="expanded"/>\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="draft">\n\t\t\t\t\t<b:letter-list-item\n\t\t\t\t\t\tmodel="{draft}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tdisabled\n\t\t\t\t\t\tdraft\n\t\t\t\t\t\tdisable-select\n\t\t\t\t\t\tdisable-subject\n\t\t\t\t\t\tdisable-category\n\t\t\t\t\t\tremit:click="draft:open"\n\t\t\t\t\t\tcompressed="{compressed}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:letter-list-item-placeholder\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tcompressed="{compressed}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:for data="attrs.model.get(\'messages\')" as="letter" key="idx">\n\t\t<div bem:elem="letter" key="{letter.id}" data-id="{letter.id}" qa:id="thread-letter:{idx + 1}" qa:state="open:{!_this.isCollapsed(letter.id)}"\n\t\t\t fn:if="!attrs[\'preview-mode\'] || !_this.isCollapsed(letter.id)"\n\t\t>\n\t\t\t<fn:var name="isFirst" value="{idx == 0}"/>\n\t\t\t<fn:var name="isLast" value="{attrs.model.get(\'length\') == idx + 1}"/>\n\t\t\t<fn:var name="isSingle" value="{attrs.model.get(\'length\') == 1}"/>\n\t\t\t<fn:var name="isDefaultCollapsed" value="{!attrs.model.canUnfoldMessage(letter)}"/>\n\t\t\t<fn:var name="isPrevCollapsed" value="{_this.isPrevCollapsed(idx)}"/>\n\t\t\t<fn:var name="isNextCollapsed" value="{_this.isNextCollapsed(idx)}"/>\n\t\t\t<fn:var name="isSticky" value="{_this.isSticky(letter.id)}"/>\n\t\t\t<fn:var name="isExpanded" value="{!_this.isCollapsed(letter.id)}"/>\n\t\t\t<fn:var name="datesMetadata" value="{_this._formDatesMetadata()}"/>\n\n\t\t\t<bem:mod name="expanded" test="isExpanded"/>\n\t\t\t<bem:mod name="expanded-next" test="!isNextCollapsed"/>\n\t\t\t<bem:mod name="expanded-prev" test="!isFirst && !isPrevCollapsed"/>\n\t\t\t<bem:mod name="collapsed" test="_this.isCollapsed(letter.id) && !attrs[\'preview-mode\']"/>\n\t\t\t<bem:mod name="collapsed-next" test="isNextCollapsed"/>\n\t\t\t<bem:mod name="first" test="isFirst"/>\n\t\t\t<bem:mod name="last" test="isLast"/>\n\t\t\t<bem:mod name="single" test="isSingle"/>\n\n\t\t\t<fn:if test="!_this.isCollapsed(letter.id)">\n\t\t\t\t<b:letter\n\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\tmodel="{letter}"\n\t\t\t\t\tparentThread="{attrs.model}"\n\t\t\t\t\tfolders="{folders}"\n\t\t\t\t\tautoread="{letter.isDataFully() && !attrs[\'preview-mode\']}"\n\t\t\t\t\tallow-collapse="{attrs.model.get(\'length\') > 1 && !attrs[\'preview-mode\']}"\n\t\t\t\t\treadonly="{attrs[\'preview-mode\']}"\n\t\t\t\t\tsingle="{isSingle}"\n\t\t\t\t\tcollapsed-default="{isDefaultCollapsed}"\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tsticky="{_this.isStickyEnabled() && isSticky && attrs.sticky}"\n\t\t\t\t\tshowfolder="{attrs.model.get(\'folder\') != letter.get(\'folder\')}"\n\t\t\t\t\tquotes-collapsed-default="{!isLast}"\n\t\t\t\t\tdisable-category\n\t\t\t\t\tdisable-edit="{isDisableEdit}"\n\t\t\t\t\tcompactTranslator="{attrs.compact}"\n\t\t\t\t\tponymode="{compressed}"\n\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t\texpanded-next="{!isNextCollapsed}"\n\t\t\t\t\tpreview-mode="{attrs[\'preview-mode\']}"\n\t\t\t\t\tdates-metadata="{datesMetadata}"\n\t\t\t\t\ttransaction-metadata="{metadata}"\n\n\t\t\t\t\tuse:mediator="user-info layout-manager settings-filters-manager attachments-manager calendar-manager translator-manager addressbook-manager share-folders-manager settings-manager calls-manager marusia-manager thread-scroller"\n\n\t\t\t\t\tremit:clickhead="letter:close"\n\t\t\t\t\tremit:attaches:expanded="letter:expand:attaches"\n\t\t\t\t\tremit:attaches:collapsed="letter:collapsed:attaches"\n\t\t\t\t\tremit:resize="letter:resize"\n\t\t\t\t\tremit:letter-force-recalc="force:recalc"\n\t\t\t\t\tremit:translator:scrollto="translator:scrollto"\n\t\t\t\t\tevent:details="letter"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="_this.isCollapsed(letter.id) && !attrs[\'preview-mode\']">\n\t\t\t\t<div\n\t\t\t\t\tremit:click="letter:open"\n\t\t\t\t\tevent:details="letter"\n\t\t\t\t>\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="attrs.touch">\n\t\t\t\t\t\t\x3c!-- touch 2pane --\x3e\n\t\t\t\t\t\t<b:list-letter-common-touch\n\t\t\t\t\t\t\t\tin-thread\n\t\t\t\t\t\t\t\tdisable-subject\n\t\t\t\t\t\t\t\tdisable-select\n\t\t\t\t\t\t\t\tkey="{letter.id}"\n\t\t\t\t\t\t\t\tfirst="{isFirst || !isPrevCollapsed}"\n\t\t\t\t\t\t\t\tlast="{isLast || !isNextCollapsed}"\n\t\t\t\t\t\t\t\tpony-mode="{compressed}"\n\t\t\t\t\t\t\t\tmodel="{letter}"\n\t\t\t\t\t\t\t\tmain-field="from"\n\t\t\t\t\t\t\t\tshowfolder="{attrs.model.get(\'folder\') != letter.get(\'folder\')}"\n\t\t\t\t\t\t\t\twelter="{false}"\n\t\t\t\t\t\t\t\tremit:contextmenu="letter:rightclick"\n\t\t\t\t\t\t\t\tevent:details="letter"\n\t\t\t\t\t\t\t\tuse:mediator="letters-actions"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- desktop 2pane  --\x3e\n\t\t\t\t\t\t<b:list-letter-common\n\t\t\t\t\t\t\t\tin-thread\n\t\t\t\t\t\t\t\tdisable-subject\n\t\t\t\t\t\t\t\tdisable-select\n\t\t\t\t\t\t\t\tdisable-avatar-hover\n\t\t\t\t\t\t\t\tenable-user-select\n\t\t\t\t\t\t\t\tkey="{letter.id}"\n\t\t\t\t\t\t\t\tfirst="{isFirst || !isPrevCollapsed}"\n\t\t\t\t\t\t\t\tlast="{isLast || !isNextCollapsed}"\n\t\t\t\t\t\t\t\tpony-mode="{compressed}"\n\t\t\t\t\t\t\t\tmodel="{letter}"\n\t\t\t\t\t\t\t\tmain-field="from"\n\t\t\t\t\t\t\t\tshowfolder="{attrs.model.get(\'folder\') != letter.get(\'folder\')}"\n\t\t\t\t\t\t\t\twelter="{false}"\n\t\t\t\t\t\t\t\tremit:contextmenu="letter:rightclick"\n\t\t\t\t\t\t\t\tevent:details="letter"\n\t\t\t\t\t\t\t\tuse:mediator="letters-actions layout-manager"\n\t\t\t\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t\x3c!-- Широкий разделитель только вокруг раскрытого треда --\x3e\n\t\t\t<b:delimeter fn:if="!attrs[\'preview-mode\']" full="{isExpanded || !isPrevCollapsed}"/>\n\t\t</div>\n\t</fn:for>\n\n\t<div bem:elem="rounding-footer wrapper">\n\t\t<div bem:elem="rounding-footer" fn:if="_this.usePortalSearchPanel()"></div>\n\t</div>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.kaspersky && !attrs[\'preview-mode\']">\n\t\t\t<div bem:elem="footer">\n\t\t\t\t<div bem:elem="kaspersky">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="http://www.kaspersky.ru/advert/home-security?campaign=kl_mailgroup&redef=1&THRU&referer1=kl_mailgroup_pochta&referer2=kl_mailgroup_pochta"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\trel="noopener noreferer"\n\t\t\t\t\t\tremit:click.stop="click-kaspersky"\n\t\t\t\t\t\tbem:elem="kaspersky-link"\n\t\t\t\t\t>\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tcomponent="KasperskyLogo"\n\t\t\t\t\t\t\tisEngLogo="{_this.isEngKasperskyLogo()}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<div bem:elem="footer" bem:mod="empty"/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</div>\n',"app/feast-tpl!ui-block/thread/thread.html")});define("feast-tpl!ui-block/thread/thread.html",["feast-tpl!app/feast-tpl!ui-block/thread/thread.html"],function(a){return a});define("mail/actions/MarkAs",["logger","utils/util","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f,g){"use strict";var h=d.extend({models:[],prepare:function(c){var d=c.flag,h="flags."+d,i="length_"+d,j=c.force,k=!!c.state,l=c.models,m={},n={},o={clean:true};var p=function(a,b){var c={};c[h]=a;c[i]=b;return c};var q=function(a,b){if(d==="unread"&&a.is("flags.mention")){b["flags.mention_unread"]=b[h]}a.set(b,o)};l=l.filter(function(a){if(a.is(h)!=k||j){var b=g.getByMessageId(a.id),c=a.get("folder"),d=a.get(i);m[c]=(m[c]||0)+(d||1);n[a.id]=p(!k,d);if(b){n[b.id]=p(b.get(h),b.get(i))}else if(a instanceof g){a.get("messages").forEach(function(a){a=f.all.get(a.id);a&&(n[a.id]=p(a.get(h),0))})}return true}});this.models=l;a.add("prepare",{models:{before:c.models.length,after:l.length},counters:m});var r=function(a,b){if(d=="unread"){Object.keys(m).forEach(function(b){e.getSafe(b).increment("messages_unread",m[b]*(a?1:-1),o)})}l.forEach(function(c){var d=g.getByMessageId(c.id);q(c,b?n[c.id]:p(a,+a));if(d){if(b){q(d,n[d.id])}else{d.increment(i,a?1:-1,o);var e={};e[h]=a?true:d.is(i);q(d,e)}}else if(c instanceof g){c.get("messages").some(function(d){d=f.all.get(d.id);if(d){if(b){q(d,n[d.id])}else if(a){if(d.get("folder")==c.get("folder")){var e={};e[h]=true;q(d,e);return true}}else{var e={};e[h]=false;q(d,e)}}})}})};r(k);this.rollbackOperation=b.bindWithoutArgs(r,[!k,true]);return l},operation:function(a,b){return this._markAs(a,b.flag,b.state)},undoOperation:function(a,b){a=this.prepare({flag:b.flag,state:!b.state,models:a});return this._markAs(a,b.flag,!b.state)},_markAs:function(a,d,e){var f={name:d},h,i;function j(b){return g.List.fn.pluck.call(a,b)}f[e?"set":"unset"]=j("id");i=a[0];h={};if(i){f.folder=Number(i.get("folder"))}if(i instanceof g){h.message_id_last=JSON.stringify(b.object(j("id"),j("last")))}h.marks=JSON.stringify([f]);return a.length?c.call(i.markAsUrl,h):Promise.resolve()}});d.register("mail.MarkAs",h);h.version="0.1.1";return h});define("feast-tpl!app/feast-tpl!ui-block/category-feedback/category-feedback.html",["feast"],function(a){return a.smartParse('<div>\n\t<div ref="container"></div>\n\t<div bem:elem="portal" ref="portal" />\n</div>\n',"app/feast-tpl!ui-block/category-feedback/category-feedback.html")});define("feast-tpl!ui-block/category-feedback/category-feedback.html",["feast-tpl!app/feast-tpl!ui-block/category-feedback/category-feedback.html"],function(a){return a});define("ui-block/category-feedback/category-feedback",["exports","@mail/features","Emitter","feast","feast-tpl!./category-feedback.html","filters/actions/SaveSeveral","mail/actions/CategoryChange","service/getModule","service/radars/index","service/smokescreen"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=q(a);var k=q(b);var l=q(c);var m=q(d);var n=q(f);var o=q(g);var p=q(h);function q(a){return a&&a.__esModule?a:{default:a}}exports.default=l.default.Block.extend({name:"category-feedback",template:m.default,defaults:{html:""},constructor:function a(){l.default.Block.apply(this,arguments);this.onModelChange=this.onModelChange.bind(this)},didUnmount:function a(){this.unrenderUI()},attrChanged:{model:function a(b,c){if(this.ui&&this.getMessage(b)===this.getMessage(c)){this.update()}else{this.renderUI()}},metathreads:function a(){if(this.ui){this.update()}},"dark-mode":function a(){if(this.ui){this.update()}}},renderUI:function a(){var b=this;this.unrenderUI();var c=this.getMessage(this.get("model"));if(!c){(0,p.default)(["category-feedback","no-message"]);return}(0,o.default)("category.feedback").then(function(a){if(!b.isMounted()){return}b.ui=new a.CategoryFeedback(b.refs.container,{model:c,menuContainer:b.refs.portal,tooltipContainer:b.getTooltipContainer()});b.update();c.on("change",b.onModelChange)})},onModelChange:function a(b){if(this.ui&&(b.changes.includes("transaction_category")||b.changes.includes("folder"))){this.update()}},update:function a(){this.ui.injectDependencies(this.getParams());this.ui.render()},unrenderUI:function a(){this.ui&&this.ui.destroy();this.ui=null;var b=this.getMessage(this.get("model"));if(b){b.off("change",this.onModelChange)}},getParams:function a(){return{CategoryChange:n.default,SaveSeveral:e.SaveSeveral,isOctavius:true,isDarkMode:this.is("dark-mode"),features:j.default,bridge:this.getBridge(),metathreads:this.is("metathreads"),scrollable:this.getScrollable()}},getMessage:function a(b){return b&&b.get("messages").find(function(a){return a.getFolder()===b.getFolder()})},getTooltipContainer:function a(){if(!this._tooltipContainer){this._tooltipContainer=document.createElement("div");document.body.appendChild(this._tooltipContainer)}return this._tooltipContainer},getBridge:function a(){if(!this._bridge){this._bridge=new k.default;this._bridge.on("radar",function(a){var b=a.chain;(0,p.default)(b)})}return this._bridge},getScrollable:function a(){var b=this.refs.container;var c=(0,i.selector)(".scrollable");while(b&&b!==document){if(b.matches(c)){return b}b=b.parentNode}}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item/letter-list-item.html",["feast"],function(a){return a.smartParse('<a\n\tremit:click="clickletter"\n\tqa:id="letter-item:subject:{attrs.model.get(\'subject\') || i18n(\'<Без темы>\')}"\n>\n\n\t<fn:var name="compressed" value="{attrs.compressed}"/>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageFolder" value="{message.getFolder()}"/>\n\t<fn:var name="messageSubject" value="{message.get(\'subject\') || i18n(\'<Без темы>\')}" />\n\n\t<fn:var name="selectMode" value="{attrs[\'select-mode\']}"/>\n\t<fn:var name="selectable" value="{!attrs[\'disable-select\']}"/>\n\t<fn:var name="isDraft" value="{attrs.draft}"/>\n\n\t<fn:if test="message.isHigh()">\n\t\t<fn:var name="category" value="important"/>\n\t</fn:if>\n\n\t<fn:if test="!attrs[\'disable-category\'] && message.get(\'transaction_category\') && !messageFolder.isSpam()">\n\t\t<fn:var name="category" value="{message.get(\'transaction_category\')}"/>\n\t</fn:if>\n\n\t\x3c!-- Особый случай, когда у компактного письма без темы приоритет склеивается с папкой --\x3e\n\t<fn:var name="specialCase"\n\t\t\tvalue="{attrs.compact && attrs[\'disable-subject\'] && category}"/>\n\n\t<fn:attr name="data-shortcut" value="list-letter"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{message.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{message.get(\'id\')}"/>\n\t<fn:attr name="data-uidl-id" value="{message.get(\'last\')}"/>\n\n\t<bem:mod name="unread_{message.is(\'flags.unread\')}"/>\n\t<bem:mod name="flagged_{message.is(\'flags.flagged\')}"/>\n\t<bem:mod name="attach_{message.is(\'flags.attach\')}"/>\n\n\t<bem:mod name="active" test="attrs.active"/>\n\t<bem:mod name="showfolder" test="attrs.showfolder || specialCase || isDraft"/>\n\t<bem:mod name="selected" test="attrs.selected"/>\n\t<bem:mod name="first" test="attrs.first" />\n\t<bem:mod name="last" test="attrs.last" />\n\t<bem:mod name="select-mode" test="selectMode"/>\n\t<bem:mod name="draft" test="isDraft"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t<bem:mod name="disable-user-select" value="{attrs[\'disable-user-select\'] ? \'on\' : \'off\'}"/>\n\t<bem:mod name="disable-subject" value="{attrs[\'disable-subject\'] ? \'on\' : \'off\'}"/>\n\n\t<bem:mod name="compressed" test="compressed"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="fluid" test="!attrs.compact"/>\n\t<bem:mod name="touch" test="attrs.touch" />\n\t<bem:mod name="swipe-actions-touched" test="attrs[\'swipe-actions-touched\']"/>\n\t<bem:mod name="swipe-actions-visible" test="attrs[\'swipe-actions-visible\']"/>\n\t<bem:mod name="swipe-actions-animated" test="attrs[\'swipe-actions-animated\']"/>\n\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="indent" test="attrs.indent"/>\n\n\t\x3c!-- Пометка прочитанным --\x3e\n\t<fn:match name="status-unread">\n\t\t<div bem:elem="unread" remit:click.prevent="togglestatus:unread" qa:id="unread">\n\t\t\t<bem:mod name="plain" test="!(message.is(\'flags.forward\') || message.is(\'flags.reply\'))"/>\n\t\t\t<b:letter-status2\n\t\t\t\tname="unread"\n\t\t\t\tsmall\n\t\t\t\tforward="{message.is(\'flags.forward\')}"\n\t\t\t\treply="{message.is(\'flags.reply\')}"\n\t\t\t\tstate="{message.is(\'flags.unread\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Пометка важным --\x3e\n\t<fn:match name="status-flag">\n\t\t<div bem:elem="flag" remit:click.prevent="togglestatus:flagged" qa:id="flagged">\n\t\t\t<b:letter-status2\n\t\t\t\tname="flagged"\n\t\t\t\tsmall\n\t\t\t\tstate="{message.is(\'flags.flagged\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Бейдж папки --\x3e\n\t<fn:match name="folder">\n\t\t<fn:choose>\n\t\t\t<fn:when test="isDraft">\n\t\t\t\t<div bem:elem="folder">\n\t\t\t\t\t<b:badge text="{i18n(\'Черновик\')}" size="l"/>\n\t\t\t\t</div>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="specialCase">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="{category}"\n\t\t\t\t\tshort="{attrs.showfolder}"\n\t\t\t\t/>\n\n\t\t\t\t<b:badge\n\t\t\t\t\tfn:if="attrs.showfolder"\n\t\t\t\t\ttext="{messageFolder.get(\'name\')}"\n\t\t\t\t\tsize="l"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="attrs.showfolder">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="message.isSchedule()">\n\t\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t\t<div bem:elem="folder">\n\t\t\t\t\t\t\t<b:badge title="{message.get(\'send_date\') | scheduleDate}" text="{messageFolder.get(\'name\')}" size="l"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<div bem:elem="folder">\n\t\t\t\t\t\t\t<b:badge text="{messageFolder.get(\'name\')}" size="l"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:when>\n\t\t</fn:choose>\n\t</fn:match>\n\n\t\x3c!-- Бейдж треда --\x3e\n\t<fn:match name="thread-badge">\n\t\t<fn:var\n\t\t\tname="text"\n\t\t\tvalue="{message.get(\'length\') > 99 ? \'99+\' : message.get(\'length\')}"\n\t\t\ttest="message.get(\'length\') > 1"/>\n\n\t\t<div\n\t\t\tbem:elem="thread-count"\n\t\t\tfn:if="!(attrs[\'disable-subject\'] && attrs.compact) && (text || category)">\n\t\t\t<bem:mod name="1" test="message.get(\'length\') > 1"/>\n\t\t\t<bem:mod name="2" test="message.get(\'length\') > 9"/>\n\t\t\t<bem:mod name="3" test="message.get(\'length\') > 99"/>\n\t\t\t<b:letter-category name="{category}" text="{text}" short="{!text}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Отложенная отправка (когда не показываем имя папки) --\x3e\n\t<fn:match name="schedule">\n\t\t<fn:if test="!attrs.showfolder">\n\t\t\t<div bem:elem="schedule">\n\t\t\t\t<b:letter-status2\n\t\t\t\t\ttitle="{message.get(\'send_date\') | scheduleDate}"\n\t\t\t\t\tname="schedule"\n\t\t\t\t\tsmall/>\n\t\t\t</div>\n\t\t</fn:if>\n\t</fn:match>\n\n\t\x3c!-- Иконка вложений --\x3e\n\t<fn:match name="attach">\n\t\t<div bem:elem="attach">\n\t\t\t<b:letter-status2\n\t\t\t\tname="attach"\n\t\t\t\tsmall\n\t\t\t\tstate="{true}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Время отправки письма --\x3e\n\t<fn:match name="date">\n\t\t<div bem:elem="date">\n\t\t\t<fn:value mod="letterDate">message.get(\'date\')</fn:value>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Тема письма --\x3e\n\t<fn:match name="subject">\n\t\t<div\n\t\t\tbem:elem="subject"\n\t\t\tqa:id="subject"\n\t\t>\n\t\t\t<fn:if test="!attrs.search">\n\t\t\t\t{messageSubject}\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs.search">\n\t\t\t\t<b:highlighter\n\t\t\t\t\ttext="{messageSubject}"\n\t\t\t\t\tcolor="{message.meta(\'search_subject.color\')}"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- распорка --\x3e\n\t\t\t\t<fn:value>\' \'</fn:value>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Сниппет --\x3e\n\t<fn:match name="snippet">\n\t\t<div bem:elem="snippet" qa:id="snippet">\n\t\t\t<fn:if test="!attrs.search">\n\t\t\t\t{message.get(\'snippet\')}\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs.search">\n\t\t\t\t<b:highlighter\n\t\t\t\t\ttext="{message.meta(\'search_snippet.value\')}"\n\t\t\t\t\tcolor="{message.meta(\'search_snippet.color\')}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Отправитель --\x3e\n\t<fn:match name="addrs">\n\t\t<div bem:elem="addrs">\n\t\t\t<fn:value mod="correspondent">_this.getCorrespondents()</fn:value>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Аватарка --\x3e\n\t<fn:match name="avatar-wrap">\n\t\t<div bem:elem="avatar-wrap">\n\t\t\t<fn:apply-match name="status-unread" fn:if="!attrs.compact"/>\n\t\t\t<div bem:elem="avatar" remit:click="clickavatar" qa:id="avatar">\n\t\t\t\t<b:avatar\n\t\t\t\t\t\tsize="{attrs.compact && !compressed ? \'m\' : \'s\'}"\n\t\t\t\t\t\tsrc="{_this.getAvatar()}"\n\t\t\t\t\t\tselectable="{selectable}"\n\t\t\t\t\t\tselected="{attrs.selected}"\n\t\t\t\t\t\ttouch="{!attrs[\'hover-support\']}"/>\n\t\t\t</div>\n\t\t\t<fn:apply-match name="status-unread" fn:if="attrs.compact"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Наконец то сам контейнер --\x3e\n\t<b:swipeable use:mediator="swipe-manager"\n\t\t\t\t remit:underlay-changed="underlay:changed"\n\t\t\t\t remit:animation-changed="animation:changed"\n\t\t\t\t remit:pan-changed="pan:changed"\n\n\t\t\t\t max-offset="{attrs.compact ? null : \'170\'}"\n\t\t\t\t disabled="{selectMode}"\n\t\t\t\t id="swipeable">\n\t\t<fn:match name="swipe-underlay">\n\t\t\t\x3c!-- Подложка контейнера --\x3e\n\t\t\t<b:letter-swipe-actions model="{message}"\n\t\t\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\t\tremit:action-unread="togglestatus:unread"\n\t\t\t\t\t\t\t\t\tremit:action-flagged="togglestatus:flagged"\n\t\t\t\t\t\t\t\t\tremit:action-remove="remove"\n\t\t\t\t\t\t\t\t\tremit:action-spam="spam"\n\t\t\t\t\t\t\t\t\tremit:action-unspam="unspam"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager"/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-content-fading" bem:block="letter-list-item">\n\t\t\t\x3c!-- Аватарка --\x3e\n\t\t\t<fn:apply-match name="avatar-wrap"/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-content" bem:block="letter-list-item">\n\t\t\t<div bem:elem="info">\n\n\t\t\t\t<fn:if test="attrs.compact">\n\t\t\t\t\t<div bem:elem="content">\n\t\t\t\t\t\t<div bem:elem="column" bem:mod="1">\n\t\t\t\t\t\t\t<fn:apply-match name="addrs"/>\n\t\t\t\t\t\t\t<fn:apply-match name="subject" fn:if="!attrs[\'disable-subject\']"/>\n\t\t\t\t\t\t\t<fn:apply-match name="snippet"/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div bem:elem="column" bem:mod="2">\n\t\t\t\t\t\t\t<fn:apply-match name="date"/>\n\t\t\t\t\t\t\t<fn:apply-match name="thread-badge" fn:if="!compressed"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="footer">\n\t\t\t\t\t\t<fn:apply-match name="folder"/>\n\t\t\t\t\t\t<fn:apply-match name="schedule" fn:if="message.isSchedule()"/>\n\t\t\t\t\t\t<fn:apply-match name="attach" fn:if="message.is(\'flags.attach\')"/>\n\t\t\t\t\t\t<fn:apply-match name="status-flag"/>\n\t\t\t\t\t\t<fn:apply-match name="thread-badge" fn:if="compressed"/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\n\t\t\t\t<fn:if test="!attrs.compact">\n\t\t\t\t\t<fn:apply-match name="addrs"/>\n\t\t\t\t\t<fn:apply-match name="status-flag"/>\n\t\t\t\t\t<fn:apply-match name="thread-badge"/>\n\n\t\t\t\t\t<div bem:elem="subject-wrapper">\n\t\t\t\t\t\t<fn:apply-match name="subject" fn:if="!attrs[\'disable-subject\']"/>\n\t\t\t\t\t\t<fn:apply-match name="snippet"/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="info-wrapper">\n\t\t\t\t\t\t<fn:apply-match name="folder"/>\n\t\t\t\t\t\t<fn:apply-match name="schedule" fn:if="message.isSchedule()"/>\n\t\t\t\t\t\t<fn:apply-match name="attach"/>\n\t\t\t\t\t\t<fn:apply-match name="date"/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:swipeable>\n</a>\n',"app/feast-tpl!ui-block/letter-list-item/letter-list-item.html")});define("feast-tpl!ui-block/letter-list-item/letter-list-item.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item/letter-list-item.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/letter-status2/letter-status2.html",["feast"],function(a){return a.smartParse('<div qa:id="{attrs.name}:{attrs.state}">\n\t<fn:var name="data" value="{_this.getData()}"/>\n\n\t<bem:mod name="{attrs.name}"/>\n\t<bem:mod name="{attrs.state}"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t<b:button2\n\t\t\tico="{data.ico}"\n\t\t\tico-hover="{data.icoHover}"\n\t\t\ttitle="{data.title}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tsize="{attrs.size}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tcompact="{attrs.compact}"\n\t\t\tsmall="{attrs.small}"\n\t\t\tremit:click="button-click"\n\t\t\tsecondary\n\t\t\tcentered\n\t/>\n</div>\n',"app/feast-tpl!ui-block/letter-status2/letter-status2.html")});define("feast-tpl!ui-block/letter-status2/letter-status2.html",["feast-tpl!app/feast-tpl!ui-block/letter-status2/letter-status2.html"],function(a){return a});define("ui-block/letter-status2/letter-status2",["exports","feast","feast-tpl!./letter-status2.html","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"letter-status2",template:f.default,blocks:{ico:h.default,button2:g.default},defaults:{name:"unread",state:false,reply:false,forward:false,disabled:false},getData:function a(){var b=this.get("state");var c=this.get("forward");var d=this.get("reply");switch(this.get("name")){case"schedule":return{ico:"status:time",title:this.get("title")};case"attach":return{ico:"attach"};case"flagged":return{ico:b?"actions:favorite_on":"actions:favorite_off",title:b?i18n("Снять флажок"):i18n("Пометить флажком")};case"unread":var e="point";var f="point";if(b){e="point";f=""}else if(c&&d){e="mail_20:actions:forward_reply_small"}else if(c){e="mail_20:actions:forward_small"}else if(d){e="mail_20:actions:reply_small"}else{f=""}return{ico:e,icoHover:f,title:b?i18n("Пометить прочитанным"):i18n("Пометить непрочитанным")};case"dark-mode":return{ico:"logotypes:idea",title:b?i18n("Выключить тёмный режим"):i18n("Включить тёмный режим")}}},didMount:function a(){this.el.classList.add("stop-animate")}})});define("ui-block/letter-list-item/letter-list-item",["exports","feast","default-values","feast-mod/correspondents","feast-mod/letter-date","feast-tpl!./letter-list-item.html","helpers/browser","helpers/radar-utils","service/layer","service/radars/decorator","ui-block/avatar/avatar","ui-block/badge/badge","ui-block/highlighter/highlighter","ui-block/letter-category/letter-category","ui-block/letter-status2/letter-status2","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/swipeable/swipeable"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var q=C(a);var r=C(e);var s=C(f);var t=C(h);var u=C(i);var v=C(j);var w=C(k);var x=C(l);var y=C(m);var z=C(n);var A=C(o);var B=C(p);function C(a){return a&&a.__esModule?a:{default:a}}exports.default=q.default.Block.extend((0,u.default)({id:"letter-item",events:[{name:"clickavatar",rename:function a(b){return b.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function a(b){return(0,g.renameRadarOnStatusToggle)(b,"unread")}},{name:"togglestatus:flagged",rename:function a(b){return(0,g.renameRadarOnStatusToggle)(b,"flagged")}},{name:"remove",data:g.getModelData},{name:"spam",data:g.getModelData},"unspam"]})({name:"letter-list-item",template:r.default,isolateEvents:false,performanceTrace:true,mods:{correspondent:c.correspondent,scheduleDate:d.scheduleDate,letterDate:d.letterDate},blocks:{"letter-category":y.default,"letter-status2":z.default,avatar:v.default,swipeable:B.default,badge:w.default,highlighter:x.default,"letter-swipe-actions":A.default},defaults:{"main-field":"from","swipe-actions-visible":false,"disable-subject":false,"disable-category":false,"hover-support":s.default.capabilities["hover-support"],"expand-attachment-dropdown":false},notVisualAttributes:{"list-index":true},attrChange:{"avatar-field":function a(b){return b==="from"||b==="to"?b:"from"}},events:{"pan:changed":"onPanChanged","underlay:changed":"onUnderlayChanged","animation:changed":"onAnimationChanged"},didMount:function a(){var b=t.default.getInstance();if(b&&b.el){this.ids.swipeable.addInsideTarget(b.el)}},onPanChanged:function a(b){this.set("swipe-actions-touched",b.details.value)},onAnimationChanged:function a(b){this.set("swipe-actions-animated",b.details.value)},onUnderlayChanged:function a(b){this.set("swipe-actions-visible",b.details.value)},getModel:function a(){var b=this.get("model");var c=b.get("messages.0");if(c&&!b.get("date")&&!b.get("snippet")){return c}return b},getCorrespondents:function a(){var b=this.get("model");var d=this.get("main-field");if(d==="from"){return(0,c.correspondentsFromMessage)(b,d)}return["to","cc"].map(function(a){return(0,c.correspondentsFromMessage)(b,a)}).filter(function(a){return!!a}).join(", ")},getAvatar:function a(){var d=this.get("model");var e=this.get("main-field");var f=(0,c.correspondentsAvatarFromMessage)(d,e);return f||b.DEFAULT_AVATAR_SRC},getSubject:function a(){var b=this.get("model");return b.get("subject")||i18n("<Без темы>")}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:letter-list-item\n\t\tcompact="{attrs.compact}"\n\t\ttouch="{attrs.touch}"\n\t\tdisabled\n\t\tdraft\n\t\tdisable-select\n\t\tdisable-subject\n\t\tdisable-category\n\t/>\n</div>\n',"app/feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html")});define("feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html"],function(a){return a});define("ui-block/letter-list-item-placeholder/letter-list-item-placeholder",["exports","feast","feast-tpl!./letter-list-item-placeholder.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"letter-list-item-placeholder",template:d.default})});define("feast-tpl!app/feast-tpl!ui-block/letter-meta/letter-meta.html",["feast"],function(a){return a.smartParse("<div/>\n\n","app/feast-tpl!ui-block/letter-meta/letter-meta.html")});define("feast-tpl!ui-block/letter-meta/letter-meta.html",["feast-tpl!app/feast-tpl!ui-block/letter-meta/letter-meta.html"],function(a){return a});define("mediator/settings-events",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.settingsEvents=void 0;exports.settingsEvents={openPulseSubscriptions:"subscriptions:open",openCleanmailbox:"cleanmailbox:open"}});define("feast-tpl!app/feast-tpl!ui-block/filters/filters.html",["feast"],function(a){return a.smartParse('<div promo:id="portal-menu-filters">\n\t<fn:var name="folder" value="{attrs.folder}" />\n\t<fn:var name="filter" value="{_this.getFilter(attrs.filter)}" />\n\t<fn:var name="filters" value="{_this.filters}" />\n\t<fn:var name="selectedFilterIndexes" value="{_this.getSelectedFilterIndexes()}"/>\n\t<fn:var name="settings" value="{_this.getSettings()}" />\n\t<fn:var name="sortingEnable" value="{_this.isSortingEnable()}" />\n\t<fn:var name="showResetAll" value="{_this.isShowResetAll()}"/>\n\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="full" value="{!attrs.short}" />\n\t<fn:var name="touch" value="{attrs.touch}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}" />\n\t<fn:var name="alignRight" value="{_this.isAlignRight()}" />\n\n\t<fn:var name="layoutType" value="{attrs.type}" />\n\n\t<bem:mod name="short" test="short" />\n\t<bem:mod name="full" test="full" />\n\t<bem:mod name="touch" test="touch" />\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\x3c!-- Шаблон элемента списка - фильтра --\x3e\n\t<fn:match\n\t\tname="item"\n\t\targs="item, key, isSelected, isDisabled, text, icon, touch"\n\t>\n\t\t<fn:var name="type" value="{item.type}" />\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tdisabled="{isDisabled}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\t\t\tqa:id="{type}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="ico" fn:if="icon">\n\t\t\t\t<b:ico name="{icon}" size="s" />\n\t\t\t</span>\n\n\t\t\t<span bem:elem="text"> {text} </span>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t<fn:match\n\t\tname="unselectable-item"\n\t\targs="item, key, isSelected, text, icon, helpLink, touch, event"\n\t>\n\t\t<fn:var name="test" value="threads:toggle" />\n\t\t<fn:var name="type" value="{item.type}" />\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\t\t\tqa:id="{type}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="filters:unselectable-item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="ico" fn:if="icon">\n\t\t\t\t<b:ico name="{icon}" size="s" />\n\t\t\t</span>\n\n\t\t\t<span bem:elem="text"> {text} </span>\n\t\t\t\x3c!-- Для метатредов при клике открывается попап настроек, где будет ссылка на help, но в дропдауне скрываем\t--\x3e\n\t\t\t<fn:if test="helpLink && helpLink!==\'metathreads\' && !attrs[\'hide-help\']">\n\t\t\t\t<fn:apply-match\n\t\t\t\t\tname="help-link"\n\t\t\t\t\targs="helpLink, attrs[\'help-links\'][helpLink]"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t<fn:match name="help-link" args="eventName, link">\n\t\t<b:settings-help-link\n\t\t\tevent-details="{eventName}"\n\t\t\tlink="{link}"\n\t\t\tuse:mediator="settings-manager pony-mode"\n\t\t/>\n\t</fn:match>\n\n\t\x3c!-- Селект "Фильтры" --\x3e\n\t<b:select\n\t\tref="select"\n\t\tid="select"\n\t\tremit:item-click="select:item-click"\n\t\tremit:toggle="select:list-toggle"\n\t\tremit:sorting-open-submenu="select:sorting-open-submenu"\n\t\tremit:reset-all="select:reset-all"\n\t\titems="{filters}"\n\t\ttouch="{touch}"\n\t\tmultiple="{true}"\n\t\tselected-index="{selectedFilterIndexes}"\n\t\tautochange="{attrs.autochange}"\n\t\talign-right="{alignRight}"\n\t>\n\t\t<fn:match name="control" args="_, selectedItem, selectedIndex, expanded">\n\t\t\t<b:filters-control\n\t\t\t\tfilters="{selectedItem}"\n\t\t\t\tsortingType="{attrs.sortingType}"\n\t\t\t\tfolder="{folder}"\n\t\t\t\tfull="{full}"\n\t\t\t\tshort="{short}"\n\t\t\t\tactive="{attrs.expanded}"\n\t\t\t\tsidebar-column="{_this.get(\'sidebar-column\')}"\n\t\t\t\tmain-column="{_this.get(\'main-column\')}"\n\t\t\t\tpure="{attrs.pure}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tpressed="{expanded}"\n\t\t\t\tlayoutType="{layoutType}"\n\t\t\t\tdefault-filter-text="{_this.getDefaultFilterText()}"\n\t\t\t\tremit:click="control-click"\n\t\t\t\tcombineFilterAndFolderName="{attrs.combineFilterAndFolderName}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match\n\t\t\tname="items"\n\t\t\targs="items, selectedItem, selectedIndex, disabledItem, disabledIndex, touch"\n\t\t>\n\t\t\t\x3c!-- Список фильтров --\x3e\n\t\t\t<b:list touch="{touch}" qa:id="filters-dropdown">\n\t\t\t\t<fn:for data="items" as="item">\n\t\t\t\t\t<fn:var name="key" value="{item.text}" />\n\t\t\t\t\t<fn:var name="text" value="{item.text}" />\n\t\t\t\t\t<fn:var\n\t\t\t\t\t\tname="isSelected"\n\t\t\t\t\t\tvalue="{selectedItem.filter((element) => element.text === key).length}"\n\t\t\t\t\t/>\n\t\t\t\t\t<fn:var name="isDisabled" value="{key === disabledItem.text}" />\n\t\t\t\t\t<fn:var name="icon" value="{item.icon}" />\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\tname="item"\n\t\t\t\t\t\targs="item, key, isSelected, isDisabled, text, icon, touch"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\n\t\t\t\t<fn:if test="sortingEnable">\n\t\t\t\t\t\x3c!-- Сортировка --\x3e\n\t\t\t\t\t<div bem:elem="hr" />\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\tid="sorting"\n\t\t\t\t\t\tqa:id="sorting"\n\t\t\t\t\t\tnested\n\t\t\t\t\t\tkey="sorting"\n\t\t\t\t\t\tremit:click="sorting-open-submenu"\n\t\t\t\t\t\tmarkable\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="text"> {i18n(\'Сортировка\')} </span>\n\n\t\t\t\t\t\t<span bem:elem="nested">\n\t\t\t\t\t\t\t<b:ico name="navigation:drop_next" size="s" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<fn:if test="showResetAll">\n\t\t\t\t\t\t\x3c!-- Сбросить всё --\x3e\n\t\t\t\t\t\t<div bem:elem="hr" />\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\t\tqa:id="resetAll"\n\t\t\t\t\t\t\tkey="resetAll"\n\t\t\t\t\t\t\tremit:click="reset-all"\n\t\t\t\t\t\t\tmarkable\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="text"> {i18n(\'Сбросить всё\')} </span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\n\t\t\t\t\x3c!-- Внешний вид --\x3e\n\t\t\t\t<fn:if test="settings">\n\t\t\t\t\t<div bem:elem="hr">\n\t\t\t\t\t\t<bem:mod name="markable" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bem:elem="caption">\n\t\t\t\t\t\t<bem:mod name="markable" />\n\t\t\t\t\t\t{i18n(\'Внешний вид\')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<fn:for data="settings" as="item">\n\t\t\t\t\t\t<fn:var name="key" value="{item.text}" />\n\t\t\t\t\t\t<fn:var name="text" value="{item.text}" />\n\t\t\t\t\t\t<fn:var name="isSelected" value="{item.isOn}" />\n\t\t\t\t\t\t<fn:var name="icon" value="{item.icon}" />\n\t\t\t\t\t\t<fn:var name="helpLink" value="{item.helpLink}" />\n\t\t\t\t\t\t<fn:var name="event" value="{item.event}" />\n\t\t\t\t\t\t<fn:var name="couldToggle" value="{item.couldToggle}" />\n\n\t\t\t\t\t\t<fn:if test="couldToggle">\n\t\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="unselectable-item"\n\t\t\t\t\t\t\t\targs="item, key, isSelected, text, icon, helpLink, touch, event"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</fn:if>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:select>\n</div>\n',"app/feast-tpl!ui-block/filters/filters.html")});define("feast-tpl!ui-block/filters/filters.html",["feast-tpl!app/feast-tpl!ui-block/filters/filters.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/filters-control/filters-control.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="folder" value="{attrs.folder}" />\n\t<fn:var name="sortingType" value="{attrs.sortingType}" />\n\t<fn:var name="folderName" value="{folder.get(\'name\')}" />\n\t<fn:var name="activeFilters" value="{_this.getActiveFilters()}" />\n\t<fn:var name="activeFiltersAndSorting" value="{_this.getActiveFiltersAndSorting()}" />\n\t<fn:var name="controlIcons" value="{_this.getControlIcons()}" />\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}" />\n\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="full" value="{attrs.full}" />\n\t<fn:var name="defaultFilter" value="{activeFilters === \'all\'}" />\n\t<fn:var name="combinedMode" value="{full || short && !defaultFilter}" />\n\t<fn:var name="controlText" value="{_this.getControlText()}" />\n\n\t<bem:mod name="short" test="short" />\n\t<bem:mod name="full" test="full" />\n\t<bem:mod name="active" test="attrs.active" />\n\t<bem:mod name="pressed" test="attrs.pressed" />\n\n\t<bem:mod name="pure" test="attrs.pure" />\n\t<bem:mod name="base" test="!attrs.pure" />\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\t<bem:mod name="with-folder" test="combinedMode && attrs.combineFilterAndFolderName" />\n\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()" />\n\n\t<fn:attr name="title" value="{controlText}" />\n\n\t\x3c!-- Папка --\x3e\n\t<fn:match name="folder-block">\n\t\t<span bem:elem="folder" qa:id="folder-name-filter">\n\t\t\t<fn:value>folderName</fn:value>\n\t\t</span>\n\t</fn:match>\n\n\t\x3c!-- Фильтр --\x3e\n\t<fn:match name="filter-block">\n\t\t<span bem:elem="filter">\n\t\t\t<bem:mod name="short" test="short" />\n\t\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t\t<span bem:elem="filter-icon" fn:if="controlIcons.length">\n\t\t\t\t<fn:for data="controlIcons" as="filterIcon">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{filterIcon}"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tkey="icon-{filterIcon}"\n\t\t\t\t\t\tqa:id="filter-icon-{filterIcon}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tbem:elem="filter-text"\n\t\t\t\tqa:id="filter-text"\n\t\t\t\tpromo:id="octavius-tooltip-mailbox-sort"\n\t\t\t\tqa:state="{activeFiltersAndSorting}"\n\t\t\t>\n\t\t\t<fn:var name="isFixedWidthFilterText" value="{_this.isFixedWidthFilterText()}" />\n\t\t\t<bem:mod name="{isFixedWidthFilterText.width}" fn:if="isFixedWidthFilterText.fixed" />\n\t\t\t\t{controlText}\n\t\t\t</span>\n\t\t</span>\n\t</fn:match>\n\n\t\x3c!-- Подробный вид --\x3e\n\t<div bem:elem="text" fn:if="full">\n\t\t<bem:mod name="combined" fn:if="combinedMode" />\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t<fn:apply-match name="folder-block" />\n\n\t\t<span bem:elem="filter" fn:if="combinedMode" qa:id="filter-text" promo:id="octavius-tooltip-mailbox-sort">\n\t\t\t<bem:mod name="{_this.isFixedWidthFilterText().width}" fn:if="_this.isFixedWidthFilterText().fixed" />\n\t\t\t<fn:value>controlText</fn:value>\n\t\t</span>\n\t</div>\n\n\t\x3c!-- Компактный вид --\x3e\n\t<div bem:elem="text" fn:if="short">\n\t\t<bem:mod name="default-filter" fn:if="activeFilters === \'all\'" />\n\n\t\t<fn:apply-match name="filter-block" />\n\t</div>\n\n\t\x3c!-- Стрелка --\x3e\n\t<div bem:elem="arrow-down-icon">\n\t\t<b:ico name="navigation:drop_down" size="s" />\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/filters-control/filters-control.html")});define("feast-tpl!ui-block/filters-control/filters-control.html",["feast-tpl!app/feast-tpl!ui-block/filters-control/filters-control.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/filters-control/filters-control",["require","exports","default-values","feast","feast-tpl!./filters-control.html","mrg-i18n-utils","ui-block/list-nested-sorting/sorting"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);exports.default=b.default.Block.extend({name:"filters-control",template:c.default,defaults:{"pony-mode":false},getControlText:function(){var a=this.get("full");var b=this.get("default-filter-text");var c=this.get("filters");var f=this.get("sortingType");if(a){if(f&&f!=="D"&&c.length>1){return d.default("Фильтры")+": "+c.length+", "+new e.default(f).controlText}if(f&&f!=="D"&&c.length===1&&c[0].type!=="all"){return c[0].text+", "+new e.default(f).controlText}if(f&&f!=="D"){return new e.default(f).controlText}if(c.length>1){return d.default("Фильтры")+": "+c.length}if(c.length){return""+c[0].text}}if(f&&f!=="D"){return new e.default(f).controlText}if(c.length===1&&c[0].type==="all"){return b}if(c.length>1){return d.default("Фильтры")}return c[0].text},getControlIcons:function(){var a=this.get("filters");return a.map(function(a){return a.icon})},getActiveFilters:function(){var a=this.get("filters");return a.map(function(a){return a.type}).join(",")},getActiveFiltersAndSorting:function(){var a=this.get("sortingType");return this.getActiveFilters()+"|"+a},isFixedWidthFilterText:function(){if(a.PORTAL_MENU_MORE_FOLDER_ACTIONS){return this.isFixedWidthFilterTextWithKebab()}var b=this.get("sidebar-column");if(this.get("full")){return{fixed:b<75,width:"maxWidth150"}}var c=this.get("filters");if(Object.keys(c).length===3&&b<80){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===3&&b>=100){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===2&&b<75){return{fixed:true,width:"maxWidth100"}}return{fixed:false,width:""}},useNewToolbar:function(){return a.NEW_TOOLBAR},isFixedWidthFilterTextWithKebab:function(){var a=this.get("sidebar-column");var b=this.get("pony-mode");var c=this.get("filters");var d=Object.keys(c).length;var e=this.get("sortingType");if(this.get("full")){if(a<79){return{fixed:true,width:"maxWidth100"}}if(a<93){return{fixed:true,width:"maxWidth150"}}if(a>=100&&a<109){return{fixed:true,width:"maxWidth100"}}return{fixed:a<75||a>=109&&a<123,width:!b?"maxWidth100":"maxWidth150"}}if(this.get("layoutType")==="3pane"){if(!b){if(a<74){if(e&&e!=="D"&&d<1){return{fixed:true,width:"maxWidth100"}}if(d<=1){return{fixed:true,width:"maxWidth80"}}if(d<=2){return{fixed:true,width:"maxWidth60"}}return{fixed:true,width:"maxWidth40"}}if(a<79){return{fixed:true,width:"maxWidth60"}}if(a<88){return{fixed:true,width:"maxWidth80"}}}if(a<73){return{fixed:true,width:"maxWidth60"}}if(a<77||a>=100&&a<107){return{fixed:true,width:"maxWidth80"}}}if(Object.keys(c).length===3&&a<80){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===3&&a>=100){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===2&&a<75){return{fixed:true,width:"maxWidth100"}}return{fixed:false,width:""}}})});define("feast-tpl!app/feast-tpl!ui-block/select/select.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="expanded" value="{attrs.expanded}"/>\n\t<fn:var name="touch" value="{attrs.touch}" />\n\t<fn:var name="userToggled" value="{_this.userToggled}"/>\n\t<fn:var name="items" value="{attrs.items}"/>\n\t<fn:var name="selectedIndex" value="{_this.getSelectedIndex()}"/>\n\t<fn:var name="selectedItem" value="{_this.getSelectedItem()}"/>\n\t<fn:var name="disabledIndex" value="{attrs[\'disabled-index\']}"/>\n\t<fn:var name="disabledItem" value="{_this.getItem(disabledIndex)}" />\n\t<fn:var name="alignRight" value="{attrs[\'align-right\']}" />\n\t\x3c!-- Для передачи массива selectedIndex --\x3e\n\t<fn:var name="multiple" value="{attrs.multiple}"/>\n\n\t<bem:mod name="touch" test="touch"/>\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\n\n\t\x3c!-- Контрол --\x3e\n\t<fn:match name="control" args="selectedText, selectedItem, selectedIndex, expanded">\n\t\t<b:button2\n\t\t\ttext="{selectedText}"\n\t\t\tpressed="{expanded}"\n\t\t\tremit:click="control-click"\n\t\t/>\n\t</fn:match>\n\n\t\x3c!-- Элемент --\x3e\n\t<fn:match name="item" args="item, key, isSelected, isDisabled, text, icon, touch">\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tdisabled="{isDisabled}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\n\t\t\tqa:id="{key}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="ico" fn:if="icon">\n\t\t\t\t<b:ico name="{icon}" size="s" />\n\t\t\t</span>\n\n\t\t\t<span bem:elem="text">\n\t\t\t\t<fn:value>text</fn:value>\n\t\t\t</span>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t\x3c!-- Список элементов --\x3e\n\t<fn:match name="items" args="items, selectedItem, selectedIndex, disabledItem, disabledIndex, touch">\n\t\t<b:list\n\t\t\ttouch="{touch}"\n\t\t>\n\t\t\t<fn:for data="items" as="item">\n\t\t\t\t<fn:var name="key" value="{_this.getItemAttr(item, \'key\')}"/>\n\t\t\t\t<fn:var name="text" value="{_this.getItemAttr(item, \'text\')}"/>\n\t\t\t\t<fn:var name="isSelected" value="{key === _this.getItemAttr(selectedItem, \'key\')}"/>\n\t\t\t\t<fn:var name="isDisabled" value="{key === _this.getItemAttr(disabledItem, \'key\')}" />\n\t\t\t\t<fn:var name="icon" value="{_this.getItemAttr(item, \'icon\')}"/>\n\n\t\t\t\t\x3c!-- Элемент --\x3e\n\t\t\t\t<fn:apply-match name="item" args="item, key, isSelected, isDisabled, text, icon, touch"/>\n\t\t\t</fn:for>\n\t\t</b:list>\n\t</fn:match>\n\n\t\x3c!-- Кнопка выбора --\x3e\n\t<div bem:elem="control">\n\t\t<fn:var name="selectedText" value="{_this.getItemAttr(selectedItem, \'text\')}"/>\n\t\t<fn:apply-match name="control"\n\t\t\t\t\t\targs="selectedText, selectedItem, selectedIndex, expanded"/>\n\t</div>\n\n\t\x3c!-- Выпадающий список --\x3e\n\t<div bem:elem="items">\n\t\t<bem:mod name="expanded" test="expanded"/>\n\t\t<bem:mod name="collapsed" test="!expanded && userToggled"/>\n\t\t<bem:mod name="align-right" test="alignRight" />\n\n\t\t<fn:apply-match name="items" args="items, selectedItem, selectedIndex, disabledItem, disabledIndex, touch"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/select/select.html")});define("feast-tpl!ui-block/select/select.html",["feast-tpl!app/feast-tpl!ui-block/select/select.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/select/select",["require","exports","feast","feast-tpl!./select.html","ui-block/list/list","ui-block/list-item/list-item","../../lazy.modules"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"select",template:b.default,blocks:{list:c.default,"list-item":d.default},events:{"control-click":"onControlClick","item-click":"onItemClick","list-hide":"hide"},defaults:{autochange:true,"default-selected-index":null,"disabled-index":null,expanded:false,items:[],"selected-index":null,touch:false},attrChanged:{"selected-index":function a(b){this.broadcast("item-change",this.getItem(b))},expanded:function a(b){var c=this;e.lazyMailKeymaster().then(e.uniqCallback(this,function(a){if(b){a("escape",c.onEscape)}else{a.unbind("escape",c.onEscape)}}));this.broadcast("toggle",b)}},userToggled:false,onControlClick:function(){this.userToggled=true;this.invert("expanded")},onOutsideClick:function(a){if(!this.el.contains(a.target)){this.hide()}},onItemClick:function(a){var b=a.details;this.hide();if(this.is("autochange")){this.set("selected-index",this.indexOf(b))}return true},hide:function(){this.set("expanded",false)},getItem:function(a){return this.get("items")[a]},getSelectedItem:function(){var a=this;if(this.get("multiple")){var b=[];this.getSelectedIndex().forEach(function(c){b.push(a.get("items")[c])});return b}return this.get("items")[this.getSelectedIndex()]},indexOf:function(a){return this.get("items").indexOf(a)},getSelectedIndex:function(){var a=this.get("selected-index");if(a==null){return this.get("default-selected-index")}return a},getItemAttr:function(a,b){if(!a){if(b==="text"){return i18n("Выберите элемент")}return null}if(typeof a.get!=="function"){if(b==="text"||b==="key"){return a[b]||a.text||String(a)}return a[b]}if(b==="key"){return a.get("key")||a.get("text")}return a.get(b)},didMount:function(){var a=this;this.set("selected-index",this.getSelectedIndex());this.toggleOutsideListener(true);this.onEscape=function(b){b.stopImmediatePropagation();a.hide()}},didUnmount:function(){this.toggleOutsideListener(false)},toggleOutsideListener:function(a){this[a?"$on":"$off"](this.el.ownerDocument,"click","onOutsideClick")}})});define("ui-block/filters/filter",["require","exports"],function(require,exports){"use strict";var a,b;Object.defineProperty(exports,"__esModule",{value:true});exports.FilterDefaultText=exports.LetterFilters=exports.FilterIcon=exports.FilterText=exports.FilterType=void 0;exports.FilterType={all:"all",unread:"unread",flagged:"flagged",withAttachments:"with_attachments"};exports.FilterText=(a={},a[exports.FilterType.all]=i18n("Все письма"),a[exports.FilterType.unread]=i18n("Непрочитанные"),a[exports.FilterType.flagged]=i18n("С флажком"),a[exports.FilterType.withAttachments]=i18n("С вложениями"),a);exports.FilterIcon=(b={},b[exports.FilterType.all]="",b[exports.FilterType.unread]="point",b[exports.FilterType.flagged]="flag",b[exports.FilterType.withAttachments]="attach",b);function c(a){this.type=a||exports.FilterType.all;this.text=exports.FilterText[this.type];this.icon=exports.FilterIcon[this.type]}exports.default=c;exports.LetterFilters=[new c(exports.FilterType.all),new c(exports.FilterType.unread),new c(exports.FilterType.flagged),new c(exports.FilterType.withAttachments)];exports.FilterDefaultText={filter:i18n("Фильтр"),view:i18n("Вид")}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/filters/filters",["require","exports","default-values","feast","feast-tpl!./filters.html","mail/User","service/radars/decorator","service/submenu","ui-block/filters-control/filters-control","ui-block/list-nested/list-nested","ui-block/list-nested-sorting/sorting","ui-block/select/select","./filter"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);exports.default=b.default.Block.extend(e.default({id:"filter",explicit:true,events:[{name:"threads:toggle",rename:"threads_toggle",immediate:true},{name:"metathreads:settings:open",rename:"metathreads_settings_toggle",immediate:true},{name:"priority:messages:toggle",rename:"priority_messages_click",immediate:true},{name:"ponymode:toggle",rename:"ponymode_click",immediate:true},{name:"help:open",rename:"help_open"},{name:"layout:toggle",rename:"layout_toggle",immediate:true},{name:"shortcuts:toggle",rename:"shortcuts_toggle",immediate:true}]})({name:"filters",template:c.default,blocks:{"filters-control":g.default,select:j.default,"list-nested":h.default},defaults:{expanded:false,filter:{all:true,unread:false,flagged:false,with_attachments:false},"pony-mode":false,autochange:true},events:{"select:item-change":"onFilterChange","select:item-click":"onFilterClick","select:list-toggle":"onToggle","select:sorting-open-submenu":"openSortingSubmenu","select:reset-all":"resetFiltersAndSortings","filters:unselectable-item-click":"onUnselectableItemClick"},filters:k.LetterFilters,getFilter:function(a){return k.LetterFilters.find(function(b){return b.type===a})},isShowResetAll:function(){return!(this.get("filter")["all"]&&i.isDefaultSorting(this.get("sortingType")))},onFilterChange:function(){},isFilterOn:function(a){return this.get("filter")[a]},onFilterClick:function(b){var c=b.details;var d=this.isFilterOn(c.type)?"_off":"_on";d=c.type==="all"?"_on":d;var e=c.type+"_click"+(a.ENABLE_MULTIPLE_FILTERS?d:"");this.radar(e);this.broadcast("filterclick",c.type)},openSortingSubmenu:function(){this.radar("open_sorting_submenu");f.default.open("sorting",{},this.ids["sorting"])},resetFiltersAndSortings:function(){this.radar("reset_filters_and_sorting");this.broadcast("resetall");this.ids.select.hide()},onToggle:function(a){var b=a.details;if(!b){f.default.close();return}this.radar("click-on")},getSelectedFilterIndexes:function(){var a=this;var b=[];Object.entries(this.get("filter")).forEach(function(c){var d=c[0],e=c[1];if(e){b.push(a.filters.findIndex(function(a){return a.type===d}))}});return b},isSortingEnable:function(){return a.ENABLE_SORTING},getSettings:function(){if(!this.get("has-metathreads-settings")){return null}var a=this.get("metathreadsSettings");return[{type:"metathreads",text:i18n("Умная сортировка писем"),isOn:a&&Object.values(a).some(function(a){return a===d.default.METATHREADS_STATES.ON||a===d.default.METATHREADS_STATES.HIDDEN}),couldToggle:!this.get("hide-metathreads")||!this.get("hide-to-myself"),event:"metathreads:settings:open",helpLink:"metathreads",from:"filter",metathreadsSettings:a},{type:"threads",text:i18n("Группировка по отправителю"),isOn:this.get("threads"),couldToggle:true,event:"threads:toggle",from:"filter",helpLink:"threads"},{type:"layout",text:i18n("Список писем с колонкой письма"),isOn:this.get("type")==="3pane",couldToggle:this.get("support3pane"),event:"layout:toggle",from:"filter",helpLink:"help3pane"},{type:"ponyMode",text:i18n("Компактный вид"),isOn:this.get("ponymode"),couldToggle:this.get("can-toggle-ponymode"),event:"ponymode:toggle",from:"filter"},{type:"shortcuts",text:i18n("Скрывать список папок"),isOn:this.get("manual-shortcuts"),couldToggle:this.get("can-toggle-shortcuts"),event:"shortcuts:toggle",from:"filter"}]},onUnselectableItemClick:function(a){var b=a.details;var c=b.event;if(c){this.broadcast(c,b)}this.ids.select.broadcast("list-hide")},isAlignRight:function(){return this.attrs.alignRight||!a.HIDE_METATHREADS&&this.get("type")!=="3pane"},getDefaultFilterText:function(){return k.FilterDefaultText.filter},didUnmount:function(){f.default.destroy()}}))});define("feast-tpl!app/feast-tpl!ui-block/settings/settings.html",["feast"],function(a){return a.smartParse('<div promo:id="settings">\n\t<fn:var name="dropdownTitle" value="{i18n(\'Настройки\')}" />\n\t<b:button2\n\t\tqa:id="settings"\n\t\tremit:click.prevent="settings-icon:click"\n\t\tradar-id="s-btn"\n\t\tshortcut="{attrs.shortcut}"\n\t\ttitle-shortcut="{attrs[\'title-shortcut\']}"\n\t\ttitle="{attrs.title}"\n\t\tannotation="{attrs.annotation}"\n\t\ttext="{dropdownTitle}"\n\t\tico="{attrs.ponymode ? \'navigation:settings_s\' : \'navigation:settings\'}"\n\t\trotate-ico="{attrs[\'rotate-ico\']}"\n\t\ttouch="{attrs.touch}"\n\t\tshort="{!attrs.showTitle}"\n\t\tico-text-top="{attrs[\'ico-text-top\']}"\n\t\tpure\n\t\tsecondary="{attrs.secondary}"\n\t\tsize="{attrs.size}"\n\t\tdisabled="{attrs.disabled}"\n\t\tcompact="{attrs.ponymode}"\n\t\tclean="{attrs.clean}"\n\t\tfont-size-pony="{attrs[\'font-size-pony\']}"\n\t\tnotification-badge="{attrs[\'notification-badge\']}"\n\t\talways-bright="{attrs[\'always-bright\']}"\n\t\tcentered="{!attrs.showTitle}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/settings/settings.html")});define("feast-tpl!ui-block/settings/settings.html",["feast-tpl!app/feast-tpl!ui-block/settings/settings.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/settings/settings",["require","exports","default-values","feast","feast-tpl!./settings.html","service/radars/decorator","ui-block/button2/button2"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);exports.default=b.default.Block.extend(d.default({events:[{name:"threads:toggle",rename:"threads_toggle",immediate:true},{name:"metathreads:toggle",rename:"metathreads_toggle",immediate:true},{name:"ponymode:toggle",rename:"ponymode_click",immediate:true},{name:"help:open",rename:"help_open"},{name:"notifications:click",rename:"notifications_click"},{name:"themes:panel",rename:"themes_panel"},{name:"layout:toggle",rename:"layout_toggle"},{name:"subscriptions:open",rename:"subscriptions_click"},{name:"settings:click",rename:"settings_click"},{name:"cleanmaster:click",rename:"cleanmaster_click"},{name:"language:click",rename:"language_click"},{name:"tomyself:toggle",rename:"tomyself_toggle",immediate:true},{name:"paginator:toggle",rename:"paginator_toggle",immediate:true},{name:"todo:toggle",rename:"todo_toggle",immediate:true},{name:"shortcuts:toggle",rename:"shortcuts_toggle",immediate:true},{name:"settings:open",rename:"dock"}]})({name:"settings",template:c.default,blocks:{button2:e.default},defaults:{"open-as-page":a.WEBVIEW},events:{"settings-icon:click":"onSettingsClick"},onSettingsClick:function(){this.broadcast(this.get("open-as-page")?"settings:click":"settings:open")}}))});define("feast-tpl!app/feast-tpl!ui-block/settings-dock/settings-dock.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:react-async\n\t\tcomponent="SettingsDock"\n\t\tshow="{attrs.show}"\n\t\tstartSection="{attrs.startSection}"\n\t\tapplicationElement="{_this.getApplicationElement()}"\n\t\tonEvent="{_this.handleEvent}"\n\t\tdarkMode="{attrs.darkMode}"\n\t\tuserLang="{attrs.userLang}"\n\t\tthirtyFiftyMode="{attrs.thirtyFiftyMode}"\n\t\tdisableExpand="{attrs.disableExpand}"\n\t\tdisableAutoExpand="{attrs.disableAutoExpand}"\n\t\tstartFullscreen="{attrs.startFullscreen}"\n\t\tsupport3pane="{attrs.support3pane}"\n\t\tlayoutType="{attrs.type}"\n\t\tcanTogglePonymode="{attrs[\'can-toggle-ponymode\']}"\n\t\tponymode="{attrs.ponymode}"\n\t\tcanToggleShortcuts="{attrs[\'can-toggle-shortcuts\']}"\n\t\tmanualShortcuts="{attrs[\'manual-shortcuts\']}"\n\t\tthreads="{attrs.threads}"\n\t\tthemes="{_this.getThemes()}"\n\t\tmetathreadsData="{attrs.metathreadsData}"\n\t\tonMetathreadsSettingsEdit="{_this.onMetathreadsSettingsEdit}"\n\t\tonMetathreadsHelpClick="{_this.onMetathreadsHelpClick}"\n\t\tcanToggleTodo="{attrs[\'can-toggle-todo\']}"\n\t\ttodo="{attrs.todo}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/settings-dock/settings-dock.html")});define("feast-tpl!ui-block/settings-dock/settings-dock.html",["feast-tpl!app/feast-tpl!ui-block/settings-dock/settings-dock.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/settings-dock/settings-dock",["require","exports","data-source/actions","default-values","feast","feast-tpl!./settings-dock.html","helpers/data-source-dispatch","service/smokescreen","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);exports.default=c.default.Block.extend({name:"settings-dock",template:d.default,defaults:{show:false,startSection:"appearance",applicationElement:null,thirtyFiftyMode:b.SETTINGS_DOCK_30_50_MODE,disableExpand:b.SETTINGS_DOCK_DISABLE_EXPAND_BUTTON,disableAutoExpand:b.SETTINGS_DOCK_DISABLE_AUTO_EXPAND,startFullscreen:b.SETTINGS_DOCK_START_FULL_SCREEN,support3pane:true,layoutType:"2pane","can-toggle-ponymode":true,ponymode:false,"can-toggle-shortcuts":true,"manual-shortcuts":false,threads:true,theme:null,darkMode:false,userLang:"ru_RU",metathreadsData:[],helpLink:"metathreads","can-toggle-todo":false,todo:false},constructor:function(){c.default.Block.apply(this,arguments);this.handleEvent=this.handleEvent.bind(this);this.onMetathreadsSettingsEdit=this.onMetathreadsSettingsEdit.bind(this);this.onMetathreadsHelpClick=this.onMetathreadsHelpClick.bind(this)},handleEvent:function(a){this.broadcast(a.type,a.details)},onMetathreadsSettingsEdit:function(b){var c=this;return e.default({type:a.EDIT_METATHREADS_SETTINGS,settings:b}).then(function(a){c.broadcast("metathreads:settings:updated");return a})},onMetathreadsHelpClick:function(){this.broadcast("help:open",this.attrs.helpLink)},getApplicationElement:function(){if(!this.applicationElenemt){this.applicationElement=document.querySelector(f.selector(".application-mail__wrap"))}return this.applicationElement},getThemes:function(){return{main:g.default.getModels(),colorized:g.default.getColorizedModels(),selected:g.default.getSelectedModel()}}})});define("feast-tpl!app/feast-tpl!ui-block/settings-help-link/settings-help-link.html",["feast"],function(a){return a.smartParse('<div\n\tremit:click.prevent.stop="help:open"\n\tevent:details="attrs[\'event-details\']"\n\tqa:id="help-link"\n>\n\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\t<a bem:elem="link" href="{attrs.link}" target="_blank" qa:id="settings-help-link">\n\t\t<b:ico name="{\'navigation:tip_round\'}"/>\n\t</a>\n\t<div bem:elem="empty" />\n</div>\n',"app/feast-tpl!ui-block/settings-help-link/settings-help-link.html")});define("feast-tpl!ui-block/settings-help-link/settings-help-link.html",["feast-tpl!app/feast-tpl!ui-block/settings-help-link/settings-help-link.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/settings-help-link/settings-help-link",["require","exports","feast","feast-tpl!./settings-help-link.html","service/radars/decorator"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend(c.default({events:[{name:"help:open",rename:"help_open"}]})({name:"settings-help-link",template:b.default}))});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/settings-manager",["require","exports","@mail/flags","@mail/xray","data-source/actions","data-source/utils/paginator","default-values","feast","helpers/data-source-dispatch","helpers/opener","mail/Folder","mail/User","mediator/settings-events","pilotjs","service/auth","service/layer","service/notify","service/promo","service/radars/index","service/themes.setup","ui-block/category-feedback/category-feedback","ui-block/filters/filters","ui-block/mobile-sidebar/mobile-sidebar","ui-block/nav-folders/nav-folders","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/settings-help-link/settings-help-link","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);var A={help3pane:e.HELP_3PANE,threads:e.HELP_THREADS,metathreads:e.HELP_METATHREADS,"to-myself":e.HELP_TO_MYSELF,paginator:e.HELP_PAGINATOR};var B=function(f){__extends(B,f);function B(){return f!==null&&f.apply(this,arguments)||this}B.prototype.getComponentsSpec=function(){return{router:{class:l.default},"settings-dock":{class:x.default,events:["threads:toggle","metathreads:settings:updated","help:open",k.settingsEvents.openPulseSubscriptions,"logs:click","settings:close",k.settingsEvents.openCleanmailbox],attrs:{userLang:function(){return e.USER_LANG},threads:function(a){return a.get("router.model.uiThreadsSettings").threads},metathreadsData:function(a){return a.getMetathreadsData()}}},settings:{class:w.default,events:["settings:click","settings:open"]},filters:{class:t.default,events:["help:open",k.settingsEvents.openPulseSubscriptions,"settings:click","threads:toggle","metathreads:toggle","notifications:click","cleanmaster:click","logs:click","language:click","tomyself:toggle","paginator:toggle","priority:messages:toggle","metathreads:settings:open"],attrs:{threads:function(a){return a.get("router.model.uiThreadsSettings").threads},metathreadsSettings:function(a){return a.get("router.model.uiThreadsSettings").metathreadsSettings},"to-myself":function(a){return a.get("router.model.uiThreadsSettings").toMyself},"can-toggle-paginator":function(a){return d.canPaginatorBeEnabled(a.get("router"))},"help-links":function(){return A},"hide-help":function(){return e.SETTINGS_DROPDOWN_HIDE_HELP},"hide-metathreads":function(){return e.HIDE_METATHREADS},"hide-to-myself":function(){return e.SETTINGS_DROPDOWN_HIDE_TO_MYSELF}}},"layer-metathreads-settings":{lazy:z.lazyUILayerMetathreadsSettings,events:["metathreads:settings:open","metathreads:settings:updated","help:open"],attrs:{metathreadsData:function(a){return a.getMetathreadsData()}}},"nav-folders":{class:v.default,events:["settings:click"]},"category-feedback":{class:s.default,attrs:{metathreads:function(a){return a.get("router.model.uiThreadsSettings").metathreads}}},letter:{lazy:z.lazyUILetter,attrs:{metathreads:function(a){return a.get("router.model.uiThreadsSettings").metathreads}},events:[k.settingsEvents.openPulseSubscriptions]},"settings-help-link":{class:y.default,events:["help:open"]},"mobile-sidebar":{class:u.default,events:["settings:click"]}}};B.prototype.handleEvent=function(a){switch(a.type){case"settings:open":this.onSettingsDockOpen();break;case"settings:close":this.onSettingsDockClose();break;case"help:open":this.onHelpOpen(a.details);break;case k.settingsEvents.openPulseSubscriptions:this.onSubscriptionsOpen();break;case k.settingsEvents.openCleanmailbox:this.onSettingsDockCleanmailboxOpen();break;case"settings:click":this.onSettingsClick();break;case"notifications:click":this.onNotificationsClick();break;case"cleanmaster:click":this.onCleanmasterClick();break;case"logs:click":z.lazyHelpersLogger().then(function(a){a.sendLogs()});break;case"language:click":this.onLanguageClick();break;case"priority:messages:toggle":this.onPriorityMessagesToggle();return false;case"threads:toggle":this.onThreadsToggle(a.details);return false;case"metathreads:toggle":this.onMetaThreadsToggle(a.details);return false;case"tomyself:toggle":this.onToMyselfToggle();return false;case"paginator:toggle":this.onPaginatorToggle();return false;case"metathreads:settings:open":this.onMetathreadsSettingsOpen(a.details);break}};B.prototype.onSettingsDockClose=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:false,startSection:"appearance"});p.default.update()};B.prototype.onSettingsDockOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true});p.default.update()};B.prototype.onSettingsMetathreadsOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"metathreads"})};B.prototype.onSettingsDockCleanmasterOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"cleanmaster"})};B.prototype.onSettingsDockAppearanceOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"appearance"})};B.prototype.onSettingsDockCleanmailboxOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"cleanmailbox"})};B.prototype.onSettingsDockBrowserSettingsOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"browsersettings"})};B.prototype.onCleanmasterClick=function(){h.default(e.CLEANMASTER_URL)};B.prototype.onHelpOpen=function(a){if(typeof a==="string"){h.default(A[a]);return}h.default(e.HELP_URL)};B.prototype.onSubscriptionsPostMessage=function(a){var b=a.details,c=b.message,d=b.layer;if(c.type==="close"){d.broadcast("layer:close");q.default("layer-pulse-subs_close")}if(c.type==="subscribe"){var e=c.data.id;q.default({type:"layer-pulse-subs_on",dwh:{id:e}})}if(c.type==="unsubscribe"){var e=c.data.id;q.default({type:"layer-pulse-subs_off",dwh:{id:e}})}};B.prototype.onSubscriptionsOpen=function(){var b=a.default.get("news-subscription-badge");if(b&&!b.isActive()){b.save({state:true,time:true})}q.default("layer-pulse-subs_show");var c=r.default.getSelectedModel().isDarkMode()?"dark":"light";if(e.SETTINGS_DOCK_PULSE_INLINE_DISABLED){n.default.openIframeLayer({paramsKey:"news-subscriptions",additionalParams:{url:e.FEED_SUBSCRIPTIONS_IFRAME_URL+("?theme="+c),width:760,height:625,scrolling:"auto",testId:"news-subscriptions-layer"},factoryParams:{dimmer:true,"close-on-esc":true},onPostMessage:this.onSubscriptionsPostMessage})}else{var d=this.get("settings-dock");d===null||d===void 0?void 0:d.set({show:true,startSection:"pulse"})}};B.prototype.onMetathreadsSettingsOpen=function(b){if(this.shouldShowAdActualLetters()){var c=a.default.get("actual-letters-badge");c.save({state:true,time:true});q.default("settings_ad_actual_letters_hide")}var d=this.get("router.model.folders");var e=!!d.find(function(a){return a.isNews()});var f=__assign(__assign({},b),{newsMetathreadFolder:e});n.default.open("metathreads-settings",f,f)};B.prototype.showMetathreadsSettingsPopup=function(){this.onMetathreadsSettingsOpen(this.get("router.model.uiThreadsSettings").metathreadsSettings)};B.prototype.onNotificationsClick=function(){h.default(e.NOTIFICATIONS_URL)};B.prototype.onSettingsClick=function(){h.default(e.SETTINGS_URL)};B.prototype.onThreadsToggle=function(a){var b=a&&a.from;var d=!this.get("router.model.uiThreadsSettings").threads;q.default({type:"threads-toggle-"+(d?"on":"off"),intervals:[[""+b,1]]});g.default({type:c.TOGGLE_THREADS_SETTING})};B.prototype.onMetaThreadsToggle=function(a){var b=a&&a.from;var d=!this.get("router.model.uiThreadsSettings").metathreads;q.default({type:"metathreads-toggle-"+(d?"on":"off"),intervals:[[""+b,1]]});if(!d&&e.METATHREADS_FORCED_EXP){q.default({type:"metathreads-forced-exp-off",dwh:{group:e.METATHREADS_FORCED_EXP.split("|")[0],folder:"folder"}})}g.default({type:c.TOGGLE_METATHREADS_SETTING})};B.prototype.onLanguageClick=function(){n.default.open("change-language",{currentLang:e.USER_LANG},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true}).then(function(a){var b=a===void 0?{resolveType:"error",lang:e.USER_LANG}:a,c=b.resolveType,d=b.lang;if(c==="ok"&&e.USER_LANG!==d){m.default.user.save("lang",d).then(function(){q.default(["settings-manager","save-lang",d]);window.location.reload()}).catch(function(){q.default(["settings-manager","save-lang-error"])})}}).catch(function(a){if(a){throw a}})};B.prototype.onPriorityMessagesToggle=function(){var a=!this.get("router.model.uiThreadsSettings").actualLettersInbox;g.default({type:c.TOGGLE_ACTUAL_MESSAGES_IN_INBOX,state:a});q.default({type:"priority_messages_"+(a?"enable":"disable"),intervals:[["settings",1]]})};B.prototype.onToMyselfToggle=function(){var a=this;var b=this.get("router.model.uiThreadsSettings").toMyself;if(!b){g.default({type:c.TOGGLE_TO_MYSELF_METATHREAD,state:true});q.default({type:"tomyself-enable",intervals:[["settings",1]]});return}var d=this.get("router.model.folders");var f=d.find(function(a){return a.isToMyself()});if(!f){q.default("tomyself-disable-no-folder");o.default.error({unique:true});return}var h=function(){g.default({type:c.TOGGLE_TO_MYSELF_METATHREAD,state:false});q.default({type:"tomyself-disable",intervals:[["settings",1]]});if(a.get("router.model.folder.id")===f.id){var b=a.get("router");b.go("#letters",{folder:i.default.TYPE_INBOX})}};if(e.LAYER_METATHREAD_DISABLE){n.default.open("disable-metathread",{model:f},{dimmer:true,resolvable:true,"close-on-dimmer":true,"reject-on-dimmer":true,"close-on-esc":false,"reject-on-close":true}).then(function(){h()}).catch(function(a){if(a){throw a}})}else{h()}};B.prototype.onPaginatorToggle=function(){var a=!this.get("router.model.uiThreadsSettings").paginator;g.default({type:c.TOGGLE_PAGINATOR,state:a});q.default({type:"paginator-"+(a?"enable":"disable"),intervals:[["settings",1]]})};B.prototype.isNewsShown=function(){var b=a.default.get("news-subscription-badge");return b&&b.isActive()};B.prototype.shouldShowAdActualLetters=function(){var b=a.default.get("actual-letters-badge");var c=this.get("router.model.uiThreadsSettings");var d=c.metathreadsSettings&&c.metathreadsSettings[i.default.NEWSLETTERS]===j.default.METATHREADS_STATES.ON;return e.HAS_PRIORITY_MESSAGES&&b&&!b.isActive()&&d&&!c.actualLettersNewsletters&&!c.actualLettersInbox};B.prototype.onDiscountsToggle=function(a){var d=this;b.default.send("discounts_switch_"+a,{i:{"from-popup":1}});return g.default({type:c.TOGGLE_DISCOUNTS,state:a}).then(function(){d.updateAll()})};B.prototype.isMetathreadOff=function(a){var b=this.get("router.model.uiThreadsSettings").metathreadsSettings,c=b===void 0?{}:b;return c[a]===j.default.METATHREADS_STATES.OFF};B.prototype.getMetathreadsData=function(){var a=this.get("router.model.uiThreadsSettings"),b=a.metathreadsSettings,c=b===void 0?{}:b,d=a.discounts,f=a.actualLettersInbox,g=a.actualLettersNewsletters;var h=e.HIDE_METATHREADS;var j=e.SETTINGS_DROPDOWN_HIDE_TO_MYSELF&&this.isMetathreadOff(i.default.TOMYSELF);var k=e.HIDE_NEWS_METATHREAD&&this.isMetathreadOff(i.default.NEWS);var l=(!e.HAS_PRIORITY_MESSAGES||this.isMetathreadOff(i.default.NEWSLETTERS))&&!f;var m=e.HIDE_OFFICIAL_METATHREAD&&this.isMetathreadOff(i.default.OFFICIAL);var n=e.HIDE_RECEIPTS_METATHREAD&&this.isMetathreadOff(i.default.RECEIPTS);var o=e.HIDE_SCHOOL_METATHREAD&&this.isMetathreadOff(i.default.SCHOOL);var p=e.HIDE_GAMES_METATHREAD&&this.isMetathreadOff(i.default.GAMES);var q=[{type:"inbox",folderId:i.default.INBOX,title:i18n("Входящие"),text:i18n("Настройки отображения писем во входящих"),icon:"FOLDER_INBOX",isHidden:l||h||e.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS,subSettings:[{type:"checkbox",value:f,testId:"actual-in-inbox",text:i18n("Выделять актуальные письма"),onChange:this.onActualInboxToggle.bind(this)}]},{type:"toMyself",folderId:i.default.TOMYSELF,title:i18n("Письма себе"),text:i18n("Письма, отправленные на свой адрес электронной почты"),icon:"FOLDER_TOMYSELF",state:c[i.default.TOMYSELF],isHidden:j||h},{type:"newsLetters",folderId:i.default.NEWSLETTERS,title:i18n("Рассылки"),text:i18n("Письма от интернет-магазинов, акции и скидки. Рекламные рассылки."),icon:"FOLDER_NEWSLETTERS",state:c[i.default.NEWSLETTERS],isHidden:h&&this.isMetathreadOff(i.default.NEWSLETTERS),subSettings:[e.DISCOUNTS_BLOCK&&{type:"checkbox",value:d,testId:"discounts",text:i18n("Показывать актуальные скидки"),onChange:this.onDiscountsToggle.bind(this)},!e.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS&&(e.HAS_PRIORITY_MESSAGES||g)&&{type:"checkbox",value:g,testId:"actual-in-newsletters",text:i18n("Выделять актуальные письма"),onChange:this.onActualNewslettersToggle.bind(this)}]},{type:"social",folderId:i.default.SOCIAL,title:i18n("Социальные сети"),text:i18n("Уведомления из «ВКонтакте», «Одноклассников» и других соцсетей"),icon:"FOLDER_SOCIAL",state:c[i.default.SOCIAL],isHidden:h&&this.isMetathreadOff(i.default.SOCIAL)},{type:"news",folderId:i.default.NEWS,title:i18n("Новости"),text:i18n("Уведомления от новостных сайтов, дайджесты"),icon:"FOLDER_NEWS",state:c[i.default.NEWS],isHidden:k||h},{type:"official",folderId:i.default.OFFICIAL,title:i18n("Госписьма"),text:i18n("Рассылки от государственных сервисов"),icon:"FOLDER_OFFICIAL",state:c[i.default.OFFICIAL],isHidden:m||h},{type:"receipts",folderId:i.default.RECEIPTS,title:i18n("Чеки"),text:i18n("Письма с подтверждениями оплат в магазинах и сервисах"),icon:"FOLDER_RECEIPTS",state:c[i.default.RECEIPTS],isHidden:n||h},{type:"school",folderId:i.default.SCHOOL,title:i18n("Учёба"),text:i18n("Письма про учёбу и на школьную тематику"),icon:"FOLDER_SCHOOL",state:c[i.default.SCHOOL],isHidden:o||h,sortOrder:e.METATHREADS_SETTINGS_ORDER.indexOf("school")},{type:"games",folderId:i.default.GAMES,title:i18n("Игры"),text:i18n("Всё, что связано с играми"),icon:"FOLDER_GAMES",state:c[i.default.GAMES],isHidden:p||h,sortOrder:e.METATHREADS_SETTINGS_ORDER.indexOf("games")}];return q.map(function(a){return __assign({sortOrder:e.METATHREADS_SETTINGS_ORDER.indexOf(a.type)},a)})};B.prototype.onActualInboxToggle=function(a){var d=this;b.default.send("actual_inbox_switch_"+a,{i:{"from-popup":1}});return g.default({type:c.TOGGLE_ACTUAL_MESSAGES_IN_INBOX,state:a}).then(function(){d.updateAll()})};B.prototype.onActualNewslettersToggle=function(a){var d=this;b.default.send("actual_newsletters_switch_"+a,{i:{"from-popup":1}});return g.default({type:c.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS,state:a}).then(function(){d.updateAll()})};return B}(f.default.Mediator);exports.default=f.default.Mediator.createFromClass("settings-manager",B)});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-meta/letter-meta",["require","exports","@mail/features","@mail/flags","@mail/xray","cfg","cfgUser","default-values","feast","feast-tpl!./letter-meta.html","helpers/data-source-dispatch","helpers/opener","mediator/settings-manager","RPC","service/auth","service/getModule","service/notify","service/promo","service/smokescreen","service/storage","timingNow","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);r=__importDefault(r);s=__importDefault(s);exports.default=g.default.Block.extend({name:"letter-meta",template:h.default,defaults:{html:""},didUnmount:function(){this.unrenderUI()},didUpdate:function(){if(this.ui){this.ui.update(this.getParams())}},attrChanged:{model:function(){this.renderUI()}},getParams:function(){var c=this.get("model");var f=this.get("metadata")?this.get("metadata").getAttributes():null;var g=c.get("messages");var h=this.get("ponymode");var j=this.is("dark-mode");var k=this.get("sender");var n=m.default.user;var o=this.get("calendar");var p=this.get("promoDomainPlate");return{model:c,features:a.default,flags:b.default,cfg:d.default,storage:r.default,octavius:true,lang:e.default.get("LANG"),email:n&&n.getEmail(),calendar:o,onPopupToggle:this.onPopupToggle,selector:q.selector,dataSourceDispatch:i.default,metadata:f,message:c,messages:g,ponymode:h,darkMode:j,sender:k,onStatusClick:this.onStatusClick.bind(this),promoDomainPlate:p,onPromoDomainClose:this.onPromoDomainClose.bind(this),onBlockPhishingLetter:this.onBlockPhishingLetter.bind(this),onActualFeedback:this.onActualFeedback.bind(this),onEternalDislike:this.onEternalDislike.bind(this),onCategoryFeedback:this.onCategoryFeedback.bind(this),onWindowOpen:this.onWindowOpen,onAttachesCloudSave:this.onAttachesCloudSave.bind(this),onBlockFilteredLetter:this.onBlockFilteredLetter.bind(this),onApproveFilteredLetter:this.onApproveFilteredLetter.bind(this),createSmartCardConfirmPopup:this.createSmartCardConfirmPopup.bind(this),onSmartCardError:this.onSmartCardError.bind(this),onPromoPush:this.onPromoPush.bind(this),onPromoPushSettings:this.onPromoPushSettings.bind(this),swBox:window.app.model.swBox,RPC:l.default}},renderUI:function(){var b=this;this.unrenderUI();var c=s.default();var d=m.default.user;var e=this.is("dark-mode");n.default("letter.meta").then(function(c){return b.isMounted()&&c&&c({message:b.get("model"),loadPath:window.require.toUrl("letter.meta.js").replace("letter.meta.js",""),features:a.default,email:d&&d.getEmail(),promoDomainPlate:b.get("promoDomainPlate"),sender:b.get("sender"),type:b.get("type"),darkMode:e})}).then(function(a){if(!a||!b.isMounted()){return false}b.ui=new a(b.el);b.ui.renderWrapper(__assign(__assign({},b.getParams()),{timingStart:c,timingNow:s.default}));var d=b.el.children.length;p.default.update();b.broadcast("render",{showed:d})})},unrenderUI:function(){this.ui&&this.ui.destroy();this.ui=null},onPopupToggle:function(a){t.lazyMailKeymaster().then(t.uniqCallback(this,function(b){b.setScope(a?"layer-no-shortcuts":"all")}))},onStatusClick:function(a){this.broadcast("letterclick",{uidl:a})},onPromoDomainClose:function(){this.broadcast("promodomainclose")},onBlockPhishingLetter:function(){var a=this.get("model");this.broadcast("spam",{model:a})},onActualFeedback:function(a){var b=this.get("model");l.default.call("messages/services/ispriority",{ids:[b.get("messages.0.id")],is_priority:a})},onEternalDislike:function(a,b){var c=this.get("model");l.default.call("messages/services/ispriority",{ids:[c.get("messages.0.id")],is_priority:b,permanent_priority:true})},onCategoryFeedback:function(a,b){var c=this.get("model");if(b){l.default.call("messages/services/category/feedback",{id:c.get("messages.0.id"),other_category:b});return}l.default.call("messages/services/category/feedback",{id:c.get("messages.0.id"),category:a})},onWindowOpen:function(a){j.default(a)},onAttachesCloudSave:function(){this.broadcast("attaches-cloud-save",this.get("model").getAttachmentsList())},onBlockFilteredLetter:function(){c.default.send("rl_btn_block");this.broadcast("move",{id:f.PARENTAL_CONTROL_DENY_FOLDER_ID,model:this.get("model")})},onApproveFilteredLetter:function(){c.default.send("rl_btn_approve");this.broadcast("move",{id:f.PARENTAL_CONTROL_APPROVE_FOLDER_ID,model:this.get("model")})},createSmartCardConfirmPopup:function(a,b){var c=this;Promise.all([n.default("react"),n.default("blitz")]).then(function(d){var e=d[0],f=d[1].LayerManager;if(!c.isMounted()){return}var g=c.layerManager||new f;g.setup(c.el,{popup:false,radarPrefix:"smart-card"});var h=g.openLayer(e.createElement(a,__assign(__assign({},b),{onClose:function(){b.onClose();if(g){g.destroyLayer(h)}}})),{noPanelWrap:true,responsive:"auto"}).id})},onSmartCardError:function(){o.default.add({text:i18n("Временно не работает. Попробуйте попозже"),qa:"clnd-smart-card-notify-err"})},onPromoPush:function(a,b){var d;return(d=window.app.model.swBox.pushManager)===null||d===void 0?void 0:d.forCurrentEmail().set({active:true}).then(function(){c.default.send(["notifications-push","switch","on"],{dwh:{source:"letter-promo"}});o.default.add({text:a})}).catch(function(a){c.default.send(["notifications-push","switch","error"],{rlog:"push-switch-error",rlog_message:{error:a,on:true}});o.default.add({type:"error",text:b})})},onPromoPushSettings:function(){k.default.onSettingsDockBrowserSettingsOpen()}})});define("feast-tpl!app/feast-tpl!ui-block/promo-domain-die/promo-domain-die.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:if test="_this.checkPromoDomainPlate()">\n\t\t<b:letter-meta\n\t\t\tmodel="{attrs.model}"\n\t\t\tpromoDomainPlate="{attrs.promoDomainPlate}"\n\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\tremit:promodomainclose="letter-meta:promodomainclose"\n\t\t\tuse:mediator="themes-manager"\n\t\t/>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/promo-domain-die/promo-domain-die.html")});define("feast-tpl!ui-block/promo-domain-die/promo-domain-die.html",["feast-tpl!app/feast-tpl!ui-block/promo-domain-die/promo-domain-die.html"],function(a){return a});define("mail/actions/PromoplatesManage",["RPC","Action"],function(a,b){"use strict";var c=b.extend({prepare:function(a){if(!a){return null}switch(a.method){case c.CONFIG:return this._prepareConfig(a);case c.HIDE:case c.SHOW:return this._preparePromoDomainPlates(a);default:return null}},operation:function(a){switch(a.method){case c.CONFIG:return this._config(a);case c.HIDE:return this._hide(a);case c.SHOW:return this._show(a);case c.CHECK:return this._check(a)}},_done:function(a){if(a){window.__DEBUG_PROMO_DOMAIN_SERVER=1}},_prepareConfig:function(a){var b=a.email;var d=a.senderEmail;var e=a.config;var f=a.isClosable;var g=a.isToMyself;var h=!b||!d||!Array.isArray(e)||b===d&&!g;if(h){return null}var i=null;if(g){i=c.TO_MYSELF_DOMAIN}else{var j=d.match(/.+@(.+)/);i=j&&j[1]}if(!i){return null}var k=null;var l=e.some(function(a){var b=Array.isArray(a.domains)&&a.domains.includes(i);var c=Array.isArray(a.emails)&&a.emails.includes(d);if(b){k=i}else if(c){k=d}return b||c});if(!l){return null}if(!f){return{method:c.CONFIG,plate:k}}return Object.assign(a,{senderDomain:i})},_preparePromoDomainPlates:function(a){if(!Array.isArray(a.promoDomainPlates)){return null}return a},_config:function(b){if(b.plate){return Promise.resolve(b.plate)}var c=this;var d=function(a){c._done(b.isAutotest);return a};return a.get("user/promoplates/config").then(d,d).then(function(a){var c=a.body.domains;var d=a.body.emails;if(!Array.isArray(c)||!Array.isArray(d)||!c.length&&!d.length){return null}return c.find(function(a){return a===b.senderDomain})||d.find(function(a){return a===b.senderEmail})})},_hide:function(b){var c=this;var d=function(a){c._done(b.isAutotest);return a};return a.post("user/promoplates/hide",{promo_plates:b.promoDomainPlates}).then(d,d)},_show:function(b){var c=this;var d=function(a){c._done(b.isAutotest);return a};return a.post("user/promoplates/show",{promo_plates:b.promoDomainPlates}).then(d,d)}});c.CONFIG="CONFIG";c.HIDE="HIDE";c.SHOW="SHOW";c.TO_MYSELF_DOMAIN="toMyself";b.register("mail.PromoplatesManage",c);c.version="0.1.0";return c});define("mail/PromoDomain",["Model","mail/actions/PromoplatesManage"],function(a,b){"use strict";var c=a.extend({checkPlate:function(a){var c=a.promoDomainPlate;if(c===b.TO_MYSELF_DOMAIN){return!a.toMyselfFlag}return true}});c.version="0.1.0";return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/promo-domain-die/promo-domain-die",["require","exports","@mail/flags","cfg","default-values","feast","feast-tpl!./promo-domain-die.html","mail/actions/PromoplatesManage","mail/PromoDomain","service/auth","service/radars/index","ui-block/letter-meta/letter-meta"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.default=d.default.Block.extend({name:"promo-domain-die",template:e.default,blocks:{"letter-meta":j.default},events:{"letter-meta:promodomainclose":"onPromoDomainClose"},defaults:{promoDomainModel:new g.default,promoDomainPlate:"",senderEmail:"","dark-mode":false,receivers:[]},constructor:function(){d.default.Block.apply(this,arguments)},attrChanged:{senderEmail:function(a){if(a){this.onGetPromoDomainPlate()}},receivers:function(){this.onGetPromoDomainPlate()}},onGetPromoDomainPlate:function(){var a=this;this.set("promoDomainPlate","");var d=this.get("model");var e=!!b.default.get("qa");var g=this.get("senderEmail");var j=h.default.user;var k=j&&j.getEmail();f.default.execute({method:f.default.CONFIG,email:k,senderEmail:g,config:c.PROMO_DOMAIN_HEADER,isAutotest:e,isClosable:c.PROMO_DOMAIN_CROSS_ENABLED,isToMyself:d&&d.isToMyself()},{silent:true}).then(function(b){var c=b&&b.result;if(c){a.set("promoDomainPlate",c)}}).catch(function(){return i.default("get-user-promoplates-config-err")})},onPromoDomainClose:function(){var a=!!b.default.get("qa");var c=this.get("promoDomainPlate");f.default.execute({method:f.default.HIDE,promoDomainPlates:[c],isAutotest:a}).catch(function(){return i.default("user-promoplates-hide-err")});this.set("promoDomainPlate","")},checkPromoDomainPlate:function(){if(!c.PROMO_DOMAIN_HEADER.length){return false}var b=a.default.get("to-myself").isActive();var d=this.get("promoDomainPlate");var e=this.get("promoDomainModel");var f=e.checkPlate({promoDomainPlate:d,toMyselfFlag:b});if(!f){d="";if(c.PROMO_DOMAIN_CROSS_ENABLED){this.onPromoDomainClose()}else{this.set("promoDomainPlate",d)}}return!!d}})});define("feast-tpl!app/feast-tpl!ui-block/thread-subject/thread-subject.html",["feast"],function(a){return a.smartParse('<h2 bem:elem="subject" qa:id="subject">\n    <bem:mod name="pony-mode" test="attrs.ponymode"/>\n    <fn:value>attrs.subject</fn:value>\n</h2>',"app/feast-tpl!ui-block/thread-subject/thread-subject.html")});define("feast-tpl!ui-block/thread-subject/thread-subject.html",["feast-tpl!app/feast-tpl!ui-block/thread-subject/thread-subject.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/thread-subject/thread-subject",["require","exports","feast","feast-tpl!./thread-subject.html","service/emoji"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"thread-subject",template:b.default,didMount:function(){c.emojiFallback(this.el,"tr-subj")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/thread/thread",["require","exports","@mail/features","@mail/flags","data-source/utils/actual-letters","default-values","feast","feast-mod/correspondents","feast-mod/letter-date","feast-tpl!./thread.html","helpers/radar-utils","mail/actions/MarkAs","mail/Folder","mail/Message","service/adv/config","service/contextmenu","service/notify","service/promo","service/radars/decorator","service/radars/index","service/smokescreen","trackJS","ui-block/category-feedback/category-feedback","ui-block/delimeter/delimeter","ui-block/letter-category/letter-category","ui-block/letter-list-item/letter-list-item","ui-block/letter-list-item-placeholder/letter-list-item-placeholder","ui-block/letter-meta/letter-meta","ui-block/promo-domain-die/promo-domain-die","ui-block/scrollable/scrollable","ui-block/thread-subject/thread-subject","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;a=__importDefault(a);b=__importDefault(b);e=__importDefault(e);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);exports.blockSpec={name:"thread",template:h.default,performanceTrace:"track",blocks:{delimeter:v.default,"letter-list-item":x.default,"letter-list-item-placeholder":y.default,"letter-category":w.default,"letter-meta":z.default,"category-feedback":u.default,"promo-domain-die":A.default,"thread-subject":C.default},lazyBlocks:{letter:D.lazyUILetter},events:{"draft:open":"onDraftOpen","letter:open":"onLetterOpen","letter:close":"onLetterClose","letter:rightclick":"onRightClick","letter-meta:render":"onLetterMetaRender","letter-meta:letterclick":"onLetterMetaClick","translator:scrollto":"onTranslatorScrollTo"},defaults:{sticky:null,"sticky-disabled":false,"disable-category":false,"enable-amp":d.ENABLE_AMP,noDivider:false,"category-feedback":d.CATEGORY_FEEDBACK,touch:d.TOUCH_MODE,"dark-mode":false,kaspersky:d.KASPERSKY,senderEmail:"",isResendDropdownDisabled:d.IS_RESEND_DROPDOWN_DISABLED,actualReasonFeedback:d.ACTUAL_REASON_FEEDBACK,showOfficialSender:d.SHOW_OFFICIAL_SENDER_PROMO,showReliableSender:d.SHOW_RELIABLE_SENDER_PROMO},attrChanged:{model:function(a,b){this.isModelFullyLoaded=a.isDataFully();this.unbindThread(b);this.bindThread(a)},"load-draft-disabled":function(a){if(a===false){this._loadDraft(this.get("model"))}},"expand-letter-id":function(a){if(a&&this.get("model")){this._setExpanded(this.get("model"),true)}}},constructor:function(){e.default.Block.apply(this,arguments);var a=this.get("model");if(a){this.isModelFullyLoaded=a.isDataFully();this._setExpanded(a)}},didMount:function(){p.default.update()},didUnmount:function(){if(this.settedExpidAliexpress){this.settedExpidAliexpress=false;m.deleteRBParam("exp_id");r.default("aliexpress-resetting-exp-id")}this.unbindThread(this.get("model"))},bindThread:function(a){var b=this;if(!a){return}this._setExpandedBind=function(){if(b.isMounted()){b._setExpanded(a)}};this._onThreadLoaded=function(){if(b.isMounted()){b._setExpanded(a,false,true);b._emitRecalcAfterUpdate=true}};var c=this.get("direction")||"next";this.el.classList.remove("thread_direction-prev","thread_direction-next");void this.el.offsetWidth;this.el.classList.add("thread_direction-"+c);this._letterChangeBind=function(a){var c=a.target,d=a.changes;if(!b.destroyed&&d.includes("folder")){var e=c.getFolder();if(e&&!e.isSpam()&&!e.isTrashLike()){b._closeLetter(c)}}};a.meta("unread-on-open",a.get("flags.unread"));a.on("change",this._setExpandedBind);a.on("loaded-changes",this._onThreadLoaded);a.get("messages").on("change",this._letterChangeBind);this._setExpandedBind();this._emitRecalcAfterUpdate=true;this._loadDraft(a)},usePortalSearchPanel:function(){return d.SEARCH_PANEL_PORTAL},getSenderEmail:function(a){var b;return(b=f.getCorrespondentsFromMessage(a,"from",".0.email"))!==null&&b!==void 0?b:""},getReceivers:function(a){return f.getCorrespondentsFromMessage(a,"to")},unbindThread:function(a){if(a){this._letterChangeBind&&a.get("messages").off("change",this._letterChangeBind);this._setExpandedBind&&a.off("change",this._setExpandedBind);this._setExpandedForceBind&&a.off("loaded-changes",this._onThreadLoaded);this._letterChangeBind=null;this._setExpandedBind=null;this._setExpandedForceBind=null;delete this._showCategoryFeedback;this.set("noDivider",false,true)}},isOfficialSender:function(a){var b=a.get("messages.0");return b.is("headers.X-Mailru-Bimi-Organization")&&(b.is("flags.official")||b.is("flags.official_newsletter"))},isReliableSender:function(a){var b=a.get("messages.0");return b.is("headers.X-Mailru-Bimi-Organization")&&(b.is("flags.bimi_msg")||b.is("flags.bimi_important_msg"))},isCollapsed:function(a){return!this._expandedLetters[a]},isStickyEnabled:function(){return!this.is("sticky-disabled")},isSticky:function(a){var b=this.get("sticky");return b&&b.id===a},isNextCollapsed:function(a){var b=this.get("model").get("messages");var c=b[a+1];return c&&this.isCollapsed(c.id)},isPrevCollapsed:function(a){var b=this.get("model").get("messages");var c=b[a-1];return c&&this.isCollapsed(c.id)},isHideCategory:function(a){var b=a.get("transaction_category");return this.get("noDivider")&&(b==="event"||b==="fees"||b==="order"||b==="travel")},hasCategory:function(a){var b=a.get("transaction_category");var c=a.getFolder().isMetathread();var d=b||c;if(this._showCategoryFeedback===undefined&&d){this._showCategoryFeedback=d}return d||this._showCategoryFeedback},actualLettersEnabled:function(){var a,b;return c.isActualLettersEnabledInFolder(this.get("router"),(a=this.get("model"))===null||a===void 0?void 0:a.getFolder(),(b=this.get("model"))===null||b===void 0?void 0:b.get("flags.newsletter"))},isShowCategoryFeedbackPlate:function(){var a=this.get("model");return d.SHOW_CATEGORY_FEEDBACK_PLATE&&a.get("messages.0").is("user_feedback")},isShowPromoPush:function(){var c=this.get("model");var e=c.getFolder();return d.SHOW_PROMO_PUSH_PLATE&&!e.isSpam()&&!e.isTrash()&&!b.default.get("relevant-messages-push-promo").state&&!b.default.get("relevant-messages-push-promo").getCount("close")&&c.get("flags.is_relevant")||a.default.has("force-enable-promo-push")},getMessageFolder:function(){return k.default.get(this.get("model").getFolder())},setExpId:function(a){this.settedExpidAliexpress=true;m.setRBParam("exp_id",a);r.default("aliexpress-set-exp-id_"+a)},_setExpanded:function(b,c,d){var e=this;if(c===void 0){c=false}if(d===void 0){d=false}var f=b.get("messages")||[];var g=this.get("expand-letter-id");var h=b.get("transaction_metadata");var i=b.get("messages.0");var j=i&&i.get("correspondents.from.0");if(b.id!==this._threadId||!this._expandedLetters||c||d){this._threadId=b.id;if(!d){this._expandedLetters={}}f.forEach(function(a){if(d&&e._expandedLetters.hasOwnProperty(a.id)){return}var c=!e.get("preview-mode");var f=b.canUnfoldMessage(a);var h=c&&f;if(g){var i=a.id.split(";")[0];h=g===a.id||g===i}if(a&&!a.isDataFully()){h=void 0}e._expandedLetters[a.id]=h});if(g&&typeof this._expandedLetters[g]==="undefined"){var k=f.get(g);if(!k){r.default("search_letter_too_far")}this._loadLetter(k,{behavior:"auto"})}}if(a.default.has("aliexpress-exp-id")&&j){var l=a.default.getAsArray("aliexpress-exp-id");var m=a.default.getAsArray("aliexpress-exp-id-emails");if(h&&h.type==="aliexpress"||j.email===m[0]){this.setExpId(l[0])}else if(j.email===m[1]){this.setExpId(l[1])}else if(j.email===m[2]){this.setExpId(l[2])}else if(/aliexpress.com$/.test(j.email)){this.setExpId(l[3])}}},_loadDraft:function(a){var b=this;var c=a.get("messages");var d=c[0];this.set("hasDraft",false);if(d&&d.get("id")===a.get("expand")){var e=d.get("drafts.last_type");if(e){var f=d.get("drafts."+e);if(f){this.set("hasDraft",true);var g=d.get("folder");l.default.fetchData({id:f,folder_id:g},true,true).then(function(a){b.set("draft",new l.default(a));b.set("draft-source",{id:d.get("id"),mode:e})},function(){b.set("hasDraft",false);d.set("drafts."+e,"")})}}}},onTranslatorScrollTo:function(a){this.scrollLetterIntoView(a.target)},scrollLetterIntoView:function(a,b){if(b===void 0){b={behavior:"smooth"}}if(!this.isMounted()){return false}var c=a;if(typeof a==="string"){c=this.el.querySelector(s.selector('[data-id="'+a+'"]'))}var d=B.default.getScrollableBlock(this);if(!c||!d){return false}var e=this.el.getBoundingClientRect().top;var f=c.getBoundingClientRect().top;var g=f-e;var h=d.get("silent");d.set({silent:true});try{d.el.scrollTo({top:g,behavior:b.behavior||"smooth"})}catch(a){d.el.scrollTop=g}d.set({silent:h});return true},scheduleScrollLetterIntoView:function(a){this._scrollToIdAfterUpdate=a},didUpdate:function(){var a=this;if(this._scrollToIdAfterUpdate){this.scrollLetterIntoView(this._scrollToIdAfterUpdate);this._scrollToIdAfterUpdate=null}if(this._emitRecalcAfterUpdate){this._emitRecalcAfterUpdate=false;this.broadcast("force:recalc")}if(d.THREAD_SWITCH_RACE_FIX){var b=this.get("model");if(!this.isModelFullyLoaded&&b.isDataFully()){this.isModelFullyLoaded=true;this._setExpanded(b,true);window.setTimeout(function(){if(a.isMounted()){a.render()}})}}},_loadLetter:function(a,b){var c=this;if(a){var e=a.is("flags.unread");var f=a.get("id");var g=a.get("folder");if(e){j.default.execute({flag:"unread",state:false,models:[a]})}a.fetch({id:f,folder_id:g,use_color_scheme:d.DARK_MODE_MEDIA_QUERY?1:0}).then(function(){c._expandedLetters[f]=true;c.update();if(b!==null){c.scrollLetterIntoView(f,b)}}).catch(function(a){console.log(a);if(a&&!a.body){t.default.addErrorFromApp(a,"octavius_smth_wrong");o.default.error({unique:true})}})}},_closeLetter:function(a){this._expandedLetters[a.get("id")]=void 0},update:function(){this.render()},onDraftOpen:function(a){var b=this.get("draft");var c=this.get("draft-source");if(!a.isDefaultPrevented()){this.broadcast("compose:draft",{model:b,source:c})}return true},onLetterOpen:function(a){var b=a.details;if(!a.isDefaultPrevented()){this._loadLetter(b,null)}return true},onLetterClose:function(a){if(this.get("preview-mode")){return true}var b=window.getSelection();var c=a.details;var d=this.get("model");var e=d.get("messages");var f=e.length;if(!a.isDefaultPrevented()&&!b.toString().length&&f>1){this.broadcast("letter:collapse",c);a.preventDefault();this._closeLetter(c);this.update()}return true},onRightClick:function(a){a.details.folders=this.get("folders");a.details.selectable=false;var b={parentThread:this.get("model")};n.default.show(a,b)},onLetterMetaRender:function(a){this.set("noDivider",!!a.details.showed)},onLetterMetaClick:function(a){var b=(a.details||{}).uidl;var c=this.get("model");var d=c.get("messages");var e=d.find(function(a){return a.get("id")===b});this._loadLetter(e)},getFirstCalendarAttach:function(){var a=this.get("model");var b=a.getExpandMessage();var c=b.getCalendarFromAttach();if(c.length){return{messageId:b.get("id"),calendarInfo:c[0]}}},isEngKasperskyLogo:function(){return d.KASPERSKY_ENG_LOGO_LANGS.includes(d.USER_LANG)},_formDatesMetadata:function(){var a=this.get("model");var b=a.get("dates_metadata.priority_date");if(d.DATES_METADATA&&b.timestamp&&a.get("messages").length===1){return b}return null},getResendData:function(){var a,b;var c=this.get("model");var d=c.getExpandMessage();if(!d){return null}var e=d.get("resend");if(!e||!((a=e.from)===null||a===void 0?void 0:a.length)&&!((b=e.to)===null||b===void 0?void 0:b.length)){return null}var f=d.get("date");var h=e.from,i=h===void 0?[]:h,j=e.to,k=j===void 0?[]:j,l=e.date;return{from:i,to:k,date:l?g.getLocaleDateFull(l,false):null,receivedDate:g.getLocaleDateFull(f,false)}},parentalControlDieEnabled:function(){return this.getMessageFolder().isParentalControl()||d.FORCE_PARENTAL_CONTROL_DIE}};exports.default=e.default.Block.extend(q.default({events:[{name:"mount",data:i.getModelDataWithRelevant},{name:"unmount",data:i.getModelData},{name:"click-kaspersky",rename:"kaspersky_click"}]})(exports.blockSpec))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/panel-with-selected/panel-with-selected",["require","exports","default-values","feast","feast-tpl!./panel-with-selected.html","mail/Thread","models/metathread/metathread","ui-block/metathread-preview/metathread-preview","ui-block/thread/thread"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"panel-with-selected",template:c.default,blocks:{thread:g.default,"metathread-preview":f.default},attrChanged:{selected:function(a){var b=a[a.length-1];var c=b;var f;if(b&&!(b instanceof d.default)){c=d.default.getSafe(b.meta("thread_id"));f=b.id}var g=c&&e.default.isMetathread(c);function h(){if(!f&&c&&c.get("messages").length){f=c.get("messages").eq(0).id}this.set({"is-metathread":g,"selected-last-thread":c,"expand-letter-id":f});this.render()}if(c&&!c.isDataFully()&&!g){c.fetch().then(h.bind(this))}else{h.apply(this)}}},didMount:function(){var a=this.el;var b=a.style;var c=a.offsetParent;b.marginTop=c.scrollTop+"px";this.$on(c,"scroll",function(){b.marginTop=c.scrollTop+"px"})},didUnmount:function(){this.el.style.marginTop=""},useNewThread:function(){return a.NEW_THREAD}})});define("feast-tpl!app/feast-tpl!ui-block/portal-menu/portal-menu.html",["feast"],function(a){return a.smartParse('<div qa:id="portal">\n\t\x3c!-- TODO: разделить тулбар на обычный и notFound и выбирать его еще на уровне application-mail --\x3e\n\t<fn:var name="current" value="{_this.getCurrentBreakpoint()}" />\n\t<fn:var name="globals" value="{current.globals}"/>\n\t<fn:var name="selectedLettersInfo" value="{_this.getSelectedLettersIdsAndSenders(getGlobals(this.getAttrs()), this.getAttrs())}"/>\n\t<fn:var name="selectedLettersIds" value="{selectedLettersInfo.ids}"/>\n\t<fn:var name="selectedLettersSenders" value="{selectedLettersInfo.senders}"/>\n\n\t<fn:var name="letterNotFound" value="{attrs[\'letter-not-found\']}" />\n\t<fn:var name="readMode" value="{globals.readMode}"/>\n\t<fn:var name="selectMode" value="{attrs.selectMode}"/>\n\t<fn:var name="isDisableEdit" value="{globals.isDisableEdit}" />\n\n\t<fn:var name="searchRoute" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\t<fn:var name="filterRoute" value="{attrs.route.is(\'#letters #read-letter\') && attrs.route.filterQuery.has()}"/>\n\t<fn:var name="layoutType" value="{attrs.layoutType}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponyMode}"/>\n\n\t<fn:var name="letterCount" value="{_this.hasLetterCount()}"/>\n\n\t<fn:var name="theme" value="portal-menu"/>\n\t<fn:var name="theme" value="{theme}_mobile" test="attrs.mobile"/>\n\n\t<fn:var name="mobile" value="{attrs.mobile}"/>\n\n\t<bem:mod name="mobile" test="mobile"/>\n\t<bem:mod name="pony-mode" test="ponyMode"/>\n\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t<fn:match name="actions-list" args="layout, attrs, readMode">\n\t\t<fn:var name="message" value="{globals.message}" />\n\t\t<fn:var name="letterId" value="{message && message.id}"/>\n\n\t\t<fn:if test="readMode || selectMode">\n\t\t\t<fn:for data="current.actionsList" as="item">\n\t\t\t\t\x3c!--TODO: возможно, добавить spread в feast? --\x3e\n\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\tfn:if="!item.hasOwnProperty(\'if\') || item.if"\n\t\t\t\t\t\tkey="{item.type}"\n\t\t\t\t\t\ttype="{item.type}"\n\t\t\t\t\t\tshort="{item.short}"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\tdisabled="{item.disabled ? true : item.disabled !== false && isDisableEdit}"\n\t\t\t\t\t\tletter-id="{letterId}"\n\t\t\t\t\t\tletter="{message}"\n\t\t\t\t\t\tselectedLettersIds="{selectedLettersIds}"\n\t\t\t\t\t\tselectedLettersSenders="{selectedLettersSenders}"\n\t\t\t\t\t\tradar-id="item.hasOwnProperty(\'radar-id\') ? item[\'radar-id\'] : null"\n\t\t\t\t\t\tread="{item.read}"\n\t\t\t\t\t\tunread="{item.unread}"\n\t\t\t\t\t\tflag="{item.flag}"\n\t\t\t\t\t\tunflag="{item.unflag}"\n\t\t\t\t\t\tarchive="{item.archive}"\n\t\t\t\t\t\tspam="{item.spam}"\n\t\t\t\t\t\tspamAbovePrint="{item.spamAbovePrint}"\n\t\t\t\t\t\tspamDisabled="{item.spamDisabled}"\n\t\t\t\t\t\tunsubscribeAbovePrint="{item.unsubscribeAbovePrint}"\n\t\t\t\t\t\tunspam="{item.unspam}"\n\t\t\t\t\t\tsuperspam="{item.superspam}"\n\t\t\t\t\t\tforward="{item.forward}"\n\t\t\t\t\t\tfolders="{item.folders}"\n\t\t\t\t\t\tcreate-filter="{item[\'create-filter\']}"\n\t\t\t\t\t\tinvite-call="{item[\'invite-call\']}"\n\t\t\t\t\t\tcreate-event="{item[\'create-event\']}"\n\t\t\t\t\t\ttranslate="{item[\'translate\']}"\n\t\t\t\t\t\tdisable-edit="{item[\'disable-edit\']}"\n\t\t\t\t\t\treadletter="{item.readletter}"\n\t\t\t\t\t\tstore="{globals.store}"\n\t\t\t\t\t\tprint="{item.print}"\n\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t/>\n\t\t\t</fn:for>\n\t\t</fn:if>\n\t</fn:match>\n\n\n\t<fn:match name="selectall-button" args="layout,disabled">\n\t\t<fn:var name="selectedCount" value="{_this.getSelectedCount() || \'\'}" />\n\n\t\t<fn:var name="isShort" value="{_this.isShortButtonSelectAll(layout, selectedCount, attrs.filter, attrs.sortingType)}"/>\n\t\t<fn:var name="marginLeft" value="{_this.getPaddingLeft(layoutType, isShort, ponyMode)}"/>\n\n\t\t<fn:var name="paddingRight" value="{_this.getPaddingRight(layout, isShort, ponyMode)}"/>\n\n\t\t<span style="margin-left: {marginLeft}px; padding-right: {paddingRight}px;">\n\n\t\t\t<b:portal-menu-element fn:if="!attrs.deselectAll"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\ttype="select"\n\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\tshort="{isShort}"\n\t\t\t\t\t\t\t\t\thas-explanation\n\t\t\t\t\t\t\t\t\ttext="{selectedCount ? selectedCount : \'\'}"/>\n\n\t\t\t<b:portal-menu-element fn:if="attrs.deselectAll"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\ttype="deselect"\n\t\t\t\t\t\t\t\t\thas-explanation="{selectedCount}"\n\t\t\t\t\t\t\t\t\ttext="{selectedCount}"/>\n\t\t</span>\n\t</fn:match>\n\n\t<b:layout use:mediator="layout-manager" id="portal" group="main">\n\t\t<fn:match name="foot">\n\t\t\t<b:search-panel\n\t\t\t\t\tfn:if="!_this.useReactSearchPanel()"\n\t\t\t\t\tuse:mediator="search-manager layout-manager themes-manager letters-selection pony-mode"\n\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\tremit:click="search"\n\t\t\t/>\n\t\t\t<b:react-async\n\t\t\t\t\tfn:if="_this.useReactSearchPanel()"\n\t\t\t\t\tcustomNode="{_this.usePortalSearchPanel() ? __PH.getSearchPlaceholder() : null}"\n\t\t\t\t\tcomponent="Search"\n\t\t\t\t\tuseMediators="{[\'search-manager\',\'layout-manager\',\'themes-manager\',\'letters-selection\',\'pony-mode\']}"\n\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\tremit:click="search"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="left-column" args="layout">\n\t\t\t<b:portal-menu-logo\n\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\troute="{attrs.route}"\n\t\t\t\tselectMode="{attrs.selectMode}"\n\t\t\t\treadMode="{readMode}"\n\t\t\t\tlayoutType="{layoutType}"\n\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\tneedBackToParentFolder="{_this.needBackToParentFolder()}"\n\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="main-frame" args="layout">\n\t\t\t<table width="100%" style="table-layout: fixed">\n\t\t\t\t<tbody>\n\t\t\t\t<tr style="display: flex; width: 100%">\n\t\t\t\t\t<fn:var name="is3Pane" value="{layout.type === \'3pane\'}"/>\n\t\t\t\t\t<fn:var name="is2Pane" value="{layout.type === \'2pane\'}"/>\n\t\t\t\t\t<fn:var name="isLeftColumnCollapsed" value="{layout[\'is-shortcut-left\']}"/>\n\n\t\t\t\t\t<fn:var name="combineFilterAndFolderName" value="{is3Pane && isLeftColumnCollapsed}"/>\n\t\t\t\t\t<fn:var name="showFolderName" value="{isLeftColumnCollapsed}"/>\n\n\t\t\t\t\t\x3c!-- Сайдбар --\x3e\n\t\t\t\t\t<fn:if\n\t\t\t\t\t\ttest="!readMode || is3Pane"\n\t\t\t\t\t>\n\t\t\t\t\t\t<td bem:elem="sidebar">\n\t\t\t\t\t\t\t<bem:mod name="nowrap"/>\n\t\t\t\t\t\t\t<bem:mod name="2pane" test="is2Pane"/>\n\t\t\t\t\t\t\t<bem:mod name="3pane" test="is3Pane"/>\n\t\t\t\t\t\t\t<bem:mod name="size-{layout[\'sidebar-column\']}"\n\t\t\t\t\t\t\t\t\t test="layout[\'sidebar-column\'] && is3Pane"/>\n\n\t\t\t\t\t\t\t\x3c!-- Мы не в режиме выделения --\x3e\n\t\t\t\t\t\t\t<fn:if test="!selectMode">\n\t\t\t\t\t\t\t\t\x3c!-- Выбрать все --\x3e\n\t\t\t\t\t\t\t\t<fn:apply-match name="selectall-button" args="layout, !letterCount"/>\n\n\t\t\t\t\t\t\t\t\x3c!-- Просто название папки когда не 3пане и левая колонка скрыта --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="is2Pane && showFolderName">\n\t\t\t\t\t\t\t\t\t<div bem:elem="folder-name" qa:id="folder-name-portal">\n\t\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\ttype="title"\n\t\t\t\t\t\t\t\t\t\t\ttext="{attrs.folder.get(\'name\')}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\x3c!-- Совмещенный контрол имени папки и фильтров на 3пане, когда скрыта левая колонка --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="combineFilterAndFolderName">\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t<b:portal-menu-element type="filters"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   folder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   combineFilterAndFolderName="{combineFilterAndFolderName}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   use:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t<fn:if test="_this.isAllReadVisible()">\n\t\t\t\t\t\t\t\t\t\x3c!-- Отметить все прочитанным везде где не 3пане --\x3e\n\t\t\t\t\t\t\t\t\t<fn:if test="is2Pane">\n\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t<b:portal-menu-element ponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   type="all-read"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   shortText="{_this.isShortTextAllRead()}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   touch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   use:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t<fn:if test="is2Pane && !selectMode && _this.isRemoveAllVisible()">\n\t\t\t\t\t\t\t\t<fn:var name="selectedCount" value="{_this.getSelectedCount() || \'\'}" />\n\t\t\t\t\t\t\t\t<fn:var name="isSelectAllShort" value="{_this.isShortButtonSelectAll(layout, selectedCount, attrs.filter, attrs.sortingType)}"/>\n\t\t\t\t\t\t\t\t<fn:var name="isRemoveAllShort" value="{_this.isRemoveAllButtonShort(layout)}"/>\n\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element ponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection folders-actions"\n\t\t\t\t\t\t\t\t\t\ttype="removeAll"\n\t\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\tstore="{globals.store}"\n\t\t\t\t\t\t\t\t\t\tshort="{isRemoveAllShort}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\x3c!-- 3pane: фильтры без имени папки --\x3e\n\t\t\t\t\t\t\t<fn:if test="is3Pane && !selectMode && !showFolderName">\n\t\t\t\t\t\t\t\t<div bem:block="portal-menu__group" bem:mod="right" fn:if="!searchRoute">\n\t\t\t\t\t\t\t\t\t<bem:mod name="mobile" test="mobile"/>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\ttype="filters"\n\t\t\t\t\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\x3c!-- 3pane: Кебаб с "отметить прочитанным" и "удалить все письма" --\x3e\n\t\t\t\t\t\t\t<fn:if bem:block="portal-menu__group" test="_this.needMoreLettersActions()">\n\t\t\t\t\t\t\t\t<span style="float: right">\n\t\t\t\t\t\t\t\t\t<bem:mod name="right" test="isLeftColumnCollapsed"/>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\ttype="moreLettersActions"\n\t\t\t\t\t\t\t\t\t\tallRead="{_this.isAllReadVisible()}"\n\t\t\t\t\t\t\t\t\t\tremoveAll="{_this.isRemoveAllVisible()}"\n\t\t\t\t\t\t\t\t\t\tstore="{globals.store}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="folders-actions"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\x3c!-- Выбрать все --\x3e\n\t\t\t\t\t\t\t<fn:apply-match fn:if="selectMode" name="selectall-button" args="layout"/>\n\n\t\t\t\t\t\t\t\x3c!-- Действия с письмами --\x3e\n\t\t\t\t\t\t\t<fn:if test="is2Pane">\n\t\t\t\t\t\t\t\t<fn:var name="style" value="{\'flex: 1 1 0; -ms-flex: 1 1 0px; min-width: 0;\'}"/>\n\t\t\t\t\t\t\t\t<fn:var name="style" value="{style + \'margin-left:12px; margin-right:4px;\'}"/>\n\n\t\t\t\t\t\t\t\t<span style="{style}" ref="actions-list">\n\t\t\t\t\t\t\t\t\t<fn:apply-match name="actions-list" args="layout, attrs, readMode"/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- 3pane, чтение письма --\x3e\n\t\t\t\t\t<fn:if test="readMode || is3Pane">\n\t\t\t\t\t\t\x3c!-- Инлайн стили, потому что мы в fn:match :( --\x3e\n\t\t\t\t\t\t<td bem:elem="content" style="display: -ms-flexbox; display: flex; flex: 1 1 0; -ms-flex: 1 1 0px; min-width: 0;">\n\t\t\t\t\t\t\t<div ref="actions-list" style="display: flex; align-items: center; flex: 1 1 0; -ms-flex: 1 1 0px; min-width: 0;">\n\t\t\t\t\t\t\t\t\x3c!-- Действия с письмами --\x3e\n\t\t\t\t\t\t\t\t<fn:apply-match name="actions-list" args="layout, attrs, readMode"/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- Вперед / Назад --\x3e\n\t\t\t\t\t\t\t<fn:if test="readMode">\n\t\t\t\t\t\t\t\t<div bem:block="portal-menu__group">\n\t\t\t\t\t\t\t\t\t<bem:mod name="padded" test="layout.isLessThen(\'s\')"/>\n\t\t\t\t\t\t\t\t\t<fn:var name="hasPrev" value="{!!attrs.letterNeighbours.prev}"/>\n\t\t\t\t\t\t\t\t\t<fn:var name="hasNext" value="{!!attrs.letterNeighbours.next}"/>\n\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\ttype="prev"\n\t\t\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\t\tletter="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\tis-search="{searchRoute}"\n\t\t\t\t\t\t\t\t\t\t\tis-filter="{filterRoute}"\n\t\t\t\t\t\t\t\t\t\t\tid="search_button_prev"\n\t\t\t\t\t\t\t\t\t\t\thidden="{is3Pane}"\n\t\t\t\t\t\t\t\t\t\t\tdisabled="{isDisableEdit || !hasPrev}"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\ttype="next"\n\t\t\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\t\tletter="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\tis-search="{searchRoute}"\n\t\t\t\t\t\t\t\t\t\t\tis-filter="{filterRoute}"\n\t\t\t\t\t\t\t\t\t\t\tid="search_button_next"\n\t\t\t\t\t\t\t\t\t\t\thidden="{is3Pane}"\n\t\t\t\t\t\t\t\t\t\t\tdisabled="{isDisableEdit || !hasNext}"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- 2pane: список писем --\x3e\n\t\t\t\t\t<fn:if test="!readMode && !selectMode && !searchRoute && is2Pane">\n\t\t\t\t\t\t<fn:var name="groupStyle" value="{\'\'}"/>\n\t\t\t\t\t\t<fn:var name="groupStyle"\n\t\t\t\t\t\t\t\tvalue="{groupStyle + \'padding-right:56px;\'}"\n\t\t\t\t\t\t\t\ttest="attrs[\'small-search\']"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<td bem:elem="content">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tbem:block="portal-menu__group" bem:mod="float"\n\t\t\t\t\t\t\t\t\tstyle="{groupStyle}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\ttype="filters"\n\t\t\t\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</fn:match>\n\n\t\t<fn:match name="right-column"\n\t\t\t\t  test="globals.shouldShowSearch"/>\n\n\t</b:layout>\n</div>\n',"app/feast-tpl!ui-block/portal-menu/portal-menu.html")});define("feast-tpl!ui-block/portal-menu/portal-menu.html",["feast-tpl!app/feast-tpl!ui-block/portal-menu/portal-menu.html"],function(a){return a});define("mediator/layout-manager/vars",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sizes=exports.columnSidebarXl=exports.columnSidebarM=exports.SIDEBAR_SHORT_COLUMN_LIMIT_PX=void 0;var b=7;exports.SIDEBAR_SHORT_COLUMN_LIMIT_PX=a.SHORTCUT_LEFT_COLUMN_LIMIT*4-b;exports.columnSidebarM=80;exports.columnSidebarXl=100;exports.sizes=["xxs","xs","s","m","l","xl","xxl"]});define("feast-tpl!app/feast-tpl!ui-block/portal-menu-element/portal-menu-element.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="size" value="m"/>\n\t<fn:var name="type" value="{attrs.type}"/>\n\t<fn:var name="short" value="{attrs.short}"/>\n\t<fn:var name="theme" value="{attrs.theme}"/>\n\t<fn:var name="touch" value="{attrs[\'touch-nav\']}"/>\n\t<fn:var name="readMode" value="{attrs.readMode}"/>\n\n\t<bem:mod name="{type}" test="type" />\n\t<bem:mod name="short" test="short" />\n\t<bem:mod name="expanded" test="!short" />\n\t<bem:mod name="touch" test="touch" />\n\t<bem:mod name="not-touch" test="!touch" />\n\t<bem:mod name="hidden" test="attrs.hidden" />\n\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\n\t<bem:mod name="folder-overflow" test="attrs[\'folder-overflow\']"/>\n\n\t<div fn:if="type === \'title\' && !attrs.disabled" bem:elem="text"\n\t\t\ttitle="{attrs.text}">\n\t\t{attrs.text}\n\t</div>\n\n\t<b:button2 fn:if="type === \'removeAll\'"\n\t\t\tremit:click="clearActiveFolder"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\ttext="{_this.getClearActiveFolderLabel()}"\n\t\t\ttitle="{_this.getClearActiveFolderLabel()}"\n\t\t\tico="actions:delete"\n\t\t\tqa:id="removeAll"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'delete\'"\n\t\t\tremit:click="remove"\n\t\t\tevent:details="{selection:true}"\n\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\tico="delete"\n\t\t\tqa:id="delete"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'reply\'"\n\t\t\tremit:click="compose:reply"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="r"\n\t\t\ttext="{i18n(\'Ответить\')}"\n\t\t\tico="reply"\n\t\t\tqa:id="reply"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'reply-all\'"\n\t\t\tremit:click="compose:replyall"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="shift+r"\n\t\t\ttext="{i18n(\'Ответить всем\')}"\n\t\t\tico="reply-all"\n\t\t\tqa:id="reply-all"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'forward\'"\n\t\t\tremit:click="compose:forward"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="f"\n\t\t\ttext="{i18n(\'Переслать\')}"\n\t\t\tico="forward"\n\t\t\tqa:id="forward"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'remove\'"\n\t\t\tremit:click="remove"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="del|command+backspace"\n\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\tico="delete"\n\t\t\tqa:id="delete"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'archive\'"\n\t\t\tremit:click="archive"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="e"\n\t\t\ttext="{i18n(\'В архив\')}"\n\t\t\tico="archive"\n\t\t\tqa:id="archive"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'spam\'"\n\t\t\tremit:click="spam"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="shift+j"\n\t\t\ttext="{i18n(\'Спам\')}"\n\t\t\tico="spam-on"\n\t\t\tqa:id="spam-on"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:unsubscribe fn:if="type === \'unsubscribe\'"\n\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tinsteadSpamButton\n\t\t\tqa:id="unsubscribe"\n\t\t\tsenderFrom="{attrs.selectedLettersSenders}"\n\t\t\tletterId="{attrs.selectedLettersIds}"\n\t\t\tshort\n\t\t\twithoutText="{attrs.short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'unspam\' && !attrs.store.folder.isShareTake()"\n\t\t\tremit:click="unspam"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="shift+j"\n\t\t\ttext="{i18n(\'Не спам\')}"\n\t\t\tico="spam-off"\n\t\t\tqa:id="spam-off"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'all-read\'"\n\t\t\t   event:details="{selection:true}"\n\t\t\t   use:mixin="shortcut-title"\n\t\t\t   remit:click="mark:allreaded"\n\t\t\t   text="{attrs.shortText ? i18n(\'Прочитать все\') : i18n(\'Отметить все прочитанными\')}"\n\t\t\t   compact="{attrs.ponymode}"\n\t\t\t   pure\n\t\t\t   ico="status:read"\n\t\t\t   qa:id="all-read"\n\t\t\t   touch="{touch}"\n\t\t\t   size="{size}"\n\t\t\t   short="{short}"\n\t\t\t   disabled="{attrs.disabled}"\n\t\t\t   centered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'read\'"\n\t\t\tremit:click="mark:readed"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="q"\n\t\t\ttext="{i18n(\'Прочитать\')}"\n\t\t\tico="status:read"\n\t\t\tqa:id="to-read"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'select\'"\n\t\t\tremit:click="select:all"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+a|command+a"\n\t\t\ttitle="{i18n(\'Выделить все\')}"\n\t\t\ttext="{attrs.text}"\n\t\t\texplanation="{attrs[\'has-explanation\'] ? i18n(\'Выделить все\'): \'\'}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tico="select-all"\n\t\t\tqa:id="select-all"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'deselect\'"\n\t\t\tremit:click="select:drop"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+a|command+a"\n\t\t\ttitle="{i18n(\'Снять выделение\')}"\n\t\t\ttext="{attrs.text}"\n\t\t\texplanation="{attrs[\'has-explanation\'] ? i18n(\'Снять выделение\'): \'\'}"\n\t\t\tmap="toolbar"\n\t\t\tico="select-all"\n\t\t\tqa:id="deselect-all"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'deselect-back\'"\n\t\t\tremit:click="select:drop"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="esc"\n\t\t\ttitle="{attrs.deselectLabelReset ? i18n(\'Сбросить\') : i18n(\'Вернуться\')}"\n\t\t\ttext="{attrs.deselectLabelReset ? i18n(\'Сбросить\') : i18n(\'Вернуться\')}"\n\t\t\tmap="toolbar"\n\t\t    ico="{(!attrs.deselectLabelReset || short) && \'arrow-back\'}"\n\t\t\tqa:id="deselect-arrow"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\ttext-center="{short}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tnowrap="{attrs.nowrap}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'prev\'"\n\t\t\tremit:click="letter:prev"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+up|ctrl+j"\n\t\t\tshortcut-mac="ctrl+j"\n\t\t\ttext="{i18n(\'Предыдущее\')}"\n\t\t\tmap="toolbar"\n\t\t\tico="arrow-up"\n\t\t\tqa:id="letter_prev"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tshort\n\t\t\tico-text-top\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\trole="prev"\n\t\t\tuse:mediator="thread-manager"\n\t\t\tcentered\n\t/>\n\n\t<b:button2 fn:if="type === \'next\'"\n\t\t\tremit:click="letter:next"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+down|ctrl+k"\n\t\t\tshortcut-mac="ctrl+k"\n\t\t\ttext="{i18n(\'Следующее\')}"\n\t\t\tico="arrow-down"\n\t\t\tqa:id="letter_next"\n\t\t\tmap="toolbar"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tshort\n\t\t\tico-text-top\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\trole="next"\n\t\t\tuse:mediator="thread-manager"\n\t\t\tcentered\n\t/>\n\n\t<b:button2 fn:if="type === \'back\'"\n\t\t\tremit:click="letter:back"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="esc"\n\t\t\ttext="{i18n(\'Вернуться\')}"\n\t\t\tico="arrow-back"\n\t\t\tqa:id="letter_back"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tsize="{size}"\n\t\t\tnowrap="{attrs.nowrap}"\n\t\t\tcentered="{short}"\n\n\t\t\tuse:mediator="thread-manager"\n\t/>\n\n\t<fn:var name="needBackToParentFolderShortcut" value="{_this.needBackToParentShortcut() && !readMode}"/>\n\n\t<b:button2 fn:if="type === \'backToParentFolder\'"\n\t\t\t   remit:click="back:to:parent:folder"\n\t\t\t   event:details="{pos:\'logo\'}"\n\t\t\t   shortcut="{needBackToParentFolderShortcut && \'esc\'}"\n\t\t\t   title-shortcut="{needBackToParentFolderShortcut && \'Esc\'}"\n\t\t\t   text="{_this.getParentFolderName()}"\n\t\t\t   title="{_this.getParentFolderName()}"\n\t\t\t   annotation="{_this.getParentFolderName()}"\n\t\t\t   ico="arrow-back"\n\t\t\t   qa:id="letter_back_to_parent_folder"\n\t\t\t   compact="{attrs.ponymode}"\n\t\t\t   pure\n\t\t\t   touch="{touch}"\n\t\t\t   short="{short}"\n\t\t\t   ico-text-top\n\t\t\t   size="{size}"\n\t\t\t   nowrap="{attrs.nowrap}"\n\t\t\t   centered="{short}"\n\t\t\t   use:mediator="folders-navigation"\n\t/>\n\n\t<b:dropdown fn:if="type === \'moreLettersActions\'"\n\t\t\t\tico="more-hor"\n\t\t\t\tpure\n\t\t\t\ttext="{i18n(\'Ещё\')}"\n\t\t\t\tshort\n\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\tqa:id="more_letters_actions"\n\t>\n\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t<b:list>\n\t\t\t\t<fn:if test="attrs.allRead">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tremit:click="mark:allreaded:before"\n\t\t\t\t\t\tqa:id="allRead"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отметить все прочитанными\')}</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="attrs.removeAll">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tremit:click="clearActiveFolder"\n\t\t\t\t\t\tqa:id="removeAll"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="actions:delete" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{_this.getClearActiveFolderLabel()}</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n\n\t<b:dropdown fn:if="type === \'move\' && !touch"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="v"\n\t\t\ttext="{i18n(\'В папку\')}"\n\t\t\tico="folder-move"\n\t\t\tqa:id="move-to-folder"\n\t\t\tpure\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tdisable-expand-top\n\t\t\tdisable-expand-center\n\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t>\n\n\t\t<fn:match name="items">\n\t\t\t<b:list-nested-moveto-folder\n\t\t\t\tmodel="{attrs.store.letter}"\n\t\t\t\tfolder="{attrs.store.folder}"\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t\tlettersFoldersIds="{attrs.lettersFoldersIds}"\n\t\t\t\tallow-new-folder\n\t\t\t\tallow-move="{false}"\n\t\t\t\tremit:move="folder:click"\n\t\t\t\tuse:mediator="pony-mode folders-actions letters-selection"\n\t\t\t\tqa:id="list-moveto-folder"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:dropdown>\n\n\t<b:button2 fn:if="type === \'move\' && touch"\n\t\t\t\tremit:click="move:click"\n\t\t\t\ttext="{i18n(\'В папку\')}"\n\t\t\t\tico="folder-move"\n\t\t\t\tqa:id="move-to-folder"\n\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\tpure\n\t\t\t\ttouch="{touch}"\n\t\t\t\ttouch-nav="{touch}"\n\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\t\tsize="{size}"\n\t\t\t\tshort="{short}"\n\t\t\t\tico-text-top\n\t\t\t\tcentered="{short}"\n\t/>\n\n\t<b:dropdown fn:if="type === \'folders\'"\n\t\t\tpure\n\t\t\tshort\n\t\t\tnav-folders\n\t\t\ttouch="{touch}"\n\t\t\ttouch-nav="{touch}"\n\t\t\tremit:dropdown-change-state="folders-toggle">\n\n\t\t<fn:match name="ctrl" args="attrs">\n\t\t\t<b:button2\n\t\t\t\t\tqa:id="burger-button"\n\t\t\t\t\tremit:click="ctrl-click"\n\t\t\t\t\tico="{attrs.ponymode ? \'navigation:menu_s\' : \'navigation:menu\'}"\n\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\tshort\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tpure="{attrs.pure}"\n\t\t\t\t\tsecondary="{attrs.secondary}"\n\t\t\t\t\tsize="{attrs.size}"\n\t\t\t\t\tcentered="{short}"\n\t\t\t/>\n\n\t\t\t<b:button2\n\t\t\t\t\tqa:id="hide"\n\t\t\t\t\tremit:click="ctrl-click"\n\t\t\t\t\ttext="{i18n(\'Скрыть\')}"\n\t\t\t\t\tico="arrow-back"\n\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tpure="{attrs.pure}"\n\t\t\t\t\tsecondary="{attrs.secondary}"\n\t\t\t\t\tsize="{attrs.size}"\n\t\t\t\t\tcentered="{short}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="items">\n\t\t\t<b:list-nested-moveto-folder\n\t\t\t\tmodel="{attrs.store.letter}"\n\t\t\t\tfolder="{attrs.store.folder}"\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t\tlettersFoldersIds="{attrs.lettersFoldersIds}"\n\t\t\t\tallow-new-folder\n\t\t\t\tuse:mediator="pony-mode folders-actions letters-selections"\n\t\t\t\tqa:id="list-moveto-folder"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:dropdown>\n\n\t<b:dropdown-actions fn:if="type === \'more\'"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tuse:mediator="layout-manager settings-filters-manager unsubscribe-actions calendar-manager translator-manager calls-manager letters-selection"\n\t\t\tqa:id="more"\n\t\t\tmodel="{attrs.store.letter}"\n\t\t\tselectedLettersIds="{attrs.selectedLettersIds}"\n\t\t\tfolder="{attrs.store.folder}"\n\t\t\tdropdown-shortcut="."\n\t\t\ttext="{i18n(\'Ещё\')}"\n\t\t\tico="more-hor"\n\n\t\t\tdisable-edit="{attrs[\'disable-edit\']}"\n\n\t\t\tread="{attrs.read}"\n\t\t\tunread="{attrs.unread}"\n\t\t\tflag="{attrs.flag}"\n\t\t\tunflag="{attrs.unflag}"\n\t\t\tarchive="{attrs.archive}"\n\t\t\tinvite-call="{attrs[\'invite-call\']}"\n\t\t\tcreate-event="{attrs[\'create-event\']}"\n\t\t\tcreate-filter="{attrs[\'create-filter\']}"\n\t\t\ttranslate="{attrs.translate}"\n\t\t\tprint="{attrs.print}"\n\n\t\t\treadletter="{attrs.readletter}"\n\t\t\tforward="{attrs.forward}"\n\t\t\tspam="{attrs.spam}"\n\t\t\tspamAbovePrint="{attrs.spamAbovePrint}"\n\t\t\tspamDisabled="{attrs.spamDisabled}"\n\t\t\tunsubscribeAbovePrint="{attrs.unsubscribeAbovePrint}"\n\t\t\tunspam="{attrs.unspam}"\n\t\t\tsuperspam="{attrs.superspam}"\n\n\t\t\tmore="{attrs.readletter}"\n\n\t\t\tdisable-expand-top\n\t\t\tdisable-expand-center\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tpure\n\t\t\tshort\n\t\t\tico-text-top\n\t\t\tselection-actions\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t/>\n\n\t<b:filters fn:if="(type === \'filters\')"\n\t\t\tqa:id="filters"\n\t\t\tuse:mediator="filter-manager layout-manager themes-manager settings-manager pony-mode advert-manager todo-manager folders-actions"\n\t\t\tfolder="{attrs.folder}"\n\t\t\tshort="{attrs.short}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tautochange="{false}"\n\t\t\tpure\n\t\t\thas-metathreads-settings="{attrs[\'has-metathreads-settings\']}"\n            combineFilterAndFolderName="{attrs.combineFilterAndFolderName}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/portal-menu-element/portal-menu-element.html")});define("feast-tpl!ui-block/portal-menu-element/portal-menu-element.html",["feast-tpl!app/feast-tpl!ui-block/portal-menu-element/portal-menu-element.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/dropdown-actions/dropdown-actions.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{message && message.getFolder()}"/>\n\t<fn:var name="folders" value="{attrs.folders}"/>\n\t<fn:var name="parentThread" value="{attrs.parentThread}"/>\n\n\t<b:dropdown\n\t\t\tshortcut="{attrs[\'dropdown-shortcut\']}"\n\t\t\ttitle-shortcut="{attrs[\'title-shortcut\']}"\n\t\t\ttitle="{attrs.title}"\n\t\t\ttext="{attrs.text}"\n\t\t\tico="{attrs.ico}"\n\t\t\tshort\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tpure="{attrs.pure}"\n\t\t\tsecondary="{attrs.secondary}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\ttouch-nav="{attrs[\'touch-nav\']}"\n\t\t\texpand-left="{attrs[\'expand-left\']}"\n\t\t\tdisable-expand-top="{attrs[\'disable-expand-top\']}"\n\t\t\tdisable-expand-center="{attrs[\'disable-expand-center\']}"\n\n\t\t\tsize="{attrs.size}"\n\t\t\tradar-id="ctrl"\n\t\t\tremit:dropdown-change-state="dropdown-change"\n\t\t>\n\n\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t<b:list\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tshortcut\n\t\t\t\tref="list"\n\t\t\t>\n\t\t\t\t\x3c!-- Блок №1 – "Ответ на письмо" --\x3e\n\t\t\t\t<fn:if test="attrs.reply">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="reply"\n\n\t\t\t\t\t\tremit:click="compose:reply"\n\t\t\t\t\t\tevent:details="message"\n\n\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="reply" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Ответить\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="replyall"\n\n\t\t\t\t\t\tremit:click="compose:replyall"\n\t\t\t\t\t\tevent:details="message"\n\n\t\t\t\t\t\tshortcut="shift+r"\n\n\t\t\t\t\t\tfn:if="attrs.reply == \'all\'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="reply-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Ответить всем\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="shift+r"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="forward"\n\n\t\t\t\t\t\tremit:click="compose:forward"\n\t\t\t\t\t\tevent:details="message"\n\n\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="forward" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переслать\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<div bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END\\ Блок №1 – "Ответ на письмо" --\x3e\n\n\t\t\t\t\x3c!-- Блок №2 – "Действия над письмами" --\x3e\n\t\t\t\t<fn:if test="attrs.remove || attrs.unsubscribe || attrs.archive || attrs.spam || attrs.unspam || attrs.move">\n\t\t\t\t\t<fn:if test="attrs.remove && _this.isRemoveVisible()">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="remove"\n\n\t\t\t\t\t\t\tremit:click="remove"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\n\t\t\t\t\t\t\tshortcut="del|command+backspace"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="del|command+backspace"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.archive && !attrs[\'archive-force-disabled\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="archive"\n\n\t\t\t\t\t\t\tremit:click="archive"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\t\t\t\t\t\t\tshortcut="e"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'В архив\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="e"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.spam">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="spam"\n\n\t\t\t\t\t\t\tremit:click="spam"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\n\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Спам\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unsubscribe">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unsubscribe"\n\t\t\t\t\t\t\tremit:click="click:unsubscribe"\n\t\t\t\t\t\t\tevent:details="{selectedLettersIds: attrs.selectedLettersIds}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отписаться\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unspam && !folder.isShareTake()">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unspam"\n\n\t\t\t\t\t\t\tremit:click="unspam"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-off" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Не спам\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- Перемещение в папку --\x3e\n\t\t\t\t\t<fn:if test="attrs.move">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="folder"\n\n\t\t\t\t\t\t\tid="moveto-folder"\n\n\t\t\t\t\t\t\tremit:click.stop.prevent="click:move"\n\n\t\t\t\t\t\t\tselected="{attrs.expanded}"\n\t\t\t\t\t\t\tnested\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переместить в папку\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="nested">\n\t\t\t\t\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<div fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END\\ Блок №2 – "Действия над письмами" --\x3e\n\n\t\t\t\t\x3c!-- Блок №3 – "Действия над письмами + `мета` действия" --\x3e\n\t\t\t\t<fn:if test="attrs.superspam || attrs.read || attrs.spamAbovePrint || attrs.unsubscribeAbovePrint || attrs.print || attrs.unread || attrs.flag || attrs.unflag || attrs[\'create-event\'] || attrs[\'create-filter\']">\n\t\t\t\t\t<fn:if test="attrs.superspam">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="superspam"\n\n\t\t\t\t\t\t\tremit:click="superspam"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Точно спам\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.read">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="read"\n\n\t\t\t\t\t\t\tremit:click="mark:readed"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="q"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Пометить прочитанным\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="q"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unread">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unread"\n\n\t\t\t\t\t\t\tremit:click="mark:unreaded"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="u"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Пометить непрочитанным\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="u"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.flag">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="flag"\n\n\t\t\t\t\t\t\tremit:click="mark:flagged"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="flag">\n\t\t\t\t\t\t\t\t<b:ico name="actions:favorite_on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Пометить флажком\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unflag">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unflag"\n\n\t\t\t\t\t\t\tremit:click="mark:unflagged"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="unflag">\n\t\t\t\t\t\t\t\t<b:ico name="actions:favorite_off" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Снять флажок\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'invite-call\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="calls:invite"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\n\t\t\t\t\t\t\tremit:click="calls:invite"\n\t\t\t\t\t\t\tevent:details="{model:message}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Предложить звонок\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'create-event\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="calendar:create"\n\n\t\t\t\t\t\t\tremit:click="calendar:create"\n\t\t\t\t\t\t\tevent:details="{model:message, createContent:\'web_email_header_select\'}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="calendar-month" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать событие\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.spamAbovePrint">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs.spamDisabled}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="spam"\n\n\t\t\t\t\t\t\tremit:click="spam"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\n\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Спам\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unsubscribeAbovePrint">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unsubscribe"\n\t\t\t\t\t\t\tremit:click="click:unsubscribe"\n\t\t\t\t\t\t\tevent:details="{selectedLettersIds: attrs.selectedLettersIds}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отписаться\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.print">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="print"\n\t\t\t\t\t\t\tevent:details="{model: message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t\tremit:click="print"\n\t\t\t\t\t\t\tshortcut="command+p|ctrl+p"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnablePrint()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="actions:print" size="s" />\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Распечатать\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="ctrl+p"\n\t\t\t\t\t\t\t\t\tshortcut-mac="cmd+p"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'create-filter\'] && !attrs.mobile">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="settingsfilters:create"\n\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t\tremit:click="settingsfilters:create"\n\n\t\t\t\t\t\t\tshortcut="shift+l"\n\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableFilterCreate()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="filter" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать фильтр\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+l"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'category-feedback\'] && !folder.isShareTake()">\n\t\t\t\t\t\t<fn:var name="category" value="{_this.getCategoryIcon(message, folder)}"/>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="category-feedback"\n\n\t\t\t\t\t\t\tid="category-feedback"\n\n\t\t\t\t\t\t\tremit:click.stop.prevent="click:category-feedback"\n\n\t\t\t\t\t\t\tselected="{attrs.expanded}"\n\t\t\t\t\t\t\tnested\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="{category.name}">\n\t\t\t\t\t\t\t\t<b:ico name="{category.icon}" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Категория письма\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="nested">\n\t\t\t\t\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.translate">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="translate"\n\t\t\t\t\t\t\tevent:details="{model:message}"\n\t\t\t\t\t\t\tremit:click="translator:show"\n\t\t\t\t\t\t\tshortcut="shift+t"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="wysiwyg:translate" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Перевести письмо\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+t"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.forward">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableForwardAsAttach()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="forward"\n\n\t\t\t\t\t\t\tremit:click="forward"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="status:attach" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переслать как вложение\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<div bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END\\ Блок №3 – "Действия над письмами + `мета` действия" --\x3e\n\n\t\t\t\t\x3c!-- Блок №4 – "Поиск по письму" --\x3e\n\t\t\t\t<fn:if test="attrs.readletter">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="search:from"\n\n\t\t\t\t\t\tremit:click="search:from"\n\n\t\t\t\t\t\tshortcut="shift+s"\n\t\t\t\t\t>\n\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t\t\t<b:ico name="search" size="s"/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Найти все письма\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="shift+s"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END/ Блок №4 – "Поиск по письму" --\x3e\n\n\t\t\t\t\x3c!-- Блок №5 – "Ещё" --\x3e\n\t\t\t\t<fn:if test="attrs.more">\n\t\t\t\t\t<div bem:elem="hr"/>\n\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tfn:if="!attrs[\'more-expanded\']"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="letter-more"\n\n\t\t\t\t\t\tid="letter-more"\n\n\t\t\t\t\t\tremit:click.stop.prevent="click:letter-more"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="navigation:drop_down_big" size="s"/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Ещё\')}</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<fn:if test="attrs[\'more-expanded\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableRedirect()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="redirect"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="redirect"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="wysiwyg:arrow" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Перенаправить\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableForwardAsAttach()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="forward-as-attach"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="forward"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="status:attach" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переслать как вложение\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="headers"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="headers"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableServiceHeaders()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="categories:document" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Служебные заголовки\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="download"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="download"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableDownload()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="actions:download_alt" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Скачать на компьютер\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<fn:if test="attrs[\'new-tab-available\']">\n\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\t\tqa:id="newtab"\n\t\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\t\tremit:click="newtab"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END/ Блок №5 – "Ещё" --\x3e\n\t\t\t</b:list>\n\t\t</fn:match>\n\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/dropdown-actions/dropdown-actions.html")});define("feast-tpl!ui-block/dropdown-actions/dropdown-actions.html",["feast-tpl!app/feast-tpl!ui-block/dropdown-actions/dropdown-actions.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/shortcut-hint/shortcut-hint.html",["feast"],function(a){return a.smartParse("<div>\n\t<fn:value>_this.getShortcut()</fn:value>\n</div>\n","app/feast-tpl!ui-block/shortcut-hint/shortcut-hint.html")});define("feast-tpl!ui-block/shortcut-hint/shortcut-hint.html",["feast-tpl!app/feast-tpl!ui-block/shortcut-hint/shortcut-hint.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/shortcut-hint/shortcut-hint",["require","exports","feast","feast-tpl!./shortcut-hint.html","helpers/browser","service/shortcut"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"shortcut-hint",template:b.default,defaults:{shortcut:"","shortuc-mac":"","is-mac":c.default.mac},getShortcut:function(){var a=this.get("shortcut-mac");var b=this.get("shortcut");var c=this.get("is-mac");if(c&&a){return d.default.getShortcutTitle(a)}return d.default.getShortcutTitle(b)}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dropdown-actions/dropdown-actions",["require","exports","default-values","feast","feast-tpl!./dropdown-actions.html","helpers/folder","helpers/radar-utils","mail/Folder","service/layer","service/radars/decorator","service/submenu","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item","ui-block/list-nested/list-nested","ui-block/shortcut-hint/shortcut-hint"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);var p={newsletters:"categories:mailings",social:"navigation:users",news:"categories:subscriptions",official:"categories:government",receipts:"categories:receipts",travel:"categories:flight",event:"categories:ticket",finance:"categories:currency_rouble",registration:"categories:access",order:"navigation:cart",fees:"categories:government",uncategorized:"categories:mail",tomyself:"categories:self_mail",school:"categories:school",games:"categories:games"};exports.default=b.default.Block.extend(h.default({id:"dropdown",events:[{name:"compose:reply",data:e.getModelData},{name:"compose:replyall",data:e.getModelData},{name:"compose:forward",data:e.getModelData},{name:"mark:readed",data:e.getModelData},{name:"mark:unreaded",data:e.getModelData},{name:"mark:flagged",data:e.getModelData},{name:"mark:unflagged",data:e.getModelData},{name:"remove",data:e.getModelData},{name:"archive",data:e.getModelData},{name:"spam",data:e.getModelData},{name:"unspam",data:e.getModelData},{name:"superspam",data:e.getModelData},{name:"click:move",data:e.getModelData},{name:"search:from",data:e.getModelData},{name:"calendar:create",data:e.getModelData},{name:"print",data:e.getModelData},{name:"calls:invite",data:e.getModelData},{name:"settingsfilters:create",data:e.getModelData},{name:"forward",data:e.getModelData},{name:"translator:show",rename:"trans:click"},"click:category-feedback","click:letter-more"]})({name:"dropdown-actions",template:c.default,isolateEvents:false,blocks:{dropdown:j.default,list:l.default,"list-nested":n.default,"list-item":m.default,ico:k.default,"shortcut-hint":o.default},defaults:{"nestedmenu-expanded":false,"selection-actions":false,"more-expanded":false,translate:false,"archive-force-disabled":a.ARCHIVE_DISABLED,"new-tab-available":!a.USE_SINGLE_TAB,"disable-shortcuts":a.DISABLE_DROPDOWN_ACTIONS_SHORTCUTS},events:{"click:move":"onMoveToClick","click:category-feedback":"onCategoryFeedbackClick","click:letter-more":"onLetterMoreClick","dropdown-change":"onDropdownChangeState","click:unsubscribe":"onUnsubscribeClick"},didUnmount:function(){i.default.destroy()},didUpdate:function(){if(this._scrollToLastItem&&this.get("more-expanded")){var a=this.refs.list;var b=a.parentNode;try{b.scrollTo({top:1e4,behavior:"smooth"})}catch(a){b.scrollTop=1e4}this._scrollToLastItem=null}},onLetterMoreClick:function(){this._scrollToLastItem=true;this.set("more-expanded",true)},onUnsubscribeClick:function(a){var b=a.details;var c=b.selectedLettersIds;this.broadcast("unsubscribe",{ids:c,position:"more-dropdown"})},onMoveToClick:function(){if(this.is("touch")){var a=this.get("model");g.default.open("move-to-folder",{letter:a},{dimmer:false,mobile:true,resolvable:true})}else{this.toggleSubmenu("moveto-folder")}},onCategoryFeedbackClick:function(){this.toggleSubmenu("category-feedback")},toggleSubmenu:function(a){var b=this.get("nestedmenu-expanded");if(!b){var c=this.ids[a];var d={folders:this.get("folders"),model:this.get("model"),"dark-mode":this.get("dark-mode"),metathreads:this.get("metathreads"),parentThread:this.get("parentThread")};i.default.open(a,d,c)}},onDropdownChangeState:function(a){var b=a.details.state;if(!b){i.default.close();this.set({"nestedmenu-expanded":false,"more-expanded":false})}},getCategoryIcon:function(a,b){var c=a.get("transaction_category");var d=b.isMetathread()&&b.get("type");var e=c||d||"uncategorized";return{name:e,icon:p[e]}},getCurrentFoldersIds:function(){var a=this.get("route");if(a.is("#read-letter #search-letter")){var b=this.get("model");return[b.get("folder")]}var c=this.get("lettersFoldersIds");if(c.length){return c}return[this.get("folder").id]},checkFolderGrant:function(a){var b=this.getCurrentFoldersIds();return b.every(function(b){var c=f.default.all.get(b);return c.checkGrant(a)})},isEnableReply:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},isEnableForward:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.forward)},isEnableRedirect:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.redirect_everywhere)},isEnableForwardAsAttach:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.forward_as_attachment)},isEnableMove:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move)},isEnableRemove:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.remove)},isRemoveVisible:function(){return!d.isDeleteFromFolderDisabled(this.get("folder"))},isEnableMark:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.mark_as_important)},isEnableMoveToSpam:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_spam)},isEnableMoveToArchive:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_archive)},isEnablePrint:function(){return this.isEverySelectedFoldersMine()},isEnableDownload:function(){return this.isEverySelectedFoldersMine()},isEnableServiceHeaders:function(){return!a.DISABLE_LETTER_HEADERS_BUTTON&&this.isEverySelectedFoldersMine()},isEnableCall:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},isEnableFilterCreate:function(){return this.isEverySelectedFoldersMine()},isEverySelectedFoldersMine:function(){var a=this.getCurrentFoldersIds();return a.every(function(a){var b=f.default.all.get(a);return!b.isShareTake()})}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/portal-menu-element/portal-menu-element",["require","exports","@mail/xray","default-values","feast","feast-tpl!./portal-menu-element.html","helpers/radar-utils","mail/Folder","service/layer","service/radars/decorator","ui-block/button2/button2","ui-block/dropdown/dropdown","ui-block/dropdown-actions/dropdown-actions","ui-block/filters/filters","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);exports.default=c.default.Block.extend(h.default({prop:"type",events:[{name:"move:click",rename:"mobile",data:e.getLetterData},{name:"remove",data:e.getLetterData,default:true},{name:"archive",data:e.getLetterData,default:true},{name:"spam",data:e.getLetterData,default:true},{name:"unspam",data:e.getLetterData,default:true},{name:"move",data:e.getLetterData,default:true},{name:"translate",data:e.getLetterData,default:true},{name:"compose:reply",data:e.getLetterData,default:true},{name:"compose:replyall",data:e.getLetterData,default:true},{name:"compose:forward",data:e.getLetterData,default:true},{name:"compose:new",default:true},{name:"mark:readed",default:true},"select:all","select:drop","letter:prev","letter:next","letter:back","search:back","back:to:parent:folder"]})({name:"portal-menu-element",template:d.default,isolateEvents:false,blocks:{button2:i.default,dropdown:j.default,"dropdown-actions":k.default,filters:l.default,"list-nested-moveto-folder":m.default},lazyBlocks:{unsubscribe:n.lazyUIUnsubscribe},defaults:{"has-metathreads-settings":false,deselectLabelReset:b.DESELECT_ALL_LABEL_STYLE==="reset"},events:{"folders-toggle":"onFoldersToggle","move:click":"onMoveToClick","folder:click":"onFolderClick",clearActiveFolder:"onClearActiveFolder","mark:allreaded:before":"onMarkAllreadedBefore"},didMount:function(){if(this.get("type")==="backToParentFolder"&&!this.get("hidden")){var b=this.get("folder");var c=this.get("folders");var d=c===null||c===void 0?void 0:c.find(function(a){return a.id===(b===null||b===void 0?void 0:b.get("parent"))});a.default.send("back-to-parent-show",{dwh:{pos:"logo",folder:b===null||b===void 0?void 0:b.id,parentFolder:d===null||d===void 0?void 0:d.id}})}},useReactSearchPanel:function(){return b.SEARCH_PANEL_REACT},usePortalSearchPanel:function(){return b.SEARCH_PANEL_PORTAL},onFoldersToggle:function(a){this.set("folder-overflow",a.details.state)},onFolderClick:function(a){this.broadcast("move",Object.assign(a.details,{selection:true,model:undefined}))},onMoveToClick:function(){g.default.open("move-to-folder",{folders:this.get("folders"),letter:this.get("model")},{dimmer:false,mobile:true,resolvable:false})},getCurrentFoldersIds:function(){var a=this.get("store");if(a.route.is("#read-letter #search-letter")){var b=a.letter;return[b.get("folder")]}var c=this.get("lettersFoldersIds");if(c.length){return c}return[a.folder.id]},checkFolderGrant:function(a){var b=this.getCurrentFoldersIds();return b.every(function(b){var c=f.default.all.get(b);return c.checkGrant(a)})},onClearActiveFolder:function(){var b=this.get("store");var c=b.folder;a.default.send("folder-more-clear-click",{dwh:{folder:c.id}});this.broadcast("clear",{model:c})},onMarkAllreadedBefore:function(){var b=this.get("store");var c=b.folder;a.default.send("folder-more-allread-click",{dwh:{folder:c.id}});this.broadcast("mark:allreaded")},getClearActiveFolderLabel:function(){var a=this.get("store");var b=a.folder;if(b.isInbox()||b.isNewsletters()||b.isToMyself()||b.isOfficial()){return i18n("Удалить")+" "+b.attributes.name.toLowerCase()}return i18n("Удалить все письма")},isEnableReply:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},isEnableForward:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.forward)},isEnableMove:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move)},isEnableRemove:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.remove)},isEnableMoveToSpam:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_spam)},isEnableMoveToArchive:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_archive)},isShowUnspam:function(){if(this.get("disabled")){return false}var a=this.get("store").letter;var b=this.get("store").folder||a.getFolder();return b.isShareTake()},getParentFolderName:function(){var a=this.get("folder");var b=this.get("folders");var c=b===null||b===void 0?void 0:b.find(function(b){return b.id===(a===null||a===void 0?void 0:a.get("parent"))});return c===null||c===void 0?void 0:c.get("name")},needBackToParentShortcut:function(){return b.BACK_TO_PARENT_SHORTCUT}}))});define("feast-tpl!app/feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html",["feast"],function(a){return a.smartParse('<div qa:id="portal-menu-logo">\n\t<fn:var name="readMode" value="{attrs.readMode}"/>\n\t<fn:var name="selectMode" value="{attrs.selectMode}"/>\n\t<fn:var name="searchRoute" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\t<fn:var name="filterRoute" value="{attrs.route.is(\'#letters #read-letter\') && attrs.route.filterQuery.has()}"/>\n\t<fn:var name="layoutType" value="{attrs.layoutType}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponyMode}"/>\n\t<fn:var name="hideLogo" value="{_this.hideLogo}"/>\n\n\t<fn:var name="isShortcutLogo" value="{attrs.compact}"/>\n\n\t\x3c!-- То же условие что и для лого, но в перспективе может поменяться и по смыслу не то же, так что разделяем --\x3e\n\t<fn:var name="isShortcutButton" value="{isShortcutLogo}"/>\n\n\t<fn:var name="showBackToListButton" value="{layoutType === \'2pane\' && readMode}"/>\n\t<fn:var name="showBackToParentFolderButtonAtAll" value="{attrs.needBackToParentFolder}"/>\n\t<fn:var name="showBackToParentFolderButtonAtLogo" value="{_this.needBackToParentFolderButton()}"/>\n\n\t<fn:var name="activeLogoKey" value="{_this.getActiveLogoKey(isShortcutLogo)}" />\n\t<fn:var name="activeLogoSrc" value="{_this.getLogoSrcFromKey(activeLogoKey)}" />\n\t<fn:var name="isActiveLogoAdaptive" value="{_this.isActiveLogoAdaptive(activeLogoKey)}" />\n\n\t<bem:mod name="pony-mode" test="attrs.ponyMode"/>\n\t<bem:mod name="short" test="isShortcutLogo"/>\n\n\t<div bem:elem="content">\n\t\t<bem:mod name="adaptive" test="isActiveLogoAdaptive && !searchRoute && !selectMode && !showBackToListButton" />\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="selectMode">\n\t\t\t\t<span>\n\t\t\t\t\t<fn:var name="marginLeft" value="{\'margin-left: 4px\'}"/>\n\n\t\t\t\t\t\x3c!-- TODO: костыль, перепилить с инлайн стилей на классы --\x3e\n\t\t\t\t\t<fn:attr test="isShortcutButton && ponyMode"\n\t\t\t\t\t\t\t\tname="style"\n\t\t\t\t\t\t\t\tvalue="{marginLeft};"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\ttype="deselect-back"\n\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="searchRoute">\n\t\t\t\t<span>\n\t\t\t\t\t<fn:var name="marginLeft" value="{\'margin-left: 8px\'}"/>\n\n\t\t\t\t\t<fn:attr test="isShortcutButton && ponyMode"\n\t\t\t\t\t\t\tname="style"\n\t\t\t\t\t\t\tvalue="{marginLeft};"\n\t\t\t\t\t/>\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\ttype="back"\n\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<span fn:if="showBackToListButton">\n\t\t\t\t\t\x3c!-- TODO: костыль, перепилить с инлайн стилей на классы --\x3e\n\t\t\t\t\t<fn:var name="marginLeft" value="{\'margin-left: 4px\'}"/>\n\n\t\t\t\t\t<fn:attr test="isShortcutButton && ponyMode"\n\t\t\t\t\t\t\tname="style"\n\t\t\t\t\t\t\tvalue="{marginLeft};"\n\t\t\t\t\t/>\n\t\t\t\t\t<b:portal-menu-element fn:if="readMode && layoutType == \'2pane\'"\n\t\t\t\t\t\t\t\t\ttype="back"\n\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\n\t\t\t\t<span fn:if="(showBackToParentFolderButtonAtLogo || showBackToParentFolderButtonAtAll && attrs.enableBackToParentShortcut) && !showBackToListButton">\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\ttype="backToParentFolder"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t    nowrap\n\t\t\t\t\t\thidden="{!showBackToParentFolderButtonAtLogo}"\n\t\t\t\t\t    folder="{attrs.folder}"\n\t\t\t\t\t    folders="{attrs.folders}"\n\t\t\t\t\t    readMode="{readMode}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\n\t\t\t\t<fn:var name="logo" value="{_this.getLogo()}"/>\n\t\t\t\t<fn:var name="logoWidth" value="{_this.getLogoWidth(logo, isShortcutLogo, ponyMode)}"/>\n\t\t\t\t<fn:var name="logoHeight" value="{_this.getLogoHeight(logo, isShortcutLogo, ponyMode)}"/>\n\t\t\t\t<fn:var name="logoImageWidth" value="{logo.scale ? logoWidth : \'auto\'}"/>\n\t\t\t\t<fn:var name="adaptiveLogoSrc" value="{_this.getAdaptiveLogo(logo)}" />\n\t\t\t\t<fn:var name="rebrandingMedium" value="{_this.isMediumRebrandingLogo(logo, isShortcutLogo)}"/>\n\t\t\t\t<a\n\t\t\t\t\tfn:if="!showBackToListButton && !hideLogo && !showBackToParentFolderButtonAtLogo"\n\t\t\t\t\tbem:elem="logo"\n\t\t\t\t\tbem:mod="{_this.getLogoMod(logo, isShortcutLogo, ponyMode)}"\n\t\t\t\t\theight="{logoHeight}"\n\t\t\t\t\tstyle="width: {logoWidth}px;"\n\t\t\t\t\tremit:click="logo-click"\n\t\t\t\t\tqa:id="{isShortcutLogo ? \'short-logo\' : \'logo\'}"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="compact" test="isShortcutLogo"/>\n\t\t\t\t\t<bem:mod name="pony-mode" test="ponyMode"/>\n\t\t\t\t\t<bem:mod name="hidden" test="!logoWidth"/>\n\t\t\t\t\t<bem:mod name="scale" test="logo.scale"/>\n\t\t\t\t\t<bem:mod name="bg_logo" test="_this.getLogoKind() === \'bg\'"/>\n\t\t\t\t\t<bem:mod name="load_err" test="attrs[\'logo-load-err\']"/>\n\t\t\t\t\t<bem:mod name="load_err_pony" test="ponyMode && attrs[\'logo-load-err\']"/>\n\t\t\t\t\t<bem:mod name="load_err_compact" test="isShortcutLogo && attrs[\'logo-load-err\']"/>\n\t\t\t\t\t<bem:mod name="rebranding-medium" test="rebrandingMedium"/>\n\n\t\t\t\t\t<a\n\t\t\t\t\t\tbem:elem="container"\n\t\t\t\t\t\ttitle="{_this.getLogoTitle(logo)}"\n\t\t\t\t\t\ttarget="{_this.getLogoTarget(logo)}"\n\t\t\t\t\t\thref="{_this.getLogoHref(logo)}"\n\t\t\t\t\t\talt="{logo.alt}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div bem:elem="image-wrapper">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tfn:if="activeLogoSrc"\n\t\t\t\t\t\t\t\tbem:block="portal-menu-logo__logo__img"\n\t\t\t\t\t\t\t\tsrc="{activeLogoSrc}"\n\t\t\t\t\t\t\t\theight="{logoHeight}"\n\t\t\t\t\t\t\t\twidth="{logoImageWidth}"\n\t\t\t\t\t\t\t\tremit:error="logo-load-error"\n\t\t\t\t\t\t\t\tremit:load="logo-load-success"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\n\t\t\t\t\t\t\t\x3c!--- Вторая картирка нужна для адаптивного лого, чтобы во время переходного этапа между шорткатами\n\t\t\t\t\t\t\tи норм видом никакая картинка не отображалась.\n\t\t\t\t\t\t\tЕсли так не сделать, во время загрузки новой картинки будет отображаться старая, а стили уже обновятся\n\t\t\t\t\t\t\t@see https://jira.mail.ru/browse/FMAIL-11793\n\t\t\t\t\t\t\t---\x3e\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tfn:if="adaptiveLogoSrc"\n\t\t\t\t\t\t\t\tbem:block="portal-menu-logo__logo__img"\n\t\t\t\t\t\t\t\tsrc="{adaptiveLogoSrc}"\n\t\t\t\t\t\t\t\theight="{logoHeight}"\n\t\t\t\t\t\t\t\twidth="{logoImageWidth}"\n\t\t\t\t\t\t\t\tremit:error="logo-load-error"\n\t\t\t\t\t\t\t\tremit:load="logo-load-success"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="!isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\tbem:elem="container"\n\t\t\t\t\t\ttitle="{_this.getLogoTitleBrand(logo)}"\n\t\t\t\t\t\ttarget="{_this.getLogoTargetBrand(logo)}"\n\t\t\t\t\t\thref="{_this.getLogoHrefBrand(logo)}"\n\t\t\t\t\t    alt="{logo.altBrand}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<bem:mod name="vk_rebranding-medium" test="rebrandingMedium"/>\n\n\t\t\t\t\t\t<fn:var name="rebranding" value="{_this.isRebranding(logo)}"/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tfn:if="!isShortcutLogo && rebranding"\n\t\t\t\t\t\t\tbem:elem="vk"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<fn:var name="vkSrc" value="{_this.getVkSrc(logo, rebrandingMedium)}"/>\n\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc="{vkSrc}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc="{vkSrc}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="!isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</a>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html")});define("feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html",["feast-tpl!app/feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-adaptive",["require","exports","helpers/fast-deep-equal","resize-observer-polyfill","./debounce-frame"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GetAdaptive=void 0;a=__importDefault(a);b=__importDefault(b);function d(a){return typeof a==="function"}var e=function(){function e(e){var f=this;var g=e.breakpoints,h=e.onResize,i=e.element,j=e.pureBreakpoints;this.handleResize=function(b){var c=f.breakpoints.find(function(a){if(!a.conditions){return true}return!!a.conditions(b)});if(d(c.props)){var e=c.props(b);if(f.pureBreakpoints&&c==f.lastBreakpoint&&a.default(e,f.lastProps)){return}f.onResize(e);f.lastProps=e}else{if(f.pureBreakpoints&&c==f.lastBreakpoint){return}f.onResize(c.props)}f.lastBreakpoint=c};this.breakpoints=g;this.onResize=h;this.pureBreakpoints=j;var k=new c.FrameDebouncer(this.handleResize);this.validateBreakpoints();this.resizeObserver=new b.default(function(a){k.requestDebouncedFrame(a[0].contentRect)});this.resizeObserver.observe(i);this.debouncer=k}e.prototype.validateBreakpoints=function(){var a=this.breakpoints.filter(function(a){return!a.conditions});if(a.length===0){throw new Error("No default breakpoint provided!")}if(a.length>1){throw new Error("Too many default breakpoints provided, expected 1")}};e.prototype.destroy=function(){this.resizeObserver.disconnect();this.debouncer.destroy()};return e}();exports.GetAdaptive=e});var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/portal-menu-logo/portal-menu-logo",["require","exports","@mail/xray","cfg","default-values","feast","feast-tpl!./portal-menu-logo.html","helpers/get-adaptive","ui-block/portal-menu-element/portal-menu-element"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);var h=96;var i=200;var j=16;var k;(function(a){a["src"]="src";a["bgSrcAdaptive"]="bg_src_adaptive";a["bgSrcBig"]="bg_src_big";a["bgSrcSmall"]="bg_src_small"})(k||(k={}));function l(){var a=document.createElement("a");a.href=b.default.urls.logoUrl;a.hostname=window.location.hostname;a.pathname="/imgsmail"+a.pathname;return a.pathname}var m={name:"portal-menu-logo",template:e.default,blocks:{"portal-menu-element":g.default},events:{"logo-load-error":"handleLogoLoadError","logo-load-success":"handleLogoLoadSuccess","logo-click":"onLogoClick"},defaults:{"logo-load-err":false,enableBackToParentShortcut:c.BACK_TO_PARENT_SHORTCUT},hideLogo:c.HIDE_LOGO,constructor:function(){d.default.Block.prototype.constructor.apply(this,arguments);this.onResize=this.onResize.bind(this)},didMount:function(){var a=this;var c=b.default.get("logo.breakpoints")?b.default.get("logo.breakpoints").map(function(a){var b=a.width,c=a.height,d=a.compact;return{conditions:function(a){var c=a.width;return c>=b},props:{width:b,height:c,compact:d,"hide-scale-logo":false}}}):[];this.adaptiveHandler=new f.GetAdaptive({pureBreakpoints:true,breakpoints:__spreadArrays(c,[{conditions:function(b){var c=b.width;if(a.getLogoKind()!=="bg"){return false}return c<a.getBgLogoConfig().fullSizeMinWidth},props:{compact:true,"hide-scale-logo":false}},{conditions:function(){return a.getLogoKind()==="bg"},props:function(){return{compact:false,"hide-scale-logo":false}}},{conditions:function(a){var b=a.width;return b>=i+j*2},props:{compact:false,"hide-scale-logo":false}},{conditions:function(a){var b=a.width;return b>=h+j*2},props:function(){return{compact:false,"hide-scale-logo":true}}},{props:{compact:true,"hide-scale-logo":true}}]),element:this.el,onResize:this.onResize})},getBgLogoConfig:function(){var a=this.getLogo();return{fullSizeMinWidth:c.PROMO_LOGO_MIN_WIDTH,bgAdaptive:a.bgAdaptive}},getLogo:function(){return b.default.get("logo")},getLogoMod:function(a,b,c){if(a.scale){return"scale"}return(c?"pony":"normal")+"_"+(b?"compact":"wide")},getLogoSize:function(a,b,c){if(a.scale&&this.get("hide-scale-logo")){return{height:0,width:0}}if(a.scale){return{width:"100%",height:"auto"}}if(a.breakpoints){return{width:this.get("width"),height:this.get("height")}}var d=a.sizes[this.getLogoMod(a,b,c)];if(d){return d}return{width:0,height:0}},getVkSrc:function(a,b,d){if(d===void 0){d=this.get("theme")}var e="light";if(c.CONTRAST_LOGO_THEMES.includes(d)){e="contrast"}var f="https://img.imgsmail.ru/static.promo/logo/rebranding/vk_with_stroke_"+e+".svg";if(b){f="https://img.imgsmail.ru/static.promo/logo/rebranding/vk_"+e+".svg"}if(a.en_lang){f=f.replace(".svg","_en.svg")}return f},isRebranding:function(a){return a.rebranding},isMediumRebrandingLogo:function(a,b){if(!a.rebranding||b){return false}var c=a.en_lang?161:179;return this.get("width")<c},getLogoWidth:function(a,b,c){var d=this.getLogoSize(a,b,c);return d.width},getLogoHeight:function(a,b,c){var d=this.getLogoSize(a,b,c);return d.height},getLogoTitle:function(a){return a.title||i18n("Почта Mail.ru")},getLogoTitleBrand:function(a){return a.titleBrand||i18n("Экосистема VK")},getLogoHref:function(a){return a.href},getLogoHrefBrand:function(a){return a.hrefBrand},getLogoTarget:function(a){return a.target},getLogoTargetBrand:function(a){return a.targetBrand},getLogoAlt:function(a){return a.alt||i18n("Почта Mail.ru")},getLogoAltBrand:function(a){return a.altBrand||i18n("Экосистема VK")},handleLogoLoadError:function(a){var b=a.target;this.set("logo-load-err",true);b.src=l()},handleLogoLoadSuccess:function(a){var c=a.target;if((b.default.logo.bgBig||b.default.logo.bgSmall)&&c.src!==l()){this.set("logo-load-err",false)}},getActiveLogoKey:function(a,b){if(b===void 0){b=this.getLogo()}switch(true){case b.bgAdaptive&&!a:{return k.bgSrcAdaptive}case b.bgBig&&!a:{return k.bgSrcBig}case b.bgSmall&&a:{return k.bgSrcSmall}default:{return k.src}}},getLogoSrcFromKey:function(a,b,c){if(b===void 0){b=this.get("theme")}if(c===void 0){c=this.getLogo()}var d=c[b+"_"+a];return d||c[a]},getLogoKind:function(){var a=this.getLogo(),b=a.bgBig,c=a.bgSmall,d=a.bgAdaptive;if(b||c||d){return"bg"}return"normal"},isActiveLogoAdaptive:function(a){return a===k.bgSrcAdaptive},needBackToParentFolderButton:function(){return this.get("needBackToParentFolder")&&c.BACK_TO_PARENT_AT_LOGO&&c.METATHREAD_BACK_TO_INBOX},getAdaptiveLogo:function(a){if(a===void 0){a=this.getLogo()}var b=this.get("theme");return this.getLogoSrcFromKey(k.bgSrcAdaptive,b,a)},didUnmount:function(){this.adaptiveHandler.destroy()},onResize:function(a){this.set(a)},onLogoClick:function(){var c=b.default.get("rbLogo");var d=Object.keys(c).length>0;var e=this.getLogo();var f=d?"unknown":"default";var g=e&&e.banner_id?e.banner_id:f;if(g!=="unknown"){a.default.sendImmediately("portal-menu-logo_"+g+"_click")}else{a.default.sendImmediately("portal-menu-logo_error",{rlog:"portal-menu-logo_unknown-banner-id",rlog_message:{logo:e}})}}};exports.default=d.default.Block.extend(m)});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("ui-block/portal-menu/breakpoints",["require","exports"],function(require,exports){"use strict";var a,b,c,d;Object.defineProperty(exports,"__esModule",{value:true});exports.readingBreakpoints=exports.selectionBreakpoints=exports.mainColumnBreakpoints=exports.mainColumnDefault=exports.Buttons=void 0;var e;(function(a){a["more"]="more";a["remove"]="remove";a["archive"]="archive";a["spam"]="spam";a["unsubscribe"]="unsubscribe";a["unspam"]="unspam";a["move"]="move";a["read"]="read";a["replyAll"]="reply-all";a["reply"]="reply";a["forward"]="forward"})(e=exports.Buttons||(exports.Buttons={}));exports.mainColumnDefault={order:[e.remove,e.move,e.spam,e.unsubscribe,e.unspam,e.archive,e.read,e.more,e.replyAll,e.reply,e.forward]};exports.mainColumnBreakpoints=[{minWidth:852,meta:{"no-short-reply":true}},{minWidth:772},{minWidth:704,modifiers:(a={},a[e.archive]={short:true},a[e.unsubscribe]={short:true},a)},{minWidth:656,modifiers:(b={},b[e.archive]={short:true},b[e.unsubscribe]={short:true},b[e.spam]={short:true},b[e.unspam]={short:true},b)},{minWidth:528,modifiers:(c={},c[e.remove]={short:true},c[e.archive]={short:true},c[e.unsubscribe]={short:true},c[e.spam]={short:true},c[e.unspam]={short:true},c[e.move]={short:true},c)},{minWidth:0,modifiers:(d={},d[e.remove]={short:true},d[e.archive]={short:true},d[e.unsubscribe]={short:true},d[e.spam]={short:true},d[e.unspam]={short:true},d[e.move]={short:true},d[e.replyAll]={short:true},d[e.reply]={short:true},d[e.read]={short:true},d[e.forward]={short:true},d)}];var f=156;var g=40;var h=40;var i=f+g+h;var j=44;exports.selectionBreakpoints=exports.mainColumnBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth-i})});exports.readingBreakpoints=exports.selectionBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth+j})})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/portal-menu/portal-menu",["require","exports","@mail/features","default-values","feast","feast-tpl!./portal-menu.html","helpers/allread-button-visible","helpers/debounce-frame","helpers/folder","helpers/get-selected-stats","helpers/letter","mediator/layout-manager","mediator/layout-manager/vars","resize-observer-polyfill","service/auth","service/promo","service/radars/decorator","ui-block/filters/filters","ui-block/layout/layout","ui-block/portal-menu-element/portal-menu-element","ui-block/portal-menu-logo/portal-menu-logo","ui-block/search-panel/search-panel","./breakpoints"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.radarPortalMenu=exports.blockSpec=exports.isShortButtonSelectAll=exports.isShortTextAllRead=exports.hasLetterCount=exports.getSelectedCount=exports.getSelectedLettersIdsAndSenders=exports.getBreakpointData=exports.getGlobals=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);h=__importDefault(h);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);var v=u.mainColumnBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth+48})});var w=u.selectionBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth+48})});function x(c){var d=c.model;var e=c.layoutType,f=c.selectMode;var h=c["letter-not-found"];var j=c.route.is("#read-letter #search-letter")&&!c.selectMode&&!h;var k=e==="3pane";var l=e==="2pane";var n=c.selectedStats||Object.create(null);var o=c.route.is("#search #search-letter");var p=c.route.is("#letters #read-letter")&&!!c.route.filterQuery.has();var q=c.ponyMode;var r=j&&!!c.route.params.part;var s=j?c.letter:null;var t=s&&s.id;var u=s&&s.get("messages").first();var v=i.hasLetterReplyAll(u);var w=j&&!c.folder.isSpam()||n.nospam>0;var x=j&&c.folder.isSpam()||n.spam>0;var y=a.default.has("has-super-spam")||m.default.user.is("has_super_spam");var z=j&&!!c.letterNeighbours.prev;var A=j&&!!c.letterNeighbours.next;var B=!f;var C=s&&s.get("flags.newsletter")&&b.FEATURE_UNSUBSCRIBE;var D=!g.isDeleteFromFolderDisabled(c.folder);return{store:d,letterNotFound:h,selectedStats:n,layoutType:e,readMode:j,selectMode:f,searchRoute:o,filterRoute:p,ponyMode:q,isDisableEdit:r,message:s,letterId:t,isReplyAll:v,is3Pane:k,is2Pane:l,isSpam:w,isUnspam:x,hasPrev:z,hasNext:A,hasSuperSpam:y,shouldShowSearch:B,isNewsletter:C,isRemoveVisible:D}}exports.getGlobals=x;function y(a){var b=a.isSpam,c=a.message,d=a.readMode,e=a.selectMode,f=a.selectedStats;if(!b){return false}if(c&&d){return c.is("flags.newsletter")&&c.is("flags.show_definitely_spam")&&c.is("flags.have_unsubscribe_list")}if(e){var g=f.fromTrustedMailer,h=f.all;return g===h}return false}function z(a,c,d,e){var f,g,h;var i=y(c);var j={unsubscribeInMoreDropdown:i&&b.UNSUBSCRIBE_IN_MORE_DROPDOWN,unsubscribeInsteadSpam:i&&b.UNSUBSCRIBE_INSTEAD_SPAM};var k=(f=d===null||d===void 0?void 0:d.order)!==null&&f!==void 0?f:e.order;var l=k.map(function(a){if(typeof a==="string"){return{type:a}}return a});var m=(g=d===null||d===void 0?void 0:d.modifiers)!==null&&g!==void 0?g:{};var n=(h=d.meta)!==null&&h!==void 0?h:{};var o=l.reduce(function(a,b){a[b.type]=true;return a},{});var p=A(a,c,o,n,j);var q=l.map(function(a){var b=p[a.type];var c=m[a.type];if(b||c){return Object.assign(a,b,c)}return a});return{actionsList:q,globals:c}}exports.getBreakpointData=z;var A=function(a,c,d,e,f){var g=c.selectMode,h=c.readMode,i=c.selectedStats,j=c.isSpam,k=c.isUnspam,l=c.hasSuperSpam,m=c.isDisableEdit,n=c.message,o=c.isReplyAll,p=c.isNewsletter,q=c.isRemoveVisible;var r=f.unsubscribeInsteadSpam,s=f.unsubscribeInMoreDropdown;return{archive:{if:!a.folder.isArchive()&&!b.ARCHIVE_DISABLED,disabled:m},forward:{if:h,letter:n,disabled:m},move:{"radar-id":g?"selected":"letter-header",folders:a.folders,disabled:m},remove:{if:q,disabled:m},read:{"radar-id":g?"selected":"letter-header",if:g&&i.unread>0},reply:{if:h,letter:n,short:e["no-short-reply"]?false:o,disabled:m},"reply-all":{if:h&&o,letter:n,disabled:m},spam:{if:!b.FORBID_SPAM&&j&&!r,disabled:m||g&&(a.deselectAll||i.metathread)},unsubscribe:{if:r,letter:n,disabled:m||g&&(a.deselectAll||i.metathread)},unspam:{if:k,disabled:m||g&&a.deselectAll},more:Object.assign({if:h||g},g?{read:i.unread>0,unread:i.read>0,flag:i.noflagged>0,unflag:i.flagged>0,print:i.all===1,archive:!d.archive&&i.noarchive&&!b.ARCHIVE_DISABLED,spam:!b.FORBID_SPAM&&!d.unspam&&j&&!i.metathread,spamDisabled:m||g&&(a.deselectAll||i.metathread),spamAbovePrint:!b.FORBID_SPAM&&!i.metathread&&r,unsubscribeAbovePrint:s,unspam:!d.spam&&k,superspam:l&&!i.metathread&&!a.deselectAll,forward:!i.metathread&&!a.deselectAll,"create-filter":!b.FORBID_FILTERS&&!i.metathread&&!a.deselectAll}:h&&{readletter:true,print:true,"invite-call":b.CALLS&&!b.CALLS_DISABLE_LETTER_CALL&&!(p&&b.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS),"create-event":!b.DISABLE_CREATE_EVENT&&!(p&&b.DISABLE_LETTER_CALENDAR_NEWSLETTERS),"create-filter":!b.FORBID_FILTERS,translate:!b.DISABLE_TRANSLATE,"disable-edit":m,read:n.is("flags.unread"),unread:!n.is("flags.unread"),flag:!n.is("flags.flagged"),unflag:n.is("flags.flagged"),archive:!d.archive&&!n.getFolder().isArchive()&&!b.ARCHIVE_DISABLED,spam:!b.FORBID_SPAM&&!d.spam&&j,spamAbovePrint:!b.FORBID_SPAM&&r,unsubscribeAbovePrint:s,unspam:!d.unspam&&k,superspam:l})}};var B=function(a,b){var c=a.readMode,d=a.message,e=a.selectMode,f=a.searchRoute;var g=b.selected;if(c&&d){return{ids:[d.get("expand")||(""+d.id).split(":")[1]],senders:[d.get("correspondents.from.0.email")]}}if(!e){return{}}return{ids:g.map(function(a){if(f){return""+a.id}return a.get("expand")||(""+a.id).split(":")[1]}),senders:g.map(function(a){return a.get("correspondents.from.0.email")})}};exports.getSelectedLettersIdsAndSenders=B;var C=function(a,b){var c=a.selected,d=a.selectFolder,e=a.folder;var f=b.searchRoute;return f?c.length:h.default(c,d?e:undefined).all};exports.getSelectedCount=C;var D=function(a){var b=a.filter,c=a.folder;if(b.all){return c.is("messages_total")}return(!b.flagged||c.is("messages_flagged"))&&(!b.unread||c.is("messages_unread"))&&(!b.with_attachments||c.is("messages_with_attachments"))};exports.hasLetterCount=D;var E=function(a){var c=a.is2Pane;if(j.layoutManager.isLessThen("s")){return true}if(b.NEW_TOOLBAR&&j.layoutManager.getMainColumn()<180&&c){return true}return j.layoutManager.isLessThen("l")&&j.layoutManager["left-column"]>75};exports.isShortTextAllRead=E;var F=function(a,c,d){var e=a.selectedCount,f=a.sidebarColumn,g=a.newToolbar;var h=c.sortingType,i=c.filter,l=c.ponyMode;var m=d.is2Pane;if(e){return false}if(m){return b.PORTAL_MENU_MORE_FOLDER_ACTIONS?j.layoutManager.getMainColumn()+j.layoutManager.columnRight<250:j.layoutManager.isLessThen("m")}f!==null&&f!==void 0?f:f=j.layoutManager.getSidebarColumn();if(f<=k.columnSidebarM+(b.PORTAL_MENU_MORE_FOLDER_ACTIONS?5:0)){return true}if(b.PORTAL_MENU_MORE_FOLDER_ACTIONS&&f<108&&l){return true}if((!i.all||h&&h!=="D"||g)&&f<=k.columnSidebarXl){return true}var n=j.layoutManager.getLeftColumn()<=b.SHORTCUT_LEFT_COLUMN_LIMIT;if(n&&f<=k.columnSidebarXl){return true}return false};exports.isShortButtonSelectAll=F;exports.blockSpec={name:"portal-menu",template:d.default,blocks:{layout:q.default,"portal-menu-element":r.default,"portal-menu-logo":s.default,"search-panel":t.default,filters:p.default},events:{},defaults:{selected:[],readAllInProgress:false},attrChanged:{selected:function(){if(!this.isMounted()){return}this.set("selectedStats",this.getSelectedStats())},selectMode:function(){n.default.update()}},constructor:function(){c.default.Block.prototype.constructor.apply(this,arguments);this.setDefaultBreakpoint();this.handleResize=this.handleResize.bind(this);this.frameDebouncer=new f.FrameDebouncer(this.handleResize);this.createResizeObserver()},useReactSearchPanel:function(){return b.SEARCH_PANEL_REACT},usePortalSearchPanel:function(){return b.SEARCH_PANEL_PORTAL},setDefaultBreakpoint:function(){this._currentBreakpoint=v[v.length-1]},didMount:function(){this.updateListeners()},isSelectAllVisible:function(a){return e.isAllreadButtonVisible(a,this.get("model"))},isAllReadVisible:function(){return this.isSelectAllVisible(this.get("filter"))&&!this.get("read-all-in-progress")},isRemoveAllVisible:function(){if(!b.PORTAL_MENU_CLEAR_METATHREAD){return false}var a=this.get("folder");var c=this.get("filter");var d=this.get("sortingType");if(!c.all||d&&d!=="D"){return false}return!this.get("selectMode")&&a.isMetathread()&&a.isClearable()},needMoreLettersActions:function(){var a=this.get("layoutType")==="3pane";var c=this.get("selectMode");return b.PORTAL_MENU_MORE_FOLDER_ACTIONS&&a&&!c&&(this.isAllReadVisible()||this.isRemoveAllVisible())},needBackToParentFolder:function(){var a=this.get("folder");var b=this.get("folders");var c=b===null||b===void 0?void 0:b.find(function(b){return b.id===(a===null||a===void 0?void 0:a.get("parent"))});return!!(this.get("showBackToParentFolder")&&c)},hasLetterCount:function(){return exports.hasLetterCount(this.getAttrs())},getPaddingLeft:function(a,b,c){if(a=="2pane"){if(c&&b){return 32}return 28}if(c){if(b){return 20}return 16}return 24},getPaddingRight:function(a,b,c){if(!b){return 20}if(a.type=="3pane"){if(c){return 8}return 14}return 0},getSelectedCount:function(){return exports.getSelectedCount(this.getAttrs(),{searchRoute:this.getAttrs().route.is("#search #search-letter")})},getSelectedStats:function(){return h.default(this.get("selected"))},isShortButtonSelectAll:function(a,b,c,d){return exports.isShortButtonSelectAll({selectedCount:b},{sortingType:d,filter:c},{is2Pane:a.type==="2pane"})},isRemoveAllButtonShort:function(){var a=this.get("main-column");var b=this.get("right-column");return a+b<=275},getAttrs:function(){return this.attrs},isShortTextAllRead:function(){return exports.isShortTextAllRead(x(this.getAttrs()))},getCurrentBreakpoint:function(){var a=this.getAttrs();var b=x(a);var c=u.mainColumnDefault;var d=this._currentBreakpoint;return z(a,b,d,c)},getSelectedLettersIdsAndSenders:exports.getSelectedLettersIdsAndSenders,didUpdate:function(){this.updateListeners()},createResizeObserver:function(){var a=this;this.resizeObserver=new l.default(function(b){a.frameDebouncer.requestDebouncedFrame(b)})},updateListeners:function(){this.resizeObserver.disconnect();if(this.refs["actions-list"]){this.resizeObserver.observe(this.refs["actions-list"])}},didUnmount:function(){this.resizeObserver.disconnect()},handleResize:function(a){if(!this.refs["actions-list"]){return}var b=a[0].contentRect.width;var c=this.is("selectMode")?w:v;var d=[-1,c.length-1];while(d[1]-d[0]>1){var e=(d[1]+d[0]-(d[1]+d[0])%2)/2;d[+(c[e].minWidth<=b)]=e}var f=c[d[1]];if(this._currentBreakpoint===f){return}this._currentBreakpoint=f;if(this.isMounted()){this.render()}}};exports.radarPortalMenu=o.default({id:function(a){return a.is("selectMode")?"head-select":"head"}});exports.default=c.default.Block.extend(exports.radarPortalMenu(exports.blockSpec))});define("feast-tpl!app/feast-tpl!ui-block/progress/progress.html",["feast"],function(a){return a.smartParse('<span>\n\t<bem:mod name="hidden" test="!attrs.visible"/>\n\t<bem:mod name="inanimate" test="attrs.inanimate"/>\n\n\t<span\n\t\tbem:elem="value"\n\t\tstyle="width: {_this.getProgressWidth_()};"\n\t/>\n\n</span>\n',"app/feast-tpl!ui-block/progress/progress.html")});define("feast-tpl!ui-block/progress/progress.html",["feast-tpl!app/feast-tpl!ui-block/progress/progress.html"],function(a){return a});define("ui-block/progress/progress",["exports","feast","feast-tpl!./progress.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=0;var g=100;var h=0;exports.default=c.default.Block.extend({name:"progress",template:d.default,immutable:true,defaults:{visible:true},getProgressWidth_:function a(){var b=parseInt(this.get("min"),10)||f;var c=parseInt(this.get("max"),10)||g;var d=parseInt(this.get("value"),10)||h;var e=Math.max(c-b,0);return Math.round(d/e*100)+"%"}})});define("feast-tpl!app/feast-tpl!ui-block/renovator/renovator.html",["feast"],function(a){return a.smartParse('<div ref="container">\n\t<bem:mod name="visible" test="attrs.isLettersRoute"/>\n\t<bem:mod name="{attrs.type}"/>\n</div>\n',"app/feast-tpl!ui-block/renovator/renovator.html")});define("feast-tpl!ui-block/renovator/renovator.html",["feast-tpl!app/feast-tpl!ui-block/renovator/renovator.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/renovator/renovator",["require","exports","feast","feast-tpl!./renovator.html","service/promo"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"renovator",template:b.default,defaults:{isLettersRoute:false,type:"2pane"},attrChanged:{isLettersRoute:function(a){if(a){c.default.updateRenovator()}else{c.default.hideRenovator()}}}})});define("feast-tpl!app/feast-tpl!ui-block/shortcut/shortcut.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:add-class name="js-shortcut" />\n</div>\n',"app/feast-tpl!ui-block/shortcut/shortcut.html")});define("feast-tpl!ui-block/shortcut/shortcut.html",["feast-tpl!app/feast-tpl!ui-block/shortcut/shortcut.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/shortcut/shortcut",["require","exports","feast","feast-tpl!./shortcut.html","service/compose","service/layer","service/radars/index","service/shortcut"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g=document.createElement("div");g.style.cssText="\n    position: absolute;\n    display : none;\n    width: 1px;\n    height: 1px;\n";exports.default=a.default.Block.extend({name:"shortcut",template:b.default,defaults:{shortcut:"shift+?|shift+&"},events:{click:"onBlockClick"},onBlockClick:function(){var a=this;if(this.layer){this.layer.broadcast("dimmer:click")}d.default.open("shortcut",{},{dimmer:true}).then(function(b){a.layer=b;e.default({chain:["shortcut"],intervals:[["help_show","1"]]})})},updateTitleByElement:function(a){if(!a.getAttribute("data-shortcut-title")){var b=a.getAttribute("title")||a.getAttribute("data-title");if(b){var c=f.default.getShortcutTitle(a.getAttribute("data-shortcut"));if(c){a.setAttribute("data-title-shortcut",""+c)}}a.setAttribute("data-shortcut-title",1)}},updateTitles:function(){var b=this.shortcut.getShortcutItems();for(var c=0,d=b;c<d.length;c++){var e=d[c];var f=a.default.Block.get(e);if(!f){this.updateTitleByElement(e)}}},didMount:function(){var b=this;this.shortcut=new f.default;this.shortcut._canDoIt=function(a){var b=a.offsetParent;while(b&&!b.className.includes("dropdown ")){b=b.offsetParent}var e=getComputedStyle(a).visibility==="visible"||b&&b.className.includes("dropdown ")&&getComputedStyle(b).visibility==="visible";if(e){var f=d.default.getInstance();var g=(c.default.getView||c.default.default.getView)();var h=f&&f.get("active")&&!f.el.contains(a);var i=g&&g.get("active")&&!g.el.contains(a);if(h||i){e=false}}return e};this.shortcut._doAction=function(c,d){var f=b.shortcut._canDoIt(c);if(f){var h=a.default.Block.get(c);if(h&&d.uiname){h.broadcast(d.uiname.replace("-",":"))}else{var i=void 0;var j=void 0;if(typeof Event==="function"){i=new Event("mousedown");j=new Event("mouseup")}else{i=document.createEvent("MouseEvents");j=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,undefined,null);j.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,undefined,null)}if(d.uiname){g.setAttribute("data-name",d.uiname);c.parentElement.appendChild(g);g.dispatchEvent(i);g.dispatchEvent(j);g.click();setTimeout(function(){g.setAttribute("data-name","")},0)}else if(c.nodeName=="INPUT"&&(c.type=="text"||c.type=="password")||c.nodeName=="TEXTAREA"){c.focus()}else{c.dispatchEvent(i);c.dispatchEvent(j);c.click()}return true}e.default({chain:["shortcut"],intervals:[[String(d.shortcut),"1"]]})}return f};this.updateTitles()}})});define("feast-tpl!app/feast-tpl!ui-block/sidebar-folders/sidebar-folders.html",["feast"],function(a){return a.smartParse('<div\n\ta11y:tooltip-direction="right"\n>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\t<fn:var name="widget" value="{attrs[\'widget-enabled\']}"/>\n\t<fn:var name="isSearch" value="{attrs[\'is-search\']}"/>\n\t<fn:var name="widgetsMinHeight" value="{_this.getWidgetsMinHeight()}"/>\n\n\t<bem:mod name="css-vars-fallback" test="attrs[\'css-vars-fallback\']"/>\n\n\t\x3c!-- Сайдбар --\x3e\n\t<b:sidebar\n\t\tid="sidebar"\n\t\tponymode="{ponyMode}"\n\t\tsettings\n\t\tshort="{short}"\n\t\twidget="{widget}"\n\t\tref="sidebar"\n\t\tshort-scroll-style="{isSearch ? \'thin\' : \'minimal\'}"\n\t\tisSearch="{isSearch}"\n\t\tremit:resize-full="sidebar-resize-full"\n\t\tremit:resize-short="sidebar-resize-short"\n\t\tfooter-min-height="{widgetsMinHeight.full}"\n\t\tshort-footer-min-height="{widgetsMinHeight.short}"\n\t>\n\t\t<fn:match name="sidebar-top-menu" args="isShort, isOpen">\n\t\t\t\x3c!-- Кнопка звонков основная, остальное второстепенное, так что без неё можно и не показывать дропдаун --\x3e\n\t\t\t<fn:var name="withDropdown" value="{attrs[\'invite-calls\'] && !isShort}"/>\n\t\t\t<fn:var name="webview" value="{attrs.webview}"/>\n\n\t\t\t\x3c!-- Шапка сайдбара --\x3e\n\t\t\t<div bem:elem="header" ref="sideBarHeader">\n\t\t\t\t\x3c!-- Кнопка Написать письмо (есть всегда) --\x3e\n\t\t\t\t<div bem:elem="compose-btn-box">\n\t\t\t\t\t<bem:mod name="with-dropdown" test="withDropdown"/>\n\t\t\t\t\t<b:compose-button\n\t\t\t\t\t\tremit:click="compose:new"\n\t\t\t\t\t\tremit:mouseenter="compose:preload"\n\t\t\t\t\t\tremit:mousedown="compose:preload"\n\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\tqa:id="compose"\n\n\t\t\t\t\t\tbase="{!isShort}"\n\t\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\t\tshortcut="n"\n\t\t\t\t\t\ttitle="{i18n(\'Написать письмо\')}"\n\t\t\t\t\t\twhite="{!isOpen}"\n\t\t\t\t\t\twith-dropdown="{withDropdown}"\n\t\t\t\t\t\twebview="{webview}"\n\t\t\t\t\t/>\n\t\t\t\t\t<b:compose-dropdown\n\t\t\t\t\t\tfn:if="withDropdown"\n\t\t\t\t\t\tqa:id="compose-dropdown"\n\t\t\t\t\t\tuse:mediator="compose-manager calendar-manager calls-manager"\n\t\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Бургер/Скрыть --\x3e\n\t\t\t\t<a\n\t\t\t\t\tfn:if="isShort || isOpen"\n\t\t\t\t\tbem:elem="menu-item"\n\t\t\t\t\tremit:click="sidebar:toggle"\n\t\t\t\t\tqa:id="burger-button"\n\t\t\t\t\ttitle="{!isOpen && !isSearch ? i18n(\'Все папки\') : i18n(\'Все фильтры\')}"\n\t\t\t\t>\n\t\t\t\t\t<div bem:elem="unread-badge">\n\t\t\t\t\t\t<fn:var name="unreadLimit" value="99"/>\n\t\t\t\t\t\t<fn:var name="unread" value="{_this.getTotalUnread()}"/>\n\t\t\t\t\t\t<b:badge\n\t\t\t\t\t\t\ttext="{unread > unreadLimit ? unreadLimit + \'+\' : unread}"\n\t\t\t\t\t\t\tsize="{ponyMode ? \'xs\' : \'s\'}"\n\t\t\t\t\t\t\tstrong\n\t\t\t\t\t\t\ttransparent="{short}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<span bem:elem="menu-ico">\n\t\t\t\t\t\t<b:ico name="{attrs.ponymode ? \'navigation:menu_s\' : \'navigation:menu\'}" size="m"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="menu-text">{i18n(\'Скрыть\')}</span>\n\t\t\t\t</a>\n\n\t\t\t\t<fn:if test="isSearch">\n\t\t\t\t\t<div bem:elem="filter-inbox-container">\n\t\t\t\t\t\t<bem:mod name="ponymode" test="ponyMode"/>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tbem:elem="menu-item"\n\t\t\t\t\t\t\thref="{_this.getInboxUrl()}"\n\t\t\t\t\t\t\tremit:click="search:inbox:click"\n\t\t\t\t\t\t\tqa:id="search-sidebar-inbox"\n\t\t\t\t\t\t\ttitle="{isShort && i18n(\'Перейти во входящие\')}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div bem:elem="filter-inbox-item">\n\t\t\t\t\t\t\t\t<bem:mod name="ponymode" test="!isShort && ponyMode"/>\n\t\t\t\t\t\t\t\t<span bem:elem="menu-ico">\n\t\t\t\t\t\t\t\t\t<div bem:elem="filter-icon">\n\t\t\t\t\t\t\t\t\t\t<bem:mod name="short" test="isShort"/>\n\t\t\t\t\t\t\t\t\t\t<bem:mod name="full" test="!isShort"/>\n\t\t\t\t\t\t\t\t\t\t<b:ico class="filter-inbox-icon" name="{attrs.ponymode ? \'categories:mail_s\' : \'categories:mail\'}" size="m"/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div fn:if="!isShort || isOpen" bem:elem="filter-inbox">\n\t\t\t\t\t\t\t\t\t<bem:mod name="ponymode" test="ponyMode"/>\n\t\t\t\t\t\t\t\t\t<bem:mod name="normal" test="!ponyMode"/>\n\t\t\t\t\t\t\t\t\t<fn:add-class name="r-text"/>\n\t\t\t\t\t\t\t\t\t{i18n(\'Перейти во входящие\')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<fn:if test="!isShort || isOpen">\n\t\t\t\t\t\t<div bem:elem="filter-txt" qa:id="search-sidebar-filters">\n\t\t\t\t\t\t\t<fn:add-class name="r-text"/>\n\t\t\t\t\t\t\t{i18n(\'Фильтры поиска\')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr bem:elem="hr"/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-content" args="isShort, isOpen">\n\t\t\t\x3c!-- Контент: список папок на шорткатах--\x3e\n\t\t\t<div ref="sideBarContent" id="sideBarContent">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="isSearch">\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tref="reactAsync"\n\t\t\t\t\t\t\tclass-name="sidebar__layer"\n\t\t\t\t\t\t\tuse:mediator="letters-actions user-info letters-loader pony-mode"\n\t\t\t\t\t\t\tcomponent="SearchSidebar"\n\t\t\t\t\t\t\tonSearchPanelFocus="{_this.handleSearchPanelFocus}"\n\t\t\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\t\t\t\tnanoMode="{ponyMode}"\n\t\t\t\t\t\t\tsearch="{attrs.store.search}"\n\t\t\t\t\t\t\tshortcut="{isShort}"\n\t\t\t\t\t\t\tcategories="{attrs.categories}"/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:nav-folders\n\t\t\t\t\t\t\tref="navFolders"\n\t\t\t\t\t\t\tuse:mediator="letters-actions folders-actions user-info letters-loader pony-mode folders-navigation"\n\t\t\t\t\t\t\tremit:folderclick="folder:click"\n\n\t\t\t\t\t\t\tactive="{attrs[\'folder-active\']}"\n\t\t\t\t\t\t\thandle-drop\n\t\t\t\t\t\t\tmodels="{attrs.models}"\n\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\tshort="{isShort}"\n\t\t\t\t\t\t\tsidebar\n\t\t\t\t\t\t\twith-clear="{!isShort}"\n\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-bottom-menu" args="isShort, isOpen">\n\t\t\t<b:sidebar-widgets\n\t\t\t\tuse:mediator="sidebar-menu"\n\t\t\t\tref="sideBarFooter"\n\t\t\t\tbillsCount="{attrs.billsCount}"\n\t\t\t\tshort="{isShort}"\n\t\t\t\topen="{isOpen}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-bottom-widget" args="isShort">\n\t\t\t\x3c!-- Виджет тем --\x3e\n\t\t\t<b:themes-widget\n\t\t\t\tref="themesWidget"\n\t\t\t\tuse:mediator="themes-manager"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:sidebar>\n</div>\n',"app/feast-tpl!ui-block/sidebar-folders/sidebar-folders.html")});define("feast-tpl!ui-block/sidebar-folders/sidebar-folders.html",["feast-tpl!app/feast-tpl!ui-block/sidebar-folders/sidebar-folders.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/compose-button/compose-button.html",["feast"],function(a){return a.smartParse('<a\n\ttitle="{attrs.title || attrs.text}"\n\thref="/compose/"\n\tdata-title-shortcut="{attrs[\'title-shortcut\'] || \'\'}"\n\tqa:id="button:{attrs.ico || attrs.title || attrs.text}"\n>\n\t<bem:mod name="white" test="attrs.white"/>\n\t<bem:mod name="base" test="attrs.base"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="short" test="attrs.short"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="with-dropdown" test="attrs[\'with-dropdown\']"/>\n\t<bem:mod name="webview" test="attrs.webview"/>\n\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\n\t<span\n\t\tbem:elem="wrapper"\n\t\tref="wrapper"\n\t>\n\t\t<fn:attr\n\t\t\tname="tabindex"\n\t\t\tvalue="{attrs.disabled ? -1 : attrs[\'tab-index\']}"\n\t\t\ttest="attrs[\'tab-index\'] !== void 0"\n\t\t/>\n\n\t\t<span bem:elem="ico" fn:if="attrs.short">\n\t\t\t<b:ico name="compose"/>\n\t\t</span>\n\n\t\t<span ref="text" bem:elem="txt" fn:if="!attrs.short">{i18n(\'Написать письмо\')}</span>\n\t</span>\n</a>\n',"app/feast-tpl!ui-block/compose-button/compose-button.html")});define("feast-tpl!ui-block/compose-button/compose-button.html",["feast-tpl!app/feast-tpl!ui-block/compose-button/compose-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-button/compose-button",["require","exports","feast","feast-tpl!./compose-button.html","helpers/get-adaptive","service/radars/decorator","ui-block/ico/ico"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);var f=150;exports.default=a.default.Block.extend(d.default({events:[{name:"click-radar",rename:"click"}]})({name:"compose-button",template:b.default,defaults:{},blocks:{ico:e.default},events:{"keydown:enter":"onKeydownEnter"},didMount:function(){this.onResize=this.onResize.bind(this);this.adaptiveHandler=new c.GetAdaptive({pureBreakpoints:true,breakpoints:[{conditions:function(a){return a.width<f},props:{short:true}},{props:{short:false}}],onResize:this.onResize,element:this.el})},didUnmount:function(){this.adaptiveHandler.destroy()},onResize:function(a){this.set(a)},onKeydownEnter:function(){var a=$(this.el);a.click()},focus:function(){this.refs.wrapper.focus()}}))});define("feast-tpl!app/feast-tpl!ui-block/compose-dropdown/compose-dropdown.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t<b:dropdown\n\t\tqa:id="compose-dropdown"\n\t\tremit:dropdown-change-state="dropdown:toggle"\n\t\tradar-id="cdd"\n\t\tico="navigation:drop_down"\n\t\tclean\n\t\trotate-ico\n\t\talways-bright\n\t\tponymode="{attrs.compact}"\n\t\ttouch="{attrs.touch}"\n\t>\n\t\t<fn:match name="items">\n\t\t\t<b:list>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="!attrs[\'disabled-tomyself\']"\n\t\t\t\t\tremit:click="compose:tomyself"\n\t\t\t\t\tradar-id="tomyself"\n\t\t\t\t\tqa:id="tomyself"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="categories:self_mail"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#00bd93"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Написать себе\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="!attrs[\'disabled-call\']"\n\t\t\t\t\tremit:click="calls:invitenew"\n\t\t\t\t\tradar-id="call"\n\t\t\t\t\tqa:id="call"\n\t\t\t\t\ttitle="{!attrs[\'disable-calls-tip\'] && i18n(\'Участники встречи получат ссылку для видеозвонка и присоединятся, когда перейдут по ней\')}"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="categories:camera"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#38e0a1"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Предложить звонок\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="!attrs[\'disabled-calendar\']"\n\t\t\t\t\tremit:click="calendar:createnew"\n\t\t\t\t\tevent:details="{createContent:\'web_email_select\'}"\n\t\t\t\t\tradar-id="calendar"\n\t\t\t\t\tqa:id="calendar"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="calendar-month"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#005ff9"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать событие\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/compose-dropdown/compose-dropdown.html")});define("feast-tpl!ui-block/compose-dropdown/compose-dropdown.html",["feast-tpl!app/feast-tpl!ui-block/compose-dropdown/compose-dropdown.html"],function(a){return a});define("ui-block/compose-dropdown/compose-dropdown",["exports","default-values","feast","feast-tpl!./compose-dropdown.html","service/radars/decorator","ui-block/dropdown/dropdown"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(b);var g=j(c);var h=j(d);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:[{name:"click-radar",rename:"click"},"mount"]})({name:"compose-dropdown",template:g.default,defaults:{expanded:false,"radar-id":"cdd","disabled-tomyself":a.CALLS_DISABLE_COMPOSE_DROPDOWN_TOMYSELF,"disabled-call":a.CALLS_DISABLE_COMPOSE_DROPDOWN_CALL,"disabled-calendar":a.CALLS_DISABLE_COMPOSE_DROPDOWN_CALENDAR,"disable-calls-tip":a.DISABLE_CALLS_TIP},blocks:{dropdown:i.default},events:{"dropdown:toggle":"onDropdownToggle"},onDropdownToggle:function a(b){this.set("expanded",b.details.state)}}))});define("feast-tpl!app/feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="isOpen" value="{attrs.open}" />\n\n\t<fn:var name="showTitle" value="{attrs[\'vertical-list\'] && (!short || isOpen)}" />\n\t<fn:var name="position" value="{showTitle || short && !isOpen  ? \'vertical\' : \'horizontal\'}" />\n\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}" />\n\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']" />\n\t<bem:mod name="short" test="attrs[\'short\']" />\n\t<bem:mod name="full" test="!attrs[\'short\']" />\n\t<bem:mod name="wide-settings-button" test="attrs[\'menu-widget-list\'].length === 0 && ponyMode" />\n\n\t<fn:var name="isPayWidgetInDropdown" value="_this.isPayWidgetInDropdown()"/>\n\n\t\x3c!-- Футер сайдбара: виджеты --\x3e\n\t<div bem:elem="footer"\n\t\t\tqa:id="sidebar-footer-{position}"\n\t\t\tpromo:id="sidebar-widgets-position-{position}"\n\t\t\tdata-position="{position}"\n\t\t\tref="sidebarFooter"\n\t\t\ta11y:tooltip-direction="{position === \'horizontal\' ? \'top\' : \'right\'}"\n\t>\n\t\t<bem:mod name="vertical" test="attrs[\'vertical-list\']"/>\n\t\t<bem:mod name="centered" test="attrs[\'short\']"/>\n\n\t\t<fn:for data="attrs[\'menu-widget-list\']" as="menuItem" key="menuItemKey">\n\t\t\t<div bem:elem="footer__item" key="{menuItemKey}" promo:id="sidebar-widgets-item{showTitle ? \'-full\' : \'\'}">\n\t\t\t\t<fn:var name="menuItemType" value="{(menuItem.type === \'bonus\' && attrs[\'is-pdd-user\']) ? \'club\' : menuItem.type}" />\n\t\t\t\t<fn:var name="isPayBadgeActive" value="{attrs[\'is-pay-widget-helper-active\']}" />\n\t\t\t\t<fn:var name="isPayWidget" value="{menuItem.type === \'pay\'}" />\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="menuItem.type === \'contacts\'">\n\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\tuse:mediator="addressbook-manager"\n\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\tshortcut="g,c"\n\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\tshowTitle="{showTitle}"\n\t\t\t\t\t\t\t\tqa:id="footer-widget"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\tshowTitle="{showTitle}"\n\t\t\t\t\t\t\t\tnotification-badge="{isPayWidget && isPayBadgeActive && \'sidebar_pay_notif_show\'}"\n\t\t\t\t\t\t\t\tqa:id="footer-widget"\n\t\t\t\t\t\t\t\tbillsCount="{attrs.billsCount}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\t\t</fn:for>\n\t\t<fn:if test="attrs[\'menu-dropdown-list\'].length > 0">\n\t\t\t<div\n\t\t\t\t\tbem:elem="footer__item"\n\t\t\t\t\tpromo:id="{isPayWidgetInDropdown && \'menu-item_pay\'}"\n\t\t\t>\n\t\t\t\t<fn:var\n\t\t\t\t\t\tname="dropdownNotificationBadge"\n\t\t\t\t\t\tvalue="{isPayWidgetInDropdown && attrs[\'is-pay-widget-helper-active\'] && \'sidebar_pay_notif_show_more\'}"\n\t\t\t\t/>\n\t\t\t\t<b:dropdown\n\t\t\t\t\t\tqa:id="dropdown-menu"\n\t\t\t\t\t\tico="more-hor"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tradar-id="dropdown_menu"\n\t\t\t\t\t\ttype="dropdown_menu"\n\t\t\t\t\t\tremit:ctrl-click="menu-item:click"\n\t\t\t\t\t\tauto-close="{false}"\n\t\t\t\t\t\tdisable-expand-center\n\t\t\t\t\t\tdisable-expand-bottom\n\t\t\t\t\t\tscroll-style="minimal"\n\t\t\t\t\t\tnotification-badge="{dropdownNotificationBadge}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t<fn:for data="attrs[\'menu-dropdown-list\']" as="menuItem" key="menuItemKey">\n\t\t\t\t\t\t\t\t<b:list-item key="{menuItemKey}" qa:id="menu-dropdown-item" paddingless a11y:tooltip-direction="right">\n\t\t\t\t\t\t\t\t\t<fn:var name="menuItemType" value="{(menuItem.type === \'bonus\' && attrs[\'is-pdd-user\']) ? \'club\' : menuItem.type}" />\n\t\t\t\t\t\t\t\t\t<fn:var name="isPayBadgeActive" value="{attrs[\'is-pay-widget-helper-active\'] && menuItem.type === \'pay\'}" />\n\n\t\t\t\t\t\t\t\t\t<bem:mod name="pony-mode-dropdown" test="ponyMode"/>\n\t\t\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t\t\t<fn:when test="menuItemType === \'contacts\'">\n\t\t\t\t\t\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="addressbook-manager"\n\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut="g,c"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdropDownMode="{true}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdropDownMode="{true}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tisList="{attrs[\'vertical-list\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tnotification-badge="{isPayBadgeActive && \'sidebar_pay_notif_show_dropd\'}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tbillsCount="{attrs.billsCount}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t</fn:for>\n\t\t\t\t\t\t</b:list>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:dropdown>\n\t\t\t</div>\n\t\t</fn:if>\n\t\t<div bem:elem="footer__item" ref="settingsMenu" promo:id="menu-item_settings">\n\t\t\t<b:settings\n\t\t\t\t\tfont-size-pony="{ponyMode}"\n\t\t\t\t\tshowTitle="{_this.useNewToolbar() ? !short || isOpen : showTitle}"\n\t\t\t\t\tremit:click="menu-settings:click"\n\t\t\t\t\tuse:mediator="layout-manager themes-manager settings-manager pony-mode advert-manager todo-manager"\n\t\t\t\t\tradar-id="st"\n\t\t\t/>\n\t\t</div>\n\t\t<fn:if test="attrs[\'show-reload-button\']">\n\t\t\t<div bem:elem="footer__item">\n\t\t\t\t<b:button2\n\t\t\t\t\tqa:id="reload-button"\n\t\t\t\t\ttitle="{i18n(\'Обновить страницу\')}"\n\t\t\t\t\ttext="{i18n(\'Обновить\')}"\n\t\t\t\t\tshort="{!showTitle}"\n\t\t\t\t\tshortcut="ctrl+r|command+r"\n\t\t\t\t\tpure\n\t\t\t\t\tico="actions:postpone_alt"\n\t\t\t\t\tremit:click="reload:click"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html")});define("feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html",["feast-tpl!app/feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html"],function(a){return a});define("ui-block/sidebar-widgets/sidebar-widgets.constants",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WIDGETS_BLOCK_MIN_HEIGHT=exports.WIDGET_SIZES_NORMAL=exports.WIDGET_SIZES_PONY=exports.SideBarMenuEvents=void 0;exports.SideBarMenuEvents={deactivateNotifyBadge:"sidebarmenu:deactivatenotifybadge"};var a=16;var b=8;var c=a+b;exports.WIDGET_SIZES_PONY={width:28,height:28};exports.WIDGET_SIZES_NORMAL={width:40,height:40};exports.WIDGETS_BLOCK_MIN_HEIGHT={normal:{short:exports.WIDGET_SIZES_NORMAL.height*2+c,full:exports.WIDGET_SIZES_NORMAL.height+c},pony:{short:exports.WIDGET_SIZES_PONY.height*2+c,full:exports.WIDGET_SIZES_PONY.height+c}}});define("feast-tpl!app/feast-tpl!ui-block/widget/widget.html",["feast"],function(a){return a.smartParse('<span qa:state="{attrs[\'pony-mode\'] && \'pony-mode\'}"\n\t  xmlns:fn="http://www.w3.org/1999/html">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="title" value="{_this.getTitleByType(attrs.type)}" />\n\t<fn:var name="dataTitleShortcut" value="{attrs[\'title-shortcut\']}" fn:if="!attrs.dropDownMode && attrs[\'title-shortcut\']"/>\n\t<fn:var name="showTitle" value="{attrs.dropDownMode || attrs.showTitle}" />\n\t<fn:var name="hasPayBadge" value="{attrs.billsCount && attrs.billsCount.total && showTitle && attrs.type === \'pay\'}" />\n\t<fn:var name="tooltipTitle" value="{_this.getTooltipTitle(attrs.type, showTitle)}" />\n\t<fn:var name="widgetIco" value="{_this.getIcoByType(attrs.type)}" />\n\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="dropdown" test="attrs.dropDownMode"/>\n\t<bem:mod name="list" test="attrs.showTitle"/>\n\n\t<fn:match name="block" args="type">\n\t\t<a bem:elem="link" target="{_this.getTargetByType(type)}" rel="noopener"\n\t\t   remit:click="click-on-link" data-qa-id="{_this.getQaIdByType(type)}"\n\t\t   promo:id="{_this.getPromoIdByType(type)}">\n\t\t\t<bem:mod name="dropdown" test="attrs.dropDownMode"/>\n\t\t\t<fn:attr name="href" value="{_this.getLinkByType(type)}"/>\n\n\t\t\t<fn:attr name="data-shortcut" value="{_this.getShortcutByType(type)}" test="_this.getShortcutByType(type)" />\n\t\t\t<fn:add-class name="js-shortcut" test="_this.getShortcutByType(type)" />\n\n\t\t\t\x3c!-- TODO: переписать два bem:elem="ico" в один --\x3e\n\t\t\t\x3c!-- "Красный прыщик" на иконке виджета --\x3e\n\t\t\t<b:notification-badge\n\t\t\t\tfn:if="attrs[\'notification-badge\']"\n\t\t\t\tshow="{true}"\n\t\t\t\tponymode="{attrs[\'pony-mode\']}"\n\t\t\t\ttop="2"\n\t\t\t\tright="3"\n\t\t\t\tradar-id="{attrs[\'notification-badge\']}"\n\t\t\t>\n\t\t\t\t<fn:match name="content" bem:block="widget">\n\t\t\t\t\t<span bem:elem="ico" qa:id="widget-icon-{attrs.type}">\n\t\t\t\t\t\t<bem:mod name="{type}{_this.getImageVariantByType(type)}" test="!widgetIco"/>\n\t\t\t\t\t\t<b:ico fn:if="widgetIco" name="{widgetIco}"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:match>\n\t\t\t</b:notification-badge>\n\n\t\t\t<span bem:elem="ico" fn:if="!attrs[\'notification-badge\']" qa:id="widget-icon-{attrs.type}">\n\t\t\t\t<bem:mod name="{type}{_this.getImageVariantByType(type)}" test="!widgetIco"/>\n\t\t\t\t<b:ico fn:if="widgetIco" name="{widgetIco}"/>\n\t\t\t</span>\n\n\t\t\t<fn:if test="showTitle">\n\t\t\t\t<span qa:id="widget-title-{attrs.type}" class="widget__title">{title}</span>\n\t\t\t</fn:if>\n\t\t\t<b:badge\n\t\t\t\tfn:if="hasPayBadge"\n\t\t\t\ttext="{_this.getTotalBillsCount()}"\n\t\t\t\tsize="{attrs[\'nav-short\'] ? attrs.ponymode ? \'xs\' : \'s\' : \'l\'}"\n\t\t\t\ttransparent\n\t\t\t\tqa:id="widget-badge"\n\t\t\t/>\n\t\t</a>\n\t</fn:match>\n\t<fn:attr name="title" value="{tooltipTitle}" fn:if="tooltipTitle" />\n\t<fn:choose>\n\t\t<fn:when test="attrs.type === \'calendar\'">\n\t\t\t<b:widget-calendar\n\t\t\t\ttitle="{showTitle ? title : \'\'}"\n\t\t\t\tpony-mode="{attrs[\'pony-mode\']}"\n\t\t\t\tdropdown-mode="{attrs.dropDownMode}"\n\t\t\t\tvariant="{_this.getImageVariantByType(attrs.type)}"\n\t\t\t\tremit:click="click-on-link"\n\t\t\t/>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<fn:apply-match name="block" args="attrs.type"/>\n\n\t\t\t<fn:attr name="data-title-shortcut" value="{dataTitleShortcut}" test="dataTitleShortcut"/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</span>\n',"app/feast-tpl!ui-block/widget/widget.html")});define("feast-tpl!ui-block/widget/widget.html",["feast-tpl!app/feast-tpl!ui-block/widget/widget.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/widget/widget",["require","exports","default-values","feast","feast-tpl!./widget.html","helpers/opener","service/radars/decorator","ui-block/ico/ico","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=b.default.Block.extend(e.default({events:[{name:"click-on-link",rename:function(a){return a.get("type")+"_click"}}]})({events:{"click-on-link":"onClickLink"},name:"widget",template:c.default,blocks:{ico:f.default},lazyBlocks:{"widget-calendar":g.lazyUIWidgetCalendar},types:{calls:{title:i18n("Видеозвонки"),link:a.WIDGET_CALLS_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank"},cloud:{title:i18n("Облако"),link:a.WIDGET_CLOUD_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank"},contacts:{title:i18n("Адресная книга"),shortcut:"g,c",link:a.WIDGET_ADDRESSBOOK_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank",ico:a.ADDRESSBOOK_ICO,dataQaId:"addressbook-open-button",promoId:"menu-item_addressbook"},bonus:{title:i18n("Бонус"),link:"https://r.mail.ru/n279211045",target:"_blank"},club:{title:i18n("Бизнес-клуб"),link:"https://r.mail.ru/n236907368",target:"_blank"},calendar:{title:i18n("Календарь"),imageVariant:a.WIDGET_ICONS_VARIANT},pay:{title:i18n("Оплаты"),link:a.WIDGET_PAYMENT_URL,target:"_blank",imageVariant:a.PAY_IMAGE_VARIANT,dataQaId:"pay-open-button_"+a.PAY_IMAGE_VARIANT,promoId:"menu-item_pay"},todo:{title:i18n("Задачи"),link:a.WIDGET_TODO_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank",dataQaId:"todo-open-button"}},getIcoByType:function(a){var b=this.types[a];return(b===null||b===void 0?void 0:b.ico)||""},getImageVariantByType:function(a){var b=this.types[a];if(b&&b.imageVariant){return"_"+b.imageVariant}return""},getLinkByType:function(a){var b=this.types[a];if(b&&b.link){return b.link}return""},getTargetByType:function(b){var c=this.types[b];if(b==="contacts"&&a.IS_NEW_ADDRESSBOOK){return"_self"}return c.target},getTitleByType:function(a){var b=this.types[a];if(b&&b.title){return b.title}return""},getShortcutByType:function(a){var b=this.types[a];return b.shortcut?b.shortcut:void 0},getQaIdByType:function(a){var b=this.types[a];return b.dataQaId?b.dataQaId:void 0},getPromoIdByType:function(a){var b=this.types[a];return b.promoId?b.promoId:void 0},onClickLink:function(b){var c=this.get("type");if(c==="contacts"){if(!a.IS_NEW_ADDRESSBOOK){d.default(a.WIDGET_ADDRESSBOOK_URL)}else{this.broadcast("addressbook:open")}b.preventDefault()}if(c==="pay"){d.default(this.getLinkByType(c));b.preventDefault()}if(c==="todo"){d.default(this.getLinkByType(c));b.preventDefault()}},getTooltipTitle:function(b,c){var d=this.get("billsCount");if(b==="pay"&&a.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART&&d){var e=d.unpaidFines,f=d.unpaidBills,g=d.total;var h=i18n("Оплаты");var i={count:e};var j=e>a.BILLS_COUNTER_MAX?i18n("{count}+ штрафов",{count:a.BILLS_COUNTER_MAX}):i18n.plural(e,[i18n("{count} штрафов",i),i18n("{count} штраф",i),i18n("{count} штрафа",i)]);var k={count:f};var l=f>a.BILLS_COUNTER_MAX?i18n("{count}+ счетов",{count:a.BILLS_COUNTER_MAX}):i18n.plural(f,[i18n("{count} счетов",k),i18n("{count} счет",k),i18n("{count} счета",k)]);var m="";switch(true){case!g:m=i18n("Нет счетов к оплате");break;case e===undefined:m=l;break;case!e:m=i18n("Нет штрафов")+", "+l;break;case!f:m=j;break;default:m=j+", "+l}return h+", "+m}if(c){return null}return this.getTitleByType(b)},getTotalBillsCount:function(){var b=this.get("billsCount");if(!b||!a.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){return null}return b.total>a.BILLS_COUNTER_MAX?a.BILLS_COUNTER_MAX+"+":b.total}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/sidebar-widgets/sidebar-widgets",["require","exports","default-values","feast","feast-tpl!./sidebar-widgets.html","helpers/get-adaptive","service/radars/decorator","service/radars/index","ui-block/dropdown/dropdown","ui-block/settings/settings","ui-block/sidebar-widgets/sidebar-widgets.constants","ui-block/widget/widget"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);var k=a.SHOW_RELOAD_BUTTON?2:1;var l=a.NEW_TOOLBAR?[]:a.SIDEBAR_MENU_LIST_CONFIG.filter(function(a){return!a.hidden});var m=l.length+k;var n=165;exports.default=b.default.Block.extend(e.default({explicit:"radar"})({name:"sidebar-widgets",template:c.default,blocks:{settings:h.default,widget:j.default,dropdown:g.default},events:{"folder:click":"onFolderClick","drag:over":"openSideBar","menu-item:click":"onMenuItemClick","menu-settings:click":"onSettingsClick","search:inbox:click":"onInboxClick","reload:click":"onReloadClick"},defaults:{"pony-mode":false,"vertical-list":false,"menu-widget-list":[],"menu-dropdown-list":[],short:false,"is-pay-widget-helper-active":false,"is-pdd-user":false,"css-vars-fallback":a.CSS_VARS_FALLBACK,"widget-sent-radars":{},"show-reload-button":a.SHOW_RELOAD_BUTTON},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments);this.onResize=this.onResize.bind(this)},getWidgetSizes:function(){return this.is("pony-mode")?i.WIDGET_SIZES_PONY:i.WIDGET_SIZES_NORMAL},didMount:function(){var a=this;this.adaptiveHandler=new d.GetAdaptive({pureBreakpoints:true,breakpoints:[{conditions:function(b){var c=b.height,d=b.width;if(d<n){return false}var e=a.getWidgetSizes();return m*e.height<=c},props:{"vertical-list":true,"menu-widget-list":l,"menu-dropdown-list":[]}},{conditions:function(b){var c=b.width;var d=a.getWidgetSizes();return m*d.width<=c},props:{"vertical-list":false,"menu-widget-list":l,"menu-dropdown-list":[]}},{conditions:function(b){var c=b.width;var d=a.getWidgetSizes();return c<d.width*2},props:function(b){var c=b.height;var d=a.getWidgetSizes();var e=Math.floor(c/d.height)-k;if(e<l.length){var f=Math.max(e-1,0);return{"vertical-list":true,"menu-widget-list":l.slice(0,f),"menu-dropdown-list":l.slice(f)}}return{"vertical-list":true,"menu-widget-list":l,"menu-dropdown-list":[]}}},{props:function(b){var c=b.width;var d=a.getWidgetSizes();var e=Math.floor(c/d.width)-k-1;return{"menu-widget-list":l.slice(0,e),"menu-dropdown-list":l.slice(e),"vertical-list":false}}}],element:this.el,onResize:this.onResize})},sendWidgetRadars:function(a,b,c){var d=this;if(a){a.forEach(function(a){var e=a.type;if(!d.attrs["widget-sent-radars"][e]){d.onSendRadar(e,b,c)}})}},shouldUpdate:function(a){this.sendWidgetRadars(a["menu-widget-list"],false,"show");this.sendWidgetRadars(a["menu-dropdown-list"],true,"show");return Object.keys(a).length>0},isPayWidgetInDropdown:function(){return this.get("menu-dropdown-list").some(function(a){return a.type==="pay"})},onResize:function(a){this.set(a)},didUnmount:function(){this.adaptiveHandler.destroy()},onSettingsClick:function(){this.onSendRadar("settings",false,"click")},onReloadClick:function(){location.reload()},onMenuItemClick:function(a){var b=a.details;var c=b.get("type");var d=b.get("dropDownMode");this.onSendRadar(c,d,"click");if(c==="pay"&&this.get("is-pay-widget-helper-active")){this.broadcast(i.SideBarMenuEvents.deactivateNotifyBadge);this.set("is-pay-widget-helper-active",false);f.default({type:"sidebar_pay_notif_click"})}},onSendRadar:function(b,c,d){if(c===void 0){c=false}var e={dropdown:c,isList:!!this.get("vertical-list")};if(b==="pay"){e.payImage=a.PAY_IMAGE_VARIANT}var g="sidebar-menu_"+b+"_"+d;f.default({type:g,dwh:e});if(d==="show"){this.attrs["widget-sent-radars"][b]=true}},useNewToolbar:function(){return a.NEW_TOOLBAR}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/sidebar-folders/sidebar-folders",["require","exports","default-values","feast","feast-mod/letters-count","feast-tpl!./sidebar-folders.html","helpers/debounce-frame","mediator/layout-manager/vars","resize-observer-polyfill","service/promo","service/radars/decorator","service/radars/index","ui-block/badge/badge","ui-block/compose-button/compose-button","ui-block/compose-dropdown/compose-dropdown","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/nav-folders/nav-folders","ui-block/react-async/react-async","ui-block/settings/settings","ui-block/sidebar/sidebar","ui-block/sidebar-widgets/sidebar-widgets","ui-block/sidebar-widgets/sidebar-widgets.constants","ui-block/widget/widget","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);v=__importDefault(v);exports.default=b.default.Block.extend(i.default({explicit:"radar"})({name:"sidebar-folders",template:d.default,blocks:{badge:k.default,"compose-button":l.default,"compose-dropdown":m.default,ico:o.default,"nav-folders":p.default,settings:r.default,sidebar:s.default,"sidebar-widgets":t.default,widget:v.default,dropdown:n.default,"react-async":q.default},lazyBlocks:{"themes-widget":w.lazyUIThemesWidget},events:{"folder:click":"onFolderClick","drag:over":"openSideBar","search:inbox:click":"onInboxClick","sidebar-resize-full":"onSidebarFullResize","sidebar-resize-short":"onSidebarShortResize"},defaults:{"folder-active":undefined,models:null,ponymode:false,router:null,isExpandedWidth:false,short:false,"widget-enabled":false,"is-pdd-user":false,"invite-calls":a.CALLS&&!a.CALLS_DISABLE_COMPOSE_DROPDOWN,categories:a.SEARCH_CATEGORIES,"css-vars-fallback":a.CSS_VARS_FALLBACK,webview:a.WEBVIEW},attrChanged:{"folder-active":function(){this.closeSidebar()},short:function(a){if(a){h.default.update()}}},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments);this.onResize=this.onResize.bind(this)},didMount:function(){var a=this;var b=new e.ConcatFrameDebouncer(this.onResize);var c=new g.default(function(a){b.requestDebouncedFrame(a)});c.observe(this.el);this.resizeObserver=c;this.resizeDebouncer=b;this.el.dragHandleEvent=function(b){return a.onDrag(b)}},getWidgetsMinHeight:function(){return u.WIDGETS_BLOCK_MIN_HEIGHT[this.is("ponymode")?"pony":"normal"]},onSidebarShortResize:function(a){var b=a.details;this.el.style.setProperty("--sidebar-short-folders-header-height",b.header+"px");this.el.style.setProperty("--sidebar-short-widgets-min-height",b.footer+"px")},onSidebarFullResize:function(a){var b=a.details;this.el.style.setProperty("--sidebar-folders-header-height",b.header+"px");this.el.style.setProperty("--vkui--octavius_size_sidebar_widgets_height_min--regular",b.footer+"px")},didUnmount:function(){this.el.dragHandleEvent=null;this.resizeObserver.disconnect();this.resizeDebouncer.destroy()},pureSet:function(a,b){if(this.get("key")===b){return}this.set(a,b)},onResize:function(a){var b=a[0].contentRect.width;if(b<=f.SIDEBAR_SHORT_COLUMN_LIMIT_PX){this.pureSet("short",true)}else{this.pureSet("short",false)}},onFolderClick:function(a){var b=a.details.id;if(b==this.get("folder-active")&&!a.isDefaultPrevented()){this.closeSidebar()}},onDrag:function(a){var b=a.type;if(b=="dragenter"){this.openSideBar()}},onMouseDrop:function(){var a=this;this.dropTimeout=setTimeout(function(){a.closeSidebar();a.$off(a.el,"mousemove","onMouseMove");a.$off(a.el,"mouseleave","onMouseDrop");a.$off(a.el,"mouseup","onMouseDrop")},600);this.$one(this.el,"mouseenter",function(){clearTimeout(a.dropTimeout)})},onMouseMove:function(a){var b=this.el.getBoundingClientRect();var c=b.top;var d=b.bottom;var e=a.clientY<c+60;var f=a.clientY>d-120;var g=this.ids.sidebar.getFullScrollable();if((e||f)&&g){var h=g.getScrollPos();var i=h.y+(e?-1:+1)*5;g.scrollTo(0,i,true)}},getTotalUnread:function(){return c.countUnreadTotalMod(true)},openSideBar:function(){this.ids.sidebar.open();this.$on(this.el,"mouseleave","onMouseDrop");this.$on(this.el,"mouseup","onMouseDrop");this.$on(this.el,"mousemove","onMouseMove")},closeSidebar:function(){this.ids.sidebar.close()},onInboxClick:function(){j.default("search-direct-inbox_click")},getInboxUrl:function(){var a=this.get("router");return a===null||a===void 0?void 0:a.getUrl("#letters")}}))});define("feast-tpl!app/feast-tpl!ui-block/todo/todo.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="visible" test="attrs[\'visible\']"/>\n\t<bem:mod name="disabledEvents" test="!attrs[\'eventsActive\']"/>\n\n\t<iframe src="{attrs.todoUrl}" bem:elem="frame" ref="todoFrame"></iframe>\n</div>\n',"app/feast-tpl!ui-block/todo/todo.html")});define("feast-tpl!ui-block/todo/todo.html",["feast-tpl!app/feast-tpl!ui-block/todo/todo.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/todo/todo",["require","exports","default-values","feast","feast-tpl!./todo.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"todo",template:c.default,defaults:{todoUrl:a.TODO_URL+"?source=octavius",visible:false,eventsActive:true},didMount:function(){this.broadcast("todo:mount")},didUnmount:function(){this.broadcast("todo:unmount")}})});define("feast-tpl!app/feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html",["feast"],function(a){return a.smartParse('<div qa:id="webview-mobile-header">\n\t<fn:var name="selectMode" value="{attrs.selectMode}"/>\n\t<fn:var name="readMode" value="{attrs.route.is(\'#read-letter #search-letter\') && !selectMode && !attrs.letterNotFound}"/>\n\n\t<fn:var name="readActions" value="{_this.getReadActions()}"/>\n\t<fn:var name="selectedCount" value="{_this.getSelectedCount() || \'\'}" />\n\t<fn:var name="selectedStats" value="{_this.getSelectedStats()}" />\n\t<fn:var name="letterId" value="{message && message.id}"/>\n\n\t<div bem:elem="element">\n\t\t<b:button2\n\t\t\tqa:id="open-sidebar"\n\t\t\tico="navigation:menu"\n\t\t\tremit:click.prevent="mobilesidebar:open"\n\t\t\tcentered\n\t\t\tpure\n\t\t/>\n\n\t\t<fn:if test="!attrs[\'hide-webview-title\']">\n\t\t\t<span bem:elem="title">{i18n(\'Почта\')}</span>\n\t\t</fn:if>\n\n\t\t<b:button2\n\t\t\tqa:id="open-compose"\n\t\t\tico="actions:add_big"\n\t\t\tremit:click="compose:new"\n\t\t\tcentered\n\t\t\tpure\n\t\t/>\n\t</div>\n\n\t<div bem:elem="controls">\n\t\t<fn:if test="!selectMode && !readMode">\n\t\t\t<span bem:elem="folder-name" qa:id="folder-name:name:{attrs.folder.get(\'name\')}">\n\t\t\t\t{attrs.folder.get(\'name\')}\n\t\t\t</span>\n\n\t\t\t<b:filters\n\t\t\t\tqa:id="filters"\n\t\t\t\tuse:mediator="filter-manager layout-manager themes-manager settings-manager advert-manager todo-manager folders-actions"\n\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\tshort="{true}"\n\t\t\t\ttouch="{true}"\n\t\t\t\tautochange="{false}"\n\t\t\t\tpure\n\t\t\t\talignRight="{true}"\n\t\t\t\thas-metathreads-settings="{attrs[\'has-metathreads-settings\']}"\n\t\t\t/>\n\t\t</fn:if>\n\t\t<fn:if test="selectMode">\n\t\t\t<b:button2\n\t\t\t\t\tfn:if="!attrs.deselectAll"\n\t\t\t\t\tremit:click="select:all"\n\t\t\t\t\ttitle="{i18n(\'Выделить все\')}"\n\t\t\t\t\texplanation="{true ? i18n(\'Выделить все\'): \'\'}"\n\t\t\t\t\tdisabled="{attrs.disabled}"\n\t\t\t\t\tico="select-all"\n\t\t\t\t\tqa:id="select-all"\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t\tcentered\n\t\t\t\t\thas-explanation="{selectedCount}"\n\t\t\t\t\ttext="{selectedCount}"\n\t\t\t/>\n\n\t\t\t<b:button2\n\t\t\t\t\tfn:if="attrs.deselectAll"\n\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\ttitle="{i18n(\'Снять выделение\')}"\n\t\t\t\t\texplanation="{selectedCount ? i18n(\'Снять выделение\'): \'\'}"\n\t\t\t\t\tmap="toolbar"\n\t\t\t\t\tico="select-all"\n\t\t\t\t\tqa:id="deselect-all"\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t\thas-explanation="{selectedCount}"\n\t\t\t\t\ttext="{selectedCount}"\n\t\t\t/>\n\n\t\t\t<div>\n\t\t\t\t<b:button2 remit:click="remove"\n\t\t\t\t\t\t   event:details="{selection:true}"\n\t\t\t\t\t\t   ico="delete"\n\t\t\t\t\t\t   qa:id="delete"\n\t\t\t\t\t\t   compact\n\t\t\t\t\t\t   pure\n\t\t\t\t\t\t   size="m"\n\t\t\t\t\t\t   short\n\t\t\t\t\t\t   ico-text-top\n\t\t\t\t\t\t   centered\n\t\t\t\t/>\n\n\t\t\t\t<b:button2 remit:click="move:click"\n\t\t\t\t\t\t   ico="folder-move"\n\t\t\t\t\t\t   qa:id="move-to-folder"\n\t\t\t\t\t\t   compact\n\t\t\t\t\t\t   pure\n\t\t\t\t\t\t   touch-nav\n\t\t\t\t\t\t   disabled="{!_this.isEnableMove()}"\n\t\t\t\t\t\t   size="m"\n\t\t\t\t\t\t   short\n\t\t\t\t\t\t   ico-text-top\n\t\t\t\t\t\t   centered\n\t\t\t\t/>\n\n\t\t\t\t<b:dropdown-actions\n\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\tuse:mediator="layout-manager settings-filters-manager calendar-manager translator-manager calls-manager letters-selection"\n\t\t\t\t\t\tqa:id="more"\n\n\t\t\t\t\t\tmodel="{attrs.store.letter}"\n\t\t\t\t\t\tfolder="{attrs.store.folder}"\n\t\t\t\t\t\tico="more-hor"\n\n\t\t\t\t\t\tread="{selectedStats.unread > 0}"\n\t\t\t\t\t\tunread="{selectedStats.read > 0}"\n\t\t\t\t\t\tflag="{selectedStats.noflagged > 0}"\n\t\t\t\t\t\tunflag="{selectedStats.flagged > 0}"\n\t\t\t\t\t\tforward="{!selectedStats.metathread}"\n\t\t\t\t\t\tspam="{!selectedStats.metathread && ((readMode && !attrs.folder.isSpam()) || selectedStats.nospam > 0)}"\n\t\t\t\t\t\tunspam="{(readMode && attrs.folder.isSpam()) || selectedStats.spam > 0}"\n\t\t\t\t\t\tarchive="{!attrs.folder.isArchive()}"\n\t\t\t\t\t\tcreate-filter\n\n\t\t\t\t\t\tdisable-expand-top\n\t\t\t\t\t\tdisable-expand-center\n\t\t\t\t\t\tpure\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tico-text-top\n\t\t\t\t\t\tselection-actions\n\t\t\t\t\t\tsize="m"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\n\t\t<fn:if test="readMode">\n\t\t\t<b:button2\n\t\t\t\t\tremit:click="letter:back"\n\t\t\t\t\ttext="{i18n(\'Вернуться\')}"\n\t\t\t\t\tico="arrow-back"\n\t\t\t\t\tqa:id="letter_back"\n\t\t\t\t\tpure\n\t\t\t\t\tuse:mediator="thread-manager"\n\t\t\t\t\tshort\n\t\t\t/>\n\n\t\t\t<div>\n\t\t\t\t<fn:for data="readActions" as="item">\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\tfn:if="!item.hasOwnProperty(\'if\') || item.if"\n\t\t\t\t\t\t\tkey="{item.type}"\n\t\t\t\t\t\t\ttype="{item.type}"\n\t\t\t\t\t\t\tshort="{item.short}"\n\t\t\t\t\t\t\tdisabled="{item.disabled ? true : item.disabled !== false && isDisableEdit}"\n\t\t\t\t\t\t\tletter-id="{letterId}"\n\t\t\t\t\t\t\tletter="{message}"\n\t\t\t\t\t\t\tread="{item.read}"\n\t\t\t\t\t\t\tunread="{item.unread}"\n\t\t\t\t\t\t\tflag="{item.flag}"\n\t\t\t\t\t\t\tunflag="{item.unflag}"\n\t\t\t\t\t\t\tarchive="{item.archive}"\n\t\t\t\t\t\t\tspam="{item.spam}"\n\t\t\t\t\t\t\tunspam="{item.unspam}"\n\t\t\t\t\t\t\tforward="{item.forward}"\n\t\t\t\t\t\t\tcreate-filter="{item[\'create-filter\']}"\n\t\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\t\t\t</div>\n\n\t\t</fn:if>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html")});define("feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html",["feast-tpl!app/feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/webview-mobile-header/webview-mobile-header",["require","exports","default-values","feast","feast-tpl!./webview-mobile-header.html","helpers/letter","service/layer","ui-block/button2/button2","ui-block/portal-menu/portal-menu","ui-block/portal-menu-element/portal-menu-element"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);h=__importDefault(h);var i={name:"webview-mobile-header",template:c.default,blocks:{button2:f.default,"portal-menu-element":h.default},events:{"move:click":"onMoveToClick"},defaults:{selected:[],"hide-webview-title":a.HIDE_WEBVIEW_TITLE},attrChanged:{selected:function(){if(!this.isMounted()){return}this.set("selectedStats",this.getSelectedStats())}},getSelectedStats:g.blockSpec.getSelectedStats,getSelectedCount:g.blockSpec.getSelectedCount,getReadActions:function(){var b=this.attrs.readMode&&this.attrs.route.params.part;var c=this.attrs.selectedStats||Object.create(null);var e=this.attrs.readMode&&!this.attrs.folder.isSpam()||c.nospam>0;var f=this.attrs.readMode&&this.attrs.Attrs.folder.isSpam()||c.spam>0;var g=this.attrs.letter;var h=g&&g.get("messages").first();return[{type:"remove",short:true,disabled:b},{type:"reply",short:true,letter:g,disabled:b},{type:"reply-all",if:d.hasLetterReplyAll(h),short:true,letter:g,disabled:b},{type:"forward",short:true,letter:g,disabled:b},{if:e,type:"spam",short:true,disabled:b||this.attrs.selectMode&&(this.attrs.deselectAll||c.metathread)},{type:"more",short:true,spam:e,unspam:f,read:g.is("flags.unread"),unread:!g.is("flags.unread"),flag:!g.is("flags.flagged"),unflag:g.is("flags.flagged"),archive:!g.getFolder().isArchive()&&!a.ARCHIVE_DISABLED,"create-filter":true,forward:!c.metathread&&!this.attrs.deselectAll}]},onMoveToClick:function(){var a=this.get("model");e.default.open("move-to-folder",{folder:a.folder,folders:a.folders},{dimmer:true,mobile:true,resolvable:false})}};exports.default=b.default.Block.extend(i)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/application-mail/application-mail",["require","exports","default-values","feast","feast-tpl!./application-mail.html","helpers/g-silent","helpers/new-letter-list","service/contextmenu","service/radars/index","service/submenu","service/title","ui-block/advert-column/advert-column","ui-block/contextmenu/contextmenu","ui-block/counters/counters","ui-block/dimmer/dimmer","ui-block/download-frame/download-frame","ui-block/layer-window/layer-window","ui-block/layout/layout","ui-block/letter-list/letter-list","ui-block/list-nested/list-nested","ui-block/mobile-sidebar/mobile-sidebar","ui-block/octopus/octopus","ui-block/panel-with-selected/panel-with-selected","ui-block/portal-menu/portal-menu","ui-block/progress/progress","ui-block/react-async/react-async","ui-block/renovator/renovator","ui-block/scrollable/scrollable","ui-block/settings-dock/settings-dock","ui-block/shortcut/shortcut","ui-block/sidebar-folders/sidebar-folders","ui-block/sidebar-search/sidebar-search","ui-block/slot/slot","ui-block/thread/thread","ui-block/todo/todo","ui-block/webview-mobile-header/webview-mobile-header"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);exports.default=b.default.Block.extend({name:"application-mail",template:c.default,performanceTrace:true,isolate:false,isolateEvents:false,_gSilent:d.default({el:document.body,holder:window,timeout:150}),blocks:{contextmenu:k.default,counters:l.default,dimmer:m.default,"download-frame":n.default,layout:p.default,"layer-window":o.default,"letter-list":q.default,octopus:t.default,"panel-with-selected":u.default,"portal-menu":v.default,"react-async":x.default,scrollable:z.default,shortcut:B.default,"sidebar-folders":C.default,"sidebar-search":D.default,slot:E.default,"advert-column":j.default,thread:F.default,progress:w.default,todo:G.default,renovator:y.default,"settings-dock":A.default,"mobile-sidebar":s.default,"webview-mobile-header":H.default},defaults:{"user-resize":a.USER_LAYOUT_RESIZE,"user-resize-3pane":a.USER_LAYOUT_RESIZE_3PANE,"is-webview":a.WEBVIEW,"is-octavius-mobile":a.OCTAVIUS_MOBILE},checkShowLetterPreview3Pane:function(a){var b=this.get("router");var c=this.get("uiLayout");return c.type==="3pane"&&c.support3pane&&a||!b.route.is("#search-letter #read-letter")},isAdvEnable:function(){var b=this.get("uiLayout");return a.LETTER_CONTENT_ADV_ENABLE&&!b.hideAds},is3Pane:function(){return this.get("uiLayout").type==="3pane"&&this.get("uiLayout").support3pane},showLayoutBorders:function(){return!e.isNewLetterListEnabled(this.is3Pane())},useNewThread:function(){return a.NEW_THREAD},useNewToolbar:function(){return a.NEW_TOOLBAR},useReactSearchPanel:function(){return a.SEARCH_PANEL_REACT},usePortalSearchPanel:function(){return a.SEARCH_PANEL_PORTAL},isThreadRounded:function(){return e.isNewLetterListEnabled(this.is3Pane())},isDragIconShown:function(){return a.RESIZER_DRAG_ICON_SHOWN&&e.isNewLetterListEnabled(this.is3Pane())},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments)},didMount:function(){f.default.setup(k.default);h.default.setup(r.default);i.default.setup();g.default(["application-mail","mount"])},didUnmount:function(){f.default.teardown();h.default.teardown();g.default(["application-mail","unmount"])}})});define("feast-mod/file-count",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fileCountSaved=exports.fileCount=void 0;function a(a){return i18n.plural(a,[i18n("{count} файлов",{count:a}),i18n("{count} файл",{count:a}),i18n("{count} файла",{count:a})])}exports.fileCount=a;function b(a){return i18n.plural(a,[i18n("{count} файлов сохранено",{count:a}),i18n("{count} файл сохранен",{count:a}),i18n("{count} файла сохранено",{count:a})])}exports.fileCountSaved=b});define("feast-tpl!app/feast-tpl!ui-block/attach-list/attach-list.html",["feast"],function(a){return a.smartParse('<div qa:id="attach-list">\n\t<fn:var name="attachCount" value="{attrs.models.length}" />\n\t<fn:var name="isSticky" value="{_this.isStickyEnabled()}"/>\n\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="expanded" test="attrs.expanded && !attrs.mobile || attrs[\'preview-mode\']"/>\n\t<bem:mod name="preview-mode" test="attrs[\'preview-mode\']"/>\n\n\t<div>\n\t\t<div bem:elem="container"  ref="container">\n\t\t\t<div bem:elem="thumbs" ref="thumbs" qa:id="thumbs">\n\t\t\t\t<fn:for data="attrs.models" as="attachment" key="idx">\n\t\t\t\t\t<b:attach-thumb\n\t\t\t\t\t\tkey="{attachment.id}"\n\t\t\t\t\t\tmodel="{attachment}"\n\t\t\t\t\t\tfull="{attachCount <= _this.fullLimit()}"\n\t\t\t\t\t\tresponsive="{attrs.mobile && attachCount === 1}"\n\t\t\t\t\t\tsave-to-cloud="{attrs[\'save-to-cloud\'] && !attrs[\'disable-save-to-cloud\'] && !attrs.mobile}"\n\t\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t\t\tremit:download="thumb-download"\n\t\t\t\t\t\tremit:cloud="thumb-cloud"\n\t\t\t\t\t\tremit:open="thumb-open"\n\t\t\t\t\t\tremit:thumb-item-rendered="thumb-rendered"\n\t\t\t\t\t\tuse:mediator="attachments-manager"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tfn:if="attrs.showmore && !attrs.mobile && !attrs.expanded && !attrs[\'preview-mode\']"\n\t\t\t\tbem:elem="more"\n\t\t\t\tremit:click="expand"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="expand"\n\t\t\t\t\tbem:mod="gradient"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div bem:elem="expand-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="expand-center"\n\t\t\t\t\t\tqa:id="more"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div bem:elem="attach-icon"><b:ico name="attach"/></div>\n\t\t\t\t\t\t<div bem:elem="all">{i18n(\'все\')}</div>\n\t\t\t\t\t\t<div bem:elem="attach-count" qa:id="attach-count">{attachCount}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div bem:elem="controls" qa:id="attach-list-controls">\n\t\t\t<div bem:elem="controls-element">\n\t\t\t\t<span bem:elem="controls-element-count" qa:id="attach-count">\n\t\t\t\t\t<fn:value mod="fileCount">attachCount</fn:value>\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tbem:elem="controls-element"\n\t\t\t\tfn:if="attrs[\'download-link\'] && !(attachCount > 1 && attrs[\'disable-save-in-archive\'])">\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="controls-element-download"\n\t\t\t\t\tdata-name="{attachCount === 1 ? \'download-link\' : null}"\n\t\t\t\t\thref="{attrs[\'download-link\']}"\n\t\t\t\t\tqa:id="download-link"\n\t\t\t\t\tremit:click="download-link">{attachCount === 1 ? i18n(\'Скачать\') : i18n(\'Скачать одним архивом\')}</a>\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="controls-element-size"\n\t\t\t\t\tfn:if="attrs[\'total-size\']">\n\t\t\t\t\t(<fn:value mod="fileSize">attrs[\'total-size\']</fn:value>)\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="controls-element" fn:if="!attrs[\'disable-save-to-cloud\']">\n\t\t\t\t<span\n\t\t\t\t\t\tfn:if="_this.hasSaveToCloudAll()"\n\t\t\t\t\t\tbem:elem="controls-element-cloud"\n\t\t\t\t\t\tremit:click="attach-list-cloud"\n\t\t\t\t\t\tqa:id="save-to-cloud-link"\n\t\t\t\t\t\tevent:details="attrs.models">\n\t\t\t\t\t<fn:if test="attrs.mobile">{i18n(\'В Облако\')}</fn:if>\n\t\t\t\t\t<fn:if test="!attrs.mobile">{i18n(\'Сохранить в Облако\')}</fn:if>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<div\n\t\t\tfn:if="!attrs.mobile && attrs.expanded && !attrs[\'preview-mode\']"\n\t\t\tbem:elem="less"\n\t\t\tremit:click="collapse"\n\t\t\tqa:id="less"\n\t\t>\n\t\t\t<bem:mod name="sticky" test="isSticky"/>\n\t\t\t<div bem:elem="collapse-container">\n\t\t\t\t<div bem:elem="collapse-center">\n\t\t\t\t\t<b:ico name="arrow-up"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/attach-list/attach-list.html")});define("feast-tpl!ui-block/attach-list/attach-list.html",["feast-tpl!app/feast-tpl!ui-block/attach-list/attach-list.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/resizer",["require","exports","resize-observer-polyfill","utils/util"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=function(a,b,c){var d=false;var e=false;var f=[];return function(){var g=[];for(var h=0;h<arguments.length;h++){g[h]=arguments[h]}if(d){e=true;f.push(g)}else{a.apply(null,g);d=true;setTimeout(function(){d=false;if(e){a.apply(null,c(f));e=false;f=[]}},b)}}};function d(a){if(a.length===1){return a[0]}var b={};for(var c=0,d=a;c<d.length;c++){var e=d[c][0];var f=Object.keys(e);for(var g=0,h=f;g<h.length;g++){var i=h[g];b[i]=e[i]}}return[b]}function e(){var e;var f;var g={};return{set:function(a,f,g){if(f===void 0){f=150}if(g===void 0){g=false}if(!e){e=g?b.default.debounce(a,f,null):c(a,f,d);window.addEventListener("resize",e)}},observe:function(b,c){if(!e){throw new Error("Please use .set() first to initialize Resizer.")}if(!f){window.removeEventListener("resize",e);f=new a.default(function(a){var b={};for(var c=0,d=a;c<d.length;c++){var f=d[c];var g=f.target.__resizerKey__;if(g!==undefined){b[g]=f.contentRect}}e(b)})}if(g[c]){f.unobserve(g[c])}f.observe(b);g[c]=b;b.__resizerKey__=c},unobserve:function(a){var b=a.__resizerKey__;if(f){if(g[b]){f.unobserve(a);g[b]=undefined}if(Object.keys(b).length===0){f.disconnect();f=undefined;g={};window.addEventListener("resize",e)}}},unbind:function(){if(e){window.removeEventListener("resize",e);e=null}if(f){f.disconnect();f=undefined;g={}}}}}exports.default=e});define("feast-tpl!app/feast-tpl!ui-block/attach-thumb/attach-thumb.html",["feast"],function(a){return a.smartParse('<div qa:id="{_this.getQaId()}">\n\t<fn:var name="hasNoTopbar" value="{_this.hasNoTopbar()}"/>\n\t<fn:var name="isSquare" value="{!attrs.responsive && !attrs.full && hasNoTopbar}"/>\n\t<fn:var name="isInfected" value="{_this.isInfected()}" />\n\t<fn:var name="attachWarningTooltip" value="{attrs[\'attach-warning-tooltip\'] && isInfected}" />\n\n\t<fn:attr name="title" value="{attrs.mainTitle}"/>\n\n\t<bem:mod name="full" test="attrs.full"/>\n\t<bem:mod name="responsive" test="attrs.responsive"/>\n\n\t<bem:mod name="top-free" test="hasNoTopbar"/>\n\t<bem:mod name="normal" test="!attrs.responsive && !attrs.full && !hasNoTopbar"/>\n\t<bem:mod name="square" test="isSquare"/>\n\t<bem:mod name="hide-link" test="isSquare"/>\n\n\t<div bem:elem="thumb-elem" qa:id="{_this.getParams().filename.name}">\n\t\t<b:react-async\n\t\t\tcomponent="AttachThumb"\n\t\t\ttitle="{_this.getParams().filename.name}"\n\t\t\tpreview="{_this.getThumbImage()}"\n\t\t\tfullPreview="{_this.isImage() && !attachWarningTooltip}"\n\t\t\tdownloadBtnTitle="{_this.getTitles().downloadTitle}"\n\t\t\tuploadBtnTitle="{_this.getTitles().uploadTitle}"\n\t\t\tdownloadBtnTooltip="{_this.getTitles().downloadTooltip}"\n\t\t\tuploadBtnTooltip="{_this.getTitles().uploadTooltip}"\n\t\t\tonDownloadClick="{_this.onDownload}"\n\t\t\tdisableCloudUpload="{!attrs[\'save-to-cloud\']}"\n\t\t\tonCloudUploadClick="{_this.onCloudUpload}"\n\t\t\tonOpenClick="{_this.onOpen}"\n\t\t\ttestId="thumb"\n\t\t\ticonType="{_this.getIcon()}"\n\t\t\tisLink="{_this.isBigAttach()}"\n\t\t\tlinkTitle="{_this.getTitles().mainTitle}"\n\t\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\t\tlink="{_this.getDownloadUrl()}"\n\t\t\tattachWarningTooltip="{attachWarningTooltip}"\n\t\t/>\n\t</div>\n\n</div>\n',"app/feast-tpl!ui-block/attach-thumb/attach-thumb.html")});define("feast-tpl!ui-block/attach-thumb/attach-thumb.html",["feast-tpl!app/feast-tpl!ui-block/attach-thumb/attach-thumb.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/attach-thumb/attach-thumb",["require","exports","default-values","feast","feast-mod/file-size","feast-mod/letter-date","feast-tpl!./attach-thumb.html","helpers/opener","mail/Attachment","service/layer","service/notify","service/radars/index","ui-block/download-frame/download-frame","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);l=__importDefault(l);exports.default=b.default.Block.extend({name:"attach-thumb",template:e.default,blocks:{"react-async":l.default},attrChanged:{"save-to-cloud":function(){if(this.thumbBlock){this.thumbBlock.setData(this.getParams());this.thumbBlock.render()}}},defaults:{"attach-warning-tooltip":a.ATTACH_WARNING_TOOLTIP},events:{},isImage:function(){var a=this.get("model");return a.isImage()},isDoc:function(){var a=this.get("model");return a.isPreviewFromDocs()||a.isCloudStock()},isBigAttach:function(){var a=this.get("model");return a.isLink()||a.isCloud()||a.isCloudStock()},getAttachSize:function(){var a=this.get("model");return c.fileSize(a.get("size"))},getIcon:function(){var a=this.get("model");return a.getExtension()},getDownloadUrl:function(){var a=this.get("model");return a.getDownloadUrl()},getThumbImage:function(){if(this.get("attach-warning-tooltip")&&this.isInfected()){return}var b=this.get("model");var c=b.isFromDocs()?g.default.THUMBNAIL_SIZE_L:g.default.THUMBNAIL_SIZE_M;var d=b.getThumbnailUrl(c);if((this.is("full")||this.is("responsive"))&&b.isImage()&&!b.isFromDocs()){d=b.getThumbnailUrl(g.default.THUMBNAIL_SIZE_ORIGINAL)||d;if(b.isPreviewFromDocs()||b.isCloudStock()){d=b.getPreviewUrl()||d}}if(b.isFromDocs()&&b.isCloudStock()){return}if(a.DISABLE_DOCS_PREVIEWS&&(b.isFromDocs()||b.isPreviewFromDocs())){return}return d},getTitles:function(){var a=this.get("model");var b=i18n("Скачать");var e=i18n("Скачать")+(" ("+c.fileSize(a.get("size"))+")");var f=i18n("В Облако");var g=i18n("Сохранить в Облако");var h=a.get("duedate")?a.get("name")+". "+i18n("Ссылка доступна до")+" "+d.letterAttachLinkDate(a.get("duedate")):a.get("name");return{downloadTitle:b,downloadTooltip:e,uploadTitle:f,uploadTooltip:g,mainTitle:h}},getParams:function(){var b=this.get("model");this.unsafe=b.isUnsafe();this.extension=b.getExtension();this.filename=b.getName();var e=b.isLink()||b.isCloud()||b.isCloudStock();var f=this.is("save-to-cloud")&&!b.isLink()&&!b.isCloud();var g=this.getThumbImage();var h=this.is("full")?i18n("Скачать"):"";var i=i18n("Скачать")+(" ("+c.fileSize(b.get("size"))+")");var j=this.is("full")?i18n("В Облако"):"";var l=i18n("Сохранить в Облако");var m=b.get("duedate")?b.get("name")+". "+i18n("Ссылка доступна до")+" "+d.letterAttachLinkDate(b.get("duedate")):b.get("name");var n={isDeferred:false,showFilenameTitle:false,filename:{name:b.get("name")},imageUrl:g,icon:b.getExtension(),type:b.getPrimitiveType(),mainTitle:m,isDocument:g&&b.isFromDocs()&&!b.isImage(),controls:{bottom:{left:{items:[{block:"btn",params:{text:h,title:i,href:b.getDownloadUrl(),icon:"system_download",name:"download",mods:["bare"],target:b.isCloud()||a.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW?"_blank":k.DOWNLOAD_IFRAME_NAME}}]},right:{items:[]}}}};f&&n.controls.bottom.left.items.push({block:"btn",params:{text:j,title:l,icon:"to-cloud",name:"cloud",mods:["bare"]}});e&&n.controls.bottom.right.items.push({block:"btn",params:{title:m,icon:"compose_link",name:"link",mods:["bare","visible","round","green"]}});return n},sendAnalytics:function(a){this.broadcast("attachment:analytics",{models:[this.get("model")],event:a})},didMount:function(){this.onDownload=this.onDownload.bind(this);this.onCloudUpload=this.onCloudUpload.bind(this);this.onOpen=this.onOpen.bind(this);this.broadcast("thumb-item-rendered",this.get("model"));this.sendAnalytics("show")},onDownload:function(b){var c=this;this.broadcast("download",this.get("model"));this.sendAnalytics("download");var d=this.get("model");var e=d.isCloud()||a.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW?"_blank":k.DOWNLOAD_IFRAME_NAME;if(!a.LAYER_UNSAFE_ATTACH||!this.unsafe){return}h.default.open("unsafe-attach",{filename:this.filename,extension:this.extension},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true}).then(function(a){var b=a===void 0?{resolveType:"error"}:a,d=b.resolveType;if(d==="ok"){window.open(c.getDownloadUrl(),e)}}).catch(function(a){if(a){throw a}});b.preventDefault()},onCloudUpload:function(){var a=this.get("model");if(a.isOverMaxLinkSize()){j.default("big_attach_cl_save");i.default.error({text:i18n("Что-то пошло не так")});return}this.broadcast("cloud",this.get("model"))},onOpen:function(){if(a.DISABLE_ATTACHES_OPENING){return}this.sendAnalytics("open");var b=this.get("model");if(b.isOverMaxLinkSize()){var c=b.getDownloadUrl();f.default(c);return}this.broadcast("open",this.get("model"))},isInfected:function(){var a=this.get("model");return a.isInfected()},getQaId:function(){var a=this.get("model");return""+a.get("name")+(this.isInfected()?":infected":"")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/attach-list/attach-list",["require","exports","default-values","feast","feast-mod/file-count","feast-mod/file-size","feast-tpl!./attach-list.html","helpers/browser","helpers/resizer","service/layer","service/radars/decorator","service/radars/index","ui-block/attach-thumb/attach-thumb","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var m=new g.default;exports.default=b.default.Block.extend(i.default({events:[{name:"attach-list-cloud",rename:"to-cloud"},"download-link","thumb-download","thumb-open","thumb-cloud"]})({name:"attach-list",template:e.default,isolateEvents:false,mods:{fileSize:d.fileSize,fileCount:c.fileCount},blocks:{"attach-thumb":k.default,ico:l.default},events:{expand:"onExpandClick",collapse:"onCollapseClick","thumb-rendered":"onThumbRendered","download-link":"onDownloadLink"},attrChanged:{expanded:function(a){var b=a?"attach-list-expanded":"attach-list-collapsed";this.broadcast(b);this.showMore()}},defaults:{models:[],"disable-save-to-cloud":a.DISABLE_SAVE_TO_CLOUD,"total-size":0,"download-link":"",itemsRendered:0,"disable-save-in-archive":a.DISABLE_SAVE_IN_ARCHIVE},didMount:function(){var a=this.showMore.bind(this);this.el&&m.set(function(){setTimeout(a,200)});this.downloadBtn=this.el.querySelector('[data-name="download-link"]');if(this.downloadBtn){this.downloadBtn.addEventListener("click",this.onDownload.bind(this),true)}},didUpdate:function(){this.broadcast("force-recalc")},didUnmount:function(){m.unbind()},onExpandClick:function(){this.set("expanded",true)},onCollapseClick:function(){this.set("expanded",false)},hasSaveToCloudAll:function(){return this.is("save-to-cloud")&&this.get("models").some(function(a){return!a.isOverMaxSize()&&!a.isLink()&&!a.isCloud()||a.isCloudStock()})},fullLimit:function(){return a.FULL_ATTACH_THUMB_LIMIT},onThumbRendered:function(a){var b=this.get("itemsRendered");var c=this.get("models").length;b++;this.set("itemsRendered",b,true);if(b===c){this.showMore();this.forceExpandedAttaches()}},showMore:function(){var a=this.refs.thumbs;var b=this.refs.container;if(!a||!b){return}this.set("showmore",b.scrollWidth<a.scrollWidth)},forceExpandedAttaches:function(){if(this.get("showmore")&&a.FORCE_EXPANDED_ATTACH_LIST&&this.get("letter-length")<=a.FORCE_EXPANDED_ATTACHES_MAX_TEXT_LENGTH){this.set("expanded",true);j.default("force_expanded_attach-list")}},isStickyEnabled:function(){return!a.IS_NATIVE_STICKY_DISABLED&&f.default.capabilities["sticky-support"]},onDownloadLink:function(){this.broadcast("attachment:analytics",{models:this.get("models"),event:"download_archv"})},onDownload:function(b){var c=this;if(this.get("models").length!==1){return}if(!a.LAYER_UNSAFE_ATTACH){return}var d=this.get("models")[0];var e=d.isUnsafe();if(!e){return}var f=d.getExtension();var g=d.getName();h.default.open("unsafe-attach",{filename:g,extension:f},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true}).then(function(a){var b=a===void 0?{resolveType:"error"}:a,d=b.resolveType;if(d==="ok"){window.open(c.downloadBtn.getAttribute("href"),"download-frame")}}).catch(function(a){if(a){throw a}});b.preventDefault()}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-confirm-clear-folder">\n\t<bem:mod name="touch" test="attrs.mobile"/>\n\t<bem:mod name="full" test="!attrs.mobile"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:layer\n\t\t\tremit:close="layer:close"\n\t\t\tmodel="{attrs.model}"\n\t\t\terror="{attrs.error}"\n\t\t\tmobile="{attrs.mobile}"\n\t\t\tname="confirm-clear-folder"\n\t\t\tclose\n\t\t\theader\n\t\t\tfooter\n\t\t\tcenter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\n\t\t<fn:match name="header" args="attrs">\n\t\t\t{_this.getText()}\n\t\t</fn:match>\n\n\t\t<fn:match name="content" args="attrs">\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="attrs.model.isTrashLike() || attrs.model.isSpam()">\n\t\t\t\t\t<span qa:id="remove-forever">\n\t\t\t\t\t\t{i18n(\'Письма удалятся навсегда — восстановить их не получится.\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:when>\n\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<span qa:id="remove-to-trash">\n\t\t\t\t\t\t{i18n(\'Все письма будут перенесены в папку «Корзина».\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:match>\n\n\t\t<fn:match name="footer" args="attrs">\n\t\t\t<div bem:elem="submit-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="submit"\n\t\t\t\t\t\tremit:click="layer:resolve"\n\t\t\t\t\t\tevent:details="{close: true}"\n\t\t\t\t\t\ttext="{i18n(\'Очистить\')}"\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="cancel-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="cancel"\n\t\t\t\t\t\tremit:click="layer:close"\n\t\t\t\t\t\ttext="{i18n(\'Отменить\')}"\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html")});define("feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/layer/layer.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="standard" test="attrs.standard"/>\n\t<bem:mod name="media" test="attrs.media"/>\n\t<bem:mod name="compose" test="attrs.compose"/>\n\t<bem:mod name="center" test="attrs.center"/>\n\t<bem:mod name="size" value="{attrs.size}"/>\n\t<bem:mod name="wide" test="attrs.wide"/> \x3c!-- OCTAVIUS-1835 --\x3e\n\t<bem:mod name="{attrs.name}" test="attrs.name"/>\n\n\t<div bem:elem="controls" qa:id="controls">\n\t\t<b:button2\n\t\t\tfn:if="attrs.collapse"\n\t\t\tremit:click="collapse"\n\t\t\tqa:id="collapse"\n\t\t\tico="minimize"\n\t\t\ttext="{i18n(\'Свернуть\')}"\n\t\t\tsize="m"\n\t\t\tpure\n\t\t\tclean\n\t\t\tshort\n\t\t\ttab-index="1100"\n\t\t\tcentered\n\t\t/>\n\n\t\t<b:button2\n\t\t\tfn:if="attrs.close"\n\t\t\tremit:click="close"\n\t\t\tqa:id="close"\n\t\t\tico="close"\n\t\t\ttext="{i18n(\'Закрыть\')}"\n\t\t\tsize="m"\n\t\t\tpure\n\t\t\tshort\n\t\t\talways-bright="{this.isIframe()}"\n\t\t\tradar-id="close"\n\t\t\ttab-index="1000"\n\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t<div bem:elem="header" fn:if="attrs.header" qa:id="header">\n\t\t<fn:apply-match name="header"/>\n\t</div>\n\n\t<div bem:elem="content" qa:id="content">\n\t\t<fn:apply-match name="content"/>\n\t</div>\n\n\t<div bem:elem="footer" fn:if="!attrs.hiddenfooter" qa:id="footer">\n\t\t<fn:apply-match name="footer"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/layer/layer.html")});define("feast-tpl!ui-block/layer/layer.html",["feast-tpl!app/feast-tpl!ui-block/layer/layer.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer/layer",["require","exports","feast","feast-tpl!./layer.html","ui-block/button2/button2"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"layer",template:b.default,blocks:{button2:c.default},isIframe:function(){var a=this.get("name");return a==="iframe"}})});define("ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder",["exports","feast","feast-mod/brackets","feast-mod/folder-name","feast-tpl!./layer-confirm-clear-folder.html","ui-block/button2/button2","ui-block/layer/layer"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=k(a);var h=k(d);var i=k(e);var j=k(f);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"layer-confirm-clear-folder",template:h.default,blocks:{layer:j.default,button2:i.default},getName:function a(){var d=(0,c.getFolderName)(this.get("model"));return(0,b.brackets)(d)},getText:function a(){return i18n("Очистить папку {folder}?",{folder:this.getName()})}})});define("feast-tpl!app/feast-tpl!ui-block/letter-body/letter-body.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-body">\n\t\x3c!-- Переменные --\x3e\n\t<fn:var\n\t\tname="hasQuotes"\n\t\tvalue="{!!(attrs[\'quotes-raw\'] || attrs[\'quotes-formatted\'].length)}"\n\t/>\n\n\t<fn:var\n\t\tname="bodyRaw"\n\t\tvalue="{attrs[\'body-raw\']}"\n\t/>\n\n\t<fn:var\n\t\tname="darkMode"\n\t\tvalue="{attrs[\'dark-mode\']}"\n\t/>\n\n\t<fn:var\n\t\tname="message"\n\t\tvalue="{attrs[\'message\']}"\n\t/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t<bem:mod\n\t\tname="formatted-quotes"\n\t\ttest="!attrs[\'quotes-mode-raw\'] && attrs[\'quotes-formatted\'].length"\n\t/>\n\n\t<bem:mod\n\t\tname="raw-quotes"\n\t\ttest="attrs[\'quotes-mode-raw\'] && attrs[\'quotes-raw\']"\n\t/>\n\n\t<bem:mod\n\t\tname="quotes"\n\t\ttest="hasQuotes"\n\t/>\n\n\t<bem:mod name="dark-mode" test="darkMode"/>\n\n\t\x3c!-- Содержимое --\x3e\n\t<div bem:elem="body" qa:id="body">\n\t\t<bem:mod name="no-scroll" test="attrs[\'preview-mode\']"/>\n\t\t<div bem:elem="body-wrapper" ref="body">\n\t\t\t<div bem:elem="body-content" tabindex="-1" ref="js-body">\n\t\t\t\t\x3c!-- отрисовка письма всего один раз и навсегда --\x3e\n\t\t\t\t<b:html-parser\n\t\t\t\t\tid="body-parser"\n\t\t\t\t\tfn:if="bodyRaw"\n\t\t\t\t\tcontent="{bodyRaw}"\n\t\t\t\t\tdarkosha="{_this.getOrCreateDarkosha()}"\n\t\t\t\t\tmessage="{message}"\n\t\t\t\t\tdark-mode="{darkMode}"\n\t\t\t\t\tremit:zoom="letter:zoom"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Есть цитаты? --\x3e\n\t<fn:if test="hasQuotes">\n\t\t\x3c!-- Тоглер сворачивания цитат --\x3e\n\t\t<fn:if test="attrs.collapsable">\n\t\t\t<div bem:elem="badge">\n\t\t\t\t<b:button2\n\t\t\t\t\tbadge\n\t\t\t\t\tsecondary\n\t\t\t\t\tico="navigation:more"\n\t\t\t\t\tremit:click="blockquote:toggle"\n\t\t\t\t\tqa:id="blockquote-toggler"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\n\t\t\x3c!-- Когда свернуть нельзя, просто подписываем --\x3e\n\t\t<fn:if test="!attrs.collapsable">\n\t\t\t<div\n\t\t\t\tbem:elem="title"\n\t\t\t\tqa:id="blockquote-title"\n\t\t\t>{i18n(\'вся переписка\')}</div>\n\t\t</fn:if>\n\n\t\t\x3c!-- Тело цитат --\x3e\n\t\t<div\n\t\t\tref="blockquotes"\n\t\t\tbem:elem="blockquotes"\n\t\t\tqa:id="blockquotes">\n\t\t\t\x3c!-- Если цитаты развернуты --\x3e\n\t\t\t<fn:if test="!attrs.collapsable || !_this.isCollapsed()">\n\t\t\t\t\x3c!-- Старые цитаты --\x3e\n\t\t\t\t<fn:if test="attrs[\'quotes-mode-raw\']">\n\t\t\t\t\t<div bem:elem="blockquotes-raw" qa:id="raw">\n\t\t\t\t\t\t<b:html-parser\n\t\t\t\t\t\t\tid="quote-parser"\n\t\t\t\t\t\t\tcontent="{attrs[\'quotes-raw\']}"\n\t\t\t\t\t\t\tdarkosha="{_this.getOrCreateDarkosha()}"\n\t\t\t\t\t\t\tmessage="{message}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\n\t\t\t\t\x3c!-- Новые цитаты --\x3e\n\t\t\t\t<fn:if test="!attrs[\'quotes-mode-raw\']">\n\t\t\t\t\t<fn:for data="attrs[\'quotes-formatted\']" as="blockquote" key="key">\n\t\t\t\t\t\t<b:letter-blockquote\n\t\t\t\t\t\t\tkey="{key}"\n\t\t\t\t\t\t\tindex="{key}"\n\t\t\t\t\t\t\tblockquote="{blockquote}"\n\t\t\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\t\t\tmessage="{message}"\n\t\t\t\t\t\t\tdarkosha="{_this.getOrCreateDarkosha()}"\n\t\t\t\t\t\t\tremit:blockquote-zoom="letter:zoom"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</fn:if>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/letter-body/letter-body.html")});define("feast-tpl!ui-block/letter-body/letter-body.html",["feast-tpl!app/feast-tpl!ui-block/letter-body/letter-body.html"],function(a){return a});define("helpers/email-length-postfix",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getEmailLengthPostfix=a;function a(a){switch(true){case a<100:{return"0"}case a<500:{return"100"}case a<1e3:{return"500"}case a<1e4:{return Math.floor(a/1e3)+"k"}case a<15e3:{return"10k"}case a<2e4:{return"15k"}case a<25e3:{return"20k"}case a<3e4:{return"25k"}default:{return"30k"}}}});define("feast-tpl!app/feast-tpl!ui-block/html-parser/html-parser.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs[\'message\']}" />\n\n\t<b:html-fishing id="fishing" message="{message}">\n\t\t<b:html-expander id="expander" dark-mode="{attrs[\'dark-mode\']}">\n\t\t\t<fn:value output="raw">attrs.content</fn:value>\n\t\t</b:html-expander>\n\t</b:html-fishing>\n</div>\n',"app/feast-tpl!ui-block/html-parser/html-parser.html")});define("feast-tpl!ui-block/html-parser/html-parser.html",["feast-tpl!app/feast-tpl!ui-block/html-parser/html-parser.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/html-expander/html-expander.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:apply-match name="default" />\n</div>\n',"app/feast-tpl!ui-block/html-expander/html-expander.html")});define("feast-tpl!ui-block/html-expander/html-expander.html",["feast-tpl!app/feast-tpl!ui-block/html-expander/html-expander.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html",["feast"],function(a){return a.smartParse('<div remit:click="wrapper:click">\n\t\x3c!-- Modifiers --\x3e\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="collapsed" test="!attrs.expanded"/>\n\t<bem:mod name="type_{attrs.type}" test="attrs.type"/>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="icoName" value="navigation:zoom_overlay"/>\n\n\t\x3c!-- Content --\x3e\n\t\x3c!-- todo: перенести в отдельный компонент кнопки --\x3e\n\t<div\n\t\tbem:elem="button"\n\t\tfn:if="attrs[\'is-button-visible\']"\n\t\tremit:click="zoom:click"\n\t\tqa:id="expand-button"\n\t>\n\t\t<span bem:elem="icon">\n\t\t\t<b:ico name="{icoName}"/>\n\t\t</span>\n\t</div>\n\n\t\x3c!-- Сюда добавится содержимое враппера --\x3e\n</div>\n',"app/feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html")});define("feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html",["feast-tpl!app/feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html"],function(a){return a});define("ui-block/html-expander-wrapper/html-expander-wrapper",["exports","feast","feast-tpl!./html-expander-wrapper.html","service/radars/decorator","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,g.default)({events:[]})({name:"html-expander-wrapper",template:f.default,performanceTrace:"track",immutable:true,isolate:true,isolateEvents:true,defaults:{expanded:false,"is-button-visible":false,type:""},blocks:{ico:h.default},didMount:function a(){}}))});define("service/processors/Expander",["exports","@mail/xray","Emitter","service/smokescreen","ui-block/html-expander-wrapper/html-expander-wrapper"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(d);function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var k=function(){function a(b){var c=b.radarName,d=c===undefined?"expander":c,e=b.isDefaultZoomOut,g=e===undefined?true:e,h=b.isTogglerVisible,j=h===undefined?false:h;i(this,a);f.default.apply(this);this.elements=new Map;this.radarName=d;this.parentWidth=0;this.container=null;this.isDefaultZoomOut=g;this.isTogglerVisible=j;this.radar("create")}j(a,[{key:"radar",value:function a(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++){c[d]=arguments[d]}e.default.send([this.radarName].concat(c),{skipdwh:true})}},{key:"prepare",value:function a(b,d){this.container=b;this.parentWidth=d||b.getBoundingClientRect().width;var e=b.querySelectorAll((0,c.selector)(this.SELECTOR));for(var f=0;f<e.length;f++){var g=e[f];var h=this.prepareItem(g),i=h.item,j=h.isFiltered;if(!j){this.elements.set(g,i)}}this.prepareEnd()}},{key:"prepareEnd",value:function a(){console.log(this.radarName+"#prepareEnd")}},{key:"prepareItem",value:function a(b){console.log(this.radarName+"#prepareItem")}},{key:"reset",value:function a(){var b=this;this.elements.forEach(function(a){b.resetItem(a)});this.elements.clear()}},{key:"resetItem",value:function a(b){console.log(this.radarName+"#resetItem")}},{key:"toggleZoom",value:function a(b){this.radar("toggle-size");if(b.isSmall){this.zoomIn(b)}else{this.zoomOut(b)}}},{key:"zoomIn",value:function a(b){this.radar("set-original");b.isSmall=false;b.toggler.set("expanded",true);this.zoomInItem(b);this.emit("zoomin",b)}},{key:"zoomInItem",value:function a(b){console.warn("Expander#zoomInItem",b)}},{key:"zoomOut",value:function a(b){this.radar("set-small");b.isSmall=true;b.toggler.set("expanded",false);this.zoomOutItem(b);this.emit("zoomout",b)}},{key:"zoomOutItem",value:function a(b){console.warn("Expander#zoomOutItem",b)}},{key:"wrap",value:function a(b){var c=this;this.radar("wrap");var d=b.element,e=b.type;var f=document.createElement("div");var h=new g.default({"is-button-visible":this.isTogglerVisible,expanded:true,type:e});h.on("wrapper:click",function(a){c.emit("item:click",b);a.originalEvent.preventDefault()});h.on("zoom:click",function(a){c.emit("button:click",b);a.originalEvent.stopPropagation();a.originalEvent.preventDefault()});h.renderTo(f);d.parentNode.insertBefore(f,d);h.el.appendChild(d);b.toggler=h;b.wrapper=f;b.clone=d.cloneNode(true);return b}},{key:"unwrap",value:function a(b){this.radar("unwrap");var c=b.toggler,d=b.wrapper,e=b.element;c.destroy();var f=d;var g=d.parentNode;g.insertBefore(e,f);g.removeChild(f);b.wrapper=null;b.toggler=null}},{key:"SELECTOR",get:function a(){return""}},{key:"ITEM_TYPE",get:function a(){return""}}]);return a}();exports.default=k});define("service/processors/ImagesExpander",["exports","@mail/xray","default-values","service/processors/Expander"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}var g=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function h(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function j(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function k(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var l=function(a){k(c,a);function c(a){h(this,c);return j(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,g({radarName:"images-expander"},a)))}i(c,[{key:"zoomInItem",value:function a(b){var c=b.element,d=b.cssWidth,e=b.cssHeight,f=b.cssMaxWidth;c.style.width=d;c.style.height=e;c.style.maxWidth=f}},{key:"zoomOutItem",value:function a(b){var c=b.element;c.style.width="";c.style.height="";c.style.maxWidth="100%"}},{key:"prepareItem",value:function a(c){var e=this.elements.get(c);if(e){return{item:e,isFiltered:true}}var f=c.closest("table "+this.SELECTOR);if(f&&this.container.contains(f)){return{item:null,isFiltered:true}}var g=c.closest("a");var h=g?"image-link":this.ITEM_TYPE;var i={cssWidth:c.style.width,cssHeight:c.style.height,cssMaxWidth:c.style.maxWidth,element:c,wrapper:null,isSmall:false,isCollapsable:false,isLink:g,type:h};var j=this.onItemLoad.bind(this,i);i.onImageLoad=j;if(!c.complete){d.default.send("add-event-load",{skipdwh:b.SKIP_DWH});c.addEventListener("load",j)}else{i.onImageLoad()}return{item:i,isFiltered:false}}},{key:"resetItem",value:function a(c){var e=c.element,f=c.onImageLoad,g=c.isCollapsable;d.default.send("remove-event-load",{skipdwh:b.SKIP_DWH});e.removeEventListener("load",f);if(!g){return}this.zoomIn(c);this.unwrap(c)}},{key:"onItemLoad",value:function a(b){var c=b.element;var d=c.getBoundingClientRect(),e=d.width;if(e===0){this.radar("width-0");return}this.radar("has-width");if(e>this.parentWidth){b.isCollapsable=true;this.radar("big-image");this.wrap(b);if(this.isDefaultZoomOut){this.zoomOut(b)}}}},{key:"SELECTOR",get:function a(){return"img"}},{key:"ITEM_TYPE",get:function a(){return"image"}}]);return c}(e.default);exports.default=l});define("service/processors/scale-element",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getWrapperCSSHeight=f;exports.getScale=g;var a=exports.MAX_SCALE=1;var b=exports.CONTAINER_MIN_HEIGHT=40;function c(a){var b=window.getComputedStyle(a,null);var c=parseInt(b.marginLeft,10)||0;var d=parseInt(b.marginRight,10)||0;return c+d}function d(a){var b=window.getComputedStyle(a,null);var c=parseInt(b.marginTop,10)||0;var d=parseInt(b.marginBottom,10)||0;return c+d}function e(a,b){var c=a.offsetHeight;return Math.ceil(c*b)+d(a)}function f(a,c){return Math.max(e(a,c),b)+"px"}function g(b,d){var e=b.getBoundingClientRect(),f=e.width;if(!(d>0&&f>0)){return a}d-=c(b);return d/f}});define("service/processors/TablesExpander",["exports","logger","service/processors/Expander","service/processors/scale-element","service/smokescreen"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=g(a);var f=g(b);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var i=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n="img";var o=2e3;var p=function(a){m(b,a);function b(a){j(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,i({radarName:"tables-expander"},a)));c.images=[];return c}k(b,[{key:"zoomInItem",value:function a(b){var c=b.element,d=b.wrapper;c.style.transform="";c.style.transformOrigin="";d.style.height=""}},{key:"zoomOutItem",value:function a(b){var d=b.element,e=b.scale,f=b.wrapper;d.style.transform="scale("+e+", "+e+")";d.style.transformOrigin="top left";f.style.height=(0,c.getWrapperCSSHeight)(d,e)}},{key:"prepareItem",value:function a(b){var c=b.closest(this.SELECTOR+" "+this.SELECTOR);if(c&&this.container.contains(c)){return{isFiltered:true,item:null}}this.images=[].concat(h(this.images),h(b.querySelectorAll((0,d.selector)(n))));var e={element:b,type:this.ITEM_TYPE};return{item:e,isFiltered:false}}},{key:"prepareEnd",value:function a(){if(this.images.length>0){this.radar("find-images");this.processImages()}else{this.radar("find-no-images");this.processTables()}}},{key:"processTables",value:function a(){var b=this;this.elements.forEach(function(a){b.scaleItem(a)})}},{key:"scaleItem",value:function a(b){this.radar("scale");var d=b.element;var e=(0,c.getScale)(d,this.parentWidth);b.scale=e;if(e<c.MAX_SCALE){this.wrap(b);if(this.isDefaultZoomOut){this.zoomOut(b)}}if(e>=c.MAX_SCALE&&d.scrollWidth>this.parentWidth){}}},{key:"processImages",value:function a(b){var c=this;var d=this.images;try{if(!b){b=(new Date).getTime()}var f=d.length;for(var g=0;g<d.length;g++){var h=d[g];if(!h||!h.src||h.complete){f--}}if(f==0||(new Date).getTime()-b>=o){this.processTables()}else{window.requestAnimationFrame(function(){c.processImages(b)})}}catch(a){this.radar("process-images","error");e.default.add("Error processing images in table-expander: "+a)}}},{key:"SELECTOR",get:function a(){return"table"}},{key:"ITEM_TYPE",get:function a(){return"table"}}]);return b}(f.default);exports.default=p});define("ui-block/html-expander/html-expander",["exports","default-values","feast","feast-tpl!./html-expander.html","service/layer","service/processors/ImagesExpander","service/processors/TablesExpander"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=l(b);var h=l(c);var i=l(d);var j=l(e);var k=l(f);function l(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"html-expander",template:h.default,performanceTrace:"track",immutable:false,isolate:true,isolateEvents:false,defaults:{images:a.IMAGES_EXPANDER,"images-default-zoomout":true,"images-popup":a.IMAGES_EXPANDER_POPUP,tables:a.TABLES_EXPANDER,"tables-default-zoomout":true,"tables-popup":a.TABLES_EXPANDER_POPUP},init:function a(){var b=this.el.getBoundingClientRect(),c=b.width;this.handleImageClick=this.handleImageClick.bind(this);this.handleImageButtonClick=this.handleImageButtonClick.bind(this);this.handleTableClick=this.handleTableClick.bind(this);this.handleTableButtonClick=this.handleTableButtonClick.bind(this);this.handleItemZoom=this.handleItemZoom.bind(this);if(this.is("tables")){this.tablesExpander=new k.default({isTogglerVisible:this.is("tables-popup"),isDefaultZoomOut:this.is("tables-default-zoomout")});this.tablesExpander.on("item:click",this.handleTableClick);this.tablesExpander.on("button:click",this.handleTableButtonClick);this.tablesExpander.on("zoomin",this.handleItemZoom);this.tablesExpander.on("zoomout",this.handleItemZoom);this.tablesExpander.prepare(this.el,c)}if(this.is("images")){this.imagesExpander=new j.default({isTogglerVisible:this.is("images-popup"),isDefaultZoomOut:this.is("images-default-zoomout")});this.imagesExpander.on("item:click",this.handleImageClick);this.imagesExpander.on("button:click",this.handleImageButtonClick);this.imagesExpander.on("zoomin",this.handleItemZoom);this.imagesExpander.on("zoomout",this.handleItemZoom);this.imagesExpander.prepare(this.el,c)}},deinit:function a(){if(this.imagesExpander){this.imagesExpander.off("item:click",this.handleImageClick);this.imagesExpander.off("button:click",this.handleImageButtonClick);this.imagesExpander.off("zoomin",this.handleItemZoom);this.imagesExpander.off("zoomout",this.handleItemZoom);this.imagesExpander.reset()}if(this.tablesExpander){this.tablesExpander.off("item:click",this.handleTableClick);this.tablesExpander.off("button:click",this.handleTableButtonClick);this.tablesExpander.off("zoomin",this.handleItemZoom);this.tablesExpander.off("zoomout",this.handleItemZoom);this.tablesExpander.reset()}},handleItemZoom:function a(){this.broadcast("zoom")},handleTableClick:function a(b){if(b.isSmall){this.tablesExpander.zoomIn(b)}},handleTableButtonClick:function a(b){this.openInLayer(b)},handleImageClick:function a(b){if(!b.isLink){this.imagesExpander.toggleZoom(b)}},handleImageButtonClick:function a(b){this.openInLayer(b)},openInLayer:function a(b){i.default.open("html-viewer",{content:b.clone.outerHTML,"dark-mode":this.get("dark-mode")},{dimmer:true,"dimmer-color":"dark",fullscreen:true})}})});define("feast-tpl!app/feast-tpl!ui-block/html-fishing/html-fishing.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:apply-match name="default" />\n</div>\n',"app/feast-tpl!ui-block/html-fishing/html-fishing.html")});define("feast-tpl!ui-block/html-fishing/html-fishing.html",["feast-tpl!app/feast-tpl!ui-block/html-fishing/html-fishing.html"],function(a){return a});define("helpers/domain-test",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function a(b,c){return new RegExp("^(https?:)?//([\\w\\.\\-]+\\.)?"+c).test(b)};exports.default=a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/fishing",["require","exports","@mail/features","default-values","helpers/browser","helpers/domain-test","helpers/querystring","helpers/querystring-add"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g="__originUrl";var h=location.protocol,i=location.hostname,j=location.pathname;var k=new RegExp("^"+h+"//"+i+"("+j+"|/)#");var l=document.createElement("div");var m="A";var n="FORM";var o="checklink.mail.ru";var p=function(){function h(){this.ERROR_HASH_URL="ERROR_HASH_URL";this.ERROR_EMPTY_URL="ERROR_EMPTY_URL";this.ERROR_NO_INFO_CHECK="ERROR_NO_INFO_CHECK"}h.prototype.removeRedirectFromLinks=function(a){var b=a.length;while(b--){this.getNodeInfo(a[b])}};h.prototype.removeRedirectFromText=function(a){l.innerHTML=a;var b=l.querySelectorAll("a");var c=b.length;while(c--){this.getNodeInfo(b[c])}return l.innerHTML};h.prototype.getNodeInfo=function(b){var f=b[g]||b.href||b.action;var h={};if(!f){console.warn("[fishing] no url in node");return h}try{var i=b.innerHTML;var j=b.childNodes;var l=b.tagName;var p=e.default(f);var q=a.default.has("clicker-proxy")?a.default.get("clicker-proxy").data:o;if(p.url&&d.default(f,q)){var r=e.default(p.url);Object.assign(p,r)}["check","url","u","js"].forEach(function(a){h[a]=p[a]});if(f.includes("#")&&k.test(f)){h={};h[f]=""}if(h.check&&h.url&&!h.u){if(!h.js&&l!==n){f=f.replace(/^([^#]+)/,"$1&js=1")}if(location.protocol=="https:"&&/^http/i.test(h.url)||c.default.isIE){h.redir=1}}h.real=f;h.attr=b.href?"href":"action";if(h.u){h.check=1;h.url=h.u;h.noajax=1}if(h.check&&h.url){b.target="_blank";b[g]=h.real;b.setAttribute(h.attr,l===m||h.u?h.url:f);b.removeAttribute("onclick");if(c.default.isIE&&l===m&&j.length==1&&j[0].nodeType==3){b.innerHTML=i}}else{h.url=f}}catch(a){console.warn("[fishing] error caught",a)}return h};h.prototype.revertUrl=function(a){var b=this.getNodeInfo(a);var c=a.href;var d=a.tagName===m;if(b.check&&d){a.href=b.real;setTimeout(function(){a.href=c},300)}};h.prototype.verify=function(a,b){if(b===void 0){b={}}var c=this.getNodeInfo(a);var d=a.tagName===n;var e=b.sync,f=e===void 0?false:e,g=b.callback,h=g===void 0?{resolve:function(){},reject:function(a){return a}}:g;var i=f?h:Promise;var j=c.url;if(!j){return i.reject(this.ERROR_EMPTY_URL)}if(j.includes("#")&&a.hostname===location.hostname&&(a.pathname===location.pathname||a.pathname==="/")){return i.reject(this.ERROR_HASH_URL)}if(c.noajax&&!d){return i.resolve()}if(!c.check){return i.reject(this.ERROR_NO_INFO_CHECK)}return i.reject()};h.prototype.go=function(a,c,d){if(c===void 0){c=false}if(d===void 0){d={}}if(a[g]){a[g]=f.default(a[g],d)}var e=this.getNodeInfo(a);var h=a.tagName===n;var i=e[e.redir||e.noajax?"real":"url"];var j=null;if(e.redir){i+="&redir=1"}if(h){document.createElement("form").submit.call(a)}else{if(b.IS_CHROME){j=window.open(i,"_blank","toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes, noopener=true")}else{j=c||window.open(i)}if(j){j.opener=null}}};return h}();exports.default=new p});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/html-fishing/html-fishing",["require","exports","default-values","feast","feast-tpl!./html-fishing.html","service/fishing","service/radars/decorator"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);exports.default=b.default.Block.extend(e.default({events:[]})({name:"html-fishing",template:c.default,performanceTrace:"track",immutable:false,isolate:true,isolateEvents:false,init:function(){this.onLinkClick=this.onLinkClick.bind(this);this.onLinkMouseDown=this.onLinkMouseDown.bind(this);this.el.addEventListener("click",this.onLinkClick);this.el.addEventListener("mousedown",this.onLinkMouseDown);this.removeLinksFromBody()},deinit:function(){this.el.removeEventListener("click",this.onLinkClick);this.el.removeEventListener("mousedown",this.onLinkMouseDown)},getLink:function(a){while(a&&a!==this.el){if(a.tagName.toLowerCase()==="a"){return a}a=a.parentElement}},onLinkMouseDown:function(a){if(a.which>2){return}var b=this.getLink(a.target);if(b){d.default.revertUrl(b)}},onLinkClick:function(b){var c=this.getLink(b.target);if(c){var e=d.default.verify(c,{sync:true});var f=this.get("message");var g=f.get("flags.maybe_phishing");if(e===d.default.ERROR_HASH_URL||e===d.default.ERROR_EMPTY_URL){return true}b.preventDefault();d.default.go(c,null,__assign({},g&&{maybe_phishing:a.PHISHING_ALERT?"1":"0"}))}},removeLinksFromBody:function(){var a=this.el.querySelectorAll("a");d.default.removeRedirectFromLinks(a)}}))});define("ui-block/html-parser/html-parser",["exports","feast","feast-tpl!./html-parser.html","service/radars/decorator","ui-block/html-expander/html-expander","ui-block/html-fishing/html-fishing"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:[]})({name:"html-parser",template:g.default,performanceTrace:"track",immutable:false,isolate:true,isolateEvents:false,defaults:{content:"",message:null,darkosha:undefined},blocks:{"html-fishing":j.default,"html-expander":i.default},applyDarkosha:function a(){var b=this.get("darkosha");if(b){b.isolateSubtree(this.el)}},didMount:function a(){this.applyDarkosha()},rerender:function a(){this.ids.expander.deinit();this.ids.fishing.deinit();this.ids.expander.init();this.ids.fishing.init();this.applyDarkosha()},didUnmount:function a(){this.ids.expander.deinit();this.ids.fishing.deinit()}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-blockquote/letter-blockquote.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-blockquote">\n\t<bem:mod name="first" test="attrs.index === 0"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\n\t<fn:var name="message" value="{attrs[\'message\']}" />\n\t<fn:var name="blockquote" value="{attrs.blockquote}"/>\n\n\t<fn:if test="blockquote.isSenderFully">\n\t\t<div bem:elem="header">\n\t\t\t<b:avatar\n\t\t\t\tsize="s"\n\t\t\t\tsrc="{blockquote.avatar}"\n\t\t\t\tanonymous="{blockquote.anonymous}"\n\t\t\t/>\n\t\t\t<span\n\t\t\t\tqa:id="name"\n\t\t\t\tbem:elem="name"\n\t\t\t\tfn:if="blockquote.name"\n\t\t\t>\n\t\t\t\t<bem:mod name="anonymous" test="blockquote.anonymous"/>{blockquote.name}\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tqa:id="email"\n\t\t\t\tbem:elem="email"\n\t\t\t\tfn:if="blockquote.email"\n\t\t\t>\n\t\t\t\t<fn:value mod="addBrackets">blockquote.email</fn:value>\n\t\t\t</span>\n\t\t\t<time bem:elem="time" qa:id="time">\n\t\t\t\t<fn:value mod="letterAttachLinkDate">blockquote.timestamp</fn:value>\n\t\t\t</time>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="body" qa:id="body">\n\t\t<b:html-parser\n\t\t\tid="parser"\n\t\t\tcontent="{blockquote.body}"\n\t\t\tdarkosha="{attrs.darkosha}"\n\t\t\tmessage="{message}"\n\t\t\tremit:zoom="blockquote-zoom"\n\t\t/>\n\t</div>\n\n\t\x3c!-- Бордер --\x3e\n\t<b:delimeter/>\n</div>\n',"app/feast-tpl!ui-block/letter-blockquote/letter-blockquote.html")});define("feast-tpl!ui-block/letter-blockquote/letter-blockquote.html",["feast-tpl!app/feast-tpl!ui-block/letter-blockquote/letter-blockquote.html"],function(a){return a});define("ui-block/letter-blockquote/letter-blockquote",["exports","feast","default-values","feast-mod/letter-date","feast-tpl!./letter-blockquote.html","ui-block/delimeter/delimeter","ui-block/html-parser/html-parser","service/emoji"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=l(a);var i=l(d);var j=l(e);var k=l(f);function l(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"letter-blockquote",template:i.default,defaults:{blockquote:{},index:0,ponymode:false,"dark-mode":false},blocks:{delimeter:j.default,"html-parser":k.default},mods:{letterAttachLinkDate:c.letterAttachLinkDate,addBrackets:function a(b){return"<"+b+">"}},didMount:function a(){this.rerender()},rerender:function a(){(0,g.emojiFallback)(this.el,"blq");this.ids.parser.rerender()}})});define("ui-block/letter-body/blockquote",["exports","feast-mod/avatar","service/radars/index","service/smokescreen"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var g=".mail-quote-collapse";var h=".mail-quote-collapse .mail-quote-collapse";var i='[data-type="body"]';var j='[data-type="sender"]';exports.default={findQuoteRoot:function a(b){var d=[].concat(f(b.querySelectorAll((0,c.selector)(g)))).filter(function(a){return!a.closest((0,c.selector)(h))});if(d.length>1){return null}return d[0]},split:function a(b,e){try{var f=false;var g=this.findQuoteRoot(b);if(!g){return{bodyEl:b,quoteEl:null,newQuotesFound:false}}var h=b.querySelector((0,c.selector)(i));var k=b.querySelector((0,c.selector)(j));if(h&&k){f=true;g=document.createElement("div");g.appendChild(h);g.appendChild(k)}else{g.parentElement.removeChild(g)}return{bodyEl:b,quoteEl:g,newQuotesFound:f}}catch(a){b.innerHTML=e;(0,d.default)(["quotes","error","split"]);return{bodyEl:b,quoteEl:null,newQuotesFound:false}}},format:function b(d){return[].concat(f(d.querySelectorAll((0,c.selector)(i)))).reduceRight(function(b,e){var f=e.getAttribute("data-quote-id");var g=d.querySelector((0,c.selector)(j+'[data-quote-id="'+f+'"]'));var h="";var i="";var k="";var l="";var m=false;var n=false;var o=e.innerHTML;if(g){h=g.getAttribute("data-name");i=g.getAttribute("data-timestamp");k=g.getAttribute("data-email");l=(0,a.avatarUrl)(k,h,90)}if(i){m=true}if(!h&&!k){n=true;h=i18n("Аноним");l=""}if(g){g.parentNode.removeChild(g)}if(e.parentNode){e.parentNode.removeChild(e)}b.push({id:f,body:o,name:h,timestamp:i,email:k,avatar:l,anonymous:n,isSenderFully:m});return b},[]).reverse()},formatFallback:function a(b){b.style.display="";return b.outerHTML}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-body/letter-body",["require","exports","@mail/xray","default-values","feast","feast-tpl!./letter-body.html","helpers/email-length-postfix","service/emoji","service/radars/index","service/smokescreen","ui-block/button2/button2","ui-block/html-parser/html-parser","ui-block/letter-blockquote/letter-blockquote","../../lazy.modules","./blockquote"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);m=__importDefault(m);var n=!!(window.performance&&window.performance.now);function o(a){return l.lazyDomPurify().then(function(b){return b.sanitize(a)})}exports.blockSpec={name:"letter-body",immutable:true,template:d.default,defaults:{bodyHtml:"","body-raw":"",collapsed:null,collapsable:true,"collapsed-default":null,"flags-threads":false,"features-blockquote":false,"features-blockquote-thread":false,id:null,ponymode:false,"quotes-formatted":[],"quotes-raw":"","quotes-mode-raw":true,"dark-mode":false,message:null},notVisualAttributes:{bodyHtml:false},blocks:{button2:i.default,"html-parser":j.default,"letter-blockquote":k.default},events:{"blockquote:toggle":"onBlockquoteToggle","letter:zoom":"onLetterZoom"},attrChanged:{id:function(a,b){if(!a||!b||a===b){return}this.renderBody()}},didMount:function(){var a=this;this.renderBody().then(l.uniqCallback(this,function(){a.asyncDidMountRender()}))},asyncDidMountRender:function(){var a=this;if(!this.isMounted()){return}var c=["reminder-created","reminder-remind","new-receipt","payed-receipt-succeed","sub-created"];c.forEach(function(b){__spreadArrays(a.el.querySelectorAll('[data-id="'+b+'"]')).forEach(function(b){return a.$on(b,"click","handleClickMonetaLink")})});__spreadArrays(this.el.querySelectorAll("[data-moneta]")).forEach(function(b){return a.$on(b,"click","handleClickMonetaPayment")});__spreadArrays(this.el.querySelectorAll("[data-sig]")).forEach(function(b){a.$on(b,"click","handleClickFinePayment");a.$on(b,"contextmenu","handleClickRightFinePayment")});__spreadArrays(this.el.querySelectorAll('[data-id="tomyself"]')).forEach(function(b){return a.$on(b,"click","handleClickToMyself")});Object.entries(b.LETTER_BODY_POPUP_ALLOWED).forEach(function(b){var c=b[0],d=b[1];__spreadArrays(a.el.querySelectorAll(d.selector)).forEach(function(b){return a.$on(b,"click",function(b){return a.handleClickAllowedAttr(b,d,c)})})});Object.entries(b.LETTER_DATA_WHITE_LIST).forEach(function(b){var c=b[0],d=b[1];var e=null;if(d.limit&&d.limit>1){var f=a.el.querySelectorAll(d.selector);e=Array.from({length:d.limit},function(a,b){return f[b]})}else{e=[a.el.querySelector(d.selector)]}e.filter(Boolean).forEach(function(b){a.$on(b,"click",function(b){if(d.preventEvent){b.preventDefault();b.stopImmediatePropagation()}a.handelDataAttributeClick({event:b,params:d,type:c})})})})},handelDataAttributeClick:function(a){var b=a.event,c=a.params,d=a.type;var e=__assign(__assign({},c),{type:d});this.broadcast("data-attr-click",e,b)},didUpdate:function(a){if(this.get("dark-mode")!=a["dark-mode"]){this.applyDarkosha()}},didUnmount:function(){if(this._darkosha){this._darkosha.destroy()}},handleClickAllowedAttr:function(a,b,c){var d=__assign(__assign({},b),{skin:c});this.broadcast("allowedattrclick",d,a);g.default({type:"letter-body_payment-btn_click_"+b.radarName})},handleClickRightFinePayment:function(a){this.broadcast("finepaymentright",this,a);g.default({type:"letter-body_payment-btn_rclk_finepayment_gd-exp"})},handleClickFinePayment:function(a){this.broadcast("finepayment",this,a);g.default({type:"letter-body_payment-btn_click_finepayment_gd-exp"})},handleClickToMyself:function(a){this.broadcast("tomyselfclick",this,a);g.default({type:"letter-body_myslf-btn_click"})},handleClickMonetaLink:function(a){var b=a.target.getAttribute("data-id");var c=a.target.getAttribute("data-selector");var d=c.split(":"),e=d[0],f=d[1];g.default({type:"moneta_click_"+b+"_"+e,dwh:{merchant:f}})},handleClickMonetaPayment:function(a){this.broadcast("monetapayment",this,a);g.default({type:"letter-body_payment-btn_click_moneta"})},getOrCreateDarkosha:function(){var a=this._createConfiguredDarkosha;if(!this._darkosha&&a){this._darkosha=a(this.el,this.is("dark-mode"))}return this._darkosha},applyDarkosha:function(a){if(a===void 0){a=false}if(a&&this._darkosha){this._darkosha.destroy();this._darkosha=undefined}var b=this.getOrCreateDarkosha();if(b){if(this.is("dark-mode")){b.transform()}else{b.rollback()}}},renderBody:function(){var c=this;var d=n&&window.performance.now();var g=this.get("bodyHtml").replace(/<base .*?>/g,"");var i=g.length;var j=document.createElement("div");var k=Promise.all([l.lazyServiceDarkosha(),b.DOMPURIFY?o(g):Promise.resolve(g)]).then(function(a){var b=a[0],d=a[1];c._createConfiguredDarkosha=b.createConfiguredDarkosha;j.innerHTML=d;var e=m.default.split(j),f=e.bodyEl,g=e.quoteEl,i=e.newQuotesFound;c.set("body-raw",f.innerHTML);c.rerenderParser("body-parser");if(g){var k=c.is("flags-threads");var l=c.is("features-blockquote")&&!k||c.is("features-blockquote-threads")&&k;c.el.classList.add(h.selector(".letter-body_hidden").replace(".",""));return new Promise(function(a){setImmediate(function(){if(c.isMounted()){var b=i&&l;var d=b?"new":"old";c.format(d,g);c.el.classList.remove(h.selector(".letter-body_hidden").replace(".",""))}c.broadcast("force-recalc");a()})})}else{c.broadcast("force-recalc")}});k.then(function(){var g;if(c.isMounted()){c.applyDarkosha()}f.emojiFallback(c.el,"ltr-body");if(n){var h=window.performance.now();var j=Math.round(h-d);var k=b.DOMPURIFY?"dompurify":"none";var l=b.IS_CHROME?"chrome":"other";var m=e.getEmailLengthPostfix(i);a.default.send("letter_render_ms",{v:j,i:(g={},g[k]=j,g[k+"_"+l]=j,g[k+"_"+m]=j,g[k+"_"+l+"_"+m]=j,g),skipdwh:b.SKIP_DWH})}});return k},format:function(a,b){var c=false;if(a==="new"){try{c=this.formatNew(b)}catch(a){g.default(["quotes","error","format-new"]);c=this.formatFallback(b)}}else{c=this.formatFallback(b)}c&&this.triggerBlockquoteChange()},formatNew:function(a){var b=m.default.format(a);this.set({collapsable:this.is("flags-threads"),"quotes-mode-raw":false,"quotes-formatted":b});return b.length!==0},formatFallback:function(a){if(!a){return}var b=m.default.formatFallback(a);this.set({collapsable:this.is("flags-threads"),"quotes-mode-raw":true,"quotes-raw":b});this.rerenderParser("quote-parser");return b!==""},rerenderParser:function(a){try{this.ids[a].rerender()}catch(b){g.default(["letter-body","error",a])}},isCollapsed:function(){var a=this.get("collapsed");if(a==null){return this.is("collapsed-default")}return a},triggerBlockquoteChange:function(){this.broadcast("resize")},onBlockquoteToggle:function(){this.set("collapsed",!this.isCollapsed());this.triggerBlockquoteChange();this.applyDarkosha(true)},onLetterZoom:function(){this.broadcast("resize")}};exports.default=c.default.Block.extend(exports.blockSpec)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/todo-manager/todo-manager",["require","exports","data-source/actions","data-source/data-source","data-source/source/ui-layout","default-values","feast","helpers/data-source-dispatch","helpers/opener","pilotjs","service/auth","service/radars/index","ui-block/draggable/draggable","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/todo/todo"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TodoManager=exports.canTodoBeShown=void 0;b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);function o(a){var b=a===null||a===void 0?void 0:a.route;return b&&!b.is("#search")&&!b.is("#search-letter")}exports.canTodoBeShown=o;var p=function(e){__extends(p,e);function p(){var a=e.call(this)||this;a.todoIframe=null;a.handlePostMessage=a.handlePostMessage.bind(a);return a}p.prototype.getComponentsSpec=function(){return{router:{class:h.default,events:["routeend"]},"settings-dock":{class:m.default,attrs:{"can-toggle-todo":function(a){return a.canToggleTodo()},todo:function(a){return a.isActive()}},events:["todo:toggle"]},settings:{class:l.default,attrs:{"can-toggle-todo":function(a){return a.canToggleTodo()},todo:function(a){return a.isActive()}},events:["todo:toggle"]},draggable:{class:k.default,events:["drag:start","drag:end"]},todo:{class:n.default,events:["todo:mount","todo:unmount"]},dataSource:{class:b.default,events:["actionend"]}}};p.prototype.handleEvent=function(a){switch(a.type){case"todo:toggle":this.toggleTodo();return false;case"todo:mount":this.onTodoMount();return false;case"todo:unmount":this.onTodoUnmount();return false;case"drag:start":this.toggleEventsActive(false);return false;case"drag:end":this.toggleEventsActive(true);return false}};p.prototype.handlePostMessage=function(a){if(!a.data||!a.data.type){return}if(a.origin!==d.TODO_URL){return}var b=__assign({},a.data);switch(b.type){case"todo:start":this.sendMessageToTodo({type:"todo:email",email:i.default.user.getEmail()});return false;case"todo:open":this.openTodo(b.path);return false;case"todo:ready":this.showTodo();return false}};p.prototype.openTodo=function(a){g.default(""+d.TODO_URL+(a||""))};p.prototype.toggleEventsActive=function(a){var b=this.getTodoBlock();if(!b){return}b.set("eventsActive",a)};p.prototype.sendMessageToTodo=function(a){if(!this.todoIframe){return}this.todoIframe.contentWindow.postMessage(a,d.TODO_URL);return false};p.prototype.showTodo=function(){var a=this.getTodoBlock();if(!a){return}j.default(["todo_block_visible"]);a.set("visible",true)};p.prototype.onTodoMount=function(){window.addEventListener("message",this.handlePostMessage);var a=this.getTodoBlock();if(!a){return}this.todoIframe=a.refs["todoFrame"]};p.prototype.onTodoUnmount=function(){window.removeEventListener("message",this.handlePostMessage);this.todoIframe=null};p.prototype.canToggleTodo=function(){return d.SHOW_TODO_TOGGLE&&d.HIDE_TOYS===d.BL_PROP_NAME&&o(this.get("router"))&&this.isSupportTodo()};p.prototype.getUILayout=function(){return this.get("router.model.uiLayout")||c.defaults};p.prototype.isActive=function(){return this.getUILayout().todo};p.prototype.isSupportTodo=function(){return this.getUILayout().supportTodo};p.prototype.toggleTodo=function(){f.default({type:a.TOGGLE_TODO})};p.prototype.getTodoBlock=function(){return this.get("todo")};return p}(e.default.Mediator);exports.TodoManager=p;exports.default=e.default.Mediator.createFromClass("todo-manager",p)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/layout-manager",["require","exports","@mail/flags","@mail/xray","data-source/actions","data-source/data-source","data-source/index","data-source/source/ui-layout","default-values","feast","helpers/data-source-dispatch","mediator/layout-manager/utils","mqmatch","pilotjs","service/adv/index","service/promo","service/radars/index","service/storage","service/vkMessengerLoader","trackJS","ui-block/ad-feedback/ad-feedback","ui-block/application-mail/application-mail","ui-block/attach-list/attach-list","ui-block/contextmenu-folder/contextmenu-folder","ui-block/contextmenu-message/contextmenu-message","ui-block/discounts/discounts","ui-block/dropdown-actions/dropdown-actions","ui-block/filters/filters","ui-block/headline/headline","ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder","ui-block/layer-window/layer-window","ui-block/layout/layout","ui-block/letter-body/letter-body","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-tip/list-letter-tip","ui-block/list-letter-welcome/list-letter-welcome","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions","ui-block/metathread/metathread","ui-block/metathread-footer/metathread-footer","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded","ui-block/noads-button/noads-button","ui-block/octopus/octopus","ui-block/paginator-container/paginator-container","ui-block/portal-menu/portal-menu","ui-block/promo-block-letter/promo-block-letter","ui-block/renovator/renovator","ui-block/search-panel/search-panel","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/sidebar-folders/sidebar-folders","ui-block/slot/slot","ui-block/thread/thread","utils/util","../lazy.modules","./layout-manager/vars","./todo-manager/todo-manager"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.layoutManager=exports.getColumnContentWidth=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);h=__importDefault(h);i=__importDefault(i);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importStar(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);var da="(min-width: 1200px) and (max-width: 1260px) and (min-height: 800px)";var ea=k.createMediaQueryMatch();var fa=true;var ga=false;var ha=15;var ia=13;var ja=0;var ka=58;var la=58;var ma=68;var na=63;var oa=70;var pa=ba.columnSidebarM;var qa=ba.columnSidebarXl;var ra=60;var sa=4;var ta=8;var ua="octavius-custom-layout";function va(a,b){return b.get("id")==="portal"?a._getDefaultColumnRight():a.columnRight}function wa(a){return sa*a}exports.getColumnContentWidth=wa;function xa(a){return wa(a)}function ya(a){if(a===0){return 0}return a*sa+ta}function za(a){var b=document.createElement("div");try{for(var c=0,d=a;c<d.length;c++){var e=d[c];b.style.display=e;if(b.style.display===e){return{value:e,error:""}}}}catch(a){return{value:"",error:a}}return{value:"",error:""}}var Aa=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--vkui--octavius_size_layout_width_min--regular"))||0;var Ba=function(h){__extends(k,h);function k(){var d=h.call(this)||this;d.size="m";d.verticalSize="m";d.maxWidth=1260;d.adv160ColumnRight=undefined;d.adv160ColumnRight3pane=undefined;d.columnRight=ra;d.defaultColumnRight=ra;d.columnSidebar=oa;d.columnRightSidebar=false;d.support3pane=true;d.supportTodo=false;d.supportSticky=true;d.supportHeadline=true;d.supportComposeExtend=true;d.paymentDieWithIndentOn3Pane=false;d.searchSuggestCount=5;d.forceShortcuts=false;d.performanceTrace="track";d.updateCustomColumnsDebounced=_.default.debounce(d.updateCustomColumns,g.RESIZE_UPDATE_DEBOUNCE_TIME,d);d._createMedia();d._registerQueries();window.addEventListener("resize",d.updateCustomColumnsDebounced.bind(d,true));d.updateAll();var f=za(["-ms-grid","grid"]);if(!f.value){b.default.send("no-grid-support",g.NO_CSS_GRID_LOG_KAKTAM&&{rlog:"octavius-no-grid-support",rlog_message:{"octavius-no-grid-support":true,error:f.error}})}e.default.one("actionend",function(){var b=a.default.get("octavius");var e=a.default.get("ignore-ponymode-experiment");var f=b&&b.isActive()&&b.getCount("show");var g=d.getUiLayout();var h=g.ponyMode;if(e&&e.state){return}if(!f){return}if(h){e.save({state:true});return}if(d.maxWidth>1420){e.save({state:true});return}i.default({type:c.TOGGLE_PONY_MODE});e.save({state:true});o.default("force_ponymode")});d.getType()==="2pane"?m.default.setActiveListPlacement("list2pane"):m.default.setActiveListPlacement("list3pane");return d}k.prototype.getComponentsSpec=function(){var a=this;return{router:{class:l.default,events:["route"]},layout:{class:D.default,attrs:{type:function(a){return a.getType()},size:function(a){return a.size},mobile:function(a){return a.isLessThen("xs")},isMoreThen:function(a){return a.isMoreThen},isLessThen:function(a){return a.isLessThen},"left-column":function(a){return a.getLeftColumn()},"right-column":function(a,b){return va(a,b)},"sidebar-column":function(a){return a.getSidebarColumn()},"support-compose-extend":function(a){return a.supportComposeExtend},"hide-ads":function(a){return a.getUiLayout().hideAds},"show-todo":function(a){return a.showTodo()},"is-shortcut-left":function(a){return a.getLeftColumn()<=g.SHORTCUT_LEFT_COLUMN_LIMIT},"max-width":function(){return g.MAX_LAYOUT_WIDTH},"is-advert-scroll":function(){return g.ADVERT_SCROLL}},events:[D.LayoutEvents.LayoutResize],handleEvent:"handleLayoutEvent"},"application-mail":{class:t.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"portal-menu":{class:R.default,attrs:{layoutType:function(a){return a.getType()},"small-search":function(a){return a.isLessThen("s")},mobile:function(a){return a.isLessThen("xs")},"search-column":function(a){return xa(a._getDefaultColumnRight())},"right-column":function(a){return a._getColumnRight()},"main-column":function(a){return a.getMainColumn()}}},"settings-dock":{class:W.default,events:["layout:toggle","shortcuts:toggle"],attrs:{type:function(a){return a.getType()},support3pane:function(a){return a.support3pane},"can-toggle-shortcuts":function(a){return a.canToggleShortcuts()},"manual-shortcuts":function(a){return a.getUiLayout().manualShortcuts}}},settings:{class:V.default,events:["layout:toggle","shortcuts:toggle","todo:toggle"],attrs:{type:function(a){return a.getType()},support3pane:function(a){return a.support3pane},"can-toggle-shortcuts":function(a){return a.canToggleShortcuts()},"manual-shortcuts":function(a){return a.getUiLayout().manualShortcuts}}},filters:{class:z.default,events:["layout:toggle","shortcuts:toggle"],attrs:{type:function(a){return a.getType()},support3pane:function(a){return a.support3pane},"sidebar-column":function(a){return a.getSidebarColumn()},"can-toggle-shortcuts":function(a){return a.canToggleShortcuts()},"manual-shortcuts":function(a){return a.getUiLayout().manualShortcuts}}},headline:{class:A.default,attrs:{enabled:function(a){return a.supportHeadline}}},letter:{lazy:aa.lazyUILetter,attrs:{"sticky-reduce-all-texts":function(a){return a.getMainColumn()<200},"sticky-reduce-one-text":function(a){return a.getMainColumn()<230},"sticky-reduce-reply":function(a){return g.NEW_LETTER_LIST&&a.getMainColumn()<160},"sticky-position":function(a){var b={};var c=1;var d=8;var e=a.columnRight*sa+d;var f=a.getLeftColumn()*sa+c;if(a.getType()==="3pane"){f=(a.getLeftColumn()+a.getSidebarColumn())*sa+c}if(a.maxWidth>g.MAX_LAYOUT_WIDTH){b.maxWidth=g.MAX_LAYOUT_WIDTH-f-e}b.left=f;b.right=e;return b},mobile:function(a){return a.isLessThen("xs")}}},"letter-swipe-actions":{class:F.default,attrs:{"layout-size":function(a){return a.size},"layout-type":function(a){return a.getType()}}},"metathread-head-compact-expanded":{class:N.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"layer-confirm-clear-folder":{class:B.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"layer-window":{class:C.default,attrs:{mobile:function(a){return a.isLessThen("xs")},slim:function(a){return a.isLessThen("s")}}},"layer-sent-page":{attrs:{slim:function(a){return a.isLessThen("s")}}},"letter-body":{class:E.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"list-letter-tip":{class:I.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"list-letter-compact":{class:H.default,attrs:{"payment-die-with-indent":function(a){return a.paymentDieWithIndentOn3Pane},"layout-type":function(a){return a.getType()}}},"list-letter-common":{class:G.default,attrs:{"layout-type":function(a){return a.getType()}}},metathread:{class:L.default,attrs:{"short-text":function(a){return a.isLessThen("m")},"short-dropdown":function(a){return a.isShortColumn()}}},"dropdown-actions":{class:y.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"context-menu":{class:v.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},octopus:{class:P.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"metathread-footer":{class:M.default,attrs:{"short-text":function(a){return a.isShortColumn()}}},"attach-list":{class:u.default,attrs:{"save-to-cloud":function(a){return a.isMoreThen("xxs")},mobile:function(a){return a.isLessThen("xs")}}},"search-panel":{class:U.default,attrs:{leftColumn:function(a){return a.getLeftColumn()},rightColumn:function(a){return xa(a._getDefaultColumnRight())},layoutType:function(a){return a.getType()},size:function(a){return a.size},maxWidth:function(){return g.MAX_LAYOUT_WIDTH},onlyIcon:function(a){return a.isLessThen("s")}}},slot:{class:Y.default,attrs:{"right-column":function(a){return wa(a.columnRight)}}},"noads-button":{class:O.default,attrs:{isSmallAdvColumnRight:function(b){return g.ADV_160_ON_SMALL_WIDTH?b.columnRight===a._getAdv160ColumnRight():false},"right-column":function(a){return wa(a.columnRight)}}},"ad-feedback":{class:s.default,attrs:{"right-column":function(a){return wa(a.columnRight)}}},thread:{class:Z.default,attrs:{"sticky-disabled":function(a){return!a.supportSticky},mobile:function(a){return a.isLessThen("xs")}}},"promo-block-letter":{class:S.default,attrs:{support3pane:function(a){return a.support3pane}}},"list-letter-welcome":{class:J.default,attrs:{type:function(a){return a.getType()},ponyMode:function(a){return a.getUiLayout().ponyMode}}},"list-letter-welcome-suggestions":{class:K.default,attrs:{ponyMode:function(a){return a.getUiLayout().ponyMode}}},"sidebar-folders":{class:X.default,attrs:{size:function(a){return a.size},layoutType:function(a){return a.getType()}}},"paginator-container":{class:Q.default,attrs:{type:function(a){return a.getType()},"right-column":function(a){return ya(a._getColumnRight())},"left-column":function(a){return ya(a._getColumnLeft())},"sidebar-column":function(a){return a.getSidebarColumn()*sa},"max-breakpoint":function(a){return a.maxBreakpoint},"right-offset":function(a){return a._getRightOffset()}}},renovator:{class:T.default,attrs:{type:function(a){return a.getType()}}},discounts:{class:x.default,attrs:{width:function(a){if(a.getType()==="3pane"&&a.getSidebarColumn()<ba.columnSidebarM){return"small"}return"default"}}},"vk-messenger-provider":{attrs:{offset:function(a){return ya(a._getColumnRight())}}},"data-source":{class:d.default,events:["actionend"]},"contextmenu-message":{class:w.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}}}};k.prototype.isVertical=function(a){return a===this.verticalSize};k.prototype.isShortColumn=function(){return this.getSidebarColumn()===oa&&this.getType()==="3pane"};k.prototype.isMoreThen=function(a){return ba.sizes.indexOf(this.size)>ba.sizes.indexOf(a)};k.prototype.isLessThen=function(a){return ba.sizes.indexOf(this.size)<ba.sizes.indexOf(a)};k.prototype.getLeftColumn=function(){var a,b;var c="main";return(b=(a=this.customLayout[c])===null||a===void 0?void 0:a.left)!==null&&b!==void 0?b:this.columnLeft};k.prototype.getSidebarColumn=function(){var a,b;var c="main";return(b=(a=this.customLayout[c])===null||a===void 0?void 0:a.sidebar)!==null&&b!==void 0?b:this.columnSidebar};k.prototype.getMainColumn=function(){if(this.getType()==="3pane"){return this.getCurrentLayoutWidth()-this.getSidebarColumn()-this.getLeftColumn()-this.columnRight}else{return this.getCurrentLayoutWidth()-this.getLeftColumn()-this.columnRight}};k.prototype.canToggleShortcuts=function(){return!this.forceShortcuts&&!g.USER_LAYOUT_RESIZE};k.prototype.getType=function(){return this.getUiLayout().type==="3pane"&&this.support3pane?"3pane":"2pane"};k.prototype._getAdv160ColumnRight=function(){if(this.adv160ColumnRight!==undefined){return this.adv160ColumnRight}return this.getType()==="3pane"?this.adv160ColumnRight3pane:undefined};k.prototype._getDefaultColumnRight=function(){if(g.ADV_160_ON_SMALL_WIDTH){var a=this._getAdv160ColumnRight();if(a){return a}}return this.defaultColumnRight};k.prototype._getColumnRight=function(){var a=this._getDefaultColumnRight();if(this.getUiLayout().hideAds&&this.showTodo()){return a}if(this.getUiLayout().hideAds){return 0}return a};k.prototype.hideAds=function(){var a=this.get("router.route");var b=!a||a.is("#search")||a.is("#search-letter")&&this.isMoreThen("s")&&this.getType()==="3pane";var c=this.getUiLayout().hideAds;return!b&&c};k.prototype.showTodo=function(){return this.getUiLayout().todo&&ca.canTodoBeShown(this.get("router"))&&this.supportTodo&&g.SHOW_TODO_TOGGLE};k.prototype.handleMedia=function(a){var b=this;a=a===void 0?this._query:this._query=a;this.updateQuery(a);if(!fa){Promise.all([i.default({type:c.UPDATE_LAYOUT_SUPPORT_3_PANE,value:this.support3pane},{waitForAppLoad:true}),i.default({type:c.UPDATE_LAYOUT_SUPPORT_TODO,value:this.supportTodo},{waitForAppLoad:true})]).then(function(){b.updateAll()});return}f.changeSupport3Pane(this.support3pane);f.changeSupportTodo(this.supportTodo);fa=false;this.updateCustomColumnsDebounced(true);this.updateAll()};k.prototype._logMediaQueryRace=function(a){var c;ga=true;b.default.send("media-query-race",{i:(c={},c[a]=1,c)});var d=g.MATCH_MEDIA_LOG?JSON.stringify({queries:ea.getCurrentSnapshot(),width:window.innerWidth,height:window.innerHeight}):"nolog";r.default.addErrorFromApp(new Error("media-query-race: "+a+", "+d),"media-query-race")};k.prototype.updateQuery=function(a){var c=this;if(!this.media){this._logMediaQueryRace("nomedia");this._createMedia();this._registerQueries();return}var d=this.media[a];if(!d){this._logMediaQueryRace("noeffects");if(this.media[da]){this.updateQuery(da)}return}if(ga){ga=false;b.default.send("media-query-race",{i:{ok:1}})}var e=d.size;var f=this.size;if(e&&f&&e!==f){o.default(["on_layout_resize",e])}if(!f){o.default(["user_visit_size",e]);if(d.maxBreakpoint){o.default(["user_visit_size_max"])}}this.support3pane=d.support3pane;this.supportTodo=d.supportTodo;this.mediaKeys.forEach(function(a){var b=d[a];if(!(b instanceof Function)){c[a]=b}});var g=["forceShortcuts"];g.forEach(function(a){var b=d[a];c[a]=b instanceof Function?b(c):b});this.mediaKeys.forEach(function(a){var b=d[a];if(b instanceof Function&&!g.includes(a)){c[a]=b(c)}});if((f==="xs"||f==="xxs")&&window.__appTimers.ready_app){delete window.__appTimers.ready_app}this.updateCustomColumns()};k.prototype.setLayout=function(a){var b=this;if(!(a==="2pane"||a==="3pane")){return}a==="2pane"?m.default.setActiveListPlacement("list2pane"):m.default.setActiveListPlacement("list3pane");o.default(["on_layout_change",a]);i.default({type:c.UPDATE_LAYOUT_TYPE,value:a}).then(function(){b.handleMedia();n.default.update()})};k.prototype.handleEvent=function(a){var b=this;var d=a.type;var e=a.details;var f=e&&e.from;switch(d){case"layout:toggle":{var g=this.getUiLayout();var h=g.type;var j=h==="3pane"?"2pane":"3pane";o.default({type:"toggle-layout-"+j,intervals:[[""+f,1]]});this.setLayout(j);return false}case"shortcuts:toggle":{var k=!this.get("router.model.uiLayout").manualShortcuts;o.default({type:"toggle-shortcuts-"+(k?"on":"off"),intervals:[[""+f,1]]});i.default({type:c.TOGGLE_FOLDER_SHORTCUTS}).then(function(){b.handleMedia();n.default.update()});return false}case"route":{this.updateQuery(this._query);return false}case"actionend":return this.onDataSourceActionEnd(a)}};k.prototype.getCurrentLayoutWidth=function(){var a=j.clamp(Aa,window.innerWidth,g.MAX_LAYOUT_WIDTH);return a/sa};k.prototype.storeLayoutWidth=function(a){this.layout["main"]=a;if(g.USER_LAYOUT_SAVE_TO_STORAGE){p.default.set(ua,__assign(__assign({},p.default.get(ua)),this.layout))}this.customLayout["main"]=a};k.prototype.getLayouts=function(a){var b=a===void 0?{}:a,c=b.id;return this.getList("layout").filter(function(a){return c==null||a.get("id")===c})};k.prototype.applyLayoutWidth=function(a,b){var c=b.storeValue,d=b.showResizeState,e=b.onlyId;this.customLayout["main"]=a;this.columnLeft=a.left;var f=this.getLayouts({id:e});f.forEach(function(b){b.onResize(a,d)});if(c){this.storeLayoutWidth(a)}};k.prototype.updateCustomColumns=function(a){if(a===void 0){a=false}if(this.layout["main"]){this.updateCustomColumn(this.layout["main"])}if(a){this.updateAll()}};k.prototype.getSizeLimits=function(){var a=j.defaultMinSizes.left;if(g.DISABLE_LEFT_COLUMN&&this.isLessThen("xs")){a=ja}else if(this.getUiLayout().ponyMode){a=ia}return{min:__assign(__assign({},j.defaultMinSizes),{left:a}),max:j.defaultMaxSizes}};k.prototype.updateCustomColumn=function(a,b){var c=b===void 0?{}:b,d=c.storeValue,e=d===void 0?false:d,f=c.snapToRecommendedSize,h=f===void 0?true:f,i=c.showResizeState,k=i===void 0?false:i,l=c.shouldUpdate,m=c.onlyId;var n=this.getSizeLimits(),o=n.min,p=n.max;var q={left:this.getLeftColumn(),sidebar:this.getSidebarColumn()};var r={left:a.left||this.getLeftColumn(),sidebar:a.sidebar||this.getSidebarColumn()};var s={minSizes:__assign(__assign({},o),{right:this.columnRight}),maxSizes:__assign(__assign({},p),{right:this.columnRight})};var t=this.getType()==="3pane";var u=t?j.limitWidths3pane:j.limitWidths2pane;var v=u(r,this.getCurrentLayoutWidth(),s);if(h){v.left=j.transformSizes(v,{left:function(a){return j.snapToMinSize(a,g.SHORTCUT_LEFT_COLUMN_LIMIT,o.left)}},this.getType()).left}if(l&&!l(q,v)){return}this.applyLayoutWidth(t?j.pick(v,["left","sidebar"]):j.pick(v,["left"]),{storeValue:e,showResizeState:k,onlyId:m})};k.prototype.handleLayoutEvent=function(a){var c;switch(a.type){case D.LayoutEvents.LayoutResize:{var d=a.details;var e=d.width/sa;this.updateCustomColumn((c={},c[d.column]=e,c),{storeValue:true,snapToRecommendedSize:d.resizeEnd,showResizeState:!d.resizeEnd,shouldUpdate:function(a,b){if(d.column==="sidebar"&&b.left<a.left){return false}if(d.column==="sidebar"&&e>a.sidebar&&b.sidebar<a.sidebar){return false}return true}});if(d.resizeEnd){this.getLayouts().forEach(function(a){a.onResizeEnd()});if(g.USER_LAYOUT_ENABLE_METRICS){b.default.send("resize_layout_column_"+d.column)}}return d.resizeEnd}}return false};k.prototype.onDataSourceActionEnd=function(a){var b=a.details;if(b.action.type===c.TOGGLE_TODO){this.handleMedia();return true}return false};k.prototype._registerQueries=function(){var a=this;Object.keys(this.media).forEach(function(a){ea.register(a,"screen and "+a)});var b=function(b){var c=b.filter(function(b){return a.media[b]});a.handleMedia(c[0])};b(ea.getCurrentMatches());ea.on("change",b)};k.prototype.getUiLayout=function(){return this.get("router.model.uiLayout")||f.defaults};k.prototype.shortcutsEnabled=function(a){return this.forceShortcuts&&!a||this.getUiLayout().manualShortcuts};k.prototype._getShortColumnLeft=function(){var a=this.getUiLayout();if(a.ponyMode){return ia}return ha};k.prototype._getColumnLeft=function(){var a=this.get("router.route");var b=!a||a.is("#search");var c=this.getUiLayout();if(g.DISABLE_LEFT_COLUMN&&this.isLessThen("xs")){return ja}if(this.shortcutsEnabled(b)){return this._getShortColumnLeft()}if(c.ponyMode){return la}return ka};k.prototype._getRightOffset=function(){return q.vkMessengerLoader.isOpen()?72:8};k.prototype._createMedia=function(){var a;var b=this;if(this.media){return}this.layout=g.USER_LAYOUT_SAVE_TO_STORAGE?p.default.get(ua)||{}:{};this.customLayout={};var c=this._getColumnLeft.bind(this);var d=this._getColumnRight.bind(this);var e=(a={},a["(max-width: "+g.XXS_BREAKPOINT+"px)"]={size:g.ENABLE_XXS_BREAKPOINT?"xxs":"xs",maxWidth:g.XXS_BREAKPOINT,columnLeft:c,columnRight:d,defaultColumnRight:0,columnRightSidebar:true,support3pane:false,supportTodo:false,supportSticky:false,supportHeadline:true,supportComposeExtend:false,forceShortcuts:true,searchSuggestCount:3},a["(min-width: "+g.XXS_BREAKPOINT+"px) and (max-width: 960px)"]={size:"xs",maxWidth:960,columnLeft:c,columnRight:d,defaultColumnRight:0,columnRightSidebar:true,support3pane:false,supportTodo:false,supportSticky:true,supportHeadline:true,supportComposeExtend:false,forceShortcuts:true,searchSuggestCount:3},a["(min-width: 960px) and (max-width: 1140px)"]={size:"s",maxWidth:1200,columnLeft:c,columnRight:d,adv160ColumnRight:40,defaultColumnRight:ra,columnRightSidebar:false,support3pane:false,supportTodo:false,supportSticky:true,supportHeadline:true,supportComposeExtend:false,forceShortcuts:true,searchSuggestCount:3},a["(min-width: 1140px) and (max-width: 1200px)"]={size:"s",maxWidth:1200,columnLeft:c,columnRight:d,adv160ColumnRight:40,defaultColumnRight:ra,columnRightSidebar:false,support3pane:false,supportTodo:false,supportSticky:true,supportHeadline:true,supportComposeExtend:true,forceShortcuts:true,searchSuggestCount:5},a["(min-width: 1200px) and (max-width: 1260px)"]={size:"m",maxWidth:1260,columnLeft:c,columnRight:d,adv160ColumnRight:40,defaultColumnRight:ra,columnSidebar:oa,columnRightSidebar:false,support3pane:true,supportTodo:false,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:false,searchSuggestCount:5,forceShortcuts:function(a){return a.getType()==="3pane"}},a["(min-width: 1260px) and (max-width: 1420px)"]={size:"m",maxWidth:1420,columnLeft:c,columnRight:d,adv160ColumnRight3pane:40,defaultColumnRight:ra,columnSidebar:pa,columnRightSidebar:false,support3pane:true,supportTodo:function(a){return a.getType()!=="3pane"},supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5,forceShortcuts:function(a){return a.getType()==="3pane"}},a["(min-width: 1420px) and (max-width: 1600px)"]={size:"l",maxWidth:1600,columnLeft:c,columnRight:d,defaultColumnRight:ra,columnSidebar:pa,columnRightSidebar:false,support3pane:true,supportTodo:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a["(min-width: 1600px) and (max-width: 1800px)"]={size:"l",maxWidth:1800,columnLeft:c,columnRight:d,defaultColumnRight:ra,columnSidebar:pa,columnRightSidebar:false,support3pane:true,supportTodo:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a["(min-width: 1800px) and (max-width: 1920px)"]={size:"xl",maxWidth:1920,columnLeft:function(a){var c=b.getUiLayout();if(b.shortcutsEnabled()){return b._getColumnLeft()}if(c.ponyMode){return a.getType()==="3pane"?la:na}return a.getType()==="3pane"?ka:ma},columnRight:d,defaultColumnRight:ra,columnSidebar:qa,columnRightSidebar:false,support3pane:true,supportSticky:true,supportTodo:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a["(min-width: 1920px) and (max-width: "+g.MAX_LAYOUT_WIDTH+"px)"]={size:"xxl",maxWidth:g.MAX_LAYOUT_WIDTH,columnLeft:function(){var a=b.getUiLayout();if(b.shortcutsEnabled()){return b._getColumnLeft()}if(a.ponyMode){return na}return ma},columnRight:d,defaultColumnRight:60,columnSidebar:100,columnRightSidebar:false,support3pane:true,supportTodo:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,searchSuggestCount:5},a["(min-width: "+g.MAX_LAYOUT_WIDTH+"px)"]={size:"xxl",maxBreakpoint:true,maxWidth:Infinity,columnLeft:function(){var a=b.getUiLayout();if(b.shortcutsEnabled()){return b._getColumnLeft()}if(a.ponyMode){return na}return ma},columnRight:d,defaultColumnRight:ra,columnSidebar:qa,columnRightSidebar:false,support3pane:true,supportTodo:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a);var f={"(max-height: 670px)":{verticalSize:"s",searchSuggestCount:3},"(min-height: 670px) and (max-height: 800px)":{verticalSize:"l",searchSuggestCount:3},"(min-height: 800px)":{verticalSize:"l",searchSuggestCount:5}};var h={};function i(a){return new Set(Object.values(a).flatMap(Object.keys))}var j=i(e);i(f).forEach(function(a){j.add(a)});Object.keys(e).forEach(function(a){Object.keys(f).forEach(function(b){h[a+" and "+b]=Object.assign({},e[a],f[b])})});this.media=h;this.mediaKeys=j};return k}(h.default.Mediator);exports.layoutManager=h.default.Mediator.createFromClass("layout-manager",Ba);exports.default=exports.layoutManager});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/compose",["require","exports","data-source/index","default-values","helpers/create-message-form-data","helpers/signature","logger","mail/Message","mediator/layout-manager","service/radars/index"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i=e.default.getScope("compose.mail.ru");var j;var k;var l;function m(){if(!b.RENDER_COMPOSE_TO_BODY_START){return document.body}var a=document.createElement("div");var c=document.body;var d=c.firstChild;if(d){c.insertBefore(a,d)}else{c.appendChild(a)}return a}function n(a,b,c){k=new a({items:[],router:app,layout:g.default});b.register(k);c.register(k);if(!l){l=m()}k.renderTo(l);return k}var o=function(a){return new Promise(function(b){window.require(a,b)})};function p(){!j&&(j=new Promise(function(a){Promise.all([new Promise(function(a,b){require(["service/auth"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mail/MessageFormData"],a,b)}).then(__importStar),new Promise(function(a,b){require(["ui-block/compose-windows/compose-windows"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/compose-manager"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/pony-mode"],a,b)}).then(__importStar),new Promise(function(a,b){require(["suggests/data-source"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mail/Contact"],a,b)}).then(__importStar),new Promise(function(a,b){require(["service/compose-validators"],a,b)}).then(__importStar),o(["compose.mail.ru"])]).then(function(b){a({authService:b[0].default,MessageFormData:b[1].default||b[1],view:n(b[2].default,b[3].default,b[4].default),ui:b[8]})})}));return j}var q={open:function(a){var c=this;return p().then(function(d){var e=a.mode;if(b.COMPOSE_USER_LOADING_DISABLED||e==="template"){var f=d.authService.user;return c._open(__assign({user:f,tools:d},a))}else{return d.authService.loadUser().then(function(b){return c._open(__assign({user:b,tools:d},a))})}})},_open:function(b){var e=this;var g=b.user,j=b.mode,k=b.tools,l=b.source,m=b.forward,n=b.correspondents,o=b.model,p=b.body,q=b.subject,r=b.additionalOptions;var s=d.getHTMLSignature(g);var t=a.default.getData(),u=t.collectors,v=t.aliases;h.default(["compose_open",j]);i.add("compose open mode",j);var w=c.getMessageFormDataOptions(),x=w.params,y=w.helpers;var z=new k.MessageFormData(x,y);var A=z.create({mode:j,source:l,forward:m,from:g.getEmail(),collectors:u,aliases:v,correspondents:n,signature:s,model:o,body:p,subject:q});return A.then(function(a){k.view.add(a,r);return a},function(){if(j==="draft"&&l){e.open({mode:l.mode,model:new f.default({id:l.id}),body:p,correspondents:n})}})},add:function(a,b){var c=b===void 0?{}:b,d=c.autosend,e=d===void 0?false:d,f=c.isDragAndDrop,g=c.dragAndDropItem;return p().then(function(b){b.view.add(a,{autosend:e,isDragAndDrop:f,dragAndDropItem:g});return a})},preload:function(){return p()},getView:function(){return k},onSent:function(a,b){return p().then(function(c){c.view.layerPromise=b;c.view.onSent(a);return a})},onFailSent:function(a,b){return p().then(function(c){c.view.onFailSent(a,b);return a})},isComposeActive:function(){if(k&&k.isMounted()){return k.is("active")}return false},insertHtml:function(a){var b=this.getView();b.insertHtml(a)}};exports.default=q});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/lastseenStrings",["require","exports","default-values","service/getModule"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);exports.default=function(c){return b.default("lastseen.strings").then(function(b){if(!c){return null}if(c.status_id!==a.LASTSEEN_SHOW_TIME_STATUS){return c}var d=b.default({unixTimestamp:c.timestamp});return __assign(__assign({},c),{status:d||c.status})})}});define("feast-tpl!app/feast-tpl!ui-block/lastseen/lastseen.html",["feast"],function(a){return a.smartParse('<div bem:elem="container">\n\t<fn:var name="text" value="{attrs.text}"/>\n\t<fn:var name="loading" value="{attrs.loading}"/>\n\t<fn:var name="ico" value="{_this.getIcon()}"/>\n\n\t<div fn:if="loading && !text" bem:elem="placeholder-text">\n\t\t<div qa:id="lastseen-placeholder" bem:elem="placeholder-string"></div>\n\t</div>\n\t<div fn:if="!loading && text" bem:elem="status">\n\t\t<span fn:if="ico" bem:elem="ico" bem:mod="lastseen">\n\t\t\t<bem:mod name="success" test="attrs.success"/>\n\t\t\t<b:ico name="{ico}" size="xs"/>\n\t\t</span>\n\t\t<span qa:id="lastseen-text" bem:elem="email">\n\t\t\t<bem:mod name="success" test="attrs.success"/>\n\t\t\t{text}\n\t\t</span>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/lastseen/lastseen.html")});define("feast-tpl!ui-block/lastseen/lastseen.html",["feast-tpl!app/feast-tpl!ui-block/lastseen/lastseen.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/lastseen/lastseen",["require","exports","default-values","feast","feast-tpl!./lastseen.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"lastseen",template:c.default,defaults:{loading:true,client:"",text:""},getIcon:function(){if(a.LASTSEEN_DISABLE_PLATFORM){return null}var b=this.get("client");return b==="web"?"laptop":"mobile"}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-correspondent/contextmenu-correspondent",["require","exports","@mail/xray","default-values","feast","feast-mod/avatar","feast-tpl!./contextmenu-correspondent.html","lazy.modules","service/compose","service/lastseenStrings","ui-block/avatar/avatar","ui-block/lastseen/lastseen","ui-block/list/list","ui-block/list-item/list-item","ui-block/spinner/spinner","../../helpers/opener","../../service/calls"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);var p=180;exports.default=c.default.Block.extend({name:"contextmenu-correspondent",template:e.default,blocks:{list:k.default,avatar:i.default,"list-item":l.default,spinner:m.default,lastseen:j.default},events:{"compose:to":"onComposeCreateTo","call:to":"onCallTo"},defaults:{type:"correspondent",model:null,isInAddressbook:false,checkingPossession:true,isShouldCheckPossession:b.IS_NEW_ADDRESSBOOK,lastSeen:{status:"",client_type:""},hideAddContactButton:b.HIDE_CONTEXTMENU_ADD_CONTACT_BUTTON,hideSearchButton:b.HIDE_CONTEXTMENU_SEARCH_BUTTON,extraDetails:{mobile:false}},didMount:function(){var a=this;require(["mediator/letters-actions","mediator/addressbook-manager"],function(b,c){b.default.register(a);c.default.register(a)});var b=this.refs["js-copy"];var c=this.get("model");b.setAttribute("data-clipboard-text",c.email);f.lazyClipboard().then(f.uniqCallback(this,function(c){a.clipboard=a.isMounted()?new c(b):null}))},getUserName:function(a){return a.name.length?a.name:a.email.split("@")[0]},didUnmount:function(){this.clipboard&&this.clipboard.destroy()},onShow:function(){var a=this;if(!b.IS_NEW_ADDRESSBOOK){return}var c=this.get("model");c.checkContactPossessing(c.email).then(function(d){var e=d.payload;var f=e.contacts[c.email];a.sendLastSeenRadars(f);if(!b.LAST_SEEN_V2_ENABLE||!f){a.set(__assign({isInAddressbook:e[c.email],checkingPossession:false},b.LAST_SEEN_ENABLE?{lastSeen:f}:{}));return}h.default(f).then(function(d){a.set({isInAddressbook:e[c.email],checkingPossession:false,lastSeen:d,isOnline:f.status_id===b.LASTSEEN_ONLINE_STATUS})})})},onBeforeHide:function(){this.clipboard&&this.clipboard.destroy()},onComposeCreateTo:function(a){var b=a.details;var c="default"in g.default&&"open"in g.default.default?g.default.default:g.default;c.open({correspondents:{to:[b]}})},canCallTo:function(a){return b.CALLS_P2P_OUTGOING&&o.default.getCallsAPIClient().canCallTo([a.email])[0].canCall},onCallTo:function(a){var b=a.details;var c=this.getLastseenKey(b);o.default.getCallsAPIClient().callTo([b.email],{lastSeenKey:c}).then(function(a){if(a.redirectUrl){n.default(a.redirectUrl)}})},isLastSeenPossible:function(){return b.LAST_SEEN_ENABLE||b.LAST_SEEN_V2_ENABLE},sendLastSeenRadars:function(c){var d=b.LAST_SEEN_ENABLE||b.LAST_SEEN_V2_ENABLE;if(d){a.default.send("lastseen-"+((c===null||c===void 0?void 0:c.status_id)?"status":"empty"),{skipdwh:true})}if(b.LAST_SEEN_V2_ENABLE){a.default.send("lastseen-v2-contextmenu-"+((c===null||c===void 0?void 0:c.status_id)?"status":"empty"),{skipdwh:true})}},getHighResolutionAvatar:function(a){if(!this.isLastSeenPossible()&&a){return a.avatars.default}return a&&d.avatarUrl(a.email,a.name,p)},getLastseenKey:function(c){if(!b.LAST_SEEN_ENABLE&&!b.LAST_SEEN_V2_ENABLE){return}var d=this.get("lastSeen");var e=""+Date.now()+Math.floor(Math.random()*1e4);a.default.send("lastseen-oncall",{dwh:{email:c.email,ls_key:e,ls_status:(d===null||d===void 0?void 0:d.status_id)||"empty",ls_platform:d===null||d===void 0?void 0:d.client_type}});return e}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/addressbook-manager",["require","exports","@mail/flags","actions/checkContactsPossessing","actions/lastSeen","data-source/actions","data-source/data-source","default-values","feast","pilotjs","RPC","service/layer","service/notify","ui-block/contextmenu-correspondent/contextmenu-correspondent","ui-block/widget/widget","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddressbookManager=void 0;a=__importDefault(a);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);var o={emails:[],promise:null};var p=function(){var b;var c=(b=a.default.get("octavius-tooltip-p2p-kitty"))===null||b===void 0?void 0:b.time;if(!c){return false}var d=Math.floor(Date.now()/1e3);return d-c<f.P2P_PROMO_SHOWN_RECENTLY};var q=function(g){__extends(q,g);function q(){return g!==null&&g.apply(this,arguments)||this}q.prototype.getComponentsSpec=function(){return{router:{class:h.default},dataSource:{class:e.default,events:["actionend"]},widget:{class:m.default,events:["addressbook:open"]},"contextmenu-correspondent":{class:l.default,events:["addressbook:addcontact","addressbook:opencontact"]},"compose-app":{lazy:n.lazyUIComposeApp,events:["addressbook:addcontact","addressbook:opencontact"],attrs:{getLastSeen:function(a){return a.getLastSeen}}},letter:{lazy:n.lazyUILetter,events:["addressbook:refetchcontacts"],attrs:{checkContactPossessing:function(a){return a.checkContactPossessing},getLastSeen:function(a){return a.getLastSeen}}}}};q.prototype.renderAddressbook=function(b){if(f.IS_NEW_ADDRESSBOOK){o.emails=[];j.default.open("addressbook",{router:this.get("router"),openEmail:b,callsPromo:p()},{"close-on-esc":false});if(f.CALLS_P2P_OUTGOING){var c=a.default.get("used-p2p-addressbook");if(!(c&&c.state)){c.save({state:true,time:true})}}}};q.prototype.handleEvent=function(a){var c=a.type,e=a.details;switch(c){case"actionend":{if(e.action.type!==d.NAVIGATE){return false}if(e.request.alias==="contacts"){this.renderAddressbook()}break}case"addressbook:open":{this.renderAddressbook();break}case"addressbook:addcontact":{i.default.call("ab/contacts/add",{contacts:[{nick:e.name,emails:[e.email]}]}).then(function(){k.default.add({text:i18n("Добавлен в адресную книгу")},e.scope?e.scope:"default");o.emails=o.emails.filter(function(a){return a!==e.email})});break}case"addressbook:refetchcontacts":{if(f.IS_NEW_ADDRESSBOOK&&!f.PREFETCH_CORRESPONDENTS_DISABLE){o.emails=e;o.promise=b.checkContactsPossessing({emails:e})}break}case"addressbook:opencontact":{this.renderAddressbook(e.email);break}}return false};q.prototype.checkContactPossessing=function(a){var c=Array.isArray(a)?a:[a];if(c.every(function(a){return o.emails.includes(a)})&&o.promise){return o.promise}return b.checkContactsPossessing({emails:c})};q.prototype.getLastSeen=function(a,b){var d=b===void 0?{}:b,e=d.allowUseGarage,f=e===void 0?false:e;return c.fetchLastSeen({emails:a,only_memcache:!f})};return q}(g.default.Mediator);exports.AddressbookManager=q;exports.default=g.default.Mediator.createFromClass("addressbook-manager",q)});define("mediator/advert-manager",["exports","@mail/adman","default-values","feast","mediator/layout-manager","pilotjs","ui-block/advert-column/advert-column","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/promo-block-letter/promo-block-letter","ui-block/scrollable/scrollable","ui-block/settings/settings","ui-block/slot/slot","ui-block/spec-project-letter/spec-project-letter","utils/util"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(a);var o=z(c);var p=z(d);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}var A=0;var B=0;var C=0;var D=0;exports.default=o.default.Mediator.create("advert-manager",{components:{router:{class:q.default},settings:{class:v.default,events:["ponymode:toggle"]},"advert-column":{class:r.default,events:["adcolumn:mount"]},slot:{class:w.default},"spec-project-letter":{class:x.default,events:["specline:error","specline:render"]},"promo-block-letter":{class:t.default,events:["promoblockletter:render"]},"letter-list-item-adv":{class:s.default,events:["native:render"]},scrollable:{class:u.default,events:["scrollable:mount","scrollable:unmount","scrollable:advontop"]}},defaults:function a(){this.isSpeclineReqPending=false;this.nativeReqNumber=0;this.renderNative=function(){}},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"adcolumn:mount":this.didAdColumnMount();break;case"scrollable:mount":this.didScrollableMount(d);break;case"scrollable:unmount":this.didScrollableUnmount(d);break;case"native:render":this.renderNativeHandler(d);break;case"specline:render":this.renderSpeclineHandler(d);break;case"specline:error":this.hideNotEmptyBlock("letter-list-item-adv");break;case"scrollable:advontop":if(p.default.getType()==="2pane"){this.renderListAdv("list2pane")}break;case"ponymode:toggle":this.clearAdvCache();break;case"promoblockletter:render":this.hideEmptyBlock("spec-project-letter");break}},clearAdvCache:function a(){n.default.clearCache()},renderNativeHandler:function a(b){var c=this;var d=this.getBlock("spec-project-letter");var e=b.placement,f=b.placementRender;this.renderNative=function(){if(e.isForceFail()){f()}else{e.getBanner(true).then(function(a){var b=c.getBlock("letter-list-item-adv");if(a&&b){f(a)}}).catch(function(a){console.log(a)})}};if(!this.isSpeclineReqPending&&!d||!d.el.offsetHeight){this.renderNative()}},renderSpeclineHandler:function a(b){var c=this;var d=b.placement,e=b.placementRender;if(d.isForceFail()){return}this.isSpeclineReqPending=true;d.getBanner(false).then(function(a){c.isSpeclineReqPending=false;var b=c.getBlock("spec-project-letter");if(a&&a.html){c.hideNotEmptyBlock("letter-list-item-adv");c.hideEmptyBlock("promo-block-letter");var f=b.refs["spec-project-letter"];d.attachToContainer(f);d.wakeUp();e(a)}else{c.renderNative()}}).catch(function(a){c.isSpeclineReqPending=false;console.log(a)})},renderListAdv:function a(b){var c=this.getBlock("letter-list-item-adv");if(c){c.renderPlacement(b)}},getBlock:function a(b){var c=this.components[b].length;return this.components[b][c-1]},hideEmptyBlock:function a(b){var c=this.getBlock(b);if(c&&!c.el.offsetHeight){c.el.style.display="none"}},hideNotEmptyBlock:function a(b){var c=this.getBlock(b);if(c){c.el.style.display="none"}},didAdColumnMount:function a(){this.setInitialConf()},didScrollableMount:function a(c){var d=this;var e=c.scrollableElement,f=c.name;this.scrollableName=f;var g=y.default.debounce(function(a){d.handleScroll(a,f)},4);var h=y.default.debounce(function(){d.setInitialConf()},100);this.scrollUnsubscribe=function(){if(e){e.removeEventListener("scroll",g)}};this.initialSetterUnsubscribe=function(){window.removeEventListener("resize",h)};if(b.ADVERT_SCROLL&&e){e.addEventListener("scroll",g);window.addEventListener("resize",h);this.setInitialConf()}},didScrollableUnmount:function a(){this.scrollUnsubscribe();this.initialSetterUnsubscribe()},handleScroll:function a(c,d){var e=c.target.scrollTop;var f=this.get("router");var g=f.request.route;if(p.default.getType()==="3pane"){if(!b.ADVERT_SCROLL_CONF[2]&&(g&&g.is&&!g.is("#read-letter #search-letter")||d!=="dataset-letters")){this.executeScroll(e)}}else{this.executeScroll(e)}},executeScroll:function a(b){if(b>=0&&this.advBlock&&this.advBlock.el){var c=this.getScrollDelta(b);var d=this.getScrollDirection(b);this.scrollMethod({direction:d,scrollDelta:c})}},nativeScroll:function a(c){var d=c.direction,e=c.scrollDelta;this.advBlock.el.scrollBy(0,d*e*(b.ADVERT_SCROLL_CONF[0]/10))},cssScroll:function a(c){var d=c.direction,e=c.scrollDelta;var f=D+d*e*(b.ADVERT_SCROLL_CONF[0]/10);d===1?this.scrollToTop(f):this.scrollToBottom(f)},scrollToTop:function a(b){var c=this.getHeightDelta();if(D>=c){return}D=b<c?b:c;this.advBlock.el.style.top="-"+D+"px"},scrollToBottom:function a(b){if(D<=0){return}D=b>0?b:0;this.advBlock.el.style.top="-"+D+"px"},getScrollDirection:function a(){if(A>B&&C===1){C=-1}else if(A<B&&C===-1){C=1}else if(!C){C=1}return C},getScrollDelta:function a(b){A=B;B=b;return Math.abs(B-A)},getHeightDelta:function a(){var b=this.get("slot");return b.el.offsetHeight-this.advBlock.el.offsetHeight},setInitialConf:function a(){this.advBlock=this.get("advert-column");if(this.advBlock&&this.advBlock.el){D=0;this.advBlock.el.style.top="0";this.useCssScroll=b.ADVERT_SCROLL_CONF[2]&&this.scrollableName==="letter-content"||!this.advBlock.el.scrollBy;this.advBlock.set({"native-scroll":!this.useCssScroll,"css-scroll":this.useCssScroll});this.scrollMethod=this.useCssScroll?this.cssScroll:this.nativeScroll}}})});define("@mail/cross-url-sharing/index",["module","exports"],function(a,exports){"use strict";var b=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(c,d){"object"==(typeof exports==="undefined"?"undefined":b(exports))&&"undefined"!=typeof a?d(exports):"function"==typeof define&&define.amd?define("@mail/cross-url-sharing",["exports"],d):d((c="undefined"!=typeof globalThis?globalThis:c||self)["@mail/cross-url-sharing"]={})}(undefined,function(a){"use strict";var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function d(a,b){return a(b={exports:{}},b.exports),b.exports}var e=d(function(a,b){var c,d,e;Object.defineProperty(b,"__esModule",{value:!0}),b.Errors=b.AttachType=b.ParamsKeys=void 0,(c=b.ParamsKeys||(b.ParamsKeys={})).XEmail="x-email",c.FolderId="folder-id",c.BackUrl="back_url",(d=b.AttachType||(b.AttachType={})).Attach="attach",d.Cloud="cloud",d.CloudStock="cloud_stock",d.Temporary="temporary",(e=b.Errors||(b.Errors={})).Url="err_url",e.Host="err_host",e.Decode="err_decode_url",e.Ids="err_ids",e.AttachId="err_attach_id",e.MessageId="err_message_id",e.Email="err_email",e.BackUrl="err_back_url",e.FolderId="err_folder_id",e.AttachType="err_attach_type"});c(e);var f=e.Errors,g=e.AttachType,h=e.ParamsKeys,i=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.validateMessageId=b.validateAttachId=void 0;b.validateAttachId=function(a,b,c){var d=c.cloudAttachIdReg,f=c.temporaryAttachIdReg,g=c.attachIdReg,h=c.cloudStockAttachIdReg;switch(a){case e.AttachType.Cloud:return!!b.match(d);case e.AttachType.Temporary:return!!b.match(f);case e.AttachType.Attach:return!!b.match(g);case e.AttachType.CloudStock:return!!b.match(h);default:return!1}};b.validateMessageId=function(a,b,c){var d=c.commonMessageIdReg,f=c.temporaryMessageIdReg;switch(a){case e.AttachType.Cloud:case e.AttachType.Attach:case e.AttachType.CloudStock:return!!b.match(d);case e.AttachType.Temporary:return!!b.match(f);default:return!1}}});c(i),i.validateMessageId,i.validateAttachId;var j=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultRegExps=b.CloudStockAttachIdReg=b.AttachIdReg=b.TemporaryAttachIdReg=b.CloudAttachIdReg=b.TemporaryMessageIdReg=b.CommonMessageIdReg=b.AttachPathReg=b.URLPartsReg=void 0,b.URLPartsReg="^https:\\/?\\/?[^:/\\s]+\\/attaches\\/[\\w\\-.]+[^#?\\s]+.*?$",b.AttachPathReg="^(\\w+);(.*)",b.CommonMessageIdReg="^\\d{20}",b.TemporaryMessageIdReg="^\\w{32}$",b.CloudAttachIdReg="^\\/public\\/.*:\\w+:\\w+.\\w+$",b.TemporaryAttachIdReg="^\\w{16}",b.AttachIdReg="^\\w+;\\w+",b.CloudStockAttachIdReg="^\\w+:\\w+",b.defaultRegExps={attachesRegExps:{cloudAttachIdReg:b.CloudAttachIdReg,temporaryAttachIdReg:b.TemporaryAttachIdReg,attachIdReg:b.AttachIdReg,cloudStockAttachIdReg:b.CloudStockAttachIdReg},messageIdsRegExps:{commonMessageIdReg:b.CommonMessageIdReg,temporaryMessageIdReg:b.TemporaryMessageIdReg},urlPartsReg:b.URLPartsReg,attachPathReg:b.AttachPathReg}});c(j),j.defaultRegExps,j.CloudStockAttachIdReg,j.AttachIdReg,j.TemporaryAttachIdReg,j.CloudAttachIdReg,j.TemporaryMessageIdReg,j.CommonMessageIdReg,j.AttachPathReg,j.URLPartsReg;var k=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.prepareRegExps=void 0;b.prepareRegExps=function(a){var b=a.attachesRegExps,c=void 0===b?{}:b,d=c.cloudAttachIdReg,e=c.temporaryAttachIdReg,f=c.attachIdReg,g=c.cloudStockAttachIdReg,h=a.messageIdsRegExps,i=void 0===h?{}:h,k=i.commonMessageIdReg,l=i.temporaryMessageIdReg,m=a.urlPartsReg,n=a.attachPathReg;return{attachesRegExps:{cloudAttachIdReg:new RegExp(d||j.CloudAttachIdReg),temporaryAttachIdReg:new RegExp(e||j.TemporaryAttachIdReg),attachIdReg:new RegExp(f||j.AttachIdReg),cloudStockAttachIdReg:new RegExp(g||j.CloudStockAttachIdReg)},messageIdsRegExps:{commonMessageIdReg:new RegExp(k||j.CommonMessageIdReg),temporaryMessageIdReg:new RegExp(l||j.TemporaryAttachIdReg)},urlPartsReg:new RegExp(m||j.URLPartsReg),attachPathReg:new RegExp(n||j.AttachPathReg)}}});c(k),k.prepareRegExps;var l=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.generateCloudViewerUrl=void 0;var c=function a(b){var c,a=b.host,d=b.messageId,e=b.attachId,f=b.queryParams,g=encodeURIComponent("".concat(d,";").concat(e)),h=(c=f,Object.keys(c).map(function(a){return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(c[a]))}).join("&"));return"https://".concat(a,"/attaches/").concat(g,"?").concat(h)};b.generateCloudViewerUrl=function(a,b){var d,f=a.encodedAttachId,g=a.messageId,h=a.queryParams,l=a.host,m=void 0===l?"cloud.mail.ru":l,n=a.attachType,o=void 0===b?{}:b,p=o.validateIds,q=void 0===p||p,r=o.regExps,s=void 0===r?j.defaultRegExps:r;try{d=decodeURIComponent(f)}catch(a){return{result:null,error:e.Errors.Decode}}if(!h[e.ParamsKeys.XEmail])return{result:null,error:e.Errors.Email};if(q&&n){var t=(0,k.prepareRegExps)(s),u=t.attachesRegExps,v=t.messageIdsRegExps;if(!(0,i.validateAttachId)(n,d,u))return{result:null,error:e.Errors.AttachId};if(!(0,i.validateMessageId)(n,g,v))return{result:null,error:e.Errors.MessageId}}var w=h[e.ParamsKeys.BackUrl];if(w)try{h[e.ParamsKeys.BackUrl]=decodeURIComponent(w)}catch(a){}return{result:c({host:m,messageId:g,attachId:d,queryParams:h})}}});c(l),l.generateCloudViewerUrl;var m=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getAttachTypeByAttachId=void 0;b.getAttachTypeByAttachId=function(a,b){void 0===b&&(b=j.defaultRegExps);var c=(0,k.prepareRegExps)(b).attachesRegExps,d=c.cloudAttachIdReg,f=c.temporaryAttachIdReg,g=c.attachIdReg,h=c.cloudStockAttachIdReg;return a?a.match(d)?e.AttachType.Cloud:a.match(h)?e.AttachType.CloudStock:a.match(g)?e.AttachType.Attach:a.match(f)?e.AttachType.Temporary:null:null}});c(m),m.getAttachTypeByAttachId;var n=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.parseAttachDetails=void 0;b.parseAttachDetails=function(a,b){var c=a.match(b);return c?(c[0],{messageId:c[1],encodedAttachId:c[2]}):null}});c(n),n.parseAttachDetails;var o=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.parseUrl=void 0;b.parseUrl=function(a,b){if(!b.test(a))return null;var c=new URL(a),d=c.hostname,e=c.pathname,f=c.searchParams;return{host:d,attachPath:e.replace("/attaches/",""),queryParams:f}}});c(o),o.parseUrl;var p=d(function(a,c){var d=b&&b.__assign||function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){for(var e in b=arguments[c]){Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}}return a}).apply(this,arguments)};Object.defineProperty(c,"__esModule",{value:!0}),c.parseCloudViewerUrl=void 0;c.parseCloudViewerUrl=function(a,b){void 0===b&&(b=j.defaultRegExps);var c=(0,k.prepareRegExps)(b),f=c.attachPathReg,g=c.urlPartsReg,h=(0,o.parseUrl)(a,g);if(!h)return{result:null,error:e.Errors.Url};var i,l=h.host,p=h.attachPath,q=h.queryParams;try{i=decodeURIComponent(p)}catch(a){return{result:null,error:e.Errors.Decode}}var r=(0,n.parseAttachDetails)(i,f);if(null===r)return{result:null,error:e.Errors.Ids};var s=r.messageId,t=r.encodedAttachId,u=(0,m.getAttachTypeByAttachId)(t,b);if(!u)return{result:null,error:e.Errors.AttachType};var v=function(a){var b=a.get(e.ParamsKeys.XEmail),c=a.get(e.ParamsKeys.FolderId),f=a.get(e.ParamsKeys.BackUrl);return d(d({xEmail:b},c&&{folderId:c}),f&&{backUrl:f})}(q);return{result:d({attachType:u,host:l,messageId:s,encodedAttachId:t},v&&{queryParams:v})}}});c(p),p.parseCloudViewerUrl;var q=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.hasFolderId=void 0;b.hasFolderId=function(a){return"folder-id"in a}});c(q),q.hasFolderId;var r=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.validateCloudViewerUrl=void 0;b.validateCloudViewerUrl=function(a,b,c,d){void 0===d&&(d=j.defaultRegExps);var f=(0,k.prepareRegExps)(d),g=f.attachesRegExps,h=f.messageIdsRegExps,l=f.attachPathReg,m=f.urlPartsReg,p=(0,o.parseUrl)(a,m);if(!p)return{result:!1,error:e.Errors.Url};var r,s=p.host,t=p.attachPath,u=p.queryParams,v=c.correctHost,w=c.correctAttachId,x=c.correctMessageId,y=c.correctQueryParams;if(s!==v)return{result:!1,error:e.Errors.Host};try{r=decodeURIComponent(t)}catch(a){return{result:!1,error:e.Errors.Decode}}var z=(0,n.parseAttachDetails)(r,l);if(null===z)return{result:!1,error:e.Errors.Ids};var A=z.messageId,B=z.encodedAttachId;if(!(0,i.validateAttachId)(b,B,g)||B!==w)return{result:!1,error:e.Errors.AttachId};var C=(0,i.validateMessageId)(b,A,h);return A===x&&C?function(a,b,c){var d=a.get(e.ParamsKeys.XEmail),f=c[e.ParamsKeys.XEmail];if(f&&d!==f)return{result:!1,error:e.Errors.Email};var g=a.get(e.ParamsKeys.BackUrl),h=c[e.ParamsKeys.BackUrl];if(h&&g!==h)return{result:!1,error:e.Errors.BackUrl};if(b===e.AttachType.Temporary||!(0,q.hasFolderId)(c))return{result:!0};var i=a.get(e.ParamsKeys.FolderId),j=c[e.ParamsKeys.FolderId];return j&&i!==j?{result:!1,error:e.Errors.FolderId}:{result:!0}}(u,b,y):{result:!1,error:e.Errors.MessageId}}});c(r),r.validateCloudViewerUrl;var s=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getAttachTypeByAttachId=b.validateCloudViewerUrl=b.parseCloudViewerUrl=b.generateCloudViewerUrl=void 0,Object.defineProperty(b,"generateCloudViewerUrl",{enumerable:!0,get:function a(){return l.generateCloudViewerUrl}}),Object.defineProperty(b,"parseCloudViewerUrl",{enumerable:!0,get:function a(){return p.parseCloudViewerUrl}}),Object.defineProperty(b,"validateCloudViewerUrl",{enumerable:!0,get:function a(){return r.validateCloudViewerUrl}}),Object.defineProperty(b,"getAttachTypeByAttachId",{enumerable:!0,get:function a(){return m.getAttachTypeByAttachId}})});c(s);var t=s.getAttachTypeByAttachId,u=s.validateCloudViewerUrl,v=s.parseCloudViewerUrl,w=s.generateCloudViewerUrl;c(d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0})})),a.AttachType=g,a.Errors=f,a.ParamsKeys=h,a.generateCloudViewerUrl=w,a.getAttachTypeByAttachId=t,a.parseCloudViewerUrl=v,a.validateCloudViewerUrl=u,Object.defineProperty(a,"__esModule",{value:!0})})});define("@mail/cross-url-sharing",["@mail/cross-url-sharing/index"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/viewer",["require","exports","@mail/cross-url-sharing","@mail/xray","default-values","helpers/encode-uri-component","helpers/opener","helpers/querystring-add","mail/Attachment","service/auth","service/notify","utils/extension"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var k=null;function l(a){return a&&"get"in a&&typeof a.get==="function"}function m(a,b){if(c.CLOUD_VIEWER_FORCE){return"f"}if(a&&!c.CLOUD_VIEWER_TEMPORARY){return"t-"+c.CLOUD_VIEWER_GROUP}var d="";if(a&&c.CLOUD_VIEWER_TEMPORARY){d="-t"}var e=""+d;if(b&&c.CLOUD_VIEWER_GROUP){return"sg"+e+"-"+c.CLOUD_VIEWER_GROUP}if(!b&&c.CLOUD_VIEWER_GROUP){return"nsg"+e+"-"+c.CLOUD_VIEWER_GROUP}if(b){return"sng"+e}return"nsng"+e}function n(a){var c={};a.forEach(function(a){var b=a.getExtension();var d=j.extToPrimitiveKind[b]||"other";var e=a.get("type");var f=e+"_"+d;if(typeof c[f]==="undefined"){c[f]=0}c[f]++});Object.keys(c).forEach(function(a){b.default.send("exp-cloud-viewer_fa_"+a,{v:c[a],dwh:{count:c[a]}})})}function o(a){var b=true;if(c.CLOUD_VIEWER_FORCE){return b}var d=a.map(function(a){return new g.default({name:a.get("name"),type:a.get("type")})});if(d.length&&c.CLOUD_VIEWER_FILE_TYPES&&c.CLOUD_VIEWER_ATTACH_TYPES){b=!d.some(function(a){var b=a.getExtension();var d=j.extToPrimitiveKind[b]||"other";var e=a.get("type");return!c.CLOUD_VIEWER_FILE_TYPES.includes(d)||!c.CLOUD_VIEWER_ATTACH_TYPES.includes(e)});n(d)}else{b=false}return b}exports.default={open:function(b){var g=this;var h=b.attachment,i=b.message,j=b.msgId,k=b.router,m=b.modal,n=m===void 0?false:m,p=b.newWindow,q=p===void 0?false:p,r=b.attachmentId,s=r===void 0?"":r;var t=j||i.get("id");var u=i.get("folder");var v=s;if(!v){v=l(h)?h.get("id"):h.id}var w=l(h)?h.get("type"):h.type;if(!w){w=a.getAttachTypeByAttachId(v,{attachesRegExps:c.ATTACHES_ID_REG_EXPS})}var x=i.get("attaches.list");var y=d.default(v);var z=function(){if(!y){return Promise.reject(new Error("encodeURI error"))}};if(q){z();var A=o(x);this.openInNewWindow({folderId:u,messageId:t,encodedAttachId:y,router:k,isSupportCloudViewer:A,attachType:w});return Promise.resolve()}if(c.WEBVIEW&&!c.DISABLE_ATTACHES_OPENING){z();var B={back_url:k.request.href};var C=f.default("https://"+c.CLOUD_VIEWER_HOST+"/attaches/"+t+"%3B"+y,B);return e.default(C)}return new Promise(function(a){g.loadTools().then(function(b){var c=b[0];var d=new c({models:x,message:i,attachment:h,modal:n});d.renderTo(document.body);a(d)})})},openTemporary:function(b){var e=b.messageId,f=b.attachment,g=b.formData,h=b.router;var i=f.get("id");var j=d.default(i);var k=g.attachments;var l=o(k);if(!c.CLOUD_VIEWER_TEMPORARY){l=false}this.openInNewWindow({temporary:true,messageId:e,encodedAttachId:j,router:h,isSupportCloudViewer:l,attachType:a.AttachType.Temporary});return Promise.resolve()},openInNewWindow:function(d){var f=d.temporary,g=f===void 0?false:f,j=d.messageId,k=d.folderId,l=d.encodedAttachId,n=d.router,o=d.isSupportCloudViewer,p=d.attachType;var q=m(g,o);b.default.send("exp-cloud-viewer_"+q);var r={"folder-id":k,"x-email":h.default.user.getEmail(),cvg:q};if(o&&c.CLOUD_VIEWER_GROUP===c.CLOUD_VIEWER_GROUPS.CLOUD){var s={encodedAttachId:l,messageId:j,queryParams:r,host:c.CLOUD_VIEWER_HOST,attachType:p};var t={attachesRegExps:c.ATTACHES_ID_REG_EXPS,messageIdsRegExps:c.MESSAGES_ID_REG_EXP};var u={validateIds:!c.VIEW_URL_IDS_VALIDATE_DISABLE,regExps:t};var v=a.generateCloudViewerUrl(s,u),w=v.result,x=v.error;if(x){b.default.send("gen_viewer_url_fail",{i:x,rlog:"gen_viewer_url_fail",rlog_message:{project:"octavius",url:w,error:x,inputData:s,options:u}});i.default.error({text:i18n("Просмотр недоступен")});return}b.default.send("gen_viewer_url_ok");e.default(w);return}window.open(n.getUrl(g?"#attachment-temporary":"#attachment",{message:j,id:l,path:""},r))},loadTools:function(){!k&&(k=new Promise(function(a){require(["ui-block/viewer/viewer","mailru-toolkit-lego-bundle"],function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}return a(b)})}));return k}}});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/attachments-manager",["require","exports","@mail/xray","default-values","feast","pilotjs","service/layer","service/search-attaches/utils","service/viewer","ui-block/attach-list/attach-list","ui-block/attach-thumb/attach-thumb","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item","ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AttachmentsManager=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var n=["attachments:tocloud"];var o=function(c){__extends(o,c);function o(){return c!==null&&c.apply(this,arguments)||this}o.prototype.getComponentsSpec=function(){return{router:{class:d.default},letter:{lazy:m.lazyUILetter,events:n},viewer:{class:null,events:n},"list-letter-attach-status-active":{class:j.default,events:["attachments:openviewer"]},"list-letter-preview-attaches-item":{class:k.default,events:["attachments:openviewer"]},"list-letter-preview-attaches-more":{class:l.default,events:["attachments:openviewer"]},"attach-list":{class:h.default,events:["attachment:analytics"]},"attach-thumb":{class:i.default,events:["attachment:analytics"]}}};o.prototype.handleEvent=function(a){var b=a.type.split(":").pop();if(b==="tocloud"){this.onAttachmentsCloud(a)}if(b==="openviewer"){var c=this.get("router");var d=a.details,e=d.message,f=d.attachment,h=d.attachmentId,i=d.msgId,j=d.from,k=j===void 0?"ll":j;g.default.open({attachment:f,message:e,router:c,newWindow:true,attachmentId:h,msgId:i});if(f){this.onSendAnalytics([f],"open_"+k)}}if(b==="analytics"){var l=a.details,m=l.models,n=l.event;this.onSendAnalytics(m,n)}};o.prototype.onAttachmentsCloud=function(a){var b=a.details,c=b.message,d=b.attachments;e.default.open("explorer-to-cloud",{attachments:d,message:c},{dimmer:true})};o.prototype.onSendAnalytics=function(c,d){if(c===void 0){c=[]}if(b.ATTACH_ANALYTICS_EXT_DISABLED){return}var e=[];var g=[];c.forEach(function(a){var b,c,d,h,i;if(!a){return}if(a.getExtension&&a.getPrimitiveType){e.push((b=a.getExtension())===null||b===void 0?void 0:b.toLowerCase());g.push((c=a.getPrimitiveType())===null||c===void 0?void 0:c.toLowerCase())}else{var j=((d=a.formName)===null||d===void 0?void 0:d.value)||((h=a.name)===null||h===void 0?void 0:h.value)||a.name;if(typeof j==="string"){e.push((i=f.getAttachmentExtension(j))===null||i===void 0?void 0:i.toLowerCase())}}});a.default.send("attach_thmb_"+d,{i:e.length>1?"mltpl":e[0],dwh:{ext:e,extType:g}})};return o}(c.default.Mediator);exports.AttachmentsManager=o;exports.default=c.default.Mediator.createFromClass("attachments-manager",o)});define("helpers/encode",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.safeEncodeURI=void 0;var a=/[&<>"']/g;var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};function c(a,b){return a[b]}var d=/[()"<>']/g;var e={"(":"%28",")":"%29",'"':"%22","'":"%27","<":"%3C",">":"%3E"};var f=c.bind(null,e);function g(a){return encodeURI(a).replace(d,f)}exports.safeEncodeURI=g;var h=c.bind(null,b);function i(b){if(typeof b!=="string"){return null}return b.replace(a,h)}exports.default=i});define("service/dimmer",["exports","service/promo","ui-block/dimmer/dimmer"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=document.querySelector("#dimmer");var g=void 0;exports.default={add:function a(){g=(new d.default).renderTo(f);c.default.update()},remove:function a(){if(!g){return}try{g.destroy()}catch(a){f.innerHTML=""}c.default.update()}}});define("feast-tpl!app/feast-tpl!ui-block/letter/letter.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageFolder" value="{message.getFolder()}"/>\n\t<fn:var name="hasAttach" value="{attrs.model.is(\'attaches.list.length\') && _this.isEnableAttach()}"/>\n\t<fn:var name="hasReplyAll" value="{_this.hasReplyAll(message)}"/>\n\n\t<fn:var name="draftReply" value="{message.get(\'drafts.reply\')}"/>\n\t<fn:var name="draftReplyAll" value="{message.get(\'drafts.replyall\')}"/>\n\t<fn:var name="draftForward" value="{message.get(\'drafts.forward\')}"/>\n\n\t<fn:var name="folders" value="{attrs.folders}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\n\t\x3c!-- Есть ли AMP-контент? --\x3e\n\t<fn:var name="hasAmp" value="{_this.isAMPLetter()}"/>\n\n\t\x3c!-- Есть ли ошибки в AMP-письме? --\x3e\n\t<fn:var name="hasAmpErrors" value="{attrs[\'amp-error\']}"/>\n\n\t<fn:var name="letterMetaType" value="{_this.getLetterMetaHeaderType(message)}" />\n\t<fn:var name="showPhishingDie" value="{message.get(\'flags.maybe_phishing\')}" />\n\n\t<fn:var name="enableFakeCreateTodo" value="{_this.isShowFakeCreateTodo()}" />\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="priority" value="{attrs.model.get(\'priority\')}"/>\n\t<bem:mod name="unread" value="{attrs.model.get(\'flags.unread\')}"/>\n\t<bem:mod name="attach" value="{hasAttach}"/>\n\t<bem:mod name="single" test="attrs.single"/>\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="fluid" test="!attrs.compact"/>\n\t<bem:mod name="sticky" test="attrs.sticky"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="native-sticky" test="attrs[\'native-sticky\']"/>\n\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']" />\n\t<bem:mod name="expanded-next" test="attrs[\'expanded-next\']" />\n\n\t<bem:mod name="light-mode" test="!_this.isDarkMode()" />\n\n\t\x3c!-- Иконка AMP --\x3e\n\t<fn:match name="amp-icon">\n\t\t<span bem:elem="amp-icon" qa:id="amp-icon">\n\t\t\t<b:ico name="status:breaking" size="s"/>\n\n\t\t\t<bem:mod name="error" test="hasAmpErrors"/>\n\n\t\t\t<fn:attr name="title" value="{i18n(\'Это письмо поддерживает динамический контент\')}" fn:if="!hasAmpErrors"/>\n\t\t\t<fn:attr name="title" value="{i18n(\'При отображении динамического контента письма возникли ошибки\')}" fn:if="hasAmpErrors"/>\n\t\t</span>\n\t</fn:match>\n\n\t\x3c!-- Поле "Кому" --\x3e\n\t<fn:match name="correspondents" args="contacts, dir, limit">\n\t\t<fn:var name="contactList" value="{limit ? contacts.slice(0, limit) : contacts}"/>\n\n\t\t<fn:for data="contactList" as="contact" key="contactKey">\n\t\t\t<fn:var name="isCurrent" value="{contact.email == attrs[\'current-user\'].getEmail()}"/>\n\t\t\t<fn:var name="isLast" value="{contactKey + 1 === contactList.length}"/>\n\t\t\t<b:letter-contact\n\t\t\t\tkey="{\'contact-\' + contactKey}"\n\t\t\t\tremit:click.prevent.stop="contact:click"\n\t\t\t\tevent:details="contact"\n\t\t\t\tuse:mediator="contact-selection"\n\t\t\t\tcontact="{contact}"\n\t\t\t\tdir="{dir}"\n\t\t\t\tisCurrent="{isCurrent}"\n\t\t\t\tdangerous="{dir === \'from\' && _this.isProbablyPhishing()}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tisLast="{isLast}"\n\t\t\t/>\n\t\t</fn:for>\n\t</fn:match>\n\n\n\t\x3c!-- Пометка прочитанным --\x3e\n\t<fn:match name="status-unread">\n\t\t<div bem:elem="unread" qa:id="unread">\n\t\t\t<bem:mod name="plain" test="!(message.is(\'flags.forward\') || message.is(\'flags.reply\'))"/>\n\t\t\t<b:letter-status2\n\t\t\t\t\tremit:button-click.prevent="togglestatus:unread"\n\t\t\t\t\tevent:details="{model: attrs.model, state: message.is(\'flags.unread\')}"\n\n\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\tname="unread"\n\t\t\t\t\tcompact="{!attrs.compact}"\n\t\t\t\t\tsmall="{attrs.compact}"\n\t\t\t\t\tforward="{message.is(\'flags.forward\')}"\n\t\t\t\t\treply="{message.is(\'flags.reply\')}"\n\t\t\t\t\tstate="{message.is(\'flags.unread\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Переключение тёмного/светлого режима --\x3e\n\t<fn:match name="dark-mode-toggle">\n\t\t<div bem:elem="dark-mode-toggle" qa:id="dark-mode-toggle">\n\t\t\t<b:letter-status2\n\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\tremit:button-click.prevent="dark-mode:toggle"\n\t\t\t\tname="dark-mode"\n\t\t\t\tstate="{attrs[\'dark-mode-enabled\']}"\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Пометка важным --\x3e\n\t<fn:match name="status-flag">\n\t\t<div bem:elem="flag" qa:id="flag">\n\t\t\t<b:letter-status2\n\t\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\t\tremit:button-click.prevent="togglestatus:flagged"\n\t\t\t\t\tevent:details="{model: attrs.model, state: message.is(\'flags.flagged\')}"\n\t\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t\t\tname="flagged"\n\t\t\t\t\tstate="{message.is(\'flags.flagged\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Предложить звонок --\x3e\n\t<fn:match name="invite-call">\n\t\t<div bem:elem="flag" qa:id="calls:invite" promo:id="letter-head-calls-button">\n\t\t\t<b:button2\n\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\tremit:click.prevent="calls:invite"\n\t\t\t\tevent:details="attrs.model"\n\t\t\t\tradar-id="head-call"\n\t\t\t\ttitle="{i18n(\'Предложить звонок\')}"\n\t\t\t\tico="categories:camera"\n\t\t\t\tbase\n\t\t\t\tsecondary\n\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Создать событие --\x3e\n\t<fn:match name="calendar-create">\n\t\t<div bem:elem="flag" qa:id="calendar:create" promo:id="letter-head-calendar-button">\n\t\t\t<b:button2\n\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\tremit:click.prevent="calendar:create"\n\t\t\t\tevent:details="{model:attrs.model, createContent:\'web_email_letter_header\'}"\n\t\t\t\tradar-id="head-calendar"\n\t\t\t\ttitle="{i18n(\'Создать событие\')}"\n\t\t\t\tico="calendar-month"\n\t\t\t\tbase\n\t\t\t\tsecondary\n\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Аватарка --\x3e\n\t<fn:match name="avatar-wrap">\n\t\t<fn:var name="contact" value="{message.get(\'correspondents.from.0\')}"/>\n\t\t<div bem:elem="avatar-wrap">\n\t\t\t<fn:apply-match name="status-unread" fn:if="!attrs.compact"/>\n\t\t\t<div bem:elem="avatar"\n\t\t\t\t qa:id="avatar"\n\t\t\t\t remit:click.prevent.stop="clickavatar"\n\t\t\t\t event:details="contact">\n\t\t\t\t<b:notification-badge\n\t\t\t\t\t\tshow="{attrs.isOnline}"\n\t\t\t\t\t\tcolorMode="success"\n\t\t\t\t\t\tbottom="4"\n\t\t\t\t\t\tright="4"\n\t\t\t\t\t\ttest-id="{attrs.isOnline && \'online-badge\'}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="content" bem:block="widget">\n\t\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\t\t\tsize="{attrs.compact ? \'m\' : \'s\'}"\n\t\t\t\t\t\t\t\t\t\tsrc="{message.get(\'correspondents.from.0.avatars.default\')}"\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch}"/>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:notification-badge>\n\t\t\t</div>\n\t\t\t<fn:apply-match name="status-unread" fn:if="attrs.compact"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Бейдж папки --\x3e\n\t<fn:match name="folder">\n\t\t<fn:if test="message.isHigh()">\n\t\t\t<fn:var name="name" value="important"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs[\'disable-category\'] && message.get(\'transaction_category\') && !messageFolder.isSpam()">\n\t\t\t<fn:var name="name" value="{message.get(\'transaction_category\')}"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.showfolder">\n\t\t\t<fn:var name="text" value="{messageFolder.get(\'name\')}"/>\n\t\t</fn:if>\n\n\t\t<div bem:elem="folder" bem:mod="{!!(text || name)}">\n\t\t\t<b:letter-category\n\t\t\t\tshort="{!text}"\n\t\t\t\tname="{name}"\n\t\t\t\ttext="{text}"\n\t\t\t\tsize="l"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Время отправки письма --\x3e\n\t<fn:match name="date">\n\t\t<div bem:elem="date" qa:id="date">\n\t\t\t<fn:value mod="getLocaleDateFull">message.get(\'date\')</fn:value>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Поле Кому --\x3e\n\t<fn:match name="recipients">\n\t\t<div bem:elem="recipients" bem:mod="short" qa:id="recipients:short"\n\t\t\t fn:if="!attrs[\'details-expanded\']">\n\t\t\t<fn:var name="recipients" value="{_this.getMessageCorrespondents()}"/>\n\t\t\t<fn:var name="showNames" value="{recipients.length > 3 ? 2 : recipients.length}"/>\n\t\t\t<fn:var name="moreCount" value="{recipients.length - showNames}"/>\n\n\t\t\t<span bem:elem="recipient-type">{i18n(\'Кому\')}:</span><fn:apply-match name="correspondents" args="recipients, \'to\', showNames"/>\n\t\t\t<a bem:elem="recipients-short-expand" fn:if="recipients.length > 3" remit:click.prevent="details:expand"\n\t\t\t\tqa:id="recipients:short-expand">{i18n(\'и ещё\')}\n\t\t\t\t<fn:value fn:if="attrs.touch">moreCount</fn:value>\n\t\t\t\t<fn:value fn:if="!attrs.touch" mod="correspondentsCount">moreCount</fn:value>\n\t\t\t</a>\n\t\t</div>\n\n\t\t<div bem:elem="recipients" bem:mod="expanded" qa:id="recipients:expanded"\n\t\t\t fn:if="attrs[\'details-expanded\']"\n\t\t>\n\t\t\x3c!-- remit:click.prevent="details:collapse" для поля выше ^ --\x3e\n\t\t\t<fn:var name="hasBcc" value="{attrs.model.get(\'correspondents.bcc.length\')}"/>\n\t\t\t<fn:var name="hasCc" value="{attrs.model.get(\'correspondents.cc.length\')}"/>\n\n\t\t\t<div bem:elem="header-details-recipient">\n\t\t\t\t<span bem:elem="recipient-type">{i18n(\'Кому\')}:</span><fn:apply-match name="correspondents" args="message.get(\'correspondents.to\'), \'to\'"/>\n\n\t\t\t\t<a bem:elem="recipients-short-collapse" remit:click.prevent="details:collapse" fn:if="!hasCc && !hasBcc"\n\t\t\t\t   qa:id="recipients:short-collapse">{i18n(\'Скрыть список\')}</a>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="header-details-recipient" fn:if="hasCc">\n\t\t\t\t<span bem:elem="recipient-type">{i18n(\'Копия\')}:</span><fn:apply-match name="correspondents" args="message.get(\'correspondents.cc\'), \'cc\'"/>\n\n\t\t\t\t<a bem:elem="recipients-short-collapse" remit:click.prevent="details:collapse" fn:if="!hasBcc"\n\t\t\t\t   qa:id="recipients:short-collapse">{i18n(\'Скрыть список\')}</a>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="header-details-recipient" fn:if="hasBcc">\n\t\t\t\t<span bem:elem="recipient-type">{i18n(\'Скрытая\')}:</span><fn:apply-match name="correspondents" args="message.get(\'correspondents.bcc\'), \'bcc\'"/>\n\n\t\t\t\t<a bem:elem="recipients-short-expand" remit:click.prevent="details:collapse"\n\t\t\t\t   qa:id="recipients:short-collapse">{i18n(\'Скрыть список\')}</a>\n\t\t\t</div>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Меню Ещё --\x3e\n\t<fn:match name="more">\n\t\t<fn:if test="!attrs.mobile">\n\t\t\t<div bem:elem="more" qa:id="more">\n\t\t\t\t<b:dropdown-actions\n\t\t\t\t\t\tfn:if="!attrs.readonly"\n\t\t\t\t\t\ttext="{i18n(\'Ещё\')}"\n\t\t\t\t\t\tico="more-hor"\n\t\t\t\t\t\tsecondary\n\t\t\t\t\t\texpand-left\n\n\t\t\t\t\t\tdisable-edit="{attrs[\'disable-edit\']}"\n\n\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\tparentThread="{attrs.parentThread}"\n\t\t\t\t\t\tfolders="{folders}"\n\t\t\t\t\t\tread="{message.is(\'flags.unread\') ? true : null}"\n\t\t\t\t\t\tunread="{!message.is(\'flags.unread\') ? true : null}"\n\t\t\t\t\t\tflag="{!message.is(\'flags.flagged\') ? true : null}"\n\t\t\t\t\t\tunflag="{message.is(\'flags.flagged\') ? true : null}"\n\t\t\t\t\t\tarchive="{!messageFolder.isArchive()}"\n\t\t\t\t\t\tspam="{_this._showSpam()}"\n\t\t\t\t\t\tselectedLettersIds="{[message.get(\'id\')]}"\n\t\t\t\t\t\tunsubscribe="{_this._showUnsubscribeInMoreMenu()}"\n\t\t\t\t\t\tunspam="{messageFolder.isSpam()}"\n\t\t\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\t\t\tmetathreads="{attrs.metathreads}"\n\n\t\t\t\t\t\tcreate-event="{_this._showDropdownCalendarButton()}"\n\t\t\t\t\t\tinvite-call="{_this._showDropdownCallButton()}"\n\t\t\t\t\t\tcreate-filter="{_this._showFilterButton()}"\n\t\t\t\t\t\tcategory-feedback="{attrs[\'category-feedback\'] && !attrs.touch}"\n\t\t\t\t\t\ttranslate="{!attrs[\'disable-translate\']}"\n\n\t\t\t\t\t\tmore\n\t\t\t\t\t\tremove\n\t\t\t\t\t\tmove\n\t\t\t\t\t\treadletter\n\t\t\t\t\t\tprint\n\t\t\t\t\t\treply="{hasReplyAll?\'all\':true}"\n\t\t\t\t\t\tradar-id="more"\n\t\t\t\t\t\tuse:mediator="layout-manager letters-selection unsubscribe-actions"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\t</fn:match>\n\n\t\x3c!-- Отписка из письма --\x3e\n\t<fn:match name="unsubscribe">\n\t\t<div bem:elem="footer-button" qa:id="unsubscribe">\n\t\t\t<fn:var name="letterId" value="{message.get(\'id\')}"/>\n\t\t\t<fn:var name="senderFrom" value="{message.get(\'correspondents.from\')[0].email}"/>\n\t\t\t<b:unsubscribe\n\t\t\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tsenderFrom="{senderFrom}"\n\t\t\t\t\tletterId="{letterId}"\n\t\t\t\t\tposition-right\n\t\t\t\t\tshort="{hasReplyAll}"\n\t\t\t\t\tpromoId="octavius-tooltip-unsubscribe-button"\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Шапка письма --\x3e\n\t<div bem:elem="head" remit:click="clickhead" qa:id="head">\n\t\t<bem:mod name="sticky" test="attrs[\'sticky-head\']"/>\n\t\t<bem:mod name="sticky-fade" test="attrs[\'sticky-head-fade\']"/>\n\n\t\t<div bem:elem="header-row">\n\t\t\t<fn:apply-match name="avatar-wrap"/>\n\n\t\t\t<div bem:elem="header-details" qa:id="head:details">\n\t\t\t\t<div bem:elem="author">\n\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'correspondents.from\'), \'from\'"/>\n\t\t\t\t\t<fn:apply-match name="date" fn:if="!attrs.compact"/>\n\t\t\t\t\t<fn:apply-match name="folder" fn:if="!attrs.compact"/>\n\t\t\t\t\t<fn:apply-match name="amp-icon" fn:if="(hasAmp && !attrs[\'preview-mode\'] || hasAmpErrors) && !attrs.compact"/>\n\t\t\t\t</div>\n\n\t\t\t\t<fn:apply-match name="recipients" fn:if="_this.getMessageCorrespondents().length"/>\n\t\t\t\t<fn:apply-match name="folder" fn:if="attrs.compact"/>\n\t\t\t\t<fn:apply-match name="date" fn:if="attrs.compact"/>\n\t\t\t\t<fn:apply-match name="amp-icon" fn:if="(hasAmp && !attrs[\'preview-mode\'] || hasAmpErrors) && attrs.compact"/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="controls" qa:id="controls">\n\t\t\t\t<fn:apply-match name="status-flag" />\n\t\t\t\t<fn:apply-match name="dark-mode-toggle" fn:if="_this.isDarkModePossible()" />\n\t\t\t\t<fn:apply-match name="invite-call" fn:if="_this._showHeadCallButton()" />\n\t\t\t\t<fn:apply-match name="calendar-create" fn:if="_this._showHeadCalendarButton()" />\n\t\t\t\t<fn:apply-match name="more" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="before-letter-body">\n\t\t\x3c!-- FMAIL-6259: плашка о возможном фишинге --\x3e\n\t\t\x3c!-- FMAIL-11501: Плашка о протухаемых аттачах --\x3e\n\t\t<div bem:elem="letter-meta-container" fn:if="letterMetaType">\n\t\t\t<bem:mod name="phishing" test="showPhishingDie" />\n\t\t\t<b:letter-meta\n\t\t\t\ttype="{letterMetaType}"\n\t\t\t\tmodel="{message}"\n\t\t\t\tremit:attaches-cloud-save="attaches:cloud:all"\n\t\t\t\tuse:mediator="letters-actions"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div bem:elem="confirm-receipt" fn:if="_this.isEnableConfirmationReceipt()">\n\t\t\t<b:letter-confirm-receipt\n\t\t\t\tid="confirm-receipt"\n\t\t\t\tmodel="{message}"\n\t\t\t\tmobile="{attrs.mobile}"\n\t\t\t\tremit:confirm="confirmreceipt"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Кнопка подтверждение прочтение письма --\x3e\n\n\t\t\x3c!-- Переводчик --\x3e\n\t\t<div bem:elem="translator" fn:if="_this.isTranslatorVisible()">\n\t\t\t<b:translator\n\t\t\t\tid="translator"\n\t\t\t\tremit:hide="translator:hide:click"\n\t\t\t\tremit:close="translator:close:click"\n\t\t\t\tremit:original="translator:original:click"\n\t\t\t\tremit:retry="translator:retry:click"\n\t\t\t\tremit:translate="translator:translate:click"\n\n\t\t\t\tletterId="{message.id}"\n\t\t\t\terror="{attrs[\'is-translator-error\']}"\n\t\t\t\tcompact="{attrs.compactTranslator}"\n\t\t\t\tfrom-default-selected="{attrs[\'translator-default-from\']}"\n\t\t\t\tloading="{attrs[\'is-translator-loading\']}"\n\t\t\t\tponymode="{ponyMode}"\n\t\t\t\tto-default-selected="{attrs[\'translator-default-to\']}"\n\t\t\t\tis-translator-visible="{attrs[\'is-translator-visible\']}"\n\t\t\t\ttranslated="{_this.isLetterTranslated()}"\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Блок-подсказка под шапкой письма --\x3e\n\t<div bem:elem="tooltip" fn:if="!_this.isTranslatorVisible() && _this.isTooltipVisible()">\n\t\t\x3c!-- Подсказка об отключенных картинках в папке "Спам" (с возможностью включить для письма) --\x3e\n\t\t<fn:if test="_this.isImagesHiddenTooltipVisible()">\n\t\t\t<b:letter-tooltip\n\t\t\t\ttype="images-hidden-tooltip"\n\t\t\t\tponymode="{ponyMode}"\n\t\t\t\ttitle-text="{i18n(\'Мы скрыли изображения в письме, чтобы защитить аккаунт\')}"\n\t\t\t\taction-text="{i18n(\'Показать изображения\')}"\n\t\t\t\tremit:action="letter-tooltip:show-images:click"\n\t\t\t\tremit:close="letter-tooltip:close"\n\t\t\t/>\n\t\t</fn:if>\n\t</div>\n\n\t\x3c!-- Панель вложений --\x3e\n\t<fn:if test="hasAttach">\n\t\t<div bem:elem="attach-list">\n\t\t\t<b:attach-list\n\t\t\t\tletter-length="{attrs.model.get(\'body.text\').length}"\n\t\t\t\tmodels="{attrs.model.get(\'attaches.list\')}"\n\t\t\t\ttotal-size="{attrs.model.getAttachmentsTotalSize()}"\n\t\t\t\tdownload-link="{_this.getAttachmentsDowloadLink()}"\n\t\t\t\tpreview-mode="{attrs[\'preview-mode\']}"\n\t\t\t\tuse:mediator="layout-manager attachments-manager"\n\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\tremit:attach-list-expanded="attaches:expanded"\n\t\t\t\tremit:attach-list-collapsed="attaches:collapsed"\n\t\t\t\tremit:attach-list-cloud="attaches:cloud:all"\n\t\t\t\tremit:thumb-open="attaches:open"\n\t\t\t\tremit:thumb-cloud="attaches:cloud:one"\n\t\t\t/>\n\t\t</div>\n\t</fn:if>\n\n\t\x3c!-- Тело письма --\x3e\n\t<div bem:elem="body" qa:id="body">\n\t\t\x3c!-- Показ приглашения если есть ics --\x3e\n\t\t\x3c!-- Скрываем приглашение, если есть плашка адреса мероприятия --\x3e\n\t\t<b:letter-calendar\n\t\t\tkey="{_this.isDarkMode()}"\n\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\tfn:if="!(attrs[\'address-header-calendar\'] && message.getJsonLdEvent() || attrs[\'smart-card-ics\'] && message.getCalendarIcsEvent())"\n\t\t\tcalendars="{message.getCalendarFromAttach()}"\n\t\t/>\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="hasAmp && !attrs[\'preview-mode\']">\n\t\t\t\t<b:letter-body-amp\n\t\t\t\t\t\tref="letter-body"\n\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\tremit:error="amp:error"\n\t\t\t\t\t\tremit:force-recalc="letter-force-recalc"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- Содержимое письма --\x3e\n\t\t\t\t<b:letter-body\n\t\t\t\t\t\tref="letter-body"\n\t\t\t\t\t\tkey="{_this.getLetterBodyKey()}"\n\t\t\t\t\t\tid="{_this.getLetterBodyKey()}"\n\t\t\t\t\t\tbodyHtml="{_this.getLetterBody()}"\n\t\t\t\t\t\tcollapsed-default="{attrs[\'quotes-collapsed-default\']}"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\t\t\tmessage="{message}"\n\t\t\t\t\t\tpreview-mode="{attrs[\'preview-mode\']}"\n\n\t\t\t\t\t\tremit:resize="resize"\n\t\t\t\t\t\tremit:blockquote="blockquote"\n\t\t\t\t\t\tremit:allowedattrclick="letter:body:allowedattrclick"\n\t\t\t\t\t\tremit:data-attr-click="letter:body:data-attr:click"\n\t\t\t\t\t\tremit:finepayment="letter:body:finepayment"\n\t\t\t\t\t\tremit:finepaymentright="letter:body:finepaymentright"\n\t\t\t\t\t\tremit:monetapayment="letter:body:monetapayment"\n\t\t\t\t\t\tremit:tomyselfclick="letter:body:tomyself"\n\t\t\t\t\t\tremit:force-recalc="letter-force-recalc"\n\t\t\t\t\t\tuse:mediator="layout-manager features flags"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\n\t\x3c!-- Подвал--\x3e\n\t<div bem:elem="footer" qa:id="footer" fn:if="!attrs.readonly && _this.isShowFooter()">\n\t\t<bem:mod name="sticky" test="attrs[\'sticky-footer\']"/>\n\t\t<bem:mod name="sticky-fade" test="attrs[\'sticky-footer-fade\']"/>\n\t\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()" />\n\n\t\t<div bem:elem="footer-background">\n\t\t\t\x3c!-- Кнопки ответа на письмо --\x3e\n\t\t\t<div bem:elem="footer-buttons">\n\t\t\t\t<div bem:elem="footer-left">\n\t\t\t\t\t<div bem:elem="footer-button" fn:if="hasReplyAll">\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="draftReplyAll">\n\t\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="shift+r"\n\t\t\t\t\t\t\t\t\t\tradar-id="replyall"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить всем\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply-all"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, draftId: draftReplyAll}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="letter:draft:replyall"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Есть черновик, продолжить с ним\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="compose:replyall">\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Новое письмо\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="shift+r"\n\t\t\t\t\t\t\t\t\t\tremit:click="compose:replyall"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="replyall"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить всем\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply-all"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="footer-button">\n\t\t\t\t\t\t<fn:var name="shortReply" value="{hasReplyAll && attrs[\'sticky-reduce-reply\']}"/>\n\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="draftReply">\n\t\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t\t\t\t\t\tradar-id="reply"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t\t\tshort="{shortReply}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, draftId: draftReply}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="letter:draft:reply"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Есть черновик, продолжить с ним\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="compose:reply">\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Новое письмо\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t\t\t\t\t\tremit:click="compose:reply"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="reply"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t\t\tshort="{shortReply}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="footer-button">\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="draftForward">\n\t\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="forward"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Переслать\')}"\n\t\t\t\t\t\t\t\t\t\tico="forward"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, draftId: draftForward}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="letter:draft:forward"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Есть черновик, продолжить с ним\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="compose:forward">\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Новое письмо\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\tremit:click="compose:forward"\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="forward"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Переслать\')}"\n\t\t\t\t\t\t\t\t\t\tico="forward"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="footer-right">\n\t\t\t\t\t<fn:if test="!_this._showUnsubscribeButton() && !_this.isDatesMetadataEnabled()">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="footer-button"\n\t\t\t\t\t\t\t\tqa:id="calls-dropdown"\n\t\t\t\t\t\t\t\tpromo:id="footer-calls-dropdown"\n\t\t\t\t\t\t\t\tfn:if="attrs[\'invite-call\'] && !attrs[\'disable-call\'] && !attrs[\'disable-footer-call\'] && _this.canCallTo(attrs.model) && !enableFakeCreateTodo"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\tdisable-expand-center\n\t\t\t\t\t\t\t\t\texpand-left\n\t\t\t\t\t\t\t\t\tico="categories:camera"\n\t\t\t\t\t\t\t\t\ttext="{i18n(\'Позвонить\')}"\n\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Позвонить\')}"\n\t\t\t\t\t\t\t\t\tannotation="{!attrs[\'disable-calls-tip\'] && i18n(\'Отправьте ссылку на звонок или позвоните сейчас — если ваши собеседники онлайн, они увидят вызов\')}"\n\t\t\t\t\t\t\t\t\tponymode="{attrs[\'pony-mode\']}"\n\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\tshort="{attrs[\'sticky-reduce-all-texts\']}"\n\t\t\t\t\t\t\t\t\tradar-id="footer-call-dropdown"\n\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\tremit:dropdown-change-state="dropdown-change"\n\t\t\t\t\t\t\t\t\tcentered="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\tqa:id="calls:call"\n\t\t\t\t\t\t\t\t\t\t\t\tremit:click="calls:groupcall"\n\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\tradar-id="footer-calls-groupcall"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle="{!attrs[\'disable-calls-tip\'] && i18n(\'Если собеседники онлайн на сайте Mail.ru, они увидят вызов и смогут ответить сразу\')}"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t\t\t\t<b:ico name="categories:camera"/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Позвонить сейчас\')}</span>\n\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\tqa:id="calls:invite"\n\t\t\t\t\t\t\t\t\t\t\t\tremit:click="calls:invite"\n\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\tradar-id="footer-calls-invite"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle="{!attrs[\'disable-calls-tip\'] && i18n(\'Собеседники получат ссылку для видеозвонка и присоединятся, когда перейдут по ней\')}"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t\t\t\t<b:ico name="status:link"/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отправить ссылку на звонок\')}</span>\n\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="footer-button"\n\t\t\t\t\t\t\t\tpromo:id="footer-calls-button"\n\t\t\t\t\t\t\t\tfn:if="attrs[\'invite-call\'] && !attrs[\'disable-call\'] && !attrs[\'disable-footer-call\'] && !_this.canCallTo(attrs.model) && !enableFakeCreateTodo"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\tqa:id="calls:invite"\n\t\t\t\t\t\t\t\t\tremit:click="calls:invite"\n\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\tradar-id="footer-call"\n\t\t\t\t\t\t\t\t\ttext="{!attrs[\'sticky-reduce-all-texts\'] && i18n(\'Предложить звонок\')}"\n\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Предложить звонок\')}"\n\t\t\t\t\t\t\t\t\tannotation="{!attrs[\'disable-calls-tip\'] && i18n(\'Участники встречи получат ссылку для видеозвонка и присоединятся, когда перейдут по ней\')}"\n\t\t\t\t\t\t\t\t\tico="categories:camera"\n\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\tclean\n\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\tcentered="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<fn:if test="enableFakeCreateTodo">\n\t\t\t\t\t\t\t<div class="letter__footer-button">\n\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\t\tcomponent="CreateTodo"\n\t\t\t\t\t\t\t\t\t\tcompact="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t\t\t\tletterId="{message.get(\'id\')}"\n\t\t\t\t\t\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\x3c!-- Кнопки Предложить звонок и Создать событие показываем только, если нет кнопки рассылки и метадаты для кнопки календаря --\x3e\n\t\t\t\t\t\t<div bem:elem="footer-button" fn:if="!attrs[\'disable-create-event\'] && !attrs[\'disable-footer-calendar\']">\n\t\t\t\t\t\t\t<b:calendar-button\n\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\tsticky-reduce-one-text="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t\t\tuse:mediator="calendar-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t<fn:if test="_this._showVkMessengerButton()">\n\t\t\t\t\t\t<div bem:elem="vk-chat-button" promo:id="toolbar-vk-chat">\n\t\t\t\t\t\t\t<fn:var name="vkMessengerParams" value="{_this._getVkMessengerParams()}" />\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\tqa:id="vk-messenger:open"\n\t\t\t\t\t\t\t\tremit:click="vk-messenger:open"\n\t\t\t\t\t\t\t\tevent:details="vkMessengerParams.href"\n\t\t\t\t\t\t\t\tradar-id="footer-vk"\n\t\t\t\t\t\t\t\ttext="{!attrs[\'sticky-reduce-one-text\'] && vkMessengerParams.text}"\n\t\t\t\t\t\t\t\ttitle="{vkMessengerParams.text}"\n\t\t\t\t\t\t\t\tico="social:vk"\n\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\tclean\n\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\tcentered="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- Отписка из письма справа --\x3e\n\t\t\t\t\t<fn:if test="_this._showUnsubscribeButton() && !_this.isDatesMetadataEnabled()">\n\t\t\t\t\t\t<fn:apply-match name="unsubscribe"/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- Если есть дата для письма - приоритизируем кнопку создания события --\x3e\n\t\t\t\t\t<fn:if test="this.isDatesMetadataEnabled()">\n\t\t\t\t\t\t<div bem:elem="footer-button" fn:if="!attrs[\'disable-create-event\'] && !attrs[\'disable-footer-calendar\']">\n\t\t\t\t\t\t\t<b:calendar-button\n\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\tdates-metadata="{attrs[\'dates-metadata\']}"\n\t\t\t\t\t\t\t\t\tsticky-reduce-one-text="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t\t\tuse:mediator="calendar-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<fn:var name="isMarusiaEnabled" value="{attrs[\'marusia-portal-enabled\'] && _this.isMarusiaReadLetterEnabled()}" />\n\t\t\t<fn:var name="isMarusiaAllEnabled" value="{attrs[\'marusia-portal-enabled\'] && attrs[\'marusia-read-all-letters\']}" />\n\t\t\t<fn:var name="marusiaRadarPrefix" value="{_this.getMarusiaReadLetterRadarPrefix()}" />\n\n\t\t\t<fn:var name="isSmartReplyEnabled" value="{attrs.smart_replies && _this.isEnableReply()}" />\n\n\t\t\t<div bem:elem="footer-controls" fn:if="(isMarusiaAllEnabled || isSmartReplyEnabled) && _this.isShowSmartReplyAndMarusia()">\n\t\t\t\t<span bem:elem="marusia-rl" fn:if="isMarusiaEnabled || isMarusiaAllEnabled">\n\t\t\t\t\t<fn:add-class name="ready" test="attrs.smart_replies_ready || isMarusiaAllEnabled"/>\n\t\t\t\t\t<b:marusia-rl-button\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\t\tuse:mediator="marusia-manager"\n\t\t\t\t\t\tradar-prefix="{marusiaRadarPrefix}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\n\t\t\t\t<fn:if test="isSmartReplyEnabled">\n\t\t\t\t\t<fn:for data="attrs.smart_replies" as="value" key="key">\n\t\t\t\t\t\t<span bem:elem="smart-reply" key="{key}" qa:id="smart-reply">\n\t\t\t\t\t\t\t<fn:add-class name="ready" test="attrs.smart_replies_ready"/>\n\t\t\t\t\t\t\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\tremit:click="compose:smartreply"\n\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, key: key}"\n\t\t\t\t\t\t\t\ttext="{value}"\n\t\t\t\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\t\t\t\tmedium="{!attrs.ponymode}"\n\t\t\t\t\t\t\t\tshadowless\n\t\t\t\t\t\t\t\tinvert\n\t\t\t\t\t\t\t\tradar-id="smart-reply{message.is(\'flags.smart_reply_stage\') ? \'_stage\' : \'\'}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter/letter.html")});define("feast-tpl!ui-block/letter/letter.html",["feast-tpl!app/feast-tpl!ui-block/letter/letter.html"],function(a){return a});define("helpers/check-url-from-letter",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;function b(b){return a.SAFE_URL_LETTERS.test(b)}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/smime-attachments-metrics",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendSMIMEAttachmentsMetrics=exports.SMIME_ALL_DEFAULT_FILENAMES=exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME=exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME=exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME=exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME=exports.SMIME_DEFAULT_FILENAME=exports.SMIME_INVALID_EXTENSION=exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION=exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION=exports.SMIME_SIGNED_DATA_FILE_EXTENSION=exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION=exports.PKCS7_SIGNATURE_CONTENT_TYPE=exports.PKCS7_MIME_CONTENT_TYPE=void 0;a=__importDefault(a);exports.PKCS7_MIME_CONTENT_TYPE="application/pkcs7-mime";exports.PKCS7_SIGNATURE_CONTENT_TYPE="application/pkcs7-signature";exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION="p7m";exports.SMIME_SIGNED_DATA_FILE_EXTENSION="p7s";exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION="p7z";exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION="p7c";exports.SMIME_INVALID_EXTENSION="wrng";exports.SMIME_DEFAULT_FILENAME="smime";exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME=exports.SMIME_DEFAULT_FILENAME+"."+exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION;exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME=exports.SMIME_DEFAULT_FILENAME+"."+exports.SMIME_SIGNED_DATA_FILE_EXTENSION;exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME=exports.SMIME_DEFAULT_FILENAME+"."+exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION;exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME=exports.SMIME_DEFAULT_FILENAME+"."+exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION;exports.SMIME_ALL_DEFAULT_FILENAMES=[exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME,exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME,exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME,exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME];function b(b){var c=b.map(function(a){var b=a.get("name");var c=a.get("content_type");var d=c===exports.PKCS7_MIME_CONTENT_TYPE||c===exports.PKCS7_SIGNATURE_CONTENT_TYPE;var e=exports.SMIME_INVALID_EXTENSION;var f=false;switch(true){case b.endsWith("."+exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION):{e=exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION;f=b===exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_MIME_CONTENT_TYPE;break}case b.endsWith("."+exports.SMIME_SIGNED_DATA_FILE_EXTENSION):{e=exports.SMIME_SIGNED_DATA_FILE_EXTENSION;f=b===exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_SIGNATURE_CONTENT_TYPE;break}case b.endsWith("."+exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION):{e=exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION;f=b===exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_MIME_CONTENT_TYPE;break}case b.endsWith("."+exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION):{e=exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION;f=b===exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_MIME_CONTENT_TYPE;break}}var g=e!==exports.SMIME_INVALID_EXTENSION;if(d||g){return{contentType:c,filename:b,extension:e,specCompliant:f}}return null}).filter(function(a){return!!a});if(c.length===0){return}if(c.length>1){a.default.send("smime",{i:["many"]});return}var d=c[0];var e=[];if(d.specCompliant){e.push("spec")}else{e.push("nospec")}e.push(d.extension);if(exports.SMIME_ALL_DEFAULT_FILENAMES.includes(d.filename)){e.push(d.filename.replace(".",""))}switch(d.contentType){case exports.PKCS7_MIME_CONTENT_TYPE:{e.push("pkcs7mime_"+d.extension);break}case exports.PKCS7_SIGNATURE_CONTENT_TYPE:{e.push("pkcs7sig_"+d.extension);break}}a.default.send("smime",{i:e})}exports.sendSMIMEAttachmentsMetrics=b});define("mediator/share-folders-manager/events",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ACTION_END_DATA_SOURCE_EVENT=exports.ShareEvents=void 0;exports.ShareEvents={letterActionClick:"sharefolders:accessletter:click",openShare:"sharefolders:opensharefolders",openShareOpportunities:"shareopportunities:openshareopportunities",denySharedFolder:"sharefolders:denysharedfolder"};exports.ACTION_END_DATA_SOURCE_EVENT="actionend"});define("feast-tpl!app/feast-tpl!ui-block/calendar-button/calendar-button.html",["feast"],function(a){return a.smartParse('<div qa:id="{attrs[\'dates-metadata\'] ? \'calendar:metadata:create\' : \'calendar:create\'}">\n    <b:button2\n        remit:click="calendar:create"\n        event:details="{model: attrs.model, createContent:\'web_email_letter_footer\'}"\n        radar-id="{_this._getRadarPrefix()}"\n        text="{!attrs[\'sticky-reduce-one-text\'] && _this._getCalendarButtonText()}"\n\t\tico="calendar-month"\n        base\n        pure\n        touch="{attrs.touch}"\n        model="{attrs.model}"\n        disabled="{attrs[\'disable-edit\']}"\n        centered="{attrs[\'sticky-reduce-one-text\']}"\n    />\n</div>\n',"app/feast-tpl!ui-block/calendar-button/calendar-button.html")});define("feast-tpl!ui-block/calendar-button/calendar-button.html",["feast-tpl!app/feast-tpl!ui-block/calendar-button/calendar-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/calendar-button/calendar-button",["require","exports","cfgUser","feast","feast-tpl!./calendar-button.html","service/radars/index","ui-block/button2/button2"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);exports.default=b.default.Block.extend({name:"calendar-button",template:c.default,blocks:{button2:e.default},defaults:{model:null,"dates-metadata":null},attrChanged:{"dates-metadata":function(a){this.get("model").set("dates_metadata.priority_date",a)}},_getCalendarButtonText:function(){var b=this.get("dates-metadata");var c=a.default.get("LANG");var d={day:"numeric",month:"long",hour:"numeric",minute:"numeric"};if(b){var e=new Date(b.timestamp*1e3);var f=e.getTime()+e.getTimezoneOffset()*60*1e3;var g=c.split("_")[0]||"ru";var h=new Date(e.setTime(f)).toLocaleTimeString(g,d);if(g==="ru"){h=h.replace(","," в")}return i18n("Напомнить {dateWhen}",{dateWhen:h})}return i18n("Создать событие")},_getRadarPrefix:function(){return"footer-calendar"+(this.get("dates-metadata")?"_metadata":"")},didMount:function(){d.default("thread_letter_footer-calendar_"+(this.get("dates-metadata")?"metadata-render":"render"))}})});define("feast-tpl!app/feast-tpl!ui-block/letter-body-amp/letter-body-amp.html",["feast"],function(a){return a.smartParse("<div/>\n","app/feast-tpl!ui-block/letter-body-amp/letter-body-amp.html")});define("feast-tpl!ui-block/letter-body-amp/letter-body-amp.html",["feast-tpl!app/feast-tpl!ui-block/letter-body-amp/letter-body-amp.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-body-amp/letter-body-amp",["require","exports","@mail/xray","default-values","feast","feast-tpl!./letter-body-amp.html","helpers/opener","service/auth","service/radars/decorator","service/radars/index","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);exports.default=c.default.Block.extend(g.default({id:"amp",events:["mount","error"]})({name:"letter-body-amp",template:d.default,performanceTrace:"track",immutable:true,didMount:function(){var c=this;var d;var e=this.get("model");var f=e&&e.get("body.amp");if(!f){this.broadcast("error");return}this._fallbackPixel=b.AMP_SENDER_METRICS&&e&&((d=e.get("meta"))===null||d===void 0?void 0:d.find(function(a){return a&&typeof a==="object"&&a["@context"]==="http://schema.org"&&a["@type"]==="Action"&&a["agent"]==="AMP4Email"&&a["name"]==="ValidationError"&&typeof a["url"]==="string"}));i.lazyMailAmpViewer().then(i.uniqCallback(this,function(d){var e;var g=d.createAmpViewer;if(!c.isMounted()){return}c.AMPViewer=g({iframeSrc:b.AMP_IFRAME_PATH,cdnHost:"amp-lib/",proxyHost:b.AMP_PROXY_HOST,debug:b.IS_DEBUG,timeout:b.AMP_TIMEOUT,errorRadars:true,senderMetrics:{fallback:(e=c._fallbackPixel)===null||e===void 0?void 0:e.url}});c.AMPViewer.setup();c.AMPViewer.on("error",c.handleError.bind(c));c.AMPViewer.on("navigate",c.handleNavigate.bind(c));c.AMPViewer.on("radar",c.handleRadar.bind(c));c.el.appendChild(c.AMPViewer.iframe);c.AMPViewer.loadLetter({content:f,fromEmail:c.getFromEmail(),toEmail:c.getToEmail()});if(c._fallbackPixel){a.default.send("amp_fallback_pixel-exists")}c.broadcast("force-recalc")}))},getFromEmail:function(){var a=this.get("model");return a.get("correspondents.from.0.email")},getToEmail:function(){var a=f.default.user;return a&&a.getEmail()},didUnmount:function(){if(this.AMPViewer){this.AMPViewer.teardown()}},handleError:function(c){var d=this;b.IS_DEBUG&&console.error("Error from AMP Viewer",c);var e=this.getFromEmail();var f=this.getToEmail();require(["trackJS"],function(a){a.sendRadar("amp_log-error",{fromEmail:e,toEmail:f,error:c},"octavius_amp-error")});if(/^(js|timeout|validation|message_parse|lib_untrusted)$/.test(c.type)){window.setTimeout(function(){if(d._fallbackPixel){a.default.send("amp_fallback_tracked")}else{a.default.send("amp_fallback_untracked")}d.broadcast("error")},1)}},handleNavigate:function(a){var c=a.href;var d=document.createElement("a");d.href=c;if(!d.hostname){c=b.AMP_REDIRECT_URL}e.default(c)},handleRadar:function(a){h.default({type:"amp_"+a.t,intervals:a.i,value:a.v===undefined?1:a.v})}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-calendar/letter-calendar.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-calendar">\n\t<fn:var\n\t\tname="darkMode"\n\t\tvalue="{attrs[\'dark-mode\']}"\n\t/>\n\n\t<fn:value output="raw">attrs.html</fn:value>\n</div>\n',"app/feast-tpl!ui-block/letter-calendar/letter-calendar.html")});define("feast-tpl!ui-block/letter-calendar/letter-calendar.html",["feast-tpl!app/feast-tpl!ui-block/letter-calendar/letter-calendar.html"],function(a){return a});(function a(b,c){if(typeof exports==="object"&&typeof module==="object")module.exports=c();else if(typeof define==="function"&&define.amd)define("@mail/darkosha",[],c);else if(typeof exports==="object")exports["@mail/darkosha"]=c();else b["@mail/darkosha"]=c()})(self,function(){return function(){var a={"./node_modules/@kiy/color/index.js":function(a,b,c){var d=c("./node_modules/@kiy/color/node_modules/color-string/index.js");var e=c("./node_modules/@kiy/color/node_modules/color-convert/index.js");var f=[].slice;var g=["keyword","gray","hex"];var h={};for(var i=0,j=Object.keys(e);i<j.length;i++){var k=j[i];h[f.call(e[k].labels).sort().join("")]=k}var l={};function m(a,b){if(!(this instanceof m)){return new m(a,b)}if(b&&b in g){b=null}if(b&&!(b in e)){throw new Error("Unknown model: "+b)}var c;var i;if(a==null){this.model="rgb";this.color=[0,0,0];this.valpha=1}else if(a instanceof m){this.model=a.model;this.color=a.color.slice();this.valpha=a.valpha}else if(typeof a==="string"){var j=d.get(a);if(j===null){throw new Error("Unable to parse color from string: "+a)}this.model=j.model;i=e[this.model].channels;this.color=j.value.slice(0,i);this.valpha=typeof j.value[i]==="number"?j.value[i]:1}else if(a.length>0){this.model=b||"rgb";i=e[this.model].channels;var k=f.call(a,0,i);this.color=v(k,i);this.valpha=typeof a[i]==="number"?a[i]:1}else if(typeof a==="number"){this.model="rgb";this.color=[a>>16&255,a>>8&255,a&255];this.valpha=1}else{this.valpha=1;var n=Object.keys(a);if("alpha"in a){n.splice(n.indexOf("alpha"),1);this.valpha=typeof a.alpha==="number"?a.alpha:0}var o=n.sort().join("");if(!(o in h)){throw new Error("Unable to parse color from object: "+JSON.stringify(a))}this.model=h[o];var p=e[this.model].labels;var q=[];for(c=0;c<p.length;c++){q.push(a[p[c]])}this.color=v(q)}if(l[this.model]){i=e[this.model].channels;for(c=0;c<i;c++){var r=l[this.model][c];if(r){this.color[c]=r(this.color[c])}}}this.valpha=Math.max(0,Math.min(1,this.valpha));if(Object.freeze){Object.freeze(this)}}m.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(a){var b=this.model in d.to?this:this.rgb();b=b.round(typeof a==="number"?a:1);var c=b.valpha===1?b.color:b.color.concat(this.valpha);return d.to[b.model](c)},percentString:function(a){var b=this.rgb().round(typeof a==="number"?a:1);var c=b.valpha===1?b.color:b.color.concat(this.valpha);return d.to.rgb.percent(c)},array:function(){return this.valpha===1?this.color.slice():this.color.concat(this.valpha)},object:function(){var a={};var b=e[this.model].channels;var c=e[this.model].labels;for(var d=0;d<b;d++){a[c[d]]=this.color[d]}if(this.valpha!==1){a.alpha=this.valpha}return a},unitArray:function(){var a=this.rgb().color;a[0]/=255;a[1]/=255;a[2]/=255;if(this.valpha!==1){a.push(this.valpha)}return a},unitObject:function(){var a=this.rgb().object();a.r/=255;a.g/=255;a.b/=255;if(this.valpha!==1){a.alpha=this.valpha}return a},round:function(a){a=Math.max(a||0,0);return new m(this.color.map(r(a)).concat(this.valpha),this.model)},alpha:function(a){if(arguments.length>0){return new m(this.color.concat(Math.max(0,Math.min(1,a))),this.model)}return this.valpha},red:s("rgb",0,t(255)),green:s("rgb",1,t(255)),blue:s("rgb",2,t(255)),hue:s(["hsl","hsv","hsl","hwb","hcg"],0,function(a){return(a%360+360)%360}),saturationl:s("hsl",1,t(100)),lightness:s("hsl",2,t(100)),saturationv:s("hsv",1,t(100)),value:s("hsv",2,t(100)),chroma:s("hcg",1,t(100)),gray:s("hcg",2,t(100)),white:s("hwb",1,t(100)),wblack:s("hwb",2,t(100)),cyan:s("cmyk",0,t(100)),magenta:s("cmyk",1,t(100)),yellow:s("cmyk",2,t(100)),black:s("cmyk",3,t(100)),x:s("xyz",0,t(100)),y:s("xyz",1,t(100)),z:s("xyz",2,t(100)),l:s("lab",0,t(100)),a:s("lab",1),b:s("lab",2),keyword:function(a){if(arguments.length>0){return new m(a)}return e[this.model].keyword(this.color)},hex:function(a){if(arguments.length>0){return new m(a)}return d.to.hex(this.rgb().round().color)},hexa:function(a){if(arguments.length>0){return new m(a)}var b=this.rgb().round().color;var c=Math.round(this.valpha*255).toString(16).toUpperCase();if(c.length===1){c="0"+c}return d.to.hex(b)+c},rgbNumber:function(){var a=this.rgb().color;return(a[0]&255)<<16|(a[1]&255)<<8|a[2]&255},luminosity:function(){var a=this.rgb().color;var b=[];for(var c=0;c<a.length;c++){var d=a[c];var e=d/255;b[c]=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast:function(a){var b=this.luminosity();var c=a.luminosity();if(b>c){return(b+.05)/(c+.05)}return(c+.05)/(b+.05)},level:function(a){var b=this.contrast(a);if(b>=7.1){return"AAA"}return b>=4.5?"AA":""},isDark:function(){var a=this.rgb().color;var b=(a[0]*299+a[1]*587+a[2]*114)/1e3;return b<128},isLight:function(){return!this.isDark()},negate:function(){var a=this.rgb();for(var b=0;b<3;b++){a.color[b]=255-a.color[b]}return a},lighten:function(a){var b=this.hsl();b.color[2]+=b.color[2]*a;return b},darken:function(a){var b=this.hsl();b.color[2]-=b.color[2]*a;return b},saturate:function(a){var b=this.hsl();b.color[1]+=b.color[1]*a;return b},desaturate:function(a){var b=this.hsl();b.color[1]-=b.color[1]*a;return b},whiten:function(a){var b=this.hwb();b.color[1]+=b.color[1]*a;return b},blacken:function(a){var b=this.hwb();b.color[2]+=b.color[2]*a;return b},grayscale:function(){var a=this.rgb().color;var b=a[0]*.3+a[1]*.59+a[2]*.11;return m.rgb(b,b,b)},fade:function(a){return this.alpha(this.valpha-this.valpha*a)},opaquer:function(a){return this.alpha(this.valpha+this.valpha*a)},rotate:function(a){var b=this.hsl();var c=b.color[0];c=(c+a)%360;c=c<0?360+c:c;b.color[0]=c;return b},mix:function(a,b){if(!a||!a.rgb){throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof a)}var c=a.rgb();var d=this.rgb();var e=b===undefined?.5:b;var f=2*e-1;var g=c.alpha()-d.alpha();var h=((f*g===-1?f:(f+g)/(1+f*g))+1)/2;var i=1-h;return m.rgb(h*c.red()+i*d.red(),h*c.green()+i*d.green(),h*c.blue()+i*d.blue(),c.alpha()*e+d.alpha()*(1-e))}};var n=function(a){if(g.includes(a)){return"continue"}var b=e[a].channels;m.prototype[a]=function(){if(this.model===a){return new m(this)}if(arguments.length>0){return new m(arguments,a)}var c=typeof arguments[b]==="number"?b:this.valpha;return new m(u(e[this.model][a].raw(this.color)).concat(c),a)};m[a]=function(c){if(typeof c==="number"){c=v(f.call(arguments),b)}return new m(c,a)}};for(var o=0,p=Object.keys(e);o<p.length;o++){var k=p[o];n(k)}function q(a,b){return Number(a.toFixed(b))}function r(a){return function(b){return q(b,a)}}function s(a,b,c){a=Array.isArray(a)?a:[a];for(var d=0,e=a;d<e.length;d++){var f=e[d];(l[f]||(l[f]=[]))[b]=c}a=a[0];return function(d){var e;if(arguments.length>0){if(c){d=c(d)}e=this[a]();e.color[b]=d;return e}e=this[a]().color[b];if(c){e=c(e)}return e}}function t(a){return function(b){return Math.max(0,Math.min(a,b))}}function u(a){return Array.isArray(a)?a:[a]}function v(a,b){for(var c=0;c<b;c++){if(typeof a[c]!=="number"){a[c]=0}}return a}a.exports=m},"./node_modules/@kiy/color/node_modules/color-convert/conversions.js":function(a,b,c){var d=c("./node_modules/@kiy/color/node_modules/color-name/index.js");var e={};for(var f=0,g=Object.keys(d);f<g.length;f++){var h=g[f];e[d[h]]=h}var i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};a.exports=i;for(var j=0,k=Object.keys(i);j<k.length;j++){var l=k[j];if(!("channels"in i[l])){throw new Error("missing channels property: "+l)}if(!("labels"in i[l])){throw new Error("missing channel labels property: "+l)}if(i[l].labels.length!==i[l].channels){throw new Error("channel and label counts mismatch: "+l)}var m=i[l],n=m.channels,o=m.labels;delete i[l].channels;delete i[l].labels;Object.defineProperty(i[l],"channels",{value:n});Object.defineProperty(i[l],"labels",{value:o})}i.rgb.hsl=function(a){var b=a[0]/255;var c=a[1]/255;var d=a[2]/255;var e=Math.min(b,c,d);var f=Math.max(b,c,d);var g=f-e;var h;var i;if(f===e){h=0}else if(b===f){h=(c-d)/g}else if(c===f){h=2+(d-b)/g}else if(d===f){h=4+(b-c)/g}h=Math.min(h*60,360);if(h<0){h+=360}var j=(e+f)/2;if(f===e){i=0}else if(j<=.5){i=g/(f+e)}else{i=g/(2-f-e)}return[h,i*100,j*100]};i.rgb.hsv=function(a){var b;var c;var d;var e;var f;var g=a[0]/255;var h=a[1]/255;var i=a[2]/255;var j=Math.max(g,h,i);var k=j-Math.min(g,h,i);var l=function(a){return(j-a)/6/k+1/2};if(k===0){e=0;f=0}else{f=k/j;b=l(g);c=l(h);d=l(i);if(g===j){e=d-c}else if(h===j){e=1/3+b-d}else if(i===j){e=2/3+c-b}if(e<0){e+=1}else if(e>1){e-=1}}return[e*360,f*100,j*100]};i.rgb.hwb=function(a){var b=a[0];var c=a[1];var d=a[2];var e=i.rgb.hsl(a)[0];var f=1/255*Math.min(b,Math.min(c,d));d=1-1/255*Math.max(b,Math.max(c,d));return[e,f*100,d*100]};i.rgb.cmyk=function(a){var b=a[0]/255;var c=a[1]/255;var d=a[2]/255;var e=Math.min(1-b,1-c,1-d);var f=(1-b-e)/(1-e)||0;var g=(1-c-e)/(1-e)||0;var h=(1-d-e)/(1-e)||0;return[f*100,g*100,h*100,e*100]};function p(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2)}i.rgb.keyword=function(a){var b=e[a];if(b){return b}var c=Infinity;var f;for(var g=0,h=Object.keys(d);g<h.length;g++){var i=h[g];var j=d[i];var k=p(a,j);if(k<c){c=k;f=i}}return f};i.keyword.rgb=function(a){return d[a]};i.rgb.xyz=function(a){var b=a[0]/255;var c=a[1]/255;var d=a[2]/255;b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92;c=c>.04045?Math.pow((c+.055)/1.055,2.4):c/12.92;d=d>.04045?Math.pow((d+.055)/1.055,2.4):d/12.92;var e=b*.4124+c*.3576+d*.1805;var f=b*.2126+c*.7152+d*.0722;var g=b*.0193+c*.1192+d*.9505;return[e*100,f*100,g*100]};i.rgb.lab=function(a){var b=i.rgb.xyz(a);var c=b[0];var d=b[1];var e=b[2];c/=95.047;d/=100;e/=108.883;c=c>.008856?Math.pow(c,1/3):7.787*c+16/116;d=d>.008856?Math.pow(d,1/3):7.787*d+16/116;e=e>.008856?Math.pow(e,1/3):7.787*e+16/116;var f=116*d-16;var g=500*(c-d);var h=200*(d-e);return[f,g,h]};i.hsl.rgb=function(a){var b=a[0]/360;var c=a[1]/100;var d=a[2]/100;var e;var f;var g;if(c===0){g=d*255;return[g,g,g]}if(d<.5){e=d*(1+c)}else{e=d+c-d*c}var h=2*d-e;var i=[0,0,0];for(var j=0;j<3;j++){f=b+1/3*-(j-1);if(f<0){f++}if(f>1){f--}if(6*f<1){g=h+(e-h)*6*f}else if(2*f<1){g=e}else if(3*f<2){g=h+(e-h)*(2/3-f)*6}else{g=h}i[j]=g*255}return i};i.hsl.hsv=function(a){var b=a[0];var c=a[1]/100;var d=a[2]/100;var e=c;var f=Math.max(d,.01);d*=2;c*=d<=1?d:2-d;e*=f<=1?f:2-f;var g=(d+c)/2;var h=d===0?2*e/(f+e):2*c/(d+c);return[b,h*100,g*100]};i.hsv.rgb=function(a){var b=a[0]/60;var c=a[1]/100;var d=a[2]/100;var e=Math.floor(b)%6;var f=b-Math.floor(b);var g=255*d*(1-c);var h=255*d*(1-c*f);var i=255*d*(1-c*(1-f));d*=255;switch(e){case 0:return[d,i,g];case 1:return[h,d,g];case 2:return[g,d,i];case 3:return[g,h,d];case 4:return[i,g,d];case 5:return[d,g,h]}};i.hsv.hsl=function(a){var b=a[0];var c=a[1]/100;var d=a[2]/100;var e=Math.max(d,.01);var f;var g;g=(2-c)*d;var h=(2-c)*e;f=c*e;f/=h<=1?h:2-h;f=f||0;g/=2;return[b,f*100,g*100]};i.hwb.rgb=function(a){var b=a[0]/360;var c=a[1]/100;var d=a[2]/100;var e=c+d;var f;if(e>1){c/=e;d/=e}var g=Math.floor(6*b);var h=1-d;f=6*b-g;if((g&1)!==0){f=1-f}var i=c+f*(h-c);var j;var k;var l;switch(g){default:case 6:case 0:j=h;k=i;l=c;break;case 1:j=i;k=h;l=c;break;case 2:j=c;k=h;l=i;break;case 3:j=c;k=i;l=h;break;case 4:j=i;k=c;l=h;break;case 5:j=h;k=c;l=i;break}return[j*255,k*255,l*255]};i.cmyk.rgb=function(a){var b=a[0]/100;var c=a[1]/100;var d=a[2]/100;var e=a[3]/100;var f=1-Math.min(1,b*(1-e)+e);var g=1-Math.min(1,c*(1-e)+e);var h=1-Math.min(1,d*(1-e)+e);return[f*255,g*255,h*255]};i.xyz.rgb=function(a){var b=a[0]/100;var c=a[1]/100;var d=a[2]/100;var e;var f;var g;e=b*3.2406+c*-1.5372+d*-.4986;f=b*-.9689+c*1.8758+d*.0415;g=b*.0557+c*-.204+d*1.057;e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:e*12.92;f=f>.0031308?1.055*Math.pow(f,1/2.4)-.055:f*12.92;g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:g*12.92;e=Math.min(Math.max(0,e),1);f=Math.min(Math.max(0,f),1);g=Math.min(Math.max(0,g),1);return[e*255,f*255,g*255]};i.xyz.lab=function(a){var b=a[0];var c=a[1];var d=a[2];b/=95.047;c/=100;d/=108.883;b=b>.008856?Math.pow(b,1/3):7.787*b+16/116;c=c>.008856?Math.pow(c,1/3):7.787*c+16/116;d=d>.008856?Math.pow(d,1/3):7.787*d+16/116;var e=116*c-16;var f=500*(b-c);var g=200*(c-d);return[e,f,g]};i.lab.xyz=function(a){var b=a[0];var c=a[1];var d=a[2];var e;var f;var g;f=(b+16)/116;e=c/500+f;g=f-d/200;var h=Math.pow(f,3);var i=Math.pow(e,3);var j=Math.pow(g,3);f=h>.008856?h:(f-16/116)/7.787;e=i>.008856?i:(e-16/116)/7.787;g=j>.008856?j:(g-16/116)/7.787;e*=95.047;f*=100;g*=108.883;return[e,f,g]};i.lab.lch=function(a){var b=a[0];var c=a[1];var d=a[2];var e;var f=Math.atan2(d,c);e=f*360/2/Math.PI;if(e<0){e+=360}var g=Math.sqrt(c*c+d*d);return[b,g,e]};i.lch.lab=function(a){var b=a[0];var c=a[1];var d=a[2];var e=d/360*2*Math.PI;var f=c*Math.cos(e);var g=c*Math.sin(e);return[b,f,g]};i.rgb.ansi16=function(a,b){if(b===void 0){b=null}var c=a[0],d=a[1],e=a[2];var f=b===null?i.rgb.hsv(a)[2]:b;f=Math.round(f/50);if(f===0){return 30}var g=30+(Math.round(e/255)<<2|Math.round(d/255)<<1|Math.round(c/255));if(f===2){g+=60}return g};i.hsv.ansi16=function(a){return i.rgb.ansi16(i.hsv.rgb(a),a[2])};i.rgb.ansi256=function(a){var b=a[0];var c=a[1];var d=a[2];if(b===c&&c===d){if(b<8){return 16}if(b>248){return 231}return Math.round((b-8)/247*24)+232}var e=16+36*Math.round(b/255*5)+6*Math.round(c/255*5)+Math.round(d/255*5);return e};i.ansi16.rgb=function(a){var b=a%10;if(b===0||b===7){if(a>50){b+=3.5}b=b/10.5*255;return[b,b,b]}var c=(~~(a>50)+1)*.5;var d=(b&1)*c*255;var e=(b>>1&1)*c*255;var f=(b>>2&1)*c*255;return[d,e,f]};i.ansi256.rgb=function(a){if(a>=232){var b=(a-232)*10+8;return[b,b,b]}a-=16;var c;var d=Math.floor(a/36)/5*255;var e=Math.floor((c=a%36)/6)/5*255;var f=c%6/5*255;return[d,e,f]};i.rgb.hex=function(a){var b=((Math.round(a[0])&255)<<16)+((Math.round(a[1])&255)<<8)+(Math.round(a[2])&255);var c=b.toString(16).toUpperCase();return"000000".substring(c.length)+c};i.hex.rgb=function(a){var b=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b){return[0,0,0]}var c=b[0];if(b[0].length===3){c=c.split("").map(function(a){return a+a}).join("")}var d=parseInt(c,16);var e=d>>16&255;var f=d>>8&255;var g=d&255;return[e,f,g]};i.rgb.hcg=function(a){var b=a[0]/255;var c=a[1]/255;var d=a[2]/255;var e=Math.max(Math.max(b,c),d);var f=Math.min(Math.min(b,c),d);var g=e-f;var h;var i;if(g<1){h=f/(1-g)}else{h=0}if(g<=0){i=0}else if(e===b){i=(c-d)/g%6}else if(e===c){i=2+(d-b)/g}else{i=4+(b-c)/g}i/=6;i%=1;return[i*360,g*100,h*100]};i.hsl.hcg=function(a){var b=a[1]/100;var c=a[2]/100;var d=c<.5?2*b*c:2*b*(1-c);var e=0;if(d<1){e=(c-.5*d)/(1-d)}return[a[0],d*100,e*100]};i.hsv.hcg=function(a){var b=a[1]/100;var c=a[2]/100;var d=b*c;var e=0;if(d<1){e=(c-d)/(1-d)}return[a[0],d*100,e*100]};i.hcg.rgb=function(a){var b=a[0]/360;var c=a[1]/100;var d=a[2]/100;if(c===0){return[d*255,d*255,d*255]}var e=[0,0,0];var f=b%1*6;var g=f%1;var h=1-g;var i=0;switch(Math.floor(f)){case 0:e[0]=1;e[1]=g;e[2]=0;break;case 1:e[0]=h;e[1]=1;e[2]=0;break;case 2:e[0]=0;e[1]=1;e[2]=g;break;case 3:e[0]=0;e[1]=h;e[2]=1;break;case 4:e[0]=g;e[1]=0;e[2]=1;break;default:e[0]=1;e[1]=0;e[2]=h}i=(1-c)*d;return[(c*e[0]+i)*255,(c*e[1]+i)*255,(c*e[2]+i)*255]};i.hcg.hsv=function(a){var b=a[1]/100;var c=a[2]/100;var d=b+c*(1-b);var e=0;if(d>0){e=b/d}return[a[0],e*100,d*100]};i.hcg.hsl=function(a){var b=a[1]/100;var c=a[2]/100;var d=c*(1-b)+.5*b;var e=0;if(d>0&&d<.5){e=b/(2*d)}else if(d>=.5&&d<1){e=b/(2*(1-d))}return[a[0],e*100,d*100]};i.hcg.hwb=function(a){var b=a[1]/100;var c=a[2]/100;var d=b+c*(1-b);return[a[0],(d-b)*100,(1-d)*100]};i.hwb.hcg=function(a){var b=a[1]/100;var c=a[2]/100;var d=1-c;var e=d-b;var f=0;if(e<1){f=(d-e)/(1-e)}return[a[0],e*100,f*100]};i.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]};i.rgb.apple=function(a){return[a[0]/255*65535,a[1]/255*65535,a[2]/255*65535]};i.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]};i.gray.hsl=function(a){return[0,0,a[0]]};i.gray.hsv=i.gray.hsl;i.gray.hwb=function(a){return[0,100,a[0]]};i.gray.cmyk=function(a){return[0,0,0,a[0]]};i.gray.lab=function(a){return[a[0],0,0]};i.gray.hex=function(a){var b=Math.round(a[0]/100*255)&255;var c=(b<<16)+(b<<8)+b;var d=c.toString(16).toUpperCase();return"000000".substring(d.length)+d};i.rgb.gray=function(a){var b=(a[0]+a[1]+a[2])/3;return[b/255*100]}},"./node_modules/@kiy/color/node_modules/color-convert/index.js":function(a,b,c){var d=c("./node_modules/@kiy/color/node_modules/color-convert/conversions.js");var e=c("./node_modules/@kiy/color/node_modules/color-convert/route.js");var f={};var g=Object.keys(d);function h(a){var b=function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}var d=b[0];if(d===undefined||d===null){return d}if(d.length>1){b=d}return a(b)};if("conversion"in a){b.conversion=a.conversion}return b}function i(a){var b=function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}var d=b[0];if(d===undefined||d===null){return d}if(d.length>1){b=d}var e=a(b);if(typeof e==="object"){for(var f=e.length,g=0;g<f;g++){e[g]=Math.round(e[g])}}return e};if("conversion"in a){b.conversion=a.conversion}return b}g.forEach(function(a){f[a]={};Object.defineProperty(f[a],"channels",{value:d[a].channels});Object.defineProperty(f[a],"labels",{value:d[a].labels});var b=e(a);var c=Object.keys(b);c.forEach(function(c){var d=b[c];f[a][c]=i(d);f[a][c].raw=h(d)})});a.exports=f},"./node_modules/@kiy/color/node_modules/color-convert/route.js":function(a,b,c){var d=c("./node_modules/@kiy/color/node_modules/color-convert/conversions.js");function e(){var a={};var b=Object.keys(d);for(var c=b.length,e=0;e<c;e++){a[b[e]]={distance:-1,parent:null}}return a}function f(a){var b=e();var c=[a];b[a].distance=0;while(c.length){var f=c.pop();var g=Object.keys(d[f]);for(var h=g.length,i=0;i<h;i++){var j=g[i];var k=b[j];if(k.distance===-1){k.distance=b[f].distance+1;k.parent=f;c.unshift(j)}}}return b}function g(a,b){return function(c){return b(a(c))}}function h(a,b){var c=[b[a].parent,a];var e=d[b[a].parent][a];var f=b[a].parent;while(b[f].parent){c.unshift(b[f].parent);e=g(d[b[f].parent][f],e);f=b[f].parent}e.conversion=c;return e}a.exports=function(a){var b=f(a);var c={};var d=Object.keys(b);for(var e=d.length,g=0;g<e;g++){var i=d[g];var j=b[i];if(j.parent===null){continue}c[i]=h(i,b)}return c}},"./node_modules/@kiy/color/node_modules/color-name/index.js":function(a){"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},"./node_modules/@kiy/color/node_modules/color-string/index.js":function(a,b,c){var d=c("./node_modules/@kiy/color/node_modules/color-name/index.js");var e=c("./node_modules/simple-swizzle/index.js");var f=Object.hasOwnProperty;var g={};for(var h in d){if(f.call(d,h)){g[d[h]]=h}}var i=a.exports={to:{},get:{}};i.get=function(a){var b=a.substring(0,3).toLowerCase();var c;var d;switch(b){case"hsl":c=i.get.hsl(a);d="hsl";break;case"hwb":c=i.get.hwb(a);d="hwb";break;default:c=i.get.rgb(a);d="rgb";break}if(!c){return null}return{model:d,value:c}};i.get.rgb=function(a){if(!a){return null}var b=/^#([a-f0-9]{3,4})$/i;var c=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i;var e=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/;var g=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/;var h=/^(\w+)$/;var i=[0,0,0,1];var k;var l;var m;if(k=a.match(c)){m=k[2];k=k[1];for(l=0;l<3;l++){var n=l*2;i[l]=parseInt(k.slice(n,n+2),16)}if(m){i[3]=parseInt(m,16)/255}}else if(k=a.match(b)){k=k[1];m=k[3];for(l=0;l<3;l++){i[l]=parseInt(k[l]+k[l],16)}if(m){i[3]=parseInt(m+m,16)/255}}else if(k=a.match(e)){for(l=0;l<3;l++){i[l]=parseInt(k[l+1],0)}if(k[4]){if(k[5]){i[3]=parseFloat(k[4])*.01}else{i[3]=parseFloat(k[4])}}}else if(k=a.match(g)){for(l=0;l<3;l++){i[l]=Math.round(parseFloat(k[l+1])*2.55)}if(k[4]){if(k[5]){i[3]=parseFloat(k[4])*.01}else{i[3]=parseFloat(k[4])}}}else if(k=a.match(h)){if(k[1]==="transparent"){return[0,0,0,0]}if(!f.call(d,k[1])){return null}i=d[k[1]];i[3]=1;return i}else{return null}for(l=0;l<3;l++){i[l]=j(i[l],0,255)}i[3]=j(i[3],0,1);return i};i.get.hsl=function(a){if(!a){return null}var b=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/;var c=a.match(b);if(c){var d=parseFloat(c[4]);var e=(parseFloat(c[1])%360+360)%360;var f=j(parseFloat(c[2]),0,100);var g=j(parseFloat(c[3]),0,100);var h=j(isNaN(d)?1:d,0,1);return[e,f,g,h]}return null};i.get.hwb=function(a){if(!a){return null}var b=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/;var c=a.match(b);if(c){var d=parseFloat(c[4]);var e=(parseFloat(c[1])%360+360)%360;var f=j(parseFloat(c[2]),0,100);var g=j(parseFloat(c[3]),0,100);var h=j(isNaN(d)?1:d,0,1);return[e,f,g,h]}return null};i.to.hex=function(){var a=e(arguments);return"#"+k(a[0])+k(a[1])+k(a[2])+(a[3]<1?k(Math.round(a[3]*255)):"")};i.to.rgb=function(){var a=e(arguments);return a.length<4||a[3]===1?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"};i.to.rgb.percent=function(){var a=e(arguments);var b=Math.round(a[0]/255*100);var c=Math.round(a[1]/255*100);var d=Math.round(a[2]/255*100);return a.length<4||a[3]===1?"rgb("+b+"%, "+c+"%, "+d+"%)":"rgba("+b+"%, "+c+"%, "+d+"%, "+a[3]+")"};i.to.hsl=function(){var a=e(arguments);return a.length<4||a[3]===1?"hsl("+a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"};i.to.hwb=function(){var a=e(arguments);var b="";if(a.length>=4&&a[3]!==1){b=", "+a[3]}return"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+b+")"};i.to.keyword=function(a){return g[a.slice(0,3)]};function j(a,b,c){return Math.min(Math.max(b,a),c)}function k(a){var b=Math.round(a).toString(16).toUpperCase();return b.length<2?"0"+b:b}},"./node_modules/micro-events/index.js":function(a){function b(a,b,c){for(var d=0;d<a.length;d++){b.call(c,a[d])}}function c(a,b){var c=a.indexOf(b);if(c!==-1){a.splice(c,1)}}function d(a,b){return a.indexOf(b)!==-1}function e(){this.listeners={}}e.prototype.maxListeners=10;function f(a){if(typeof a!=="string"){throw"eventName is not a string"}}function g(a){if(typeof a!=="function"){throw"listener is not a function"}}e.prototype.on=function(a,b){f(a);g(b);this.listeners[a]=this.listeners[a]||[];if(this.listeners[a].length>this.maxListeners){throw"Exceeded maxListeners - You might have a memory leak"}if(!d(this.listeners[a],b)){this.listeners[a].push(b);this.emit("on",{eventName:a,listener:b})}return this};e.prototype.emit=function(a,c){f(a);var d=Array.prototype.slice.call(arguments,1);b(this.listeners[a]||[],function(a){a.apply(this,d)},this);return this};e.prototype.off=function(a,b){f(a);g(b);c(this.listeners[a]||[],b);this.emit("off",{eventName:a,listener:b});return this};e.prototype.clearListeners=function(a){f(a);this.listeners[a]=null;return this};a.exports=e},"./node_modules/postcss-media-query-parser/dist/index.js":function(a,exports,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=g;var c=b("./node_modules/postcss-media-query-parser/dist/nodes/Container.js");var d=f(c);var e=b("./node_modules/postcss-media-query-parser/dist/parsers.js");function f(a){return a&&a.__esModule?a:{default:a}}function g(a){return new d.default({nodes:(0,e.parseMediaList)(a),type:"media-query-list",value:a.trim()})}},"./node_modules/postcss-media-query-parser/dist/nodes/Container.js":function(a,exports,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=b("./node_modules/postcss-media-query-parser/dist/nodes/Node.js");var d=e(c);function e(a){return a&&a.__esModule?a:{default:a}}function f(a){var b=this;this.constructor(a);this.nodes=a.nodes;if(this.after===undefined){this.after=this.nodes.length>0?this.nodes[this.nodes.length-1].after:""}if(this.before===undefined){this.before=this.nodes.length>0?this.nodes[0].before:""}if(this.sourceIndex===undefined){this.sourceIndex=this.before.length}this.nodes.forEach(function(a){a.parent=b})}f.prototype=Object.create(d.default.prototype);f.constructor=d.default;f.prototype.walk=function a(b,c){var d=typeof b==="string"||b instanceof RegExp;var e=d?c:b;var f=typeof b==="string"?new RegExp(b):b;for(var g=0;g<this.nodes.length;g++){var h=this.nodes[g];var i=d?f.test(h.type):true;if(i&&e&&e(h,g,this.nodes)===false){return false}if(h.nodes&&h.walk(b,c)===false){return false}}return true};f.prototype.each=function a(){var b=arguments.length<=0||arguments[0]===undefined?function(){}:arguments[0];for(var c=0;c<this.nodes.length;c++){var d=this.nodes[c];if(b(d,c,this.nodes)===false){return false}}return true};exports["default"]=f},"./node_modules/postcss-media-query-parser/dist/nodes/Node.js":function(a,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(a){this.after=a.after;this.before=a.before;this.type=a.type;this.value=a.value;this.sourceIndex=a.sourceIndex}exports["default"]=b},"./node_modules/postcss-media-query-parser/dist/parsers.js":function(a,exports,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseMediaFeature=h;exports.parseMediaQuery=i;exports.parseMediaList=j;var c=b("./node_modules/postcss-media-query-parser/dist/nodes/Node.js");var d=g(c);var e=b("./node_modules/postcss-media-query-parser/dist/nodes/Container.js");var f=g(e);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){var b=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var c=[{mode:"normal",character:null}];var d=[];var e=0;var f="";var g=null;var h=null;var i=b;var j=a;if(a[0]==="("&&a[a.length-1]===")"){j=a.substring(1,a.length-1);i++}for(var k=0;k<j.length;k++){var l=j[k];if(l==="'"||l==='"'){if(c[e].isCalculationEnabled===true){c.push({mode:"string",isCalculationEnabled:false,character:l});e++}else if(c[e].mode==="string"&&c[e].character===l&&j[k-1]!=="\\"){c.pop();e--}}if(l==="{"){c.push({mode:"interpolation",isCalculationEnabled:true});e++}else if(l==="}"){c.pop();e--}if(c[e].mode==="normal"&&l===":"){var m=j.substring(k+1);h={type:"value",before:/^(\s*)/.exec(m)[1],after:/(\s*)$/.exec(m)[1],value:m.trim()};h.sourceIndex=h.before.length+k+1+i;g={type:"colon",sourceIndex:k+i,after:h.before,value:":"};break}f+=l}f={type:"media-feature",before:/^(\s*)/.exec(f)[1],after:/(\s*)$/.exec(f)[1],value:f.trim()};f.sourceIndex=f.before.length+i;d.push(f);if(g!==null){g.before=f.after;d.push(g)}if(h!==null){d.push(h)}return d}function i(a){var b=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var c=[];var e=0;var g=false;var i=void 0;function j(){return{before:"",after:"",value:""}}i=j();for(var k=0;k<a.length;k++){var l=a[k];if(!g){if(l.search(/\s/)!==-1){i.before+=l}else{if(l==="("){i.type="media-feature-expression";e++}i.value=l;i.sourceIndex=b+k;g=true}}else{i.value+=l;if(l==="{"||l==="("){e++}if(l===")"||l==="}"){e--}}if(g&&e===0&&(l===")"||k===a.length-1||a[k+1].search(/\s/)!==-1)){if(["not","only","and"].indexOf(i.value)!==-1){i.type="keyword"}if(i.type==="media-feature-expression"){i.nodes=h(i.value,i.sourceIndex)}c.push(Array.isArray(i.nodes)?new f.default(i):new d.default(i));i=j();g=false}}for(var m=0;m<c.length;m++){i=c[m];if(m>0){c[m-1].after=i.before}if(i.type===undefined){if(m>0){if(c[m-1].type==="media-feature-expression"){i.type="keyword";continue}if(c[m-1].value==="not"||c[m-1].value==="only"){i.type="media-type";continue}if(c[m-1].value==="and"){i.type="media-feature-expression";continue}if(c[m-1].type==="media-type"){if(!c[m+1]){i.type="media-feature-expression"}else{i.type=c[m+1].type==="media-feature-expression"?"keyword":"media-feature-expression"}}}if(m===0){if(!c[m+1]){i.type="media-type";continue}if(c[m+1]&&(c[m+1].type==="media-feature-expression"||c[m+1].type==="keyword")){i.type="media-type";continue}if(c[m+2]){if(c[m+2].type==="media-feature-expression"){i.type="media-type";c[m+1].type="keyword";continue}if(c[m+2].type==="keyword"){i.type="keyword";c[m+1].type="media-type";continue}}if(c[m+3]){if(c[m+3].type==="media-feature-expression"){i.type="keyword";c[m+1].type="media-type";c[m+2].type="keyword";continue}}}}}return c}function j(a){var b=[];var c=0;var e=0;var g=/^(\s*)url\s*\(/.exec(a);if(g!==null){var h=g[0].length;var j=1;while(j>0){var k=a[h];if(k==="("){j++}if(k===")"){j--}h++}b.unshift(new d.default({type:"url",value:a.substring(0,h).trim(),sourceIndex:g[1].length,before:g[1],after:/^(\s*)/.exec(a.substring(h))[1]}));c=h}for(var l=c;l<a.length;l++){var m=a[l];if(m==="("){e++}if(m===")"){e--}if(e===0&&m===","){var n=a.substring(c,l);var o=/^(\s*)/.exec(n)[1];b.push(new f.default({type:"media-query",value:n.trim(),sourceIndex:c+o.length,nodes:i(n,c),before:o,after:/(\s*)$/.exec(n)[1]}));c=l+1}}var p=a.substring(c);var q=/^(\s*)/.exec(p)[1];b.push(new f.default({type:"media-query",value:p.trim(),sourceIndex:c+q.length,nodes:i(p,c),before:q,after:/(\s*)$/.exec(p)[1]}));return b}},"./node_modules/simple-swizzle/index.js":function(a,b,c){"use strict";var d=c("./node_modules/simple-swizzle/node_modules/is-arrayish/index.js");var e=Array.prototype.concat;var f=Array.prototype.slice;var g=a.exports=function a(b){var c=[];for(var g=0,h=b.length;g<h;g++){var i=b[g];if(d(i)){c=e.call(c,f.call(i))}else{c.push(i)}}return c};g.wrap=function(a){return function(){return a(g(arguments))}}},"./node_modules/simple-swizzle/node_modules/is-arrayish/index.js":function(a){a.exports=function a(b){if(!b||typeof b==="string"){return false}return b instanceof Array||Array.isArray(b)||b.length>=0&&(b.splice instanceof Function||Object.getOwnPropertyDescriptor(b,b.length-1)&&b.constructor.name!=="String")}}};var b={};function c(d){var e=b[d];if(e!==undefined){return e.exports}var f=b[d]={exports:{}};a[d](f,f.exports,c);return f.exports}!function(){c.n=function(a){var b=a&&a.__esModule?function(){return a["default"]}:function(){return a};c.d(b,{a:b});return b}}();!function(){c.d=function(exports,a){for(var b in a){if(c.o(a,b)&&!c.o(exports,b)){Object.defineProperty(exports,b,{enumerable:true,get:a[b]})}}}}();!function(){c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}}();!function(){c.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})}}();var d={};!function(){"use strict";c.r(d);c.d(d,{Analytics:function(){return H},AnalyticsEvent:function(){return E},SyncPromise:function(){return L},TransformerMode:function(){return T},TransformerStatus:function(){return U},createDarkosha:function(){return Oa}});var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};function b(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var e=function(){e=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return e.apply(this,arguments)};function f(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c}function g(a,b,c,d){var e=arguments.length,f=e<3?b:d===null?d=Object.getOwnPropertyDescriptor(b,c):d,g;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")f=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)if(g=a[h])f=(e<3?g(f):e>3?g(b,c,f):g(b,c))||f;return e>3&&f&&Object.defineProperty(b,c,f),f}function h(a,b){return function(c,d){b(c,d,a)}}function i(a,b){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(a,b)}function j(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})}function k(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}}var l=Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]};function m(a,b){for(var c in a)if(c!=="default"&&!Object.prototype.hasOwnProperty.call(b,c))l(b,a,c)}function n(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){if(a&&d>=a.length)a=void 0;return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;var d=c.call(a),e,f=[],g;try{while((b===void 0||b-- >0)&&!(e=d.next()).done)f.push(e.value)}catch(a){g={error:a}}finally{try{if(e&&!e.done&&(c=d["return"]))c.call(d)}finally{if(g)throw g.error}}return f}function p(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(o(arguments[b]));return a}function q(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function r(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))}function s(a){return this instanceof s?(this.v=a,this):new s(a)}function t(a,b,c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=c.apply(a,b||[]),e,f=[];return e={},g("next"),g("throw"),g("return"),e[Symbol.asyncIterator]=function(){return this},e;function g(a){if(d[a])e[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})}}function h(a,b){try{i(d[a](b))}catch(a){l(f[0][3],a)}}function i(a){a.value instanceof s?Promise.resolve(a.value.v).then(j,k):l(f[0][2],a)}function j(a){h("next",a)}function k(a){h("throw",a)}function l(a,b){if(a(b),f.shift(),f.length)h(f[0][0],f[0][1])}}function u(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:s(a[d](b)),done:d==="return"}:e?e(b):b}:e}}function v(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b=a[Symbol.asyncIterator],c;return b?b.call(a):(a=typeof n==="function"?n(a):a[Symbol.iterator](),c={},d("next"),d("throw"),d("return"),c[Symbol.asyncIterator]=function(){return this},c);function d(b){c[b]=a[b]&&function(c){return new Promise(function(d,f){c=a[b](c),e(d,f,c.done,c.value)})}}function e(a,b,c,d){Promise.resolve(d).then(function(b){a({value:b,done:c})},b)}}function w(a,b){if(Object.defineProperty){Object.defineProperty(a,"raw",{value:b})}else{a.raw=b}return a}var x=Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b};function y(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))l(b,a,c);x(b,a);return b}function z(a){return a&&a.__esModule?a:{default:a}}function A(a,b,c,d){if(c==="a"&&!d)throw new TypeError("Private accessor was defined without a getter");if(typeof b==="function"?a!==b||!d:!b.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return c==="m"?d:c==="a"?d.call(a):d?d.value:b.get(a)}function B(a,b,c,d,e){if(d==="m")throw new TypeError("Private method is not writable");if(d==="a"&&!e)throw new TypeError("Private accessor was defined without a setter");if(typeof b==="function"?a!==b||!e:!b.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return d==="a"?e.call(a,c):e?e.value=c:b.set(a,c),c}var C=c("./node_modules/micro-events/index.js");var D=c.n(C);var E;(function(a){a["All"]="*";a["Start"]="start";a["Success"]="success";a["Fail"]="fail";a["StartTransform"]="start:transform";a["SuccessTransform"]="success:transform";a["FailTransform"]="fail:transform";a["DisabledTransform"]="disabled:transform";a["DetectMediaQuery"]="detect:media-query";a["SuccessClipboard"]="success:clipboard";a["FailClipboard"]="fail:clipboard"})(E||(E={}));var F;(function(a){a["execCommand"]="execCommand";a["customRange"]="customRange"})(F||(F={}));var G=function(){function a(){}a.prototype.create=function(a,b){return{type:a,data:e({ts:performance.now()},b)}};a.prototype.mark=function(a){var b;var c=(b=window.performance)===null||b===void 0?void 0:b.now();return function(){var b;var d=(b=window.performance)===null||b===void 0?void 0:b.now();var e=Math.round(d-c);a(e)}};return a}();var H=function(){function a(){this._emitter=new(D());this._events=new G}a.prototype.emit=function(a,b){var c=this._events.create(a,b);this._emitter.emit("*",c);this._emitter.emit(a,c)};a.prototype.mark=function(a){return this._events.mark(a)};a.prototype.on=function(a,b){this._emitter.on(a,b)};a.prototype.off=function(a,b){this._emitter.off(a,b)};return a}();var I;function J(a){return typeof a==="function"}function K(a){if(a&&(typeof a==="object"||typeof a==="function")){var b=a.then;if(typeof b==="function"){return b}}}var L=function(){function a(a,b){var c=this;if(b===void 0){b=false}this._promiseValue=undefined;this._promiseError=undefined;this._status=0;this._onSettle=[];this._async=false;this[I]="[SyncPromise]";this._async=b;var d=function(){var a=c._onSettle;c._onSettle=[];if(c._async){setTimeout(function(){for(var b=0,c=a;b<c.length;b++){var d=c[b];d()}},1)}else{for(var b=0,d=a;b<d.length;b++){var e=d[b];e()}}};var e=function(a){if(c._status!==0){return}if(a===c){f(new TypeError("Promise cannot be resolved with itself"))}var b=false;try{var g=K(a);if(g){g.call(a,function(a){if(!b){b=true;e(a)}},function(a){if(!b){b=true;f(a)}})}else{c._promiseValue=a;c._status=1;d()}}catch(a){if(!b){f(a)}}};var f=function(a){if(c._status!==0){return}if(a===c){f(new TypeError("Promise cannot be resolved with itself"))}c._promiseError=a;c._status=2;d()};try{a(e,f)}catch(a){f(a)}}a.prototype.then=function(b,c){var d=this;return new a(function(a,e){var f=function(){try{if(d._status===1){a(J(b)?b(d._promiseValue):d._promiseValue)}else if(J(c)){a(c(d._promiseError))}else{e(d._promiseError)}}catch(a){e(a)}};if(d._status===0){d._onSettle.push(f)}else if(d._async){setTimeout(f,1)}else{f()}},this._async)};a.prototype.catch=function(a){return this.then(function(a){return a},a)};a.prototype.finally=function(a){return this.then(function(){return a()},function(){return a()})};Object.defineProperty(a,(I=Symbol.toStringTag,Symbol.species),{get:function(){return a},enumerable:false,configurable:true});a.all=function(a){return Promise.all(a)};a.allSettled=function(a){return Promise.allSettled(a)};a.race=function(a){return Promise.race(a)};a.resolve=function(b){return new a(function(a){a(b)})};a.reject=function(b){return new a(function(a,c){c(b)})};a.unwrap=function(a){return new Promise(function(b,c){a.then(b,c)})};return a}();function M(a){return a&&typeof a==="object"&&typeof a["then"]==="function"}function N(a,b,c){if(c===void 0){c=undefined}return new L(function(d,e){var f=false;var g=c;var h=0;var i=function(){if(h>=a.length){return L.resolve()}var c=b(a[h],function(a){f=true;g=a});if(!M(c)){c=L.resolve()}return c.then(function(){h++;if(!f&&h<a.length){return i()}})};return i().then(function(){return d(g)}).catch(function(a){return e(a)})})}var O=[{property:"name",enumerable:false},{property:"message",enumerable:false},{property:"stack",enumerable:false},{property:"code",enumerable:true}];var P=Symbol(".toJSON called");var Q=function(a){a[P]=true;var b=a.toJSON();delete a[P];return b};var R=function(a){var b=a.from,c=a.seen,d=a.to_,e=a.forceEnumerable,f=a.maxDepth,g=a.depth;var h=d||(Array.isArray(b)?[]:{});c.push(b);if(g>=f){return h}if(typeof b.toJSON==="function"&&b[P]!==true){return Q(b)}for(var i=0,j=Object.entries(b);i<j.length;i++){var k=j[i],l=k[0],m=k[1];if(typeof Buffer==="function"&&Buffer.isBuffer(m)){h[l]="[object Buffer]";continue}if(typeof m==="function"){continue}if(!m||typeof m!=="object"){h[l]=m;continue}if(!c.includes(b[l])){g++;h[l]=R({from:b[l],seen:c.slice(),forceEnumerable:e,maxDepth:f,depth:g});continue}h[l]="[Circular]"}for(var n=0,o=O;n<o.length;n++){var p=o[n],q=p.property,r=p.enumerable;if(typeof b[q]==="string"){Object.defineProperty(h,q,{value:b[q],enumerable:e?true:r,configurable:true,writable:true})}}return h};var S=function(a){var b=Number.POSITIVE_INFINITY;if(typeof a==="object"&&a!==null){return R({from:a,seen:[],forceEnumerable:true,maxDepth:b,depth:0})}if(typeof a==="function"){return"[Function: ".concat(a.name||"anonymous","]")}return a};var T;(function(a){a["ToLight"]="to_light";a["ToDark"]="to_dark"})(T||(T={}));var U;(function(a){a["Transformed"]="transformed";a["Rejected"]="rejected";a["Disabled"]="disabled";a["Skipped"]="skipped";a["Intact"]="intact"})(U||(U={}));var V="data-darkosha-skip";var W="data-darkosha-id";function X(a){while(a){if(a.hasAttribute(W)){return a}a=a.parentElement}}var Y=function(){function a(a,b){var c=this;this.id=a;this.factory=b;this._attributes={};this._firstRun=true;this._nodeFilter={acceptNode:function(a){var b=a;if(!c.shouldTransformNode(a)){return NodeFilter.FILTER_REJECT}if(b.hasAttribute&&b.getAttribute&&b.hasAttribute(W)&&b.getAttribute(W)!==c.id){var d=c.factory.find(b.getAttribute(W));if(d){c._isolatedNodes.push(b);return NodeFilter.FILTER_REJECT}}return NodeFilter.FILTER_ACCEPT}}}a.prototype.claim=function(a){a.setAttribute(W,this.id)};a.prototype.hasTransformerId=function(a){return a.hasAttribute(W)};a.prototype.getTransformerId=function(a){return this.hasTransformerId(a)?a.getAttribute(W):undefined};a.prototype.apply=function(a,b,c){var d=this;var e=this.factory;var f;var g=U.Rejected;var h=e.getAnalytics().mark(function(b){if(f){e.getAnalytics().emit(E.FailTransform,{transformer:d.name,mode:a,duration:b,error:S(f),errorRaw:f})}else if(g===U.Transformed){e.getAnalytics().emit(E.SuccessTransform,{transformer:d.name,mode:a,duration:b,cache:!d._firstRun,async:d.factory.getWorkFrame().isAsync()})}else{e.getAnalytics().emit(E.DisabledTransform,{transformer:d.name,mode:a,duration:b})}});e.getAnalytics().emit(E.StartTransform,{transformer:this.name,mode:a});if(!this.isEnabled(a)){g=U.Disabled;h();return L.resolve(g)}if(!this.shouldTransform(a,b)){g=U.Transformed;h();return L.resolve(g)}this._isolatedNodes=[];var i;try{this.claim(b);var j=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,this._nodeFilter.acceptNode);var k=j.currentNode;i=function(a){try{if(!k){a(undefined);return{sync:false}}var b=k;k=j.nextNode();var c=!d.factory.getWorkFrame().runIfAsync(function(){return a(b)});return{sync:c,data:c?b:undefined}}catch(a){f=a;return{sync:true,data:undefined}}}}catch(a){f=a}return(i?this.process(a,i):L.reject(f)).then(function(b){g=b;d.setStoredAttribute("mode",a);return N(d._isolatedNodes,function(b){var c=e.find(b.getAttribute(W));if(c){return c.apply(a,b)}})}).catch(function(a){f=a}).then(function(){h();d._firstRun=false;return g})};a.prototype.destroy=function(){};a.prototype.setNodeTransformAllowed=function(a,b){if(this.shouldTransformNode(a)===b){return}if(b){a.removeAttribute(V)}else{a.setAttribute(V,V)}};a.prototype.getStoredMode=function(){var a;return(a=this.getStoredAttribute("mode"))!==null&&a!==void 0?a:T.ToLight};a.prototype.shouldTransformNode=function(a){return!a.hasAttribute(V)};a.prototype.getStoredAttribute=function(a){return this._attributes[a]};a.prototype.setStoredAttribute=function(a,b){this._attributes[a]=b};a.prototype.shouldTransform=function(a,b){return this.getStoredAttribute("mode")!==a};a.prototype.isEnabled=function(a){var b=this.factory.config;if(!Array.isArray(b.transformers[this.name])){return false}return b.transformers[this.name].includes(a)};return a}();var Z={target:undefined,baseColor:{r:31,g:31,b:31},contrastRatio:4.5,async:false,asyncAutoThreshold:100,asyncMaxFrameDuration:20,sneaky:false,sneakyTransition:"opacity .2s ease-in-out",transformers:{"color-contrast":[],"media-query":[],combined:[T.ToDark,T.ToLight]},rollbackOnCopy:false,onError:function(a){console.error("[Darkosha]",a)}};var _={};function aa(a){if(!_[a.type]){return}for(var b=0,c=_[a.type];b<c.length;b++){var d=c[b];var e=d.instances[0];if(e){d.handler(a,e)}}}function ba(a,b,c){if(!_[b]){_[b]=[{handler:c,instances:[a]}];window.addEventListener(b,aa);return}for(var d=0,e=_[b];d<e.length;d++){var f=e[d];if(f.handler===c){f.instances.push(a);return}}_[b].push({handler:c,instances:[a]})}function ca(a,b,c){if(_[b]){var d=_[b];_[b]=[];for(var e=0,f=d;e<f.length;e++){var g=f[e];if(g.handler!==c){continue}var h=g.instances;g.instances=[];for(var i=0,j=h;i<j.length;i++){var k=j[i];if(k!==a){g.instances.push(k)}}if(g.instances.length){_[b].push(g)}}if(!_[b].length){window.removeEventListener(b,aa);delete _[b]}}}var da=c("./node_modules/@kiy/color/index.js");var ea=c.n(da);var fa=-1;var ga="__darkoshaNodeId__";var ha=function(){function a(){this._store={};this._clean=true;this._claimAndGetNodeId=function(a){if(!a[ga]){a[ga]="node_".concat(++fa)}return a[ga]}}a.prototype.saveNodeStyle=function(a,b,c,d){if(d===void 0){d=false}var e=this._claimAndGetNodeId(a);this._store[e]=this._store[e]||{};this._store[e]["style_".concat(b).concat(d?"_important":"")]=c;this._clean=false};a.prototype.saveNodeAttr=function(a,b,c){var d=this._claimAndGetNodeId(a);this._store[d]=this._store[d]||{};this._store[d]["attr_".concat(b)]=c;this._clean=false};a.prototype.restoreNodeStyle=function(a){var b=this._claimAndGetNodeId(a);var c=this._store[b];if(c){var d=Object.keys(c);for(var e=0,f=d;e<f.length;e++){var g=f[e];var h=g.split("_"),i=h[0],j=h[1],k=h[2];var l=c[g];switch(i){case"style":a.style.setProperty(j,l,k);break;case"attr":a.setAttribute(j,l);break}}}};a.prototype.clear=function(){this._store={};this._clean=true};return a}();var ia=["top","right","bottom","left"];function ja(a){return"rgb(".concat(a.r,", ").concat(a.g,", ").concat(a.b,")")}var ka=function(a){b(c,a);function c(){var b=a!==null&&a.apply(this,arguments)||this;b.name="color-contrast";b._darkStore=new ha;b._lightStore=new ha;b._getFixedForegroundColor=function(a,b,c){var d=a.lab().array();var e;var f=b.lab().array()[0];var g=50;var h=50+c;var i=(h+g)/2;e=d[0]*((100-c)/100)+c;if(f>i){e=Math.min(e,2*i-e);e=(e-c)*(g-c)/(i-c)+c}else{e=Math.max(e,2*i-e);e=100-(100-e)*(100-h)/(100-i)}return ea().lab(e,d[1],d[2]).rgb()};return b}c.prototype.test=function(a){return true};c.prototype.destroy=function(){a.prototype.destroy.call(this);this._lightStore.clear();this._darkStore.clear()};c.prototype.process=function(a,b){var c=this;var d;var e=new(ea())(this.factory.config.baseColor);var f=ja(this.factory.config.baseColor);var g=[];var h=false;return this.factory.getWorkFrame().asyncWork(b,function(b,i){if(!d){d=b}if(!b){i();return}if(!c.shouldTransformNode(b)){return}g.push(b);if(a===T.ToDark){if(!c.getStoredAttribute("scanned")){c._computeAndSaveStyles(b,e)}else if(c.getStoredAttribute("color")!==f){c._lightStore.restoreNodeStyle(b);h=true}}}).then(function(){c.setStoredAttribute("color",f);if(a===T.ToDark){c.setStoredAttribute("scanned","true")}if(h){return c.factory.getWorkFrame().asyncIterate(g,function(a){c._computeAndSaveStyles(a,e)})}}).then(function(){var b=a===T.ToDark?c._darkStore:c._lightStore;return c.factory.getWorkFrame().asyncIterate(g,function(a){b.restoreNodeStyle(a)})}).then(function(){return U.Transformed})};c.prototype.shouldTransform=function(b,c){var d=a.prototype.shouldTransform.call(this,b,c);if(b===T.ToLight){return d}var e=ja(this.factory.config.baseColor);return d||this.getStoredAttribute("color")!==e};c.prototype._computeAndSaveStyles=function(a,b){var c=b.lab().array()[0];var d=window.getComputedStyle(a);var e=new(ea())(d.getPropertyValue("color")||undefined);var f=a.getAttribute("color");if(!this._isValidContrast(e,b)){e=this._getFixedForegroundColor(e,b,c);this._setNodeStyleProperty(a,"color",e.hex());if(f){this._setNodeAttr(a,"color",e.hex())}}var g=a.style.backgroundColor;var h=d.backgroundColor?new(ea())(d.backgroundColor):new(ea())(g||undefined);var i=a.getAttribute("bgcolor");if(!this._isValidContrast(h,e)){h=this._getFixedForegroundColor(h,e,c);this._setNodeStyleProperty(a,"background-color",h.hex());if(i){this._setNodeAttr(a,"bgcolor",h.hex())}}var j;var k;var l;for(var m=0,n=ia;m<n.length;m++){var o=n[m];k="border-".concat(o,"-color");l=d[k];if(l!==undefined&&l.length){j=new(ea())(l);if(this._isValidContrast(h,j)){j=this._getFixedForegroundColor(h,j,c);this._setNodeStyleProperty(a,k,j.hex())}}}};c.prototype._setNodeStyleProperty=function(a,b,c){var d=a.style.getPropertyPriority(b)==="important";this._lightStore.saveNodeStyle(a,b,a.style.getPropertyValue(b),d);this._darkStore.saveNodeStyle(a,b,c,true)};c.prototype._setNodeAttr=function(a,b,c){this._lightStore.saveNodeAttr(a,b,a.getAttribute(b));this._darkStore.saveNodeAttr(a,b,c)};c.prototype._isValidContrast=function(a,b){return a.contrast(b)>=this.factory.config.contrastRatio};return c}(Y);var la=function(){function a(a){var b=this;this._workFrame=a;this._buffer=[];this.next=function(a){if(b._buffer.length){if(b._workFrame.runIfAsync(function(){return a(b._buffer.pop())})){return{sync:false}}return{sync:true,data:b._buffer.pop()}}b._subscription=a;return{sync:false}}}a.prototype.push=function(a){var b=this;if(this._subscription){if(!this._workFrame.runIfAsync(function(){return b._pushToSubscription(a)})){this._pushToSubscription(a)}}else{this._buffer.unshift(a)}};a.prototype._pushToSubscription=function(a){var b=this._subscription;this._subscription=undefined;b(a)};return a}();var ma=c("./node_modules/postcss-media-query-parser/dist/index.js");var na=4;function oa(a){var b;for(var c=0;c<document.styleSheets.length;c++){b=document.styleSheets[c];if(b.ownerNode===a||window.__DARKOSHA_TEST__){return b}}}function pa(a,b,c){if(a.type===b){c(a)}if(Array.isArray(a.nodes)){for(var d=0,e=a.nodes;d<e.length;d++){var f=e[d];pa(f,b,c)}}}function qa(a,b){var c=a.parent;if(!c||!Array.isArray(c.nodes)){return}var d=c.nodes.findIndex(function(b){return b===a});if(d===-1){return}c.nodes[d]=b;b.parent=c}function ra(a){var b,c,d;switch(a.type){case"media-feature-expression":return"(".concat(a.nodes.map(function(a){return ra(a)}).join(""),")");case"media-query":return a.nodes.map(function(a){return ra(a)}).join("");case"media-query-list":return a.nodes.map(function(a){return ra(a)}).join(",");case"colon":case"keyword":case"value":case"media-type":case"media-feature":case"url":default:return((b=a.before)!==null&&b!==void 0?b:"")+((c=a.value)!==null&&c!==void 0?c:"")+((d=a.after)!==null&&d!==void 0?d:"")}}function sa(a){var b=e({},a);if(Array.isArray(a.nodes)){b.nodes=[];for(var c=0,d=a.nodes;c<d.length;c++){var f=d[c];f=sa(f);f.parent=b;b.nodes.push(f)}}return b}var ta=function(a){b(c,a);function c(){var b=a!==null&&a.apply(this,arguments)||this;b.name="media-query";b._originalCssMediaText=[];return b}c.prototype.test=function(a){return/\(\s*prefers-color-scheme:\s*(dark|light)\s*\)/gi.test(a.innerHTML)};c.prototype.process=function(a,b){var c=this;var d;return this.factory.getWorkFrame().asyncWork(b,function(b,e){if(!d){d=b}if(c.getStoredAttribute("scanned")||!b){e();return}if(b.tagName!=="STYLE"){return}c._queryStyleSheet(b,a)}).then(function(){if(c.getStoredAttribute("scanned")){c.queryAndTransformMediaRules(a)}c.setStoredAttribute("scanned","true");return c._originalCssMediaText.length?U.Transformed:U.Rejected})};c.prototype.queryAndTransformMediaRules=function(a,b){if(this.getStoredAttribute("scanned")){for(var c=0,d=this._originalCssMediaText;c<d.length;c++){var e=d[c];this._patchMediaRule(e,a)}return this._originalCssMediaText}if(b){this._queryStyleSheet(b,a)}return this._originalCssMediaText};c.prototype.isFirstScanned=function(){return!!this.getStoredAttribute("scanned")};c.prototype.finishFirstScan=function(){this.setStoredAttribute("scanned","true")};c.prototype._queryStyleSheet=function(a,b){var c=oa(a);var d;if(!c){return}for(var e=0;e<c.cssRules.length;e++){d=c.cssRules[e];if(d.type!==na){continue}var f={rule:d,raw:d.media.mediaText};this._originalCssMediaText.push(f);this._patchMediaRule(f,b)}};c.prototype._patchMediaRule=function(a,b){var c;a.parsed=(c=a.parsed)!==null&&c!==void 0?c:(0,ma["default"])(a.raw);var d=sa(a.parsed);pa(d,"media-feature",function(c){if(c.value==="prefers-color-scheme"){var d=c.parent.nodes.find(function(a){return a.type==="value"});var e=b===T.ToDark?/^dark$/gi:/^light$/gi;var f=e.test(String(d.value));var g=f?"(min-height: 0px)":"(max-height: 0px)";qa(c.parent,{type:"media-type",value:g});a.hasPrefersColorsScheme=true}});a.rule.media.mediaText=ra(d)};return c}(Y);var ua=function(a){b(c,a);function c(b,c){var d=a.call(this,b,c)||this;d.name="combined";d.mediaQueryTransformer=new ta(b,c);return d}c.prototype.process=function(b,c){var d=this;var e;var f=false;var g=new la(this.factory.getWorkFrame());this.factory.getWorkFrame().runAsync(function(){d.factory.getWorkFrame().asyncWork(c,function(a,c){var h;if(!e){e=a}if(!a){c();return}var i;var j;if(a.tagName==="STYLE"&&!d.mediaQueryTransformer.isFirstScanned()){j=(h=i===null||i===void 0?void 0:i.length)!==null&&h!==void 0?h:0;i=d.mediaQueryTransformer.queryAndTransformMediaRules(b,a);for(var k=j;k<i.length;k++){if(i[k].hasPrefersColorsScheme){f=true;d._lockNodesInMediaQuery(i[k],e)}}}if(a.tagName!=="STYLE"){g.push(a)}}).then(function(){return g.push(undefined)})});return a.prototype.process.call(this,b,g.next).then(function(a){if(b===T.ToDark){d.setStoredAttribute("scanned","true")}if(d.mediaQueryTransformer.isFirstScanned()){d.mediaQueryTransformer.queryAndTransformMediaRules(b)}else{d.mediaQueryTransformer.finishFirstScan()}if(f){d.factory.getAnalytics().emit(E.DetectMediaQuery,{mode:b})}return a})};c.prototype._lockNodesInMediaQuery=function(a,b){for(var c=0;c<a.rule.cssRules.length;c++){var d=a.rule.cssRules[c].selectorText;if(typeof d==="string"){var e=b.querySelectorAll(d);for(var f=0;f<e.length;f++){this.setNodeTransformAllowed(e[f],false)}}}};return c}(ka);var va=1;function wa(a){var b;var c=a.commonAncestorContainer;if(c.nodeType===va){return c}return(b=c.parentElement)!==null&&b!==void 0?b:document.body}var xa={};var ya=0;function za(){ya=0}function Aa(){return xa}var Ba=function(){function a(a){this._factory=a;this.id="transformer_".concat(ya++);this._destroyed=false;this._transformers=[new ua(this.id,a),new ta(this.id,a),new ka(this.id,a)];xa[this.id]=this}a.prototype.claim=function(a){this._transformers[0].claim(a)};a.prototype.hasTransformerId=function(a){return this._transformers[0].hasTransformerId(a)};a.prototype.getTransformerId=function(a){return this._transformers[0].getTransformerId(a)};a.prototype.apply=function(a,b){var c=b instanceof Range;var d=c?wa(b):b;var e=c?X(d):d;if(!e){return L.resolve(U.Skipped)}if(c){var f=this.getTransformerId(e);if(f!==this.id){var g=xa[f];if(g){return g.apply(a,b)}return L.resolve(U.Skipped)}var h=this._transformers.every(function(a){return a.getStoredMode()===T.ToLight})?T.ToLight:T.ToDark;if(a===T.ToLight&&a===h){return L.resolve(U.Intact)}}return N(this._transformers,function(b,c){if(!b.test(d)){return}return b.apply(a,e,d).then(function(a){if(a===U.Transformed){c(U.Transformed)}})},U.Rejected)};a.prototype.destroy=function(){if(this._destroyed){return}this._destroyed=true;for(var a=0,b=this._transformers;a<b.length;a++){var c=b[a];c.destroy()}this._factory.delete(this);delete xa[this.id]};return a}();var Ca=function(){function a(a,b,c){this._workFrame=a;this.config=b;this._analytics=c;this._managers={}}a.prototype.create=function(){var a=new Ba(this);this._managers[a.id]=a;return a};a.prototype.find=function(a){return this._managers[a]};a.prototype.findForNode=function(a){var b=a.getAttribute("data-darkosha-id");return this.find(b)};a.prototype.delete=function(a){if(this._managers[a.id]){this._managers[a.id].destroy()}delete this._managers[a.id]};a.prototype.destroy=function(){var a=Object.values(this._managers);for(var b=0,c=a;b<c.length;b++){var d=c[b];this.delete(d)}};a.prototype.getWorkFrame=function(){return this._workFrame};a.prototype.getAnalytics=function(){return this._analytics};return a}();function Da(a){var b=document.getSelection();for(var c=0;c<b.rangeCount;c++){a(b.getRangeAt(c))}}function Ea(a,b){var c=a.cloneContents();for(var d=0;d<c.childNodes.length;d++){b(c.childNodes[d])}}function Fa(a){var b=[];var c=[];Ea(a,function(a){var d,e,f,g;if(!a){return}switch(a.nodeType){case Node.TEXT_NODE:b.push((d=a.textContent)!==null&&d!==void 0?d:"");c.push((e=a.textContent)!==null&&e!==void 0?e:"");break;case Node.ELEMENT_NODE:b.push((f=a.textContent)!==null&&f!==void 0?f:"");c.push((g=a.outerHTML)!==null&&g!==void 0?g:"");break}});return{text:b.join(""),html:c.join("")}}function Ga(a){if(a===void 0){a=false}var b,c;var d=new L(function(a,d){b=a;c=d},a);return{promise:d,resolve:b,reject:c}}function Ha(a,b){var c=a(b);if(c.sync){b(c.data)}}var Ia=false;function Ja(a){Ia=a}function Ka(){return Ia}var La=function(){function a(a,b){if(b===void 0){b=function(){return undefined}}this._config=a;this._onAsyncToggle=b;this._frameStartTs=0;this._async=false;this.clear()}a.prototype.start=function(){if(this._config.async){this._frameStartTs=performance.now()}};a.prototype.clear=function(){var a=Ia?false:this._config.async;if(a==="auto"){this._async=false}else{this._async=a}};a.prototype.isAsync=function(){return this._async};a.prototype.runIfAsync=function(a){var b=performance===null||performance===void 0?void 0:performance.now();var c=b-this._frameStartTs;if(!this._async&&this._config.async==="auto"){if(c>this._config.asyncAutoThreshold){this._onAsyncToggle();this._async=true}else{return false}}if(!this._async||!this._config.async){return false}if(c>this._config.asyncMaxFrameDuration){this.runAsync(a);return true}return false};a.prototype.run=function(a){if(!this.runIfAsync(a)){a()}};a.prototype.runAsync=function(a){if(this._async){this.runAlwaysAsync(a)}else{a()}};a.prototype.runAlwaysAsync=function(a){var b=this;requestAnimationFrame(function(){b.start();a()})};a.prototype.asyncWork=function(a,b){var c=Ga(),d=c.promise,e=c.resolve;var f=false;var g=function(a){f=true;e(a)};var h=function(c){b(c,g);if(!f){while(true){var d=a(h);if(d.sync){b(d.data,g);if(f){return}}else{return}}}};Ha(a,h);return d};a.prototype.asyncIterate=function(a,b){var c=this;var d=0;return this.asyncWork(function(b){var e={index:d,data:a[d]};d++;if(c.runIfAsync(function(){return b(e)})){return{sync:false}}return{sync:true,data:e}},function(c,d){if(c.index>=a.length){d();return}b(c.data)})};return a}();function Ma(a,b){if(a==="true"){return true}if(a==="false"){return false}if(b.includes(a)){return a}return false}var Na=function(){function a(b){var c=this;this.buildDate=1656003727692;this.buildVersion="2.2.0-fmail-5017-14";this._analytics=new H;this._lastPromise=L.resolve();this._isCopyEventHandlerLocked=false;this._originalConfig=e(e({},Z),b);this._config=e(e({},this._originalConfig),{async:Ma(this._originalConfig.async,["auto"])});this._workFrame=new La(this._config,function(){c._config.sneaky=true;c._toggleVisibility(false)});this._factory=new Ca(this._workFrame,this._config,this._analytics);this._manager=this._factory.create();this._manager.claim(this._config.target);if(this._config.rollbackOnCopy){ba(this,"copy",a._globalHandleCopyEvent)}}a.prototype.transform=function(a){if(a===void 0){a=this._config.baseColor}return L.unwrap(this._applyTransform(a,T.ToDark)).then(function(){return undefined})};a.prototype.rollback=function(){return L.unwrap(this._applyTransform(this._config.baseColor,T.ToLight)).then(function(){return undefined})};a.prototype.setColor=function(a){this._config.baseColor=a};a.prototype.isolateSubtree=function(a){var b=this._factory.findForNode(a);if(b){return}b=this._factory.create();b.claim(a)};a.prototype.integrateSubtree=function(a){var b=this._factory.findForNode(a);if(b){b.destroy()}};a.prototype.destroy=function(){this._factory.destroy();ca(this,"copy",a._globalHandleCopyEvent)};a.prototype.on=function(a,b){this._analytics.on(a,b)};a.prototype.off=function(a,b){this._analytics.off(a,b)};a.prototype.getConfig=function(){return this._originalConfig};a._globalHandleCopyEvent=function(a,b){b._handleCopyEvent(a)};a.prototype._onCopyMeasured=function(a,b){this._analytics.emit(E.SuccessClipboard,{duration:b,method:a.method})};a.prototype._handleCopyEvent=function(a){var b=this;var c,d;if(this._isCopyEventHandlerLocked||this._currentMode!==T.ToDark){return}try{Ja(true);var e={method:F.customRange};var f=this._analytics.mark(this._onCopyMeasured.bind(this,e));if((c=document.queryCommandEnabled)===null||c===void 0?void 0:c.call(document,"copy")){e.method=F.execCommand;this._isCopyEventHandlerLocked=true;this._applyTransform(this._config.baseColor,T.ToLight);(d=document.execCommand)===null||d===void 0?void 0:d.call(document,"copy",false);this._applyTransform(this._config.baseColor,T.ToDark);f();this._isCopyEventHandlerLocked=false}else{e.method=F.customRange;var g=[];var h=[];Da(function(a){b._applyTransform(b._config.baseColor,T.ToLight,a).then(function(b){if(b!==U.Skipped){g.push(a);if(b!==U.Intact){h.push(a)}}})});if(!g.length){return}var i=[];var j=[];for(var k=0,l=g;k<l.length;k++){var m=l[k];var n=Fa(m);i.push(n.html);j.push(n.text)}var o=j.join("");var p=i.join("");a.clipboardData.setData("text/plain",o);a.clipboardData.setData("text/html",p);for(var q=0,r=h;q<r.length;q++){var m=r[q];this._applyTransform(this._config.baseColor,T.ToDark,m)}f()}a.preventDefault();Ja(false)}catch(a){Ja(false);this._analytics.emit(E.FailClipboard,{})}};a.prototype._toggleVisibility=function(a){if(!this._config.sneaky){return}if(a){this._config.target.style.transition=this._config.sneakyTransition;this._config.target.style.opacity="1"}else{this._config.target.style.transition="none";this._config.target.style.opacity="0"}};a.prototype._onMeasured=function(a,b){if(a.status===U.Transformed){this._analytics.emit(E.Success,{duration:b,mode:a.mode})}else{this._analytics.emit(E.Fail,{duration:b,mode:a.mode})}};a.prototype._applyTransform=function(a,b,c){var d=this;return this._lastPromise.then(function(){var e={mode:b};var f=d._analytics.mark(d._onMeasured.bind(d,e));d._analytics.emit(E.Start,{mode:b});var g=Ga(),h=g.promise,i=g.resolve;d._lastPromise=h;d.setColor(a);if(d._config.async==="auto"){d._workFrame.clear();d._config.sneaky=false}d._toggleVisibility(false);d._workFrame.runAsync(function(){d._workFrame.start();d._manager.apply(b,c!==null&&c!==void 0?c:d._config.target).then(function(a){e.status=a;d._currentMode=b;d._toggleVisibility(true);f();i(a)})});return h})};return a}();function Oa(a){return new Na(a)}}();return d}()});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/darkosha",["require","exports","@mail/darkosha","@mail/xray","default-values"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createConfiguredDarkosha=void 0;b=__importDefault(b);var d=/\(\s*prefers-color-scheme:\s*(dark|light)\s*\)/gi;function e(e,f){if(!f&&!d.test(e.innerHTML)){return undefined}var g=document.visibilityState==="visible"||c.DARK_MODE_BACKGROUND_ASYNC;var h=a.createDarkosha({target:e,baseColor:c.DARK_MODE_BASE_COLOR,async:g?c.DARK_MODE_ASYNC:false,asyncAutoThreshold:c.DARK_MODE_ASYNC_THRESHOLD,asyncMaxFrameDuration:c.DARK_MODE_FRAME_BUDGET,sneaky:c.DARK_MODE_SNEAKY,rollbackOnCopy:c.DARK_MODE_ROLLBACK_ON_COPY,transformers:c.DARK_MODE_MEDIA_QUERY?{combined:[a.TransformerMode.ToDark,a.TransformerMode.ToLight]}:{"color-contrast":[a.TransformerMode.ToDark,a.TransformerMode.ToLight]}});h.on(a.AnalyticsEvent.Start,function(a){var c;b.default.send("darkosha_start",{i:(c={},c[a.data.mode]=1,c)})});h.on(a.AnalyticsEvent.FailTransform,function(a){var b=window.coreLogger;b===null||b===void 0?void 0:b.dispatchError(a.data.errorRaw,{darkosha:true,from:"letter-body",transformer:a.data.transformer,mode:a.data.mode,duration:a.data.duration})});h.on(a.AnalyticsEvent.Fail,function(a){var c;b.default.send("darkosha_fail",{i:(c={},c[a.data.mode]=1,c.duration=a.data.duration,c)})});h.on(a.AnalyticsEvent.SuccessClipboard,function(a){var c;b.default.send("darkosha_copy",{i:(c={},c["duration_"+a.data.method]=a.data.duration,c)})});h.on(a.AnalyticsEvent.FailClipboard,function(){b.default.send("darkosha_fail",{i:{clipboard:1}})});h.on(a.AnalyticsEvent.Success,function(a){var c;b.default.send("darkosha_success",{i:(c={},c[a.data.mode]=1,c.duration=a.data.duration,c)})});var i=false;h.on(a.AnalyticsEvent.DetectMediaQuery,function(){i=true;b.default.send("darkosha_mq")});h.on(a.AnalyticsEvent.SuccessTransform,function(a){var c;if(!a.data.cache){b.default.send("darkosha_transform",{i:(c={},c["duration_"+a.data.mode]=a.data.duration,c["mq_"+i]=1,c["async_"+a.data.async]=1,c["async_"+a.data.async+"_duration"]=a.data.duration,c)})}});return h}exports.createConfiguredDarkosha=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-calendar/letter-calendar",["require","exports","feast","feast-tpl!./letter-calendar.html","service/darkosha"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"letter-calendar",template:b.default,defaults:{html:"","dark-mode":false},didUpdate:function(a){if(this.get("dark-mode")!=a["dark-mode"]){this.applyDarkosha()}},didUnmount:function(){if(this._darkosha){this._darkosha.destroy()}},didMount:function(){var a=this.get("calendars");if(!a.length){return}var b=a.map(function(a){return a.html});this.set("html",b.join("<br/>"));this.applyDarkosha()},getOrCreateDarkosha:function(){if(!this._darkosha){this._darkosha=c.createConfiguredDarkosha(this.el,this.is("dark-mode"))}return this._darkosha},applyDarkosha:function(a){if(a===void 0){a=false}if(a&&this._darkosha){this._darkosha.destroy();this._darkosha=undefined}var b=this.getOrCreateDarkosha();if(b){if(this.is("dark-mode")){b.transform()}else{b.rollback()}}}})});define("feast-tpl!app/feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html",["feast"],function(a){return a.smartParse('<div qa:id="confirm-receipt">\n\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t<div bem:elem="icon">\n\t\t<b:ico name="categories:mail" size="s" />\n\t</div>\n\n\t<div bem:elem="icon-touch">\n\t\t<div bem:elem="icon-touch-wrapper">\n\t\t\t<b:ico name="categories:mail" size="s" />\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="wrapper">\n\t\t<div bem:elem="info">\n\t\t\t{i18n(\'Отправитель письма запросил подтверждение о прочтении.\')}\n\t\t\t<b:link\n\t\t\t\tfn:if="!attrs[\'hide-help-link\']"\n\t\t\t\thref="{attrs[\'help-link\']}"\n\t\t\t\ttext="{i18n(\'Что это?\')}"\n\t\t\t\ttarget="_blank"\n\t\t\t\tsecondary\n\t\t\t\tqa:id="help-link"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div fn:if="!attrs.mobile" bem:elem="confirm">\n\t\t\t<b:button-link\n\t\t\t\tremit:click="confirm"\n\t\t\t\ttext="{i18n(\'Подтвердить, что прочитано\')}"\n\t\t\t\tqa:id="confirm-button"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div fn:if="attrs.mobile" bem:elem="confirm-touch">\n\t\t\t<b:button2\n\t\t\t\t\tremit:click="confirm"\n\t\t\t\t\ttext="{i18n(\'Подтвердить прочтение\')}"\n\t\t\t\t\tprimary\n\t\t\t\t\tnowrap\n\t\t\t\t\ttext-overflow\n\t\t\t\t\tqa:id="confirm-button"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html")});define("feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html",["feast-tpl!app/feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/button-link/button-link.html",["feast"],function(a){return a.smartParse('<div\n\tremit:click="click-radar"\n>\n\t\x3c!-- Аттрибуты --\x3e\n\t<fn:attr\n\t\t\tname="tabindex"\n\t\t\tvalue="{attrs[\'tab-index\']}"\n\t\t\ttest="attrs[\'tab-index\'] !== void 0"\n\t/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="pressed" test="attrs.pressed"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\t<bem:mod name="pony-mode" test="attrs.ponymode"/>\n\n\t<bem:mod name="type-{attrs.type}"/>\n\n\t\x3c!-- Текст контрола --\x3e\n\t<div bem:elem="text">{attrs.text}</div>\n\n\t\x3c!-- Иконка --\x3e\n\t<div bem:elem="icon" fn:if="attrs.icon">\n\t\t<b:ico name="{attrs.icon}" size="s"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/button-link/button-link.html")});define("feast-tpl!ui-block/button-link/button-link.html",["feast-tpl!app/feast-tpl!ui-block/button-link/button-link.html"],function(a){return a});define("ui-block/button-link/button-link",["exports","feast","feast-tpl!./button-link.html","service/radars/decorator","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,g.default)({events:[{name:"click-radar",rename:"click"}]})({name:"button-link",template:f.default,blocks:{ico:h.default},defaults:{disabled:false,type:"default",icon:"",ponymode:false,pressed:false,text:""}}))});define("ui-block/letter-confirm-receipt/letter-confirm-receipt",["exports","default-values","feast","feast-tpl!./letter-confirm-receipt.html","helpers/radar-utils","service/radars/decorator","ui-block/button-link/button-link","ui-block/ico/ico","ui-block/link/link"],function(exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var i=o(b);var j=o(c);var k=o(e);var l=o(f);var m=o(g);var n=o(h);function o(a){return a&&a.__esModule?a:{default:a}}exports.default=i.default.Block.extend((0,k.default)({id:"confirm-receipt",events:[{name:"confirmreceipt",data:d.getModelId}]})({name:"letter-confirm-receipt",defaults:{"hide-help-link":a.CONFIRM_RECEIPT_HELP,"help-link":a.CONFIRM_RECEIPT_HELP_URL},template:j.default,blocks:{"button-link":l.default,ico:m.default,link:n.default}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-contact/letter-contact.html",["feast"],function(a){return a.smartParse('<span\n\tqa:id="{attrs.dir}"\n\tqa:state="active:{attrs.active},dangerous:{!!attrs.dangerous}"\n\ttitle="{attrs.contact.email}"\n\tremit:contextmenu="rightclick"\n>\n\t<bem:mod name="active" test="attrs.active"/>\n\t<bem:mod name="dangerous" test="attrs.dangerous && attrs.dir === \'from\'"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\n\t<fn:value mod="correspondent">_this.getContact()</fn:value>\n\t<fn:value>attrs.isLast ? \'\' : \',\'</fn:value>\n</span>\n',"app/feast-tpl!ui-block/letter-contact/letter-contact.html")});define("feast-tpl!ui-block/letter-contact/letter-contact.html",["feast-tpl!app/feast-tpl!ui-block/letter-contact/letter-contact.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-contact/letter-contact",["require","exports","feast","feast-mod/correspondents","feast-tpl!./letter-contact.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);exports.default=a.default.Block.extend({name:"letter-contact",template:c.default,blocks:{},mods:{correspondent:b.correspondent},defaults:{active:false,contact:{},dir:"to",isCurrent:false,dangerous:false},getContact:function(){var a=this.get("isCurrent");var b=this.get("dir");var c=this.get("contact");var d=this.get("dangerous");if(a&&b!=="from"){return i18n("вам")}else if(d){return c.email}else{return c}}})});define("feast-tpl!app/feast-tpl!ui-block/letter-tooltip/letter-tooltip.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-tooltip:{attrs.type}">\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="disabled" value="{attrs.loading}"/>\n\t<fn:var name="ponymode" value="{attrs.ponymode}"/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="pony-mode" test="ponymode" />\n\t<bem:mod name="disabled" test="disabled" />\n\n\t<div bem:elem="wrapper">\n\t\t<div bem:elem="title">\n\t\t\t<fn:value>attrs[\'title-text\']</fn:value>\n\t\t</div>\n\n\t\t\x3c!-- Правый край --\x3e\n\t\t<div bem:elem="right">\n\t\t\t\x3c!-- Кнопка действия (ссылка) --\x3e\n\t\t\t<div bem:elem="action">\n\t\t\t\t<b:button-link\n\t\t\t\t\tqa:id="action"\n\t\t\t\t\tremit:click="action"\n\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\ttext="{attrs[\'action-text\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t\x3c!-- Кнопка закрыть (крестик) --\x3e\n\t\t\t<div bem:elem="close">\n\t\t\t\t<b:button2\n\t\t\t\t\tqa:id="close"\n\t\t\t\t\tremit:click="close"\n\n\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\tico="actions:close"\n\t\t\t\t\tsecondary\n\t\t\t\t\tshort\n\t\t\t\t\tsize="s"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter-tooltip/letter-tooltip.html")});define("feast-tpl!ui-block/letter-tooltip/letter-tooltip.html",["feast-tpl!app/feast-tpl!ui-block/letter-tooltip/letter-tooltip.html"],function(a){return a});define("ui-block/letter-tooltip/letter-tooltip",["exports","feast","feast-tpl!./letter-tooltip.html","service/radars/decorator","ui-block/button-link/button-link","ui-block/button2/button2"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:["close","action"]})({name:"letter-tooltip",isolateEvents:true,template:g.default,blocks:{button:j.default,"button-link":i.default},defaults:{ponymode:false}}))});define("feast-tpl!app/feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html",["feast"],function(a){return a.smartParse('<div>\n\t<img\n\t\tbem:elem="img" src="{_this.getLogoSrc()}"\n\t\tremit:click="marusia:rl:button:click"\n\t\tevent:details="{model: attrs.model}"\n\t/>\n\t<div bem:elem="button">\n        <bem:mod name="ponymode" test="attrs.ponymode"/>\n\t\t<b:button2\n\t\t\ttext="{i18n(\'Прочитать письмо\')}"\n\t\t\tico="actions:play"\n\t\t\ticoSize="xs"\n\t\t\tshadowless\n\t\t\tinvert\n\t\t\tremit:click="marusia:rl:button:click"\n\t\t\tevent:details="{model: attrs.model}"\n\t\t\tcentered\n            compact="{attrs.ponymode}"\n            medium="{!attrs.ponymode}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html")});define("feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html",["feast-tpl!app/feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/getters/MessageMeta",["require","exports","mail/Message"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCategoriesFromMeta=void 0;a=__importDefault(a);var b=function(b){var c=b.get("meta");var d=c===null||c===void 0?void 0:c.find(function(b){return b["@context"]===a.default.CATEGORY_META.context&&b["@type"]===a.default.CATEGORY_META.type});if(typeof d!=="object"||!Array.isArray(d.categories)){return null}return d.categories};exports.getCategoriesFromMeta=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/marusia-read-letter-button/marusia-read-letter-button",["require","exports","default-values","feast","feast-tpl!./marusia-read-letter-button.html","mail/getters/MessageMeta","service/radars/index","ui-block/button2/button2"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);exports.blockSpec={name:"marusia-read-letter-button",rootClassName:"marusia-rl-button",template:c.default,blocks:{button2:f.default},events:{"marusia:rl:button:click":"onClick"},didMount:function(){if(!this.isMounted()){return}this.radarSend("show")},onClick:function(a){var b=a.details.model,c=a.originalEvent;c.stopImmediatePropagation();this.broadcast("marusia:read:letter:click",{model:b});this.radarSend("click",b)},radarSend:function(a,b){if(b===void 0){b=this.get("model")}var c=d.getCategoriesFromMeta(b);e.default({type:"marusia-rl-"+a+"_"+this.get("radar-prefix"),dwh:{categories:c||[]}})},getLogoSrc:function(){return a.PACKAGES_URL+"/static.promo/marusia/marusia-shadow.png"}};exports.default=b.default.Block.extend(exports.blockSpec)});define("feast-tpl!app/feast-tpl!ui-block/translator/translator.html",["feast"],function(a){return a.smartParse('<div qa:id="translator" xmlns:b="http://www.w3.org/1999/html" ref="translator">\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="disabled" value="{attrs.loading}" />\n\t<fn:var name="ponymode" value="{attrs.ponymode}" />\n\t<fn:var\n\t\tname="enableHideTranslator"\n\t\tvalue="{_this.getEnableHideTranslator()}"\n\t/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="pony-mode" test="ponymode" />\n\t<bem:mod name="disabled" test="disabled" />\n\n\t<div bem:elem="icon">\n\t\t<bem:mod name="pony-mode" test="ponymode" />\n\t\t<b:react-async component="PromtTooltip" />\n\t</div>\n\n\t<div bem:elem="wrapper">\n\t\t\x3c!-- Ошибка --\x3e\n\t\t<fn:if test="attrs.error">\n\t\t\t<div bem:elem="error">{i18n(\'Не удалось перевести текст\')}</div>\n\t\t</fn:if>\n\n\t\t\x3c!-- Выбор языка перевода --\x3e\n\t\t<fn:if test="!attrs.error">\n\t\t\t<div bem:elem="title">{i18n(\'Перевод\')}:</div>\n\n\t\t\t<b:translator-select\n\t\t\t\tremit:language-change="from:change"\n\t\t\t\tselected="{attrs[\'from-selected\']}"\n\t\t\t\tdisabled="{disabled}"\n\t\t\t\tdisabled-item="{_this.getTo()}"\n\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\tcontainerRef="{_this.refs.translator}"\n\t\t\t\tid="from"\n\t\t\t\tqa:id="from"\n\t\t\t\tponymode="{ponymode}"\n\t\t\t/>\n\n\t\t\t<b:button2\n\t\t\t\tremit:click="reverse:click"\n\t\t\t\tqa:id="swap"\n\t\t\t\tico="navigation:arrow_swipe"\n\t\t\t\tponymode="{ponymode}"\n\t\t\t\tpure\n\t\t\t\tdisabled="{disabled}"\n\t\t\t\tcentered\n\t\t\t\tcompact\n\t\t\t/>\n\n\t\t\t<b:translator-select\n\t\t\t\tremit:language-change="to:change"\n\t\t\t\tselected="{attrs[\'to-selected\']}"\n\t\t\t\tdisabled="{disabled}"\n\t\t\t\tdisabled-item="{_this.getFrom()}"\n\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\tcontainerRef="{_this.refs.translator}"\n\t\t\t\tid="to"\n\t\t\t\tqa:id="to"\n\t\t\t\tponymode="{ponymode}"\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t\x3c!-- Правый край --\x3e\n\t\t<div bem:elem="right">\n\t\t\t<div bem:elem="spinner" fn:if="disabled">\n\t\t\t\t<b:spinner size="xxs" color="primary" />\n\t\t\t</div>\n\n\t\t\t<div bem:elem="translate">\n\t\t\t\t<b:button-link\n\t\t\t\t\tremit:click="translate:click"\n\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\tqa:id="translate"\n\t\t\t\t\ttext="{_this.getText()}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="close">\n\t\t\t\t<b:button2\n\t\t\t\t\tfn:if="!enableHideTranslator"\n\t\t\t\t\tqa:id="close"\n\t\t\t\t\tremit:click="button-close:click"\n\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\tico="actions:close"\n\t\t\t\t\tcentered\n\t\t\t\t\tcompact\n\t\t\t\t\tpure\n\t\t\t\t/>\n\t\t\t\t<b:dropdown\n\t\t\t\t\tfn:if="enableHideTranslator"\n\t\t\t\t\tqa:id="dropdown"\n\t\t\t\t\tico="actions:close"\n\t\t\t\t\tponymode\n\t\t\t\t\tpure\n\t\t\t\t\tremit:dropdown-change-state="dropdown-change"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t<b:list qa:id="translator-hide-list">\n\t\t\t\t\t\t\t<b:list-item qa:id="hide" remit:click="hide:click">\n\t\t\t\t\t\t\t\t{i18n(\'Не предлагать перевод\')}\n\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t<b:list-item qa:id="close" remit:click="dropdown-close:click">\n\t\t\t\t\t\t\t\t{i18n(\'Закрыть\')}\n\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t</b:list>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:dropdown>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/translator/translator.html")});define("feast-tpl!ui-block/translator/translator.html",["feast-tpl!app/feast-tpl!ui-block/translator/translator.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/translator-select/translator-select.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:select\n\t\tremit:item-click="language-change"\n\t\tselected-index="{_this.getSelectedIndex()}"\n\t\tdisabled-index="{_this.getDisabledIndex()}"\n\t\titems="{_this.getItems()}"\n\t>\n\t\t<fn:match\n\t\t\tname="control"\n\t\t\targs="selectedText, selectedItem, selectedIndex, expanded"\n\t\t>\n\t\t\t<div\n\t\t\t\tbem:elem="custom_control"\n\t\t\t\tremit:click="control-click"\n\t\t\t\tdisabled="{attrs.disabled}"\n\t\t\t>\n\t\t\t\t<bem:mod name="pressed" test="expanded" />\n\t\t\t\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\t\t\t\t<bem:mod name="compact" test="attrs.compact" />\n\n\t\t\t\t<span bem:elem="text" qa:id="folder-name-filter">\n\t\t\t\t\t<fn:value>_this.getText(selectedText)</fn:value>\n\t\t\t\t</span>\n\n\t\t\t\t\x3c!-- Стрелка --\x3e\n\t\t\t\t<div bem:elem="icon">\n\t\t\t\t\t<b:ico name="navigation:drop_down_small" size="s" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:select>\n</div>\n',"app/feast-tpl!ui-block/translator-select/translator-select.html")});define("feast-tpl!ui-block/translator-select/translator-select.html",["feast-tpl!app/feast-tpl!ui-block/translator-select/translator-select.html"],function(a){return a});define("ui-block/translator-select/translator-select",["exports","feast","feast-tpl!./translator-select.html","mail/actions/Translate","ui-block/button2/button2","ui-block/select/select"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}var l=[{key:h.default.RUSSIAN,text:i18n("Русский")},{key:h.default.ENGLISH,text:i18n("Английский")},{key:h.default.GERMAN,text:i18n("Немецкий")},{key:h.default.FRENCH,text:i18n("Французский")},{key:h.default.SPANISH,text:i18n("Испанский")}];var m={};l.forEach(function(a,b){a.index=b;m[a.key]=a});exports.default=f.default.Block.extend({name:"translator-select",isolateEvents:true,template:g.default,blocks:{button2:i.default,select:j.default},defaults:{selected:null,disabled:false,"disabled-item":null,ponymode:false},getText:function a(b){var c=this.get("containerRef");var d=c.clientWidth>=660;return d?b:b.slice(0,3)+"."},getItems:function a(){return l},getSelectedIndex:function a(){return this.getIndexByValue(this.get("selected"))},getDisabledIndex:function a(){return this.getIndexByValue(this.get("disabled-item"))},getIndexByValue:function a(b){var c=m[b];return c&&c.index}})});define("ui-block/translator/translator",["exports","@mail/xray","default-values","feast","feast-tpl!./translator.html","service/radars/decorator","ui-block/button-link/button-link","ui-block/button2/button2","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item","ui-block/spinner/spinner","ui-block/translator-select/translator-select"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(a);var o=z(c);var p=z(d);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}exports.default=o.default.Block.extend((0,q.default)({events:["hide","close","original","retry","translate","reverse"]})({name:"translator",isolateEvents:true,template:p.default,blocks:{list:v.default,listItem:w.default,dropdown:t.default,button2:s.default,"button-link":r.default,ico:u.default,spinner:x.default,"translator-select":y.default},events:{"from:change":"onFromChange","to:change":"onToChange","translate:click":"onTranslateClick","reverse:click":"onReverse","dropdown-close:click":"onTranslatorDropdownClose","button-close:click":"onTranslatorButtonClose","hide:click":"onTranslatorHide","dropdown-change":"onTranslatorCloseDropdownClick"},defaults:{error:false,"from-selected":"ru","from-default-selected":"ru",loading:false,ponymode:false,"to-selected":"en",translated:false,"is-translator-visible":false},getText:function a(){if(this.is("error")){return i18n("Попробовать ещё раз")}if(this.is("translated")){return i18n("Оригинал")}return i18n("Перевести")},onReverse:function a(){this.broadcast("reverse");var c=this.getTo();var d=this.getFrom();if(b.DISABLE_AUTOMATED_TRANSLATE){this.set({"from-selected":c,"to-selected":d,translated:false});return}this.set({"from-selected":c,"to-selected":d});this.translate()},onFromChange:function a(c){var d=c.details;if(b.DISABLE_AUTOMATED_TRANSLATE){this.set({"from-selected":d.key,translated:false});return}this.set("from-selected",d.key);this.translate()},onToChange:function a(c){var d=c.details;if(b.DISABLE_AUTOMATED_TRANSLATE){this.set({translated:false,"to-selected":d.key});return}this.set("to-selected",d.key);this.translate()},onTranslatorCloseDropdownClick:function a(){n.default.send("translator_close-dropdown_click")},onTranslatorButtonClose:function a(){n.default.send("translator_close-button_click");this.broadcast("close")},onTranslatorDropdownClose:function a(){n.default.send("translator_close-dropdown_close_click");this.broadcast("close")},onTranslatorHide:function a(){n.default.send("translator_close-dropdown_hide_click");this.broadcast("hide")},onTranslateClick:function a(){if(this.is("error")){this.retry();return}if(this.is("translated")){this.showOriginal()}else{n.default.send("letter_manual_translate",{dwh:{disableAutomatedTranslate:b.DISABLE_AUTOMATED_TRANSLATE,letterId:this.get("letterId")}});this.translate()}},getTo:function a(){return this.get("to-selected")},getEnableHideTranslator:function a(){return b.ENABLE_HIDE_TRANSLATOR&&!this.get("is-translator-visible")},getFrom:function a(){return this.get("from-selected")},retry:function a(){this.broadcast("retry",{tolang:this.getTo(),fromlang:this.getFrom()})},showOriginal:function a(){this.broadcast("original",{tolang:this.getTo(),fromlang:this.getFrom()})},translate:function a(){var b=this.getTo();var c=this.getFrom();if(!b||!c){return}this.broadcast("translate",{tolang:b,fromlang:c})},getPromtLogoHref:function a(){return b.PROMT_LOGO_HREF},didMount:function a(){this.set("from-selected",this.get("from-default-selected"));this.set("to-selected",this.get("to-default-selected"))}}))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter/letter",["require","exports","@mail/flags","@mail/operands","@mail/xray","actions/checkContactsPossessing","cfgUser","default-values","feast","feast-mod/correspondents","feast-mod/letter-date","feast-tpl!./letter.html","helpers/add-merchant-param","helpers/browser","helpers/check-url-from-letter","helpers/data-source-dispatch","helpers/get-adaptive","helpers/getFeaturesStringByPrefix","helpers/letter","helpers/object-to-query","helpers/opener","helpers/querystring-add","helpers/radar-utils","helpers/resizer","helpers/smime-attachments-metrics","mail/Folder","mail/Message","mediator/settings-events","mediator/share-folders-manager/events","service/calls","service/contextmenu","service/layer","service/promo","service/radars/decorator","service/radars/index","service/smokescreen","service/storage","service/viewer","service/vkMessengerLoader","ui-block/attach-list/attach-list","ui-block/avatar/avatar","ui-block/badge/badge","ui-block/button2/button2","ui-block/calendar-button/calendar-button","ui-block/dropdown/dropdown","ui-block/dropdown-actions/dropdown-actions","ui-block/ico/ico","ui-block/letter-body/letter-body","ui-block/letter-body-amp/letter-body-amp","ui-block/letter-calendar/letter-calendar","ui-block/letter-category/letter-category","ui-block/letter-confirm-receipt/letter-confirm-receipt","ui-block/letter-contact/letter-contact","ui-block/letter-meta/letter-meta","ui-block/letter-status2/letter-status2","ui-block/letter-tooltip/letter-tooltip","ui-block/list/list","ui-block/list-item/list-item","ui-block/marusia-read-letter-button/marusia-read-letter-button","ui-block/translator/translator","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);p=__importDefault(p);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);v=__importDefault(v);x=__importDefault(x);y=__importDefault(y);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);da=__importDefault(da);ea=__importDefault(ea);var ga=v.default();var ha={head:{offsetSide:"top",offsetPadding:"paddingTop",className:"letter__head"},footer:{offsetSide:"bottom",offsetPadding:"paddingBottom",className:"letter__footer"}};exports.blockSpec={name:"letter",template:j.default,performanceTrace:"track",isolateEvents:false,updateLastSeenUnsubscribe:null,mods:{correspondent:h.correspondent,correspondentsCount:h.correspondentsCount,getLocaleDateFull:i.getLocaleDateFull},isFooterHiddenRadarSended:false,isSmartReplyHiddenRadarSended:false,blocks:{avatar:M.default,"attach-list":L.default,badge:N.default,button2:O.default,"calendar-button":P.default,dropdown:Q.default,"dropdown-actions":R.default,"letter-calendar":V.default,"letter-body":T.default,"letter-confirm-receipt":X.default,"letter-contact":Y.default,"letter-body-amp":U.default,"letter-category":W.default,"letter-status2":_.default,"letter-tooltip":aa.default,translator:ea.default,ico:S.default,"letter-meta":Z.default,list:ba.default,"list-item":ca.default,"marusia-rl-button":da.default},lazyBlocks:{unsubscribe:fa.lazyUIUnsubscribe},events:{"attaches:cloud:all":"onAttachmentsCloud","attaches:cloud:one":"onAttachmentCloud","attaches:open":"onAttachmentClick",clickavatar:"onContactShow","contact:click":"onContactShow","details:expand":"onToggleDetails","letter:body:allowedattrclick":"onAllowedAttrClick","letter:body:data-attr:click":"onLetterDataAttributeClick","letter:body:finepayment":"onFinePaymentClick","letter:body:finepaymentright":"onFinePaymentRightClick","letter:body:monetapayment":"onMonetaPaymentClick","letter:body:tomyself":"onToMyselfClick","letter:draft:forward":"onLetterComposeFromDraft","letter:draft:reply":"onLetterComposeFromDraft","letter:draft:replyall":"onLetterComposeFromDraft","translator:close:click":"onTranslatorClose","translator:hide:click":"onTranslatorHide","translator:original:click":"onTranslatorOriginal","translator:retry:click":"onTranslatorTranslate","translator:translate:click":"onTranslatorTranslate","letter-tooltip:show-images:click":"onTooltipShowImagesClick","letter-tooltip:close":"onTooltipClose","amp:error":"onAmpError","dark-mode:toggle":"onDarkModeToggle","calls:groupcall":"onCallTo","details:collapse":"onToggleDetails","vk-messenger:open":"onVkMessengerOpen"},defaults:{"disable-category":true,"hover-support":l.default.capabilities["hover-support"],"native-sticky":!f.IS_READLETTER_NATIVE_STICKY_DISABLED,"is-translator-error":false,"is-translator-visible":false,"is-translator-loading":false,"is-translator-forced-shown":false,"is-automated-show-translator-radar-send":false,"is-letter-in-english-radar-send":false,"is-letter-translated":false,model:null,"dates-metadata":null,ponymode:false,"quotes-collapsed-default":true,"smart-reply-on":true,sticky:null,"sticky-head":false,"sticky-footer":false,"enable-body-scale":false,"max-scale":.5,"enable-amp":f.ENABLE_AMP,"feature-unsubscribe":f.FEATURE_UNSUBSCRIBE,"disable-translate":f.DISABLE_TRANSLATE,"disable-create-event":f.DISABLE_CREATE_EVENT,"invite-call":f.CALLS,"disable-head-calendar":f.DISABLE_LETTER_HEAD_CALENDAR,"disable-head-call":f.CALLS_DISABLE_LETTER_HEAD_CALL,"disable-calendar-newsletters":f.DISABLE_LETTER_CALENDAR_NEWSLETTERS,"disable-call-newsletters":f.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS,"disable-footer-calendar":f.DISABLE_LETTER_FOOTER_CALENDAR,"disable-footer-call":f.CALLS_DISABLE_LETTER_FOOTER_CALL,"disable-call":f.CALLS_DISABLE_LETTER_CALL,"disable-calls-tip":f.DISABLE_CALLS_TIP,"translator-default-from":"en","translator-default-to":"ru","amp-error":false,"address-header-calendar":f.ADDRESS_HEADER&&f.ADDRESS_HEADER_CALENDAR,"dark-mode-enabled":true,"category-feedback":f.CATEGORY_FEEDBACK_SUBMENU,"is-tooltip-visible":true,"marusia-read-all-letters":f.MARUSIA_READ_ALL_LETTERS,"smart-card-ics":f.SMART_CARD_ICS},attrChanged:{model:function(a){var b=this;window.setTimeout(function(){var b=a.get("attaches").list;G.default("letter_attaches",b.length);try{w.sendSMIMEAttachmentsMetrics(b)}catch(a){}},500);if(this.isSmartRepliesAvailable(a)){this.set("smart_replies_ready",!!a.getSmartReply());var c=a.is("flags.smart_reply_stage")?"_stage":"";G.default("smart_replies"+c+"_try-show");a.fetchSmartReply().then(function(a){b.set("smart_replies",a.get("replies"));G.default("smart_replies"+c+"_show");if(a.is("is_default")){G.default("smart_replies_default"+c+"_show")}E.default.update()},function(){G.default("smart_replies"+c+"_show-fail")})}},sticky:function(a,b){a=a||{};b=b||{};if(b.head!==a.head){this.updateSticky("head",a.top,a.headFade,!!a.maxWidth)}if(b.footer!==a.footer){this.updateSticky("footer",a.bottom,a.footerFade,!!a.maxWidth)}},"sticky-position":function(a){var b=this.get("sticky");if(b){this.updateSticky("head",b.top,false,!!a.maxWidth);this.updateSticky("footer",b.bottom,false,!!a.maxWidth)}},"dates-metadata":function(a){this.get("model").set("dates_metadata.priority_date",a)}},constructor:function(){g.default.Block.apply(this,arguments)},getOriginalEvent:function(a){return this.reactComponent?a.originalEvent:a.originalEvent.originalEvent},updateOnlineStatus:function(a){if(!a||!f.LETTER_LASTSEEN_REQUEST){return}var b=a.status_id===f.LASTSEEN_ONLINE_STATUS;c.default.send("lastseen-v2-letter-"+(b?"online":"offline"),{skipdwh:true});this.set("isOnline",b)},updateSenderLastSeen:function(){var a=this;if(!f.LETTER_LASTSEEN_REQUEST){return}var b=this.get("model");var c=b.get("correspondents.from.0");var d=this.get("getLastSeen");d===null||d===void 0?void 0:d([c.email]).then(function(b){var d=b.payload;var e=d[c.email];a.updateOnlineStatus(e)})},_windowResizeListeners:{},didMount:function(){var a=this.get("model");this.updateSenderLastSeen();var b=this.getMessageCorrespondents().concat(a.get("correspondents").from||[]).map(function(a){return a.email});this.broadcast("addressbook:refetchcontacts",b);this._sendVkMessengerEvent("open_mail_with_vk_messenger");var c=this.updateOnlineStatus.bind(this);this.updateLastSeenUnsubscribe=d.checkContactsPossessing.fulfilled.subscribe(function(b){var d=b.payload;if(!(d===null||d===void 0?void 0:d.contacts)){return}var e=a.get("correspondents.from.0");var f=d.contacts[e.email];if(!f){return}c(f)});this.updateStickyStatus=this.updateStickyStatus.bind(this);this.stickyDisabled=false;if(!this.is("readonly")){this.adaptiveHandler=new o.GetAdaptive({pureBreakpoints:true,breakpoints:[{conditions:function(a){return a.height<f.MIN_LETTER_HEIGHT_STICKY},props:{element:"footer",disableSticky:true,position:0,fade:!this.get("sticky")}},{props:{element:"footer",disableSticky:false,position:0,fade:!this.get("sticky")}}],onResize:this.updateStickyStatus,element:this.el.closest("."+H.default.lookup("scrollable_content"))||this.el.closest("."+H.default.lookup("panel-with-selected"))})}},didUnmount:function(){var a=this;var b,c;Object.keys(this._windowResizeListeners).forEach(function(b){return a._stopStickyTracking(a._windowResizeListeners[b])});ga.unbind();(b=this.updateLastSeenUnsubscribe)===null||b===void 0?void 0:b.call(this);(c=this.adaptiveHandler)===null||c===void 0?void 0:c.destroy()},onAttachmentClick:function(a){var b=this.get("model");var c=this.get("router");var d=this.get("route");var e=a.details;if(e.get("flags.eml")){var g=b.get("folder");var h=d.params.part?d.params.letter:"0:"+b.id+":"+g;s.default(c.getUrl("#read-letter",{folder:g,letter:h,part:e.id}))}else{J.default.open({attachment:e,message:b,router:c,newWindow:!f.WEBVIEW})}},onAttachmentCloud:function(a){this.onAttachmentsCloud(__assign(__assign({},a),{details:[a.details]}))},onAttachmentsCloud:function(a){var b=this.get("model");var c=a.details.filter(function(a){return!a.isLink()&&!a.isCloud()});this.broadcast("attachments:tocloud",{message:b,attachments:c})},onLetterDataAttributeClick:function(a){var b=a.details;var d=this.getOriginalEvent(a);switch(b.type){case"share-folder-access":this.broadcast(A.ShareEvents.letterActionClick,b,d);break;case"pulse-subscriptions-open":c.default.send("pulse_settings_open",{dwh:{from:"letter"}});this.broadcast(z.settingsEvents.openPulseSubscriptions,b,d);break}},onAllowedAttrClick:function(a){var b=a.details;var c=this.getOriginalEvent(a);var d=c.target.getAttribute("data-url");if(m.default(d)){c.preventDefault();c.stopImmediatePropagation();var e=b.skin,f=b.uidl;if(f){var g=this.get("model").id;d=t.default(d,{uidl:g})}D.default.openIframeLayer({paramsKey:e,additionalParams:{url:d},factoryParams:{dimmer:true,"close-on-esc":true}})}},onToggleDetails:function(){this.set("details-expanded",!this.get("details-expanded"))},formFinePaymentUrl:function(a){var b=a.target.dataset,c=b.id,d=b.sig;var e=this.get("model").id;var f="web";var g="letter_gd-exp";var h=p.default("gibdd");var i={id:c,sig:d,uidl:e,from:g,mp:f,ftrs:h};return"/fines/pay?"+r.default(i)},onFinePaymentRightClick:function(a){var b=this.getOriginalEvent(a);var c=b.target.dataset,d=c.id,e=c.sig;var f=this.formFinePaymentUrl(b);var g=m.default(f);if(d&&e&&g){b.target.setAttribute("href",f)}},onFinePaymentClick:function(a){var b=this.getOriginalEvent(a);var c=b.target.dataset,d=c.id,e=c.sig;var f=this.formFinePaymentUrl(b);var g=m.default(f);if(d&&e&&g){b.preventDefault();b.stopImmediatePropagation();D.default.openIframeLayer({paramsKey:"gibdd_group",additionalParams:{url:f},factoryParams:{dimmer:true,"close-on-esc":true}})}},onMonetaPaymentClick:function(a){var b=this.getOriginalEvent(a);var c=b.target.getAttribute("data-url");if(m.default(c)){b.preventDefault();b.stopImmediatePropagation();var d=b.target.getAttribute("data-moneta");var e="unsubscribe";var g="subscribe";var h=680;var i=683;var j="payment";if(d===e){h=420;i=341;j="unsubscribe"}else if(d===g){j="subscribe"}c=c.replace(f.MONETA_PAYMENT_LETTER_URL_REGEXP,window.location.origin+"/");c=c.replace("__monetaUidl__",this.get("model").id);var l={dimmer:true,from:"letter",scenario:j};if(f.PAYMENT_CENTER_NOT_HIDDEN){l["close-on-dimmer"]=false}c=k.default(c,{from:"letter",mp:"web"});D.default.open("moneta",{url:c,width:h,height:i},l)}},onToMyselfClick:function(){D.default.open("confirm-tomyself-enable",{},{compact:true,dimmer:true,resolvable:true,"close-on-dimmer":false,"close-on-esc":false,"reject-on-close":true}).then(function(){var b=a.default.get("to-myself").isActive();if(!b){n.default({type:"TOGGLE_TO_MYSELF_METATHREAD",state:true});G.default("letter_myself_on")}}).catch(function(a){if(a){G.default("ltr_mslf_open_err_"+a);throw a}})},onLetterComposeFromDraft:function(a){var b=a.type,c=a.details;var d=b.split(":").pop();var e=c.model,f=c.draftId;this.broadcast("compose:draft",{model:new y.default({id:f}),source:{id:e.get("id"),mode:d}})},onContactShow:function(a){a.details.type="correspondent";a.details.checkContactPossessing=this.get("checkContactPossessing");a.details.messageModel=this.get("model");C.default.show(a,{mobile:this.get("mobile")})},onTranslatorClose:function(){this.broadcast("translator:close",{model:this.get("model"),block:this})},onTranslatorHide:function(){this.broadcast("translator:hide",{model:this.get("model"),block:this})},onTranslatorOriginal:function(a){var b=a.details;this.broadcast("letter:original",{options:b,model:this.get("model"),block:this})},onTranslatorTranslate:function(a){var b=a.details;this.broadcast("letter:translate",{options:b,model:this.get("model"),block:this})},onTooltipShowImagesClick:function(){var a=this.get("model");y.default.fetchData({id:a.get("id"),folder_id:a.get("folder"),bulk_show_images:true},true,true).then(function(b){var c=a.getTranslationLast()||{},d=c.fromlang,e=c.tolang;if(d&&e){a.resetTranslation(d,e,"body.html")}var f=b.body;a.setCachedBody(f);a.set(b)})},onTooltipClose:function(){this.set("is-tooltip-visible",false)},onVkMessengerOpen:function(a){var b=this;var c=a.details;this._sendVkMessengerEvent("in_mail_toolbar_click_vk_messenger");if(f.VK_MESSENGER_EXTERNAL){s.default(c);return}K.vkMessengerLoader.open({chatId:c,onShow:function(){b._sendVkMessengerEvent("in_mail_open_vk_messenger")},darkMode:this.is("dark-mode")})},isLetterTranslated:function(){return this.is("is-letter-translated")},isTranslationLoading:function(){return this.is("is-translator-loading")},isTranslatorVisible:function(){var b=this.get("model");var d=b.is("flags.in_english");var g=a.default.get("translator-hide").isActive();var h=this.get("is-translator-forced-shown");var i=e.default.get("LANG");if(this.get("is-translator-visible")){return true}if(f.ENABLE_HIDE_TRANSLATOR&&g){return false}if(d&&!this.get("is-letter-in-english-radar-send")){c.default.send("letter_in_english",{dwh:{letterId:b.id,user_english:i==="en_US"}});this.set("is-letter-in-english-radar-send",true,true)}if(f.AUTOMATED_SHOW_TRANSLATOR&&!h&&!this.is("preview-mode")&&d&&i!=="en_US"){if(!this.get("is-automated-show-translator-radar-send")){c.default.send("letter_translator_show",{dwh:{letterId:b.id,automated_show:true,in_english:d}});this.set("is-automated-show-translator-radar-send",true,true)}return true}return false},isTooltipVisible:function(){return!this.is("preview-mode")&&this.is("is-tooltip-visible")},isImagesHiddenTooltipVisible:function(){var a=this.get("model");var b=a.get("images");var c=a.getFolder();var d=a.getCachedBody();return c.isSpam()&&b.exists&&b.hidden&&!d},getAttachmentsDowloadLink:function(){var a=this.get("model");var b=a.getAttachmentsDowloadLink();if(!b&&a.get("attaches.list.length")===1){var c=a.get("attaches.list.0");b=c.getDownloadUrl()}return b},getLetterBody:function(){var a=this.getLetterBodyTranslation();var b=this.get("model");var c=b.get("images");var d=b.getCachedBody();if(c.exists&&c.hidden&&d&&d.html){b.set("body.html",d.html)}return a||b.get("body.html")},getLetterBodyKey:function(){var a=this.getLetterBodyTranslation();var b=this.get("model");var c=b.getTranslationLast()||{},d=c.fromlang,e=c.tolang;var f=this.get("model").id;var g=a?d+":"+e:"";var h=b.get("images.hidden")?1:0;var i=this.isDarkMode()?1:0;return f+"_"+g+"_"+i+"_"+h},getLetterBodyTranslation:function(){var a=this.get("model");var b=a.getTranslationLast()||{},c=b.fromlang,d=b.tolang;if(!this.isLetterTranslated()||!this.isTranslatorVisible()||!c||!d){return""}return a.getTranslation(c,d,"body.html")},getMessageCorrespondents:function(){var a=this.get("model");var b=a.get("correspondents"),c=b.to,d=c===void 0?[]:c,e=b.cc,f=e===void 0?[]:e,g=b.bcc,h=g===void 0?[]:g;return[].concat.call([],d,f,h)},isLetterIdEq:function(a){return a===this.get("model").id},canCallTo:function(a){var b=__spreadArrays(a.get("correspondents.from")||[],a.get("correspondents.to")||[],a.get("correspondents.cc")||[]);return f.CALLS_P2P_OUTGOING&&B.default.getCallsAPIClient().canCallTo(b.map(function(a){return a.email})).some(function(a){return a.canCall})},onCallTo:function(a){var b=a.details;var c=__spreadArrays(b.get("correspondents.from")||[],b.get("correspondents.to")||[],b.get("correspondents.cc")||[]);B.default.getCallsAPIClient().callTo(c.map(function(a){return a.email})).then(function(a){if(a.redirectUrl){s.default(a.redirectUrl)}})},updateStickyStatus:function(a){var b=a.element,c=a.disableSticky,d=a.position,e=a.fade;this.stickyDisabled=c;this.updateSticky(b,d,e)},updateSticky:function(a,b,c,d){var e,g;if(d===void 0){d=false}var h=this.get("sticky-position");if(h==null){return}var i=h.right,j=h.left,k=h.width;var l=ha[a],m=l.offsetSide,n=l.offsetPadding,o=l.className;var p=this.el.getElementsByClassName(o)[0];if(!p){return}var q=p.getBoundingClientRect().height;if(b!==void 0&&!this.stickyDisabled){if(k){p.style.width=k+"px";p.style.left="";p.style.right=""}else{p.style.width="";p.style.left=j+"px";p.style.right=i+"px"}if(!f.IS_READLETTER_NATIVE_STICKY_DISABLED){this.set("sticky-"+a,true);p.style[m]="0px"}else{p.style[m]=b+"px";this.el.style[n]=q+"px";this.set((e={},e["sticky-"+a]=true,e["sticky-"+a+"-fade"]=c,e));d?this._startStickyTracking(p,o,h):this._stopStickyTracking(o)}}else{p.style[m]="";p.style.left="";p.style.right="";p.style.width="";this.el.style[n]="";this.set((g={},g["sticky-"+a]=false,g["sticky-"+a+"-fade"]=false,g),false)}},_startStickyTracking:function(a,b,c){if(this._windowResizeListeners[b]){this._stopStickyTracking(b)}var d=function(){if(window.innerWidth>c.maxWidth+c.left+c.right){a.style.left="";a.style.right="";a.style.width=c.maxWidth+"px"}else{a.style.left=c.left+"px";a.style.right=c.right+"px";a.style.width=""}};window.addEventListener("resize",d);this._windowResizeListeners[b]=d;d()},_stopStickyTracking:function(a){var b=this._windowResizeListeners[a];if(b){delete this._windowResizeListeners[a];window.removeEventListener("resize",b)}},_showDropdownCallButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-call-newsletters");return this.is("invite-call")&&!this.is("disable-call")&&!a},_showHeadCallButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-call-newsletters");return this.is("invite-call")&&!this.is("disable-call")&&!this.is("disable-head-call")&&!a},_showDropdownCalendarButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-calendar-newsletters");return!this.is("disable-create-event")&&!a},_showHeadCalendarButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-calendar-newsletters");return!this.is("disable-create-event")&&!this.is("disable-head-calendar")&&!a},_showUnsubscribeButton:function(){if(this.get("mobile")){return false}var a=this.get("model");var b=a.getFolder();if(b.isSpam()){return false}return this.is("feature-unsubscribe")&&a.get("flags.newsletter")},_showVkMessengerButton:function(){var a=this.get("transaction-metadata");if(!a){return false}var b=a.get("vk_chat_href");if(!b){return false}return true},_getVkMessengerParams:function(){var a=this.get("transaction-metadata");var b=a===null||a===void 0?void 0:a.get("vk_chat_href");var c=a===null||a===void 0?void 0:a.get("vk_chat_id");var d=a===null||a===void 0?void 0:a.get("shop_name");return{href:f.VK_MESSENGER_EXTERNAL?b:c,text:d?i18n("Чат с {shopName}",{shopName:d}):i18n("Чат в VK")}},_sendVkMessengerEvent:function(a){if(!this._showVkMessengerButton()){return}var d=this.get("model");var e=this.get("transaction-metadata");var g={is_order:d.get("transaction_category")===b.OperandCategoryTypes.ORDER,letter_id:d.get("id"),partner_email:d.get("correspondents.from.0.email"),partner_name:e.get("shop_name")};if(a!=="open_mail_with_vk_messenger"){g.destination=f.VK_MESSENGER_EXTERNAL?"outside":"inside"}if(a==="in_mail_open_vk_messenger"){g.from="toolbar"}c.default.send(a,{dwh:g})},_showFilterButton:function(){return!f.FORBID_FILTERS},_showSpam:function(){var a=this.get("model").getFolder();return!f.FORBID_SPAM&&!a.isSpam()},_showUnsubscribeInMoreMenu:function(){var a=this.get("model");var b=a.is("flags.newsletter")&&a.is("flags.show_definitely_spam")&&a.is("flags.have_unsubscribe_list");return f.UNSUBSCRIBE_IN_MORE_DROPDOWN&&b},hasReplyAll:function(a){return q.hasLetterReplyAll(a)},isAMPLetter:function(){var a=this.get("model");return f.ENABLE_AMP&&!this.is("amp-error")&&a.get("body.amp")},isDarkMode:function(){return this.isDarkModePossible()&&this.is("dark-mode-enabled")},isDarkModePossible:function(){return!this.isAMPLetter()&&this.is("dark-mode")},onAmpError:function(){this.set("amp-error",true)},onDarkModeToggle:function(){this.radar(["turn-on",this.is("dark-mode-enabled")?"light-mode":"dark-mode"]);this.invert("dark-mode-enabled")},isProbablyPhishing:function(){var a=this.get("model");return f.PHISHING_ALERT&&a.get("flags.maybe_phishing")},checkFolderGrant:function(a){var b=this.get("model");return b.checkGrant(a)},isEnableReply:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(x.default.SHARE_GRANTS.reply)},useNewToolbar:function(){return f.NEW_TOOLBAR},isShowSmartReplyAndMarusia:function(){var a,b;if(!f.HIDE_MESSAGE_SMART_REPLY&&!f.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH){return true}var d=this.reactComponent?(b=(a=this.letterBody)===null||a===void 0?void 0:a.current)===null||b===void 0?void 0:b.el:this.refs["letter-body"];var e=window.innerHeight;var g=d===null||d===void 0?void 0:d.clientWidth;var h=this.isSmartReplyHiddenRadarSended;var i=false;var j="";if(f.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH){i=g<650||!g;j="_width"}if(f.HIDE_MESSAGE_SMART_REPLY){i=e<800&&g<650||!g}if(i&&!h){c.default.send("letter_hide_smart-reply"+j);this.isSmartReplyHiddenRadarSended=true}return!i},isShowFooter:function(){var a,b;if(!f.HIDE_MESSAGE_FOOTER){return true}var d=this.reactComponent?(b=(a=this.letterBody)===null||a===void 0?void 0:a.current)===null||b===void 0?void 0:b.el:this.refs["letter-body"];var e=window.innerHeight;var g=d===null||d===void 0?void 0:d.clientWidth;var h=this.isFooterHiddenRadarSended;var i=e<800&&g<650||!g;if(i&&!h){c.default.send("letter_hide_footer");this.isFooterHiddenRadarSended=true}return!i},isEnableCall:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(x.default.SHARE_GRANTS.reply)},isEnableForward:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(x.default.SHARE_GRANTS.forward)},isEnableMark:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(x.default.SHARE_GRANTS.mark_as_important)},isEnableAttach:function(){return this.checkFolderGrant(x.default.SHARE_GRANTS.view_attachment)},isDatesMetadataEnabled:function(){var a=this.get("dates-metadata");return f.DATES_METADATA&&a},isEnableConfirmationReceipt:function(){var a=this.get("model");var b=a.is("flags.receipt");var c=this.is("preview-mode");var d=!a.getFolder().isShareTake();return Boolean(!c&&b&&d)},isSmartRepliesAvailable:function(a){return this.is("smart-reply-on")&&a.is("flags.smart_reply")&&!this.is("readonly")},isMarusiaReadLetterEnabled:function(){var a;var b=this.get("model");return f.MARUSIA_READ_LETTER&&!((a=b.getFolder())===null||a===void 0?void 0:a.isSecure())&&this.isSmartRepliesAvailable(b)},getMarusiaReadLetterRadarPrefix:function(){return f.MARUSIA_READ_ALL_LETTERS?"all":"smart"},hasCloudStockAttach:function(){var a;var b=this.get("model");var c=(a=b.getAttachmentsList())!==null&&a!==void 0?a:[];return!!c.find(function(a){return a.isCloudStock()})},getLetterMetaHeaderType:function(a){if(a.get("flags.maybe_phishing")){return"phishing"}if(f.EXPIRED_ATTACHES_DIE&&this.hasCloudStockAttach()){return"expired_attaches"}return null},isShowFakeCreateTodo:function(){if(!f.FAKE_CREATE_TODO){return false}return!I.default.get("create_todo_fake_button_shown")}};exports.default=g.default.Block.extend(F.default({explicit:"radar",events:[{name:"mount",data:u.getModelData},{name:"unmount",data:u.getModelData},{name:"compose:reply",data:u.getModelData},{name:"compose:replyall",data:u.getModelData},{name:"compose:forward",data:u.getModelData},{name:"compose:smartreply",data:u.getModelData},{name:"togglestatus:unread",rename:function(a){return u.renameRadarOnStatusToggle(a,"unread")}},{name:"togglestatus:flagged",rename:function(a){return u.renameRadarOnStatusToggle(a,"flagged")}}]})(exports.blockSpec))});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/compose-manager",["require","exports","@mail/contact-validation","@mail/flags","@mail/xray","cloud/Entry","data-source/actions","data-source/data-source","data-source/source/ui-layout","data-source/utils/paginator","default-values","feast","helpers/data-source-dispatch","helpers/encode","mail/Attachment","mail/AttachSearch","mail/Message","mail/SmartReply","mail/Thread","pilotjs","service/auth","service/calls","service/compose","service/dimmer","service/notify","service/promo","ui-block/compose-dropdown/compose-dropdown","ui-block/dataset-letters/dataset-letters","ui-block/dropdown-actions/dropdown-actions","ui-block/letter/letter","ui-block/octopus/octopus","ui-block/paginator-container/paginator-container","ui-block/portal-menu/portal-menu","ui-block/sidebar/sidebar","ui-block/sidebar-folders/sidebar-folders","ui-block/thread/thread","ui-block/webview-mobile-header/webview-mobile-header","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);var K=["compose:new","compose:reply","compose:replyall","compose:forward","compose:preload","compose:draft","compose:template","compose:schedule","compose:smartreply","compose:tomyself"];var L=/,(?=(?:[^"]*"[^"]*")*[^"]*)/;function M(a){var b={};Object.entries(a).forEach(function(a){var c=a[0],d=a[1];if(typeof d==="string"){b[c.toLowerCase()]=d}});return b}var N=function(b,c){if(c===void 0){c=L}if(!b){return[]}return b.split(c).map(function(a){return a.trim()}).filter(function(a){return a}).map(a.checkTextValidity).filter(function(a){return a.valid}).map(function(a){return{email:a.email,name:a.name}})};var O=/(?:mailto:)?(.*)/;var P="%2C%20";function Q(a){if(!a){return{}}c.default.send("mailto_link");var b=a.match(O)[1];var d=b.indexOf("?");var e=d!==-1;var f={};if(e){var g=b.slice(d+1);var h=b.slice(0,d);var i=h?N(h,P):[];var j=g.split(/&amp;|&/g).filter(function(a){return a});var k={};j.forEach(function(a){var b=a.split("="),c=b[0],d=b[1];if(!c||!d){return}try{k[c]=decodeURIComponent(d)}catch(a){}});["to","cc","bcc"].forEach(function(a){f[a]=N(k[a])});f.to=f.to.concat(i);return __assign(__assign({},k),f)}return{to:N(b)}}var R=function(a){__extends(j,a);function j(){return a!==null&&a.apply(this,arguments)||this}j.prototype.getComponentsSpec=function(){return{router:{class:r.default,events:["beforeroute","route","reloadend"],handleEvent:"handlePilotEvent"},dataSource:{class:f.default,events:["actionend"],handleEvent:"handleDataSourceActionEnd"},"portal-menu":{class:E.default,events:K},"webview-mobile-header":{class:I.default,events:K},sidebar:{class:F.default,events:K},"sidebar-folders":{class:G.default,events:K},"compose-dropdown":{class:y.default,events:K},thread:{class:H.default,events:K},letter:{class:z.default,events:K},dropdownActions:{class:A.default,events:K},"compose-windows":{lazy:J.lazyUIComposeWindows,events:["window-show","window-hide","window-collapsed-hide","window-extend"],attrs:{"paginator-visible":function(a){return(h.isPaginatorGlobalEnabled(a.get("router"))||i.ENABLE_NAV_UP)&&a._isPaginatorVisible},extended:function(a){return a.isExtended()}},handleEvent:"handleWindowState"},"dataset-letters":{class:B.default,events:K},octopus:{class:C.default,events:["compose:new"]},"paginator-container":{class:D.default,events:["show","hide"],handleEvent:"handlePaginatorVisibility"},"layer-sent-page":{lazy:J.lazyUILayerSentPage,events:["compose:draft"]}}};j.prototype.toggleExtendMode=function(){k.default({type:e.TOGGLE_COMPOSE_EXTEND_MODE})};j.prototype.isExtended=function(){var a=this.get("router.model.uiLayout")||g.defaults;return a.composeExtended};j.prototype.handleWindowState=function(a){switch(a.type){case"windowextend":{this.toggleExtendMode();return false}default:{this.handleChangeVisibility(a);break}}};j.prototype.handleChangeVisibility=function(a){var b=a.type;if(b!=="windowcollapsedhide"){var c=this.get("thread");if(c){c.set("load-draft-disabled",b==="windowshow")}}x.default.update()};j.prototype.handlePaginatorVisibility=function(a){var b=a.type;switch(b){case"show":this._isPaginatorVisible=true;break;case"hide":this._isPaginatorVisible=false;break}};j.prototype.handleDataSourceActionEnd=function(a){var b=a.details;if(b.action.type===e.TOGGLE_COMPOSE_EXTEND_MODE){return true}return false};j.prototype.handleEvent=function(a){var b=a.type,c=a.details,d=a.originalEvent;var e=b.split(":").pop();var f=c.model||c;if(e==="new"&&d){if(d.metaKey||d.ctrlKey){return false}else{d.preventDefault()}}if(e==="preload"){u.default.preload()}else if(e==="smartreply"){var g=p.default.all.get(f.id);var h=g.get("replies")[c.key]+"\x3c!--focus--\x3e";u.default.open({mode:"smartreply",model:f,body:h})}else if(e==="tomyself"){var i=s.default.user;var j=i.get("name"),k=j.first,l=j.last;var m=i.getEmail();u.default.open({mode:"new",correspondents:{to:[{email:m,name:[k,l].filter(function(a){return!!a}).join(" ")||m}]}})}else{f=this._isMessage(f)?f:this.get("router.model.letter");u.default.open({mode:e,model:f,source:c.source})}};j.prototype._isMessage=function(a){return a&&(a instanceof q.default||a instanceof o.default)};j.prototype.getAttachesFromUrl=function(a,b){var e=b.composeaction,f=b.composeid;var g=a.cloud_files_ids,h=g===void 0?"":g;var i=[];if(e==="forward-file"&&f){try{var j=f.split(",");i=j.map(function(a){var b=a.split(";"),c=b[0],d=b.slice(1);var e=d.join(";");return{letterId:c,attachIdInLetter:e}})}catch(a){c.default.send("compose-fwdfile-parseerr",{rlog:"compose-route",rlog_message:{type:"compose-fwdfile-parseerr",error:a}})}}var k=i.map(function(a){var b=a.letterId,c=a.attachIdInLetter;return o.default.findOne({id:b}).then(function(a){var d=a.get("attaches.list").get(c);return m.default.from(new n.default({name:d.get("name"),size:d.get("size"),id:b,folder:a.get("folder"),n:d.get("id").split(";")}))})});var l=[];try{l=JSON.parse(h);if(!Array.isArray(l)){l=[]}else{l=l.map(function(a){return d.default.findOne(a).then(function(a){return m.default.fromAsync(a)})})}}catch(a){l=[]}return k.concat(l)};j.prototype.getReplyOptionsFromUrl=function(a){var b=a.composeaction;var c=a.composeid;var d="new";var e=Promise.resolve(null);if(b==="drafts"){b="draft"}if(b==="replyall"||b==="reply"||b==="forward"||b==="draft"){d=b;e=o.default.findOne({id:c})}return{mode:d,modelPromise:e}};j.prototype.getRouteParams=function(a){return __awaiter(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,u,v,x,y,z,A,B,C,D;return __generator(this,function(E){d=a.activeUrl.query;e=a.activeRequest.params;f=M(d);g=f.subject,h=g===void 0?"":g,i=f.body,j=i===void 0?"":i,k=f.mailto,m=f.calls,n=f["create-call"],o=f["template-name"],p=f["from-mailto-handler"];c.default.send("compose_get_params",{dwh:{subject:Boolean(h),body:Boolean(j),mailto:Boolean(k),calls:Boolean(m),"create-call":Boolean(n),"template-name":Boolean(o),"from-mailto-handler":Boolean(p)}});if(p){q=b.default.get("from-mailto-handler-count");q===null||q===void 0?void 0:q.save({hit:true})}r=this.getAttachesFromUrl(f,e);s=this.getReplyOptionsFromUrl(e),u=s.modelPromise,v=s.mode;x=Q(k);y=x.subject?x.subject:h;z=x.body?x.body:j;A="";B=false;if(typeof z==="string"){A=l.default(z);B=!!A.length;if(m){A=t.default.getTemplate(A);if(!y){y=t.default.getSubject()}c.default.send("calls_insert_fromquery")}else{A="<div>"+A+"</div>"}}A=A.replace(/[\n]/g,"<br/>");C={};["to","cc","bcc"].forEach(function(a){C[a]=N(f[a]).concat(x[a]||[])});D={mode:v,body:A,correspondents:C,subject:y,createCall:n&&!z.length,additionalOptions:{prefilledBody:B,attachFiles:r,templateName:o}};return[2,u.then(function(a){return __assign(__assign({},D),{model:a})},function(){w.default.error({text:i18n("Не удалось найти исходное письмо")},"compose-notify");return __assign(__assign({},D),{model:null,mode:"new"})})]})})};j.prototype.handleRoute=function(a){var b=a.type,d=a.target;var e=d.activeRequest.alias==="compose";if(!e){return false}switch(b){case"beforeroute":u.default.preload();v.default.add();break;case"route":this.getRouteParams(d).then(function(a){var b=a.createCall,d=a.model,e=a.mode,f=a.correspondents,g=a.body,h=a.subject,i=a.additionalOptions;if(b&&!h){h=t.default.getSubject()}var j=u.default.open({mode:e,model:d,correspondents:f,body:g,subject:h,additionalOptions:i});if(b){t.default.createRoom().then(function(a){var b=t.default.getTemplate(a);j.then(function(){u.default.insertHtml(b)})}).catch(function(a){if(a==="ratelimit"){w.default.error({text:i18n("Достигнут лимит создания звонков. Попробуйте позже.")},"compose-notify")}else{w.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")}});c.default.send("calls_create_fromquery")}return j}).then(function(){v.default.remove()});break}return false};j.prototype.handlePilotEvent=function(a){var b=a.type==="reloadend";if(b){this.getList("compose-windows").forEach(function(a){return a.render()})}else{return this.handleRoute(a)}};return j}(j.default.Mediator);exports.default=j.default.Mediator.createFromClass("compose-manager",R)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/contact-selection",["require","exports","default-values","feast","feast-mod/correspondents","lazy.modules","pilotjs","service/contextmenu","service/smokescreen","ui-block/letter-contact/letter-contact"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);h=__importDefault(h);exports.default=b.default.Mediator.create("contact-selection",{components:{router:{class:e.default,events:["routeend"]},"letter-contact":{class:h.default,events:["rightclick"]}},defaults:function(){if(a.TOUCH_MODE){return}this.onKeyboardCopy=this.onKeyboardCopy.bind(this);this.onSelectionChange=this.onSelectionChange.bind(this);this.onKeyUp=this.onKeyUp.bind(this);this.selectionRange=null;this.copyEl=document.createElement("input");this.copyEl.setAttribute("type","text");this.copyEl.setAttribute("tabindex","-1");this.copyEl.style.position="absolute";this.copyEl.style.overflow="hidden";this.copyEl.style.bottom="0";this.copyEl.style.marginLeft="-10000px";this.copyEl.style.width="auto";document.body.appendChild(this.copyEl)},toggleListeners:function(a){var b=this;var c="command+c,ctrl+c";d.lazyMailKeymaster().then(d.uniqCallback(this,function(d){if(a){d(c,b.onKeyboardCopy);document.addEventListener("selectionchange",b.onSelectionChange)}else{d.unbind(c,b.onKeyboardCopy);document.removeEventListener("selectionchange",b.onSelectionChange)}}))},onKeyUp:function(){document.removeEventListener("keyup",this.onKeyUp);var a=document.getSelection();a.removeAllRanges();a.addRange(this.selectionRange);this.selectionRange=null},handleEvent:function(b){if(a.TOUCH_MODE){return}var c=b.type;var d=this.get("router");var e=d.request;if(!d.route){return}switch(c){case"routeend":{var f=e.route;if(f&&f.is&&f.is("#read-letter #search-letter")){this.toggleListeners(true)}else{this.toggleListeners(false)}break}case"rightclick":{this.onRightClick(b);break}}return false},onSelectionChange:function(){var a=this.getList("letter-contact");var b=a.length;if(b===0){return}if(this.selectionRange){return}var c=document.getSelection();for(var d=0;d<b;d++){var e=a[d].el;if(e&&e.firstChild){var f=!c.isCollapsed&&c.containsNode(e,true);var g=a[d].get("active");if(g!=f){a[d].set("active",f)}}}},onKeyboardCopy:function(){var a=document.getSelection();var b=this.getSelectedBlocks();if(b.length===0||!b[0]||!b[0].el){return}var c=b[0].el.closest(g.selector(".letter__head"));var d=a.anchorNode;var e=a.focusNode;if(d.nodeType===Node.TEXT_NODE){d=d.parentNode}if(e.nodeType===Node.TEXT_NODE){e=e.parentNode}if(c.contains(d)&&c.contains(e)){var f=this.getText(b);this.selectionRange=a.getRangeAt(0);this.copyEl.value=f;this.copyEl.focus();this.copyEl.select();document.addEventListener("keyup",this.onKeyUp)}},onRightClick:function(a){var b=a.details;if(!b.is("active")){this.showContextMenu(a,[b]);return}var c=this.getSelectedBlocks();if(c.length===0||!c[0]||!c[0].el){return}this.showContextMenu(a,c)},showContextMenu:function(a,b){var c=this.getText(b);var d=this.getContacts(b);a.details={type:"correspondents",clipboardText:c,contacts:d};f.default.show(a)},getText:function(a){return c.correspondentsFull(a.map(function(a){return a.get("contact")})).join(", ")},getContacts:function(a){return a.map(function(a){return a.get("contact")})},getSelectedBlocks:function(){var a=this.getList("letter-contact");var b=a.length;if(b===0){return[]}return a.filter(function(a){return a.is("active")})}})});define("mediator/features",["exports","@mail/features","feast","ui-block/letter-body/letter-body"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("features",{defaults:function a(){},components:{"letter-body":{class:f.default,attrs:{"features-blockquote":function a(){return d.default.has("blockquote")},"features-blockquote-threads":function a(){return d.default.has("blockquote-threads")}}}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/filter-manager",["require","exports","feast","mail/Thread","pilotjs","route/utils/filter-query","ui-block/filters/filters","ui-block/list-nested-sorting/list-nested-sorting","ui-block/octopus/octopus","ui-block/portal-menu/portal-menu"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i=function(a){__extends(i,a);function i(){var b=a!==null&&a.apply(this,arguments)||this;b.filters={all:true,unread:false,flagged:false,with_attachments:false};b.sortingType="D";return b}i.prototype.getComponentsSpec=function(){return{router:{class:c.default,events:["beforeroute","route","routeend"]},filters:{class:e.default,events:["filterchange","filterclick","resetall"],attrs:{filter:function(a){return a.filters},sortingType:function(a){return a.sortingType}}},sortings:{class:f.default,events:["sortingclick"],attrs:{sortingType:function(a){return a.sortingType}}},"portal-menu":{class:h.default,attrs:{filter:function(a){return a.filters},sortingType:function(a){return a.sortingType}}},octopus:{class:g.default,attrs:{filter:function(a){return a.filters}},events:["filterclick"]}}};i.prototype.handleEvent=function(a){var c;var e=this.get("router");var f=e.activeRoute;var g=e.activeRequest;var h=g.params.folder;var i=e.route;var j=i?i.params.letter:void 0;var k=((c=e.route)!==null&&c!==void 0?c:{}).request,l=k===void 0?{}:k,m=l.query,n=m===void 0?{}:m,o=n["to-parent-button"],p=o===void 0?null:o;switch(a.type){case"filterclick":{if(a.details==="all"){d.default.resetFilters()}else{d.default.applyFilter(a.details)}e.go("#letters",{preserveFilters:"true",folder:h},p&&{"to-parent-button":p});break}case"sortingclick":{if(a.details!==this.sortingType){d.default.applySorting(a.details);e.go("#letters",{preserveFilters:"true",preserveSortings:"true",folder:h},p&&{"to-parent-button":p})}break}case"resetall":{d.default.resetFilters();d.default.resetSorting();e.go("#letters",{preserveFilters:"true",preserveSortings:"true",folder:h},p&&{"to-parent-button":p});break}case"beforeroute":{var q=f.is("#letters #read-letter")?e.activeUrl.query:{};var r=j&&b.default.get(j);d.default.set(q);if(r&&!d.default.isLetterInFilter(r)){window.history.replaceState(null,null,g.href);e.nav(g.href)}break}case"routeend":{this.filters=d.default.getFilterConfig();this.sortingType=d.default.getSortingType();this.updateAll();break}}};return i}(a.default.Mediator);exports.FilterManager=i;exports.default=a.default.Mediator.createFromClass("filter-manager",i)});define("mediator/flags",["exports","feast","pilotjs","ui-block/dataset-letters/dataset-letters","ui-block/letter-body/letter-body"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("flags",{defaults:function a(){},components:{router:{class:f.default},"letter-body":{class:h.default,attrs:{"flags-threads":function a(b){return b.get("router.model.uiThreadsSettings").threads}}},"dataset-letters":{class:g.default,attrs:{threadsEnabled:function a(b){return b.get("router.model.uiThreadsSettings").threads}}}}})});define("mail/actions/MarkAsAll",["logger","utils/util","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f,g){"use strict";var h=d.extend({folderFrom:null,prepare:function(a){var c=a.flag,d="flags."+c,h=e.getSafe(a.folderFrom),i=!!a.state,j={},k={clean:true},l;l=[].concat(f.all.filter({folder:h.id}).toArray(),g.all.filter({folder:h.id}).toArray());this.folderFrom=h;var m=function(a,b){var e,f,g;if(c=="unread"){if(!b){j["folder.unread"]=h.get("messages_unread")}h.set("messages_unread",b?j["folder.unread"]:a?h.get("messages_total"):0,k)}e=l.length;while(e--){g=l[e];if(b){a=j[g.id]}else{j[g.id]=g.get(d)}if(c==="unread"&&g.is("flags.mention")){var i={};i[d]=a;i["flags.mention_unread"]=a;g.set(i,k)}else{g.set(d,a,k)}}};m(i);this.rollbackOperation=b.bindWithoutArgs(m,[!i,true]);return a},operation:function(a){return this._markAs(a.folderFrom,a.flag,a.state)},_markAs:function(a,b,d){b=[].concat(b);var e={folder:a,marks:JSON.stringify(b),action:d?"set":"unset"};return c.call(f.fn.markAsAllUrl,e)}});d.register("mail.MarkAsAll",h);h.version="0.1.0";return h});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/folders-actions",["require","exports","data-source/actions","data-source/data-source","data-source/index","default-values","feast","helpers/data-source-dispatch","mail/actions/MarkAsAll","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","pilotjs","service/layer","service/mailbox/loader","service/radars/index","service/secure-folder","ui-block/contextmenu-folder/contextmenu-folder","ui-block/list-letter-tip/list-letter-tip","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/metathread-head-common/metathread-head-common","ui-block/metathread-head-compact/metathread-head-compact","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded","ui-block/nav-folders/nav-folders","ui-block/new-folder-btn/new-folder-btn","ui-block/portal-menu-element/portal-menu-element","ui-block/settings-dock/settings-dock","ui-block/thread/thread","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);var C=function(e){__extends(C,e);function C(){return e!==null&&e.apply(this,arguments)||this}C.prototype.getComponentsSpec=function(){return{router:{class:l.default},"context-menu":{class:q.default,events:["read","clear","remove","add","edit","lock","unlock","share","disable:tomyself"],attrs:{"to-myself-enabled":function(a){return a.get("router.model.uiThreadsSettings").toMyself}}},"metathread-head-common":{class:t.default,events:["clear","read"]},"metathread-head-compact":{class:u.default,events:["clear","read"]},"metathread-head-compact-expanded":{class:v.default,events:["clear","read"]},"nav-folders":{class:w.default,events:["clear"]},"portal-menu-element":{class:y.default,events:["clear"]},"new-folder-btn":{class:x.default,events:["add"]},"layer-metathreads-settings":{lazy:B.lazyUILayerMetathreadsSettings,attrs:{metathreadsSettings:function(a){return a.get("router.model.uiThreadsSettings").metathreadsSettings}}},"list-letter-tip":{class:r.default,events:["clear"]},"list-nested-moveto-folder":{class:s.default,events:["add"]},"settings-dock":{class:z.default,attrs:{metathreadsSettings:function(a){return a.get("router.model.uiThreadsSettings").metathreadsSettings}}},thread:{class:A.default},"confirm-delete-folder":{lazy:B.lazyUILayerConfirmDeleteFolder}}};C.prototype.handleEvent=function(a){if(b.isDataSourceEvent(a)){var c=a.type;var d=a.details.model;if(c==="add"||d){var e={type:c};this.doAction(e,d)}}};C.prototype.clear=function(a){var b=this;m.default.open("confirm-clear-folder",{model:a,mobile:k.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true,mobile:k.default.isLessThen("xs")}).then(function(){a.cleanup().then(function(){return c.default.updateAll()}).then(function(){if(b.get("router.model.folder.id")===a.id){var c=b.get("router");c.go("#letters",{folder:a.id})}if(b.get("router.route.id")==="#read-letter"){var d=b.get("thread");if(d){var e=d.get("model");i.default.fetchData({id:e.get("expand"),folder_id:a.id},true,true).then(function(a){d._loadDraft(new j.default({expand:e.get("expand"),messages:[a]}))})}}})}).catch(function(a){if(a){throw a}})};C.prototype.read=function(a){g.default.execute({flag:"unread",state:false,folderFrom:a.get("id")})};C.prototype.doAction=function(a,b){var c=this;if(a.type==="read"){this.read(b)}else if(a.type==="clear"){this.clear(b)}else if(a.type==="remove"){this.remove(b)}else if(a.type==="add"){this.add(b)}else if(a.type==="share"){this.share(b)}else if(a.type==="edit"){if(b.get("open")){this.edit(b)}else{p.default(b).then(function(a){if(a){c.edit(b)}})}}else if(a.type==="unlock"){p.default(b).then(this.invalidateCacheAndUpdateAll.bind(this))}else if(a.type==="lock"){b.secureClose().then(this.invalidateCacheAndUpdateAll.bind(this))}else if(a.type==="disable:tomyself"){this.disableToMyself(b)}};C.prototype.add=function(a){m.default.open("create-folder",{model:a,mode:"new"},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,"reject-on-close":true,"close-on-esc":false,mobile:k.default.isLessThen("xs")}).catch(function(a){if(a){throw a}})};C.prototype.share=function(a){m.default.open("share-folder",{model:a,handleFinal:null},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,"reject-on-close":true}).catch(function(a){if(a){throw a}})};C.prototype.edit=function(a){m.default.open("create-folder",{model:a,mode:"edit"},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,"reject-on-close":true,"close-on-esc":false,mobile:k.default.isLessThen("xs")}).catch(function(a){if(a){throw a}})};C.prototype.remove=function(a){var b=this;m.default.open("confirm-delete-folder",{model:a,mobile:k.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true,mobile:k.default.isLessThen("xs")}).then(function(){var d=b.get("confirm-delete-folder");a.remove().then(function(){return c.default.updateAll()},function(a){var c=b.handleFolderRemoveErrors(a);d.set({error:c,processing:false});throw a}).then(function(){if(b.get("router.model.folder.id")===a.id){var c=b.get("router");c.go("#letters",{folder:h.default.TYPE_INBOX})}d.broadcast("layer:close")},function(){})}).catch(function(a){if(a){throw a}})};C.prototype.disableToMyself=function(b){var c=this;var e=function(){f.dispatchAndWait({type:a.TOGGLE_TO_MYSELF_METATHREAD,state:false}).then(function(){o.default({type:"tomyself-disable",intervals:[["fldr-ctx-menu",1]]});if(c.get("router.model.folder.id")===b.id){var a=c.get("router");a.go("#letters",{folder:h.default.TYPE_INBOX})}c.updateAll()})};if(d.LAYER_METATHREAD_DISABLE){m.default.open("disable-metathread",{model:b},{dimmer:true,resolvable:true,"close-on-dimmer":true,"reject-on-dimmer":true,"close-on-esc":false,"reject-on-close":true}).then(function(){e()}).catch(function(a){if(a){throw a}})}else{e()}};C.prototype.invalidateCacheAndUpdateAll=function(b){if(b){n.default.invalidateCache();c.default.dispatch({type:a.UPDATE_ALL,priority:l.default.Loader.PRIORITY_LOW})}};C.prototype.handleFolderRemoveErrors=function(a){var b="unknownError";var c={"ids[0]":{is_collector_root:"isCollectorRoot",invalid:"systemFolder",not_exists:"folderNotExists",unknown:"invalidFolder"}};var d=a.body;Object.keys(d).forEach(function(a){if(!(a in c)){b="unknownError";return}var e=d[a].error;if(e in c[a]){b=c[a][e]}else{b=c[a]["unknown"]}});return b};return C}(e.default.Mediator);exports.default=e.default.Mediator.createFromClass("folders-actions",C)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/folders-navigation",["require","exports","@mail/xray","data-source/actions","data-source/index","default-values","feast","mail/Folder","pilotjs","service/secure-folder","ui-block/application-mail/application-mail","ui-block/button2/button2","ui-block/dataset-letters/dataset-letters","ui-block/nav-folders/nav-folders","ui-block/octopus/octopus"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FoldersNavigation=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);var n=function(e){__extends(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}n.prototype.getComponentsSpec=function(){return{router:{class:g.default,events:["route"]},button:{class:j.default,events:["back:to:parent:folder"]},"application-mail":{class:i.default,attrs:{showBackToParentFolder:function(a){return a.isBackToParentEnabled()}}},"nav-folders":{class:l.default,attrs:{showBackToParentFolder:function(a){return a.isBackToParentEnabled()}}},octopus:{class:m.default,attrs:{transparent:function(a){return a.isDatasetTransparent}},events:["secure:opencurrent","secure:open"]},"dataset-letters":{class:k.default,events:["back:to:parent:folder"]}}};n.prototype.handleEvent=function(a){switch(a.type){case"secure:open":{this.secureOpen(a.details);break}case"secure:opencurrent":{this.secureOpenCurrent();break}case"route":{this.handleBackToParentFolder();break}case"back:to:parent:folder":{this.doBackToParentFolder(a);break}}};n.prototype.doBackToParentFolder=function(b){a.default.send("back-to-parent-nav",{dwh:{pos:b.details.pos}});var c=this.get("router");var d=c.model,e=d.folder,f=d.folders;if(!e||!f){return}var g=f.find(function(a){return a.id===e.get("parent")});c.nav(c.getUrl("#letters",{folder:g.id}),{initiator:"popstate"})};n.prototype.secureOpenCurrent=function(){var a=this.get("router");this.secureOpen(a.model["folder"])};n.prototype.secureOpen=function(a){var d=this.get("router");var e=f.default.all.get(a);e&&h.default(e).then(function(){if(d.route.is("#search #search-letter")){return c.default.dispatch({type:b.UPDATE_SEARCH})}return c.default.updateAll()})};n.prototype.isBackToParentEnabled=function(){if(!d.METATHREAD_BACK_TO_INBOX){return false}var a=this.get("router").request.query["to-parent-button"];return!!a};n.prototype.handleBackToParentFolder=function(){if(!d.METATHREAD_BACK_TO_INBOX){return}var a=this.get("router");var b=a.activeRoute,c=a.previousRoute;if(!c){return}var e=b.params.folder;var f=c.params.folder;var g=a["model"].folders;if(!g){return}var h=g.find(function(a){return a.id==e});var i=g.find(function(a){return a.id==h.get("parent")});var j=(i===null||i===void 0?void 0:i.id)==f;var k=b.is("#letters #read-letter")&&c.is("#letters #read-letter")&&e===f;if(k||j){return}var l=a.route.id,m=a.request,n=m.params,o=m.query,p=o["to-parent-button"],q=__rest(o,["to-parent-button"]);var r=c.request.query["to-parent-button"];if(p&&r){a.nav(a.getUrl(l,n,q),{replaceState:true})}};return n}(e.default.Mediator);exports.FoldersNavigation=n;exports.default=e.default.Mediator.createFromClass("folders-navigation",n)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letter-attaches-preview",["require","exports","feast","service/search-attaches/getAttaches","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-compact/list-letter-compact"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LetterAttachesPreview=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var e=function(a){__extends(e,a);function e(){return a!==null&&a.apply(this,arguments)||this}e.prototype.getComponentsSpec=function(){return{"list-letter-common":{class:c.default,events:["$mount"]},"list-letter-compact":{class:d.default,events:["$mount"]}}};e.prototype.handleEvent=function(a){var b=a.type,c=a.details;switch(b){case"$mount":this.fetchAttaches(c);break}};e.prototype.fetchAttaches=function(a){var c=a.get("show-attaches");var d=a.get("model").get("attachments_count");var e=a.get("fetchAttaches")&&!a.get("messagesAttaches");if(c&&d&&!e){b.fetchMessagesAttaches(a.get("model")).then(function(b){a.set({messagesAttaches:b,fetchAttaches:true})})}};return e}(a.default.Mediator);exports.LetterAttachesPreview=e;exports.default=a.default.Mediator.createFromClass("letter-attaches-preview",e)});define("mediator/letter-list-adv-optimizer",["exports","feast","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/scrollable/scrollable","ui-block/spec-project-letter/spec-project-letter"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("letter-list-adv-optimizer",{defaults:function a(){this._queue=[];this._isScrolling=false},components:{scrollable:{class:g.default,events:["scroll:change","scroll:end"]},"spec-project-letter":{class:h.default,events:["render:adv","render:remove"]},"letter-list-adv":{class:f.default,events:["render:adv","render:remove"]}},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"scroll:change":{this._isScrolling=true;break}case"scroll:end":{this._isScrolling=false;this.progressQueue();break}case"render:adv":{var e=d.advRender;if(this._isScrolling){this._queue.push(d);return}e();break}case"render:remove":{var f=d;this._queue=this._queue.filter(function(a){return a.advName!==f});break}}return false},progressQueue:function a(){while(this._queue.length){this._queue.pop().advRender()}}})});define("mail/actions/MoveTo",["logger","utils/util","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f,g){"use strict";var h=d.extend({models:[],folderTo:null,_findFolders:function(a){var b=Promise.resolve(),c=[];a.forEach(function(a,f){b=b.then(function(){return e.findOne(a).then(function(a){if(a.isSecureOpen()){c[f]=a}else{return d.waitFor("folderSecure",[a]).then(function(){c[f]=a})}})})});return b.then(function(){return c})},prepare:function(a){var b=a.folderTo,c=(a.models||[]).filter(function(a){return a.get("folder")!=b});if(c.length===0){return null}this._rollbackFolders={};this.models=c;if(this.folderTo){return Promise.resolve(c)}return this._findFolders([b]).then(function(a){this.folderTo=a[0];return c}.bind(this))},operation:function(a,b){var c=this._calculateMoveToParams(a,false);this._applyChanges(a,b.folderTo);return this._moveTo(a,b.folderTo,false,c)},undoOperation:function(a){var b={};this.rollbackOperation();a.forEach(function(a){var c=a.get("folder");if(b[c]===void 0){b[c]=[]}b[c].push(a)});return Promise.all(Object.keys(b).map(function(a){return this._moveTo(b[a],a,true)},this))},_applyChanges:function(a,c,d){var e={clean:true},f={},h={},i=this._rollbackFolders,j,k,l,m;var n=this;function o(a,b,c){if(f[a]===void 0){f[a]={total:0,unread:0}}f[a].total+=b;f[a].unread+=b*c}function p(a,b,c){var f=c.is("flags.unread");c.set("folder",b,e);!d&&(i[c.id]=a);o(b,+1,f);o(a,-1,f)}function q(a,b,c){var e=c.get("folder")==b;var f=c.get("folder")==a;var g;var i;var j;if(e||f){j=e?+1:-1;h[c.id]={total:0,unread:0,flagged:0};if(!d){h[c.id].unread=j*c.get("length_unread");h[c.id].flagged=j*c.get("length_flagged")}else if(n._undoData&&n._undoData[c.id]){g=n._undoData[c.id];h[c.id].unread=j*g.unread;h[c.id].flagged=j*g.flagged}}}for(m=0;m<a.length;m++){l=a[m];j=l.get("folder");if(l instanceof g){k=l.get("messages");if(d){c=l.get("folder");j=i[l.id]}!d&&(i[l.id]=c);q(j,c,l);if(k.length){k.forEach(function(a){if(!d&&a.get("folder")==j||i[a.id]!==void 0){p(j,c,a)}});g.getListByMessageId(k.eq(0).id).filter({folder:d?j:c}).forEach(function(a){q(j,c,a)})}}else{d&&(c=i[l.id]);p(j,c,l);g.getListByMessageId(l.id).forEach(function(a){q(j,c,a)})}}this._applyChangesFolder(f,d);this._applyChangesThread(h,d);this.rollbackOperation=b.bindWithoutArgs(this._applyChanges,[a,c,true])},_applyChangesFolder:function(a,b){Object.keys(a).forEach(function(b){var c=e.get(b),d=a[b];if(c){c.increment("messages_unread",d.unread,{clean:true});c.increment("messages_total",d.total,{clean:true})}})},_applyChangesThread:function(a,b){Object.keys(a).forEach(function(c){var d=g.get(c),e=a[c],f={clean:true},h,i;if(d){if(!b){this._undoData||(this._undoData={});this._undoData[c]={last:d.get("last"),unread:d.get("length_unread"),flagged:d.get("length_flagged")}}if(this.folderTo.isSpam()||this.folderTo.isTrash()){d.increment("length",e.total,f)}d.increment("length_unread",e.unread,f);d.increment("length_flagged",e.flagged,f);i=d.get("messages").filter({folder:d.get("folder")}).eq(0);h=i?i.id:null;if(!h&&b&&this._undoData&&this._undoData[c]&&this._undoData[c].last){h=this._undoData[c].last}d.set("last",h,f)}},this)},_undoData:null,_calculateMoveToParams:function(a,b){var c=a[0],d=c.constructor,e=d.List.pluck(a,"id");var f=d.List.fn.map.call(a,function(a){return{id:a.id,folder:String(a.get("folder"))}});if(b){e=e.map(function(a){return this[a]},this._undoParams.ids);f=f.map(function(a){a.id=this[a.id];return a},this._undoParams.ids)}return{ids:e,msg_ids:f}},_moveTo:function(a,d,e,f){var h=a[0],i=h.constructor,j,k;f=f||this._calculateMoveToParams(a,e);var l=f.msg_ids;var m=f.ids;k={ids:JSON.stringify(m),msg_ids:JSON.stringify(l),folder:d};if(h instanceof g){j=e?this._undoParams.last:m.reduce(function(a,b){a.push(this._undoData[b].last);return a}.bind(this),[]);k.message_id_last=JSON.stringify(b.object(m,j))}return c.call(this._getRequestUrl(i,this.params,e),this._getRequestData(k,this.params,e)).then(function(a){if(!e){this._undoParams={ids:a.get("body").reduce(function(a,b,c){a[m[c]]=b;return a},{}),last:j};if(i===g){Object.keys(this._undoParams.ids).forEach(function(a){var b=g.get(a);var c=this._undoParams.ids[a];g.map({id:c,folder:d,messages:b.get("messages").toArray()})},this)}}return a}.bind(this))},_getRequestUrl:function(a,b,c){return a.url("moveTo")},_getRequestData:function(a,b,c){return a}});d.register("mail.MoveTo",h);h.version="0.2.0";return h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/Archive",["require","exports","Action","mail/Folder","mail/actions/MoveTo","mail/actions/MarkAs"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=c.default.extend({_markAs:null,prepare:function(a){var d=this;var e;if(!a.models){return Promise.reject({models:"required"})}var f=a.models[0];var g=(e=f===null||f===void 0?void 0:f.get)===null||e===void 0?void 0:e.call(f,"folder");if(!f||g===undefined){return Promise.reject({models:"invalid type, it should be array of Thread or Message models"})}return b.default.ensureArchive(g).then(function(b){d.folderTo=b;a.folderTo=b.id;return c.default.fn.prepare.call(d,a)})},operation:function(a,b){var e=this;return c.default.fn.operation.call(this,a,b).then(function(b){var c=a[0].constructor;var f=[].concat(b.body);var g=f.map(function(a){return c.getSafe(a)});e._markAs=d.default.execute({flag:"unread",state:false,models:g},{silent:true})})},undoOperation:function(a){this._markAs.then(function(a){return a.undo()});return c.default.fn.undoOperation.call(this,a)}});a.default.register("mail.Archive",e);e.version="1.0.0";exports.default=e;return e});define("mail/actions/MoveToAll",["mail/actions/MoveTo","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f){"use strict";var g=a.extend({folderFrom:null,prepare:function(a){var b=a.folderTo,c=a.folderFrom;if(b==c){return null}this._rollbackCounters={};this._rollbackFolders={};return this._findFolders([b,c]).then(function(a){var b=f.all.filter({folder:c});if(b.length===0){b=e.all.filter({folder:c})}this.models=b;this.folderTo=a[0];this.folderFrom=a[1];return b}.bind(this))},operation:function(a,c){this._applyChanges(a,c.folderTo);return b.call(e.url("moveToAll"),{folder:c.folderTo,folder_from:c.folderFrom})},undoOperation:function(){throw"Undo is not possible"},_applyChangesFolder:function(b,c){var e=d.get(this.params.folderTo),f=d.get(this.params.folderFrom),g=this._rollbackCounters;b={};if(c){b[e.id]=g[e.id];b[f.id]=g[f.id]}else{g[f.id]={unread:f.get("messages_unread"),total:f.get("messages_total")};g[e.id]={unread:-f.get("messages_unread"),total:-f.get("messages_total")};b[e.id]=g[f.id];b[f.id]=g[e.id]}a.fn._applyChangesFolder.call(this,b)}});c.register("mail.MoveToAll",g);g.version="0.1.1";return g});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/ArchiveAll",["require","exports","Action","mail/actions/MoveToAll","mail/actions/MarkAsAll","mail/Folder"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=b.default.extend({_markAs:null,prepare:function(a){var c=this;var e=a.folderFrom;if(e===undefined){return Promise.reject({folderFrom:"required"})}return d.default.ensureArchive(e).then(function(d){c.folderTo=d;a.folderTo=d.id;return b.default.fn.prepare.call(c,a)})},operation:function(a,d){var e=this;return b.default.fn.operation.call(this,a,d).then(function(){return c.default.execute({flag:"unread",state:false,folderFrom:d.folderTo}).then(function(a){e._markAs=a})})}});a.default.register("mail.ArchiveAll",e);e.version="0.1.0";exports.default=e;return e});define("mail/actions/ConfirmReceipt",["RPC","request","Action"],function(a,b,c){"use strict";var d=c.extend({url:"/cgi-bin/sendrcpt/",operation:function(c,d,e){var f=c.model;if(!f.id){return Promise.reject({id:"required"})}var g=a.setup();var h=g.email;var i=""+g.token;var j=i.split(":");this._requestData={"x-email":h,form_sign:j[0],form_token:j[1],id:f.get("id"),folder:f.get("folder"),ajax_call:0,isUser:true,sendrcpt:1};return b(this.url,this._requestData,{type:"POST",dataType:"text"}).then(function(a){f.set("flags.receipt",false,{clean:true});return a})}});c.register("mail.ConfirmReceipt",d);d.version="0.1.0";return d});define("mail/actions/Delete",["RPC","Action","mail/Thread","utils/util"],function(a,b,c,d){"use strict";var e=b.extend({models:[],prepare:function(a){var b=a.models||[];this.models=b;return b.length?b:null},operation:function(b){var e=b[0].constructor,f;function g(a){return e.List.fn.pluck.call(b,a)}f={ids:JSON.stringify(g("id"))};if(b[0]instanceof c){f.message_id_last=JSON.stringify(d.object(g("id"),g("last")))}return a.call(e.url("delete"),f).then(function(){e.List.fn.destroy.call(b)})}});b.register("mail.Delete",e);e.version="0.1.1";return e});define("mail/actions/DeleteAll",["RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e){"use strict";var f=b.extend({folderFrom:null,prepare:function(a){return c.findOne(a.folderFrom).then(function(a){this.folderFrom=a;return a.isSecureOpen()?a:b.waitFor("folderSecure",[a]).then(function(){return a})}.bind(this))},operation:function(a){return a.cleanup().then(function(){var b={folder:a.id};e.all.filter(b).destroy();d.all.filter(b).destroy()})}});b.register("mail.DeleteAll",f);f.version="0.1.0";return f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/Contact",["require","exports","RPCModel","Storage","utils/util"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=a.default.extend({className:"mail.Contact",storage:new b.default("mail.contacts"),findUrl:function(a){return a&&a.fast?"ab/fast?need_id=true":"ab"},defaults:{id:null,nick:"",name:{first:"",last:""},birthday:{day:0,month:0,year:0},avatars:{default:""},sex:"male",company:"",job_title:"",boss:"",flags:{star:false,import:false,auto:false,corp:false,non_manual:false},emails:[],phones:[],social:[],labels:[],comment:"",address:"",priority:0},getFullName:function(){return c.default.calculateFullName({first:this.get("name.first"),last:this.get("name.last")})},parse:function(a){if(Array.isArray(a)){return a.map(function(a){var b={name:{}};var c=typeof a[0]==="string"?a[0].split(" "):["",""];b[this.idAttr]=a[2];b.name.last=c.pop();b.name.first=c.join(" ");b.emails=a[1];return b},this)}else{return a.contacts}},isDataFully:function(){return this.is("birthday.day")}});d.version="0.2.0";exports.default=d;return d});define("mail/Spam/old-api-adapter",["RPC","request","mail/Folder","utils/util","mail/Message"],function(a,b,c,d,e){"use strict";b.on("start",function(b,c){var e=c.options;if(e.url.indexOf("/threads/services/unspam")!==-1){e.url=a.url("threads/move");d.extend(e.data,{nospam:1})}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/Spam",["require","exports","Action","mail/Folder","mail/Message","mail/Thread","mail/actions/MoveTo","mail/Contact","mail/Spam/old-api-adapter"],function(require,exports,a,b,c,d,e,f){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g=e.default.extend({folderTo:null,prepare:function(d){var g=this,h=d.models.length?d.models[0].constructor:c.default,i=d.spam?b.default.SPAM:b.default.INBOX,j;d.folderTo=i;!(d.models instanceof h.List)&&(d.models=new h.List(d.models));g.folderFrom=d.models.length>0?d.models[0].getFolder():undefined;g.Model=h;if(d.spam){j=f.default.find().then(function(b){var e=d.models,f=e.length,g=new c.default.List,h,i,j,k;while(f--){j=e[f].get("correspondents.from");for(k=0;k<j.length;k++){i=j[k].email;h=b.length;while(i&&h--){if(-1!==b[h].get("emails").indexOf(i)){g.set([e[f]]);break}}}}if(g.length){return a.default.waitFor("spamAllowContacts",[g])["catch"](function(){return Promise.resolve(true)}).then(function(a){if(!a){g.forEach(function(a){e.remove(a)})}})}})}else{j=Promise.resolve()}return j.then(function(){return d.models.length?g._findFolders([i]):Promise.resolve([])}).then(function(a){g.folderTo=a[0];return e.default.fn.prepare.call(g,d)})},getActionType:function(a,b){return!b&&a.spam||b&&!a.spam?"spam":"unspam"},_getRequestUrl:function(a,b,c){return a.url(this.getActionType(b,c))},_getRequestData:function(a,b,c){a.unsubscribe=+!!b.unsubscribe;if(b.verified){a.verified=true}var e=this.getActionType(b,c);var f=e==="unspam";var g=this.Model===d.default&&f;if(this.folderFrom!==undefined&&!g){if(!c){a.folder=f?this.folderTo.id:this.folderFrom.id}if(c){a.folder=f?this.folderFrom.id:this.folderTo.id}}return a}});a.default.register("mail.Spam",g);g.version="1.0.0";exports.default=g;return g});define("feast-tpl!app/feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="content">\n\t\t<div bem:elem="content">\n\t\t\t<b:list-nested-moveto-folder\n\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\tfolder="{attrs.folder || attrs.letter.get(\'folder\')}"\n\t\t\t\t\tfolders="{attrs.folders || app.model.folders}"\n\t\t\t\t\tlettersFoldersIds="{attrs.lettersFoldersIds}"\n\t\t\t\t\tallow-new-folder\n\t\t\t\t\tallow-move="{false}"\n\t\t\t\t\tuse:mediator="pony-mode folders-actions letters-selections"\n\t\t\t\t\tqa:id="list-moveto-folder"\n\t\t\t\t\tremit:move="folders:click"\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t<b:layer\n\t\t\tname="move-to-folder"\n\t\t\tremit:close="layer:close"\n\t\t\tclose\n\t\t\theader\n\t\t\tcenter\n\t\t\thiddenfooter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\t\t<fn:match name="header">\n\t\t\t<div bem:elem="title">{i18n(\'Переместить в папку\')}</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="content">\n\t\t\t<div bem:elem="row">\n\t\t\t\t<fn:apply-match name="content"/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html")});define("feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/layer-mobile/layer-mobile.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="standard" test="attrs.standard"/>\n\t<bem:mod name="center" test="attrs.center"/>\n\t<bem:mod name="media" test="attrs.media"/>\n\t<bem:mod name="{attrs.name}" test="attrs.name"/>\n\n\t<fn:match name="header">\n\t\t<span\n\t\t\tbem:elem="back"\n\t\t\tremit:click="layer:close">\n\t\t\t<b:button2 text="{i18n(\'Назад\')}"\n\t\t\t\tico="back"\n\t\t\t\tpure\n\t\t\t\ttouch\n\t\t\t\tshort\n\t\t\t\ttext-center\n\t\t\t/>\n\t\t</span>\n\t\t<span bem:elem="title">Title</span>\n\t</fn:match>\n\n\t<fn:match name="content">\n\t\t<b:nav-folders\n\t\t\t\tmodels="{app.model.folders}"\n\t\t\t\ttouch-nav\n\t\t\t\tcounters-off/>\n\t</fn:match>\n\n\t\x3c!-- Здесь нужно вставить кнопку Назад --\x3e\n\t<div bem:elem="header">\n\t\t<fn:apply-match name="header"/>\n\t</div>\n\n\t<div class="layer-mobile__content">\n\t\t<fn:apply-match name="content"/>\n\t</div>\n\n\t<div class="layer-mobile__footer">\n\t\t<fn:apply-match name="footer"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/layer-mobile/layer-mobile.html")});define("feast-tpl!ui-block/layer-mobile/layer-mobile.html",["feast-tpl!app/feast-tpl!ui-block/layer-mobile/layer-mobile.html"],function(a){return a});define("ui-block/layer-mobile/layer-mobile",["exports","feast","feast-tpl!./layer-mobile.html","ui-block/button2/button2","ui-block/nav-folders/nav-folders","ui-block/scrollable/scrollable"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend({name:"layer-mobile",template:g.default,blocks:{button2:h.default,"nav-folders":i.default,scrollable:j.default}})});define("ui-block/layer-move-to-folder/layer-move-to-folder",["exports","feast","feast-tpl!./layer-move-to-folder.html","ui-block/button2/button2","ui-block/layer/layer","ui-block/layer-mobile/layer-mobile","ui-block/list-nested-moveto-folder/list-nested-moveto-folder"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};exports.default=g.default.Block.extend({name:"layer-move-to-folder",template:h.default,blocks:{"layer-mobile":k.default,layer:j.default,button2:i.default,"list-nested-moveto-folder":l.default},events:{"folders:click":"onFoldersClick"},onFoldersClick:function a(b){var c=this.get("letter");if(c){this.broadcast("move",n({},b.details,{model:c}))}else{this.broadcast("move",n({},b.details,{selection:true,model:undefined}))}this.broadcast("layer:close")}})});define("mediator/letters-selection",["exports","data-source/utils/paginator","default-values","feast","mail/Folder","mail/Thread","models/dataset-model/dataset-model","models/metathread/metathread","models/skeleton-letter/skeleton-letter","pilotjs","route/utils/filter-query","service/secure-folder","ui-block/contextmenu/contextmenu","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-selection/contextmenu-selection","ui-block/dataset-letters/dataset-letters","ui-block/dropdown-actions/dropdown-actions","ui-block/layer-move-to-folder/layer-move-to-folder","ui-block/layout/layout","ui-block/letter-meta/letter-meta","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/panel-with-selected/panel-with-selected","ui-block/portal-menu/portal-menu","ui-block/portal-menu-element/portal-menu-element","ui-block/search-panel/search-panel","ui-block/webview-mobile-header/webview-mobile-header","../lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var A=X(c);var B=X(d);var C=X(e);var D=X(f);var E=X(g);var F=X(h);var G=X(i);var H=X(j);var I=X(k);var J=X(l);var K=X(m);var L=X(n);var M=X(o);var N=X(p);var O=X(q);var P=X(r);var Q=X(s);var R=X(t);var S=X(u);var T=X(v);var U=X(w);var V=X(x);var W=X(y);function X(a){return a&&a.__esModule?a:{default:a}}function Y(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var Z=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var _=function a(b){while(b.originalEvent){b=b.originalEvent}return b};exports.default=A.default.Mediator.create("letters-selection",{performanceTrace:"track",defaults:function a(){this.map={};this.scope={};this.folderSelected={};this.specialFolderSelected={}},components:{router:{class:G.default,events:["route"]},layout:{class:P.default,attrs:{selectMode:function a(b){return b.hasSelected()}}},"portal-menu":{class:T.default,events:["select:all","select:drop","select:toggle"],attrs:{selected:function a(b){return b.getModels()},selectMode:function a(b){return b.hasSelected()},selectFolder:function a(b){return b.isFolderSelected()},deselectAll:function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()}}},"search-panel":{class:V.default,attrs:{hide:function a(b){return b.hasSelected()}}},listNestedMoveToFolder:{class:R.default,attrs:{lettersFoldersIds:function a(b){return b.getLettersFoldersIds()},selectedMetathreads:function a(b){return b.hasSelectedMetathread()}}},portalMenuElement:{class:U.default,attrs:{lettersFoldersIds:function a(b){return b.getLettersFoldersIds()}}},"layer-move-to-folder":{class:O.default,attrs:{lettersFoldersIds:function a(b){return b.getLettersFoldersIds()}}},dropdownActions:{class:N.default,attrs:{route:function a(b){return b.get("router.route")},lettersFoldersIds:function a(b){return b.getLettersFoldersIds()}}},"dataset-letters":{class:M.default,events:["selected:toggle"],attrs:{selected:function a(b){return b.getHashMap()},selectedLength:function a(b){return b.getModels().length},selectedModelsData:function a(b){return b.getModels()},"select-folder":function a(b){return b.isFolderSelected()},metathreadsWithSelected:function a(b){return b.getMetathreadsWithSelected()}}},panelWithSelected:{class:S.default,attrs:{selected:function a(b){return b.getModels()}}},contextmenu:{class:J.default,events:["select:all","select:drop"],attrs:{"selected-map":function a(b){return b.getHashMap()},"selected-length":function a(b){return b.getModels().length}}},"contextmenu-message":{class:K.default,events:["select:all","select:drop"],attrs:{isSearchDisabled:function a(b){return b.getModels().length>1},deselectAll:function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()},"disable-create-event":function a(){return b.DISABLE_CREATE_EVENT}}},"contextmenu-selection":{class:L.default,events:["select:all","select:drop"],attrs:{"selected-folder":function a(b){return b.isFolderSelected()&&b.getCurrentFolder()},selected:function a(b){return b.getModels()},"if-folder-selected":function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()},"letters-folders-ids":function a(b){return b.getLettersFoldersIds()},"selected-metathreads":function a(b){return b.hasSelectedMetathread()}}},"layer-create-folder":{lazy:z.lazyUILayerCreateFolder,attrs:{selectMode:function a(b){return b.hasSelected()}}},"letter-meta":{class:Q.default},"webview-mobile-header":{class:W.default,events:["select:all","select:drop"],attrs:{selected:function a(b){return b.getModels()},selectMode:function a(b){return b.hasSelected()},selectFolder:function a(b){return b.isFolderSelected()},deselectAll:function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()}}}},reset:function a(){var c=this.hasSelected();this.switchScope(this.scopeId);if(c||b.NEW_LETTER_LIST){this.updateAll()}},resetLetterMeta:function a(){this.getList("letter-meta").forEach(function(a){a.destroy()})},cleanSelection:function a(b){var c=this.hasSelected();this.cleanScope(this.scopeId);this.switchScope(this.scopeId);(c||b)&&this.updateAll()},switchScope:function a(b){this.map=this.scope[b]||(this.scope[b]={});this.scopeId=b},updateScope:function a(){this.scope[this.scopeId]=this.map},cleanScope:function a(b){b=b==void 0?this.scopeId:b;this.scopeId==b&&(this.map={});this.scope[b]={};delete this.folderSelected[b];delete this.specialFolderSelected[b]},getAllModelsWithPaginator:function a(b){var c=[];var d=this.get("router.route");if(d.is("#search #search-letter")){return this.getAllUIModels()}if(b===undefined){c=C.default.all.slice()}else{c=C.default.all.filter(function(a){return a.get("folder")==b})}c.set(this.getAllUIModels().filter(function(a){if(b===undefined){return E.default.isMetathread(a)}return a.get("folder")==b&&E.default.isMetathread(a)}));c=c.sort("date",{reverse:true}).toArray();return c},getAllModels:function b(c){var d=this.get("router");if((0,a.isPaginatorGlobalEnabled)(d)){return this.getAllModelsWithPaginator(c)}var e=this.get("router.route.id");var f=[];var g="uiLetters";if(e=="#search"||e=="#search-letter"){g="search.letters"}if(typeof c!=="undefined"&&g!=="search"){f=C.default.all.filter(function(a){return String(a.get("folder"))===String(c)}).sort("date",{reverse:true}).toArray()}else{var h=this.get("router.model."+g)||[];var i=this.get("router.model.search.suggestLetters")||[];f=h.concat(i)}return f},getAllUIModels:function a(){var b=this.get("router.route.id");var c=b==="#search"||b==="#search-letter"?"search.letters":"uiLetters";var d=this.get("router.model."+c)||[];var e=this.get("router.model.search.suggestLetters")||[];return d.concat(e)},getHashMap:function a(){return this.map},getModels:function a(){var b=this.getAllModels();var c=[];function d(a){var b=true;if(a.get("advModel")||D.default.isDatasetModel(a)){return false}if(E.default.isMetathread(a)){b=this.map[a.id]}else if(this.isFolderSelected()){b=true}else{b=this.map[a.id]}return b}c=b.filter(d.bind(this));return c},getLettersFoldersIds:function a(){var b=this.getModels();var c=b.reduce(function(a,b){var c=void 0;if(E.default.isMetathread(b)){c=b.get("metathread_data.folder")}else{c=b.get("folder")}return Z({},a,Y({},c,true))},{});return Object.keys(c)},isFolderSelected:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.scopeId;return!!this.folderSelected[b]},getMetathreadsWithSelected:function a(){var b=this;var c={};var d=this.getAllModels();d.forEach(function(a){if(!a.get("flags.metathread")){return}if(b.map[a.id]){c[a.id]=true;return}var d=a.get("metathread_data.folder");var e=b.getAllModels(d);var f=e.filter(function(a){return b.map[a.id]});if(f.length>0){c[a.id]=true}});return c},hasSelectedMetathread:function a(){return Object.keys(this.map).some(function(a){return!!E.default.all.get(a)})},isSpecialFolderSelected:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.scopeId;return!!this.specialFolderSelected[b]},getCurrentFolder:function a(){return B.default.get(this.scopeId)},hasSelected:function a(){var b=this.get("router.route");var c=this.get("layout");if(c&&c.get("type")==="2pane"&&b.is("#read-letter #search-letter")){return false}return this.getModels().length>0},deselect:function a(b){var c=this;if(b){if(b.id!=null){b=[b]}var d=Object.keys(this.scope);b.forEach(function(a){d.forEach(function(b){delete c.scope[b][a.id]})});this.updateAll()}},emitChange:function a(){this.emit("change",this)},select:function a(b){this.map[b.id]=true;this.updateAll()},handleEvent:function a(b){var c=this;var d=b.type;var e=this.get("router");switch(d){case"route":var f=e.model.folder?e.model.folder.id:e.activeRoute.id;if(e.request.is("#search")||e.request.is("#search-letter")){f="search"}this.switchScope(f);if(e.request.is("#letters")){this.reset();this.resetLetterMeta()}return false;case"selected:toggle":var g=b.details;var h=g.get("folder");var i=this.getAllModels();var j=this.getAllUIModels();var k=!!this.map[g.id];var l=_(b);var m=j.indexOf(g);var n=g.get("flags.metathread");var o=!!this.map["multithreadFixId"+h];var p=j.indexOf(this.prevSelected);if(!l.shiftKey||p===-1){p=m}var q=[Math.min(p,m),Math.max(p,m)];var r=q[0]<q[1];var s=Z({},this.map);for(var t=q[0],u=q[1];t<=u;t++){var v=j[t];var w=v.get("flags.metathread");var x=F.default.isSkeleton(v);if(r&&w){continue}if(r&&x){s=Z({},this.map);k?delete s[g.id]:s[g.id]=true;break}k?delete s[v.id]:s[v.id]=true}this.map=s;this.updateScope();this.prevSelected=g;if(n){var y=g.get("metathread_data.folder");var z=this.getAllModels(y);z.forEach(function(a){return delete c.map[a.id]});var A=B.default.get(y);if(A&&!A.isSecureOpen()){this.map[g.id]=false;(0,I.default)(A).then(function(a){if(a){c.map[g.id]=true}})}}else if(!this.isFolderSelected()){if(o){delete this.map["multithreadFixId"+h];var C=this.getAllModels(h);C.forEach(function(a){var b=a.id===g.id;if(b){delete c.map[a.id]}else{c.map[a.id]=true}})}}else if(this.isFolderSelected()){delete this.folderSelected[this.scopeId];if(h===this.scopeId){delete this.map[g.id];i.forEach(function(a){if(a.id!==g.id&&!a.get("flags.metathread")&&a.get("folder")===c.scopeId){c.map[a.id]=true}})}else{i.forEach(function(a){if(!a.get("flags.metathread")&&a.get("folder")===c.scopeId){c.map[a.id]=true}});if(o){delete this.map["multithreadFixId"+h];var D=this.getAllModels(h);D.forEach(function(a){var b=a.id===g.id;if(b){delete c.map[a.id]}else{c.map[a.id]=true}})}}}if(this.isSpecialFolderSelected()){delete this.folderSelected[this.scopeId]}this.emitChange();break;case"select:toggle":b.type=this.isFolderSelected()?"select:drop":"select:all";this.handleEvent(b);break;case"select:all":if(H.default.has()||e.route.is("#search #search-letter")){this.getAllModels().forEach(function(a){c.map[a.id]=true});this.specialFolderSelected[this.scopeId]=true}else{this.folderSelected[this.scopeId]=true}this.emitChange();break;case"select:drop":this.cleanScope();this.emitChange();break}}})});define("mediator/settings-filters-manager",["exports","../lazy.modules","feast","filters/Filter","mediator/letters-selection","pilotjs","service/layer","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-selection/contextmenu-selection","ui-block/dropdown-actions/dropdown-actions","ui-block/octopus/octopus"],function(exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var k=t(b);var l=t(c);var m=t(d);var n=t(e);var o=t(f);var p=t(g);var q=t(h);var r=t(i);var s=t(j);function t(a){return a&&a.__esModule?a:{default:a}}exports.default=k.default.Mediator.create("settings-filters-manager",{defaults:function a(){},components:{router:{class:n.default},letter:{lazy:a.lazyUILetter,events:["settingsfilters:create"]},"dropdown-actions":{class:r.default,events:["settingsfilters:create"]},"contextmenu-message":{class:p.default,events:["settingsfilters:create"]},"contextmenu-selection":{class:q.default,events:["settingsfilters:create"]},octopus:{class:s.default,events:["settingsfilters:create"]}},handleEvent:function a(b){var c=b.type;var d=void 0;var e=void 0;var f=void 0;if(b.details){d=b.details.folder;e=b.details.model;f=b.details.models}if(!f){if(m.default.hasSelected()){f=m.default.getModels()}else{f=[e||this.get("router.model.letter")]}}switch(c){case"settingsfilters:create":this.openCreateFilter({models:f,move:d});break}},_getFilterTemplateValues:function a(b){var c={subject:[],from:[],to:[],size:[10],cc:[]};b.forEach(function(a){var b=a.get("subject");if(!c.subject.includes(b)){c.subject.push(b)}var d=a.get("correspondents.from.0.email");if(!c.from.includes(d)){c.from.push(d)}var e=a.get("correspondents.to")||[];e.forEach(function(a){if(!c.to.includes(a.email)){c.to.push(a.email)}});var f=a.get("correspondents.cc")||[];f.forEach(function(a){if(!c.cc.includes(a.email)){c.cc.push(a.email)}})});return c},openCreateFilter:function a(b){var c=b.models,d=b.move;var e=this._getFilterTemplateValues(c);var f=new l.default({applyFolders:[0],conditions:[{name:"from",not:false,value:e.from.join(", ")}]});e.from=[];if(d!==void 0){f.set("actions.move",d)}o.default.open("edit-settings-filter",{filterModel:f.toJSON(),templateValues:e},{dimmer:true,"close-on-dimmer":false,"close-on-esc":false}).then(function(){})}})});define("mediator/swipe-manager",["exports","feast","ui-block/swipeable/swipeable"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Mediator.create("swipe-manager",{components:{swipeable:{class:d.default,events:["underlay-changed"]}},defaults:function a(){this.isDatasetOpaque=true},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"underlaychanged":this.isDatasetOpaque=!d.value;this.updateAll();break}},close:function a(b){this.getList("swipeable").forEach(function(a){if(a===b){return}a.reset()})},reset:function a(){this.close()}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/thread-scroller",["require","exports","@mail/xray","data-source/actions","data-source/data-source","default-values","feast","mail/Thread","pilotjs","service/radars/index","ui-block/layout/layout","ui-block/letter/letter","ui-block/scrollable/scrollable","ui-block/thread/thread"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ThreadScroller=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var m=function(e){__extends(m,e);function m(){var a=e!==null&&e.apply(this,arguments)||this;a._letterPosition={};a._ignoreAutoRead={};a.currentReadingMessageId=null;a.currentReadingMessageIndex=null;return a}m.prototype.defaults=function(){var a=this;f.default.all.on("change",function(b){var c=a.get("thread");var d=a.get("scrollable");if(c&&d){a.checkHandleMessageRemoved(b)}})};m.prototype.getComponentsSpec=function(){return{router:{class:g.default,events:[]},dataSource:{class:c.default,events:["actionend"]},thread:{class:l.default,events:["letter:resize","letter:expand:attaches","letter:collapse","force:recalc"]},letter:{class:j.default,events:[]},scrollable:{class:k.default,events:["scroll:onbottom","scroll:change"]},layout:{class:i.default}}};m.prototype.handleEvent=function(a){var c=a.type;var d=a.details;var e=this.get("thread");var f=this.get("scrollable");if(e&&f){switch(c){case"scroll:change":case"force:recalc":this.onScroll();break;case"scroll:onbottom":this.emit("thread:nextpage");break;case"letter:resize":this.onLetterExpanded(d);break;case"letter:expand:attaches":this.onLetterExpanded(d);break;case"letter:collapse":this.handleMessageCollapsed(d);return false;case"actionend":if(d&&d.action.type===b.NAVIGATE){this.onNewThread(true)}break}}};m.prototype.getModel=function(){return this.get("thread").get("model")};m.prototype.onNewThread=function(a){if(a){this.get("scrollable").reset();this._ignoreAutoRead={};this._letterPosition={}}this.onScroll()};m.prototype.getEdges=function(){var a=this.get("scrollable");var b=a.el.getBoundingClientRect();var c=b.top;var d=b.bottom;var e=d-c;var f=d-e/3;var g=a.getScrollDir()||"down";return{top:c,bottom:d,height:e,readline:f,direction:g}};m.prototype.getLetterBlockInstances=function(a){if(a==null||this.getList("letter")==null){return[]}return this.getList("letter")};m.prototype.onScroll=function(){var a=this.get("thread");var b=a&&a.get("model");if(!a||!b){return}var c=this.getLetterBlockInstances(a);var d=this.getEdges();var e=this._letterPosition;var f=this.getIgnoredLetters();var g=null;var i=false;for(var j=0;j<c.length;j++){var k=c[j].get("model");var l=k.get("id");var m=a.get("model").get("messages").last().id===l;var n=a.get("model").get("messages").first().id===l;var o=this.getLetterPosition(c[j],d,m,n);if(o.sticky){g=l}if(o.topMost){i=true;this.currentReadingMessageId=l;this.currentReadingMessageIndex=a.get("model").get("messages").indexOf(k)}if(o.readline&&k.is("flags.unread")&&!f[l]){f[l]=true;h.default(["letter","open","unread"]);this.emit("mark:readed",k)}e[l]=o}if(!i){this.currentReadingMessageId=null}a.isStickyEnabled()&&this.setSticky(g)};m.prototype.setSticky=function(a){var b=this.get("thread");var c=b.get("sticky");var d=this._letterPosition[a];if(!a||!d.sticky){c&&b.set("sticky",null);return}var e={head:d.stickyHead,footer:d.stickyFooter,headFade:d.stickyHeadFade,footerFade:d.stickyFooterFade,bottom:d.bottom,top:d.top,id:a};var f=!c||c.id!==a||c.head!==e.head||c.footer!==e.footer;f&&b.set("sticky",e)};m.prototype.onLetterExpanded=function(a){var b=a.get("id");var c=this.getEdges();var d=this.getLetterView(b);if(d==null){return}c.direction="down";this._letterPosition[b]=this.getLetterPosition(d,c);this.setSticky(b)};m.prototype.getLetterPosition=function(a,b,c,e){if(c===void 0){c=false}if(e===void 0){e=false}c=!d.IS_READLETTER_NATIVE_STICKY_DISABLED&&c;e=!d.IS_READLETTER_NATIVE_STICKY_DISABLED&&e;var f={};if(!a.el){return{}}var g=a.el.getBoundingClientRect(),h=g.top,i=g.bottom,j=g.height;if(i<b.top||h>b.bottom){f.visible=false}else{f.visible=true;if(h<b.readline){f.readline=true}if(h<=b.top){f.topMost=true}if(b.direction=="down"){if(h<b.readline&&j>b.height){f.sticky=true;f.stickyFooter=true;f.stickyFooterFade=true;f.bottom=0}if((h<b.top||c)&&j>b.height){f.sticky=true;f.stickyHead=true;f.top=b.top}if(i<b.bottom&&!c){f.stickyHead=false;f.stickyFooter=false;f.sticky=false}}else{if((i>b.readline||c)&&j>b.height){f.sticky=true;f.stickyHead=true;f.stickyHeadFade=true;f.top=b.top}if(h<b.readline&&(i>b.bottom||c)&&j>b.height){f.sticky=true;f.stickyFooter=true;f.bottom=0}if(h>b.top&&!e&&f.stickyFooter){f.stickyHead=false;delete f.top}if(h>b.top&&!f.stickyFooter){f.stickyHead=false;f.stickyFooter=false;f.sticky=false}}}return f};m.prototype.getLetterView=function(a){var b=this.get("thread");var c=this.getLetterBlockInstances(b);return c.find(function(b){return b.get("model").get("id")==a})};m.prototype.resetScroll=function(){this.get("scrollable").reset()};m.prototype.getIgnoredLetters=function(){var a=this.get("thread");var b=a.get("model");var c=this._ignoreAutoRead[b.get("id")]||{};var d=b.get("messages");d.forEach(function(a){var d=a.get("folder")==b.get("folder");if(c[a.get("id")]||a.get("flags.unread")&&d){return}c[a.id]=true});return c};m.prototype.checkHandleMessageRemoved=function(b){var c,d;if(!((c=b===null||b===void 0?void 0:b.changes)===null||c===void 0?void 0:c.includes)){a.default.send("threads-no-evt-changes",{rlog:"octavius-threads-no-evt-changes",rlog_message:{type:b===null||b===void 0?void 0:b.type,changes:b===null||b===void 0?void 0:b.changes,changed:b===null||b===void 0?void 0:b.changed,allChanged:b===null||b===void 0?void 0:b.allChanged,target_id:(d=b===null||b===void 0?void 0:b.target)===null||d===void 0?void 0:d.id}});return}if(!this.currentReadingMessageId||this.currentReadingMessageIndex==null||!b.changes.includes("messages")){return}var e=this.get("thread");var f=e&&e.get("model");if(!e||!f){return}var g=f.get("messages");var i=g[this.currentReadingMessageIndex];if(this.currentReadingMessageId===i.get("id")){return}if(!(g===null||g===void 0?void 0:g.includes)){a.default.send("threads-no-includes",{rlog:"octavius-threads-no-includes",rlog_message:{varType:typeof g,includes:typeof(g===null||g===void 0?void 0:g.includes),length:g===null||g===void 0?void 0:g.length}})}if(g.indexOf(this.currentReadingMessageId)!==-1){return}h.default("thread_scroll-to-next");this.currentReadingMessageId=null;e.scheduleScrollLetterIntoView(i.get("id"))};m.prototype.handleMessageCollapsed=function(a){if(this.currentReadingMessageId===a.get("id")){var b=this.get("thread");b.scheduleScrollLetterIntoView(this.currentReadingMessageId);this.currentReadingMessageId=null}};return m}(e.default.Mediator);exports.ThreadScroller=m;exports.default=e.default.Mediator.createFromClass("thread-scroller",m)});define("mediator/thread-manager",["exports","data-source/actions","data-source/index","feast","mail/Folder","mediator/thread-scroller","pilotjs","service/radars/index","ui-block/button2/button2","ui-block/thread/thread"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=r(b);var k=r(c);var l=r(d);var m=r(e);var n=r(f);var o=r(g);var p=r(h);var q=r(i);function r(a){return a&&a.__esModule?a:{default:a}}var s={};exports.default=k.default.Mediator.create("thread-manager",{defaults:function a(){var b=this;this._loading={};m.default.on("thread:nextpage",function(){return b.handleEvent({type:"thread:nextpage"})})},components:{router:{class:n.default,events:["routeend"]},thread:{class:q.default},button:{class:p.default,events:["letter:prev","letter:next","letter:back"]}},handleEvent:function a(b){var c=b.type;if(this.get("thread")){switch(c){case"letter:prev":this.goToLetter("prev");break;case"letter:next":this.goToLetter("next");break;case"letter:back":this.onBackClick();break;case"thread:nextpage":this.nextPage();break}}},getModel:function a(){var b=this.get("router");return b.model.letter},nextPage:function b(){var c=this.getModel();var d=c.id;var e=function a(){delete s[d]};var f=c.get("messages.length");var g=c.get("length");if(f<g&&!s[d]){s[d]=true;(0,o.default)({type:"thread-load-more",intervals:[["idx",f+1]]});j.default.dispatch({type:a.THREAD_LOAD_MORE,priority:n.default.Loader.PRIORITY_LOW}).then(e,e)}},goToLetter:function a(b){var c=this.getModel();var d=this.get("router");var e=d.route.is("#search-letter");var f=d.model&&d.model.letterNeighbours;var g=f&&f[b];if(g){var h=c.get("folder");if(d&&d.model&&d.model.folder){h=d.model.folder.id}var i=g.threadId,j=g.id;return d.go(e?"#search-letter":"#read-letter",{folder:h,letter:i,id:j},"inherit")}return Promise.reject("noNeighbours")},onBackClick:function a(){var b=this.getModel();var c=this.get("router");var d=c.route.is("#search-letter");var e=b.get("folder");if(c&&c.model&&c.model.folder){e=c.model.folder.id}if(b.isInMetathread()){e=l.default.INBOX}var f=c[d?"#search":"#letters"].getUrl({folder:e,preserveFilters:!d},"inherit");c.nav(f,{initiator:"popstate"})}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/share-folders",["require","exports","data-source/index","service/layer","service/mailbox/loader"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d={onLayerClose:function(){c.default.invalidateCache();a.default.updateAll()},renderLayer:function(a){var c=a.layerName,d=a.params;d.onLayerClose=this.onLayerClose;b.default.open(c,d,{"close-on-esc":false})},renderAccess:function(a){this.renderLayer({layerName:"share-folder-action",params:a})},renderShare:function(a){this.renderLayer({layerName:"share-folder",params:a})},renderShareOpportunities:function(a){this.renderLayer({layerName:"share-opportunities",params:a})},renderDenySharedFolder:function(a){this.renderLayer({layerName:"deny-shared-folder",params:a})},MODS:{NOT_ENOUGHT_RIGHTS:"not_enough_rights"}};exports.default=d});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letters-actions",["require","exports","cfgUser","data-source/actions","data-source/index","data-source/utils/actual-letters","default-values","feast","feast-mod/correspondents","feast-mod/folder-name","helpers/metathreads","helpers/opener","logger","mail/actions/Archive","mail/actions/ArchiveAll","mail/actions/ConfirmReceipt","mail/actions/Delete","mail/actions/DeleteAll","mail/actions/MarkAs","mail/actions/MarkAsAll","mail/actions/MoveTo","mail/actions/MoveToAll","mail/actions/Spam","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","mediator/letters-selection","mediator/settings-filters-manager","mediator/swipe-manager","mediator/thread-manager","mediator/thread-scroller","models/metathread/metathread","pilotjs","route/utils/filter-query","service/adv/index","service/compose","service/layer","service/notify","service/radars/index","service/secure-folder","service/share-folders","trackJS","ui-block/contextmenu-correspondent/contextmenu-correspondent","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-metathread/contextmenu-metathread","ui-block/contextmenu-selection/contextmenu-selection","ui-block/dataset-letters/dataset-letters","ui-block/discounts-item/discounts-item","ui-block/dropdown-actions/dropdown-actions","ui-block/letter-list-item/letter-list-item","ui-block/letter-meta/letter-meta","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-common-touch/list-letter-common-touch","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-compact-touch/list-letter-compact-touch","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/metathread-head-common/metathread-head-common","ui-block/metathread-head-compact/metathread-head-compact","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded","ui-block/nav-folders/nav-folders","ui-block/octopus/octopus","ui-block/portal-menu/portal-menu","ui-block/settings-dock/settings-dock","ui-block/thread/thread","ui-block/webview-mobile-header/webview-mobile-header","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);f=__importDefault(f);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);da=__importDefault(da);ea=__importDefault(ea);fa=__importDefault(fa);ga=__importDefault(ga);ha=__importDefault(ha);ia=__importDefault(ia);ja=__importDefault(ja);ka=__importDefault(ka);var ma=50;var na=10;var oa="msglist";var pa=0;var qa=["move","drop","remove","archive","spam","unspam","superspam","mark:readed","mark:allreaded","mark:unreaded","mark:flagged","mark:unflagged","mark:unpinned","togglestatus:unread","togglestatus:flagged","metathreadtogglestatus:unread","search:from","print","download","headers","newtab","forward","redirect","correspondent:search","click:letter","letter:prev","letter:next","confirmreceipt"];var ra=["mark:readed","mark:unreaded","togglestatus:unread","mark:flagged","mark:unflagged","togglestatus:flagged","spam","unspam","move","remove","archive"];var sa={STAY:"stay",GO_TO_NEXT:"next",GO_TO_FOLDER:"folder",GO_TO_SEARCH:"search"};var ta={archive:function(){return i18n("Перемещено в архив")},"markas.flagged.true":function(){return i18n("Помечено флажком")},"markas.flagged.false":function(){return i18n("Снят флажок")},"markas.unread.true":function(){return i18n("Помечено непрочитанным")},"markas.unread.false":function(){return i18n("Помечено прочитанным")},"spam.true":function(a){if(typeof a==="number"&&a>0){var b={count:a};return i18n.plural(a,[i18n("{count} писем перемещены в спам",b),i18n("{count} письмо перемещено в спам",b),i18n("{count} письма перемещены в спам",b)])}return i18n("Перемещено в спам")},"spam.false":function(){return i18n("Перемещено из папки «Спам»")},delete:function(){return i18n("Письмо удалено")},confirmreceipt:function(){return i18n("Прочтение подтверждено")},moveto:function(a){var b=a;var c=i18n("Перемещено в папку");var d=6;var e=y.default.isLessThen("xs")?K.default.MAX_LENGTH_SMALL:K.default.MAX_LENGTH;var f=e-c.length-d;if(b.length>f){b=b.slice(0,Math.max(0,f-1))+"…"}return c+" «"+b+"»"},"moveto.metathread.action":function(){return i18n("Невозможно переместить системную папку. Перенести остальные письма в спам?")},"moveto.metathread":function(){return i18n("Невозможно переместить системную папку")}};exports.default=f.default.Mediator.create("letters-actions",{_isNavigateProcessing:false,defaults:function(){var a=this;D.default.on("mark:readed",function(b){return a.doAction({type:"mark:readed",target:"thread-scroller"},[b])})},actions:{spam:u.default,mark:q.default,move:s.default,remove:o.default,archive:l.default,markAll:r.default,moveAll:t.default,removeAll:p.default,archiveAll:m.default,confirmreceipt:n.default},components:{router:{class:F.default},"nav-folders":{class:fa.default,events:["move","drop"],handleEvent:"handleMoveTo"},"dataset-letters":{class:T.default,events:qa,attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},octopus:{class:ga.default,events:["mark:allreaded"],attrs:{"read-all-in-progress":function(a){return a.readAllInProgress}}},"portal-menu":{class:ha.default,events:qa,attrs:{readAllInProgress:function(a){return a.readAllInProgress}}},"webview-mobile-header":{class:ka.default,events:qa},letter:{lazy:la.lazyUILetter,events:qa},dropdownActions:{class:V.default,events:qa},"letter-list-item":{class:W.default,events:qa},"list-letter-common":{class:Y.default,events:qa,attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-common-touch":{class:Z.default,events:qa},"list-letter-compact":{class:_.default,events:qa,attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-compact-touch":{class:aa.default,events:qa},"layer-move-to-folder":{events:["move"]},"layer-confirm-move-to-spam":{events:["spam:force","remove"]},thread:{class:ja.default,events:qa,attrs:{direction:function(a){return a.direction}}},"contextmenu-message":{class:Q.default,events:qa},"contextmenu-selection":{class:S.default,events:qa},"contextmenu-metathread":{class:R.default,events:qa},"contextmenu-correspondent":{class:P.default,events:qa},"layer-create-folder":{lazy:la.lazyUILayerCreateFolder,events:qa},"list-nested-moveto-folder":{class:ba.default,events:qa},"metathread-head-common":{class:ca.default,events:["metathreadtogglestatus:unread"]},"metathread-head-compact":{class:da.default,events:["metathreadtogglestatus:unread"]},"metathread-head-compact-expanded":{class:ea.default,events:["metathreadtogglestatus:unread"]},"letter-meta":{class:X.default,events:["spam","remove","move"]},"discounts-item":{class:U.default,events:qa},"settings-dock":{class:ia.default}},handleMoveTo:function(a){var b=a.details;var c={type:"move",folderTo:b.id};var d=z.default.getModels();if(!d.length){return false}var e=d[0].getFolder();if(e.isShareTake()||b.isShareTake()){var f=e.isShareTake()!==b.isShareTake()||e.get("owner").email!==b.get("owner").email;var g=!b.checkGrant(v.default.SHARE_GRANTS.move)||!e.checkGrant(v.default.SHARE_GRANTS.move);var h=b.isSpam()&&!e.checkGrant(v.default.SHARE_GRANTS.move_to_spam);var i=b.isArchive()&&!e.checkGrant(v.default.SHARE_GRANTS.move_to_archive);var j=b.isTrashLike()&&!e.checkGrant(v.default.SHARE_GRANTS.remove);if(f||g||h||i||j){N.default.renderAccess({mode:N.default.MODS.NOT_ENOUGHT_RIGHTS,email:b.isShareTake()?b.get("owner").email:e.get("owner").email});return false}}var l=d.some(function(a){return a.getFolder().id!==c.folderTo||E.default.isMetathread(a)});if(l){k.default.wrap("moveTo",{folderTo:b},this.doAction(c,d))}else{L.default("illegal_move");k.default.add("illegal_move",{folderTo:b})}},handleFolderAllRead:function(a){var b=this;if(a===void 0){a=""}L.default(["letter-action","all-read",a]);this.readAllInProgress=true;r.default.execute({flag:"unread",state:false,folderFrom:this.get("router.model.folder.id")}).then(function(){L.default(["letter-action","all-read","success",a]);b.readAllInProgress=false;K.default.add({text:b.getNotifyText({name:"markas.unread.false",params:{}})})}).then(function(){var a=x.default.all.filter({folder:b.get("router.model.folder.id")}).toArray();b.hideUnsubscribeSender(a)}).catch(function(){L.default(["letter-action","all-read","error",a]);b.readAllInProgress=false})},handleEvent:function(a){var b=this;var c,d,e;var f=a.type,h=a.details,i=h===void 0?{}:h;if(this._isNavigateProcessing){return false}var j=i.get&&i.attrs&&i.get("model")||i.model;var k=i.get&&i.attrs&&i.get("actionCallback")||i.actionCallback;switch(f){case"letter:next":{this.direction="next";break}case"letter:prev":{this.direction="prev";break}case"click:letter":{var l=z.default.getAllModels();var m=l.indexOf(i);this.direction=null;if(this.prevIdx>-1){this.direction=m>=this.prevIdx?"next":"prev"}this.prevIdx=m;break}case"correspondent:search":{this.doSearch("from",i.email,j);break}case"mark:allreaded":{var n=this.get("router.model.folder");var o="";if(n.isMetathread()){o="metathread"}if(n.isTrashLike()){o="trash"}if(n.isSpam()){o="spam"}if(o){this.handleFolderAllRead(o);return}var p=[];p.push(n);J.default.open("confirm-folder-readed",{models:p},{dimmer:true,compact:true,resolvable:true}).then(function(a){var c=a===void 0?{resolveType:"error"}:a,d=c.resolveType;if(d==="ok"){b.handleFolderAllRead()}});return}default:{var q=y.default.getType()==="2pane";var r=!!this.get("router.model.route.params.message");var s=this.get("router.model.route.params.message");var t=r?w.default.all.get(s):this.get("router.model.letter");var u=z.default.getModels();var x=i.selection&&(!t||!q&&u.length);var A=void 0;if(x){A=typeof u.toArray==="function"?u.toArray():u}else{A=j||t||[]}var B=[].concat(A);var C=void 0;if(B.length){var D={type:f,actionCallback:k,parentThread:i.parentThread};if(f==="move"){D.folderTo=i.id}if(f==="archive"){D.folderTo=(d=(c=v.default.all)===null||c===void 0?void 0:c.find(function(a){return a.isArchive()}))===null||d===void 0?void 0:d.get("id")}if(f.startsWith("search:")){C=g.getCorrespondentsFromMessage(j||t);this.doSearch(f,(e=C===null||C===void 0?void 0:C[0])===null||e===void 0?void 0:e.email,j)}else if(f==="forward"){this.doForward(B)}else if(f==="download"){this.doDownload(B[0])}else if(f==="redirect"){this.doRedirect(B[0])}else if(f==="newtab"){this.doNewTab(B[0])}else if(f==="print"||f==="headers"){this.doNewTab(B[0],f)}else{this.doAction(D,B,x)}}}}},sendActionRadar:function(a,b,c){var e=this.get("router");var f=e.model.folder;var g=c.replace(/:/g,"_");var h="on";var i="";var j;if(z.default.isFolderSelected()||a.models&&a.models.length>1){h="mass";j=true}if(z.default.isFolderSelected()){i="-all";if(f&&g==="remove"){if(f.isTrashLike()){g="trash_clear";i=""}else if(f.isSpam()){g="spam_clear";i=""}}}var k=[];if(a.folderTo!==void 0){k.push(["folder-to_"+a.folderTo,1])}if(a.folderFrom!==void 0){k.push(["folder-from_"+a.folderFrom,1])}if(a.flag!==void 0&&a.state!==void 0){k.push([a.flag+"_"+a.state,1])}if(a.spam!==void 0){k.push(["spam_"+a.spam,1])}var l={};if(a.models.length&&ra.includes(c)){var m=a.models.length;var n=0;var o=0;var p=0;var q=0;var r=0;var s=0;var t=0;var u=false;a.models.forEach(function(a){if(!(a instanceof x.default||a instanceof w.default)){return}if(a.get("flags.is_relevant")){o++}if(a.get("flags.is_relevant")&&a.get("flags.unread")){p++}if(a.get("flags.newsletter")&&a.get("flags.show_definitely_spam")&&a.get("flags.have_unsubscribe_list")){t++}if(a.get("flags.unread")){n++}if(a.get("hide_emoji_in_subject")){q++}if(a.get("hide_emoji_in_snippet")){r++}if(a.get("hide_emoji_in_correspondent")){s++}if(d.isActualLettersEnabledInFolder(e,f,a.get("flags.newsletter"))){u=true}});l.dwh={count:m,unread_priority_count:p,has_unread_priority_letters:p>0,has_letters_from_trusted_mailer:t>0,need_hide_emoji_in_subject:q>0,need_hide_emoji_in_snippet:r>0,need_hide_emoji_in_correspondent:s>0,letters_from_trusted_mailer_count:t,unread_count:n,priority_count:o,has_priority_letters:o>0,folder_id:f.get("id"),show_relevant:+u};var v=a.models[0];if(!j){l.dwh.message_id=a.models[0].get("id");var y=v.get("actual_probability");if(y){l.dwh.ml_model=y.split(":")[0]}var A=v.get("flags.bimi_important_msg")||v.get("flags.bimi_msg");var B=v.get("flags.official")||v.get("flags.official_newsletter");if(A){l.dwh.isReliable=A}if(B){l.dwh.isOfficial=B}var C=e.route.is("#read-letter");l.dwh.read_letter=+C}}L.default(__assign({chain:[h,"action",g+i],intervals:k.length&&k},l))},doAction:function(a,b,c){var d=this;var f=[];var g=[];var i=[];var j=false;var k=false;for(var l=0;l<b.length;l++){if(b[l].get("flags.metathread")){f.push(b[l])}else{g.push(b[l])}if(b[l].get("flags.show_definitely_spam")){j=true}if(b[l].get("flags.have_unsubscribe_list")){i.push(b[l])}}var m={models:g};var n=this.get("router");var o=a.type;if(a.type==="remove"&&!n.model.folder.isTrashLike()){m.folderTo=e.TRASH_FOLDER_ID}else if(a.type==="spam"){m.spam=true;m.spamConfirm=j;i=e.SHOW_UNSUBSCRIBE_AFTER_SPAM?i:[]}else if(a.type==="spam:force"){a.type="spam";m.spam=true}else if(a.type==="unspam"){a.type="spam";m.spam=false}else if(a.type==="superspam"){a.type="spam";m.spam=true;m.verified=true}else if(a.type.startsWith("mark:")){if(/readed/.test(a.type)){m.flag="unread"}else if(/pinned/.test(a.type)){m.flag="pinned"}else{m.flag="flagged"}m.state=/:(unreaded|flagged)/.test(a.type);m.target=a.target;a.type="mark"}else if(a.type.startsWith("togglestatus:")){m.flag=a.type.split(":").pop();m.state=!g[0].is("flags."+m.flag);a.type="mark"}else if(a.type.startsWith("metathreadtogglestatus:")){m.flag=a.type.split(":").pop();m.state=!f[0].is("flags."+m.flag);var p=f[0].get("metathread_data.folder");var q=v.default.get(p);var r=q&&!q.isSecureOpen();var s=m.flag==="unread"&&m.state===false&&q&&q.get("messages_unread")>na;if(!r&&!s){f[0].set("flags."+m.flag,m.state)}a.type="mark"}else if(a.type==="move"){m.folderTo=a.folderTo;if(m.folderTo===v.default.SPAM.toString()){m.spamConfirm=j;i=e.SHOW_UNSUBSCRIBE_AFTER_MOVE_TO_SPAM?i:[];k=!!f.length}}else if(a.type==="confirmreceipt"){m.model=b[0]}else if(a.type==="archive"){m.folderTo=a.folderTo}if(z.default.isFolderSelected()&&c){a.type+="All"}m.folderFrom=n.model.folder.id;m.parentThread=a.parentThread;this.sendActionRadar(m,a,o);B.default.reset();z.default.reset();var t=v.default.get(m.folderFrom);var u=v.default.get(String(m.folderTo));var w=[];var x=[];var A=a.type==="moveAll"||a.type==="removeAll";var C=a.type==="removeAll";var D=false;var E=false;if(!e.LAYER_CONFIRM_FOLDER_CLEAR.disable){D=A&&e.LAYER_CONFIRM_FOLDER_CLEAR[t.get("type")]&&(u===null||u===void 0?void 0:u.isTrashLike());E=C&&e.LAYER_CONFIRM_FOLDER_CLEAR[t.get("type")]&&t.isTrashLike()}else{D=A&&t.isInbox()&&u.isTrashLike()}if(g.length){if(D){a.type="moveAll";w.push(t)}if(E){a.type="removeAll";w.push(t)}var F=a.type;if(F==="remove"){var G=a.actionCallback?true:!!f.length;this.pushRemoveActions(x,g,m,{silent:G,actionCallback:a.actionCallback})}else{x.push(function(){d.executeAction(F,m,g,{silent:!k&&!!f.length})})}}if(k){var H=f.map(function(a){return h.getMetathreadName(a)});L.default({type:"notify-moveto-spam-metathread-show",dwh:{names:H,letters:g.length,with_action:e.METATHREAD_MOVE_TO_SPAN_NOTIFY===true}});return this._showDisableMoveToSpamNotify(__assign(__assign({},m),{actionType:a.type}),x,i)}if(!a.type.endsWith("All")&&f.length){a.type+="All"}var I=[];for(var K=0,M=f;K<M.length;K++){var N=M[K];var O={};Object.assign(O,m);delete O.models;O.folderFrom=N.get("metathread_data.folder");I.push(O)}if(I.length){if((a.type==="moveAll"||a.type==="removeAll")&&u.isTrashLike()){a.type="moveAll";I.forEach(function(a){w.push(v.default.get(a.folderFrom))})}x.push(function(){I.forEach(function(b,c){return d.executeAction(a.type,b,[],{silent:!!c})})})}if(w.length){J.default.open("confirm-folder-clear",{action:a,models:w},{dimmer:true,compact:true,mobile:y.default.isLessThen("xs")}).then(function(a){a.on("success",function(){x.forEach(function(a){return a()});f.forEach(function(a){a.set("_metathreadExpanded",false)});a.broadcast("layer:close")})});return}this._executeWithSpamCheck(__assign(__assign({},m),{actionType:a.type}),x,i)},_executeWithSpamCheck:function(a,b,c){if(a.spamConfirm&&e.SHOW_DEFINITELY_SPAM){this._manageSpamLayer(a,c);return}b.forEach(function(a){return a()})},_manageSpamLayer:function(a,b){if(b===void 0){b=[]}var c=b.length?"unsubscribe":"confirm";L.default({type:"layer-confirm-move-to-spam_open",dwh:{type:c,action_type:a.actionType}});J.default.open("confirm-move-to-spam",{models:a.models,actionType:a.actionType,unsubscribeModels:b,type:c},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,mobile:y.default.isLessThen("xs"),"reject-on-close":true}).catch(function(a){if(a){L.default({type:"confirm-move-to-spam-error",i:{type:c},skipdwh:true})}})},_showDisableMoveToSpamNotify:function(a,b,c){var d=this;if(!e.METATHREAD_MOVE_TO_SPAN_NOTIFY||!b.length){K.default.add({text:this.getNotifyText({name:"moveto.metathread",params:{}}),qa:"notify-moveto-spam-metathread"});return}var f=false;var g=K.default.add({text:this.getNotifyText({name:"moveto.metathread.action",params:{}}),actions:[{text:i18n("Переместить")}],duration:e.METATHREAD_MOVE_TO_SPAN_NOTIFY_DURATION,inline:false,qa:"notify-moveto-spam-metathread-action"});g===null||g===void 0?void 0:g.on("action",function(){f=true;L.default({type:"notify-moveto-spam-metathread"});g.close()});g===null||g===void 0?void 0:g.on("closed",function(){if(!f){return}d._executeWithSpamCheck(a,b,c)})},pushRemoveActions:function(a,b,c,d){var f=this;var g=[];var h=[];b.forEach(function(a){if(a.getFolder().isTrashLike()){g.push(a)}else{h.push(a)}});if(h.length){a.push(function(){f.executeAction("move",__assign(__assign({},c),{folderTo:e.TRASH_FOLDER_ID,models:h}),h,d)})}if(g.length){a.push(function(){f.executeAction("remove",__assign(__assign({},c),{models:g}),g,d)})}},openSecureFolderIfNeeded:function(a){if(a.folderTo!==void 0){return v.default.findOne(a.folderTo).then(function(a){if(!a.isSecureOpen()){return M.default(a)}return true}).then(function(a){if(!a){return Promise.reject()}})}return Promise.resolve()},optimisticNavigate:function(a,b,c,d){var e=this;var f=this.get("router");var g=f.request;var h=["mark","markAll"].includes(a);var i=a==="confirmreceipt";var j=this.get("router.model.letter");var k=g.route.is("#search #search-letter");if(!c.length&&!k||!j){return false}var l;if(!c.length&&k){var m=d.some(function(a){return g.params.id===a.id});if(m){l=j}}else{l=c.find(function(a){return a.id===j.id})}if(!l){return false}if(!h&&d&&d.length===1&&!(d[0]instanceof x.default)){var n=l.get("messages").filter(function(a){return a.getFolder()===l.getFolder()});if(n.length>1){b.action=sa.STAY}else{l.destroy()}}if(!g.route.is("#read-letter #search-letter")||h||i){return false}this.doNavigateAction(b).catch(function(a){return e.onActionFail(a)});return true},executeAction:function(a,d,e,f){var g=this;if(f===void 0){f={silent:false}}if(this._isNavigateProcessing){return Promise.resolve()}var h=this.getThreads(e);var i=this.getNavigationPlan(e,h);var j=this.optimisticNavigate(a,i,h,e);return Promise.resolve().then(function(){return g.openSecureFolderIfNeeded(d)}).then(function(){return c.default.dispatch({type:b.EXECUTE_JSSDK_ACTION,action:g.actions[a],uid:pa++,params:d})}).then(function(a){if(a===null||a.jssdkAction.result===null){return}(f===null||f===void 0?void 0:f.actionCallback)&&(f===null||f===void 0?void 0:f.actionCallback(a.jssdkAction));return g.onActionDone(a.jssdkAction,h,f,j)},function(a){var b;L.default({type:"letter-action-failure",rlog:"letter-action-failure",rlog_message:{logScope:JSON.stringify((b=a===null||a===void 0?void 0:a.options)===null||b===void 0?void 0:b.logScope)}})}).then(function(){H.default.updateOnAction()}).catch(function(a){return g.onActionFail(a)})},onActionDone:function(a,d,e,f){var g=this;var h,i,j;var k=this.get("router");var l=k.request;var m=a.models;var n=a.name==="mail.MarkAs"||a.name==="mail.MarkAsAll"||a.name==="mail.ConfirmReceipt";var o=a.name.endsWith("All");var p=true;if(n&&a.models&&a.models.length<2){p=false}if(a.name==="mail.Delete"||o||a.name==="mail.ConfirmReceipt"){p=false}var q=(h=v.default.all.get(a.params.folderFrom))===null||h===void 0?void 0:h.isShareTake();if(q&&(a.name==="mail.MoveTo"&&(a===null||a===void 0?void 0:a.folderTo.isTrashLike())||a.name==="mail.Archive"||a.name==="mail.Spam")){p=false}var r=true;if(e.silent||m&&m.length<2&&a.name==="mail.MarkAs"){r=false}if(!n){z.default.cleanSelection(a.name==="mail.Delete")}else if(n&&!l.route.is("#search #search-letter")&&l.params.folder!=a.params.folderFrom&&o){z.default.reset()}if(a.name==="mail.Delete"||a.name==="mail.MoveTo"||a.name==="mail.Spam"||a.name==="mail.Archive"){var s=(m||[]).filter(function(a){return a instanceof x.default});var t=(m||[]).filter(function(a){return!(a instanceof x.default)});var u=(i=a.params)===null||i===void 0?void 0:i.parentThread;var w=t.length===1&&s.length===0;var y=u&&((j=u.get("messages"))===null||j===void 0?void 0:j.length)<=1;var B=a.name==="mail.Delete"||a.name==="mail.Spam"&&a.params.spam||a.name==="mail.MoveTo"&&(a.params.folderTo==v.default.TRASH||a.params.folderTo==v.default.CHILD_TRASH);var C=l.route.is("#search #search-letter");if((!w||y||B)&&!C||B&&C){c.default.dispatch({type:b.DESTROY_THREADS_AND_MESSAGES,models:{threads:s,messages:t}})}}if((a.name==="mail.Delete"||a.name==="mail.MoveTo"||a.name==="mail.Archive"||a.name==="mail.Spam")&&l.route.is("#search-letter")){c.default.dispatch({type:b.UPDATE_SEARCH})}var D=this._isAutoMoveVisible(a);if(!f){c.default.updateAll()}var E=Promise.resolve();E.then(function(){if(r){var b={text:g.getNotifyText(a),actions:p?[{text:i18n("Отменить")}]:[],shortcut:p?"ctrl+z|command+z: 'action'":null};if(D){b.actions.unshift({text:i18n("Перемещать автоматически"),event:"createfilter"});b.direction="bottom"}var c=K.default.add(b);if(p&&c){c.on("action",function(b){if(b.details==="createfilter"){A.default.openCreateFilter({models:a.models,move:+a.folderTo.id})}else{c.close();a.undo().then(function(){return g.onActionUndo(a)})}})}}}).then(function(){if(n){var b=a.params,c=b.models,d=b.flag,e=b.state;if(d==="unread"&&e===false){g.hideUnsubscribeSender(c)}}}).catch(function(){return g.onActionFail(a)})},doSearch:function(a,b,c){var d;var e=this.get("router");var f=a.split(":").pop();var g=(d={},d["q_"+f]=b,d);if(c&&c instanceof w.default){var h=c.getFolder();if(h.isShareTake()){var i=h.getServiceSharedParent();if(i===null||i===void 0?void 0:i.get("id")){g["q_folder"]=i.get("id")}}}e.go("#search",{},g)},getLetterUrl:function(a,b){return this.get("router").getUrl("#!septimaReadmsg",{letterId:a.get("expand")||a.get("id"),folderId:a.get("folder"),mod:b})},doNewTab:function(a,b){j.default(this.getLetterUrl(a,b))},doForward:function(a){var b=this.get("router.route.params.part");var c=a.reduce(function(a,b){return a+b.get("length")||1},0);if(c>ma){K.default.add({type:K.default.types.error,text:i18n("Можно переслать не более {count} писем. Возможно, вы выделили цепочки, поэтому писем слишком много.",{count:ma}),inline:false})}else{var d=a.map(function(a){if(a instanceof x.default){if(b){return a.get("messages")[0].fetch()}else{return a.fetch({offset:0,limit:ma})}}else{return a.fetch()}});Promise.all(d).then(function(a){var b=a.reduce(function(a,b){if(b instanceof x.default){b.get("messages").forEach(function(b){a.push(b)})}else{a.push(b)}return a},[]);var c=function(){var a=b.map(function(a){return{id:a.get("id"),folder:a.get("folder"),name:(a.get("subject")||"Untitled")+".eml",size:a.get("size"),n:[]}});I.default.open({mode:"new",forward:a})};var d=function(){var a=[];var e=!b.some(function(b){var c=b.getFolder();var e=c.isSecureOpen();if(e){if(b.is("flags.secure")){a.push(b)}}else{M.default(c).then(function(a){if(a){d()}})}return!e});if(e){Promise.all(a.map(function(a){return a.fetch()})).then(c)}};d()})}},doRedirect:function(a){J.default.open("letter-redirect",{model:a},{dimmer:true,compact:true}).then(function(a){a.on("success",function(){a.broadcast("layer:close")})})},doDownload:function(a){location.href=this.getLetterUrl(a,"download")},_isAutoMoveVisible:function(a){var b=a.folderTo;if(!b){return false}if(y.default.isLessThen("xs")){return false}return!e.FORBID_FILTERS&&a.name==="mail.MoveTo"&&(b.isMetathread()||!(b.isSystem()||b.isArchive()))&&!b.isShareTake()},onActionUndo:function(){c.default.updateAll()},onActionFail:function(a){var b=true;var c=false;if(a&&a.error&&a.error.by==="cancel"){b=false}if(a&&a.error&&!a.error.body){c=true}if(a&&b){O.default.addErrorFromApp(a.error,"octavius_lt-actions_err");K.default.add({type:K.default.types.error,text:i18n("Что-то пошло не так!"),unique:c})}},getThreads:function(a){var b=this.get("router");var c=b.request.route;if(!a.length){return a}if(a[0]instanceof x.default){return a}if(c.is("#search #search-letter")){return[]}var d=this.getCurrentFolder();return a.map(function(a){return x.default.getListByMessageId(a.id).find(function(a){return i.getModelCurrentFolder(a).id==d})}).filter(function(a){return a})},getCurrentFolder:function(){return this.get("router").route.params.folder},getNavigationPlan:function(b,c){var d=this.getCurrentFolder();var e=this.get("router");var f=e.request.params.message;var g=e.request.route,h=e.model;var i=h.letter;var j=a.default.get("initialUser.messages.after_delete");if(j===oa&&g.is("#read-letter")){return{action:sa.GO_TO_FOLDER,folder:d}}if(j===oa&&g.is("#search-letter")){return{action:sa.GO_TO_SEARCH}}if(!b.length){return{action:sa.GO_TO_FOLDER,folder:d}}if(b.length===1&&!(b[0]instanceof x.default)&&!c[0]&&!g.is("#search #search-letter")){return{action:sa.GO_TO_FOLDER,folder:d}}if(c.length>1){return{action:sa.GO_TO_FOLDER,folder:d}}var k;if(i&&G.default.has()){var l=e.model.letters;var m=l.indexOf(i);while(l[m]&&m<l.length){m++;if(l[m]&&G.default.isLetterInFilter(l[m])){k=l[m].id;break}}}else if(i&&!f){var n=this.get("router.model.letterNeighbours");k=n&&n.next&&(n.next.id||n.next.threadId)}if(!k){if(g.is("#search-letter")){return{action:sa.GO_TO_SEARCH}}return{action:sa.GO_TO_FOLDER,folder:d}}return{action:sa.GO_TO_NEXT}},doNavigateAction:function(a){var b=this;this._isNavigateProcessing=true;var c=this.get("router");var d=Promise.resolve();switch(a.action){case sa.STAY:break;case sa.GO_TO_NEXT:d=C.default.goToLetter("next");break;case sa.GO_TO_SEARCH:d=c.go("#search",{},"inherit");break;case sa.GO_TO_FOLDER:{d=c.go("#letters",{folder:a.folder,preserveFilters:true});break}}return d.then(function(){b._isNavigateProcessing=false}).catch(function(a){b._isNavigateProcessing=false;return Promise.reject(a)})},getNotifyText:function(a){var b=a.name.replace("mail.","").toLowerCase();var c=a.params;var d=v.default.get(c.folderTo);var e=d&&d.get("name")||"";var f=b;if(b.endsWith("all")){f=f.replace("all","")}switch(f){case"markas":f+="."+c.flag+"."+c.state;break;case"spam":f+="."+c.spam;e=a.params.models.length;break}var g=ta[f];return g&&g(e)},hideUnsubscribeSender:function(a){var d,e;if(!Array.isArray(a)){return}var f=this.get("router.model.unsubscribeList");var h=f===null||f===void 0?void 0:f.actualSenders;if(!h){return}var i=f.hidden;var j=[];var k=function(a){var b=(e=(d=g.getCorrespondentsFromMessage(a,"from"))===null||d===void 0?void 0:d[0])===null||e===void 0?void 0:e.email;var c=!!b&&!!h.find(function(a){return a.sender===b});if(c&&!(i===null||i===void 0?void 0:i.includes(b))){j.push(b)}};for(var l=0,m=a;l<m.length;l++){var n=m[l];k(n)}if(!j.length){return}c.default.dispatch({type:b.HIDE_UNSUBSCRIBE_SENDER,senders:j})}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letters-loader",["require","exports","data-source/actions","data-source/index","data-source/utils/paginator","default-values","feast","mail/Folder","mediator/letters-loader/vars","pilotjs","service/mailbox/loader","service/notify","service/radars/index","trackJS","ui-block/dataset-letters/dataset-letters","ui-block/letter-list/letter-list","ui-block/list-letter-spinner/list-letter-spinner","ui-block/nav-folders/nav-folders","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);var r=1e3;var s=function(e){__extends(s,e);function s(){var a=e.call(this)||this;a._needUpdate={};a._lastThrottledKey=null;a._throttlingTimerId=null;a._isLoading=false;f.default.all.on("change",function(b,c){if(b.changes.includes("messages_total")&&c!==window.app.model.folder){a._needUpdate[c.id]=true}});return a}s.prototype.getComponentsSpec=function(){return{router:{class:h.default},scrollable:{class:q.default,events:[g.LettersLoaderEvents.onBottom]},"letters-list":{class:n.default,events:[g.LettersLoaderEvents.onBottom,g.LettersLoaderEvents.loadMore]},"dataset-letters":{class:m.default},"nav-folders":{class:p.default,events:["folderclickstart","folderhover"]},"list-letter-spinner":{class:o.default,attrs:{hidden:function(a){return!a._isLoading}}}}};s.prototype.handleEvent=function(a){var b=a.type,c=a.details;var d;switch(b){case g.LettersLoaderEvents.onBottom:this.loadLetters();break;case g.LettersLoaderEvents.loadMore:this.loadLetters(c);break;case"folderhover":d=c;if(d&&this._needUpdate[d.id]){i.default.emit("any:reload");delete this._needUpdate[d.id]}break}};s.prototype.getThrottleKey=function(a){var b=this.get("router");if(!b||!b.url){return":"+a}return b.url.href+":"+a};s.prototype.setupThrottling=function(a){var b=this;this._lastThrottledKey=a;this._throttlingTimerId=window.setTimeout(function(){b._throttlingTimerId=null},r)};s.prototype.clearThrottling=function(){window.clearTimeout(this._throttlingTimerId);this._throttlingTimerId=null};s.prototype.loadLettersThrottled=function(c){var d=this;if(this._isLoading){return}var e=this.getThrottleKey(c);if(this._throttlingTimerId){if(this._lastThrottledKey!==e){this.clearThrottling()}else{return}}this.setupThrottling(e);this._isLoading=true;this.updateAll();return b.default.dispatch({type:a.LOAD_MORE,priority:h.default.Loader.PRIORITY_LOW}).then(function(a){if(a&&a.uiLetters.length!==c){k.default(["on_next_page_letters",c]);var b=d.get("router");var e=b.model["folder"].id;k.default({chain:["letters_next_load",e],dwh:{offset:c}})}d._isLoading=false}).catch(function(a){d._isLoading=false;if(a&&!a.body){l.default.addErrorFromApp(a,"octavius_smth_wrong");j.default.error({unique:true})}}).then(function(){d.updateAll()})};s.prototype.loadLetters=function(a){var b=this.get("router");var e=b.route;var f=b&&b.model&&b.model.uiLetters;var g=f&&f.length;if(a&&a.startIndex<d.LIST_LIMIT){return}if(!c.isPaginatorGlobalEnabled(b)||e&&(e.is("#search")||e.is("#search-letter"))){this.loadLettersThrottled(g)}};return s}(e.default.Mediator);exports.default=e.default.Mediator.createFromClass("letters-loader",s)});define("mediator/letters-navigation",["exports","feast","pilotjs","ui-block/letter-list/letter-list","ui-block/portal-menu-element/portal-menu-element"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("letters-navigation",{components:{router:{class:f.default},"portal-menu-element":{class:h.default,events:["folders-toggle"]},"letter-list":{class:g.default,attrs:{transparent:function a(b){return b.isDatasetTransparent}}}},defaults:function a(){this.isDatasetTransparent=false},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"folderstoggle":{this.isDatasetTransparent=d.state;this.updateAll();break}}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letters-shortcut",["require","exports","data-source/actions","data-source/data-source","feast","helpers/dom-utils","lazy.modules","mediator/layout-manager","pilotjs","service/smokescreen","ui-block/dataset-letters/dataset-letters"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);var j=function(c){__extends(j,c);function j(){var a=c.call(this)||this;a.onKeydown=a.onKeydown.bind(a);return a}j.prototype.getComponentsSpec=function(){return{router:{class:g.default,events:["routeend"],handleEvent:"onRouteEnd"},"dataset-letters":{class:i.default,events:["$mount"],handleEvent:"onLettersMount"},dataSource:{class:b.default,events:["actionend"],handleEvent:"onDataSourceActionEnd"}}};j.prototype.onRouteEnd=function(){this.toggleKeydownHandler(false)};j.prototype.onDataSourceActionEnd=function(b){var c=b.details;var d=this.get("router.route");if(c.action.type!==a.NAVIGATE){return false}var e=d.is("#letters #search");var f=d.is("#read-letter #search-letter");if(e||f){this.dataset=this.get("dataset-letters");if(f){this.letterId=d.params.letter}if(this.getDatasetParentElement()){this.onLettersMount()}}};j.prototype.onLettersMount=function(){var a=this;this.dataset=this.get("dataset-letters");this.toggleKeydownHandler(true);setTimeout(function(){a.focusPrevActiveDatasetElement();delete a.letterId},200)};j.prototype.onKeydown=function(a,b){var c=b.shortcut;if(this.validateActiveElement()){if(c==="up"||c==="down"){a.preventDefault();if(c==="up"){this.focusPrevDatasetElement()}else{this.focusNextDatasetElement()}}if(c==="enter"||this.is3Pane()){this.clickActiveDatasetElement()}}};j.prototype.is3Pane=function(){return f.default.getType()==="3pane"};j.prototype.getActiveElement=function(){return document.activeElement};j.prototype.getDatasetElement=function(){var a,b,c,d;return(b=(a=this.dataset)===null||a===void 0?void 0:a.el)!==null&&b!==void 0?b:(d=(c=this.dataset)===null||c===void 0?void 0:c.getEl)===null||d===void 0?void 0:d.call(c)};j.prototype.getDatasetParentElement=function(){var a=this.getDatasetElement();if(a){return a.parentElement}};j.prototype.getFirstDatasetElement=function(){var a=this.getDatasetElement();if(a){return a.querySelector(h.selector(".js-letter-list-item"))}};j.prototype.getDatasetElementById=function(a){var b=this.getDatasetElement();if(b){return b.querySelector(h.selector('.js-letter-list-item[data-id="'+a+'"]'))}};j.prototype.getSelectedDatasetElement=function(){var a=this.getDatasetElement();if(a){return a.querySelector(h.selector(".js-letter-list-item[active]"))}};j.prototype.getActiveDatasetElement=function(){var a=this.getActiveElement();if(a){return a.closest(h.selector(".js-letter-list-item"))}};j.prototype.getSelectedOrActiveDatasetElement=function(){var a=this.getSelectedDatasetElement();return a||this.getActiveDatasetElement()};j.prototype.getActualDatasetElement=function(a){var b=this.getSelectedOrActiveDatasetElement();return b||this.getDatasetElementById(a)};j.prototype.getPrevDatasetElement=function(){var a=this.getSelectedOrActiveDatasetElement();if(a){var b=d.parentsUntil(a,h.selector(".dataset__items"));if(b[0]){var c=b[0].previousElementSibling;while(c){var e=c.querySelector(h.selector(".js-letter-list-item"));if(e){return e}c=c.previousElementSibling}}return d.getPreviousSibling(a,h.selector(".js-letter-list-item"))}return this.getFirstDatasetElement()};j.prototype.getNextDatasetElement=function(){var a=this.getSelectedOrActiveDatasetElement();if(a){var b=d.parentsUntil(a,h.selector(".dataset__items"));if(b[0]){var c=b[0].nextElementSibling;while(c){var e=c.querySelector(h.selector(".js-letter-list-item"));if(e){return e}c=c.nextElementSibling}}return d.getNextSibling(a,h.selector(".js-letter-list-item"))}return this.getFirstDatasetElement()};j.prototype.validateActiveElement=function(){var a=this.getActiveElement();var b=this.getActiveDatasetElement();var c=a.closest(h.selector(".nav-folders"));return a===document.body||b||c};j.prototype.focusPrevActiveDatasetElement=function(){var a=this.getActualDatasetElement(this.letterId);if(a){a.focus()}};j.prototype.focusPrevDatasetElement=function(){if(this.blurActiveElementTimer){return}this._activeElement=this.getPrevDatasetElement();this.fixActiveDatasetElement()};j.prototype.focusNextDatasetElement=function(){if(this.blurActiveElementTimer){return}this._activeElement=this.getNextDatasetElement();this.fixActiveDatasetElement()};j.prototype.fixActiveDatasetElement=function(){var a=this;if(this._activeElement){this._activeElement.focus();this.blurActiveElementTimer=window.setTimeout(function(){a.blurActiveElementTimer=undefined;if(a._activeElement){a._activeElement.focus()}},40)}};j.prototype.clickActiveDatasetElement=function(){var a;(a=this.getActiveDatasetElement())===null||a===void 0?void 0:a.click()};j.prototype.toggleKeydownHandler=function(a){var b=this;var c="left,up,right,down,enter";e.lazyMailKeymaster().then(e.uniqCallback(this,function(d){if(a){d(c,b.onKeydown)}else{d.unbind(c,b.onKeydown)}}))};return j}(c.Mediator);exports.default=c.Mediator.createFromClass("letters-shortcut",j)});define("mediator/metathreads-manager",["exports","@mail/flags","@mail/xray","data-source/actions","data-source/index","data-source/source/ui-threads-settings","default-values","feast","helpers/data-source-dispatch","helpers/opener","mail/User","pilotjs","service/layer","service/promo","service/radars/index","ui-block/metathread/metathread"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var p=B(a);var q=B(b);var r=B(d);var s=B(g);var t=B(h);var u=B(i);var v=B(j);var w=B(k);var x=B(l);var y=B(m);var z=B(n);var A=B(o);function B(a){return a&&a.__esModule?a:{default:a}}exports.default=s.default.Mediator.create("metathreads-manager",{defaults:function a(){var b=this;r.default.one("actionend",function(){if(!f.FORCE_METATHREADS_LETTER&&!f.FORCE_METATHREADS&&!f.FORCE_METATHREADS_EXP){return}var a=p.default.get("ignore-metathreads-experiment");if(a&&a.state){return}var d=b.get("router.model.uiThreadsSettings")||e.defaults;var g=d.metathreads;if(g){a.save({state:true});return}if(f.FORCE_METATHREADS_EXP){a.save({state:true});return}if(f.FORCE_METATHREADS_LETTER){var h=p.default.get("pre-metathread-letter");h.save({state:true});a.save({state:true});(0,z.default)("force_metathreads_letter");return}(0,t.default)({type:c.TOGGLE_METATHREADS_SETTING});a.save({state:true});(0,z.default)("force_metathreads")});r.default.one("actionend",function(){if(!f.METATHREADS_FORCED_EXP){return}var a=p.default.get("metathreads-forced-exp");if(a&&a.state){return}var d=b.get("router.model.uiThreadsSettings")||e.defaults;var g=d.metathreads;if(g){return}var h=false;var i=d.metathreadsSettings;Object.keys(i).forEach(function(a){if(i[a]!==v.default.METATHREADS_STATES.OFF){h=true}});if(h){return}var j=f.METATHREADS_FORCED_EXP.split("|")[0];(0,t.default)({type:c.TOGGLE_METATHREADS_SETTINGS,state:true}).then(function(){a.save({state:true,time:true});y.default.update()}).catch(function(){return(0,z.default)("metathreads-exp-error")});(0,z.default)({type:"metathreads-forced-exp",dwh:{group:j}})})},components:{router:{class:w.default},metathread:{class:A.default,events:["click:cleanmaster","click:metathread-link","click:disable"]}},handleEvent:function a(b){switch(b.type){case"click:cleanmaster":this.onCleanmasterClick(b);break;case"click:metathreadlink":this.onMetathreadLinkClick(b);break;case"click:disable":var c=b.details;this.onMetathreadDisable(c);break;default:break}},onMetathreadLinkClick:function a(b){var c=b.details;var d=this.get("router");var e=c.getMetathreadFolder();d.go("#letters",{folder:e});q.default.send("go_to_folder",{i:{id:e},dwh:{id:e,name:c.getMetathreadFolderName()}})},onCleanmasterClick:function a(){(0,u.default)(f.CLEANMASTER_URL)},onMetathreadDisable:function a(b){var d=function a(){if(b.isToMyself()){r.default.dispatch({type:c.TOGGLE_TO_MYSELF_METATHREAD,state:false});(0,z.default)({type:"tomyself-disable",intervals:[["mt-ctx-menu",1]]})}};if(f.LAYER_METATHREAD_DISABLE){x.default.open("disable-metathread",{model:b},{dimmer:true,resolvable:true,"close-on-dimmer":true,"reject-on-dimmer":true,"close-on-esc":false,"reject-on-close":true}).then(function(){d()}).catch(function(a){if(a){throw a}})}else{d()}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/mobile-sidebar-manager",["require","exports","feast","ui-block/mobile-sidebar/mobile-sidebar","ui-block/webview-mobile-header/webview-mobile-header"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MobileSidebarManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(a){__extends(d,a);function d(){return a!==null&&a.apply(this,arguments)||this}d.prototype.getComponentsSpec=function(){return{"mobile-sidebar":{class:b.default,events:["mobilesidebar:close"],attrs:{open:function(a){return a._isSidebarOpen}}},"webview-mobile-header":{class:c.default,events:["mobilesidebar:open"]}}};d.prototype.handleEvent=function(a){switch(a.type){case"mobilesidebar:open":{this._isSidebarOpen=true;break}case"mobilesidebar:close":{this._isSidebarOpen=false;break}}};return d}(a.default.Mediator);exports.MobileSidebarManager=d;exports.default=a.default.Mediator.createFromClass("mobile-sidebar-manager",d)});define("mediator/orders-manager",["exports","feast","helpers/opener","service/radars/index","ui-block/list-letter-order/list-letter-order"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var j={clickLink:"clicklink"};exports.default=e.default.Mediator.create("orders-manager",{components:{"list-letter-order":{class:h.default,events:["clicklink"]}},handleEvent:function a(b){var c=b.type,d=b.details,e=d===undefined?{}:d;if(c===j.clickLink&&e.url){var h=e.url;(0,f.default)(h);(0,g.default)("list_letter_order_click")}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/paginator-manager/paginator-manager",["require","exports","feast","../../data-source/actions","../../data-source/data-source","../../data-source/utils/letter-list-virtualization","../../data-source/utils/paginator","../../default-values","../../helpers/data-source-dispatch","../../ui-block/dataset-letters/dataset-letters"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PaginatorManager=void 0;a=__importDefault(a);c=__importDefault(c);h=__importDefault(h);var i=function(a){__extends(i,a);function i(){var b=a.call(this)||this;b._isLoading=false;b.getPaginatorPage=b.getPaginatorPage.bind(b);return b}i.prototype.getComponentsSpec=function(){return{"data-source":{class:c.default},"dataset-letters":{class:h.default,attrs:{"paginator-page-getter":function(a){return a.getPaginatorPage}},events:["save-current-page-height","update-on-scroll"]}}};i.prototype.handleEvent=function(a){switch(a.type){case"savecurrentpageheight":this.saveCurrentPageHeight(a.details&&a.details["saveOnlyIfExact"]);return false;case"updateonscroll":this.updatePaginatorPage(a.details&&a.details["scrollTop"]);return false}};i.prototype.getPaginatorPage=function(a,b){if(a===void 0){a=undefined}if(b===void 0){b=false}var c=this.getDatasetLetters();var d=!!a;var e=d?a.models:this.getDatasetLetters().getModels();var g=c.getCurrentPageOverride();if(g!==undefined){return g}if(b&&c.isScrolledToBottom()){return Math.max(Math.ceil(c.getStatus().lettersTotal/f.LIST_LIMIT),1)}var h=c.getScrollTop();var i;var j;var k;for(var l=0;l<e.length;l++){j=d?e[l].model:e[l];k=j.meta("_ui-index");i=c.getBlockMeasuresByModelId(j.id);if(k!==undefined&&i.offset>h){return Math.floor(k/f.LIST_LIMIT)+1}}return 1};i.prototype.saveCurrentPageHeight=function(a){var b,c;if(a===void 0){a=false}var g=this.getDatasetLetters().getStatus();var h=g&&g.page;var i=this.getDatasetLetters().getModels();var j=d.getGenericItemHeight(this.getDatasetLetters().is3Pane(),this.getDatasetLetters().isPonyMode());var k=h*f.LIST_LIMIT-1;var l;var m;var n;var o;for(var p=i.length-1;p>=0;p--){l=i[p];m=l.meta("_ui-index");n=this.getDatasetLetters().getBlockMeasuresByModelId(l.id);if(n&&m===k){o=n.offset-n.height;e.memoizePageHeight(h,o,true);this.getDatasetLetters().setPaginatorDebugState((b={},b["page-height_"+h]="="+o,b));return}}if(a){return}for(var p=i.length-1;p>=0;p--){l=i[p];m=l.meta("_ui-index");n=this.getDatasetLetters().getBlockMeasuresByModelId(l.id);if(n&&m!==undefined&&m!==null){o=n.offset+(k-m)*j-j;e.memoizePageHeight(h,o);this.getDatasetLetters().setPaginatorDebugState((c={},c["page-height_"+h]="~"+o,c));return}}};i.prototype.updatePaginatorPage=function(a){var c=this.getDatasetLetters().getRouter();var d=this.getDatasetLetters().getStatus();var e=c.request!==c.activeRequest;this.getDatasetLetters().setPaginatorDebugState({"scrollTop > lastPageOffset":false,"targetPage < currentPage":false,"status.isLastPage":d.isLastPage,isNavigating:e});if(this.getDatasetLetters().getCurrentPageOverride()!==undefined||e){return}var h=this.findFirstVisibleModelUIIndex(a),i=h.model,j=h.index;if(i===undefined){return}var k=d.page;var l=Math.floor(j/f.LIST_LIMIT)+1;this.getDatasetLetters().highlightElementForDebug(i);this.getDatasetLetters().setPaginatorDebugState({firstModelUIIndex:j});if(l!==k){this.saveCurrentPageHeight(true);this.runThrottled(function(){return g.dispatchAndWait({type:b.LOAD_PAGE,page:l})})}};i.prototype.findFirstVisibleModelUIIndex=function(a){var b=this.getDatasetLetters().getLastCalculatedRange();var c;var d;var e;var f;var g;for(var h=0;h<b.models.length;h++){c=b.models[h].model;d=this.getDatasetLetters().getBlockMeasuresByModelId(c.id);if(d&&d.offset>=a){f=c.meta("_ui-index");e=c.isInMetathread&&c.isInMetathread()&&c.getContainingMetathread();g=e?e.meta("_ui-index"):undefined;if(g!==undefined){return{model:c,index:g}}else if(f!==undefined&&f!==null){return{model:c,index:f}}}}return{}};i.prototype.getDatasetLetters=function(){return this.get("dataset-letters")};i.prototype.runThrottled=function(a){var b=this;if(this._isLoading){this._updateAfterLoaded=a;return}this._isLoading=true;return a().then(function(){b._isLoading=false;if(b._updateAfterLoaded){b.updatePaginatorPage(b.getDatasetLetters().getScrollTop())}}).catch(function(a){b._isLoading=false;if(b._updateAfterLoaded){b.updatePaginatorPage(b.getDatasetLetters().getScrollTop())}throw a})};return i}(a.default.Mediator);exports.PaginatorManager=i;exports.default=a.default.Mediator.createFromClass("paginator-manager",i)});define("mediator/pony-mode",["exports","data-source/actions","data-source/data-source","data-source/source/ui-layout","default-values","feast","helpers/data-source-dispatch","mediator/layout-manager","pilotjs","service/promo","service/radars/index","ui-block/application-mail/application-mail","ui-block/filters/filters","ui-block/letter-list/letter-list","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/nav-folders/nav-folders","ui-block/portal-menu/portal-menu","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/settings-help-link/settings-help-link","ui-block/sidebar-folders/sidebar-folders","ui-block/sidebar-search/sidebar-search","ui-block/thread/thread","../lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var y=S(b);var z=S(e);var A=S(f);var B=S(g);var C=S(h);var D=S(i);var E=S(j);var F=S(k);var G=S(l);var H=S(m);var I=S(n);var J=S(o);var K=S(p);var L=S(q);var M=S(r);var N=S(s);var O=S(t);var P=S(u);var Q=S(v);var R=S(w);function S(a){return a&&a.__esModule?a:{default:a}}exports.default=z.default.Mediator.create("pony-mode",{defaults:function a(){this.toggleRootClass()},components:{router:{class:C.default},"application-mail":{class:F.default,attrs:{ponymode:function a(b){return b.isActive()}}},"letter-list":{class:H.default,attrs:{ponymode:function a(b){return b.isActive()}}},"settings-dock":{class:N.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},settings:{class:M.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},"settings-help-link":{class:O.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},"sidebar-search":{class:Q.default,attrs:{ponymode:function a(b){return b.isActive()}}},"sidebar-folders":{class:P.default,attrs:{ponymode:function a(b){return b.isActive()}}},thread:{class:R.default,attrs:{ponymode:function a(b){return b.isActive()}}},"nav-folders":{class:K.default,attrs:{ponymode:function a(b){return b.isActive()}}},"list-nested-moveto-folder":{class:J.default,attrs:{ponymode:function a(b){return b.isActive()}}},"portal-menu":{class:L.default,attrs:{ponyMode:function a(b){return b.isActive()}}},"search-panel":{class:L.default,attrs:{ponyMode:function a(b){return b.isActive()}}},filters:{class:G.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},"compose-windows":{lazy:x.lazyUIComposeWindows,attrs:{ponymode:function a(b){return b.isActive()}}},"list-letter-attach-status-active":{class:I.default,attrs:{ponymode:function a(b){return b.isActive()}}},dataSource:{class:y.default,events:["actionend"],handleEvent:"onDataSourceActionEnd"},"layer-cleanmaster-modal":{lazy:x.lazyUILayerCleanmasterModal,attrs:{ponymode:function a(b){return b.isActive()}}}},handleEvent:function a(b){switch(b.type){case"ponymode:toggle":this.togglePonyMode(b.details);return false}},togglePonyMode:function b(c){var d=c&&c.from;var e=!this.get("router.model.uiLayout").ponyMode;(0,E.default)({type:"toggle-ponymode-"+(e?"on":"off"),intervals:[[""+d,1]]});(0,A.default)({type:a.TOGGLE_PONY_MODE})},onDataSourceActionEnd:function b(c){var d=c.details;if(d.action.type===a.TOGGLE_PONY_MODE){this.toggleRootClass();B.default.handleMedia();D.default.update();return true}return false},toggleRootClass:function a(){if(this.isActive()){document.body.classList.add("g-pony-mode")}else{document.body.classList.remove("g-pony-mode")}},isActive:function a(){var b=this.get("router.model.uiLayout")||c.defaults;return b.ponyMode}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/progress-bar-manager",["require","exports","data-source/actions","data-source/data-source","default-values","Emitter","feast","pilotjs","request","ui-block/paginator/paginator","ui-block/progress/progress"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var j=c.APPROX_REQUEST_UPLOAD;var k=c.APPROX_REQUEST_DOWNLOAD;var l=c.PROGRESS_FAKE_LOAD_FACTOR;var m={LOAD_START:c.PROGRESS_FACTOR_LOAD_START,UPLOAD:c.PROGRESS_FACTOR_UPLOAD,DOWNLOAD:c.PROGRESS_FACTOR_DOWNLOAD};var n=function(a){__extends(b,a);function b(){var b=a.call(this)||this;b.progress_=0;return b}Object.defineProperty(b.prototype,"progress",{get:function(){return this.progress_},set:function(a){a=Math.round(a);if(a>100){a=100}if(a>=this.progress_){this.progress_=a;this.emit("progress")}},enumerable:false,configurable:true});b.prototype.dispose=function(){var a=this;var b=d.default.getListeners(this,"progress");b.forEach(function(b){return a.off("progress",b)})};return b}(d.default);var o=function(a){__extends(b,a);function b(b,c,d){var e=b.options;var f=a.call(this)||this;f.loadedBytes_=0;f.approxRequestSize_=d;f.fakeUpdateProgress_=f.fakeUpdateProgress_.bind(f);e[c]=function(a){var b=a.lengthComputable&&a.total?a.total:d;f.updateProgress_(b,a.loaded);if(f.progress>=100*l){f.stopFaking()}};return f}b.prototype.updateProgress_=function(a,b){var c=(b-this.loadedBytes_)/a*100;this.loadedBytes_=b;this.progress+=c};b.prototype.fakeUpdateProgress_=function(){if(this.progress<100*l){this.updateProgress_(this.approxRequestSize_,this.progress+.05*this.approxRequestSize_)}else{this.stopFaking()}};b.prototype.startFaking=function(){var a=this;this.fakeProgressPid_=window.setTimeout(function(){if(a.isFaking()){a.fakeProgressPid_=window.setInterval(a.fakeUpdateProgress_,200)}},600)};b.prototype.stopFaking=function(){window.clearInterval(this.fakeProgressPid_);window.clearTimeout(this.fakeProgressPid_);delete this.fakeProgressPid_};b.prototype.isFaking=function(){return!!this.fakeProgressPid_};return b}(n);var p=function(a){__extends(b,a);function b(b){var c=a.call(this)||this;var d=new o(b,"onUploadProgress",j);var e=new o(b,"onDownloadProgress",k);var f=100*m.LOAD_START;var g=f+100*m.UPLOAD;c.progress=f;d.startFaking();d.on("progress",function(){if(d.progress===100&&!e.isFaking()){e.startFaking()}c.progress=f+d.progress});e.on("progress",function(){c.progress=g+e.progress});b.on("end",function(){c.progress=100});return c}return b}(n);var q=function(a){__extends(b,a);function b(){var b=a.call(this)||this;b.activeCount_=0;return b}b.prototype.addXHR=function(a){var b=this;this.activeCount_++;var c=new p(a);var d=0;c.on("progress",function(){var a=c.progress-d;d=c.progress;b.progress+=a*(1/b.activeCount_)})};return b}(n);var r;g.default.on("start",function(a,b){if(r){r.addXHR(b)}});exports.default=e.default.Mediator.create("progress-bar-manager",{components:{dataSource:{class:b.default,events:["beforeaction","actionend"]},router:{class:f.default,events:["beforeroute"]},progress:{class:i.default,attrs:{value:function(a){return a.progress_},visible:function(a){return a.visible_},inanimate:function(a){return a.inanimate_}}},paginator:{class:h.default,attrs:{disabled:function(a){return a.visible_}}}},defaults:function(){this.progress_=0;this.progressMemoized_=0;this.visible_=false;this.inanimate_=false},clearProgressAndShowDebounced_:function(){var a=this;this.progress_=0;this.progressMemoized_=0;this.visible_=false;this.inanimate_=true;this.updateAll();if(this.progressDebouncePid_){window.clearTimeout(this.progressDebouncePid_)}this.progressDebouncePid_=window.setTimeout(function(){a.inanimate_=false;a.visible_=true;a.progress_=a.progressMemoized_;a.updateAll();delete a.progressDebouncePid_},200)},setProgress_:function(a){if(this.progressDebouncePid_){this.progressMemoized_=a;return}this.progress_=a;this.inanimate_=false;this.updateAll()},completeProgressAndHide_:function(){var a=this;this.progress_=100;if(this.progressDebouncePid_){window.clearTimeout(this.progressDebouncePid_)}this.progressDebouncePid_=window.setTimeout(function(){a.visible_=false;a.updateAll();delete a.progressDebouncePid_},100);this.updateAll()},handleEvent:function(b){var c=this;switch(b.type){case"beforeroute":case"beforeaction":{if(b.details.action&&b.details.action.type!==a.NAVIGATE&&b.details.action.type!==a.LOAD_PAGE){return false}if(b.details.initiator==="initial"){return false}this.clearProgressAndShowDebounced_();if(r){r.dispose()}r=new q;r.on("progress",function(){c.setProgress_(r.progress)});break}case"actionend":{if(b.details.action.type!==a.NAVIGATE&&b.details.action.type!==a.LOAD_PAGE&&b.details.action.type!==a.LOAD_MORE){return false}this.completeProgressAndHide_();if(r){r.dispose();r=undefined}break}}return false}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/routes-manager",["require","exports","feast","pilotjs","ui-block/renovator/renovator","../lazy.modules"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RoutesManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var e=function(a){__extends(e,a);function e(){return a!==null&&a.apply(this,arguments)||this}e.prototype.getComponentsSpec=function(){return{router:{class:b.default,events:["route"],handleEvent:"handleRoute"},renovator:{class:c.default,attrs:{isLettersRoute:function(a){return a.is("#letters #search")}}},"themes-widget-ok":{lazy:d.lazyUIThemesWidgetOK},"themes-widget-vk":{lazy:d.lazyUIThemesWidgetVK}}};e.prototype.is=function(a){var b=this.get("router");return b.route.is(a)};e.prototype.handleRoute=function(){var a=this.get("themes-widget-ok");var b=this.get("themes-widget-vk");if(b){b.updateData()}if(a){a.updateData()}};return e}(a.default.Mediator);exports.RoutesManager=e;exports.default=a.default.Mediator.createFromClass("routes-manager",e)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/scrollable-manager",["require","exports","data-source/actions","data-source/data-source","data-source/utils","data-source/utils/paginator","feast","helpers/data-source-dispatch","helpers/fast-deep-equal","logger","pilotjs","route/utils/filter-query","service/adv/index","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScrollableManager=void 0;b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);function o(a){return a}var p=h.default.getScope("scrollable-manager");var q=function(e){__extends(h,e);function h(){var a=e!==null&&e.apply(this,arguments)||this;a._lastFilterQuery=j.default.get();return a}h.prototype.defaults=function(){this._store={}};h.prototype.getComponentsSpec=function(){return{router:{class:i.default,events:["routeend","beforeroute"]},dataSource:{class:b.default,events:["actionend"]},scrollable:{class:n.default,events:["scroll:change"]}}};h.prototype.getKeyForRequest=function(a){var b=a.route;if(b&&b.is&&b.is("#search #search-letter")){var d=c.getStore();var e=d&&d.search;if(e){var f=JSON.stringify(e.query);return{main:b.id+":"+f,fallback:"#search:"+f}}}var g=a.host+":"+a.path;if(!g.endsWith("/")){g+="/"}return{main:g,fallback:g}};h.prototype.handleEvent=function(b){var c=this;var e=b.type,h=b.details;var i=this.get("router");this._lastAdvUpdatePos=this._lastAdvUpdatePos||0;if(e==="scroll:change"){l.default.resetAttachmentDropdown();m.default.resetAttachmentDropdown();if(Math.abs(this._lastAdvUpdatePos-h)>screen.height*2){this._lastAdvUpdatePos=h;k.default.updateOnAction()}return false}if(!i.route){return}switch(e){case"beforeroute":{var n=this.getKeyForRequest(i.request).main;this._lastRouteFolder=i.request.params.folder;this._lastRouteQuery=JSON.stringify(i.request.query);this._lastRouteId=i.request.route.id;this._store[n]=this.getList("scrollable").reduce(function(a,b){var c=o(b);var d=c.getScrollPos(),e=d.x,f=d.y;a[c.get("name")]={left:e,top:f};return a},{});return false}case"routeend":{this._lastRouteInitiator=h&&h.initiator;return false}case"actionend":{if(!(h.action.type===a.NAVIGATE||h.action.type===a.TOGGLE_PAGINATOR||h.action.type===a.UPDATE_LAYOUT_TYPE||h.action.type===a.UPDATE_LAYOUT_SUPPORT_3_PANE)){return false}var q=this.getKeyForRequest(h.request),r=q.main,s=q.fallback;var t=this._store[r]||this._store[s];var u=this.getList("scrollable");u.forEach(function(b){var e=o(b);var k=e.get("name");var l=i.route.is("#read-letter")&&k==="dataset-letters"||i.route.is("#search-letter")&&k==="dataset-letters";var m=c._lastRouteFolder;var n=c._lastRouteQuery;var q=h.request.params.folder;var s=JSON.stringify(h.request.query);var u=!l||!i.route.is("#search #search-letter")&&m!=q;if(i.route.is("#letters")&&(k==="dataset-letters"||j.default.has())&&m==q){u=false}if(i.route.is("#search #search-letter")&&n===s){u=false}var v=d.isPaginatorGlobalEnabled(i);if(c._lastPaginator===undefined){c._lastPaginator=v}var w=c._lastPaginator;var x=c._lastFilterQuery;c._lastPaginator=v;c._lastFilterQuery=j.default.get();if(w!==v||!g.default(x,j.default.get())){p.add("filters changed, reset");delete c._store[r];t=void 0;u=true}else if(h.action.type!==a.NAVIGATE){p.add("not navigate");return}if(i.route.is("#read-letter")&&c._lastRouteId==="#read-letter"){delete c._store[r];t=void 0}if(!t){if(d.isPaginatorGlobalEnabled(i)){f.default({type:a.LOAD_PAGE,page:1})}p.add("on new route",{shouldReset:u});u&&e.reset();return}var y=t[k];if(y&&c._lastRouteInitiator==="popstate"){e.scrollTo(y.left,y.top);e.wasPopstate=true}else{if(d.isPaginatorGlobalEnabled(i)){f.default({type:a.LOAD_PAGE,page:1})}p.add("on old route",{shouldReset:u});u&&e.reset()}})}}};return h}(e.default.Mediator);exports.ScrollableManager=q;exports.default=e.default.Mediator.createFromClass("scrollable-manager",q)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/share-folders-manager/share-folders-manager",["require","exports","data-source/actions","data-source/data-source","data-source/index","default-values","feast","pilotjs","service/auth","service/share-folders","ui-block/contextmenu-folder/contextmenu-folder","../../lazy.modules","./events"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ShareFoldersManager=void 0;b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var l=false;var m=Object.values(k.ShareEvents);var n=function(e){__extends(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}n.prototype.getComponentsSpec=function(){return{router:{class:f.default},dataSource:{class:b.default,events:[k.ACTION_END_DATA_SOURCE_EVENT]},letter:{lazy:j.lazyUILetter,events:m},"context-menu":{class:i.default,events:m}}};n.prototype.handleEvent=function(b){var e=b.type,g=b.details;if(!d.FOLDERS_SHARE_ENABLED){return}switch(e){case k.ACTION_END_DATA_SOURCE_EVENT:{if(g.action.type!==a.NAVIGATE||l){return false}var i=this.getShareActionParamsFromUrl(g.request);if(i){h.default.renderAccess(i);l=true}break}case k.ShareEvents.letterActionClick:{var j=b.originalEvent,m=b.details;j.preventDefault();j.stopImmediatePropagation();var n=j.currentTarget.getAttribute(m.attrName);var o=new f.default.URL(n);var p=this.getShareActionParamsFromUrl(o);if(p){h.default.renderAccess(p)}break}case k.ShareEvents.openShare:{var q=b.details.model;h.default.renderShare({model:q,allFolders:c.default.getData().folders});break}case k.ShareEvents.openShareOpportunities:{h.default.renderShareOpportunities({});break}case k.ShareEvents.denySharedFolder:{var q=b.details.model;h.default.renderDenySharedFolder({model:q});break}}};n.prototype.getShareActionParamsFromUrl=function(a){var b=a===null||a===void 0?void 0:a.query["share-folders"];if(!b){return null}if(b==="confirm"||b==="reject"){var c=a.query,d=c.grant,e=c.salt,f=c.sign,h=c.csrf,i=c.folders,j=c.timestamp,k=c.owner;var l=i.split(",").map(Number);var m=Number(j);return{mode:b,grant:d,salt:e,sign:f,csrf:h,folderIds:l,timestamp:m,ownerEmail:k}}if(b==="resend"){var n=a.query,o=n.glasha,i=n.folders,d=n.grant;var l=i.split(",").map(Number);var p=g.default.user;return{mode:b,grant:d,folderIds:l,email:o,user:p}}return null};return n}(e.default.Mediator);exports.ShareFoldersManager=n;exports.default=e.default.Mediator.createFromClass("share-folders-manager",n)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/sidebar-menu",["require","exports","@mail/flags","data-source/actions","default-values","feast","helpers/data-source-dispatch","pilotjs","ui-block/sidebar-widgets/sidebar-widgets","ui-block/sidebar-widgets/sidebar-widgets.constants"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SidebarMenu=void 0;a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);var i=function(d){__extends(i,d);function i(){return d!==null&&d.apply(this,arguments)||this}i.prototype.getComponentsSpec=function(){return{"sidebar-widgets":{class:g.default,events:[h.SideBarMenuEvents.deactivateNotifyBadge],attrs:{"is-pay-widget-helper-active":function(a){return a.getIsPayWidgetHelperActive()||a.getIsPayWidgetSmartHelperActive()}}},router:{class:f.default}}};i.prototype.getBillsCount=function(){return this.get("router.model.billsCount")};i.prototype.handleEvent=function(d){var f=d.type;switch(f){case h.SideBarMenuEvents.deactivateNotifyBadge:if(c.SIDEBAR_PAY_NOTIFICATION_BADGE){a.default.get("octavius-sidebar-pay-notification-badge").save({state:true})}if(!c.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){break}var g=this.get("sidebar-widgets");var i=this.getBillsCount();if(!i){break}a.default.get("octavius-sidebar-pay-notification-badge-smart").save({state:true});i.hasNewPayments=false;g.set("billsCount",i);e.default({type:b.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE,state:i});break}};i.prototype.getIsPayWidgetHelperActive=function(){var b=a.default.get("octavius-sidebar-pay-notification-badge");return b&&!b.isActive()&&c.SIDEBAR_PAY_NOTIFICATION_BADGE};i.prototype.getIsPayWidgetSmartHelperActive=function(){var b=a.default.get("octavius-sidebar-pay-notification-badge-smart");var d=this.getBillsCount();if(!d||!c.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){return false}var e=d.hasNewPayments;var f=d.hasPaidPaymentsWithNoNew;var g=d.total;var h=!b.isActive()&&g&&!f;return h||e};return i}(d.default.Mediator);exports.SidebarMenu=i;exports.default=d.default.Mediator.createFromClass("sidebar-menu",i)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/themes-manager",["require","exports","@mail/flags","default-values","feast","service/themes","service/themes.setup","ui-block/category-feedback/category-feedback","ui-block/dataset-letters/dataset-letters","ui-block/discounts-item/discounts-item","ui-block/letter-meta/letter-meta","ui-block/noads-button/noads-button","ui-block/panel-with-selected/panel-with-selected","ui-block/portal-menu-logo/portal-menu-logo","ui-block/react-2kit-async/react-2kit-async","ui-block/react-async/react-async","ui-block/search-panel/search-panel","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/sidebar/sidebar","ui-block/sidebar-folders/sidebar-folders","ui-block/thread/thread","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);var v=function(){return e.default.getSelectedModel().isDarkMode()};var w={darkMode:v};var x={"dark-mode":v};exports.default=c.default.Mediator.create("themes-manager",{components:{"themes-manager":{class:d.default,events:["themes:apply","themes:reload"],handleEvent:"onLoadTheme"},"layer-create-folder":{lazy:u.lazyUILayerCreateFolder,attrs:x},"layer-edit-settings-filter":{lazy:u.lazyUILayerEditSettingsFilter,attrs:x},"react-async":{class:n.default,attrs:w},"vk-messenger-provider":{attrs:w},"react-2kit-async":{class:m.default,attrs:w},"compose-app":{lazy:u.lazyUIComposeApp,attrs:w},"settings-dock":{class:q.default,attrs:Object.assign({theme:function(){return e.default.getSelectedModel()}},w),events:["theme:select"],handleEvent:"onThemeSelect"},"dataset-letters":{class:g.default,attrs:w},settings:{class:p.default,events:["themes:panel"],handleEvent:"onPanelOpen"},sidebar:{class:r.default,attrs:{"widget-enabled":function(a){return a.isThemeSupportWidget()}}},"sidebar-folders":{class:s.default,attrs:{"widget-enabled":function(a){return a.isThemeSupportWidget()}}},"noads-button":{class:j.default,attrs:{isDefaultTheme:function(a){return a.getThemeId()===b.DEFAULT_THEME_ID}}},"themes-widget":{lazy:u.lazyUIThemesWidget,attrs:{id:function(a){return a.getThemeId()},data:function(a){return a.getThemeData()},widgetData:function(a){return a.getThemeWidgetData()}}},thread:{class:t.default,attrs:x},"panel-with-selected":{class:k.default,attrs:x},"letter-meta":{class:i.default,attrs:x},"search-panel":{class:o.default,attrs:Object.assign({whiteTheme:function(){return e.default.getSelectedModel().isWhiteTheme()}},w)},"category-feedback":{class:f.default,attrs:x},"drag-and-drop":{attrs:x},"layer-metathreads-settings":{lazy:u.lazyUILayerMetathreadsSettings,attrs:x},"portal-menu-logo":{class:l.default,attrs:{theme:function(){return e.default.getSelectedModel().id}}},discounts:{class:h.default,attrs:x}},getThemeId:function(){return e.default.getSelectedModel().id},getThemeData:function(){return e.default.getSelectedModel().widget.data},getThemeWidgetData:function(){return e.default.getSelectedModel().widgetData},isThemeSupportWidget:function(){return e.default.getSelectedModel().isSupportWidget()&&!this.hideWidget()},hideWidget:function(){var c=this.getThemeId();if(c==="t2052"&&!b.THEMES_WIDGET_CLOUDY_ENABLED){return true}if(!b.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS.includes(c)){return false}if(c==="t5002"&&Math.floor((new Date("2020-01-06").getTime()-Date.now()).valueOf()/1e3)<0){return true}if(c==="t5003"||c==="t1169"||c==="t5004"){var d=a.default.get("t5003-widget");return b.WIDGETS_SHOW_LIMIT_MAP.t5003<(d&&d.getCount("show"))||d&&d.state}var e=a.default.get(c+"-widget");return b.WIDGETS_SHOW_LIMIT_MAP[c]<(e&&e.getCount("show"))||e&&e.state},markWidgetAsShowed:function(){if(!e.default.getSelectedModel().isSupportWidget()){return}var c=this.getThemeId();if(c==="t5003"||c==="t1169"||c==="t5004"){var d=a.default.get("t5003-widget");return d&&d.save({hit:true})}if(b.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS.includes(c)){var d=a.default.get(c+"-widget");return d&&d.save({hit:true})}},onLoadTheme:function(a){var b,c;var d=Array.from(document.body.classList).filter(function(a){return a.startsWith("theme-")});var e=["theme-"+a.id];var f="g-dark-mode";if(a.isDarkMode()){e.push(f)}else{d.push(f)}(b=document.body.classList).remove.apply(b,d);(c=document.body.classList).add.apply(c,e);this.markWidgetAsShowed()},onThemeSelect:function(a){var b;var c=(b=a===null||a===void 0?void 0:a.details)===null||b===void 0?void 0:b.model;if(c){e.default.setTheme(c,true)}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/translator-manager",["require","exports","@mail/flags","@mail/xray","cfgUser","default-values","feast","mail/Message","mail/Thread","pilotjs","service/notify","service/radars/index","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TranslatorManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);var m=function(e){__extends(m,e);function m(){return e!==null&&e.apply(this,arguments)||this}m.prototype.defaults=function(){};m.prototype.getComponentsSpec=function(){return{router:{class:h.default},letter:{lazy:l.lazyUILetter,events:["translator:show","translator:close","translator:hide","letter:translate","letter:original"]},"dropdown-actions":{class:k.default,events:["translator:show"]}}};m.prototype.handleEvent=function(a){var b=false;var c=this.getModel(a);if(!c){return b}var d=a.details.block||this.findLetterById(c.id);if(!d){return b}var e={model:c,block:d,options:a.details.options};switch(a.type){case"letter:translate":this.onLetterTranslate(e);break;case"letter:original":this.onLetterOriginal(e);break;case"translator:show":this.onTranslatorShow(e);break;case"translator:close":this.onTranslatorClose(e);break;case"translator:hide":this.onTranslatorHide(e);break}return b};m.prototype.onTranslatorShow=function(e){var f;var g=e.block,h=e.model;var i=h.get("flags.in_english");var j=c.default.get("LANG");var k="";var l="";if(j!=="en_US"&&i){k="ru";l="en"}else{k="en";l="ru"}var m=!g.is("is-translator-visible");g.set({"is-translator-visible":true,"translator-default-from":l,"translator-default-to":k});(f=a.default.get("translator-hide"))===null||f===void 0?void 0:f.save({state:false,time:true});var n=h.get("id");g.broadcast("translator:scrollto");b.default.send("letter_translator_show",{dwh:{letterId:n,automated_show:false,in_english:!!i}});if(m&&!d.DISABLE_AUTOMATED_TRANSLATE){b.default.send("letter_automated_translate",{dwh:{letterId:n}});this.onLetterTranslate({block:g,model:h,options:{fromlang:l,tolang:k}})}};m.prototype.onTranslatorClose=function(a){var b=a.block;b.set({"is-translator-visible":false,"is-translator-forced-shown":true})};m.prototype.onTranslatorHide=function(b){var c;this.onTranslatorClose(b);(c=a.default.get("translator-hide"))===null||c===void 0?void 0:c.save({state:true,time:true})};m.prototype.onLetterTranslate=function(a){var b=a.block,c=a.model,d=a.options;var e=d.tolang,f=d.fromlang;if(b.is("is-translator-loading")){return}b.set("is-translator-loading",true);return c.translate({tolang:e,fromlang:f}).then(function(){b.set({"is-translator-error":false,"is-translator-loading":false,"is-letter-translated":true});j.default({chain:["trans","ok","from",f,"to",e]})}).catch(function(a){b.set({"is-translator-loading":false,"is-translator-error":true});i.default.error({text:i18n("Не удалось перевести текст")});j.default({chain:["trans","err","from",f,"to",e]});console.error(a)})};m.prototype.onLetterOriginal=function(a){var b=a.block;b.set({"is-letter-translated":false})};m.prototype.getModel=function(a){var b=a.details.model;var c=this.get("router.model.letter");var d=b||c;if(d&&d instanceof g.default&&d.get("messages.length")){if(this.get("router.route").is("#search-letter")){d=f.default.get(this.get("router.model.route.params.id"))}else{d=d.getExpandMessage()}}return d};m.prototype.findLetterById=function(a){return this.components.letter.find(function(b){return b.isLetterIdEq(a)})};return m}(e.default.Mediator);exports.TranslatorManager=m;exports.default=e.default.Mediator.createFromClass("translator-manager",m)});define("helpers/subscribe-notify",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getUnsubscribesText=void 0;function a(a){if(typeof a==="number"&&a>0){var b={count:a};return i18n.plural(a,[i18n("Вы успешно отписались от {count} рассыльщиков",b),i18n("Вы успешно отписались от {count} рассыльщика",b),i18n("Вы успешно отписались от {count} рассыльщиков",b)])}return i18n("Вы успешно отписались")}exports.getUnsubscribesText=a});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/unsubscribe-actions",["require","exports","data-source/actions","data-source/data-source","data-source/index","default-values","feast","feast-mod/correspondents","helpers/data-source-dispatch","helpers/subscribe-notify","logger","mail/actions/CleanmasterUnreadManage","mail/Folder","pilotjs","RPC","service/notify","service/radars/index","ui-block/dataset-letters/dataset-letters","ui-block/dropdown-actions/dropdown-actions","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-unsubscribe/list-letter-unsubscribe","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.UnsubscribeActions=void 0;b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);var v=["unsubscribe","moveallfrom","markallfrom"];var w={markallfrom:function(){return i18n("Помечено прочитанным")},unsubscribe:function(a){return h.getUnsubscribesText(a)},moveallfrom:function(){return i18n("Перемещено в папку «Корзина»")},fail:function(){return i18n("Что-то пошло не так")},"unsubscribe:from:ll":function(a){var b={sender:a.name||a.email};return i18n("Вы отписались от писем «{sender}»",b)}};var x=function(e){__extends(h,e);function h(){var a=e!==null&&e.apply(this,arguments)||this;a.actionsFinished=false;a.shouldAbort={};return a}h.prototype.getComponentsSpec=function(){return{router:{class:l.default},unsubscribe:{lazy:u.lazyUIUnsubscribe,events:v,attrs:{"actions-finished":function(a){return a.hasActionsFinished()}}},"dropdown-actions":{class:q.default,events:v},"list-letter-unsubscribe":{class:t.default,events:["unsubscribe:from:ll","unsubscribe:update"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-common":{class:r.default,events:["unsubscribe:from:ll","unsubscribe:update","letter:intersect:viewport","letter:hide:unsubscribe:sender"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-compact":{class:s.default,events:["unsubscribe:from:ll","unsubscribe:update","letter:intersect:viewport","letter:hide:unsubscribe:sender"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"dataset-letters":{class:p.default,events:["unsubscribe:from:ll","unsubscribe:update","letter:hide:unsubscribe:sender"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"data-source":{class:b.default,events:["actionend"]},"layer-confirm-move-to-spam":{events:["unsubscribe"]}}};h.prototype.handleEvent=function(a){var b=a.type,c=a.details,d=c===void 0?{}:c;this.actionsFinished=false;switch(b){case"unsubscribe":{this.doUnsubscribe({type:b,params:d},{silent:d.silent});break}case"markallfrom":{var e=Array.isArray(d.from)?d.from:[d.from];var f={from:e,action:"unset",marks:["unread"],only_newsletters:true};this.doMarkAllFrom({type:b,params:f});break}case"moveallfrom":{var e=Array.isArray(d.from)?d.from:[d.from];var f={folder:k.default.TRASH,from:e,only_newsletters:true};this.doMoveAllFrom({type:b,params:f});break}case"unsubscribe:from:ll":{this.doUnsubscribeFromLL({type:b,sender:d.sender});break}case"actionend":{this.handleActionEnd(d.action);break}case"letter:intersect:viewport":{var g=d.uid,h=d.sender;this.handleIntersectViewport({uid:g,sender:h});break}}};h.prototype.doUnsubscribe=function(a,b){var c=this;var d=a.type,e=a.params;var f=e.ids,g=e.position;if(!f){return false}return m.default.get("messages/services/unsubscribe",{ids:f}).then(function(){return c.onActionDone(d,__assign(__assign({},b),{position:g}))}).catch(function(){return c.onActionFail(d)})};h.prototype.doMoveAllFrom=function(a){var b=this;var c=a.type,d=a.params;var e=d.folder,f=d.from;if(!d||!e||!f){return false}if(!this.isSenderFromValid(f)){return false}return m.default.get("messages/move/all",d).then(function(){return b.onActionDone(c)}).catch(function(){return b.onActionFail(c)})};h.prototype.doMarkAllFrom=function(a){var b=this;var c=a.type,d=a.params;var e=d.action,f=d.marks,g=d.from;if(!d||!e||!f||!g){return false}if(!this.isSenderFromValid(g)){return false}if(e!=="set"&&e!=="unset"){return false}return m.default.get("messages/marks/all",d).then(function(){return b.onActionDone(c)}).catch(function(){return b.onActionFail(c)})};h.prototype.onActionDone=function(a,b){var d=this;if(b===void 0){b={silent:true}}var e=a==="moveallfrom"?this.backToFolder():c.default.updateAll();var f=b.position;e.then(function(){var c={text:d.getNotifyText(a)};if(!(b===null||b===void 0?void 0:b.silent)){n.default.add(c)}d.actionsFinished=true;d.updateAll();i.default.add("unsubscribe action ok",a);o.default({type:a+"_action-success",dwh:{position:f}})}).catch(function(){return d.onActionFail(a)})};h.prototype.onActionFail=function(a){this.actionsFinished=true;this.updateAll();i.default.add("unsubscribe action failed",a);o.default(a+"_action-error");n.default.add({type:n.default.types.error,text:this.getNotifyText("fail")})};h.prototype.isSenderFromValid=function(a){return a.every(function(a){return/@/.test(a)})};h.prototype.getNotifyText=function(a,b){return w[a](b)};h.prototype.hasActionsFinished=function(){return this.actionsFinished};h.prototype.backToFolder=function(){var a,b;var c=this.get("router");var d=(b=(a=c.route)===null||a===void 0?void 0:a.params)===null||b===void 0?void 0:b.folder;return c.go("#letters",{folder:d,preserveFilters:true})};h.prototype.doUnsubscribeCleanMaster=function(a){return j.default.execute({method:j.default.Methods.Unsubscribe,emails:[a]}).then(function(){return o.default({type:"unsub_clnmstr",dwh:{sender:a}})})};h.prototype.findLetterBySender=function(a,b){return a.filter(function(a){var c,d;var e=a.get("model");var g=(d=(c=f.getCorrespondentsFromMessage(e,"from"))===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.email;if(!b){return false}return b.includes(g)})};h.prototype.updateUnsubscribeList=function(a){var b=this.components["list-letter-common"];var c=this.components["list-letter-compact"];var d=this.findLetterBySender(__spreadArrays(b,c),a);d.forEach(function(a){return a.broadcast("unsubscribe:update")})};h.prototype.handleActionEnd=function(b){var c=b.type,d=b.sender;if(c===a.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST||c===a.HIDE_UNSUBSCRIBE_SENDER){this.updateUnsubscribeList([d])}};h.prototype.deleteSenderFromUnsubscribeList=function(b){var c=this;g.default({type:a.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST,senders:b}).then(function(){c.updateUnsubscribeList(b)})};h.prototype.doUnsubscribeFromLL=function(a){var b=this;var c=a.type,e=a.sender;var f=e.email;var g=n.default.add({text:this.getNotifyText(c,e),actions:[{text:i18n("Отменить")}],duration:d.LL_UNSUBSCRIBE_NEWSLETTERS_TIMEOUT,qa:"notify-ll-unsubscribe"});if(!g){return}g.on("action",function(){b.shouldAbort[f]=true;o.default({type:"unsub_clnmstr_cancel_clk",dwh:{sender:f}});g.close()});g.on("closed",function(){if(!b.shouldAbort[f]){b.doUnsubscribeCleanMaster(f).then(function(){b.deleteSenderFromUnsubscribeList([f])}).catch(function(a){var b=a.error;n.default.error({unique:true});o.default({chain:["unsub_clnmstr_err",b.status,b.message],dwh:{sender:f}})})}else{b.shouldAbort[f]=false}})};h.prototype.handleIntersectViewport=function(b){var c=b.uid,d=b.sender;g.default({type:a.COUNT_UNSUBSCRIBE_VIEW,uid:c,sender:d.email,priority:l.default.Loader.PRIORITY_LOW})};return h}(e.default.Mediator);exports.UnsubscribeActions=x;exports.default=e.default.Mediator.createFromClass("unsubscribe-actions",x)});define("mediator/user-info",["exports","../lazy.modules","feast","service/auth","ui-block/list-letter-welcome/list-letter-welcome","ui-block/portal-menu/portal-menu","ui-block/sidebar-folders/sidebar-folders"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=l(b);var h=l(c);var i=l(d);var j=l(e);var k=l(f);function l(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Mediator.create("user-info",{defaults:function a(){},components:{letter:{lazy:a.lazyUILetter,attrs:{"current-user":function a(b){return b.getUser()}}},"sidebar-folders":{class:k.default,attrs:{"is-pdd-user":function a(b){return b.getUser().isPDD()}}},"portal-menu":{class:j.default,attrs:{"current-user":function a(b){return b.getUser()}}},"list-letter-welcome":{class:i.default,attrs:{"current-user":function a(b){return b.getUser()}}}},getUser:function a(){return h.default.user}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/mediators",["require","exports","feast","mediator/addressbook-manager","mediator/advert-manager","mediator/attachments-manager","mediator/compose-manager","mediator/contact-selection","mediator/features","mediator/filter-manager","mediator/flags","mediator/folders-actions","mediator/folders-navigation","mediator/layout-manager","mediator/letter-attaches-preview","mediator/letter-list-adv-optimizer","mediator/letters-actions","mediator/letters-loader","mediator/letters-navigation","mediator/letters-selection","mediator/letters-shortcut","mediator/metathreads-manager","mediator/mobile-sidebar-manager","mediator/orders-manager","mediator/paginator-manager/paginator-manager","mediator/pony-mode","mediator/progress-bar-manager","mediator/routes-manager","mediator/scrollable-manager","mediator/search-manager","mediator/settings-filters-manager","mediator/settings-manager","mediator/share-folders-manager/share-folders-manager","mediator/sidebar-menu","mediator/swipe-manager","mediator/themes-manager","mediator/thread-manager","mediator/thread-scroller","mediator/translator-manager","mediator/unsubscribe-actions","mediator/user-info","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initAllMedaitors=exports.eachMediators=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);var O=function(){};var P=[e.default,D.default,d.default,f.default,b.default,E.default,j.default,k.default,h.default,g.default,i.default,l.default,o.default,q.default,p.default,r.default,s.default,t.default,v.default,x.default,z.default,A.default,n.default,B.default,C.default,G.default,H.default,I.default,J.default,K.default,L.default,M.default,y.default,F.default,w.default,c.default,m.default,u.default,N.lazyMediatorCalendarManager,N.lazyMediatorCallsManager,N.lazyMediatorPageTitle,N.lazyMediatorTodoManager,N.lazyMediatorWelcomeBlockManager,N.lazyMediatorMarusiaManager];var Q=function(a){if(a===void 0){a=O}return P.map(function(b,c){if(typeof b==="function"){return b().then(function(b){if(b.default&&b.default.register){b=b.default}P[c]=b;a(b);return b})}a(b);return b})};exports.eachMediators=Q;var R=false;var S=null;var T=[];var U={};var V=function(a){if(a===void 0){a=O}if(R){a(U,P);return}T.push(a);if(S===null){S=Promise.all(exports.eachMediators()).then(function(){R=false;P.forEach(function(a){U[a.name]=a});T.forEach(exports.initAllMedaitors);T.length=0})}};exports.initAllMedaitors=V;a.default.Mediator.lazyRegister=function(a,b){exports.eachMediators(function(c){if(c.name===a&&b.isMounted()){c.register(b)}})}});define("helpers/viewport",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.toggleViewport=a;function a(a){var b=document.querySelector("meta[name=viewport]");if(!b){b=document.createElement("meta");b.name="viewport";document.head.appendChild(b)}b.setAttribute("content",a)}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/pre-init",["require","exports","@mail/features","css-supports","helpers/browser","helpers/viewport","mail/Message","../default-values","../helpers/lazy","../mediator/layout-manager","../service/adv/mimic","../service/radars/index","./mediators"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.preInit=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);h=__importDefault(h);i=__importDefault(i);exports.preInit=g.lazyInit(function(){k.initAllMedaitors();b.default.shim();if(f.IS_TABLET&&!(f.WEBVIEW&&f.WEBVIEW_MOBILE_MODE_ENABLED)&&!f.OCTAVIUS_MOBILE){d.toggleViewport("")}j.radarService.init(h.default);i.default.setLayoutManager(h.default);if(a.default.has("blockquote")||a.default.has("blockquote-threads")){e.default.QUOTES_VERSION=f.QUOTES_VERSION}document.body.classList.add("default-font");if(c.default.mac){document.body.classList.add("macintosh-font")}})});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/promo",["require","exports","../data-source/actions","../service/promo","../service/themes.setup"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initPromo=void 0;b=__importDefault(b);c=__importDefault(c);var d=function(d){c.default.themes.on("themes:apply",function(a){b.default.applyTheme(a);new Promise(function(a,b){require(["service/feedback"],a,b)}).then(__importStar).then(function(b){var c;var d=b.default;d.setDarkMode((c=a===null||a===void 0?void 0:a.isDarkMode)===null||c===void 0?void 0:c.call(a))})});d.on("actionend",function(c){var d=c.details;var e=d.action;if([a.NAVIGATE,a.TOGGLE_METATHREAD,a.TOGGLE_DISCOUNTS,a.UPDATE_ALL].includes(e.type)){b.default.update();new Promise(function(a,b){require(["service/feedback"],a,b)}).then(__importStar).then(function(a){var b=a.default;b.update()})}})};exports.initPromo=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/release-detect",["require","exports","default-values","../helpers/lazy","../helpers/object-to-query","../lazy.modules"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initReleaseDetect=void 0;c=__importDefault(c);var e=function(e){var f=e.cfg,g=e.RPC,h=e.app,i=e.xray;d.lazyMailReleaseDetect().then(function(d){var e=d.appendQuery,j=d.buildComparator,k=d.createReleaseDetectClient,l=d.hashComparator;k({xraySend:function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return i.send.apply(i,a)},router:h,location:e("x-email",g.setup("email")),sources:[{name:"build",endpoint:function(){return"/srv-st.json?_="+Math.random()},comparator:j,reloadTimeRange:a.RELOAD_TIMEOUT,initialData:{build:f.get("build")},ondata:b.createAppBundlePreloader({filter:a.PRELOAD_RELEASE_BUNDLES_FILTER,staticHost:f.get("static-http-path"),jsMap:{paths:f.get("requirejs-config").paths}})},a.OK_RELOAD&&{name:"hashes",endpoint:function(){return"/api/v1/utils/sota/hash?"+c.default({token:g.setup("token"),email:g.setup("email"),_:String(Math.random())},true)},comparator:l,reloadTimeRange:a.OK_RELOAD_TIMEOUT,shadow:a.OK_RELOAD_SHADOW,initialData:{ff_hash:f.get("hashes.ff"),ok_hash:f.get("hashes.ok")}}].filter(Boolean)})})};exports.initReleaseDetect=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/router/listener",["require","exports","@mail/features","@mail/xray"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initRouterDocumentListener=void 0;a=__importDefault(a);b=__importDefault(b);function c(c,d){var e=d.smokeScreenService,f=d.logger;var g=a.default.getAsArray("octavius-filter-url-regexp",["addressbook\\/.*"],":").map(function(a){try{return new RegExp(a)}catch(a){b.default.send("p_jserror&i=JS_regexp")}return undefined}).filter(function(a){return a!==undefined});c.listenFrom(document,{autoStart:true,logger:f,filter:function(a){if(c.isDead){return false}if(c.route.is("#attachment #attachment-editor")){return false}for(var b=0;b<g.length;b++){if(g[b].test(a)){return false}}if(/#mailruanchor/.test(a)){return false}return e.isValidURL(a)}})}exports.initRouterDocumentListener=c});define("boot/router/user-timings",["require","exports","@mail-core/dashboard"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initUserTimingsRouter=void 0;var b=function(b){var c=b.request,d=b.app;var e={"#letters":"list","#read-letter":"thread"};var f=[];var g=[];var h="none";var i="none";var j=false;c.on("start end",function(a,b){if(j){(a.type==="end"?g:f).push(b)}});d.on("beforeroute",function(b,c){h=e[b.target.activeRoute.id];i=e[c.route.id];j=!!(h&&i);if(j){a.userKeeper.time("app-nav-route")}});d.on("routeend",function(){if(j){var b=f.length>0&&g.length>0?"dry":"hot";j=false;a.userKeeper.timeEnd("app-nav-route",{score:"route",appendix:i+"-"+h+"-"+b});g.forEach(function(b){a.userKeeper.time("app-nav-req",b.startTime);a.userKeeper.timeEnd("app-nav-req",b.endTime,{score:"route",appendix:i+"-"+h+"-"+b.url.split("/").slice(-2).join("-").split(/[?#]/)[0]})})}f.length=0;g.length=0})};exports.initUserTimingsRouter=b});define("helpers/octavius",["exports","@mail/flags"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.octaviusToggle=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a){try{window.__PH.cookie.s.setGlobal("m_oct",a?1:0);if(window.location.host==="e.mail.ru"){window.__PH.cookie.s.setGlobal("octavius",a?1:0)}}catch(a){}var c=b.default.get("octavius");var d=Promise.resolve();if(!c.state){var e=b.default.get("octavius-on-register-enabled");d=e.save({state:false,time:true})}var f=c.state==a?Promise.resolve():c.save({state:a,time:true,hit:true});return Promise.all([f,d])}});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/compose-template",["require","exports","default-values","mail/MessageFormData"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);var c=i18n("Поздравляю!");var d={open:function(b){return __awaiter(void 0,void 0,void 0,function(){var e,f,g,h;var i;return __generator(this,function(j){switch(j.label){case 0:j.trys.push([0,3,,4]);return[4,d.fetchTemplate(b)];case 1:e=j.sent();f=(i=a.COMPOSE_TEMPLATES_SUBJECTS[b])!==null&&i!==void 0?i:c;return[4,d.saveDraft({subject:f,body:{html:e,text:undefined}})];case 2:g=j.sent();d.compose(g,b);return[3,4];case 3:h=j.sent();return[3,4];case 4:return[2]}})})},openFromGetParameter:function(b){var c=a.COMPOSE_ALLOWED_TEMPLATES.includes(b);if(!c){return}return d.open(b)},fetchTemplate:function(b){return fetch(a.COMPOSE_TEMPLATES_URL+"/"+b+".html",{mode:"cors"}).then(function(a){return a.text()})},saveDraft:function(a){var c=new b.default(a);return c.save().then(function(a){var b,c;return(c=(b=a)===null||b===void 0?void 0:b.body)===null||c===void 0?void 0:c.id})},getRouter:function(){return window.app},compose:function(a,b){var c=d.getRouter();c.nav("/compose/"+a+"/drafts?template-name="+b)}};exports.default=d});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/query-checker",["require","exports","@mail/contact-validation","@mail/flags","@mail/xray","cfg","data-source/actions","default-values","helpers/data-source-dispatch","helpers/octavius","mediator/layout-manager","pilotjs","service/compose-template","service/layer","service/radars/index","service/themes.setup","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);var p=function(){function p(a){this.target=a;this.request=a.activeRequest;this.route=a.activeRoute}p.prototype.handleToggleMetathreads=function(){var a=this.request.query.metathreads;var b={on:true,off:false};if(b.hasOwnProperty(a)){var c=b[a];g.default({type:e.CHANGE_METATHREADS_SETTING,state:c});this._eliminateQueryParam("metathreads")}};p.prototype.handleToggleToMyselfMetathread=function(){var a=this;var c="tomyself";var d=this.request.query[c];if(d!=="on"){return}l.default.open("confirm-tomyself-enable",{},{compact:true,dimmer:true,resolvable:true,"close-on-dimmer":false,"close-on-esc":false,"reject-on-close":true}).then(function(){var a=b.default.get("to-myself").isActive();if(!a){g.default({type:e.TOGGLE_TO_MYSELF_METATHREAD,state:true});m.default("query_myself_on")}}).catch(function(a){if(a){m.default("quer_mslf_open_err_"+a);throw a}}).finally(function(){a._eliminateQueryParam(c)})};p.prototype.handleToggleLayout=function(){var a=this.request.query.layout;if(a==="2pane"||a==="3pane"){i.default.setLayout(a);this._eliminateQueryParam("layout")}};p.prototype.handleEnableOctavius=function(){var a=this;if(this.request.query.octavius==="on"){h.octaviusToggle(true).then(function(){window.sendLoadlogRadar("loadflow_step-21a","octavius_force_enabled_success");window.appStarted("redirect");var b=Object.assign({},a.request.query);delete b.octavius;var c=j.default.queryString.stringify(b);var e=d.default.get("urls.rootUrl");window.location.replace(e+"?"+c)}).catch(function(){window.sendLoadlogRadar("loadflow_step-21b","octavius_force_enabled_fail")})}};p.prototype.handleSetTheme=function(){return __awaiter(this,void 0,void 0,function(){var a,b,d;return __generator(this,function(e){switch(e.label){case 0:a=this.request.query.theme;if(!a){return[2]}this._eliminateQueryParam("theme");m.default({type:"direct-link-theme",intervals:[[a,1]]});return[4,n.default.load()];case 1:e.sent();b=n.default.getSelectedModel();d=n.default.getModel(a);if(!d){c.default.send("direct-link-unknown-theme",{intervals:[[a,1]]})}if(b.id===d.id){return[2]}return[4,l.default.open("confirm-set-theme",{model:d},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true,"close-on-dimmer":false})];case 2:e.sent();return[4,n.default.setTheme(d,true)];case 3:e.sent();return[2]}})})};p.prototype._lazyCallSettingsManagerMethod=function(a){o.lazyMediatorSettingsManager().then(function(b){b[a]()})};p.prototype.handleOpenThemesPanel=function(){var a=this.request.query.themes;if(a===undefined){return}this._eliminateQueryParam("themes");this._lazyCallSettingsManagerMethod("onSettingsDockAppearanceOpen")};p.prototype.handleOpenCleanMaster=function(){var b,c,d,e,g,h;var i=this.request.query.cleanmaster;if(i===undefined){return}this._eliminateQueryParam("cleanmaster");if(i.length>0){var j=decodeURIComponent(i);var k=j.split(":"),n=k[0],o=k[1];m.default({type:"cleanmaster-query-action",i:(b={},b[n]=1,b)});if(f.CLEANMASTER_MODAL_ACTIONS_DISABLED){m.default({type:"cleanmaster-query-action-fail",i:(c={},c[n]=1,c["feature-disabled"]=1,c)});return false}if(!["remove","unsubscribe"].includes(n)){m.default({type:"cleanmaster-query-action-fail",i:(d={},d[n]=1,d["unknown-action"]=1,d)});return false}if(o===""){m.default({type:"cleanmaster-query-action-fail",i:(e={},e[n]=1,e["emails-empty"]=1,e)});return false}var p=o.split(",");var q=p.length;p=p.filter(function(b){return a.checkTextValidity(b).valid});if(p.length===0){m.default({type:"cleanmaster-query-action-fail",i:(g={},g[n]=1,g["filtered-emails-empty"]=1,g)});return false}l.default.open("cleanmaster-modal",{action:n,from:p},{});m.default({type:"cleanmaster-query-action-success",i:(h={},h[n]=1,h.validEmailsCount=p.length,h.initialEmailsCount=q,h)})}else{if(!f.SETTINGS_DOCK_CLEANMASTER_INLINE_DISABLED){this._lazyCallSettingsManagerMethod("onSettingsDockCleanmasterOpen")}else{this._lazyCallSettingsManagerMethod("onCleanmasterClick")}m.default({type:"cleanmaster-page_open",dwh:{from:"get_cleanmaster"}})}return true};p.prototype.handleOpenPulseSubscriptions=function(){var a=this.request.query.pulseSubscriptions;if(a===undefined){return}this._eliminateQueryParam("pulseSubscriptions");this._lazyCallSettingsManagerMethod("onSubscriptionsOpen");c.default.send("pulse_settings_open",{dwh:{from:"get_parameter"}})};p.prototype.handleQueryAction=function(){var a=this;var b={"open-news-subscriptions":function(){var b=f.FEED_SUBSCRIPTIONS;if(b){a._lazyCallSettingsManagerMethod("onSubscriptionsOpen")}return b},"open-metathreads-settings":function(){var b=!f.HIDE_METATHREADS;if(b){a._lazyCallSettingsManagerMethod("onSettingsMetathreadsOpen")}return b},"open-cleanmailbox":function(){var b=!f.SETTINGS_DOCK_HIDE_CLEANMAILBOX;if(b){a._lazyCallSettingsManagerMethod("onSettingsDockCleanmailboxOpen")}return b},"open-browser-notifications":function(){if(f.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED){a._lazyCallSettingsManagerMethod("onSettingsDockBrowserSettingsOpen")}return f.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED}};var c=this.request.query.action;if(b.hasOwnProperty(c)&&b[c]()){this._eliminateQueryParam("action")}};p.prototype.handleOpenComposeTemplate=function(){var a=this.request.query.compose_template;if(a===undefined){return}this._eliminateQueryParam("compose_template");k.default.openFromGetParameter(a)};p.prototype._eliminateQueryParam=function(a){var b=this.request.query[a];var c=Object.assign({},this.request.query);delete c[a];this.target.go(this.route.id,this.route.params,c);m.default({type:"query-check_"+a,intervals:[[b,1]]})};return p}();exports.default=p});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/error-to-json",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.errorToJSON=void 0;var a=["code","errno","syscall"];function b(b){if(!b||typeof b!=="object"){return b}if(typeof b.toJSON==="function"){return b.toJSON()}var c=__assign(__assign({},b),{name:b.name,message:b.message,stack:b.stack});for(var d=0,e=a;d<e.length;d++){var f=e[d];c[f]=b[f]}return c}exports.errorToJSON=b});define("service/white-portal/inline",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getWhitePortalConfig=void 0;function a(a){return a["default-themeId"]||"default"}function b(a){return a["white_portal_theme"]||"t6000"}function c(b,c){return b.hasOwnProperty("themeId")||c.themeId||a(b)}function d(b,d){return c(b,d)===a(b)}function e(){return/[?&]newreg/.test(window.location.search)}function f(a,f){var g=a.hasOwnProperty("white_portal_forced");var h=a.hasOwnProperty("white_portal_newreg");var i=a.hasOwnProperty("white_portal_available");var j=a.hasOwnProperty("white_portal_has_flag");var k=g||h||i;var l=false;var m;if(k&&!j&&d(a,f)){if(g){l=true;m="forced"}else if(h&&e()){l=true;m="newreg"}}var n=l||c(a,f)===b(a);return{insert:k,apply:l,load:n,applyReason:m}}exports.getWhitePortalConfig=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/white-portal/index",["require","exports","@mail/features","@mail/flags","@mail/xray","cfg","default-values","helpers/error-to-json","service/auth","service/themes","service/white-portal/inline"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.tryApplyWhitePortalTheme=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);function j(a){var b=function(){g.default.off("login",b);a()};g.default.on("login",b)}function k(){var g;var k=i.getWhitePortalConfig(a.default.list,d.default);if(k.apply){c.default.send(["wpt_apply"],{i:(g={},g["reason_"+k.applyReason]=1,g)});d.default.set("themeId",e.WHITE_PORTAL_THEME);j(function(){var a=new h.ThemeModel(e.WHITE_PORTAL_THEME,{},"");a.store().catch(function(a){c.default.send(["wpt_apply-error"],{i:{store:1},rlog:"octavius_wpt_experiment",rlog_message:f.errorToJSON(a)})});var d=b.default.get("white-portal");if(d){d.save({state:true}).catch(function(a){c.default.send(["wpt_apply-error"],{i:{flag:1},rlog:"octavius_wpt_experiment",rlog_message:f.errorToJSON(a)})})}})}}exports.tryApplyWhitePortalTheme=k});define("feast-tpl!app/feast-tpl!ui-block/application/application.html",["feast"],function(a){return a.smartParse('<div qa:id="application" style="{_this.getStyle()}">\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()"/>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.route.is(\'#attachment\')">\n\t\t\t<b:application-viewer/>\n\t\t</fn:when>\n\n\t\t<fn:when test="attrs.route.is(\'#attachment-temporary\')">\n\t\t\t<b:application-viewer\n\t\t\t\tattachment-temporary\n\t\t\t/>\n\t\t</fn:when>\n\n\t\t<fn:when test="attrs.route.is(\'#attachment-editor\')">\n\t\t\t<b:application-attachment-editor/>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<b:application-mail\n\t\t\t\tuse:mediator="layout-manager folders-navigation pony-mode"\n\t\t\t/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n\n\t<b:settings-dock\n\t\tuse:mediator="settings-manager layout-manager pony-mode themes-manager folders-actions todo-manager letters-actions"\n\t\tqa:id="settings-dock"\n\t/>\n\n\t<b:notify-stack\n\t\tref="notify-stack"\n\t\tid="notify-stack"\n\t\tfixed\n\t/>\n</div>\n',"app/feast-tpl!ui-block/application/application.html")});define("feast-tpl!ui-block/application/application.html",["feast-tpl!app/feast-tpl!ui-block/application/application.html"],function(a){return a});define("helpers/set-cookie",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setCookie=void 0;function a(a,b,c){if(c===void 0){c={}}var d=new Date;typeof c.expires=="number"&&d.setTime(d.getTime()+c.expires*24*60*60*1e3);b=b+"";document.cookie=a+"="+b+(typeof c.expires=="number"?"; expires="+d.toUTCString():"")+(c.path?"; path="+c.path:"")+(c.domain?"; domain="+c.domain:"")+(c.secure?"; secure":"")}exports.setCookie=a});define("feast-tpl!app/feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html",["feast"],function(a){return a.smartParse("<div>\n</div>\n","app/feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html")});define("feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html",["feast-tpl!app/feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html"],function(a){return a});define("mail/actions/AddAttachToCloud",function(require){"use strict";var a=require("Action");var b=require("RPC");var c=a.extend({prepare:function(a){return{folder:a.folder,ids:a.ids,need_real_filename:a.need_real_filename||false}},operation:function(a){return b.post("attaches/add/to-cloud",a)}});a.register("mail.AddAttachToCloud",c);c.version="0.1.0";return c});define("mail/actions/AddCloudStockToCloud",["RPC","Action"],function(a,b){"use strict";var c=b.extend({prepare:function(a){return{folder:a.folder,files:a.files}},operation:function(b){return a.post("cloud/attachment/save/to-cloud",b)}});b.register("mail.AddCloudStockToCloud",c);c.version="0.1.0";return c});define("mail/actions/CloudFolderAdd",function(require){"use strict";var a=require("Action");var b=require("RPC");var c=a.extend({prepare:function(a){return{add:a.add,storage:a.storage||"home"}},operation:function(a){return b.post("cloud/folder/add",a)}});a.register("mail.CloudFolderAdd",c);c.version="0.1.0";return c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/editors",["require","exports","default-values","helpers/encode","mail/actions/AddAttachToCloud","mail/actions/AddCloudStockToCloud","mail/actions/CloudFolderAdd","pilotjs","RPC","service/layer"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DEFAULT_FOLDER_CLOUD_NAME=void 0;c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i="/";exports.DEFAULT_FOLDER_CLOUD_NAME="Почтовые вложения";var j=Object.entries(a.VIEWER_EDITORS).reduce(function(a,b){var c=b[0],d=b[1];a[c]=__assign(__assign({},d),{supportedTypes:d.supportedTypes&&d.supportedTypes.split(","),id:c,priority:parseInt(d.priority,10)});return a},{});var k={all:j,createCloudFolder:function(){return e.default.execute({add:[{folder:i,name:exports.DEFAULT_FOLDER_CLOUD_NAME}]}).catch(function(a){var b=a.error;if(b.get("body.home.error")==="exists"){return Promise.resolve(b)}else if(b.get("status")==g.default.statuses.payment_required&&b.get("body.error")==="cloud_not_exists"){h.default.open("cloud-unavailable",{},{dimmer:true,compact:true,"close-on-dimmer":true,"close-on-esc":true,resolvable:true}).then(function(){window.close()},function(){window.close()})}else{return Promise.reject(null)}})},downloadToCloud:function(a,b,e){var f;if(b==="cloud_stock"){var g=e.split(":");f=d.default.execute({folder:"/Почтовые вложения",files:[{bundle_id:g[0],file_id:g[1]}]}).then(function(a){return Promise.resolve(a.result.get("body[0][0]"))},function(){return Promise.reject(null)})}else{f=c.default.execute({folder:"/Почтовые вложения",need_real_filename:false,ids:[a+";"+e]}).then(function(a){return Promise.resolve(a.result.get("body[0]"))},function(){return Promise.reject(null)})}return f},open:function(a,c){var d=this;var e=c.messageId,h=c.attachType,i=c.attachId;return this.createCloudFolder().then(function(){return d.downloadToCloud(e,h,i).catch(function(){return Promise.reject(null)})}).then(function(a){return g.default.token().then(function(b){return Promise.resolve({token:b,fileName:a})})}).then(function(c){var d=c.fileName,e=c.token;var h=f.default.queryString.stringify({"x-email":g.default.setup().email,token:e,from:"mail"});var i="https://cloud.mail.ru/"+a+"/edit/home"+b.safeEncodeURI(d)+"?"+h;location.assign(i)}).catch(function(){return Promise.reject("Не получилось открыть файл в редакторе")})}};exports.default=k});define("ui-block/application-attachment-editor/application-attachment-editor",["exports","feast","feast-tpl!./application-attachment-editor.html","service/editors","ui-block/headline/headline"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"application-attachment-editor",template:f.default,isolate:false,isolateEvents:false,viewer:null,blocks:{},didMount:function a(){h.default.hide();var b=this.get("route").params;var c=this.get("route").request.query;var d=b.message,e=b.id;var f=c.type,i=c.editor;if(!d||!e||!f||!i){console.error("Необходимы все параметры");return}g.default.open(i,{messageId:d,attachType:f,attachId:e})}})});define("feast-tpl!app/feast-tpl!ui-block/application-viewer/application-viewer.html",["feast"],function(a){return a.smartParse('<div>\n\t<div ref="attachment-viewer" qa:id="viewer">\n\t\t\x3c!-- renderTo placeholder --\x3e\n\t</div>\n\t<div bem:elem="notify-wrapper">\n\t\t<b:notify-stack ref="notify-stack" id="notify-stack" fixed/>\n\t</div>\n\t<b:counters/>\n</div>\n',"app/feast-tpl!ui-block/application-viewer/application-viewer.html")});define("feast-tpl!ui-block/application-viewer/application-viewer.html",["feast-tpl!app/feast-tpl!ui-block/application-viewer/application-viewer.html"],function(a){return a});define("ui-block/application-viewer/application-viewer",["exports","feast","feast-tpl!./application-viewer.html","helpers/encode-uri-component","helpers/viewport","mediator/attachments-manager","service/auth","service/layer","service/notify","service/radars/index","ui-block/counters/counters","ui-block/headline/headline","ui-block/layer-window/layer-window","ui-block/notify-stack/notify-stack"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(a);var o=z(b);var p=z(c);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}var A=function a(b){(0,u.default)(["viewer-app"].concat(b))};exports.default=n.default.Block.extend({name:"application-viewer",template:o.default,isolate:false,isolateEvents:false,viewer:null,blocks:{"notify-stack":y.default,counters:v.default},constructor:function a(){n.default.Block.prototype.constructor.apply(this,arguments);(0,d.toggleViewport)("")},didMount:function a(){var b=this;require(["ajs","feast-mailru-toolkit"],function(a,c){var d=c.loadToolkit;d(function(a){a.lang=window.lang;require(["ui-block/viewer/viewer"],function(a){var c=a.default;if(b.destroyed||b.zombie){return}w.default.hide();var d=void 0;var e=void 0;var f=void 0;var g=void 0;var h=b.is("attachment-temporary");if(h){var i=b.get("attachmentTemporary");d=i.list;g=i.attachment;e=b.get("route").params.message}else{f=b.get("message");g=b.get("attachment");d=f.get("attaches.list");e=f.id}if(!g){A(["error","no-attachment"]);if(h&&d&&d.length){var j=b.get("router");var k={"x-email":r.default.user.getEmail()};A(["error","no-attachment","find-first"]);window.location.href=j.getUrl("#attachment-temporary",{message:e,id:(0,p.default)(d[0].id),path:""},k)}A(["show","empty-viewer"]);g=null}var l=new c({message:f,messageId:e,attachment:g,models:d,modal:true,router:b.get("router"),temporary:b.is("attachment-temporary")}).renderTo(b.refs["attachment-viewer"]);q.default.registerComponent("viewer",c);q.default.register(l)})})});s.default.setup(x.default);t.default.setup(this.ids["notify-stack"])}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/application/application",["require","exports","default-values","feast","feast-tpl!./application.html","helpers/set-cookie","service/notify","ui-block/application-attachment-editor/application-attachment-editor","ui-block/application-mail/application-mail","ui-block/application-viewer/application-viewer","ui-block/notify-stack/notify-stack","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.default=b.default.Block.extend({name:"application",template:c.default,performanceTrace:"track",blocks:{"application-mail":g.default,"application-viewer":h.default,"application-attachment-editor":f.default,"notify-stack":i.default},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments);this.debouncedUpdateStyle=j.default.debounce(this.updateStyle,a.RESIZE_UPDATE_DEBOUNCE_TIME,this);if(a.TOUCH_MODE){window.addEventListener("resize",this.debouncedUpdateStyle)}d.setCookie("gmt",-(new Date).getTimezoneOffset()/60,{path:"/"})},didMount:function(){e.default.setup(this.ids["notify-stack"])},didUnmount:function(){window.removeEventListener("resize",this.debouncedUpdateStyle)},updateStyle:function(){this.el.style=this.getStyle()},useNewToolbar:function(){return a.NEW_TOOLBAR},getStyle:function(){if(a.TOUCH_MODE){return"height: calc("+window.innerHeight+"px - "+a.HEADLINE_HEIGHT+");"}return"height: calc(100vh - "+a.HEADLINE_HEIGHT+");"}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("flags.setup",["require","exports","@mail/flags","default-values","RPC"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setupFlagsAutosync=void 0;a=__importDefault(a);c=__importDefault(c);function d(d){if(b.FLAGS_AUTOSYNC){a.default.setAutoSync(true,c.default.setup("email"),b.FLAGS_AUTOSYNC_DEBOUNCE);d.on("route-end",function(){a.default.sync()});document.addEventListener("visibilitychange",function(){a.default.sync()})}}exports.setupFlagsAutosync=d});define("init/post-load",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.afterLoad=void 0;function a(){userKeeper.timeEnd("app-require",{score:"app:init"});window.sendLoadlogRadar("loadflow_step-25","app required");_timers.init_app+=_now();window.app.ready(function(){userKeeper.timeEnd("app-ready",{score:"app:init"});userKeeper.timeEnd("page-app-ready",{score:[5e3,1e4,15e3]});userKeeper.timeEnd("biz-app-ready",{score:"app:ready"})});app.ready(window.__hideBootscreen__);app.on("login-page",window.__hideBootscreen__);_timers.data=-_now()}exports.afterLoad=a});define("access",["exports","service/auth"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.authorized=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(){return b.default.login()}});define("route/attachment",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:"/attach/:message?/:id?/:path?"}});define("route/attachment-editor",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:"/attachment/editor/:message?/:id?"}});define("route/attachment-temporary",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:"/attachment/temporary/:message?/:id?/:path?"}});define("route/base-route",["exports","mail/Folder","mail/Message","mail/Thread","utils/util","../default-values"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=n;var f=j(a);var g=j(b);var h=j(c);var i=j(d);function j(a){return a&&a.__esModule?a:{default:a}}var k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var l={};var m={};Object.keys(f.default).forEach(function(a){var b=a.slice(5).toLowerCase();var c=f.default[b.toUpperCase()];if(a.startsWith("TYPE_")&&c>=0){l[b]=c;m[c]=b;if(c===f.default.SCHOOL){l["study"]=c;m[c]="study"}}});function n(a,b){return i.default.extend({url:{pattern:a,params:{folder:{default:f.default.INBOX,decode:function a(b){return l[b]||parseInt(b,10)||f.default.INBOX}}},toUrl:function a(b,c,d){if(e.URL_EXTRA_PARAMS){c=k({},c,e.URL_EXTRA_PARAMS)}b=b||{};var i=b.folder;var j=b.letter;if(i===void 0){if(b instanceof f.default){i=b.is("system")?b.get("type"):b.id}else if(b instanceof g.default){i=b.get("folder");if(b instanceof h.default){j=b.id}else if(b.meta("thread_id")){j=b.meta("thread_id")}else if(b.id){j="0:"+b.id+":0"}var l=f.default.all.get(i);if(l){i=l.is("system")?l.get("type"):l.id}}}return d({folder:m[i||f.default.INBOX]||i,letter:j||"letter-not-found",part:b.part||"",id:b.id||""},c)}}},b)}});define("route/letters",["exports","route/base-route","route/utils/filter-query"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var g=(0,c.default)("/:folder?");var h=g.url.toUrl;g.url.toUrl=function(a,b,c){if(a&&a.preserveFilters){return h(a,f({},b,d.default.getQuery(a.preserveSortings)),c)}return h(a,b,c)};g.filterQuery=d.default;g.aliases={compose:{pattern:"/compose/:composeid?/:composeaction?"},contacts:{pattern:"/contacts"}};exports.default=g});define("route/read-letter",["exports","route/base-route","route/utils/filter-query"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=(0,c.default)("/:folder/:letter/:part?");f.filterQuery=d.default;exports.default=f});define("route/search",["exports","route/base-route"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d=(0,b.default)("/search");exports.default=d});define("route/search-letter",["exports","route/base-route"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d=(0,b.default)("/search/:folder/:letter/:id");exports.default=d});define("route/utils/letter-id-to-url",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;var a=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function b(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var d=b.match(/(\d+);(.*)/);if(d){var e=a(d,3),f=e[1],g=e[2];return"/"+c+"/0:"+f+":"+c+"/"+g+"/"}else{return"/"+c+"/0:"+b+":"+c+"/"}}});define("route/septima/cgibin",["exports","pilotjs","../utils/letter-id-to-url"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={url:{pattern:"/cgi-bin/:method"},redirectUrl:function a(b,e){var f=b.method;var g=e.id;var a="/";if(f==="readmsg"&&g){delete e.id;var h=(0,d.default)(g);var i=c.default.queryString.stringify(e);a=h+"?"+i}return a}}});define("route/septima/msglist",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:{pattern:"/messages/:folderAlias?/:folderId?"},redirectUrl:function a(b){var c=b.folderAlias,d=b.folderId;var a="/";if(c&&c==="folder"&&d){a="/"+d+"/"}else if(c&&c!=="folder"){a="/"+c+"/"}return a}}});define("route/septima/readmsg",["exports","../utils/letter-id-to-url"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={url:{pattern:"/message/:letterId",toUrl:function a(b){var c=b.letterId,d=b.mod,e=b.folderId,f=e===undefined?0:e;return"/message/"+c+"/"+(d?d+"/":"")+("?folder_id="+encodeURIComponent(String(f)))}},redirectUrl:function a(c,d){var e=c.letterId;var f=d.folder_id,g=f===undefined?0:f;var a="/";if(e){a=(0,b.default)(e,g)}return a}}});define("route/septima/thread",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:{pattern:"/thread/:threadId"},redirectUrl:function a(b){var c=b.threadId;var a="/";if(c){a="/inbox/"+c+"/"}return a}}});define("sitemap",["exports","./access","route/attachment","route/attachment-editor","route/attachment-temporary","route/letters","route/read-letter","route/search","route/search-letter","route/septima/cgibin","route/septima/msglist","route/septima/readmsg","route/septima/thread","data-source/index"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(b);var o=z(c);var p=z(d);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}exports.default={access:a.authorized,model:y.default.getLoader(),"#!septimaCgiBin":u.default,"#!septimaMsglist":v.default,"#!septimaReadmsg":w.default,"#!septimaThread":x.default,"#search":s.default,"#search-letter":t.default,"#attachment":n.default,"#attachment-temporary":p.default,"#attachment-editor":o.default,"#letters":q.default,"#read-letter":r.default}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/flags",["require","exports","@mail/flags"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);a.default.import(window.sotaConfig.flags)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/initial-api",["require","exports","@mail/flags","cfg","cfgUser","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);c.default.get("api").forEach(function(c){d.default.mock.once(c.method,c.data);if(c.method==="/api/v1/helpers"){a.default.add(c.data&&c.data.body)}if(c.method==="/api/v1/user/short"){b.default.themeId=c.data.body.theme}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/feast",["require","exports","feast","feast-extension/qa"],function(require,exports,a,b){"use strict";var c,d;Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);a.default.set({renderRefAttributes:false,useTryCatch:!((c=window.features)===null||c===void 0?void 0:c.has("disable-feast-try-catch"))});if((d=window.__cfgOptions)===null||d===void 0?void 0:d.qa){b.default(a.default)}else{a.default.vdom.tags["@qa:id"]=function(){return false};a.default.vdom.tags["@qa:state"]=function(){return false}}});!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define("features/dist/features",["exports"],b):b((a="undefined"!=typeof globalThis?globalThis:a||self)["@mail/features"]={})}(this,function(a){"use strict";var b,c=/([\w.-]+)(?::([^\s]+))?/i,d=/^-/,e=/^([\d.]+)([smdwh]$)/,f=/\${[\w_]+}/g,g=/\s+/;a.Source=void 0,(b=a.Source||(a.Source={})).GetParam="getParam",b.Omicron="omicron",b.Onlineconf="onlineconf",b.Slot="slot",b.Manual="manual";var h=function(){return"-"+Math.random().toString(36).substr(2,5)};function i(a){return a&&"object"==typeof a}var j={s:function(a){return a},m:function(a){return this.s(60*a)},h:function(a){return this.m(60*a)},d:function(a){return this.h(24*a)},w:function(a){return this.d(7*a)}},k=function(a){return String(null!=a?a:"")},l=function(a){return null==a?"":encodeURIComponent(String(a))},m=function(a){return"Infinity"===a?1/0:"-Infinity"===a?-1/0:parseInt(a,10)},n=function(a){return null==a?NaN:(a=String(a).replace(",","."),parseFloat(a))},o=function(a){return/^(true|T|1)$/i.test(String(a))},p=function(a){var b,c=e.exec(a);if(null!==c){var d=c[2],f=c[1];return(null===(b=j[d])||void 0===b?void 0:b.call(j,parseFloat(f)))||0}return parseFloat(a)||0},q=function(a,b){if(null==a)return b;if("object"==typeof a)return a;if("string"==typeof a)try{return a.startsWith('"')&&(a=a.substring(1,a.length-1)),JSON.parse(a)}catch(a){}return b},r=function(a){return function(b,c){if(a=a||{},!b)return c;var d=document.createElement("a");return d.href=b,"https:"===d.protocol||"http:"===d.protocol?a.regexp?a.regexp.test(b)?b:c:b:c}},s=function(a){return function(b,c){return a.indexOf(b)>-1?b:c}},t=function(a){try{return new RegExp(a||"")}catch(a){return null}};function u(a){return a.replace(/\\\$/g,"$$").replace(/\\{/g,"{")}function v(a,b,c){return function(d){var e=d[a];return b!==k&&b!==l?c:null==e?"":b(e)}}function w(a,b,c){if("string"!=typeof a)return function(){return c};var d,e,g,h=[],j=0;do{if((d=f.exec(a))&&"string"==typeof d[0]){if("\\"===a.slice(d.index-1,d.index))e=a.slice(j,d.index-1),h.push(u(e)),h.push(a.slice(d.index,d.index+d[0].length));else{e=a.slice(j,d.index),h.push(u(e));var k=d[0].slice(2,d[0].length-1);g=v(k,b[k],d[0]),h.push(g)}j=d.index+d[0].length}}while(null!==d);return e=a.slice(j),h.push(u(e)),function(a){return function(b){b=i(b)?b:{};for(var c=[],d=0,e=a;d<e.length;d++){var f=e[d];if("function"==typeof f)try{c.push(f(b))}catch(a){}else c.push(f)}return c.join("")}}(h)}var x=function(){var b=this;this.featuresToSalt=[],this.list={},this.filters={},this.rearrangeGroups=function(a,b,c,d){var e=a[b].hasOwnProperty("children"),f=a[b].hasOwnProperty("depends");function g(){return a.splice.apply(a,[0,0].concat(a.splice(c,d)))}return e&&g||f&&a.splice.apply(a,[c+1,0].concat(a.splice(b,1)))&&g()||a.splice.apply(a,[0,0].concat(a.splice(b,1))),a},this.extend=function(a,c){for(var d in a){var e=a[d];1!=e&&0!=c||(e={state:!!e}),e.name=e.name||d,e=Object.assign(b.list[d]||{},a[d]),null==c||c(e,d,e.source),b.list[d]=Object.assign(b.list[d]||{},a[d])}},this.import=function(c,d){var e,f,g;if(Object.values(a.Source).includes(d))if("string"!=typeof c)for(var h in c){var i={state:!0,name:h};i.data=c[h];var j=null===(g=b.get(h))||void 0===g?void 0:g.source;j?j.unshift(d):j=[d],i.source=j;var k={};k[h]=i,b.extend(k)}else b.importFromString(c,d);else null===(f=null===(e=null===window||void 0===window?void 0:window.console)||void 0===e?void 0:e.error)||void 0===f||f.call(e,"Source "+d+" not supported")},this.importFromString=function(a,e){a.trim().split(g).forEach(function(a){var f=a.match(c);if(f){var g=f[1],i=b.featuresToSalt.includes(g)?""+g+h():g,j=f[2],k=!0;d.test(i)&&(k=!1,i=i.replace(d,""));var l=b.get(i);if(l)return l.data=j||null,l.dataArray=[].concat(l.dataArray,j),l.state=k,void l.source.unshift(e);var m={};m[i]={state:k,data:j||null,name:g,dataArray:[j||null],source:[e]},b.extend(m)}})},this.isAvailable=function(c,d){var e,f=b.get(c);if((null===(e=null==f?void 0:f.source)||void 0===e?void 0:e.includes(a.Source.Omicron))&&!1===(null==f?void 0:f.data))return!1;if(null==f?void 0:f.depends)for(var g=f.depends.length;g--;)if(!b.isAvailable(f.depends[g],!0))return!1;return!!f&&(!d||f.state||f.menu)},this.has=function(a){return b.isAvailable(a,!0)},this.get=function(a){return b.featuresToSalt.includes(a)&&(a+=h()),b.list[a]},this.getSource=function(a){var c;return null===(c=b.get(a))||void 0===c?void 0:c.source},this.getDataOrDefault=function(a,c){var d;if(!b.has(a))return c;var e=null===(d=b.get(a))||void 0===d?void 0:d.data;return null!==e?e:c},this.getAs=function(a,c,d){var e;if(!b.has(c))return a(d,null);var f=a(null===(e=b.get(c))||void 0===e?void 0:e.data,null);return null!==f?f:a(d,null)},this.getAsString=function(a,c){return b.getAs(k,a,c)},this.getAsBoolean=function(a,c){return b.getAs(o,a,c)},this.getAsArray=function(a,c,d){if(void 0===c&&(c=[]),"string"!=typeof d&&(d=","),!b.has(a))return c;var e=(b.get(a)||{}).data;if(null==e)return[];if("object"==typeof e){var f=Object.keys(e).map(function(a){return parseInt(a,10)});return f.some(isNaN)||f.some(function(a,b){return a!==b})?c:Object.values(e)}return String(e).split(d)},this.getAsTypedArray=function(a,c,d,e){if(void 0===d&&(d=[]),!b.has(a))return d;var f=b.getAsArray(a,d,e);if("function"==typeof c)return f.map(function(a){return c(a)});for(var g=[],h=0;h<c.length;h++)g.push(c[h](f[h]));return g},this.getAsInt=function(a,c){return b.getAs(m,a,c)},this.getAsFloat=function(a,c){return b.getAs(n,a,c)},this.getAsJSON=function(a,c){return b.getAs(q,a,c)},this.getAsEnum=function(a,c,d){var e,f;switch(!0){case"function"==typeof c:e=c;break;case i(f=c)&&"number"==typeof f.length:e=s(c);break;default:e=s([])}return b.getAs(e,a,d)},this.getAsTemplate=function(a,c,d){try{return w(b.getAsString(a,d),c,d)}catch(a){return setTimeout(function(){throw a},1),function(){return d}}},this.getAsURLTemplate=function(a,c,d,e,f){var g,h;try{var i=b.getAsString(a,d);h=w(d||"",c,f),g=i===d?h:w(i,c,f)}catch(a){return setTimeout(function(){throw a},1),function(){return f}}var j=r(e);return function(a){var b=g(a);return j(b,f)===f?(b=h(a),j(b,f)):b}},this.getDuration=function(a,c){return b.getAsDuration(a,c)},this.getAsDuration=function(a,c){return b.getAs(p,a,c||0)},this.getAsURL=function(a,c,d){return b.getAs(r(d),a,c)},this.getAsRegExp=function(a,c){return b.getAs(t,a,c)},this.setFeaturesToSalt=function(a){b.featuresToSalt=a},this.filter=function(a,c){var d,e=[],f=b.list;for(var g in"string"==typeof a&&(a=b.filters[a]||function(){return!1}),f)d=f[g],a&&!a.call(c,d,g)||e.push(d);return e},this.sortGroups=function(a,c){for(var d,e=0,f=0,g=0,h=a.length;e<h;){if(a[e].hasOwnProperty("children")&&(g=e,d=a[e].children.length+1),a[e][c]){if(!(f=e)){e++;continue}b.rearrangeGroups(a,f,g,d)}e++}return a},this.use=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=b.get(a);return!(!b.has(a)||!(null==e?void 0:e.use)||(e.use.apply(e,[e].concat([].slice.call(c,1))),0))},this.String=k,this.URLString=l,this.Int=m,this.Float=n,this.Boolean=o,this.Duration=p,this.JSON=q,this.URL=r,this.Enum=s},y=new x;a.Features=x,a.default=y,Object.defineProperty(a,"__esModule",{value:!0})});define("features",["features/dist/features"],function(a){return a});define("service/captcha",["exports","Emitter","RPC","service/layer","service/radars/index"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var j=void 0;var k=function a(b){j=null;return b};var l={_openPopup:function a(b){if(j){return j}j=g.default.open("captcha",{"captcha-error":b},{dimmer:true,compact:true,resolvable:true}).then(k,k);this.emit("open-captcha-popup");return j},retryUntilCaptchaSuccess:function a(b){var c=this;return new Promise(function(a,d){c.tryRequestWithCaptcha(b,a,d)}).then(function(a){(0,h.default)("captcha_enter_success");return a},function(a){(0,h.default)("captcha_enter_error");return Promise.reject(a)})},tryRequestWithCaptcha:function a(b,c,d){var e=this;var f=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{error:false,showCaptcha:false,retries:0},g=f.error,i=f.showCaptcha,j=f.retries;var k=i?this._openPopup(g):Promise.resolve({});k.then(function(a){if(!a){d({body:"captcha-closed"});return}var f=b(a);f.then(c,function(a){var f=e._isCaptchaError(a);var g=e._isCaptcha(a)||f;if(g){e.tryRequestWithCaptcha(b,c,d,{error:f,showCaptcha:true,retries:j+1});(0,h.default)({type:"try_enter_captcha",intervals:[["retries",j]]})}else{d(a)}})},function(a){d(a)})},_isCaptcha:function a(b){var c=b.status,d=b.body;return c===+f.default.statuses.many_requests&&d==="possible_bad_guy"},_isCaptchaError:function a(b){var c=b.status,d=b.body;return c===+f.default.statuses.invalid&&!!d.capcha}};e.default.apply(l);exports.default=l});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/marusia-manager",["require","exports","default-values","feast","ui-block/marusia-read-letter-button/marusia-read-letter-button","../lazy.modules"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MarusiaManager=void 0;b=__importDefault(b);c=__importDefault(c);var e=function(b){__extends(e,b);function e(){return b!==null&&b.apply(this,arguments)||this}e.prototype.getComponentsSpec=function(){return{"marusia-read-letter-button":{class:c.default,events:["marusia:read:letter:click"]},letter:{lazy:d.lazyUILetter,attrs:{"marusia-portal-enabled":function(a){return a.isMarusiaInPortalEnabled()}}},"themes-widget-souzmultfilm":{lazy:d.lazyUIThemesWidgetSouzmultfilm,events:["marusia:start:command","marusia:open"],attrs:{"marusia-portal-enabled":function(a){return a.isMarusiaInPortalEnabled()}}}}};e.prototype.handleEvent=function(a){var b=a.type,c=a.details,d=c===void 0?{}:c;if(b==="marusia:read:letter:click"){return this.readLetter(d.model)}if(b==="marusia:start:command"){return this.startWithCommand(d.command)}if(b==="marusia:open"){return this.openMarusia(d.getParams)}};e.prototype.isMarusiaInPortalEnabled=function(){var b,c;return!a.DISABLE_MARUSIA_IN_PORTAL&&!!((c=(b=window.__PH)===null||b===void 0?void 0:b.isMarusiaMenuEnabled)===null||c===void 0?void 0:c.call(b))};e.prototype.openMarusia=function(a){var b,c;if(a===void 0){a={}}(c=(b=window.__PH)===null||b===void 0?void 0:b.marusiaMenu)===null||c===void 0?void 0:c.show(a)};e.prototype.subGetParams=function(b){return __assign(__assign({},a.MARUSIA_SKILLSERVER_TEST&&{skillserver_type:"mailskill"}),b&&{timestamp:Date.now()})};e.prototype.readLetter=function(a){var b=a.get("id");var c=__assign({start_with_event:"read_single_message_event",intent_data:JSON.stringify({uidl:b})},this.subGetParams(true));this.openMarusia(c)};e.prototype.mailCheckStatus=function(){var a=__assign({start_with_event:"mail_check_status_event"},this.subGetParams(true));this.openMarusia(a)};e.prototype.startWithCommand=function(a){var b=__assign({start_with_command:a},this.subGetParams(true));this.openMarusia(b)};return e}(b.default.Mediator);exports.MarusiaManager=e;exports.default=b.default.Mediator.createFromClass("marusia-manager",e)});define("octavius-public/sw-box/get",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function a(){return window.app.model.swBox}exports.default=a});define("octavius-public/news/open-subscription",["require","exports","../../lazy.modules"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(){a.lazyMediatorSettingsManager().then(function(a){a.onSubscriptionsOpen()})}exports.default=b});define("octavius-public/metathreads/open-metathreads",["require","exports","../../lazy.modules"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(){a.lazyMediatorSettingsManager().then(function(a){a.onSettingsMetathreadsOpen()})}exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/cleanmailbox/open-cleanmailbox",["require","exports","mediator/settings-manager"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);function b(){return a.default.onSettingsDockCleanmailboxOpen()}exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/browsersettings/open-browsersettings",["require","exports","mediator/settings-manager"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=function(){return a.default.onSettingsDockBrowserSettingsOpen()}});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("octavius-public/service/storage",["require","exports","service/storage"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createSessionStorage=exports.createScopeStorage=void 0;a=__importStar(a);Object.defineProperty(exports,"createScopeStorage",{enumerable:true,get:function(){return a.createScopeStorage}});Object.defineProperty(exports,"createSessionStorage",{enumerable:true,get:function(){return a.createSessionStorage}});exports.default=a.default});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/unsubscribe/unsubscribe-helper",["require","exports","mediator/thread-manager","mediator/unsubscribe-actions"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=function(){function c(){}c.prototype.getCurrentLetterId=function(){return a.default.getModel().id};c.prototype.getCurrentLetterSenderEmail=function(){try{var b=a.default.getModel();var c=b.get("correspondents.from.0");return(c===null||c===void 0?void 0:c.email)||""}catch(a){return""}};c.prototype.isCurrentSenderUnread=function(){try{var a=b.default.get("router.model.unsubscribeList").list;return a.includes(this.getCurrentLetterSenderEmail())}catch(a){return false}};return c}();var d=new c;exports.default=d});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("defines-externals",["require","exports","helpers/define-utils","@mail/flags","@mail/radars-decorator/dist/index-react","cfg","cfgUser","config","features","mail/actions/ContactSuggests","mail/Attachment","mail/Folder","mail/SharedMailbox","mail/UserSecurity","request","RPC","service/auth","mail/User","ui-block/noads-button/noads-button","default-values","service/compose","service/notify","service/promo","service/mailbox/loader","service/captcha","service/layer","service/cloud","mediator/folders-actions","mediator/letters-selection","mediator/layout-manager","mediator/settings-manager","mediator/addressbook-manager","mediator/marusia-manager","data-source/index","helpers/rb","helpers/data-source-dispatch","octavius-public/sw-box/get","octavius-public/news/open-subscription","octavius-public/metathreads/open-metathreads","octavius-public/cleanmailbox/open-cleanmailbox","octavius-public/browsersettings/open-browsersettings","octavius-public/service/storage","octavius-public/unsubscribe/unsubscribe-helper","Transaction","mail/actions/MoveTo","mail/actions/MoveToAll","RPCModel"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importStar(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importStar(q);r=__importStar(r);s=__importStar(s);t=__importStar(t);u=__importStar(u);v=__importStar(v);w=__importStar(w);x=__importStar(x);y=__importStar(y);z=__importStar(z);A=__importStar(A);B=__importStar(B);C=__importStar(C);D=__importStar(D);E=__importStar(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importStar(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);var T={request:m.default,RPC:n.default,config:f.default,cfg:d.default,features:g.default,"@mail/features":g.default,flags:b.default,"@mail/flags":b.default,cfgUser:e.default,"service/auth":o.default,"mail/Attachment":i.default,"mail/Folder":j.default,"mail/SharedMailbox":k.default,"mail/UserSecurity":l.default,"mail/actions/ContactSuggests":h.default,"@mail/radars-decorator/dist/index-react":c,"mail/User":p.default,"ui-block/noads-button/noads-button":q,"default-values":r,"service/compose":s,"service/notify":t,"service/promo":u,"service/mailbox/loader":v,"service/captcha":w,"service/layer":x,"service/cloud":y,"mediator/folders-actions":z,"mediator/letters-selection":A,"mediator/layout-manager":B,"mediator/settings-manager":C,"mediator/addressbook-manager":D,"mediator/marusia-manager":E,"data-source/index":F.default,"helpers/rb":G.default,"helpers/data-source-dispatch":H.default,"octavius-public/sw-box/get":I.default,"octavius-public/news/open-subscription":J.default,"octavius-public/metathreads/open-metathreads":K.default,"octavius-public/cleanmailbox/open-cleanmailbox":L.default,"octavius-public/browsersettings/open-browsersettings":M.default,"octavius-public/service/storage":N,"octavius-public/unsubscribe/unsubscribe-helper":O.default,Transaction:P.default,"mail/actions/MoveTo":Q.default,"mail/actions/MoveToAll":R.default,RPCModel:S.default};window.__definesExternals=T;Object.entries(T).forEach(function(b){var c=b[0],d=b[1];a.defineExternalForSyncUse(c,d)})});define("app-init",["./init/i18n","./init/flags","./init/initial-api","./init/feast","./defines-externals"],function(a){"use strict";var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/helpers/opener",["require","exports","helpers/opener"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=a.default});define("octavius-public/sw-box/hasSWBoxTag",["require","exports","@mail/sw-box"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(b){return a.hasServiceWorkerTag(b)}exports.default=b});define("octavius-public/push-manager/get",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function a(){return window.app.model.pushManager}exports.default=a});define("helpers/date-helper",["require","exports","feast-mod/letter-date"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DateHelper=exports.DateFormat=void 0;var b;(function(a){a[a["DayMonthYear"]=0]="DayMonthYear";a[a["DayMonthYearFull"]=1]="DayMonthYearFull"})(b=exports.DateFormat||(exports.DateFormat={}));function c(a,b){var c=String(a);if(typeof b==="number"){if(c.length>b){return c.slice(Math.max(0,c.length-b))}return"0".repeat(b-c.length)+c}return c}var d=function(){function d(a){if(a&&typeof a==="object"){this._date=a}else{this._date=new Date(a)}}d.fromServerDate=function(b){var c;switch(typeof b){case"number":c=new Date(b*1e3);break;case"string":c=new Date(b);break;case"object":c=b;break}var e=new Date(a.getCorrectedTimestampMS(c.getTime()));return new d(e)};d.fromClientDate=function(a){return new d(a)};d.getDaysFromMSeconds=function(a){return Math.ceil(a/1e3/60/60/24)};d.prototype.getClientDate=function(){return this._date};d.prototype.getFormattedDate=function(a){var d=this._date;switch(a){case b.DayMonthYear:return c(d.getDate(),2)+"."+c(d.getMonth()+1,2)+"."+c(d.getFullYear(),2);case b.DayMonthYearFull:return c(d.getDate(),2)+"."+c(d.getMonth()+1,2)+"."+c(d.getFullYear())}};return d}();exports.DateHelper=d});define("octavius-public/helpers/date-helper",["require","exports","helpers/date-helper"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DateFormat=exports.DateHelper=void 0;Object.defineProperty(exports,"DateFormat",{enumerable:true,get:function(){return a.DateFormat}});Object.defineProperty(exports,"DateHelper",{enumerable:true,get:function(){return a.DateHelper}})});define("octavius-public/service/vkMessengerLoader",["require","exports","service/vkMessengerLoader"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.vkMessengerLoader=void 0;exports.vkMessengerLoader=a.vkMessengerLoader});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/service/compose-template",["require","exports","service/compose-template"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=a.default});define("octavius-public/index",["require","exports","octavius-public/helpers/opener","octavius-public/sw-box/get","octavius-public/sw-box/hasSWBoxTag","octavius-public/push-manager/get","octavius-public/news/open-subscription","octavius-public/metathreads/open-metathreads","octavius-public/helpers/date-helper","octavius-public/service/vkMessengerLoader","octavius-public/cleanmailbox/open-cleanmailbox","octavius-public/browsersettings/open-browsersettings","octavius-public/service/storage","octavius-public/service/compose-template","octavius-public/unsubscribe/unsubscribe-helper"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("app",["exports","./init/i18n","@mail/features","@mail/flags","@mail/radars-decorator","@mail/radars-decorator/dist/index-react","@mail/xray","@mail-core/dashboard","boot/after-ready","boot/headline","boot/mediators","boot/pre-init","boot/promo","boot/release-detect","boot/router/listener","boot/router/user-timings","cfg","data-source/index","default-values","helpers/headless-counter","logger","mediator/layout-manager","mediator/themes-manager","pilotjs","request","RPC","service/adv/index","service/jssdk-config/setupMailboxLimits","service/layer","service/page-lifecycle","service/query-checker","service/radars/index","service/smokescreen","service/themes.setup","service/white-portal/index","ui-block/application/application","ui-block/layer-window/layer-window","./data-source/actions","./flags.setup","./helpers/define-utils","./helpers/lazy","./init/post-load","./setup","./sitemap","./app-init","mrg-i18n-utils","octavius-public/index"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var R=pa(a);var S=pa(b);var T=pa(c);var U=pa(d);var V=pa(f);var W=pa(p);var X=pa(q);var Y=pa(t);var Z=pa(u);var _=pa(v);var aa=pa(w);var ba=pa(x);var ca=pa(y);var da=pa(z);var ea=pa(A);var fa=pa(B);var ga=pa(C);var ha=pa(D);var ia=pa(E);var ja=pa(F);var ka=pa(G);var la=pa(I);var ma=pa(J);var na=pa(P);var oa=pa(Q);function pa(a){return a&&a.__esModule?a:{default:a}}__webpack_public_path__=window.octaviusWebpackPublicPath;g.userKeeper.timeEnd("biz-app-load",{score:"app:load"});g.userKeeper.time("biz-app-init");(0,s.sendHeadCheckRadar)("onload");(0,k.preInit)();window.define("flags",function(){return T.default});var qa=function a(){return window["app-canvas"][0]||window["app-canvas"]};var ra=aa.default.create(oa.default);var sa=["#attachment","#attachment-temporary","#attachment-editor"];g.userKeeper.group("app-setup-env",function(){Z.default.register((0,i.getHeadline)());fa.default.setup(ma.default);(0,l.initPromo)(X.default);_.default.register(ka.default.themes);(0,H.tryApplyWhitePortalTheme)();(0,ea.default)()});g.userKeeper.time("app-setup-router");ja.default.init(ra,r.LAZY_SMOKE_SCREEN_INIT);ga.default.init(ra);ra.appSetup=na.default;var ta=function a(b){b.register(ra);b.register(X.default)};(0,j.eachMediators)(ta);ka.default.applyUserTheme(ra.activeUrl.query);(0,o.initUserTimingsRouter)({request:ba.default,app:ra});ra.on("beforeroute",function(a){var b=a.target;var c=b.activeRoute;var d=b.activeRequest;var e=["on_route",c.id.slice(1)];window.sendLoadlogRadar("loadflow_step-20","beforeroute"+e.join(" "));if(c.id.match("#!septima")){var f=void 0;try{f=c.redirectUrl(d.params,d.query);if(!f.match("\\?")&&d.search){f+=d.search}}catch(a){f="/"}window.sendLoadlogRadar("loadflow_step-20","Septima redirect "+f);d.redirectTo(f)}var g=null;if(c.is("#read-letter")){var h=ra.activeRequest||{};var i=h.params||{};var j=i.folder,k=i.letter;var l=ra.model||{};var m=l.letters;if(m){var n="";var o=false;var p=m.find(function(a){return a.id===k});if(p){var q=p.attributes||{};var r=q.correspondents||{};n=(r.from||[]).map(function(a){return a.email}).filter(Boolean).join(",");var s=q.flags;o=!!s.newsletter}g={folder_id:j,letter_id:k,send_email:n,newsletter:o}}}(0,ia.default)({chain:e,data:d.params,dwh:g})});ra.on("routeend",function(a){var b=a.target;var c=b.activeRoute;var d=b.activeRequest;var e=["on_routeend",c.id.slice(1)];window.sendLoadlogRadar("loadflow_step-20","routeend"+e.join(" "));(0,ia.default)({chain:e,data:d.params});if(d.query){var f=new ha.default(b);f.handleEnableOctavius();f.handleToggleLayout();f.handleToggleMetathreads();f.handleSetTheme();f.handleToggleToMyselfMetathread();f.handleOpenThemesPanel();f.handleOpenCleanMaster();f.handleQueryAction();f.handleOpenPulseSubscriptions();f.handleOpenComposeTemplate()}});ra.on("beforereload",function(){if(ra.isDead){return false}window.sendLoadlogRadar("loadflow_step-20","beforereload");g.userKeeper.group("app-render-reload",function(){var a=qa();if(ra.view){ra.view.destroy()}ra.view=new la.default(X.default.getData(),{router:ra,dataSource:X.default});ra.view.renderTo(a)},{score:"app:render"});return false});g.userKeeper.time("app-first-fetch");ra.one("routeend",function a(){g.userKeeper.timeEnd("biz-app-init",{score:"app:init"});g.userKeeper.time("biz-app-render");g.userKeeper.timeEnd("app-first-fetch",{score:"fetch"});g.userKeeper.group("app-first-render",function(){window.sendLoadlogRadar("loadflow_step-20","one routeend top");if(!sa.some(function(a){return ra.route.is(a)})){(0,i.getHeadline)().set("visible",true)}var a=qa();_timers.data+=_now();_timers.render=-_now();ra.view=new la.default(X.default.getData(),{router:ra,dataSource:X.default});X.default.on("change",function(a){var b=a.details;var c=b.changes;if(c.some(function(a){var b=a.action;return b.type!==K.EXECUTE_JSSDK_ACTION})){ra.view.set(c[c.length-1].data)}});a.removeChild(a.firstElementChild);ra.view.renderTo(a);g.userKeeper.timeEnd("biz-app-render",{score:"app:render"})},{score:"app:render"});window.appStarted("routeend");_timers.render+=_now();_timers.all+=_now();Y.default.add("timings",_timers);var b=Date.now()-window._timers.start_ts;var c=Object.keys(_timers).filter(function(a){return _timers[a]>=0}).map(function(a){return{name:a,value:_timers[a]}});E.radarService.sendLoadInfo(b,c);E.radarService.sendArchiveFoldersInfo();E.radarService.send({type:"config_performance_log",data:{sessionStorage:S.default.has("perflog_session_storage"),chunkLength:parseInt((S.default.get("perflog_chunk_length")||{}).data,10),chunks:parseInt((S.default.get("perflog_chunks")||{}).data,10)}});(0,m.initReleaseDetect)({cfg:W.default,RPC:ca.default,app:ra,xray:V.default});(0,L.setupFlagsAutosync)(ra);if(r.HIDE_TOYS){da.default.updateOnAction()}console.warn("[timing]",c.map(function(a){var b=a.name,c=a.value;return b+": "+c.toFixed(3)+"ms"}).join(", "))});ra.on("route",function(a){var b=a.details.initiator;var c=b==="initial";if(c){return}da.default.updateOnAction()});var ua=new Promise(function(a){ra.one("routeend",function b(){window.sendLoadlogRadar("loadflow_step-20","appRouteEndReady");ra.isReady=true;a(ra);(0,N.executeAllLazyAfterReadyTask)(ra)})});ra.ready=function a(b){ua.then(b)};g.userKeeper.timeEnd("app-setup-router");(0,n.initRouterDocumentListener)(ra,{logger:Y.default,smokeScreenService:ja.default});(0,N.addLazyAfterReadyTask)(h.initAfterReady);window.app=ra;(0,O.afterLoad)();window.__appTimers=_timers;(0,M.defineExternalForSyncUse)("app",ra);exports.default=ra});define("service/auth/account",["exports","@mail/features","cfg","cfgUser","default-values","service/portal"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(a);var g=j(b);var h=j(c);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}function k(a){window.location.href=a+("?page="+encodeURIComponent(window.location.href))+"&allow_external=1"}function l(a){var b=f.default.has("disable-choice");var c=g.default.get("urls.loginUrl")||"https://account.mail.ru/login";if(b){k(c);return}i.default.load().then(function(){a=Object.assign({page:location.protocol+"//"+location.host,allow_external:true,modal:false,opener:"octavius",mode:"simple",lang:"ru_RU"},a);var b=__PH.authForm;if(!b.isVisible()){if(app&&app.isReady){if(a.modal){document.body.style.overflow="hidden"}b.show(a)}else{k(c)}}})}function m(){return l({modal:true,formType:"relogin",email:__PH.activeUser(),email_vkc_auth:h.default.get("initialUser.vkc_user_id")?"1":""})}exports.default={login:function a(){return new Promise(function(){return l()})},relogin:function a(){return new Promise(function(){return m()})},keepalive:function a(){i.default.load().then(function(){__PH.on("authLost",function(){return m()});__PH.on("loginRequest",function(){return l()});__PH.on("authChange",function(a){var b=a.data.email;if(d.DISABLE_DOMAIN_AUTHCHECK){location.replace("/inbox");return}if(!b.endsWith("@"+d.VK_DOMAIN)&&d.IS_VK_HOST){location.replace(g.default.get("urls.baseMailUrl"));return}if(b.endsWith("@"+d.VK_DOMAIN)&&!d.IS_VK_HOST){location.replace(g.default.get("urls.vkMailUrl"));return}location.replace("/inbox")})})}}});