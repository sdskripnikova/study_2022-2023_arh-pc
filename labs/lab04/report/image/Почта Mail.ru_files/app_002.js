!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define("dompurify",b):(a=a||self).DOMPurify=b()}(this,function(){"use strict";var a=Object.hasOwnProperty,b=Object.setPrototypeOf,c=Object.isFrozen,d=Object.freeze,e=Object.seal,f=Object.create,g="undefined"!=typeof Reflect&&Reflect,h=g.apply,i=g.construct;h||(h=function(a,b,c){return a.apply(b,c)}),d||(d=function(a){return a}),e||(e=function(a){return a}),i||(i=function(a,b){return new(Function.prototype.bind.apply(a,[null].concat(function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(b))))});var j,k=w(Array.prototype.forEach),l=w(Array.prototype.indexOf),m=w(Array.prototype.pop),n=w(Array.prototype.push),o=w(Array.prototype.slice),p=w(String.prototype.toLowerCase),q=w(String.prototype.match),r=w(String.prototype.replace),s=w(String.prototype.indexOf),t=w(String.prototype.trim),u=w(RegExp.prototype.test),v=(j=TypeError,function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i(j,b)});function w(a){return function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return h(a,b,d)}}function x(a,d){b&&b(a,null);for(var e=d.length;e--;){var f=d[e];if("string"==typeof f){var g=p(f);g!==f&&(c(d)||(d[e]=g),f=g)}a[f]=!0}return a}function y(b){var c=f(null),d=void 0;for(d in b)h(a,b,[d])&&(c[d]=b[d]);return c}var z=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),A=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),B=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),C=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),D=d(["#text"]),E=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns"]),F=d(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),G=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),I=e(/\{\{[\s\S]*|[\s\S]*\}\}/gm),J=e(/<%[\s\S]*|[\s\S]*%>/gm),K=e(/^data-[\-\w.\u00B7-\uFFFF]/),L=e(/^aria-[\-\w]+$/),M=e(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),N=e(/^(?:\w+script|data):/i),O=e(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function Q(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var R=function(){return"undefined"==typeof window?null:window},S=function(a,b){if("object"!==(void 0===a?"undefined":P(a))||"function"!=typeof a.createPolicy)return null;var c=null;b.currentScript&&b.currentScript.hasAttribute("data-tt-policy-suffix")&&(c=b.currentScript.getAttribute("data-tt-policy-suffix"));var d="dompurify"+(c?"#"+c:"");try{return a.createPolicy(d,{createHTML:function(a){return a}})}catch(a){return console.warn("TrustedTypes policy "+d+" could not be created."),null}};return function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R(),c=function(b){return a(b)};if(c.version="2.1.0",c.removed=[],!b||!b.document||9!==b.document.nodeType)return c.isSupported=!1,c;var e=b.document,f=!1,g=b.document,h=b.DocumentFragment,i=b.HTMLTemplateElement,j=b.Node,w=b.NodeFilter,T=b.NamedNodeMap,U=void 0===T?b.NamedNodeMap||b.MozNamedAttrMap:T,V=b.Text,W=b.Comment,X=b.DOMParser,$=b.trustedTypes;if("function"==typeof i){var Y=g.createElement("template");Y.content&&Y.content.ownerDocument&&(g=Y.content.ownerDocument)}var Z=S($,e),_=Z&&Fa?Z.createHTML(""):"",aa=g,ba=aa.implementation,ca=aa.createNodeIterator,da=aa.getElementsByTagName,ea=aa.createDocumentFragment,fa=e.importNode,ga={};try{ga=y(g).documentMode?g.documentMode:{}}catch(a){}var ha={};c.isSupported=ba&&void 0!==ba.createHTMLDocument&&9!==ga;var ia=I,ja=J,ka=K,la=L,ma=N,na=O,oa=M,pa=null,qa=x({},[].concat(Q(z),Q(A),Q(B),Q(C),Q(D))),ra=null,sa=x({},[].concat(Q(E),Q(F),Q(G),Q(H))),ta=null,ua=null,va=!0,wa=!0,xa=!1,ya=!1,za=!1,Aa=!1,Ba=!1,Ca=!1,Da=!1,Ea=!1,Fa=!1,Ga=!0,Ha=!0,Ia=!1,Ja={},Ka=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),La=null,Ma=x({},["audio","video","img","source","image","track"]),Na=null,Oa=x({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),Pa=null,Qa=g.createElement("form"),Ra=function(a){Pa&&Pa===a||(a&&"object"===(void 0===a?"undefined":P(a))||(a={}),a=y(a),pa="ALLOWED_TAGS"in a?x({},a.ALLOWED_TAGS):qa,ra="ALLOWED_ATTR"in a?x({},a.ALLOWED_ATTR):sa,Na="ADD_URI_SAFE_ATTR"in a?x(y(Oa),a.ADD_URI_SAFE_ATTR):Oa,La="ADD_DATA_URI_TAGS"in a?x(y(Ma),a.ADD_DATA_URI_TAGS):Ma,ta="FORBID_TAGS"in a?x({},a.FORBID_TAGS):{},ua="FORBID_ATTR"in a?x({},a.FORBID_ATTR):{},Ja="USE_PROFILES"in a&&a.USE_PROFILES,va=!1!==a.ALLOW_ARIA_ATTR,wa=!1!==a.ALLOW_DATA_ATTR,xa=a.ALLOW_UNKNOWN_PROTOCOLS||!1,ya=a.SAFE_FOR_TEMPLATES||!1,za=a.WHOLE_DOCUMENT||!1,Ca=a.RETURN_DOM||!1,Da=a.RETURN_DOM_FRAGMENT||!1,Ea=a.RETURN_DOM_IMPORT||!1,Fa=a.RETURN_TRUSTED_TYPE||!1,Ba=a.FORCE_BODY||!1,Ga=!1!==a.SANITIZE_DOM,Ha=!1!==a.KEEP_CONTENT,Ia=a.IN_PLACE||!1,oa=a.ALLOWED_URI_REGEXP||oa,ya&&(wa=!1),Da&&(Ca=!0),Ja&&(pa=x({},[].concat(Q(D))),ra=[],!0===Ja.html&&(x(pa,z),x(ra,E)),!0===Ja.svg&&(x(pa,A),x(ra,F),x(ra,H)),!0===Ja.svgFilters&&(x(pa,B),x(ra,F),x(ra,H)),!0===Ja.mathMl&&(x(pa,C),x(ra,G),x(ra,H))),a.ADD_TAGS&&(pa===qa&&(pa=y(pa)),x(pa,a.ADD_TAGS)),a.ADD_ATTR&&(ra===sa&&(ra=y(ra)),x(ra,a.ADD_ATTR)),a.ADD_URI_SAFE_ATTR&&x(Na,a.ADD_URI_SAFE_ATTR),Ha&&(pa["#text"]=!0),za&&x(pa,["html","head","body"]),pa.table&&(x(pa,["tbody"]),delete ta.tbody),d&&d(a),Pa=a)},Sa=function(a){n(c.removed,{element:a});try{a.parentNode.removeChild(a)}catch(b){a.outerHTML=_}},Ta=function(a,b){try{n(c.removed,{attribute:b.getAttributeNode(a),from:b})}catch(a){n(c.removed,{attribute:null,from:b})}b.removeAttribute(a)},Ua=function(a){var b=void 0,c=void 0;if(Ba)a="<remove></remove>"+a;else{var d=q(a,/^[\r\n\t ]+/);c=d&&d[0]}var e=Z?Z.createHTML(a):a;try{b=(new X).parseFromString(e,"text/html")}catch(a){}if(f&&x(ta,["title"]),!b||!b.documentElement){var h=(b=ba.createHTMLDocument("")).body;h.parentNode.removeChild(h.parentNode.firstElementChild),h.outerHTML=e}return a&&c&&b.body.insertBefore(g.createTextNode(c),b.body.childNodes[0]||null),da.call(b,za?"html":"body")[0]};c.isSupported&&function(){try{var a=Ua("<x/><title>&lt;/title&gt;&lt;img&gt;");u(/<\/title/,a.querySelector("title").innerHTML)&&(f=!0)}catch(a){}}();var Va=function(a){return ca.call(a.ownerDocument||a,a,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT,function(){return w.FILTER_ACCEPT},!1)},Wa=function(a){return!(a instanceof V||a instanceof W)&&!("string"==typeof a.nodeName&&"string"==typeof a.textContent&&"function"==typeof a.removeChild&&a.attributes instanceof U&&"function"==typeof a.removeAttribute&&"function"==typeof a.setAttribute&&"string"==typeof a.namespaceURI)},Xa=function(a){return"object"===(void 0===j?"undefined":P(j))?a instanceof j:a&&"object"===(void 0===a?"undefined":P(a))&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},Ya=function(a,b,d){ha[a]&&k(ha[a],function(a){a.call(c,b,d,Pa)})},Za=function(a){var b=void 0;if(Ya("beforeSanitizeElements",a,null),Wa(a))return Sa(a),!0;if(q(a.nodeName,/[\u0080-\uFFFF]/))return Sa(a),!0;var d=p(a.nodeName);if(Ya("uponSanitizeElement",a,{tagName:d,allowedTags:pa}),!Xa(a.firstElementChild)&&(!Xa(a.content)||!Xa(a.content.firstElementChild))&&u(/<[!/\w]/g,a.innerHTML)&&u(/<[!/\w]/g,a.textContent))return Sa(a),!0;if(!pa[d]||ta[d]){if(Ha&&!Ka[d]&&"function"==typeof a.insertAdjacentHTML)try{var e=a.innerHTML;a.insertAdjacentHTML("AfterEnd",Z?Z.createHTML(e):e)}catch(a){}return Sa(a),!0}return"noscript"!==d&&"noembed"!==d||!u(/<\/no(script|embed)/i,a.innerHTML)?(ya&&3===a.nodeType&&(b=a.textContent,b=r(b,ia," "),b=r(b,ja," "),a.textContent!==b&&(n(c.removed,{element:a.cloneNode()}),a.textContent=b)),Ya("afterSanitizeElements",a,null),!1):(Sa(a),!0)},$a=function(a,b,c){if(Ga&&("id"===b||"name"===b)&&(c in g||c in Qa))return!1;if(wa&&u(ka,b));else if(va&&u(la,b));else{if(!ra[b]||ua[b])return!1;if(Na[b]);else if(u(oa,r(c,na,"")));else if("src"!==b&&"xlink:href"!==b&&"href"!==b||"script"===a||0!==s(c,"data:")||!La[a]){if(xa&&!u(ma,r(c,na,"")));else if(c)return!1}else;}return!0},_a=function(a){var b=void 0,d=void 0,e=void 0,f=void 0,g=void 0;Ya("beforeSanitizeAttributes",a,null);var h=a.attributes;if(h){var i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ra};for(g=h.length;g--;){var j=b=h[g],k=j.name,n=j.namespaceURI;if(d=t(b.value),e=p(k),i.attrName=e,i.attrValue=d,i.keepAttr=!0,i.forceKeepAttr=void 0,Ya("uponSanitizeAttribute",a,i),d=i.attrValue,!i.forceKeepAttr){if("name"===e&&"IMG"===a.nodeName&&h.id)f=h.id,h=o(h,[]),Ta("id",a),Ta(k,a),l(h,f)>g&&a.setAttribute("id",f.value);else{if("INPUT"===a.nodeName&&"type"===e&&"file"===d&&i.keepAttr&&(ra[e]||!ua[e]))continue;"id"===k&&a.setAttribute(k,""),Ta(k,a)}if(i.keepAttr)if(u(/\/>/i,d))Ta(k,a);else{ya&&(d=r(d,ia," "),d=r(d,ja," "));var q=a.nodeName.toLowerCase();if($a(q,e,d))try{n?a.setAttributeNS(n,k,d):a.setAttribute(k,d),m(c.removed)}catch(a){}}}}Ya("afterSanitizeAttributes",a,null)}},ab=function a(b){var c=void 0,d=Va(b);for(Ya("beforeSanitizeShadowDOM",b,null);c=d.nextNode();)Ya("uponSanitizeShadowNode",c,null),Za(c)||(c.content instanceof h&&a(c.content),_a(c));Ya("afterSanitizeShadowDOM",b,null)};return c.sanitize=function(a,d){var f=void 0,g=void 0,i=void 0,k=void 0,l=void 0;if(a||(a="\x3c!--\x3e"),"string"!=typeof a&&!Xa(a)){if("function"!=typeof a.toString)throw v("toString is not a function");if("string"!=typeof(a=a.toString()))throw v("dirty is not a string, aborting")}if(!c.isSupported){if("object"===P(b.toStaticHTML)||"function"==typeof b.toStaticHTML){if("string"==typeof a)return b.toStaticHTML(a);if(Xa(a))return b.toStaticHTML(a.outerHTML)}return a}if(Aa||Ra(d),c.removed=[],"string"==typeof a&&(Ia=!1),Ia);else if(a instanceof j)1===(g=(f=Ua("\x3c!--\x3e")).ownerDocument.importNode(a,!0)).nodeType&&"BODY"===g.nodeName||"HTML"===g.nodeName?f=g:f.appendChild(g);else{if(!Ca&&!ya&&!za&&-1===a.indexOf("<"))return Z&&Fa?Z.createHTML(a):a;if(!(f=Ua(a)))return Ca?null:_}f&&Ba&&Sa(f.firstChild);for(var m=Va(Ia?a:f);i=m.nextNode();)3===i.nodeType&&i===k||Za(i)||(i.content instanceof h&&ab(i.content),_a(i),k=i);if(k=null,Ia)return a;if(Ca){if(Da)for(l=ea.call(f.ownerDocument);f.firstChild;)l.appendChild(f.firstChild);else l=f;return Ea&&(l=fa.call(e,l,!0)),l}var n=za?f.outerHTML:f.innerHTML;return ya&&(n=r(n,ia," "),n=r(n,ja," ")),Z&&Fa?Z.createHTML(n):n},c.setConfig=function(a){Ra(a),Aa=!0},c.clearConfig=function(){Pa=null,Aa=!1},c.isValidAttribute=function(a,b,c){Pa||Ra({});var d=p(a),e=p(b);return $a(d,e,c)},c.addHook=function(a,b){"function"==typeof b&&(ha[a]=ha[a]||[],n(ha[a],b))},c.removeHook=function(a){ha[a]&&m(ha[a])},c.removeHooks=function(a){ha[a]&&(ha[a]=[])},c.removeAllHooks=function(){ha={}},c}()});define("clipboard/dist/clipboard",["module","exports"],function(a,exports){"use strict";var b=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};(function c(d,e){if((typeof exports==="undefined"?"undefined":b(exports))==="object"&&(typeof a==="undefined"?"undefined":b(a))==="object")a.exports=e();else if(typeof define==="function"&&define.amd)define([],e);else if((typeof exports==="undefined"?"undefined":b(exports))==="object")exports["ClipboardJS"]=e();else d["ClipboardJS"]=e()})(undefined,function(){return function(){var a={134:function a(c,d,e){"use strict";e.d(d,{default:function a(){return E}});var f=e(279);var g=e.n(f);var h=e(370);var i=e.n(h);var j=e(817);var k=e.n(j);function l(a){"@babel/helpers - typeof";if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){l=function a(c){return typeof c==="undefined"?"undefined":b(c)}}else{l=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c==="undefined"?"undefined":b(c)}}return l(a)}function m(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function n(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function o(a,b,c){if(b)n(a.prototype,b);if(c)n(a,c);return a}var p=function(){function a(b){m(this,a);this.resolveOptions(b);this.initSelection()}o(a,[{key:"resolveOptions",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=b.action;this.container=b.container;this.emitter=b.emitter;this.target=b.target;this.text=b.text;this.trigger=b.trigger;this.selectedText=""}},{key:"initSelection",value:function a(){if(this.text){this.selectFake()}else if(this.target){this.selectTarget()}}},{key:"createFakeElement",value:function a(){var b=document.documentElement.getAttribute("dir")==="rtl";this.fakeElem=document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[b?"right":"left"]="-9999px";var c=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top="".concat(c,"px");this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;return this.fakeElem}},{key:"selectFake",value:function a(){var b=this;var c=this.createFakeElement();this.fakeHandlerCallback=function(){return b.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||true;this.container.appendChild(c);this.selectedText=k()(c);this.copyText();this.removeFake()}},{key:"removeFake",value:function a(){if(this.fakeHandler){this.container.removeEventListener("click",this.fakeHandlerCallback);this.fakeHandler=null;this.fakeHandlerCallback=null}if(this.fakeElem){this.container.removeChild(this.fakeElem);this.fakeElem=null}}},{key:"selectTarget",value:function a(){this.selectedText=k()(this.target);this.copyText()}},{key:"copyText",value:function a(){var b;try{b=document.execCommand(this.action)}catch(a){b=false}this.handleResult(b)}},{key:"handleResult",value:function a(b){this.emitter.emit(b?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function a(){if(this.trigger){this.trigger.focus()}document.activeElement.blur();window.getSelection().removeAllRanges()}},{key:"destroy",value:function a(){this.removeFake()}},{key:"action",set:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"copy";this._action=b;if(this._action!=="copy"&&this._action!=="cut"){throw new Error('Invalid "action" value, use either "copy" or "cut"')}},get:function a(){return this._action}},{key:"target",set:function a(b){if(b!==undefined){if(b&&l(b)==="object"&&b.nodeType===1){if(this.action==="copy"&&b.hasAttribute("disabled")){throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute')}if(this.action==="cut"&&(b.hasAttribute("readonly")||b.hasAttribute("disabled"))){throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}this._target=b}else{throw new Error('Invalid "target" value, use a valid Element')}}},get:function a(){return this._target}}]);return a}();var q=p;function r(a){"@babel/helpers - typeof";if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){r=function a(c){return typeof c==="undefined"?"undefined":b(c)}}else{r=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c==="undefined"?"undefined":b(c)}}return r(a)}function s(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function t(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function u(a,b,c){if(b)t(a.prototype,b);if(c)t(a,c);return a}function v(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:true,configurable:true}});if(b)w(a,b)}function w(a,b){w=Object.setPrototypeOf||function a(b,c){b.__proto__=c;return b};return w(a,b)}function x(a){var b=A();return function c(){var d=B(a),e;if(b){var f=B(this).constructor;e=Reflect.construct(d,arguments,f)}else{e=d.apply(this,arguments)}return y(this,e)}}function y(a,b){if(b&&(r(b)==="object"||typeof b==="function")){return b}return z(a)}function z(a){if(a===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function A(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(a){return false}}function B(a){B=Object.setPrototypeOf?Object.getPrototypeOf:function a(b){return b.__proto__||Object.getPrototypeOf(b)};return B(a)}function C(a,b){var c="data-clipboard-".concat(a);if(!b.hasAttribute(c)){return}return b.getAttribute(c)}var D=function(a){v(c,a);var b=x(c);function c(a,d){var e;s(this,c);e=b.call(this);e.resolveOptions(d);e.listenClick(a);return e}u(c,[{key:"resolveOptions",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=typeof b.action==="function"?b.action:this.defaultAction;this.target=typeof b.target==="function"?b.target:this.defaultTarget;this.text=typeof b.text==="function"?b.text:this.defaultText;this.container=r(b.container)==="object"?b.container:document.body}},{key:"listenClick",value:function a(b){var c=this;this.listener=i()(b,"click",function(a){return c.onClick(a)})}},{key:"onClick",value:function a(b){var c=b.delegateTarget||b.currentTarget;if(this.clipboardAction){this.clipboardAction=null}this.clipboardAction=new q({action:this.action(c),target:this.target(c),text:this.text(c),container:this.container,trigger:c,emitter:this})}},{key:"defaultAction",value:function a(b){return C("action",b)}},{key:"defaultTarget",value:function a(b){var c=C("target",b);if(c){return document.querySelector(c)}}},{key:"defaultText",value:function a(b){return C("text",b)}},{key:"destroy",value:function a(){this.listener.destroy();if(this.clipboardAction){this.clipboardAction.destroy();this.clipboardAction=null}}}],[{key:"isSupported",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:["copy","cut"];var c=typeof b==="string"?[b]:b;var d=!!document.queryCommandSupported;c.forEach(function(a){d=d&&!!document.queryCommandSupported(a)});return d}}]);return c}(g());var E=D},828:function a(b){var c=9;if(typeof Element!=="undefined"&&!Element.prototype.matches){var d=Element.prototype;d.matches=d.matchesSelector||d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector||d.webkitMatchesSelector}function e(a,b){while(a&&a.nodeType!==c){if(typeof a.matches==="function"&&a.matches(b)){return a}a=a.parentNode}}b.exports=e},438:function a(b,c,d){var e=d(828);function f(a,b,c,d,e){var f=h.apply(this,arguments);a.addEventListener(c,f,e);return{destroy:function b(){a.removeEventListener(c,f,e)}}}function g(a,b,c,d,e){if(typeof a.addEventListener==="function"){return f.apply(null,arguments)}if(typeof c==="function"){return f.bind(null,document).apply(null,arguments)}if(typeof a==="string"){a=document.querySelectorAll(a)}return Array.prototype.map.call(a,function(a){return f(a,b,c,d,e)})}function h(a,b,c,d){return function(c){c.delegateTarget=e(c.target,b);if(c.delegateTarget){d.call(a,c)}}}b.exports=g},879:function a(b,exports){exports.node=function(a){return a!==undefined&&a instanceof HTMLElement&&a.nodeType===1};exports.nodeList=function(a){var b=Object.prototype.toString.call(a);return a!==undefined&&(b==="[object NodeList]"||b==="[object HTMLCollection]")&&"length"in a&&(a.length===0||exports.node(a[0]))};exports.string=function(a){return typeof a==="string"||a instanceof String};exports.fn=function(a){var b=Object.prototype.toString.call(a);return b==="[object Function]"}},370:function a(b,c,d){var e=d(879);var f=d(438);function g(a,b,c){if(!a&&!b&&!c){throw new Error("Missing required arguments")}if(!e.string(b)){throw new TypeError("Second argument must be a String")}if(!e.fn(c)){throw new TypeError("Third argument must be a Function")}if(e.node(a)){return h(a,b,c)}else if(e.nodeList(a)){return i(a,b,c)}else if(e.string(a)){return j(a,b,c)}else{throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}}function h(a,b,c){a.addEventListener(b,c);return{destroy:function d(){a.removeEventListener(b,c)}}}function i(a,b,c){Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)});return{destroy:function d(){Array.prototype.forEach.call(a,function(a){a.removeEventListener(b,c)})}}}function j(a,b,c){return f(document.body,a,b,c)}b.exports=g},817:function a(b){function c(a){var b;if(a.nodeName==="SELECT"){a.focus();b=a.value}else if(a.nodeName==="INPUT"||a.nodeName==="TEXTAREA"){var c=a.hasAttribute("readonly");if(!c){a.setAttribute("readonly","")}a.select();a.setSelectionRange(0,a.value.length);if(!c){a.removeAttribute("readonly")}b=a.value}else{if(a.hasAttribute("contenteditable")){a.focus()}var d=window.getSelection();var e=document.createRange();e.selectNodeContents(a);d.removeAllRanges();d.addRange(e);b=d.toString()}return b}b.exports=c},279:function a(b){function c(){}c.prototype={on:function a(b,c,d){var e=this.e||(this.e={});(e[b]||(e[b]=[])).push({fn:c,ctx:d});return this},once:function a(b,c,d){var e=this;function f(){e.off(b,f);c.apply(d,arguments)}f._=c;return this.on(b,f,d)},emit:function a(b){var c=[].slice.call(arguments,1);var d=((this.e||(this.e={}))[b]||[]).slice();var e=0;var f=d.length;for(e;e<f;e++){d[e].fn.apply(d[e].ctx,c)}return this},off:function a(b,c){var d=this.e||(this.e={});var e=d[b];var f=[];if(e&&c){for(var g=0,h=e.length;g<h;g++){if(e[g].fn!==c&&e[g].fn._!==c)f.push(e[g])}}f.length?d[b]=f:delete d[b];return this}};b.exports=c;b.exports.TinyEmitter=c}};var c={};function d(b){if(c[b]){return c[b].exports}var e=c[b]={exports:{}};a[b](e,e.exports,d);return e.exports}(function(){d.n=function(a){var b=a&&a.__esModule?function(){return a["default"]}:function(){return a};d.d(b,{a:b});return b}})();(function(){d.d=function(exports,a){for(var b in a){if(d.o(a,b)&&!d.o(exports,b)){Object.defineProperty(exports,b,{enumerable:true,get:a[b]})}}}})();(function(){d.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}})();return d(134)}().default})});define("clipboard",["clipboard/dist/clipboard"],function(a){return a});!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define("@mail/text-analyzer/dist/main",[],b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(window,function(){return function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b)return a;if(4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,function(b){return a[b]}.bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s=0)}([function(a,b,c){var d;void 0===(d=function(a){var b=c(1),d=/(?:(?:[^\/\.\?\%\=;\!&-_A-z]|^)(?:attachments?|attach(?:[^a-z]|$)|attached)|аттач|в прицепе?|в скрепк(?:е|у)|во? вложени(?:и|е)|(?:см(?:отри|\.|) ?|проверь )(?:вложен|приложен|прикреплен|скрепк|файл(?:|ы|ики?)[^А-я])|во вложенн?..|вложенн?.. файл(?:|ы|ики?)[^А-я]|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:|ы|ики?)[^А-я]|(?:вкладываю|прикладываю|прикрепляю|прилагаю)[^А-я]|(?:прикрепила?|приложила?)(?:[^А-я]|$)|в приложении|в приложенн?[оы].)/gi;function e(a){var c=(a=a.toLowerCase()).match(d);if(null===c)return!1;var e=(c=c[0]).match(/[A-zА-я\. ]+/gi);return null!==e&&(c=e[0].trim(),c=b.clearText(c),!b.isLink(a,c)&&(!b.isQuestion(a,c)&&(!a.match(new RegExp("^[^'\"«»]*['\"«][^'\"«»]*"+c+"(?:[^\"'«»]*\n){0,}[^'\"«»]*['\"»][^'\"«»]*$","ig"))&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|(см(?:отри|\.|) ?|проверь )(?:вложен|приложен|прикреплен|скрепк|файл(?:|ы|ики?)[^А-я]))/gi,/(?:[^А-я]|^)(?:забыл.?|прошл.{2,3}|вчера.{0,}|предыдущ.{2,3}|ранее|в первом|первого|бы(?:л.?|ть)|нету?|отсутству[ею]т|пуст.{0,2}|только|ничего|будет)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:attachments?|attach(?:ed)?)/gi,/(?:[^A-z]|^)(?:previou?s|last|recent|first letter|already|below)(?:[^A-z]|$)/gi)&&(!b.isNegRegexNear(a,/(?:аттач|во? вложени[ие]|во вложенн..|в приложении|в приложенн?[оы].|(?:при(?:(?:лага|крепля)ю|(?:лож|креп)ила?)|(?:в|при)кладываю)|прилага[ею]тся|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:ы|ики?)?[^А-я])/gi,/(?:(?:[^А-я]|^)ссылк.|https?:)/gi,75,100,1,1)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|прилагаю|прикладываю|прикрепляю)/gi,/(?:[^А-я]|^)(?:он[аи]?|[твм]ы|мне|меня|теб[ея]|е[йеё]|не[йм]|е(?:му|го)|ва[мшс]|и[хм]|[вн]ашим|на[шмс]|мной|тобой|(?:в|н)ами|ними?|тво[йяиеё]|у?же|там|сначала|затем|опять|есть)(?:[^А-я]|$)/gi,25,25)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?)/gi,/(?:[^А-я]|^)(?:она?|[тв]ы|тво[йя]|теб[ея]|ва[мшс]|у?же)(?:[^А-я]|$)/gi,15,15)&&(!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|(?:при(?:(?:лага|крепля)ю|(?:лож|креп)ила?)|прикладываю))/gi,/(?:[^А-я]|^)(?:ответ.?|письм[оа]|переписк.|ниже|бы)(?:[^А-я]|$)/gi,35,35)&&(!b.isNegRegexNear(a,new RegExp(c,"ig"),/(?:[^А-я]|^)не(?:[^А-я]|$)/gi,35,35)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепке|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].)/gi,/(?:[^А-я]|^)[А-я]{1,7}[аеиуйь](?:ть|вь|те)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|(?:в|при)кладываю|прикрепляю|прилага(?:е|ю)тся|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:|ы|ики?)[^А-я])/gi,/(?:[^А-я]|^)(?:как..|так..|(?:не)?котор..|чем|как|так|если|(?:все|ино|ко|то)гда|где|что(?:б|бы)?|почему|зачем|вместо|вообще|наконец)(?:[^А-я]|-|$)/gi,35,35)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе|в скрепке|во? вложении|во вложенн..|в приложении|в приложенн?[оы].)/gi,/(?:[^А-я]|^)не (?:вижу|найду|нахожу)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:приложила?|прилагаю|прикладываю)/gi,/(?:[^А-я]|^)(?:сил[ыу]|усили[яей]|труд.{0,2})(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:android|appstore|iphone|ios|google play|аппстор|авториз|андро[ий]д.*|айфон.*|верси|обнов(?:лен)?и|приложени[ея]|мобильн.{2,3}|разработ[чк]|smartphone|смартфон|регистраци.|(?:за)регистрир.*|пользовател[а-я]{1,2})/gi,1e4,1e4,1,1)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:(?:в|за)ход|вой[дт]и|групп.|веб|нельзя)/gi)&&(!b.isNegRegexNear(a,/(?:в приложении|(?:см(?:отри|\.|) ?|проверь )(?:вложен|приложен))/gi,/(?:номер|№|\d|[A-z]+)/gi,0,6)&&(null===a.match(new RegExp("в приложении [\"'].{1,30}[\"']","ig"))&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)[кмг]б|(?:кило|мега|гига)байт(?:[^А-я]|$)/gi,30,30)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:п\\.?|пункт)(?:[^А-я]|$)/gi,20,20)&&(!b.isNegRegexNear(a,/в приложении/gi,/ [а-зa-z](?:[^А-яA-z]|$)/gi,0,3)&&(!b.isNegRegexNear(a,/вкладываю/gi,/(?:[^А-я]|^)(?:смысл|деньги|инвестици|средства)/gi,30,30)&&(!b.isNegRegexNear(a,/(?:прилага(?:е|ю)тся|прилагаю|приложила?|прикрепила?|прикрепляю|прикладываю)/gi,/(?:[^А-я]|^)(?:информаци(?:я|ю)|инфо|контакты|номер)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:прилага(?:е|ю)тся|во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/[\'\"«][^\'\"«»]{100,}[\'\"»]/gi,0,1e4,0,1)&&(!b.isNegRegexNear(a,/attach(?:ed)?/gi,/to (?:you|her|him|me)/gi,0,10)&&(!b.isNegRegexNear(a,/attached/gi,/(?:am|was|were|had|did)/gi,10,0)&&(!b.isNegRegexNear(a,/attach(?:ed)?/gi,/(?:[^A-z]|^)(?:we|your?|s?he|they|his|her|him)(?:[^A-z]|$)/gi,17,0)&&(!b.isNegRegexNear(a,/(?:attachments?|attach[^me]|attached)/gi,/(?:[^A-z]|^)(?:don'?t|not?|any|link|with ?out|forg(?:e|o)t)(?:[^A-z]|$)/gi,30,30)&&(!b.isNegRegexNear(a,/(?:attachments?|attach[^me]|attached)/gi,/(?:[^A-z]|^)(?:these|this|that|those)(?:[^A-z]|$)/gi,15,0)&&((!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)к /gi,0,20)||null!==a.match(/в приложении к [а-я]{0,10} ?письму/gi))&&((!b.isNegRegexNear(a,/(?:прилагаю|прилага[ею]тся|приложила?|прикрепила?|прикладываю)/gi,/(?:[^А-я]|^)к /gi)||null!==a.match(/(?:прилагаю|прилага[ею]тся|приложил(?:а|[^А-я]|$)|прикрепил(?:а|[^А-я]|$)|прикладываю)[а-я ]{0,}к [а-я]{0,10} ?письму/gi)||null!==a.match(/(?:[^А-я]|^)к [а-я]{0,10} ?письму (?:прилагаю|прилага[ею]тся|приложил(?:а|[^А-я]|$)|прикрепил(?:а|[^А-я]|$)|прикладываю)/gi))&&((!b.isNegRegexNear(a,/вкладываю/gi,/(?:[^А-я]|^)в /gi)||null!==a.match(/вкладываю [а-я ]{0,} ?в [а-я]{0,10} ?письмо/gi)||null!==a.match(/в [а-я]{0,10} ?письмо вкладываю[^т]/gi))&&((!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) [а-я ]{0,30} ?реквизиты/gi)&&!a.match(/реквизиты [а-я ]{0,30} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:[^A-z]|^)(?:бик|инн|номер|получател.|сч[её]т|кпп|о[ао]о|зао|огрн|окпо|ип|рнн|иин|иик)(?:[^A-z]|$)/gi,0,1e4,0,1))&&((!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) [а-я ]{0,25} ?(?:список|данные)/gi)&&!a.match(/(?:список|данные) [а-я ]{0,25} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:.{0,3}(?:\d|-).*\n){2,}/gi,0,1e4,0,1))&&(!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) .{0,15} ?чек/gi)&&!a.match(/чек .{0,15} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:[^A-z]|^)(?:сумма|номер заказа|платеж.?|получател.|ип|дата|время)(?:[^A-z]|$)/gi,0,1e4,0,1))))))))))))))))))))))))))))))))))))}var f="natural",g="noreply",h=/^(?:(?:(?:do)?[._-]?no?t?[._-]?(?:reply|answer))|(?:bez|net)[._-]?ot[vw]eta)$/i,i=/не (?:(?:нужно|следует) отвечать|отвеча)|отвечать на него не (?:нужно|следует)|не требует ответа/i,j=/do(?:n'| no)t (?:reply|respond|answer)/i,k=/e-mail|письмо|сообщение|уведомление/i,l=/автоматическ/i,m=/e-mail|message|letter/i,n=/automat|system|generated?/i;return{TYPE_NATURAL:f,TYPE_NOREPLY:g,haveAttach:e,hasAttachment:e,getType:function(a,b){return b&&!h.test(b.split("@")[0])||!(i.test(a)||j.test(a)||k.test(a)&&l.test(a)||m.test(a)&&n.test(a))?f:g}}}.call(b,c,b,a))||(a.exports=d)},function(a,b,c){var d;void 0===(d=function(a,b){b.isNegRegexNear=function(a,b,c,d,e,f,g){var h,i,j,k,l,m;if(void 0===f&&(f=0),void 0===g&&(g=0),k=(a=a.toLowerCase()).match(b),h=null!==a.match(b),null===k)return!1;j=k[0];var n=a.indexOf(j),o=n+j.length;j=this.clearText(j),m=null===(k=a.match(new RegExp("(?:[.?!\n]|^)[^.?!\n]*"+j,"ig")))?0:a.indexOf(k[0]);var p=a.substr(o,a.length);return l=null===(k=p.match(/[\.\!\?\n].*/gi))?p.length:p.indexOf(k[0]),d||0===d?((d=n-d)<m&&0===f&&(d=m),d<0&&(d=0)):d=m,e=(e||0===e)&&(e>l&&1===g||e<l)?o+e:o+l,i=null!==a.substr(d,e-d).match(c),h&&i},b.clearText=function(a){return a.replace(/[\/\(\)\[\]\&]/g,"").replace(/\\/,"\\\\")},b.isQuestion=function(a,b){var c=a.toLowerCase().match(new RegExp(b,"ig"));if(null===c)return!1;b=c[0];var d,e=a.indexOf(b),f=a.substr(e,a.length),g=f.match(/[\.\!\?)\n].*/i);return d=g&&g.length>0?f.indexOf(g[0]):f.length,null!==(f=a.substr(e,d+1)).match(/\?$/)},b.isLink=function(a,b){return null!==a.match(new RegExp("<a.*>[^<>]*"+b+"[^<>]*</a>","ig"))||null!==a.match(new RegExp("<[^<>]*"+b+"[^<>]*>","ig"))}}.call(b,c,b,a))||(a.exports=d)}])});define("@mail/text-analyzer",["@mail/text-analyzer/dist/main"],function(a){return a});(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@mail/amp-viewer",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@mail/amp-viewer"]={}))})(this,function(exports){"use strict";var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};function b(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var c=function(){c=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return c.apply(this,arguments)};function d(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function e(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function f(a,b){return b={exports:{}},a(b,b.exports),b.exports}var g=f(function(a,exports){Object.defineProperty(exports,"__esModule",{value:true});var b="initial";function c(a,b,c){if(typeof b==="function"){return new d(a,void 0,b)}return new d(a,b,c)}var d=function(){function a(a,b,c){this.state=a;this.signal=b;this.implementation=c}a.prototype.onConditionsMet=function(a){};a.prototype.onConditionsUnmet=function(a){};return a}();var e=function(){function a(a){this.transitions=a;this.currentState=b;this.possibleTransitions=[]}Object.defineProperty(a.prototype,"state",{get:function(){return this.currentState},enumerable:true,configurable:true});a.prototype.transition=function(a){var b=[];for(var c=1;c<arguments.length;c++){b[c-1]=arguments[c]}var d=this.findTransitions(a);var e=this.state;for(var f=0,g=d;f<g.length;f++){var h=g[f];this.doTransition.apply(this,[h.implementation].concat(b));if(e!==this.state){return}}};a.prototype.reset=function(){this.doTransition(b)};a.prototype.doTransition=function(a){var b=this;var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}this.possibleTransitions.forEach(function(a){return a.onConditionsUnmet(b)});if(typeof a==="function"){this.currentState=a.apply(void 0,[this].concat(c))}else{this.currentState=a}this.possibleTransitions=this.getPossibleTransitions();this.possibleTransitions.forEach(function(a){return a.onConditionsMet(b)})};a.prototype.getPossibleTransitions=function(){var a=this;return this.transitions.filter(function(b){return b.state===a.state})};a.prototype.findTransitions=function(a){return this.getPossibleTransitions().filter(function(b){return b.signal===a||b.signal===void 0})};return a}();function f(a){return new e(a)}var g=function(a,b){g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]};return g(a,b)};function h(a,b){g(a,b);function c(){this.constructor=a}a.prototype=b===null?Object.create(b):(c.prototype=b.prototype,new c)}var i=function(a){h(b,a);function b(c,d,e){var f=a.call(this,c,b.signal(e),d)||this;f.ms=e;return f}b.signal=function(a){return"_$timer"+a};b.prototype.onConditionsMet=function(b){a.prototype.onConditionsMet.call(this,b);this.timer=setTimeout(this.handleTimer.bind(this,b),this.ms)};b.prototype.onConditionsUnmet=function(b){a.prototype.onConditionsUnmet.call(this,b);clearTimeout(this.timer)};b.prototype.handleTimer=function(a){a.transition(b.signal(this.ms))};return b}(d);function j(a,b,c){return new i(a,c,b)}var k=function(a){h(b,a);function b(b,c,d){return a.call(this,b,c,function(){var a=[];for(var c=0;c<arguments.length;c++){a[c]=arguments[c]}d.apply(void 0,a);return b})||this}return b}(d);function l(a,b,c){if(typeof b==="function"){c=b;b=void 0}return new k(a,b,c)}function m(a){var b=function(c){if(typeof c==="function"){return b({})(c)}return function(b){var d=function(b){h(d,b);function d(){var d=[];for(var e=0;e<arguments.length;e++){d[e]=arguments[e]}var f=b.apply(this,d)||this;a.onConstruct(f,c);return f}return d}(b);a.onPatch(d,c);return d}};return b}function n(a,b,c){var d=a.prototype[b];var e=typeof d==="function";a.prototype[b]=function a(){c.apply(this,arguments);if(e){return d.apply(this,arguments)}}}var o="create";var p="mount";var q="update";var r="unmount";var s="catch";var t=function(a){h(b,a);function b(b){var c=a.call(this,b.transitions||[])||this;c.component=b;c.handlers={};return c}b.prototype.signal=function(a){var b=this;var c=String(a);if(!this.handlers[c]){this.handlers[c]=function(c){b.transition(a,c)}}return this.handlers[c]};b.prototype.transition=function(b){var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}var e;a.prototype.transition.apply(this,[b].concat(c));if(typeof this.mapToState!=="string"){return}if(this.component.state[this.mapToState]!==this.state){this.component.setState((e={},e[this.mapToState]=this.state,e))}};b.prototype.doTransition=function(b){var c=this;var d=[];for(var e=1;e<arguments.length;e++){d[e-1]=arguments[e]}if(typeof b!=="function"){return a.prototype.doTransition.call(this,b)}a.prototype.doTransition.call(this,function(){return b.apply(void 0,[c.component].concat(d))},d)};return b}(e);var u={onPatch:function(a,b){var c=b.catching;n(a,"componentDidMount",function(){this.automaton.transition(p)});n(a,"componentDidUpdate",function(a,b){this.automaton.transition(q,a,b)});n(a,"componentWillUnmount",function(){this.automaton.transition(r);this.automaton.reset()});c&&n(a,"componentDidCatch",function(a,b){this.automaton.transition(s,a,b)})},onConstruct:function(a,b){a.automaton=new t(a);a.automaton.transition(o,a);if(typeof b.mapToState==="string"){if(!a.state){a.state={}}a.state[b.mapToState]=a.automaton.state;a.automaton.mapToState=b.mapToState}}};var v=m(u);function w(a){return a.automaton}function x(a,b){return w(a).signal(b)}exports.INITIAL=b;exports.transition=c;exports.automaton=f;exports.Automaton=e;exports.Transition=d;exports.timer=j;exports.sideEffect=l;exports.CATCH=s;exports.CREATE=o;exports.MOUNT=p;exports.UNMOUNT=r;exports.UPDATE=q;exports.withAutomaton=v;exports.automatonOf=w;exports.asSignal=x});e(g);var h=g.INITIAL;var i=g.transition;var j=g.automaton;var k=g.Automaton;var l=g.Transition;var m=g.timer;var n=g.sideEffect;var o=g.CATCH;var p=g.CREATE;var q=g.MOUNT;var r=g.UNMOUNT;var s=g.UPDATE;var t=g.withAutomaton;var u=g.automatonOf;var v=g.asSignal;var w=function(){function a(){this.handlers={}}a.prototype.on=function(a,b){this.handlers[a]=this.handlers[a]||[];this.handlers[a].push(b)};a.prototype.off=function(a,b){if(!this.handlers[a]){return}this.handlers[a]=this.handlers[a].filter(function(a){return b!==a})};a.prototype.emit=function(a,b){(this.handlers[a]||[]).forEach(function(a){return a(b)})};return a}();var x="ready";var y="content";var z="resize";var A="configure";var B="configured";var C="error";var D="navigate";var E="radar";var F="#?__mrg_frame_id=";var G="timeout";var H=/^(https?:\/\/)?(.*\.)?(imgs|dev)?mail\.ru$/;var I=/^(https?:\/\/)?localhost:?/;var J="@@mail-amp-postMessage$";var K=function(a){b(d,a);function d(b){var e=a.call(this)||this;e.id=d.lastId++;e.options=c({},b);e.id=b.id||e.id;e.handleMessage=e.handleMessage.bind(e);return e}d.prototype.setup=function(){this.options.selfWindow.addEventListener("message",this.handleMessage)};d.prototype.teardown=function(){this.options.selfWindow.removeEventListener("message",this.handleMessage)};d.prototype.sendMessage=function(a){var b=a.type;if(this.options.debug){console.warn("[SEND]",b,a)}var c=this.id+J;this.options.targetWindow.postMessage(c+JSON.stringify(a),this.options.targetOrigin||"*")};d.prototype.setDebug=function(a){this.options.debug=a};d.prototype.setTargetWindow=function(a){this.options.targetWindow=a};d.prototype.setTargetOrigin=function(a){this.options.targetOrigin=a};d.prototype.setId=function(a){this.id=a};d.prototype.getId=function(){return this.id};d.prototype.handleMessage=function(a){var b=this.options.originRegexp;if(b&&!b.test(a.origin)){if(this.options.debug){console.error("[RECEIVE] Received message from prohibited origin:",a.origin)}return}var c;try{var d=String(a.data);var e=""+this.id+J;if(d.startsWith(e)){c=JSON.parse(a.data.slice(e.length))}else{return}}catch(a){console.error(a);return}if(this.options.debug){console.warn("[RECEIVE]",c.type,c)}this.emit(c.type,c)};d.lastId=0;return d}(w);function L(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}var M="initial";var N="creation";var O="loading";var P="error";var Q="configuring";var R="ready";var S="event-error";var T="ready";var U="error";var V="warning";var W="resize";var X="navigate";var Y="radar";var Z=function(a){b(e,a);function e(b){var d=a.call(this)||this;d.options=c({},b);var e=H;if(I.test(window.location.href)){e=undefined}d.transport=new K(c({selfWindow:window,originRegexp:e,debug:b.debug},b.transport));return d}e.prototype.setup=function(){this.initializeController();this.transport.setup();this.transport.on(x,this.asSignal(x));this.transport.on(B,this.asSignal(B));this.transport.on(z,this.asSignal(z));this.transport.on(D,this.asSignal(D));this.transport.on(E,this.asSignal(E));this.transport.on(C,this.asSignal(C));this.automaton.transition(undefined)};e.prototype.teardown=function(){this.automaton.reset();this.transport.teardown()};e.prototype.loadLetter=function(a){this.letter=a;if(this.automaton.state===R){this.transport.sendMessage({type:y,data:this.letter})}};e.prototype.errorReporter=function(a,b){var c=this;return function(){var d={data:{type:a,error:b}};c.emit(U,d.data);return P}};e.prototype.asSignal=function(a){var b=this;return function(c){b.automaton.transition(a,c)}};e.prototype.initializeController=function(){var a=this;this.automaton=j(d([i(M,"create",N),i(N,function(){var b=a.options.iframeSrc;a.iframe=a.options.iframe||document.createElement("IFRAME");var c=["xhrInterceptor","viewerRenderTemplate"];a.iframe.setAttribute("scrolling","no");a.iframe.setAttribute("allowfullscreen","false");a.iframe.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin");a.iframe.setAttribute("allow","accelerometer 'none';autoplay 'none';"+"camera 'none';document-domain 'none';encrypted-media 'none';fullscreen 'none';"+"geolocation 'none';gyroscope 'none';magnetometer 'none';microphone 'none';midi 'none';"+"payment 'none';picture-in-picture 'none';sync-xhr 'none';usb 'none';xr-spatial-tracking 'none';");a.iframe.src=b+F+a.transport.getId()+"&"+L({origin:window.location.origin,prerenderSize:0,visibilityState:"visible",viewportType:a.options.mobileSafari?"natural":"natural-ios-embed",paddingTop:0,history:1,p2r:0,storage:0,development:0,log:1,cap:c.join(","),csi:0});if(/^https?:\/\//.test(b)){var d=b.split("/");var e=d[0]+"//"+d[2];a.transport.setTargetOrigin(e)}a.iframe.onerror=a.asSignal(S);return O}),m(O,this.options.timeout,this.errorReporter(G,"Iframe loading timed out")),i(O,x,function(){a.transport.setTargetWindow(a.iframe.contentWindow);a.transport.sendMessage({type:A,data:a.options});return Q}),m(Q,this.options.timeout,this.errorReporter(G,"Iframe configuring timed out")),i(Q,B,function(){if(a.letter){a.transport.sendMessage({type:y,data:a.letter})}a.emit(T,undefined);return R}),n(R,z,function(b,c){a.iframe.style.height=c.data.height+"px";a.emit(W,c.data)}),n(R,D,function(b,c){a.emit(X,c.data)})],[M,O,Q,R,P].map(function(b){return n(b,E,function(b,c){a.emit(Y,c.data)})}),[M,O,Q,R].map(function(b){return i(b,C,function(c,d){if(d.data.type==="timeout"||d.data.type==="validation"||d.data.type==="lib_untrusted"){a.emit(U,d.data);return P}a.emit(V,d.data);return b})})));this.automaton.transition("create")};return e}(w);function _(a){return new Z(a)}exports.createAmpViewer=_;Object.defineProperty(exports,"__esModule",{value:true})});(function(){"use strict";var a=Function("return this")();var b,c={},d={16:false,18:false,17:false,91:false},e="all",f={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},h=function(a){return g[a]||a.toUpperCase().charCodeAt(0)},i=[];for(b=1;b<20;b++)g["f"+b]=111+b;function j(a,b){var c=a.length;while(c--)if(a[c]===b)return c;return-1}function k(a,b){if(a.length!=b.length)return false;for(var c=0;c<a.length;c++){if(a[c]!==b[c])return false}return true}var l={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function m(a){for(b in d)d[b]=a[l[b]]}function n(a){o(a);var b,e,g,h,k,l;b=a.keyCode;if(j(i,b)==-1){i.push(b)}if(b==93||b==224)b=91;if(b in d){d[b]=true;for(g in f)if(f[g]==b)s[g]=true;return}m(a);if(!s.filter.call(this,a))return;if(!(b in c))return;l=z();h=c[b].length;while(h--){e=c[b][h];if(e.scope==l||e.scope=="all"||p(e.scope)){k=e.mods.length>0;for(g in d)if(!d[g]&&j(e.mods,+g)>-1||d[g]&&j(e.mods,+g)==-1)k=false;if(e.mods.length==0&&!d[16]&&!d[18]&&!d[17]&&!d[91]||k){if(e.method(a,e)===false){a.preventDefault();a.stopPropagation()}if(a.isImmediatePropagationStopped()){return true}}}}}function o(a){var b=false,c=false,d=a.stopImmediatePropagation;!a.target&&(a.target=a.srcElement);!a.isDefaultPrevented&&(a.isDefaultPrevented=function(){return b});!a.isImmediatePropagationStopped&&(a.isImmediatePropagationStopped=function(){return c});!a.preventDefault&&(a.preventDefault=function(){b=true;a.returnValue=false});!a.stopPropagation&&(a.stopPropagation=function(){a.cancelBubble=false});a.stopImmediatePropagation=function(){c=true;a.stopPropagation();d&&d.call(a)}}function p(a){if(a&&a.nodeType===1){do{if(a===document.body){return true}}while(a=a.parentNode)}return false}function q(a){var b=a.keyCode,c,e=j(i,b);if(e>=0){i.splice(e,1)}if(b==93||b==224)b=91;if(b in d){d[b]=false;for(c in f)if(f[c]==b)s[c]=false}}function r(){for(b in d)d[b]=false;for(b in f)s[b]=false}function s(a,b,d){var e,f,g;e=B(a);if(d===undefined){d=b;b="all"}for(var i=0;i<e.length;i++){f=[];a=e[i].split("+");if(a.length>1){f=C(a);a=[a[a.length-1]]}a=a[0];a=h(a);if(!(a in c))c[a]=[];g=u(a,b,d,f);if(g>-1){c[a].push(c[a].splice(g,1)[0])}else{c[a].push({shortcut:e[i],scope:b,method:d,key:e[i],mods:f})}}}function t(a,b,d){var e,f,g=[],i,j;e=B(a);if(!b||typeof b==="function"){d=b;b="all"}for(i=0;i<e.length;i++){f=e[i].split("+");if(f.length>1){g=C(f)}a=f[f.length-1];a=h(a);if(b===undefined){b=z()}do{j=u(a,b,d,g);if(j>-1){c[a].splice(j,1)}}while(j!=-1)}}function u(a,b,d,e){var f,g,h=c[a];if(h){for(f=0;f<h.length;f++){g=h[f];if(g.scope===b&&(d===undefined||g.method===d)&&k(g.mods,e)){return f}}}return-1}function v(a){if(typeof a=="string"){a=h(a)}return j(i,a)!=-1}function w(){return i.slice(0)}function x(a){var b=a.target.tagName;return!(b=="INPUT"||b=="SELECT"||b=="TEXTAREA")}for(b in f)s[b]=false;function y(a){e=a||"all"}function z(){return e||"all"}function A(a){var b,d,e;for(b in c){d=c[b];for(e=0;e<d.length;){if(d[e].scope===a)d.splice(e,1);else e++}}}function B(a){var b;a=a.replace(/\s/g,"");b=a.split(",");if(b[b.length-1]==""){b[b.length-2]+=","}return b}function C(a){var b=a.slice(0,a.length-1);for(var c=0;c<b.length;c++)b[c]=f[b[c]];return b}function D(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,function(){c(window.event)})}D(document,"keydown",function(a){if(n(a)!==true){var b=key.listeners,c=0,d=b.length;for(;c<d;c++){b[c](a);if(a.isImmediatePropagationStopped()){return true}}}});D(document,"keyup",q);D(window,"focus",r);var E=a.key;function F(){var b=a.key;a.key=E;return b}a.key=s;a.key.setScope=y;a.key.getScope=z;a.key.deleteScope=A;a.key.filter=x;a.key.isPressed=v;a.key.getPressedKeyCodes=w;a.key.noConflict=F;a.key.unbind=t;a.key.on=s;a.key.off=t;a.key.listeners=[];if(typeof module!=="undefined")module.exports=s;define("@mail/keymaster",[],function(){return s})})(this);(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@mail/release-detect",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@mail/release-detect"]={}))})(this,function(exports){"use strict";var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]};return a(b,c)};function b(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var c=function(){c=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return c.apply(this,arguments)};var d=function(a){b(c,a);function c(b){var c=a.call(this,"Assertion error: "+b)||this;c.name="AssertionError";return c}return c}(Error);function e(a,b){if(a&&typeof a=="object"){return}throw new d(b+" is not an object")}function f(a,b){if(typeof a!=="string"){throw new d(b+" is not a string")}}function g(a,b){if(!(a instanceof Date)||isNaN(+a)){throw new d(b+" is not a valid Date")}}function h(a,b){e(a,b);f(a["name"],b+".name");f(a["branch"],b+".branch");g(a["date"],b+".date");f(a["dateStr"],b+".dateStr")}function i(a,b){if(a){var c=a.split("."),e=c[0],f=c[1];if(e&&f){var g=new Date(f.replace(/_/g,":"));var i={name:a,branch:e,date:g,dateStr:f};h(i,b);return i}}throw new d(b+" is not a valid build string")}function j(a,b){e(a,b);if(a["build"]!==undefined){f(a["build"],b+".build")}}function k(a,b){j(a,b);return a}function l(a){return!!a&&typeof a==="object"&&typeof a["status"]==="number"}function m(a){return!!a.body&&typeof a.body==="object"&&a.status>=200&&a.status<300}var n=function(a){b(c,a);function c(b,c){var d=a.call(this,"XHRError on url "+c+": status "+b)||this;d.name="XHRError";d.status=b;d.url=c;return d}return c}(Error);function o(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4){if(e.status>=200&&e.status<300){c(e.responseText)}else{d(new n(e.status,a))}}};e.open("GET",a,true);e.timeout=b;e.send()})}var p=function(){function a(a,b){var d=this;if(b===void 0){b=3e4}this._data={};this._initialData={};this.shadowReloadPage=function(a,b){var e;d._initialData=c(c({},d._initialData),d._data);b("deploy_shadow",{i:(e={},e[d.config.name]=1,e)})};this.config=a;this.timeout=b;if(a.initialData){this._data=a.initialData;this._initialData=a.initialData}}Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:false,configurable:true});a.prototype.update=function(){var a=this;var b=this._initialData;var c=typeof this.config.endpoint==="function"?this.config.endpoint():this.config.endpoint;return o(c,this.timeout).then(function(d){var e,f;var g=JSON.parse(d);var h={};if(l(g)){if(!m(g)){throw new n(g.status,c)}h=g.body}else{h=k(g,a.config.name)}var i=a.config.comparator(b,h);a._data=h;(f=(e=a.config).ondata)===null||f===void 0?void 0:f.call(e,h,a.config);if(a.config.shadow&&i.changed){i.reloadPage=a.shadowReloadPage}return i})};return a}();var q=["code","errno","syscall"];function r(a){if(!a||typeof a!=="object"){return a}if(typeof a.toJSON==="function"){return a.toJSON()}var b=c(c({},a),{name:a.name,message:a.message,stack:a.stack});for(var d=0,e=q;d<e.length;d++){var f=e[d];b[f]=a[f]}return b}function s(a){return Number.isNaN(a[0])||Number.isNaN(a[1])}function t(a,b){return b[0]<a[0]}function u(a,b){return b[1]<a[1]}function v(a){var b=a[0],c=a[1];return Math.floor(Math.random()*(c-b))+b}var w=function(){function a(a){var b=this;this._onError=function(a){var c;var d=false;if(a&&typeof a==="object"){if(a.name==="AssertionError"){b._radar(["deploy_fail","upd"])}if(a.name==="XHRError"){b._radar(["deploy_fail","xhr"],{i:(c={},c["status_"+a.status]=1,c)});d=true}}b._radar("deploy_fetch-error",!d?{rlog:"deploy_fetch-error",rlog_message:a instanceof Error?r(a):{error:"unknown"}}:undefined)};this._reload=function(a){location.href=a};this._config=c({},a);this._models=this._config.sources.map(function(b){return new p(b,a.xhrTimeout)});this._config.router.on("route-end",function(){b._fetchAndProcessConfig()});this._data=this._currentData()}a.prototype._currentData=function(){var a={};for(var b=0,c=this._models;b<c.length;b++){var d=c[b];var e=d.data;var f=Object.keys(e);for(var g=0,h=f;g<h.length;g++){var i=h[g];a[i]=e[i]}}return a};a.prototype._updateAll=function(){var a=this;return Promise.all(this._models.map(function(b){return b.update().catch(a._onError)})).then(function(a){var b={changed:false,reloadTimeRange:[NaN,NaN]};for(var c=0,d=a;c<d.length;c++){var e=d[c];if(!e||!e.changed){continue}b.changed=true;b.reloadPage=e.reloadPage;if(e.reason!==undefined){b.reason=e.reason}var f=s(b.reloadTimeRange);var g=t(b.reloadTimeRange,e.reloadTimeRange);var h=u(b.reloadTimeRange,e.reloadTimeRange);if(f||g&&h){b.reloadTimeRange=e.reloadTimeRange}}return b})};a.prototype._fetchAndProcessConfig=function(){var a=this;this._updateAll().then(function(b){var c;if(!b.changed){return}var d=a._currentData();var e=i((c=d.build)!==null&&c!==void 0?c:"","next");a._scheduleReload(e,b);a._radar("deploy_upd")}).catch(this._onError)};a.prototype._scheduleReload=function(a,b){var c=this;var d=v(b.reloadTimeRange);var e=d*1e3*60;if(this._reloadTid){return}this._reloadTid=setTimeout(function(){c._reloadTid=undefined;c._config.router.one("before-route",function(a){var d,e;if(a.target.activeRequest){var f=(d=b.reloadPage)!==null&&d!==void 0?d:c._reload;var g=a.target.activeRequest.href;if(c._config.location){g=c._config.location(g)}f(g,(e=c._config.xraySend)!==null&&e!==void 0?e:function(){return undefined})}});c._radar("deploy_switch");c._radar(["deploy_"+a.branch,a.dateStr]);if(b.reason!==undefined){c._radar("deploy_"+b.reason)}},e);this._radar("deploy_switch_reload_timeout",{v:d})};a.prototype._radar=function(a,b){if(this._config.xraySend){this._config.xraySend(a,b)}};return a}();var x=function(a,b){var c=Object.keys(a);var d=Object.keys(b);var e=c.length===d.length&&c.every(function(c){if(a[c]===""||b[c]===""){return true}return a[c]===b[c]});return{changed:!e,reason:e?undefined:this.name,reloadTimeRange:this.reloadTimeRange}};var y=function(a,b){if(!a.build&&!b.build){return{changed:false,reloadTimeRange:this.reloadTimeRange}}if(!a.build||!b.build){return{changed:true,reason:"upd_empty",reloadTimeRange:this.reloadTimeRange}}var c=i(a.build,"current");var d=i(b.build,"next");var e=c.name===d.name;return{changed:!e,reason:e?undefined:"upd_"+(d.date>c.date?"up":"down"),reloadTimeRange:this.reloadTimeRange}};function z(a,b){return function(c){var d=encodeURIComponent(a)+"="+encodeURIComponent(b);var e=c.indexOf("?")>=0;return""+c+(e?"&":"?")+d}}function A(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return function(b){for(var c=0,d=a;c<d.length;c++){var e=d[c];b=e(b)}return b}}function B(a){return new w(a)}exports.appendQuery=z;exports.buildComparator=y;exports.combine=A;exports.createReleaseDetectClient=B;exports.hashComparator=x;Object.defineProperty(exports,"__esModule",{value:true})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("temporary/fix-signature",["require","exports","@mail/features","@mail/flags","@mail/xray","cfgUser","service/auth"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fixSignature=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=/[\x00-\x1F\x22\x3C\x3E\x3A\xAD]/g;function g(a){return a&&typeof a==="object"}function h(a){if(typeof a==="string"){var b=a.replace(f,"");if(b.length){return b}}return""}function i(a){return{body:a.body,status:a.status,requestID:a.requestID,uuid:a.uuid}}function j(a){if(!g(a)){try{return{notAnObject:JSON.stringify(a)}}catch(a){return{notAnObject:"JSON.stringify error"}}}if(a.status===406){if(g(a.data)){delete a.data.token}return __assign(__assign({},i(a)),{data:a.data})}if(typeof a.status==="number"){return i(a)}return{name:a.name,message:a.message,stack:a.stack}}function k(){var a=d.default.get("initialUser.signs");if(!Array.isArray(a)){c.default.send("sign-fix_emptysigns");return Promise.resolve({hasBroken:false})}if(a.length===0){c.default.send("sign-fix_zerosigns");return Promise.resolve({hasBroken:false})}var b=false;var f=a.map(function(a){if(!g(a)){c.default.send("sign-fix_emptysign");return{}}a.name=h(a.name);var d=a.sign,e=a.sign_html;if(d&&!e){c.default.send("sign-fix_nohtml");return a}var f=d;try{var i=document.createElement("div");i.style.cssText="position: fixed; top: -9999px; left: -9999px;";i.setAttribute("contenteditable","true");document.body.appendChild(i);i.innerHTML=e;f=i.innerText;document.body.removeChild(i)}catch(a){b=true;c.default.send("sign-fix_reparserr",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_parseerr",error:a}})}return __assign(__assign({},a),{sign:f})});if(f.some(function(a){var b=a.name;return!b})){c.default.send("sign-fix_noname");return Promise.resolve({hasBroken:true})}return e.default.login().then(function(a){return a.save({signs:f}).catch(function(a){c.default.send("sign-fix_save_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_save_err",e:j(a)}});return{hasBroken:true}}).then(function(){return{hasBroken:b}})},function(a){c.default.send("sign-fix_userget_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_userget_err",e:a}});return{hasBroken:false}})}function l(){var d=b.default.get("user-signature-fix");var e=a.default.has("user-signature-fixer-enabled");var f=d.state;if(!e||f){return}k().then(function(a){var b=a.hasBroken;d.save({state:true,time:true,hit:b}).then(function(){c.default.send("sign-fix_success")},function(a){c.default.send("sign-fix_helpersave_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_helpersave_err",e:a}})})})}exports.fixSignature=l});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/page-title",["require","exports","cfg","default-values","Emitter","feast","helpers/browser","pilotjs","service/calls","service/mailbox/on-status/unread-messages-notifications"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getNextBlinkingTitle=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);h=__importDefault(h);var i=document.title||i18n("Почта Mail.ru");var j=function(){function a(a,b){this._switched=false;var c=document.querySelector(a);var d=c&&c.getAttribute("href");this._el=c;this._href=d;this._defaultHref=d;this._switchedHref=b;this._switched=false}a.prototype._createIconElement=function(a){var b=this._el;if(!b){return}var c=document.createElement("LINK");for(var d=0,e=b.attributes;d<e.length;d++){var f=e[d];if(f.name==="href"){c.setAttribute("href",a)}else{c.setAttribute(f.name,f.value)}}return c};a.prototype.switch=function(a){if(!b.DYNAMIC_FAVICON){return}if(this._switched===a){return}this._switched=a;this._href=this._switched?this._switchedHref:this._defaultHref;this._el.parentNode&&this._el.parentNode.removeChild(this._el);this._el=this._createIconElement(this._href);if(this._el){document.head.appendChild(this._el)}};return a}();var k=function(b){__extends(c,b);function c(){var c=b.call(this)||this;c._blinkingInterval=null;c._timeoutId=null;c._blinkingInProcess=false;c._titles={original:"",custom:""};c._iconSwitchers=[new j('link[rel="icon"][sizes="16x16"]',a.default.get("faviconURL")+"/16-fav_mail_unread.png"),new j('link[rel="icon"][sizes="24x24"]',a.default.get("faviconURL")+"/24-fav_mail_unread.png"),new j('link[rel="icon"][sizes="32x32"]',a.default.get("faviconURL")+"/32-fav_mail_unread.png"),new j('link[rel="icon"][sizes="48x48"]',a.default.get("faviconURL")+"/48-fav_mail_unread.png")];return c}c.prototype.start=function(a){this._titles.original=a.originalTitle;this._titles.custom=a.customTitle;this._blinkingInterval=a.timeout;this._blinkingInProcess=true;if(a.enableIconSwitch){this._iconSwitchers.forEach(function(a){return a.switch(true)})}this._blinkingStep()};Object.defineProperty(c.prototype,"blinkingInProcess",{get:function(){return this._blinkingInProcess},enumerable:false,configurable:true});c.prototype.update=function(a){this._titles.original=a.originalTitle;this._titles.custom=a.customTitle;this._blinkingInterval=a.timeout;this._iconSwitchers.forEach(function(b){return b.switch(!!a.enableIconSwitch)})};c.prototype.stop=function(){this._blinkingInProcess=false;this._iconSwitchers.forEach(function(a){return a.switch(false)});this.emit("update",{title:this._titles.original});clearTimeout(this._timeoutId)};c.prototype._getTitleToShow=function(){return document.title===this._titles.original?this._titles.custom:this._titles.original};c.prototype._blinkingStep=function(){this.emit("update",{title:this._getTitleToShow()});this._timeoutId=window.setTimeout(this._blinkingStep.bind(this),this._blinkingInterval)};return c}(c.default);var l={calls:null,message:null,folder:null};var m=function(a){var b=[a.calls,a.message];return b.find(function(a){return a!==null})||null};exports.getNextBlinkingTitle=m;exports.default=d.default.Mediator.create("page-title",{defaults:function(){this.register(this.blinker=new k);this.register(g.default);this.updateFolderTitle=this.updateFolderTitle.bind(this)},components:{router:{class:f.default,events:["route"],handleEvent:"handleRoute"},"unread-notifier":{class:h.default,events:["update"],handleEvent:"handleNotifier"},blinker:{class:k,events:["update"],handleEvent:"setTitle"},callsService:{class:g.CallsService,events:["update"],handleEvent:"handleCall"}},updateFolderTitle:function(a){if(!a||!a.target){return}var b=a.target;var c=b.get("messages_unread")?i18n("({unreadCount}) {folderName} - {defaultTitle}",{unreadCount:b.get("messages_unread"),folderName:b.get("name"),defaultTitle:i}):i18n("{folderName} - {defaultTitle}",{folderName:b.get("name"),defaultTitle:i});l.folder={title:c};this.setNextTitle()},handleRoute:function(a){if(a===void 0){a=null}if(a){l.folder={title:this.getTitleFromEvent(a)};this.setNextTitle()}},handleNotifier:function(a){if(a){var b=a.timeout,c=a.count;var d=this.getTitleByUnreadMessages(c);l.message={title:d,timeout:b}}else{l.message=null}this.setNextTitle()},handleCall:function(a){var c=a.action,d=a.text;if(!b.CALL_TITLE_BLINK_INTERVAL){return}if(c==="start"){var e=d+i18n(" - {defaultTitle}",{defaultTitle:i});l.calls={title:e,timeout:b.CALL_TITLE_BLINK_INTERVAL}}else if(c==="end"){l.calls=null}this.setNextTitle()},setNextTitle:function(){var a=exports.getNextBlinkingTitle(l);if(e.default.isSafari&&a&&a===l.calls){this.blinker.stop();this.setTitle({title:a.title});return}if(a){var b={timeout:a.timeout,customTitle:a.title,enableIconSwitch:a===l.message,originalTitle:l.folder.title||i};this.blinker.blinkingInProcess?this.blinker.update(b):this.blinker.start(b);return}if(this.blinker.blinkingInProcess){this.blinker.stop()}if(l.folder){this.setTitle({title:l.folder.title});return}this.setTitle({title:i})},setTitle:function(a){var b=a.title;document.title=b},getTitleFromEvent:function(a){if(this.folder){this.folder.off("change",this.updateFolderTitle);this.folder=null}if(!a.target||!a.target.model){return i}var b=a.target.model;var c;switch(b.route.id){case"#letters":if(b.folder){c=b.folder.get("messages_unread")?i18n("({unreadCount}) {folderName}",{unreadCount:b.folder.get("messages_unread"),folderName:b.folder.get("name")}):b.folder.get("name");b.folder.on("change",this.updateFolderTitle);this.folder=b.folder}break;case"#search":c=i18n("Поиск");break;case"#attachment":c=b.attachment&&b.attachment.get("name");break}return c?i18n("{title} - {defaultTitle}",{"unsafe-title":c,defaultTitle:i}):i},getTitleByUnreadMessages:function(a){return i18n.plural(a,[i18n("{count} новых писем",{count:a}),i18n("{count} новое письмо",{count:a}),i18n("{count} новых письма",{count:a})])}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/calendar-manager",["require","exports","@mail/xray","cfg","default-values","feast","feast-mod/correspondents","helpers/opener","mail/Message","mail/Thread","pilotjs","service/fishing","ui-block/calendar-button/calendar-button","ui-block/compose-dropdown/compose-dropdown","ui-block/contextmenu-message/contextmenu-message","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CalendarManager=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);var p=1500;var q=100;var r=255;var s=4096;var t=["calendar:create","calendar:createnew"];var u=function(d){__extends(u,d);function u(){return d!==null&&d.apply(this,arguments)||this}u.prototype.getComponentsSpec=function(){return{router:{class:i.default},letter:{lazy:o.lazyUILetter,events:t},"calendar-button":{class:k.default,events:t},"contextmenu-message":{class:m.default,events:t},"dropdown-actions":{class:n.default,events:t},"compose-dropdown":{class:l.default,events:t}}};u.prototype.handleEvent=function(a){var b=a.type;var c=a.details,d=c.model,e=c.createContent;var f={type:b};var h=f.type.split(":").pop();if(h==="createnew"){return this.doAction(h,g.default.getSafe(),e)}var i=this.get("router.model.letter");return this.doAction(h,d||i,e)};u.prototype.doAction=function(a,d,e){if(!d){return}if(d instanceof h.default&&d.get("messages.length")){d=d.getExpandMessage()}if(c.USE_X_CALENDAR){this.createEventInXCalendar(a,d,e);return}if(a==="create"){var g=this.constructForm(d);document.body.appendChild(g);j.default.go(g);document.body.removeChild(g)}else if(a==="createnew"){var i=b.default.get("urls.calendarUrl")||"//calendar.mail.ru";f.default(i+"?action=eventCreate")}return false};u.prototype.createEventInXCalendar=function(a,c,d){var e=b.default.get("urls.xCalendarUrl")||"//x.calendar.mail.ru";var g=this.getCategory(c);var h=a==="create"?{action:"createEvent",title:this.getSummary(c,r),emails:!g?this.getAttendees(c,q):null,description:this.getDescription(c,1e3),createContent:d}:{action:"createEvent",createContent:d};f.default(e+"?"+this.getCalendarCreateQueryParamsString(e,h))};u.prototype.getCalendarCreateQueryParamsString=function(b,c){var d=s-(b+"?").length;return Object.entries(c).filter(function(a){var b=a[1];return b}).reduce(function(b,c){var e;var f=c[0],g=c[1];var h=b+"&"+i.default.queryString.stringify((e={},e[f]=g,e));if(h.length>d){a.default.send("clnd_create_"+f+"_limit");return b}return h},"")};u.prototype.constructForm=function(a){var c=document.createElement("form");c.setAttribute("method","post");c.setAttribute("target","_blank");c.setAttribute("action",b.default.get("urls.calendarUrl")||"//calendar.mail.ru");c.setAttribute("style","position: absolute;left: -1000px;top: -1000px;width: 0px;height: 0px;");var d=this.constructFormData(a);Object.keys(d).forEach(function(a){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",a);b.setAttribute("value",d[a]);c.appendChild(b)});return c};u.prototype.constructFormData=function(a){return{description:this.getDescription(a),summary:this.getSummary(a),attendees:this.getAttendees(a),category:this.getCategory(a),dtfrom:this.getPriorityDate(a)}};u.prototype.getSummary=function(a,b){var c=(a.get("subject")||i18n("<Без темы>")).replace(/(((Fwd|Re)[?[\d]*]?:[\s]*)+)/i,"").trim();if(c.length>b){return c.slice(0,b-3)+"..."}return c};u.prototype.getDescription=function(a,b){if(b===void 0){b=p}var c=(a.get("body.text")||a.get("snippet")||"").trim();if(c.length>b){c=c.slice(0,b-3)+"..."}return c};u.prototype.getAttendees=function(a,b){return e.getAllCorrespondentsEmailsFromMessage(a).slice(0,b).join(",")};u.prototype.getCategory=function(a){var b=a.get("transaction_category");var c=a.getFolder();var d=c.isMetathread()&&c.get("type");return b||d||""};u.prototype.getPriorityDate=function(a){return a.get("dates_metadata.priority_date.timestamp",void 0)};return u}(d.default.Mediator);exports.CalendarManager=u;exports.default=d.default.Mediator.createFromClass("calendar-manager",u)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/calls-manager",["require","exports","feast","mail/Message","mail/Thread","pilotjs","service/calls","service/compose","service/notify","ui-block/compose-dropdown/compose-dropdown","ui-block/contextmenu-message/contextmenu-message","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CallsManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);var l=["calls:invite","calls:invitenew"];var m=function(a){__extends(m,a);function m(){return a!==null&&a.apply(this,arguments)||this}m.prototype.getComponentsSpec=function(){return{router:{class:d.default},letter:{lazy:k.lazyUILetter,events:l},"contextmenu-message":{class:i.default,events:l},"dropdown-actions":{class:j.default,events:l},"compose-dropdown":{class:h.default,events:l}}};m.prototype.handleEvent=function(a){var c=a.type;var d=a.details.model;var e=this.get("router.model.letter");var f={type:c};var g=f.type.split(":").pop();if(g==="invitenew"){return this.doAction(g,b.default.getSafe())}return this.doAction(g,d||e)};m.prototype.doAction=function(a,b){if(!b){return false}if(b instanceof c.default&&b.get("messages.length")){b=b.getExpandMessage()}var d=a==="invitenew"?{mode:"new",subject:e.default.getSubject()}:{mode:"replyall",model:b};f.default.open(d);e.default.createRoom().then(function(a){var b=e.default.getTemplate(a);if(f.default.isComposeActive()){f.default.insertHtml(b)}else{f.default.open(__assign(__assign({},d),{body:b,additionalOptions:{prefilledBody:true}}))}}).catch(function(a){if(a==="ratelimit"){g.default.error({text:i18n("Достигнут лимит создания звонков. Попробуйте позже.")},"compose-notify")}else{g.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")}});return false};return m}(a.default.Mediator);exports.CallsManager=m;exports.default=a.default.Mediator.createFromClass("calls-manager",m)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/welcome-block-manager",["require","exports","@mail/flags","default-values","feast","helpers/getCurrentTimestamp","helpers/opener","helpers/rb","mail/Folder","models/welcome-block-letter/welcome-block-letter","pilotjs","service/radars/index","ui-block/dataset/dataset","ui-block/dataset-letters/dataset-letters","ui-block/list-letter-welcome/list-letter-welcome","ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WelcomeBlockManager=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importStar(l);m=__importStar(m);n=__importStar(n);o=__importStar(o);var p="welcome-block";function q(a){return a.details&&a.details.hasOwnProperty("skill")}var r=function(c){__extends(r,c);function r(){var a=c!==null&&c.apply(this,arguments)||this;a.pollingWeatherPid=null;a.canShowChecked=false;return a}r.prototype.getComponentsSpec=function(){return{router:{class:i.default,events:["routeend"],handleEvent:"handleRouteEvent"},"dataset-letters":{class:l.default,events:[l.DatasetLettersEvents.NewRange]},dataset:{class:k.default},"list-letter-welcome":{class:m.default,events:[m.Events.MOUNT,m.Events.HIDE]},"list-letter-welcome-suggestions":{class:o.default,events:[o.Events.SuggestionClick],handleEvent:"handleMarusiaEvent"},"list-letter-welcome-dropdown-actions":{class:n.default,events:[n.Events.PIN,n.Events.SELECT_GEO,n.Events.SNOOZE]}}};r.prototype.handleMarusiaEvent=function(a){if(!q(a)){return false}switch(a.details.skill){case"music":{break}}return false};r.prototype.handleRouteEvent=function(){var a=this.get("router");if(!a||!this.isVisible()){return}var b=a.route.is("#letters")||a.model.uiLayout.type==="3pane"&&a.model.uiLayout.support3pane&&a.route.is("#read-letter");if(!b||a.route.params.folder!==g.default.INBOX){this.hide();j.default(["ll-wlcm","hide-on","route"])}};r.prototype.handleEvent=function(a){var c,d,f,h;var i=this.get("router");switch(a.type){case l.DatasetLettersEvents.NewRange:var k=a.details.start;if(this.isVisible()&&((c=i===null||i===void 0?void 0:i.route)===null||c===void 0?void 0:c.params.folder)===g.default.INBOX&&k>b.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD){this.hide();j.default(["ll-wlcm","hide-on","scroll"])}break;case m.Events.MOUNT:if(!this.canShowChecked){this.canShowChecked=true;if(this.canShow()){this.show();j.default(["ll-wlcm","can-show"])}else{j.default(["ll-wlcm","cannot-show"])}}if((d=this.getModel())===null||d===void 0?void 0:d.is("visible")){this.startPollingWeather()}if((f=this.getModel())===null||f===void 0?void 0:f.is("withGreeting")){this.delayedHideGreeting()}break;case m.Events.SHOW:if((h=this.getModel())===null||h===void 0?void 0:h.is("visible")){this.startPollingWeather()}break;case m.Events.HIDE:this.stopPollingWeather();break;case n.Events.PIN:break;case n.Events.SELECT_GEO:e.default(b.SELECT_GEO_URL+"?from=mailwelcome");break;case n.Events.SNOOZE:this.hide(true);j.default(["ll-wlcm","hide-on","snooze"]);break}return false};r.prototype.startPollingWeather=function(){var a=this;if(!this.pollingWeatherPid){this.fetchWeather();this.pollingWeatherPid=window.setInterval(function(){a.fetchWeather()},b.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL*1e3)}};r.prototype.stopPollingWeather=function(){window.clearInterval(this.pollingWeatherPid);this.pollingWeatherPid=null};r.prototype.delayedHideGreeting=function(){var a=this;window.setTimeout(function(){var b;(b=a.getModel())===null||b===void 0?void 0:b.set("withGreeting",false)},b.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT*1e3)};r.prototype.fetchWeather=function(){var a=this;f.default.getSlot("t1189").then(function(b){var c=a.getModel();c===null||c===void 0?void 0:c.set("weatherData",b)})};r.prototype.getFlag=function(){return a.default.get(p)};r.prototype.isSnoozed=function(){return this.getFlag().getCount("show")%2===1};r.prototype.getModel=function(){return h.default.all[0]};r.prototype.updateDataset=function(){var a=this;setTimeout(function(){var b;(b=a.get("dataset"))===null||b===void 0?void 0:b.updateItems()})};r.prototype.canShow=function(){var a=this.getFlag();var c=a.getTime();var e=this.isSnoozed()?b.WELCOME_BLOCK_SNOOZE_INTERVAL:b.WELCOME_BLOCK_SHOW_INTERVAL;var f=d.getCurrentTimestamp();return f>c+e};r.prototype.isVisible=function(){var a;return(a=this.getModel())===null||a===void 0?void 0:a.is("visible")};r.prototype.show=function(){var a;var b=this.isVisible();(a=this.getModel())===null||a===void 0?void 0:a.set("visible",true);this.updateDataset();if(!b){var c=this.getFlag();var d=this.isSnoozed();c.save({time:true,hit:d})}};r.prototype.hide=function(a){var b;if(a===void 0){a=false}if(this.isVisible()){(b=this.getModel())===null||b===void 0?void 0:b.set("visible",false);this.updateDataset();var c=this.getFlag();var d=a&&!this.isSnoozed();c.save({time:true,hit:d})}};return r}(c.default.Mediator);exports.WelcomeBlockManager=r;exports.default=c.default.Mediator.createFromClass("welcome-block-manager",r)});define("helpers/logger",["exports","@mail/features","helpers/parse","logger","mail/Attachment","service/notify","service/radars/index","./create-message-form-data"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendLogs=y;var h=m(a);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function p(a,b){var c=new Blob([a],{type:"text/plain"});c.name=b;return c}var q=h.default.getAsJSON("logger-config",{});var r={Body:true,Subject:true,body:true,"body.html":true,subject:true,name:true,signature:true,translate_query:true,token:true};if(q.ignoreKeys){Object.assign(r,q.ignoreKeys)}var s={"/api/v1/utils/translate":{query:true}};if(q.ignoreUrlKeys){Object.assign(s,q.ignoreUrlKeys)}var t={insert_success:{result:true},success:{jqXHR:true,direct:true,target:true}};var u=parseInt(q.maxDepth,10)||10;var v=function a(b){if(b&&(typeof b==="undefined"?"undefined":o(b))==="object"){return b.length}return void 0};var w=function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:r;if(!b){return b}if((typeof b==="undefined"?"undefined":o(b))!=="object"){return b}if(b.toLogJSON){b=b.toLogJSON()}if(c&&t[c]){e=n({},e,t[c])}return Object.keys(b).reduce(function(c,f){var g=b[f];if(f==="url"&&s[g]){e=n({},e,s[g])}if((typeof g==="undefined"?"undefined":o(g))==="object"){if(e[f]){c[f]=v(g);return c}if(d<=u&&!(g&&g.nodeType)){c[f]=a(g,null,d+1,e);return c}}else{c[f]=e[f]?v(g):g}return c},{})};i.default.filterArguments=w;function x(){var a={in_code:window.__trackJS.__errors,external:window.__trackJS.__externalErrors};var c={errors:a,loadLog:window.loadlogSteps};try{var d=f.radarService.loadPerformanceLog();if(Array.isArray(d)){d.slice().sort(function(a,b){if(a.startTime&&b.startTime&&a.startTime!==b.startTime){return a.startTime-b.startTime}return a.endTime-b.endTime})}else{(0,l.default)("invalid_notarr_perflog")}if((0,b.parseStringToBoolean)(q.inlinePerfLog)){i.default.add(JSON.stringify(d))}else{c.perfLog=d}}catch(a){i.default.add(a);console.error(a)}c.logs=(0,b.parseStringToBoolean)(q.usePrint)?i.default.print(true):i.default.entries;var e=void 0;try{e=JSON.stringify(c)}catch(a){i.default.add(a);console.error(a)}var m=h.default.get("email_logs_to");if(m&&m.data){m=m.data.split(",")}else{m=["aleksandr.tsvetkov@corp.mail.ru"]}var n=m[0];var o=m.slice(1,m.length);var r=(0,g.createMessageFormData)({subject:"[octavius client logs]",priority:1,body:{text:"",html:""},correspondents:{to:[{email:n}],cc:o.map(function(a){return{email:a}})}});var s=void 0;try{s=j.default.from(p(e,"logs.json"))}catch(a){r.set("body.html",e);console.error(a);(0,l.default)("log_file_create_fail")}var t=s?r.addAttachment(s):Promise.resolve();t.then(function(){return r.send()}).then(function(){if(k.default.isReady()){k.default.add({qa:"sent-logs",text:i18n("Логи отправлены")})}}).catch(function(a){console.error(a);(0,l.default)("logs_send_fail");k.default.add({type:k.default.types.error,text:i18n("Логи не отправлены")})})}function y(){require(["default-values"],function(a){if(a.ENABLE_LOGGING){x()}})}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/visibility-watcher",["require","exports","@mail/xray","data-source/index","default-values","service/adv/config","service/smokescreen"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VisibilityAlertWatcher=void 0;a=__importDefault(a);b=__importDefault(b);e=__importDefault(e);var f=c.VISIBILITY_WATCHER_CONFIG.errThreshold,g=c.VISIBILITY_WATCHER_CONFIG.checkTimeout,h=c.VISIBILITY_WATCHER_CONFIG.disabled;var i={left:function(a,b){return b-a},right:function(a,b){return a-b},top:function(a,b){return b-a},bottom:function(a,b){return a-b}};var j={left:function(){return 0},top:function(){return 0},right:function(){var b=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--vkui--octavius_size_layout_width_min--regular"));if(isNaN(b)){a.default.send("visibility_check_width_nan");return window.innerWidth}return Math.max(window.innerWidth,b)},bottom:function(){return window.innerHeight}};var k=Object.keys(i);function l(){var a;var c=b.default.getData();return{adv:{hasBlocker:d.hasBlocker(),hasAdBlock:d.hasAdBlock(),smokescreenEnabled:e.default.isEnabled()},layout:c.uiLayout,route:{href:(a=c.request)===null||a===void 0?void 0:a.href}}}var m=function(){function b(b){var c=this;var d=b.name,e=b.timeout,f=e===void 0?g:e,h=b.once,i=h===void 0?true:h;this.alertIfNotVisible=function(){c.didCheck=true;var b=c.getElementDocumentOverflow();if(b.some(function(a){return a.hasWindowOverflow||a.hasDocumentOverflow})){a.default.send("visibility_check_"+c.name,{rlog:"octavius_vis-check_"+c.name,rlog_message:{directionsChecks:b,meta:l()}})}};this.name=d;this.timeout=f;this.once=i}b.prototype.schedule=function(a){if(h||this.once&&this.didCheck){return}this.getEl=a;this.timeoutID=window.setTimeout(this.alertIfNotVisible,this.timeout)};b.prototype.unschedule=function(){window.clearTimeout(this.timeoutID)};b.prototype.getElementDocumentOverflow=function(){var a=this.getEl().getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();return k.map(function(c){var d=b[c];var e=a[c];var g=j[c]();var h=i[c](e,d);var k=i[c](e,g);var l=h>f;var m=k>f;return{direction:c,hasWindowOverflow:m,hasDocumentOverflow:l,documentOverflow:h,windowOverflow:k,elementSide:e,documentSide:d,windowSide:g}})};return b}();exports.VisibilityAlertWatcher=m});define("feast-tpl!app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html",["feast"],function(a){return a.smartParse("<div></div>\n","app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html")});define("feast-tpl!ui-block/drag-and-drop/drag-and-drop.html",["feast-tpl!app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/create-message-with-attach",["require","exports","service/auth","service/compose","service/layer","service/radars/index","trackJS","./check-files-from-event","./create-message-form-data","./signature"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importStar(f);var i="<div><br/></div>";function j(){var b=g.createMessageFormData();b.set("features.subject_from_attachments",true);var c=h.getHTMLSignature(a.default.user);b.set("body.html",i+i+c);return{formData:b}}function k(a,c){var d=c.slice(0,a.MAX_ATTACHMENTS_COUNT);b.default.add(a,{isDragAndDrop:true,dragAndDropItem:{files:d}})}function l(a){return __awaiter(this,void 0,void 0,function(){var g,h,i,l,m,n;return __generator(this,function(o){switch(o.label){case 0:g=c.default.getInstance();if(g){g.onHide()}o.label=1;case 1:o.trys.push([1,3,,4]);h=j().formData;return[4,f.default({event:a,limit:h.MAX_ATTACHMENTS_COUNT})];case 2:i=o.sent(),l=i.files,m=i.error;if(m){if(m===f.CheckFilesError.MAX_FILES){c.default.open("max-attach-count",{onAttachClick:function(){return k(h,l)}},{})}return[2]}k(h,l);d.default("dnd_create_msg_success");return[3,4];case 3:n=o.sent();b.default.onFailSent({},n);if(n&&n.get){d.default("dnd_create_msg_err",n.status)}else{e.default.addErrorFromApp(n,"dnd-create-msg")}return[3,4];case 4:return[2]}})})}exports.default=l});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/save-file-to-yourself",["require","exports","default-values","service/auth","service/compose","service/layer","service/radars/index","trackJS","./check-files-from-event","./check-oversize-files","./create-message-form-data","./signature"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);var k="<div><br/></div>";function l(){var a=i.createMessageFormData();var c=b.default.user.attributes.name,d=c.first,e=c.last;var f=j.getHTMLSignature(b.default.user);a.set("body.html",k+k+f);var g=b.default.user.getEmail();var h=d||"";if(e){h=h+" "+e}a.set("correspondents.to",[{email:g,name:h||g}]);a.set("features.subject_from_attachments",true);return{formData:a}}function m(b,d){var e=d.slice(0,b.MAX_ATTACHMENTS_COUNT);return h.checkOversizeFiles(e).then(function(d){var f=!(a.OVERSIZE_CLOUD_ATTACHES&&d);c.default.add(b,{autosend:f,isDragAndDrop:true,dragAndDropItem:{files:e}})})}function n(a){return __awaiter(this,void 0,void 0,function(){var b,h,i,j,k,n;return __generator(this,function(o){switch(o.label){case 0:b=d.default.getInstance();if(b){b.onHide()}o.label=1;case 1:o.trys.push([1,3,,4]);h=l().formData;return[4,g.default({event:a,limit:h.MAX_ATTACHMENTS_COUNT})];case 2:i=o.sent(),j=i.files,k=i.error;if(k){if(k===g.CheckFilesError.MAX_FILES){d.default.open("max-attach-count",{onAttachClick:function(){return m(h,j)}},{})}return[2]}m(h,j);e.default("dnd_to_yourself_success");return[3,4];case 3:n=o.sent();c.default.onFailSent({},n);if(n&&n.get){e.default("dnd_send_self_msg_err",n.status)}else{f.default.addErrorFromApp(n,"dnd-to-yourself")}return[3,4];case 4:return[2]}})})}exports.default=n});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/drag-and-drop/drag-and-drop",["require","exports","@mail/features","cfg","default-values","feast","feast-tpl!./drag-and-drop.html","helpers/create-message-with-attach","helpers/load-file-to-cloud","helpers/save-file-to-yourself","service/compose","service/layer","service/radars/index","service/smokescreen"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);exports.default=d.default.Block.extend({name:"drag-and-drop",template:e.default,_getContainer:function(){return document.querySelector("#drag-and-drop")},attrChanged:{"dark-mode":function(a){if(this.ui){this.ui.$set({darkMode:a})}}},didMount:function(){var a=this;require(["mediator/themes-manager"],function(b){var c=b.default;c.registerInstanceByName("drag-and-drop",a)});this.renderUI()},didUnmount:function(){this.unrenderUI()},renderUI:function(){var a=this;this.unrenderUI();new Promise(function(a,b){require(["cross.project.dnd"],a,b)}).then(__importStar).then(function(b){var c=b.default;a.ui=c(a.getParams())})},unrenderUI:function(){var a;(a=this.ui)===null||a===void 0?void 0:a.$destroy();this.ui=null},getParams:function(){var a={"unsafe-markOpen":"<mark>","unsafe-markClose":"</mark>","unsafe-br":"<br>"};var d=i18n("Перетащите файлы в эту область,{br}чтобы {markOpen}написать письмо{markClose}",a);var e=i18n("Отправить {markOpen}письмо себе{markClose}",a);var i=i18n("Загрузить {markOpen}в Облако{markClose}",a);var j=this.is("dark-mode");var l=!!b.default.qa;return{target:this._getContainer(),darkMode:j,isQA:l,zones:[{size:1.5,zones:[{size:1,text:d,radarFunction:function(){return k.default("dnd_drop_create_letter")},iconSize:"large",iconName:"mail",dropFunction:f.default,testId:"drop-zone-mail"}]},{size:1,zones:__spreadArrays([{size:1,text:e,radarFunction:function(){return k.default("dnd_drop_to_yourself")},iconSize:"small",iconName:"self-mail",dropFunction:h.default,testId:"drop-zone-self-mail"}],c.DND_CLOUD_ENABLED?[{size:1,text:i,radarFunction:function(){return k.default("dnd_drop_to_cloud")},iconSize:"small",iconName:"cloud",dropFunction:g.default,testId:"drop-zone-cloud"}]:[])}],showRule:this._getShowRule(),onShow:this.showRadar,imgsBaseUrl:b.default.urls.packagesUrl,imgsPath:c.DND_IMAGES_PATH}},showRadar:function(){k.default("dnd_show")},_getShowRule:function(){var b=this;var c=a.default.has("drag-and-drop");if(!c){return function(){return false}}return function(){var a;var c=j.default.getInstance();var d=document.querySelectorAll(l.selector('[data-test-id="popup-wrapper"]')).length!==0;var e=b.get("router").model.route&&b.get("router").model.route.is("#attachment #attachment-temporary #attachment-editor");var f=(a=window===null||window===void 0?void 0:window.__PH)===null||a===void 0?void 0:a.authForm.isVisible();return!i.default.isComposeActive()&&!c&&!d&&!e&&!f}}})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/autoreply",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchAutoreply=exports.url=void 0;b=__importDefault(b);exports.url="filters/autoreply";function c(a){var c=a.emails,d=a.only_enabled,e=d===void 0?true:d;if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}return b.default.call(exports.url,{emails:c,only_enabled:e})}exports.fetchAutoreply=a.createGlobalAction(exports.url,function(a){return __awaiter(void 0,void 0,Promise,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,c(a)];case 1:b=d.sent();return[2,b.body]}})})})});define("feast-tpl!app/feast-tpl!ui-block/compose-app/compose-app.html",["feast"],function(a){return a.smartParse('<div qa:id="{(attrs[\'window-mode\'] === \'collapsed\') ? \'\' : \'compose-app\'}"\n\t qa:state="extended:{attrs[\'support-extend\'] && attrs.extended}"\n\t message-uid="{attrs.form.uid}">\n\t<bem:mod name="fix"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="mobile-xxs" test="attrs[\'mobile-xxs\']"/>\n\t<bem:mod name="popup" test="!attrs.fullscreen"/>\n\t<bem:mod name="popup-extended" test="attrs[\'support-extend\'] && attrs.extended"/>\n\t<bem:mod name="window" test="attrs[\'window-mode\'] === \'window\'"/>\n\t<bem:mod name="collapsed" test="attrs[\'window-mode\'] === \'collapsed\' || attrs.hidden"/>\n\t<bem:mod name="adaptive" test="attrs.adaptive && !attrs.fullscreen"/>\n\t<bem:mod name="fixed" test="!attrs.adaptive && !attrs.fullscreen"/>\n\n\t<b:focus-zone\n\t\t\tfluid\n\t\t\tenabled="{attrs[\'window-mode\'] !== \'collapsed\' && !attrs[\'focusoff\'] && !attrs[\'hidden\']}"\n\t\t\tbem:block="compose-app"\n\t\t\tremit:first="focus-zone:first"\n\t\t\tremit:last="focus-zone:last">\n\t\t<fn:match name="content">\n\t\t\t\x3c!--<div bem:elem="wrapper" ref="wrapper">--\x3e\n\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="compose"\n\t\t\t\t\t\tref="compose"\n\t\t\t\t>\n\t\t\t\t\t\x3c!-- COMPOSE.MAIL.RU --\x3e\n\t\t\t\t</div>\n\t\t</fn:match>\n\t</b:focus-zone>\n</div>\n',"app/feast-tpl!ui-block/compose-app/compose-app.html")});define("feast-tpl!ui-block/compose-app/compose-app.html",["feast-tpl!app/feast-tpl!ui-block/compose-app/compose-app.html"],function(a){return a});define("helpers/char-to-key",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a;function a(a){return String.fromCharCode(a).toLowerCase()}});define("helpers/scrollbar-width",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function a(){var b=document.createElement("div");b.style.overflowY="scroll";b.style.msOverflowStyle="scrollbar";b.style.width="50px";b.style.height="50px";b.style.visibility="hidden";document.body.appendChild(b);var c=b.offsetWidth-b.clientWidth;document.body.removeChild(b);return c}();exports.default=a});define("helpers/translation",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isCyrillic=b;function b(b){var c=b.length;var d=0;var e=0;for(var f=0;f<c;){var g=b.charCodeAt(f++);if(g>1040&&g<1103){d++;e++;continue}if(g>0&&g<64){continue}if((g&63488)==55296&&f<c){var h=b.charCodeAt(f++);if((h&64512)==56320){continue}}e++}return d*100/e>a.LETTER_CYRILLIC_PERCENT}});define("mail/actions/Schedule",function(require){"use strict";var a=require("Action"),b=require("RPC");var c=a.extend({operation:function(a){switch(a.method){case c.UPDATE:return this._update(a.data);case c.REMOVE:return this._remove(a.data);default:throw new Error("Действие не найдено",a.method)}},_update:function(a){return b.post("messages/schedule/update",a)},_remove:function(a){return b.post("messages/schedule/remove",a)}});c.UPDATE="UPDATE";c.REMOVE="REMOVE";a.register("mail.Schedule",c);c.version="0.2.0";return c});define("tab-indexes",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.compose={LABEL_TO:-1,LABEL_CC:-1,LABEL_BCC:-1,INPUT_ATTACH_FILE:-1,INPUT_TO:100,INPUT_CC:200,INPUT_BCC:300,INPUT_SUBJECT:400,BUTTON_ATTACH_FILE:500,EDITOR:505,EDITOR_ADDLINK_HREF:510,EDITOR_ADDLINK_TEXT:515,EDITOR_ADDLINK_SAVE:520,EDITOR_ADDLINK_CANCEL:525,EDITOR_ADDLINK_DELETE:530,BUTTON_SEND:570,BUTTON_SAVE:580,BUTTON_CANCEL:590,BUTTON_COLLAPSE:600,BUTTON_EXTEND:650,BUTTON_CLOSE:700,HEAD_CONTROL_FROM:710,HEAD_CONTROL_CC:720,HEAD_CONTROL_BCC:730,BUTTON_CLOSE_CC:900,BUTTON_CLOSE_BCC:1100,BUTTON_MONEY_SEND:1300,BUTTON_ATTACH_CLOUD:1400,BUTTON_ATTACH_MAIL:1500,DROPDOWN_TEMPLATES:1600}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-app/compose-app",["require","exports","@mail/contact-validation","@mail/features","@mail/flags","actions/autoreply","actions/checkContactsPossessing","cfg","cloud/Entry","default-values","Emitter","feast","feast-mod/file-count","feast-mod/file-size","feast-mod/letter-date","feast-tpl!./compose-app.html","helpers/browser","helpers/char-to-key","helpers/on-oversize-attach-add","helpers/opener","helpers/scrollbar-width","helpers/signature","helpers/translation","lazy.modules","logger","mail/actions/ContactSuggests","mail/actions/Schedule","mail/Alias","mail/Attachment","mail/Collector","mail/Folder","mail/Message","mail/MessageFormData","mrg-xray","RPC","service/addressbook/addressbook","service/auth","service/calls","service/cloud","service/compose","service/emoji","service/fishing","service/lastseenStrings","service/layer","service/mailbox/loader","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","service/storage","service/viewer","tab-indexes","trackJS","ui-block/button-link/button-link","ui-block/button2/button2","ui-block/focus-zone/focus-zone","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importStar(a);b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importStar(T);V=__importDefault(V);W=__importDefault(W);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);exports.default=j.default.Block.extend(S.default({events:[{name:"send",rename:function(a){return a.is("schedule")?"send_scheduled":"send"},data:function(a){return a.get("form")}},{name:"collapse"},{name:"mount",data:function(a){return a.get("form")}},{name:"close",data:function(a){return a.get("form")}}],explicit:true})({name:"compose-app",template:n.default,isolateEvents:false,performanceTrace:true,mods:{letterHours:m.letterHours},blocks:{button2:_.default,"button-link":Z.default,"focus-zone":aa.default,"react-async":ba.default},notVisualAttributes:{closing:true},defaults:{focusoff:false,form:null,"send-delay":0,"has-changes":false,"draft-on-close-enabled":true,"draft-timeout":h.AUTOSAVE_DRAFT_TIMEOUT_SECONDS,"template-enabled":false,saving:false,sending:false,fullscreen:false,mobile:h.TOUCH_MODE,ponymode:false,adaptive:false,hidden:false,"expand-status":false,closing:false,"translate-mode":false,darkMode:false,extended:false,"support-extend":true,autosend:false,"is-drag-and-drop":false,"drag-and-drop-item":null,errors:null,receipt:false,priority:3,schedule:false,scheduleDate:new Date,collectors:[],aliases:[]},events:{send:"onSend",save:"_updateComposeFields",shortcut:"onShortcut","nav:draft":"onNavDraft","nav:template":"onNavTemplate","focus-zone:first":"onRequestFirstFocus","focus-zone:last":"onRequestLastFocus","translation:use":"onTranslationSave","translation:cancel":"onTranslationCancel","translation:retry":"onTranslationRetry","first-render":"onFirstRender"},attrChanged:{errors:function(a){this.errors=a;this.composeRender()},priority:function(a){var b=this.get("form");b.set("priority",a);this.set("has-changes",true)},receipt:function(a){var b=this.get("form");b.set("receipt",a);this.set("has-changes",true)},sending:function(a,b){if(a!==b&&!a){this.get("form").set("finalized",false)}this.composeRender()},ponymode:function(){this.composeRender()},darkMode:function(){this.composeRender()},extended:function(){this.composeRender()},"mobile-xxs":function(){this.composeRender()},"support-extend":function(){this.composeRender()},"expand-status":function(){this._updateComposeVisuals()},"window-mode":function(){this.composeRender()},hidden:function(a){if(!a){this._setupFocus()}},sendDate:function(a){if(a){this.set({schedule:a,scheduleDate:new Date(a*1e3)})}this.composeRender()},schedule:function(a){var b=this.get("form");if(a){b.set("send_date",(this.get("scheduleDate").getTime()+"").slice(0,-3))}else{b.set("send_date","")}this.composeRender();this.set("has-changes",true)},scheduleDate:function(a){var b=this;new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar).then(function(c){if(!b.isMounted()){return}var d=c.default;var e=b.get("form");if(b.get("schedule")){e.set("send_date",(a.getTime()+"").slice(0,-3));b.set("scheduleText",d.getFullMomentFormat(a))}b.set("has-changes",true);b.composeRender()})},remind:function(a){var b=this.get("form");b.set("remind",a);this.set("has-changes",true)},"draft-on-close-enabled":function(a){this.setAutosaveOnClose(a)}},tabIndexes:X.compose,constructor:function(a,b){j.default.Block.call(this,a,b);this.onWindowUnload=this.onWindowUnload.bind(this);this.composeRender=this.composeRender.bind(this);this._updateComposeVisuals=this._updateComposeVisuals.bind(this);this._setupFocus=this._setupFocus.bind(this);this._changeTranslateMode=this._changeTranslateMode.bind(this);this.emitter=new i.default;this.emitter.on("translate-mode",this._changeTranslateMode);this.emitter.on("translation-error",this.onTranslationError.bind(this));this.emitter.on("translation-ok",this.onTranslationOk.bind(this))},didMount:function(){T.default("on_route_compose");this.composeRender()},composeRender:function(){var i=this;var j=this.get("compose-options");var n=this.get("form");var p=I.default.user.get("signs");var r=I.default.user.getEmail();var t=I.default.user.get("name");var y=t.first+" "+t.last;var C=this.get("collectors").filter(function(a){return a.canSendLetters()});var F=this.get("aliases");var H=this.is("support-extend")?this.onExtend.bind(this):null;this.onClose=this.onClose.bind(this);this.onCollapse=this.onCollapse.bind(this);this.sendLetter=this.sendLetter.bind(this);this.onReadyToSave=this.onReadyToSave.bind(this);this.onFilesFromCloud=this.onFilesFromCloud.bind(this);this.onFilesFromMail=this.onFilesFromMail.bind(this);this.onCallsInvite=this.onCallsInvite.bind(this);this.onContactsFromMail=this.onContactsFromMail.bind(this);this.openAddressbook=this.openAddressbook.bind(this);this.onSignatureFromMail=this.onSignatureFromMail.bind(this);this.onTemplateSelect=this.onTemplateSelect.bind(this);this.onSaveAsTemplate=this.onSaveAsTemplate.bind(this);this.onExceedMaxSize=this.onExceedMaxSize.bind(this);this.onComposeCreateTo=this.onComposeCreateTo.bind(this);this.onSearchFrom=this.onSearchFrom.bind(this);this.onContactAdd=this.onContactAdd.bind(this);this.onOpenAddressbook=this.onOpenAddressbook.bind(this);this.updateMailboxQuotas=this.updateMailboxQuotas.bind(this);this.lastSeenUpdate=this.lastSeenUpdate.bind(this);this.onSend=this.onSend.bind(this);this.onTranslationSave=this.onTranslationSave.bind(this);this.onTranslationCancel=this.onTranslationCancel.bind(this);this.onChangePriority=this.onChangePriority.bind(this);this.onChangeReceipt=this.onChangeReceipt.bind(this);this.onClickRemind=this.onClickRemind.bind(this);this.onChangeRemind=this.onChangeRemind.bind(this);this.onClickSchedule=this.onClickSchedule.bind(this);this.onChangeSchedule=this.onChangeSchedule.bind(this);this.onTranslationRetry=this.onTranslationRetry.bind(this);Promise.all([v.lazyFileAPI(),v.lazyClipboard(),L.default.preload()]).then(function(t){var v=t[0],J=t[1],L=t[2].ui;if(!i.isMounted()){return}var O=C.concat(F);i.compose=new L.default(i.refs.compose);i.compose.injectDependencies({Attachment:A.default,cloud:K.default,Alias:z.default,Collector:B.default,CloudEntry:g.default,Message:D.default,MessageFormData:E.default,FileAPI:v,RPC:G.default,ContactSuggests:x.default,checkContactsPossessing:e.checkContactsPossessing,Phishing:N.default,Clipboard:J,TabIndex:X.compose,browser:o.default,features:{CKE_ATTACH_BASE64:h.CKE_ATTACH_BASE64,CKE_CLIPBOARD_FIX:h.CKE_CLIPBOARD_FIX,CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED:h.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED,CKE_AUTOCORRECT_ALPHABET_LIST:h.CKE_AUTOCORRECT_ALPHABET_LIST,CKE_QUOTE_PARSE_FIX_DISABLE:h.CKE_QUOTE_PARSE_FIX_DISABLE,COMPOSE_EMOJI:h.COMPOSE_EMOJI,COMPOSE_EMOJI_FILTER:h.COMPOSE_EMOJI_FILTER,COMPOSE_EMOJI_RECENTLY_COUNT:h.COMPOSE_EMOJI_RECENTLY_COUNT,COMPOSE_SLIDER_LAST_STEP_DELTA:h.COMPOSE_SLIDER_LAST_STEP_DELTA,COMPOSE_TRANSLATOR:h.COMPOSE_TRANSLATOR,CORRESPONDENTS_LIMIT:h.CORRESPONDENTS_LIMIT,DISABLE_CALLS_COMPOSE_TIP:h.DISABLE_CALLS_COMPOSE_TIP,DISABLE_CLOUD:h.COMPOSE_DISABLE_CLOUD_ATTACHES,DISABLE_FROM_MAIL_ATTACHES:h.DISABLE_FROM_MAIL_ATTACHES,EMOJI_FALLBACK:h.EMOJI_FALLBACK,ENABLE_WYSIWYG_STICKY:h.ENABLE_WYSIWYG_STICKY,EXPIRED_ATTACHES_TOOLTIP:h.EXPIRED_ATTACHES_TOOLTIP,IS_NEW_ADDRESSBOOK:h.IS_NEW_ADDRESSBOOK,LETTER_TO_YOURSELF:h.LETTER_TO_YOURSELF,NEW_AB_SUGGEST:h.NEW_AB_SUGGEST,TRANSLATOR_REQUEST_TIMEOUT:h.TRANSLATOR_REQUEST_TIMEOUT,MAX_CLOUD_STOCK_SIZE_LIMIT:h.MAX_CLOUD_STOCK_SIZE_LIMIT,OVERSIZE_CLOUD_ATTACHES:h.OVERSIZE_CLOUD_ATTACHES,OVERSIZE_CLOUD_ATTACHES_FOLDER:h.OVERSIZE_CLOUD_ATTACHES_FOLDER,VK:h.VK,MESSAGES_ATTACHES_BLOBCLOUD:h.MESSAGES_ATTACHES_BLOBCLOUD,MESSAGES_ATTACHES_BLOBCLOUD_PATH:h.MESSAGES_ATTACHES_BLOBCLOUD_PATH,LASTSEEN_ONLINE_STATUS:h.LASTSEEN_ONLINE_STATUS,MOBILE_MODE:h.TOUCH_MODE,COMPOSE_FETCH_AUTOREPLY:h.COMPOSE_FETCH_AUTOREPLY,B2B_INNER_ATTACHMENTS_NOTIFY:h.B2B_INNER_ATTACHMENTS_NOTIFY},ContactValidation:a,radar:T.createConfiguredRadar({prefix:"cmps",data:n}),onError:function(a,b){Y.default.addErrorFromApp(a,b?"cmps_"+b:"cmps_internal_caught")},logger:w.default,scrollbarWidth:s.default,Storage:V.default,mods:{fileSize:l.fileSize,fileSizeRange:l.fileSizeRange,fileCount:k.fileCount,letterAttachLinkDate:m.letterAttachLinkDate},flags:c.default,emojiParser:M.default});var P=b.default.get("isNativeStickyDisabled");var Q=b.default.get("compose-expand-contacts");var R=i.get("router");i.compose.render({signatures:p,fromOptions:O,defaultEmail:r,userName:y,model:n,scrollTarget:i.refs.compose,templatesFetch:i.templatesFetch,lastSeenUpdate:i.lastSeenUpdate,suggestFinder:i.getSuggestFinder(),onFilesFromCloud:i.onFilesFromCloud,onFilesFromMail:i.onFilesFromMail,onCallsInvite:h.CALLS&&!h.CALLS_DISABLE_COMPOSE_BTN?i.onCallsInvite:null,onContactsFromMail:i.onContactsFromMail,onSignatureFromMail:i.onSignatureFromMail,onReadyToSave:i.onReadyToSave,onClose:i.onClose,onExtend:H,fetchAutoreply:d.fetchAutoreply,onComposeCreateTo:i.onComposeCreateTo,onSearchFrom:i.onSearchFrom,onTemplateSelect:i.onTemplateSelect,onSaveAsTemplate:i.onSaveAsTemplate,onExceedMaxSize:i.onExceedMaxSize,onCollapse:i.onCollapse,onContactAdd:i.onContactAdd,onOpenAddressbook:i.onOpenAddressbook,onOversizeAttachAdd:q.default,onAttachmentClick:function(a){if(h.DISABLE_COMPOSE_ATTACHMENT_CLICK){return}if(a.isCloudStock()||a.isCloud()){return}W.default.openTemporary({messageId:n.uid,formData:n,router:R,attachment:a})},updateMailboxQuotas:i.updateMailboxQuotas,isNativeStickyDisabled:P&&P.state,isNativeAttachThumbRotation:h.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION,isAllVisibleContactsFeature:Q&&Q.state,onChangeErrors:i.onChangeErrors,sendLetter:i.sendLetter,errors:i.errors||null,disableInterface:i.get("window-mode")==="collapsed"?true:i.get("sending"),eventEmitter:i.emitter,darkMode:i.get("darkMode"),extended:i.get("extended"),compressedMode:i.get("ponymode")&&!i.get("mobile-xxs"),mobileLayout:i.get("mobile"),mobilePhoneLayout:i.get("mobile-xxs"),qaParams:{enabled:f.default.get("qa")},additionalOptions:j,utils:{isCyrillic:u.isCyrillic},schedule:i.get("schedule"),scheduleText:i.get("scheduleText"),onSend:i.onSend.bind(i),onSave:i.onClickSave.bind(i),onTranslationUse:i.onTranslationSave,onTranslationCancel:i.onTranslationCancel,onChangePriority:i.onChangePriority,onChangeReceipt:i.onChangeReceipt,onClickRemind:i.onClickRemind,onChangeRemind:i.onChangeRemind,onClickSchedule:i.onClickSchedule,onChangeSchedule:i.onChangeSchedule,onTranslationRetry:i.onTranslationRetry,onFooterChooseTemplateClick:i.onFooterChooseTemplateClick.bind(i),translationHref:i.getPromtLogoHref(),avatarBaseUrl:f.default.get("urls.avatarUrl"),quotasEnabled:I.default.user.get("common_purpose_flags.enabled_mbox_quotas"),hideAvatar:h.COMPOSE_HIDE_AVATAR&&i.get("mobile-xxs"),unclickableLabels:h.COMPOSE_DISABLE_CLICKABLE_LABELS&&i.get("mobile-xxs"),hideToolbar:h.COMPOSE_DISABLE_TOOLBAR&&i.get("mobile-xxs"),shortAttachPanel:h.COMPOSE_SHORT_ATTACH_PANEL&&i.get("mobile-xxs"),hideChangeSignature:h.HIDE_CHANGE_SIGNATURE&&i.get("mobile-xxs"),hideCancelButton:h.HIDE_COMPOSE_CANCEL_BUTTON&&i.get("mobile-xxs"),hideWidgets:h.HIDE_COMPOSE_WIDGETS&&i.get("mobile-xxs"),footerDropdown:h.COMPOSE_FOOTER_DROPDOWN&&i.get("mobile-xxs")});if(!i.hasRendered){i.broadcast("first-render");i.hasRendered=true}})},onFirstRender:function(){var a=this;if(this.get("is-drag-and-drop")){var b=this.get("drag-and-drop-item");if(b){var c=b.files;if(this.compose.appComponent){this.compose.appComponent.addFilesToModel(c).then(function(b){if(a.get("autosend")){a.broadcast("send")}a.compose.appComponent.uploadFiles(b)}).catch(function(b){a.radar("dnd_err_"+b)})}}}},onContactAdd:function(a){a.scope="compose-notify";this.broadcast("addressbook:addcontact",a)},onOpenAddressbook:function(a){this.openAddressbook({"free-space":false,composeMode:false,openEmail:a.email},true)},onChangeErrors:function(a){this.errors=a},onSend:function(){var a=this.get("form");this._updateComposeFields();a.set("body.html",t.cleanHTMLSignature(a.get("body.html")),{silent:true});var b=this.get("autosend");var c=b?true:this.compose.appComponent.checkSend();if(c){this.sendLetter()}},getSuggestFinder:function(){if(h.NEW_AB_SUGGEST){return null}return H.default.lazyInit()},lastSeenUpdate:function(a){if(!h.LAST_SEEN_V2_ENABLE){return null}var b=this.get("getLastSeen");F.default.send("lastseen-v2-compose",{skipdwh:true});var c=h.LASTSEEN_COMPOSE_ALLOW_GARAGE;return b(a,{allowUseGarage:c}).then(function(b){var c=b.payload;var d=a.map(function(a){var b=c[a];return O.default(b).then(function(b){return{email:a,lastSeen:b}})});return Promise.all(d)})},sendLetter:function(){if(this.get("schedule")){this.broadcast("letter-schedule",{composeApp:this,scheduleText:this.get("scheduleText")})}else{this.broadcast("letter-send")}},templatesFetch:function(){return Q.default.load({folder:C.default.TEMPLATES,limit:25}).catch(function(){return{threads:[]}}).then(function(a){return a.threads.map(function(a){var b=a.subject||a.snippet;return{data:{folder:a.folder,id:a.expand,value:b.trim()?b:"<"+i18n("Без темы")+">"}}})})},onTemplateSelect:function(a){var b=this;var c=a.id,d=a.folder;var e=this.get("form");e.fetchTemplate({id:c,folder:d}).then(function(a){if(e.is("source.reply")||e.is("source.forward")){var c=e.mergeTemplate(a,{attachments:true});b.compose.applyTemplate(c)}else{b.broadcast("close",Object.assign(b,{noAnimate:true}));L.default.open({mode:"template",model:a})}})},didUnmount:function(){this.setAutosaveInterval(false);this.setAutosaveOnClose(false);try{this.compose.unmount()}catch(a){if(h.IS_DEBUG){console.error(a)}T.default({type:"compose_unmount_error",rlog:"octavius_jserror",rlog_message:JSON.stringify(a)})}},removeScheduleFromDatalist:function(a){var b=this.get("router");b.model.letters.filter(function(b){var c=b.getFolder();return c.isOutbox()&&b.get("last")===a}).forEach(function(a){b.model.letters.remove(a)})},removeSchedule:function(){var a=this;var b=this.get("form");var c=b.get("source.schedule");var d=b.get("source.draft");var e={id:c};if(d){e.source={draft:d}}y.default.execute({method:y.default.REMOVE,data:e}).then(function(){b.set("source.schedule","");b.set("source.draft",c);a.radar("remove_schedule");a.removeScheduleFromDatalist(c)}).catch(function(){a.radar("remove_schedule_error")})},onClickSave:function(){this._updateComposeFields();this.broadcast("letter-save")},onClickSchedule:function(a){var b=!this.get("schedule");var c=new Date(a);if(!b){c=new Date}this.set({schedule:b,scheduleDate:c});if(!b){this.removeSchedule()}this.composeRender()},onChangeSchedule:function(a){this.set({schedule:true,scheduleDate:new Date(a)})},onChangePriority:function(){this.set({priority:this.get("priority")===3?1:3})},onChangeReceipt:function(){this.set({receipt:!this.get("receipt")})},onClickRemind:function(a){var b=!!this.get("remind");this.set({remind:b?"":a})},onChangeRemind:function(a){this.set({remind:a})},onRequestFirstFocus:function(){var a=this.el.querySelector(U.selector('[tabindex="'+X.compose.INPUT_SUBJECT+'"]'));a&&a.focus()},onRequestLastFocus:function(){var a=this.el.querySelector(U.selector('[tabindex="'+X.compose.BUTTON_ATTACH_CLOUD+'"]'));a&&a.focus()},layerSingleton:function(a,b,c,d,e){var f=this;if(!this.activeLayer){this.activeLayer=new Promise(function(g,i){a.then(function(){if(!f.isMounted()){f.activeLayer=null;g();return}f.set("hidden",true);P.default.open(b,c,{dimmer:false,resolvable:true}).then(function(a){if(f.isMounted()){f.set("hidden",false)}return a}).then(function(a){if(e){return e(a)}return Promise.resolve(a)}).then(function(a){return g(a)}).catch(function(a){d(a);if(f.isMounted()){f.set("hidden",false)}if(h.IS_DEBUG){console.error(a)}f.activeLayer=null;i(a);return Promise.reject(a)}).then(function(){f.activeLayer=null})},i)})}return this.activeLayer},onFilesFromCloud:function(a){var b=a.attachments,c=a.selectLimit,d=a.freeSpace;T.default("compose_cloud_click");return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-explorer-from-cloud/layer-explorer-from-cloud"],a,b)}).then(__importStar),"explorer-from-cloud",{attachments:b,"select-limit":c,"free-space":d},function(){return T.default("explorer-cloud_error")})},onFooterChooseTemplateClick:function(){var a="compose-template-select";var b={fetchTemplates:this.templatesFetch,onChoose:this.onTemplateSelect};require(["ui-block/layer-compose-template-select/layer-compose-template-select"],function(){P.default.open(a,b,{dimmer:false,resolvable:true,mobile:true})})},onContactsFromMail:function(a){var b=a.contacts,c=a.selectLimit,d=a.freeSpace;T.default("compose_contacts-search_click");var e=h.NEW_AB_COMPOSE_VIEW;return this.openAddressbook({contacts:b,"select-limit":c,"free-space":d,composeMode:e},h.NEW_AB_COMPOSE_VIEW)},openAddressbook:function(a){return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-addressbook/layer-addressbook"],a,b)}).then(__importStar),"addressbook",__assign(__assign({},a),{router:this.get("router")}),function(){return T.default("new-addressbook-layer_error")})},onFilesFromMail:function(a){var b=a.attachments,c=a.selectLimit,d=a.freeSpace;T.default("compose_filesearch_click");return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-explorer-from-filesearch/layer-explorer-from-filesearch"],a,b)}).then(__importStar),"explorer-from-filesearch",{attachments:b,"select-limit":c,"free-space":d},function(){return T.default("explorer-files_error")})},onCallsInvite:function(){return new Promise(function(a){J.default.createRoom().then(function(b){var c=J.default.getTemplate(b);a(c)}).catch(function(){R.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")})})},onSignatureFromMail:function(){T.default("compose_sign-edit_click");r.default(h.SIGNATURE_URL)},onWindowUnload:function(a){if(this.is("has-changes")||this.isUploadingAttachments()){var b=i18n("Текст письма будет потерян.");var c=Date.now();setTimeout(function(){var a=Date.now()-c;if(a<100){F.default("compose_unload_confirm_disabled&v="+a,{immediately:true});w.default.add("compose_unload_confirm_disabled",{unloadConfirmDuration:a})}},0);T.default("compose_try_leave_with_unsaved");w.default.add("try to leave compose with unsaved changes");a.returnValue=b;return b}},onClose:function(){this.set("closing",true);if(this.is("translate-mode")){this.broadcast("save")}this.broadcast("close")},onExtend:function(){this.broadcast("extend")},onCollapse:function(){this._updateComposeFields();this.broadcast("collapse")},_updateComposeFields:function(){this.compose.updateFields()},_updateComposeVisuals:function(){if(this.compose){this.compose.updateVisuals()}},_setupFocus:function(){if(this.compose){this.compose.setupFocus()}},onSaveAsTemplate:function(){var a=this;this._updateComposeFields();return new Promise(function(b){a.broadcast("savetemplate",{composeApp:a,resolve:b})})},onExceedMaxSize:function(){this.broadcast("exceedmaxsize")},onAutoSave:function(){if(!this.isMounted()){this.setAutosaveInterval(false);return}if(this.get("saving")){return}this._updateComposeFields();this.broadcast("autosave")},onReadyToSave:function(){this.set("has-changes",true);this.setAutosaveInterval(true)},onShortcut:function(a){var b=a.originalEvent;var c=false;var d=b;var e=d.metaKey||d.ctrlKey;if(e&&d.keyCode==13){T.default("compose_action_send_shortcut");this.broadcast("send")}if(e&&p.default(d.keyCode)==="s"){T.default("compose_action_save_shortcut");this.broadcast("save");c=true}c&&d.preventDefault();return!!c},onNavDraft:function(){this.broadcast("collapse");this.get("router").go("#letters",{folder:C.default.DRAFTS})},onNavTemplate:function(){this.broadcast("collapse");this.get("router").go("#letters",{folder:C.default.TEMPLATES})},onTranslationOk:function(){this.get("form").set({"translation-error":null,"translation-first-ok":true})},onTranslationError:function(a){var b="some-error";if(a.status===Number(G.default.statuses.many_requests)){b="many-requests"}var c=this.showTranslationNotify("error");this.emitter.one("translation-ok",function(){c===null||c===void 0?void 0:c.close()});this.get("form").set("translation-error",b)},onTranslationCancel:function(){this.compose.disableTranslate(false);this.get("form").clearTranslation()},onTranslationSave:function(){var a=this;this.compose.disableTranslate(true);var b=this.showTranslationNotify("saved");this.emitter.one("translate-mode",function(a){a&&(b===null||b===void 0?void 0:b.close())});b===null||b===void 0?void 0:b.on("action",function(){a.compose.revertTranslation();b.close()})},onTranslationRetry:function(){this.compose.translate()},showTranslationNotify:function(a){var b="";var c=R.default.types.default;var d=[];if(a==="ok"){b=i18n("Переведено")}if(a==="loading"){b=i18n("Переводим...")}if(a==="error"){b=i18n("Не удалось перевести текст");c=R.default.types.error}if(a==="saved"){b=i18n("Вы перевели письмо");d=[{text:i18n("Отменить")}]}var e={text:b,type:c,actions:d,unique:true};return R.default.add(e,"compose-notify")},_changeTranslateMode:function(a){this.get("form").set({"translate-mode":a,"translation-first-ok":false})},onComposeCreateTo:function(a){this._updateComposeFields();this.broadcast("collapse",Object.assign(this,{noAnimate:true}));L.default.open({correspondents:{to:[a]}})},onSearchFrom:function(a){this._updateComposeFields();this.broadcast("collapse");this.get("router").go("#search",{},{q_from:a})},setAutosaveInterval:function(a){if(!a){clearTimeout(this._saveDraftTimeoutId);this._saveDraftTimeoutId=void 0;if(h.IS_DEBUG){console.warn("[compose-app]","Таймер автосохранения остановлен.")}return}if(!this.isMounted()){if(h.IS_DEBUG){console.warn("[compose-app]","Не удалось запустить таймер автосохранения: компонент не в DOM!")}return}if(!this._saveDraftTimeoutId){var b=this.get("draft-timeout")*1e3;this._saveDraftTimeoutId=setInterval(this.onAutoSave.bind(this),b);if(h.IS_DEBUG){console.warn("[compose-app]","Запущен таймер автосохранения. Таймаут",b,"мс")}}},setAutosaveOnClose:function(a){if(!a){window.removeEventListener("beforeunload",this.onWindowUnload);return}window.addEventListener("beforeunload",this.onWindowUnload)},getDraftUrl:function(){return this.get("router").getUrl("#letters",{folder:C.default.DRAFTS})},getTemplateUrl:function(){return this.get("router").getUrl("#letters",{folder:C.default.TEMPLATES})},isUploadingAttachments:function(){var a=this.get("form");return a.isUploadingAttachments()},insertHtml:function(a){if(this.compose.appComponent){this.compose.appComponent.insertHtml(a)}},updateMailboxQuotas:function(a,b){I.default.user.set("mbox_quotas."+a,b);if(a==="attach"){this.get("form").resetSpaceLeft()}},getPromtLogoHref:function(){return h.PROMT_LOGO_HREF}}))});define("feast-tpl!app/feast-tpl!ui-block/compose-windows/compose-windows.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="visible" value="{attrs.items.length > 0}"/>\n\t<fn:var name="collapsedCnt" value="{attrs.items.length - (attrs.active ? 1 : 0)}"/>\n\t<fn:var name="rise" value="{attrs.rise}"/>\n\n\t<bem:mod name="hidden" test="!visible"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t<bem:mod name="rise" test="rise"/>\n\n\t<bem:mod name="animate-open" test="attrs[\'animate-open\']"/>\n\t<bem:mod name="animate-close" test="attrs[\'animate-close\']"/>\n\t<bem:mod name="animate-expand" test="attrs[\'animate-expand\']"/>\n\t<bem:mod name="animate-collapse" test="attrs[\'animate-collapse\']"/>\n\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()"/>\n\n\t<fn:if test="visible">\n\t\t<b:dimmer fn:if="attrs.active"\n\t\t\t\t  remit:click="window-collapse"\n\t\t\t\t  event:details="false"\n\t\t/>\n\n\t\t<fn:for data="attrs.items" as="item">\n\t\t\t<b:compose-app\n\t\t\t\t\tuse:mediator="compose-manager addressbook-manager themes-manager"\n\t\t\t\t\tkey="compose-{item.formData.uid}"\n\t\t\t\t\tid="{\'compose-\' + item.formData.uid}"\n\t\t\t\t\tform="{item.formData}"\n\t\t\t\t\twindow-mode="{attrs.active == item.formData.uid ? \'window\' : \'collapsed\'}"\n\t\t\t\t\texpand-status="{attrs.active == item.formData.uid && attrs[\'expand-status\']}"\n\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\tpriority="{item.formData.get(\'priority\')}"\n\t\t\t\t\treceipt="{item.formData.get(\'receipt\')}"\n\t\t\t\t\tremind="{item.formData.get(\'remind\')}"\n\t\t\t\t\tsendDate="{item.formData.get(\'send_date\')}"\n\t\t\t\t\tcollectors="{_this._getCollectors()}"\n\t\t\t\t\taliases="{_this._getAliases()}"\n\t\t\t\t\tadaptive="{attrs.adaptive}"\n\t\t\t\t\tfullscreen="{attrs.fullscreen}"\n\t\t\t\t\tmobile-xxs="{attrs[\'mobile-xxs\']}"\n\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\tsupport-extend="{attrs[\'support-extend\']}"\n\t\t\t\t\textended="{attrs.extended}"\n\t\t\t\t\tcompose-options="{item.additionalOptions}"\n\t\t\t\t\tautosend="{item.autosend}"\n\t\t\t\t\tsaving="{item.formData.isSaving}"\n\t\t\t\t\tis-drag-and-drop="{item.isDragAndDrop}"\n\t\t\t\t\tdrag-and-drop-item="{item.dragAndDropItem}"\n\t\t\t\t\tremit:open="window-open"\n\t\t\t\t\tremit:close="window-close"\n\t\t\t\t\tremit:collapse="window-collapse"\n\t\t\t\t\tremit:extend="window-extend"\n\t\t\t\t\tremit:autosave="letter-autosave"\n\t\t\t\t\tremit:savetemplate="letter-savetemplate"\n\t\t\t\t\tremit:exceedmaxsize="letter-exceedmaxsize"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<b:compose-collapsed\n\t\t\t\tfn:if="collapsedCnt"\n\t\t\t\titems="{_this.getCollapsed(attrs.items)}"\n\t\t\t\tmultiple="{false}"\n\t\t\t\tmobile="{attrs.active && attrs.overlap}"\n\t\t\t\tcompact="{_this.isCompactCollapsed()}"\n\t\t\t\tabove-paginator="{_this.isAbovePaginator() && !_this.isCompactCollapsed()}"\n\t\t/>\n\t</fn:if>\n\n\t<div bem:elem="notify"\n\t\t qa:id="compose-notify-stack"\n\t\t qa:state="rise:{rise}">\n\t\t<b:notify-stack ref="compose-notify" id="compose-notify" fixed />\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/compose-windows/compose-windows.html")});define("feast-tpl!ui-block/compose-windows/compose-windows.html",["feast-tpl!app/feast-tpl!ui-block/compose-windows/compose-windows.html"],function(a){return a});define("helpers/autocomplete",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a,b){var c=document.createElement("iframe");c.setAttribute("name","autocomplete_iframe");c.style.display="none";document.body.appendChild(c);var d=document.createElement("form");d.setAttribute("target","autocomplete_iframe");d.setAttribute("action","about:blank");d.style.position="absolute";d.style.top="-9999px";d.setAttribute("tabindex","-1");document.body.appendChild(d);var e=document.createElement("input");e.setAttribute("name",a);e.setAttribute("value",b);e.setAttribute("type","text");d.appendChild(e);d.submit();var f=function a(){d.remove();c.removeEventListener("load",a);c.remove()};c.addEventListener("load",f)}});define("helpers/user-track",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}function c(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var e={Alt:1,AltGraph:2,CapsLock:3,Control:4,Fn:5,Shift:6,Enter:7,Tab:8,Space:9,ArrowDown:10,ArrowLeft:11,ArrowRight:12,ArrowUp:13,End:14,Home:15,PageDown:16,PageUp:17,Escape:18,Backspace:19,Clear:20,Delete:21};var f={" ":"Space",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Esc:"Escape",Del:"Delete"};var g={passive:true,capture:true};var h=function(){function h(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},d=b.limit,e=d===undefined?a.COMPOSE_SEND_USER_TRACK_CONF[0]:d,f=b.trackMouseInterval,g=f===undefined?a.COMPOSE_SEND_USER_TRACK_CONF[1]:f;c(this,h);this.limit=e;this.trackMouseInterval=g;this.reset();this.trackMouse=this.trackMouse.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onClick=this.onClick.bind(this);this.onKeyDown=this.onKeyDown.bind(this)}d(h,[{key:"reset",value:function a(){this.composes={};this.active={};this.lastPointerSpeed=0;this.lastPointerPositionX=0;this.lastPointerPositionY=0;this.mouseTrackLastEventTimestamp=0;this.currentPointerPositionX=0;this.currentPointerPositionY=0;this.trackMouseIntervalObj=null;this.mouseCaptured=false;this.started=false}},{key:"addEvent",value:function a(c,d,e){var f=this.composes[c];if(!f||!this.active[c]){return}var g=Date.now();var h=Math.max(g-f.lastEventTimestamp,0);f.lastEventTimestamp=g;f.events.push([d,h].concat(b(e)).join("|"));if(f.events.length>this.limit){f.events.shift()}}},{key:"hasComposes",value:function a(){return Object.keys(this.active).reduce(function(a,b){return b?a+1:a},0)>0}},{key:"addEvents",value:function a(b,c){var d=this;Object.keys(this.active).forEach(function(a){d.addEvent(a,b,c)})}},{key:"serialize",value:function a(b){var c=this.composes[b];if(!c){return""}return c.events.join(";")}},{key:"trackMouse",value:function a(){var b=Date.now();if(this.mouseCaptured){var c=Math.max(b-this.mouseTrackLastEventTimestamp,1);var d=this.currentPointerPositionX-this.lastPointerPositionX;var e=this.currentPointerPositionY-this.lastPointerPositionY;this.lastPointerPositionX=this.currentPointerPositionX;this.lastPointerPositionY=this.currentPointerPositionY;var f=Math.ceil(Math.sqrt(d*d+e*e));var g=f/c;var h=(g-this.lastPointerSpeed)/c;this.lastPointerSpeed=g;g=Math.ceil(g);h=Math.ceil(h);if(f||g||h){this.addEvents("m",[f,g,h])}}this.mouseTrackLastEventTimestamp=b;this.trackMouseIntervalObj=window.setTimeout(this.trackMouse,this.trackMouseInterval)}},{key:"onMouseMove",value:function a(b){this.currentPointerPositionX=b.clientX;this.currentPointerPositionY=b.clientY;this.mouseCaptured=true}},{key:"onClick",value:function a(b){this.addEvents("c",[b.button,b.clientX,b.clientY])}},{key:"onKeyDown",value:function a(b){var c=b.key;if(f[c]){c=f[c]}if(e[c]){this.addEvents("k",[e[c]])}}},{key:"addCompose",value:function a(b){this.composes[b]={events:[],lastEventTimestamp:Date.now()}}},{key:"removeCompose",value:function a(b){delete this.composes[b];delete this.active[b];if(!this.hasComposes()){this.stopTracking()}}},{key:"startComposeTrack",value:function a(b){if(!this.composes[b]){this.addCompose(b)}this.active[b]=true;this.startTracking()}},{key:"pauseComposeTrack",value:function a(b){if(!this.composes[b]){this.addCompose(b)}this.active[b]=false;if(!this.hasComposes()){this.stopTracking()}}},{key:"startTracking",value:function a(){if(this.started){return}document.body.addEventListener("keydown",this.onKeyDown,g);document.body.addEventListener("click",this.onClick,g);document.body.addEventListener("mousemove",this.onMouseMove,g);this.trackMouse();this.started=true}},{key:"stopTracking",value:function a(){if(this.trackMouseIntervalObj){window.clearInterval(this.trackMouseIntervalObj)}document.body.removeEventListener("keydown",this.onKeyDown,g);document.body.removeEventListener("click",this.onClick,g);document.body.removeEventListener("mousemove",this.onMouseMove,g);this.reset()}}]);return h}();var i=new h;exports.default=i});var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/compose-validators",["require","exports","lazy.modules","mail/Message","service/smokescreen"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);var d={checkOnMissingAttach:function(b){if(b.get("source.forward")||b.attachments.length){return Promise.resolve(false)}return a.lazyMailTextAnalyzer().then(function(a){return a.hasAttachment(d.getEnteredText(b.get("body.html")))})},checkOnRettachToReply:function(a){var c=this;var d=a.get("source.reply");if(!d){return Promise.resolve({})}var e=a.get("folder_id");return b.default.findOne({id:d,folder_id:e}).then(function(b){var d=c._hasNewEmails(b,a);var e=c._hasAttachToReattach(b);return{hasNewAttach:d&&e,source:b}})},getEnteredText:function(a){var b=document.createElement("div");b.innerHTML=a;Array.prototype.forEach.call(b.querySelectorAll(c.selector("blockquote")),function(a){a.parentNode&&a.parentNode.removeChild(a)});Array.prototype.forEach.call(b.querySelectorAll(c.selector("br")),function(a){if(a.parentNode){a.parentNode.insertBefore(document.createTextNode("\n"),a);a.parentNode.removeChild(a)}});return b.innerHTML},_hasNewEmails:function(a,b){var c=a.get("correspondents");var d=__spreadArrays(c.from,c.to,c.cc,c.bcc).map(function(a){return a.email});var e=b.get("correspondents");var f=__spreadArrays(e.to,e.cc,e.bcc).map(function(a){return a.email});return f.some(function(a){return!d.includes(a)})},_hasAttachToReattach:function(a){var b=a.get("attaches.list");var c=["text/calendar","application/ics"];var d=new RegExp(/.ics$/);return b.some(function(a){return!c.includes(a.get("content_type"))&&!d.test(a.get("name"))})}};exports.default=d});define("feast-tpl!app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html",["feast"],function(a){return a.smartParse('<div qa:id="compose-collapsed">\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="multiple" test="attrs.multiple"/>\n\t<bem:mod name="empty" test="!attrs.items.length"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="above-paginator" test="attrs[\'above-paginator\']"/>\n\n\t<fn:for data="attrs.items" as="item" key="formKey">\n\t\t<div bem:elem="item"\n\t\t\t key="compose-collapsed-{item.formData.uid}"\n\t\t\t remit:click="window-expand"\n\t\t\t event:details="item.formData"\n\t\t\t qa:id="compose-collapsed-item:{item.formData.uid}">\n\n\t\t\t<fn:var name="isLast" value="{formKey === attrs.items.length - 1}"/>\n\t\t\t<div bem:elem="content">\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="label"\n\t\t\t\t\tpromo:id="{isLast ? \'compose-collapsed-label\' : \'\'}"\n\t\t\t\t>\n\t\t\t\t\t<span promo:id="{isLast ? \'compose-collapsed-icon\' : \'\'}">\n\t\t\t\t\t\t\x3c!-- in_viewport не работает на svg, поэтому нужен враппер для плашки --\x3e\n\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\tname="compose"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="title" qa:id="subject">\n\t\t\t\t\t\t<fn:value>\n\t\t\t\t\t\t\tattrs.multiple ?\n\t\t\t\t\t\t\t\ti18n(\'Черновики\') :\n\t\t\t\t\t\t\t\t(item.formData.get(\'subject\') || messages.draft(Object.fromEntries([[\'draftId\', formKey + 1]])))\n\t\t\t\t\t\t</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div bem:elem="ico-close">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tico="actions:close"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tsecondary\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tremit:click="collapsed-item-close"\n\t\t\t\t\t\tevent:details="item.formData"\n\t\t\t\t\t\tqa:id="close"\n\t\t\t\t\t\tcentered\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html")});define("feast-tpl!ui-block/compose-collapsed/compose-collapsed.html",["feast-tpl!app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html"],function(a){return a});define("ui-block/compose-collapsed/compose-collapsed",["exports","feast","feast-tpl!./compose-collapsed.html","service/radars/decorator","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:[{name:"window-expand",rename:"expand"}]})({name:"compose-collapsed",blocks:{button2:i.default,ico:j.default},defaults:{compact:false,mobile:false},events:{},template:g.default,isolateEvents:false,getMessages:function a(){return{draft:function a(b){return i18n("Черновик {draftId}",b)}}}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-sent-page">\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageAttachments" value="{_this.getAttachments()}"/>\n\t<fn:var name="isReady" value="{_this.isReady()}"/>\n\t<fn:var name="slim" value="{attrs.slim}"/>\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\t<fn:var name="timerValueText" value="{_this.get(\'delivery-cancel-timer-text\')}"/>\n\t<fn:var name="isNotifyVersion" value="{_this.get(\'is-notify-version\')}"/>\n\t<fn:var name="isDeliveryCancelVersion" value="{_this.get(\'is-delivery-cancel-version\')}"/>\n\t<fn:var name="cancellationResultText" value="{_this.get(\'cancellation-result-text\')}"/>\n\t<fn:var name="cancellationOver" value="{_this.get(\'is-cancellation-over\')}"/>\n\t<fn:var name="cancellationWithDraft" value="{_this.get(\'cancellation-with-draft\')}"/>\n\t<fn:var name="cancelShortcut" value="{_this.getCancelShortcut()}"/>\n\t<fn:var name="cancellationInProgress" value="{_this.get(\'is-cancellation-progress\')}"/>\n\t<fn:var name="isLetterCanceled" value="{_this.get(\'is-letter-canceled\')}"/>\n\t<fn:var name="openDraftFail" value="{_this.get(\'open-draft-fail\')}"/>\n\n\t<bem:mod name="slim" test="slim"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t\x3c!-- Поле Кому --\x3e\n\t<fn:match name="correspondents" args="contactString, dir">\n\t\t<fn:var name="contacts" value="{_this.getContactList(contactString)}"/>\n\t\t<fn:var name="contactList" value="{contacts}"/>\n\n\t\t<fn:for data="contactList" as="contact" key="contactKey">\n\t\t\t<fn:var name="key" value="{_this.getContactKey(contactKey, dir)}"/>\n\n\t\t\t<span\n\t\t\t\ttitle="{contact.email}"\n\t\t\t\tdata-id="{key}"\n\t\t\t\tbem:elem="contact-item"\n\t\t\t\tkey="{key}">\n\n\t\t\t\t<fn:value mod="correspondent">contact</fn:value>\n\t\t\t\t<fn:value>contactKey === contactList.length - 1 ? \' \': \', \'</fn:value>\n\t\t\t</span>\n\t\t</fn:for>\n\t</fn:match>\n\n\t\x3c!-- Поле получателей --\x3e\n\t<fn:if test="!isDeliveryCancelVersion">\n\t\t<fn:match name="recipients" args="message, more, expanded">\n\t\t\t<div bem:elem="recipients">\n\t\t\t\t<bem:mod name="more" value="{more > 0}"/>\n\t\t\t\t<bem:mod name="expanded" value="{expanded}"/>\n\n\t\t\t\t<div bem:elem="recipients-container" ref="recipients">\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.to.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Кому\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'to\'), \'to\'"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.cc.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Копия\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'cc\'), \'cc\'"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.bcc.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Скрытая\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'bcc\'), \'bcc\'"/>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="recipients-more"\n\t\t\t\t\tfn:if="more > 0 && !expanded"\n\t\t\t\t\tremit:click="recipients-more:click">\n\t\t\t\t\t<fn:var name="contextMore" value="{Object.fromEntries([[\'more\', more]])}"/>\n\t\t\t\t\t<fn:value output="raw">messages.more(contextMore)</fn:value>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="recipient-more"\n\t\t\t\t\tfn:if="more > 0 && expanded"\n\t\t\t\t\tremit:click="recipients-more:click">\n\t\t\t\t\t<span class="layer__link">{i18n(\'Свернуть\')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</fn:if>\n\n\t<fn:match name="controls" args="message, type" qa:id="controls">\n\t\t<div bem:elem="controls">\n\t\t\t<b:button2\n\t\t\t\tfn:if="type === \'error\'"\n\t\t\t\ttext="{i18n(\'Отправить ещё раз\')}"\n\t\t\t\tevent:details="message"\n\t\t\t\tremit:click="resend"\n\t\t\t\tqa:id="resend"\n\t\t\t/>\n\t\t\t<b:button2\n\t\t\t\tfn:if="type === \'error\'"\n\t\t\t\ttext="{i18n(\'Вернуться к письму\')}"\n\t\t\t\tevent:details="message"\n\t\t\t\tremit:click="compose-back"\n\t\t\t\tqa:id="compose-back"\n\t\t\t/>\n\n\t\t\t<fn:if test="isDeliveryCancelVersion">\n\t\t\t\t<div bem:elem="cancel">\n\t\t\t\t\t<fn:if test="!cancellationOver && !cancellationInProgress">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{timerValueText}"\n\t\t\t\t\t\t\ttitle="{i18n(\'Отменить отправку\')}"\n\t\t\t\t\t\t\tremit:click="cancel"\n\t\t\t\t\t\t\tshortcut="ctrl+z|command+z"\n\t\t\t\t\t\t\tqa:id="cancel"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<p bem:elem="cancel-combination">{cancelShortcut}</p>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationInProgress">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Идёт отмена отправки...\')}"\n\t\t\t\t\t\t\tqa:id="cancel-progress"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && cancellationWithDraft && !openDraftFail">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Открываю черновик...\')}"\n\t\t\t\t\t\t\tqa:id="draft-progress"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && cancellationWithDraft && openDraftFail">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Редактировать в черновике\')}"\n\t\t\t\t\t\t\tqa:id="draft-open-fail"\n\t\t\t\t\t\t\tremit:click="go-drafts"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && !cancellationWithDraft">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Перейти во входящие\')}"\n\t\t\t\t\t\t\tremit:click="go-inbox"\n\t\t\t\t\t\t\tqa:id="go-inbox"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="!isDeliveryCancelVersion">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t\x3c!-- Шаблон сохраняется --\x3e\n\t\t\t\t\t<fn:when test="attrs[\'template-status\'] === \'saving\'">\n\t\t\t\t\t\t<b:spinner small color="gray"/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\x3c!-- Шаблон сохранили --\x3e\n\t\t\t\t\t<fn:when test="attrs[\'template-status\'] === \'saved\'">\n\t\t\t\t\t\t<span bem:elem="template-saved">\n\t\t\t\t\t\t\t<b:ico name="status:doneround"/>\n\t\t\t\t\t\t\t<span>{i18n(\'Шаблон сохранён\')}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\x3c!-- Сохранение в шаблон не нажали --\x3e\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Сохранить в шаблон\')}"\n\t\t\t\t\t\t\tevent:details="message"\n\t\t\t\t\t\t\tremit:click="template"\n\t\t\t\t\t\t\tqa:id="template"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Ссылка на звонок --\x3e\n\t<fn:match name="calls" args="message, link">\n\t\t<div bem:elem="calls" qa:id="calls">\n\t\t\t<fn:var name="calls" value="{message.get(\'calls\')}"/>\n\n\t\t\t<fn:if test="calls.length === 1">\n\t\t\t\t<span>{i18n(\'Ссылка на видеозвонок:\')}</span>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="calls-link"\n\t\t\t\t\thref="{calls[0]}"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\trel="noopener"\n\t\t\t\t\tremit:click="calls-link"\n\t\t\t\t\tqa:id="calls-link"\n\t\t\t\t>\n\t\t\t\t\t{calls[0]}\n\t\t\t\t</a>\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="calls-ico"\n\t\t\t\t\tqa:id="copy"\n\t\t\t\t\tremit:click="calls-copy"\n\t\t\t\t\tref="callsLinkCopy"\n\t\t\t\t\ttitle="{i18n(\'Скопировать ссылку\')}"\n\t\t\t\t>\n\t\t\t\t\t<b:ico secondary name="actions:copy" size="s"/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="calls.length > 1 && !!link">\n\t\t\t\t<span>{i18n(\'В письме есть несколько ссылок на звонки.\') }</span>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="calls-link"\n\t\t\t\t\tremit:click="calls-message-link"\n\t\t\t\t\thref="{link}"\n\t\t\t\t\trel="noopener"\n\t\t\t\t\tqa:id="calls-message-link"\n\t\t\t\t>\n\t\t\t\t\t{i18n(\'Перейти в письмо\')}\n\t\t\t\t</a>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Поле аттачей --\x3e\n\t<fn:if test="!isDeliveryCancelVersion">\n\t\t<fn:match name="attachments" args="attachments, more, expanded">\n\t\t\t<div bem:elem="attachments" qa:id="attachments:{attachments.length}">\n\t\t\t\t<bem:mod name="more" value="{more > 0}"/>\n\t\t\t\t<bem:mod name="expanded" value="{expanded}"/>\n\n\t\t\t\t<div bem:elem="attachments-container" ref="attachments">\n\t\t\t\t\t<fn:for data="attachments" as="attach" key="attachKey">\n\t\t\t\t\t\t<fn:var name="key" value="{_this.getAttachKey(attachKey)}"/>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tkey="{key}"\n\t\t\t\t\t\t\tbem:elem="attach-item"\n\t\t\t\t\t\t\tdata-id="{key}">\n\t\t\t\t\t\t\t<b:attach-filename model="{attach}"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="attachments-more"\n\t\t\t\t\tfn:if="more > 0 && !expanded"\n\t\t\t\t\tremit:click="attachments-more:click">\n\t\t\t\t\t<fn:var name="contextMore" value="{Object.fromEntries([[\'more\', more]])}"/>\n\t\t\t\t\t<fn:value output="raw">messages.more(contextMore)</fn:value>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="attachments-more"\n\t\t\t\t\tfn:if="more > 0 && expanded"\n\t\t\t\t\tremit:click="attachments-more:click">\n\t\t\t\t\t<span class="layer__link">{i18n(\'Свернуть\')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</fn:if>\n\n\t\x3c!-- Рекламный баннер --\x3e\n\t<fn:match name="banner">\n\t\t<div bem:elem="banner" ref="banner" qa:id="banner"></div>\n\t</fn:match>\n\n\t\x3c!-- Лейер не рисуем, если нужен только notify --\x3e\n\t<fn:if test="!isNotifyVersion">\n\t\t<fn:if test="!attrs.mobile">\n\t\t\t<b:layer\n\t\t\t\t\tremit:close="close"\n\t\t\t\t\thiddenfooter="{attrs[\'hide-ads\']}"\n\t\t\t\t\tclose\n\t\t\t\t\theader\n\t\t\t\t\tmedia\n\t\t\t\t\tcompose\n\t\t\t\t\twide="{!slim}"\n\t\t\t\t\tsize="{slim ? \'m\' : \'\'}"\n\t\t\t\t\tcenter>\n\n\t\t\t\t<fn:match name="header">\n\t\t\t\t\t<fn:if test="!attrs.error">\n\t\t\t\t\t\t<fn:if test="!isReady">\n\t\t\t\t\t\t\t<div qa:id="is-in-progress">\n\t\t\t\t\t\t\t\t{i18n(\'Письмо отправляется...\')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t<fn:if test="isReady">\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t<fn:when test="attrs.isLateSent">\n\t\t\t\t\t\t\t\t\t<div qa:id="is-schedule-sent">\n\t\t\t\t\t\t\t\t\t\t{messages.lateSent}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\tbem:elem="link"\n\t\t\t\t\t\t\t\t\t\t\thref="{attrs.link}"\n\t\t\t\t\t\t\t\t\t\t\tremit:click="link:click"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="is-sent"\n\t\t\t\t\t\t\t\t\t\t\tfn:if="!isLetterCanceled"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{messages.sent}\n\t\t\t\t\t\t\t\t\t</a>\n\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\tbem:elem="link"\n\t\t\t\t\t\t\t\t\t\t\thref="{attrs.link}"\n\t\t\t\t\t\t\t\t\t\t\tremit:click="link:click"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="is-canceled"\n\t\t\t\t\t\t\t\t\t\t\tfn:if="isLetterCanceled"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{cancellationResultText}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t<fn:if test="attrs.error">\n\t\t\t\t\t\t<div qa:id="error">\n\t\t\t\t\t\t\t{i18n(\'При отправке письма произошла ошибка\')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:match>\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<fn:if test="!isReady && !attrs.error">\n\t\t\t\t\t\t<b:spinner/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="isReady || attrs.error">\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="recipients"\n\t\t\t\t\t\t\t\targs="message, attrs[\'recipients-more\'], attrs[\'recipients-expanded\']"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="calls"\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'hide-calls\'] && message.get(\'calls\') && message.get(\'calls\').length"\n\t\t\t\t\t\t\t\targs="message, attrs.link"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="attachments"\n\t\t\t\t\t\t\t\tfn:if="messageAttachments && messageAttachments.length"\n\t\t\t\t\t\t\t\targs="messageAttachments, attrs[\'attachments-more\'], attrs[\'attachments-expanded\']"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="controls"\n\t\t\t\t\t\t\t\targs="message, attrs.error ? \'error\': \'ok\'"/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:match>\n\t\t\t\t<fn:match name="footer">\n\t\t\t\t\t<fn:apply-match name="banner"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:layer>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.mobile">\n\t\t\t<b:layer-mobile media>\n\t\t\t\t<fn:match name="header">\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="back"\n\t\t\t\t\t\tremit:click="layer:close">\n\t\t\t\t\t<b:button2 text="{i18n(\'Назад\')}"\n\t\t\t\t\t\t\t   ico="arrow-back"\n\t\t\t\t\t\t\t   pure\n\t\t\t\t\t\t\t   touch\n\t\t\t\t\t\t\t   short\n\t\t\t\t\t\t\t   text-center\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="attrs.isLateSent">\n\t\t\t\t\t\t\t\t{messages.lateSent}\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t{messages.sent}\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t</span>\n\t\t\t\t</fn:match>\n\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="recipients"\n\t\t\t\t\t\t\targs="message, 0, true"/>\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="calls"\n\t\t\t\t\t\t\tfn:if="!attrs[\'hide-calls\'] && message.get(\'calls\') && message.get(\'calls\').length"\n\t\t\t\t\t\t\targs="message, attrs.link"/>\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tfn:if="messageAttachments.length"\n\t\t\t\t\t\t\tname="attachments"\n\t\t\t\t\t\t\targs="messageAttachments, 0, true"/>\n\t\t\t\t</fn:match>\n\n\t\t\t\t<fn:match name="footer">\n\t\t\t\t\t<fn:apply-match name="banner"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:layer-mobile>\n\t\t</fn:if>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html")});define("feast-tpl!ui-block/layer-sent-page/layer-sent-page.html",["feast-tpl!app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/attach-filename/attach-filename.html",["feast"],function(a){return a.smartParse('<div>\n\t<span bem:elem="icon">\n\t\t<b:attach-icon name="{attrs.model.getExtension()}"/>\n\t</span>\n\t<span bem:elem="text">{attrs.model.get(\'name\')}</span>\n</div>\n',"app/feast-tpl!ui-block/attach-filename/attach-filename.html")});define("feast-tpl!ui-block/attach-filename/attach-filename.html",["feast-tpl!app/feast-tpl!ui-block/attach-filename/attach-filename.html"],function(a){return a});define("ui-block/attach-filename/attach-filename",["exports","feast","feast-tpl!./attach-filename.html","ui-block/attach-icon/attach-icon"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"attach-filename",template:e.default,blocks:{"attach-icon":f.default}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-sent-page/layer-sent-page",["require","exports","@mail/adman","data-source/index","default-values","feast","feast-mod/correspondents","feast-mod/utils","feast-tpl!./layer-sent-page.html","helpers/browser","lazy.modules","mail/Folder","mail/Message","service/adv/index","service/compose","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","ui-block/attach-filename/attach-filename","ui-block/button2/button2","ui-block/ico/ico","ui-block/layer/layer","ui-block/layer-mobile/layer-mobile","ui-block/spinner/spinner"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importStar(d);g=__importStar(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);var x={ok:i18n("Вы отменили отправку письма"),fail:i18n("Не удалось отменить отправку"),openDraft:i18n("Отправка отменена, открываем черновик"),openDraftFail:i18n("Не удалось открыть черновик")};var y="command+z,ctrl+z";exports.default=d.Block.extend(o.default({events:["calls-link","calls-copy","calls-message-link"]})(q.withWelter({name:"layer-sent-page",template:g,clipboard:null,mods:{correspondent:e.correspondent},blocks:{layer:u.default,"attach-filename":r.default,button2:s.default,"layer-mobile":v.default,spinner:w.default,ico:t.default},events:{"attachments-more:click":"onAttachmentsToggle","recipients-more:click":"onRecipientsToggle","link:click":"onLinkClick","calls-message-link":"onLinkClick",close:"onClose",resend:"onResend","compose-back":"onComposeBack",template:"onTemplate","calls-copy":"onCallsCopyClick",cancel:"onCancel","go-inbox":"goToInboxFolder","go-drafts":"openDraft"},defaults:{mobile:false,visible:false,responsive:true,isLateSent:false,lateSentText:"",model:null,loading:false,error:false,"delay-visible":c.LAYER_SENT_PAGE_CONFIG.delayVisible,"hide-ads":c.HIDE_TOYS===c.BL_PROP_NAME,"hide-calls":c.DISABLE_CALLS_ON_SENT_PAGE,"loader-timeout-exceeded":false,"visibility-timeout-exceeded":false,"template-status":"idle","promo-disabled":false,"attachments-more":0,"attachments-expanded":false,"recipients-more":0,"recipients-expanded":false,"last-recipients-id":"","last-attachments-id":"","is-notify-version":false,"is-delivery-cancel-version":false,"delivery-cancel-timer-text":null,"cancellation-result-text":x.ok,"cancellation-interval":null,"is-cancellation-over":false,"cancellation-with-draft":false,"is-cancellation-progress":false,"is-letter-canceled":false,"timer-start":0,"prev-timer-value":0,"cancel-lifetime":0,"open-draft-fail":false},attrChanged:{visible:function(){this.isReady()&&this.redraw()},loading:function(){if(this.isMounted()){if(this.isReady()){this.redraw()}this.setVisibilityTimeout()}},error:function(a){if(a){this.is("visible")&&this.redraw();clearTimeout(this.visibleTimer)}},mobile:function(){this.isReady()&&this.redraw(true)},model:function(a){this._attachments=a.attachments.filter(function(a){return!a.isInline()})},"loader-timeout-exceeded":function(){this.isReady()&&this.redraw()},"visibility-timeout-exceeded":function(){if(this.isReady()){p.default("sent_close_timeout");this.onClose()}}},isReady:function(){return this.is("visible")&&!this.is("loading")&&!this.is("error")&&(this.is("loader-timeout-exceeded")||!this.loadingTimer)},redraw:function(a){var b=this;if(a===void 0){a=false}this.hideElements("attachments","layer-sent-page__attach-item",a);this.hideElements("recipients","layer-sent-page__contact-item",a);if(this.clipboard){this.clipboard.destroy()}var c=this.refs.callsLinkCopy;if(c){var d=this.get("model");var e=d===null||d===void 0?void 0:d.get("calls");if(!e||!e.length){return p.default([this.name,"calls","error","no-link-to-copy"])}c.setAttribute("data-clipboard-text",e[0]);i.lazyClipboard().then(i.uniqCallback(this,function(a){b.clipboard=b.isMounted()?new a(c):null}))}this.sendCallsRadar()},hideElements:function(a,b,c){if(c===void 0){c=false}var d=this.refs[a];if(!d){return}var e=d.offsetWidth;if((c||!this.get(a+"-more"))&&d.scrollWidth>e){var f=d.getElementsByClassName(b);var g=0;while(g<f.length&&f[g].offsetLeft+f[g].offsetWidth<e){g++}if(g!==f.length){this.set(a+"-more",f.length-g-1);this.set("last-"+a+"-id",this.get(a+"-more")>0?f[g].getAttribute("data-id"):"")}}p.default([this.name,a,"more",this.is(a+"-more").toString()])},onAttachmentsToggle:function(){this.set("attachments-expanded",!this.is("attachments-expanded"));p.default([this.name,"attachments","more","click"])},onRecipientsToggle:function(){this.set("recipients-expanded",!this.is("recipients-expanded"));p.default([this.name,"recipients","more","click"])},onLinkClick:function(){var a=this;p.default([this.name,"link"]);this.get("router").nav(this.get("link")).then(function(){a.onClose()})},onResend:function(){var a=this;var b=this.get("model");this.set({loading:true,error:false});p.default([this.name,"resend","click"]);b.send().then(function(b){a.broadcast("resent",{sentMessage:b});p.default([a.name,"resend","ok"])}).catch(function(){a.set("error",true);p.default([a.name,"resend","fail"])})},onComposeBack:function(){var a=this.get("model");a.set("finalized",false);m.default.add(a);p.default([this.name,"compose-back","click"]);this.broadcast("layer:close",{type:"compose-back"})},prepareModelForTemplate:function(){var a=this.get("model");return k.default.findOne(this.get("sent-id")).then(function(b){return a.reattach({sync_space_left:true,sync_attachments:true,reset_attachments:true,source_model:b,force:true})})},onTemplate:function(){var a=this;var c=this.name;p.default([c,"template","click"]);this.set("template-status","saving");this.clearTimeouts();var d=this.get("model");this.prepareModelForTemplate().then(function(){return d.save({template:true})}).then(function(){p.default([c,"template","ok"]);if(a.isMounted()){a.set("template-status","saved");a.setVisibilityTimeout()}else{n.default.add({text:i18n("Сохранено в шаблоны")})}b.default.updateAll()}).catch(function(){if(a.isMounted()){a.broadcast("layer:close");a.set("template-status","idle")}p.default([c,"template","fail"]);n.default.add({type:n.default.types.error,text:i18n("Что-то пошло не так")})})},clearCancellationInterval:function(){var a=this.get("cancellation-interval");if(a){clearInterval(a);this.set("cancellation-interval",null)}},forceDelivery:function(){var a=this.get("model");var b=a.get("delivery_forced");var c=a.get("delivery_canceled");var d=a.get("cancellation_token");if(!b&&!c&&d){a.forceDelivery().then(function(a){var b=a.success;var c=b?"suc":"err";p.default("del_force_"+c)}).catch(function(a){p.default({type:"del_force_fail",rlog:"del_force_fail",rlog_message:a})})}},onCancel:function(){var a=this;p.default({type:"del_cancel_click",value:this.get("time-difference")});this.set("is-cancellation-progress",true);var b=this.get("cancellation-notify");b===null||b===void 0?void 0:b.close();clearTimeout(this.visibleTimer);var c=this.get("model");c.cancelDelivery().then(function(b){var d=b.success,e=b.error;var f=!a.get("cancellation-interval");var g=d&&!f?[x.ok,"ok"]:[x.fail,"error_"+e],h=g[0],i=g[1];var j=d&&c.get("draft_id");a.set({"cancellation-result-text":h,"is-cancellation-over":true,"cancellation-with-draft":j,"is-cancellation-progress":false,"is-letter-canceled":true});if(a.get("is-notify-version")){n.default.add({text:d?x.openDraft:x.fail,qa:"cancellation-"+(d?"ok":"fail")+"-notify"})}a.clearCancellationInterval();p.default("del_cancel_"+i);if(j){a.openDraft()}}).catch(function(b){a.set({"cancellation-result-text":x.fail,"is-cancellation-progress":false,"is-letter-canceled":true});if(a.get("is-notify-version")){n.default.add({text:x.fail,qa:"cancellation-error-notify"})}p.default({type:"del_cancel_fail",rlog:"del_cancel_fail",rlog_message:b})}).finally(function(){a.setVisibilityTimeout()})},setTimerValues:function(a,b){var c=this.get("prev-timer-value");if(a>=c){return}if(this.get("is-notify-version")){var d=this.get("cancellation-notify");d&&n.default.setData(d,{actions:[{text:i18n("Отменить {timerValue}",{timerValue:a})}]});this.set({"time-difference":b,"prev-timer-value":a})}else{this.set({"delivery-cancel-timer-text":i18n("Отменить отправку {timerValue}",{timerValue:a}),"time-difference":b,"prev-timer-value":a})}},setCancellationTimer:function(){var a=this;var b=this.get("cancel-lifetime");var d=setInterval(function(){var d=a.get("timer-start");var e=Math.round((Date.now()-d)/1e3);var f=b-e;var g=f+c.CANCELLATION_RESERVE_TIME;f<=0?a.onCancelTimerOver():a.setTimerValues(f,e);if(g===0){a.clearCancellationInterval()}},200);this.set({"timer-start":Date.now(),"delivery-cancel-timer-text":i18n("Отменить отправку {timerValue}",{timerValue:b}),"cancellation-interval":d,"prev-timer-value":b})},onClose:function(){if((this===null||this===void 0?void 0:this.el)&&!this.get("is-cancellation-progress")){this.broadcast("layer:close")}},onBeforeHide:function(){this.clearTimeouts();var b=a.default.placement("sent");if(b){b.sleep()}l.default.wakeUp("sent");l.default.update();var d=(this===null||this===void 0?void 0:this.el)&&this.get("is-cancellation-progress");if(c.DELAY_FOR_CANCELLATION&&!d){this.forceDelivery()}if(d){return{stopHiding:true}}this.broadcast("layer:on-before-hide")},onCancelTimerOver:function(){var a=(this===null||this===void 0?void 0:this.el)&&this.get("is-cancellation-progress");if(!a){this.set("is-cancellation-over",true);this.forceDelivery();var b=this.get("cancellation-notify");b===null||b===void 0?void 0:b.close()}},showNotify:function(){var a=this.getMessages();var b=this.get("is-delivery-cancel-version");if(!b){n.default.add({text:this.get("isLateSent")?a.lateSent:a.sent,qa:(this.get("isLateSent")?"scheduled-":"")+"letter-sent-notify"});return}var c=n.default.add({text:a.sent,actions:[{text:i18n("Отменить {timerValue}",{timerValue:this.get("cancel-lifetime")})}],qa:"letter-cancellation-notify",duration:this.get("cancel-lifetime")});c.on("action",this.onCancel.bind(this));c.on("closed",this.onClose.bind(this));this.set("cancellation-notify",c)},didMount:function(){var b=this;if(a.default.placement("sent")){var c=a.default.placement("sent");c.attachToContainer(this.refs.banner);c.wakeUp();c.render(true).catch(function(){return null})}var d=this.get("is-delivery-cancel-version");var e=this.get("is-notify-version");if(e){this.showNotify();i.lazyMailKeymaster().then(function(a){if(b.mounted&&!b.keyLib){b.keyLib=a;a(y,function(){b.onCancel()})}})}if(!d){return}p.default("cancel_on");this.setCancellationTimer()},didUnmount:function(){this.clearTimeouts();if(a.default.placement("sent")){a.default.placement("sent").destroy()}if(this.clipboard){this.clipboard.destroy()}this.clearCancellationInterval();if(this.keyLib){this.keyLib.unbind(y)}},setVisibilityTimeout:function(){var a=this;this.visibleTimer=setTimeout(function(){a.set("visibility-timeout-exceeded",true)},this.get("delay-visible"))},clearTimeouts:function(){clearTimeout(this.loadingTimer);clearTimeout(this.visibleTimer)},getContactList:function(a){return e.correspondentsFull(a)},getContactKey:function(a,b){return"contact-"+b+"-"+a},getAttachKey:function(a){return"attach-"+a},getAttachments:function(){return this._attachments},getMessages:function(){var a=this;var b=!Object.values(f.TRANSLATE_STRINGS_TO_MOMENT).find(function(b){return a.attrs.lateSentText.includes(b)});return{more:function(a){return i18n("и {spanOpen}ещё {more}{spanClose}",__assign({"unsafe-spanOpen":'<span class="layer__link">',"unsafe-spanClose":"</span>"},a))},sent:i18n("Письмо отправлено"),lateSent:b?i18n("Ваше письмо будет отправлено {lateSentText}",{lateSentText:this.attrs.lateSentText}):i18n("Ваше письмо будет отправлено {lateSentTextWithoutPrefix}",{lateSentTextWithoutPrefix:this.attrs.lateSentText})}},onCallsCopyClick:function(){n.default.add({text:i18n("Ссылка скопирована")},"layer-window")},sendCallsRadar:function(){var a=this.get("model");var b=a===null||a===void 0?void 0:a.get("calls");var c=this.get("hide-calls");if(c||!b||!b.length){p.default([this.name,"show","no-calls"])}else if(b.length===1){p.default([this.name,"show","calls-one"])}else{p.default([this.name,"show","calls-many"])}},goToInboxFolder:function(){var a=this.get("router");a===null||a===void 0?void 0:a.go("#letters");this.broadcast("layer:close");p.default([this.name,"go","inbox"])},openDraft:function(){var a=this;p.default("cncl_draft_clk");var b=this.get("model");return k.default.fetchData({id:b.get("draft_id"),folder_id:j.default.DRAFTS},true,true).then(function(b){p.default("cncl_draft_ok");k.default.set([b]);a.set("open-draft-fail",false);a.broadcast("compose:draft",new k.default(b));a.onClose()}).catch(function(b){p.default({type:"cncl_draft_fail",rlog:"cncl_draft_fail",rlog_message:b});a.set({"open-draft-fail":true,"cancellation-result-text":x.openDraftFail})})},getCancelShortcut:function(){return h.default.mac?"CMD+Z":"CTRL+Z"}})))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-windows/compose-windows",["require","exports","@mail/adman","@mail/features","@mail/xray","cfg","data-source/actions","data-source/index","default-values","feast","feast-tpl!./compose-windows.html","helpers/autocomplete","helpers/email-length-postfix","helpers/user-track","logger","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","RPC","service/addressbook/addressbook","service/adv/index","service/auth","service/captcha","service/compose-validators","service/layer","service/mailbox/loader","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","ui-block/compose-app/compose-app","ui-block/compose-collapsed/compose-collapsed","ui-block/dimmer/dimmer","ui-block/layer-sent-page/layer-sent-page","ui-block/notify-stack/notify-stack","../../feast-mod/utils"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);h=__importStar(h);i=__importStar(i);j=__importDefault(j);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importStar(s);t=__importStar(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);var J=100;var K=100;var L=350;var M=350;var N="too_long";var O=m.default.getScope("compose.mail.ru");var P=function(){t.default.wakeUp.apply(t.default,t.SLOTS_EXCEPT_SENT);t.default.updateOnAction()};exports.default=h.Block.extend(A.default({explicit:"radar"})({name:"compose-windows",blocks:{dimmer:F.default,"compose-app":D.default,"compose-collapsed":E.default,"notify-stack":H.default,"layer-sent-page":G.default},events:{"collapsed-item-close":"onCollapsedItemClose","window-close":"onClose","window-collapse":"onCollapse","window-expand":"onExpand","letter-send":"onLetterSend","letter-schedule":"onLetterSchedule","letter-save":"onLetterSave","letter-autosave":"onLetterAutosave","letter-savetemplate":"onLetterSaveTemplate","letter-exceedmaxsize":"onExceedSize"},defaults:{adaptive:false,fullscreen:false,compact:false,overlap:false,ponymode:false,mobile:g.TOUCH_MODE,"mobile-layout":false,"expand-status":false,"has-right-column":false,"right-column-compact":false,rise:false,"support-extend":true,extended:false,"close-on-error":false,autosend:false},template:i,isolateEvents:false,constructor:function(){h.Block.prototype.constructor.apply(this,arguments);this.onLayoutUpdate=this.onLayoutUpdate.bind(this);this.onDataSourceChange=this.onDataSourceChange.bind(this)},didMount:function(){this._sending={};this._sendingCaptchaCallbacks={};z.default.setup(this.ids["compose-notify"],"compose-notify");f.default.on("change",this.onDataSourceChange);this.onLayoutUpdate();if(g.COMPOSE_INIT_ADDRESSBOOK){s.default.lazyInit()}},didUnmount:function(){f.default.off("change",this.onDataSourceChange)},animate:function(a,b,c){var d=this;if(g.COMPOSE_WINDOW_ANIMATION){var e="animate-"+a;setTimeout(function(){d.set(e,false);if(c){c()}},b);this.set(e,true)}else if(c){c()}},onCollapsedItemClose:function(a){var b=a.details;this.remove(b.uid);b.destroy();this.broadcast("window-collapsed-hide")},onClose:function(a){var b=this;var c=a.details;var d=c.get("form");var e=c.get("compose-options");var f=this.get("active");var g=function(){P();d.uid===f&&b.set("active",null);b.remove(d.uid);d.destroy();b.broadcast("window-hide")};if(!c.noAnimate){this.animate("close",K,g)}else{g()}if(e===null||e===void 0?void 0:e.templateName){B.default({type:"compose-templates_close",dwh:{template:e.templateName}})}return false},onCollapse:function(a){var b=this;var c=a.details;var d=c&&c.get("form");var e=this.ids["compose-"+this.get("active")];var f=c||e;if(f){f._updateComposeFields();this.saveDraft(f,{silent:true})}var g=function(){b.hide(d.uid);b.set("expand-status",false);P();b.broadcast("window-hide")};if(!c.noAnimate){this.animate("collapse",M,g)}else{g()}},onExpand:function(a){var b=this;var c=a.details;var d=c.get("form")||c;this.show(d.uid);this.animate("expand",L,function(){b.set("expand-status",true)})},onLetterAutosave:function(a){var b=a.details;B.default("compose_action_save_auto");O.add("autosave",{id:b.attrs.form.uid});this.saveDraft(b)},onLetterSave:function(a){var b=a.details;B.default("compose_action_save");var c=b.get("compose-options");this.saveDraft(b,{userAction:true});if(c===null||c===void 0?void 0:c.templateName){B.default({type:"compose-templates_save",dwh:{template:c.templateName}})}},onLetterSaveTemplate:function(a){var b=a.details,c=b.composeApp,d=b.resolve;B.default("compose_action_save_template");this.saveTemplate(c).then(d,d)},onLetterSchedule:function(a){var b=a.details,c=b.composeApp,d=b.scheduleText;var e=c.get("compose-options");this.letterSend({composeApp:c,scheduleText:d,schedule:true});if(e===null||e===void 0?void 0:e.templateName){B.default({type:"compose-templates_schedule",dwh:{template:e.templateName}})}},onExceedSize:function(){this.showExceedNotify()},onLetterSend:function(a){var b=a.details;var c=b.get("compose-options");this.letterSend({composeApp:b});if(c===null||c===void 0?void 0:c.templateName){B.default({type:"compose-templates_send",dwh:{template:c.templateName}})}},onDataSourceChange:function(a){var b=a.details;if(!b){return}var c=b.changes;if(!c){return}var d=c.some(function(a){var b=a.action;if(!b){return false}var c=b.type;return c===e.UPDATE_LAYOUT_SUPPORT_3_PANE});if(d){this.onLayoutUpdate()}},onLayoutUpdate:function(){var a;var b=this.get("layout");if(b){var c="default"in b&&"isLessThen"in b.default&&"isMoreThen"in b.default?b.default:b;var e=c.columnRight;var f=e>=40;var h=(c===null||c===void 0?void 0:c.isMoreThen("xs"))&&(c===null||c===void 0?void 0:c.isLessThen("l"))&&e<=40;var i=!!(((a=d.default.headline)===null||a===void 0?void 0:a.headlinePromoHeight)!==0&&document.querySelector(".vk-slides-iframe_show"));this.set({fullscreen:(c===null||c===void 0?void 0:c.isLessThen("s"))||g.TOUCH_MODE,adaptive:!i&&(c===null||c===void 0?void 0:c.isVertical("l")),mobile:(c===null||c===void 0?void 0:c.isLessThen("s"))||g.TOUCH_MODE,"mobile-xxs":c===null||c===void 0?void 0:c.isLessThen("xs"),overlap:(c===null||c===void 0?void 0:c.isLessThen("m"))||g.TOUCH_MODE,compact:h,rise:(c===null||c===void 0?void 0:c.isLessThen("xl"))||g.TOUCH_MODE,"3pane":(c===null||c===void 0?void 0:c.getType())==="3pane","has-right-column":f,"right-column-compact":f&&e<=40,"support-extend":(c===null||c===void 0?void 0:c.supportComposeExtend)&&!g.TOUCH_MODE})}},letterSend:function(a){var b=this;var c=a.composeApp,d=a.schedule,e=a.scheduleText;var f=c.get("form");w.default.checkOnRettachToReply(f).then(function(a){return!a.hasNewAttach?w.default.checkOnMissingAttach(f).then(function(b){return __assign(__assign({},a),{missingAttach:b})}):__assign(__assign({},a),{missingAttach:false})}).then(function(a){var g=a.hasNewAttach,h=a.source,i=a.missingAttach;if(!g){if(i){b.checkLostAttaches(c,d,e)}else{b.send(c,d,e)}return}B.default("reattach-to-reply_reattach-open");c.set("focusoff",true);x.default.open("reattach-to-reply",{mobile:q.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,mobile:q.default.isLessThen("xs")}).then(function(a){if(a==="skip"){return w.default.checkOnMissingAttach(f).then(function(b){return{type:a,missingAttach:b}})}return{type:a,missingAttach:false}}).then(function(a){var g=a.type,i=a.missingAttach;c.set("focusoff",false);if(g==="attach"){B.default("reattach-to-reply_reattach-attach");f.reattach({sync_space_left:true,sync_attachments:true,reset_attachments:false,source_model:h,force:true}).then(function(){b.send(c,d,e)},function(){B.default("reattach-to-reply_reattach-fail")})}else if(g==="skip"){B.default("reattach-to-reply_reattach-skip");if(i){b.checkLostAttaches(c,d,e)}else{b.send(c,d,e)}}else{B.default("reattach-to-reply_reattach-close");c.set("sending",false)}},function(){B.default("reattach-to-reply_open-fail");c.set("focusoff",false);b.send(c,d,e)})})},checkLostAttaches:function(a,b,c){var d=this;B.default("missing_attach_open");a.set("focusoff",true);x.default.open("missing-attach",{mobile:q.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,mobile:q.default.isLessThen("xs")}).then(function(e){a.set("focusoff",false);if(e==="skip"){B.default("missing_attach_skip");d.send(a,b,c)}else{B.default("missing_attach_back");a.set("sending",false)}},function(){a.set("focusoff",false);B.default("missing_attach_open-fail");d.send(a,b,c)})},getBodyCount:function(a){var b;try{var c=document.createElement("div");c.innerHTML=a;var d=c.querySelectorAll(C.selector("blockquote"));var e=d.length;for(var f=0;f<e;f++){if(d[f].parentNode){d[f].parentNode.removeChild(d[f])}}b=c.innerHTML.length}catch(a){this.radar(["body-count","error"])}return b},_getCountPostfix:function(a){return k.getEmailLengthPostfix(a)},send:function(a,b,c){var d=this;if(b===void 0){b=false}if(c===void 0){c=""}if(g.COMPOSE_INIT_ADDRESSBOOK){s.default.lazyInit().then(function(){d._send(a,b,c)})}else{this._send(a,b,c)}},_send:function(a,c,d){var e=this;if(c===void 0){c=false}if(d===void 0){d=""}if(!a.isMounted()){return}var f=a.get("form");var h=f.get("subject");if(g.COMPOSE_SUBJECT_AUTOCOMPLETE&&h){j.default("Subject",h)}if(g.COMPOSE_SEND_STAT){this._updateComposeStatsFields(f)}if(g.COMPOSE_SEND_USER_TRACK){this._updateComposeUserTrackFields(f)}f.set({"compose_stat.build":g.BUILD,"compose_stat.serverTime":g.SERVER_TIME},{silent:true});if(b.default.has("body-size-radars")){setTimeout(function(){var a=e.getBodyCount(f.get("body.html"));if(a!==void 0){e.radar(["send","body-count",e._getCountPostfix(a)],a);e.radar(["send","body-count"],a)}else{e.radar(["send","no-body-count"])}},0)}a.set("sending",true);v.default.retryUntilCaptchaSuccess(function(a){var b=a.capcha;var d={delay_for_cancellation:g.DELAY_FOR_CANCELLATION};if(b){d.capcha=b}f.set(d);return f.send(c)}).then(function(){var b=f.attachments.reduce(function(a,b){return a+(b.isCloudStock()?1:0)},0);if(b){e.radar(["send","has-cloud-stock"],b)}if(g.OVERSIZE_CLOUD_ATTACHES){var h=f.attachments.reduce(function(a,b){if(!b.isOverMaxLinkSize()){return a}var c=b.get("size");var d=a.total,e=a.max,f=a.count,g=a.extensions;g.push(b.get("content_type"));return{max:Math.max(c,e),total:d+c,count:f+1,extensions:g}},{total:0,max:0,count:0,extensions:[]}),i=h.total,j=h.max,k=h.count,l=h.extensions;if(k){B.default({type:"compose_oversize-cloud_send",dwh:{count:k,total:i,max:j,extensions:l.join()}})}}B.default("compose_send");var m=f.id,n=f.cid,o=f.uid;O.add("send",{id:m,cid:n,uid:o,schedule:c});e._sendEmailTypeRadar(f.get("correspondents.from.0.email"));e._sendTranslationTypeRadar(f.meta("lastSavedTranslation"));a.set("sending",false);e._openSentPage(a,{isLateSent:c,lateSentText:d});if(c){e.onLateSent(f)}else{e.onSent(f)}},function(b){B.default("compose_send_fail");a.set({sending:false,errors:b.body,capcha:null});e.onFailSent(f,b,a)}).catch(function(){a.set("sending",false)})},unsubscribeCaptchaCallback:function(a){if(this._sendingCaptchaCallbacks[a]){v.default.off("open-captcha-popup",this._sendingCaptchaCallbacks[a]);delete this._sendingCaptchaCallbacks[a]}},isCancelDeliveryTurnOn:function(a){if(!a){return false}var b=a.get("cancellation_token");var c=a.get("cancellation_button_lifetime");return b&&c},_openSentPage:function(b,c){var d=this;var e=this.get("router");var f=b.get("form");var h=this.isCancelDeliveryTurnOn(f);var i=!a.default.placement("sent")&&g.SENT_PAGE_NOTIFY;var j=f.uid;var k=c.isLateSent,l=c.lateSentText;this._sending[j]=true;this.hide(j);this.layerPromise=x.default.open("sent-page",{model:f,loading:false,link:e.getUrl("#letters",{folder:n.default.SENT}),router:e,"is-delivery-cancel-version":h,"is-notify-version":i,"cancel-lifetime":f.get("cancellation_button_lifetime"),isLateSent:k,lateSentText:l},{dimmer:!i,silent:i,"close-on-esc":!i,resolvable:false});this.layerPromise.then(function(a){a.on("resent",d.onSent.bind(d));a.on("layer:close",function(a){var b=a.details;if((b===null||b===void 0?void 0:b.type)!=="compose-back"){d.close(f.uid)}P();d.broadcast("window-hide")})})},saveDraft:function(a,b){var c=this;var d=b===void 0?{}:b,e=d.silent,g=e===void 0?false:e,h=d.userAction,i=h===void 0?false:h;var j=a.get("form");if(a.is("closing")){return j.save().then(function(){B.default("compose_save");return f.default.updateAll()}).then(function(){c.showDraftNotify(false,"default")}).catch(function(a){c.onFailDraft(a,false)})}a.set("saving",true);return j.save().then(function(){B.default("compose_save");var b=j.id,d=j.cid,e=j.uid;O.add("save",{id:b,cid:d,uid:e});a.set({saving:false,"has-changes":false});a.setAutosaveInterval(false);c.reloadFormData(j);if(!g){c.showDraftNotify()}}).then(function(){return f.default.updateAll()}).catch(function(b){var d=i;c.onFailDraft(b,false);var e=j.id,f=j.cid,g=j.uid;O.add("save failed",{id:e,cid:f,uid:g,error:b});a.set(__assign(__assign({},d&&{errors:b.body}),{saving:false,"has-changes":true}))})},onFailDraft:function(a,b,c){if(c===void 0){c=true}B.default("compose_save_"+(b?"template_":"")+"fail");try{var d=a.body;var e=d&&Object.keys(d).some(function(a){return/^attaches.list\[.*].id$/.test(a)&&d[a].error==="not_exists"});if(e){B.default("compose_save_"+(b?"template_":"")+"fail_badattach")}}catch(a){console.error(a);B.default("compose_save_"+(b?"template_":"")+"fail_unknown")}if(c){this.showDraftFailNotify(b)}},showDraftFailNotify:function(a,b){if(b===void 0){b="compose-notify"}var c=i18n("Не удалось сохранить в Черновики");if(a){c=i18n("Не удалось сохранить в Шаблоны")}z.default.add({type:z.default.types.error,text:c,qa:"message-save-fail"},b)},saveTemplate:function(a){var b=this;var c=a.get("form");return c.save({template:true}).then(function(){B.default("compose_save_template");return f.default.updateAll().then(function(){a.set({"template-enabled":false});b.showDraftNotify(true);b.reloadFormData(c,true)})}).catch(function(c){a.set({errors:c.body});b.onFailDraft(c,true,false);B.default("compose_save_template_fail")})},showDraftNotify:function(a,b){var c=this;if(a===void 0){a=false}if(b===void 0){b="compose-notify"}var d=new Date;var e=this.get("router");var f=z.default.add({text:a?i18n("Сохранено в шаблонах в {now}",{now:I.formatDate(d,[["hour","2-digit"],["minute","2-digit"]])}):i18n("Сохранено в черновиках в {now}",{now:I.formatDate(d,[["hour","2-digit"],["minute","2-digit"]])}),actions:[{text:i18n("Посмотреть"),event:a?"openTemplate":"openDraft"}]},b);f===null||f===void 0?void 0:f.on("action",function(a){var b=a.details;if(b==="openDraft"){if(c.get("active")){c.hide()}e.go("#letters",{folder:n.default.DRAFTS})}else if(b==="openTemplate"){if(c.get("active")){c.hide()}e.go("#letters",{folder:n.default.TEMPLATES})}})},showExceedNotify:function(a){if(a===void 0){a="compose-notify"}var b={text:i18n("Картинка прикреплена как вложение"),qa:"image-attached-as-file"};z.default.add(b,a)},removeDraft:function(a){var b=this.get("router");b.model.letters.filter(function(b){var c=b.getFolder();return c.isDrafts()&&!c.isTemplates()&&b.get("last")===a}).forEach(function(a){o.default.all.remove(a)})},onLateSent:function(a){this.close(a.uid);var b=a.get("source.draft");this.layerPromise.then(function(b){b.set({loading:false,"sent-id":a.id})}).catch(function(a){z.default.add({text:i18n("Письмо будет отправлено")});console.error(a)});if(b){this.removeDraft(b)}this.reloadFormData(a,false,true)},onSent:function(a){var b=this;var c;var d=a.get("source.reply")||a.get("source.forward");var e=a.get("source.draft");var f=p.default.getListByMessageId(d);var g=this.get("router");this.close(a.uid);var h=p.default.findOne(a.id);this.set("autosend",false);(c=this.layerPromise)===null||c===void 0?void 0:c.then(function(b){var c=g.getUrl("#read-letter",{folder:n.default.SENT,letter:a.id});b.set({link:c,loading:false,"sent-id":a.id});B.default("compose_sent-page")}).catch(function(a){z.default.add({text:i18n("Письмо отправлено")});B.default("compose_sent-page");B.default("compose_sent-page_layer-error");console.error(a)});h.then(function(){f.forEach(function(b){if(b.get("last")===d){a.get("source.reply")&&b.set("flags.reply",true,{silent:true});a.get("source.forward")&&b.set("flags.forward",true,{silent:true})}b.expire()&&b.fetch()});if(e){b.removeDraft(e)}b.reloadFormData(a,false,true)}).catch(function(a){B.default("compose_sent-page_thread-error");console.error(a)});if(a.get("calls")){this.radar(["send","calls"])}},onFailSent:function(a,b,c){var d=b.body,e=b.status;delete this._sending[a.uid];this.unsubscribeCaptchaCallback(a.uid);if(r.default.codes[e]==="invalid"&&d===N){z.default.add({type:z.default.types.error,text:i18n("Превышен лимит на размер письма")},"compose-notify");return}this.showSendFailNotify();if(this.get("close-on-error")){this.onClose({details:c})}},showSendFailNotify:function(a){if(a===void 0){a="compose-notify"}z.default.add({type:z.default.types.error,text:i18n("Не удалось отправить письмо"),qa:"message-send-fail"},a)},reloadFormData:function(a,b,c){if(!b){this.updateAffectedMessage(a,c)}y.default.invalidateCache();y.default.emit("any:reload")},updateAffectedMessage:function(a,b){var c=["reply","forward"];var d=c.find(function(b){return a.is("source."+b)});if(d){var e=o.default.all.get(a.get("source."+d));if(e){if(b){e.set("drafts."+d,"")}else{var f=[];["to","cc"].forEach(function(b){a.get("correspondents."+b).forEach(function(a){if(~a.email.indexOf("@")&&!f.includes(a.email)){f.push(a.email)}})});if(d==="reply"&&f.length>1){d="replyall"}var g={"drafts.last_type":d};g["drafts."+d]=a.get("source.draft");e.set(g)}}}},getCollapsed:function(a){var b=this;var c=this.get("active");return a.filter(function(a){var d=a.formData;return d.uid!==c&&!b._sending[d.uid]})},add:function(a,b){var c=this.get("items").find(function(b){var c=b.formData;if(c.uid===a.uid){return true}else{var d=c.get("source");var e=a.get("source");var f=d.draft&&!Object.keys(d).some(function(a){return d[a]!==e[a]});if(f){return true}}return false});if(c){this.animate("expand",L);this.show(c.formData.uid);return}this.animate("open",J);this.get("items").push({formData:a,autosend:b&&b.autosend,isDragAndDrop:b&&b.isDragAndDrop,dragAndDropItem:b&&b.dragAndDropItem,additionalOptions:b});this.show(a.uid);this.render()},show:function(a){this.set("active",a);if(g.COMPOSE_SEND_USER_TRACK){l.default.startComposeTrack(a)}t.default.sleep.apply(t.default,t.SLOTS_EXCEPT_SENT);this.broadcast("window-show")},hide:function(a){var b=this.get("active");if(!a&&b!==null){a=this.get("items").find(function(a){var c=a.formData;return c.uid==b}).formData.uid}if(a===b){this.set("active",null)}if(g.COMPOSE_SEND_USER_TRACK){l.default.pauseComposeTrack(a)}},close:function(a){var b=this.get("active");a===b&&this.set("active",null);this.remove(a)},remove:function(a){delete this._sending[a];this.unsubscribeCaptchaCallback(a);var b=this.get("items").filter(function(b){var c=b.formData;return c.uid!==a});this.set({items:b});if(g.COMPOSE_SEND_USER_TRACK){l.default.removeCompose(a)}},_updateComposeStatsFields:function(a){var b=s.default.getCachedAll();if(b){var d=a.get("correspondents");var e=[];["to","cc","bcc"].forEach(function(a){d[a].forEach(function(a){var c=a.email;if(s.isInAddressbook(b,c)){e.push(1)}else{e.push(0)}})});var f={is_in_ab:e.join(""),ab_size:String(b.length)};a.set("compose_stat",f,{silent:true});c.default.send("compose_stat&i=ab_size:"+f.ab_size,null)}},_updateComposeUserTrackFields:function(a){var b=l.default.serialize(a.uid);a.set("compose_stat.user_track",b,{silent:true});c.default.send("compose-user-track",{i:{size:b.length}})},_getCollectors:function(){return this.get("router").model.collectors},_getAliases:function(){return this.get("router").model.aliases},_sendEmailTypeRadar:function(a){var b="unknown-email";if(a===u.default.user.getEmail()){b="main-email"}if(this._getCollectors().some(function(b){return b.getEmail()===a})){b="collector"}if(this._getAliases().some(function(b){return b.getEmail()===a})){b="alias"}B.default(["send","email",b])},_sendTranslationTypeRadar:function(a){if(!a){return}B.default({type:"send_translated_languages",intervals:[["from",a.fromlang],["to",a.tolang]]});B.default("send_translated")},insertHtml:function(a){var b=this.ids["compose-"+this.get("active")];if(b){b.insertHtml(a)}},useNewToolbar:function(){return g.NEW_TOOLBAR}}))});define("feast-tpl!app/feast-tpl!ui-block/gallery/gallery.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="hasPreviousControl" value="{this.hasPreviousControl()}"/>\n\t<fn:var name="hasNextControl" value="{this.hasNextControl()}"/>\n\t<fn:var name="blockCount"/>\n\n\t<bem:mod name="arrows-bottom" test="~attrs.controls.indexOf(\'arrows_bottom\')"/>\n\n\t\x3c!-- Элементы списка --\x3e\n\t<div\n\t\t\tbem:elem="content-outer"\n\t\t\tref="contentOuter"\n\t>\n\t\t<div\n\t\t\t\tbem:elem="content-inner"\n\t\t\t\tref="content"\n\t\t>\n\t\t\t<bem:mod name="animated" test="attrs._animated"/>\n\n\t\t\t<fn:apply-match name="default" count="blockCount"/>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="controls">\n\t\t\x3c!-- Кнопка "Назад" --\x3e\n\t\t<div\n\t\t\t\tbem:elem="nav-button"\n\t\t\t\ttitle="{i18n(\'Назад\')}"\n\t\t\t\tremit:click="click:previous"\n\t\t\t\ttabindex="-1"\n\t\t>\n\t\t\t<bem:mod name="hidden" test="!hasPreviousControl"/>\n\n\t\t\t<b:ico name="navigation:arrow_list_previous" size="s"/>\n\t\t</div>\n\n\t\t\x3c!-- Текущая страница --\x3e\n\t\t<div bem:elem="pages" fn:if="~attrs.controls.indexOf(\'pages\')">\n\t\t\t{_this._findCurrentStartIndex() | formatPages:blockCount}\n\t\t</div>\n\n\t\t\x3c!-- Кнопка "Вперёд" --\x3e\n\t\t<div\n\t\t\t\tbem:elem="nav-button"\n\t\t\t\ttitle="{i18n(\'Вперёд\')}"\n\t\t\t\tremit:click="click:next"\n\t\t\t\ttabindex="-1"\n\t\t>\n\t\t\t<bem:mod name="hidden" test="!hasNextControl"/>\n\n\t\t\t<b:ico name="navigation:arrow_list_next"/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/gallery/gallery.html")});define("feast-tpl!ui-block/gallery/gallery.html",["feast-tpl!app/feast-tpl!ui-block/gallery/gallery.html"],function(a){return a});define("helpers/animation-transition",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.animationTransition=void 0;function a(){var a;var b={transitionOnce:function(c,d){c();if(a){clearTimeout(a)}a=setTimeout(function(){if(b.onEnd){b.onEnd()}a=undefined},d)},stopAll:function(){if(a){clearTimeout(a);if(b.onEnd){b.onEnd()}}}};return b}exports.animationTransition=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/touch-tracker",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.touchTracker=void 0;var a={mouse:false,touch:true,mouseDragThreshold:10};function b(b,c){if(c===void 0){c={}}var d=__assign(__assign({},a),c);var e=null;var f;var g;var h;var i;var j=false;var k=false;var l=function(a,b){f=a;g=b;h=f;i=g;k=false};var m=function(a,b){if(f===undefined||g===undefined){f=a;g=b}if(h===undefined||i===undefined){h=f;i=g}var c=f-a;var j=g-b;f=a;g=b;if(Math.abs(h-f)>=d.mouseDragThreshold||Math.abs(i-g)>=d.mouseDragThreshold){k=true}if(e.onMove){e.onMove(c,j)}};var n=function(){f=undefined;g=undefined;if(e.onMoveEnd){e.onMoveEnd()}};var o=function(a){var b=a.changedTouches[0];if(b){l(b.clientX,b.clientY)}};var p=function(a){j=true;l(a.clientX,a.clientY)};var q=function(a){var b=a.changedTouches[0];if(!b){return}m(b.clientX,b.clientY)};var r=function(a){if(j){m(a.clientX,a.clientY)}};var s=function(){n()};var t=function(){j=false;n()};var u=function(a){a.preventDefault()};var v=function(a){if(k){a.preventDefault()}};if(d.touch){b.addEventListener("touchstart",o,{passive:true});b.addEventListener("touchmove",q,{passive:true});b.addEventListener("touchend",s,{passive:true});b.addEventListener("touchcancel",s,{passive:true})}if(d.mouse){b.addEventListener("mousedown",p);b.addEventListener("mousemove",r);b.addEventListener("mouseup",t);b.addEventListener("mouseleave",t);b.addEventListener("dragstart",u);b.addEventListener("click",v)}e={stop:function(){if(d.touch){b.removeEventListener("touchstart",o);b.removeEventListener("touchmove",q);b.removeEventListener("touchend",s);b.removeEventListener("touchcancel",s)}if(d.mouse){b.removeEventListener("mousedown",p);b.removeEventListener("mousemove",r);b.removeEventListener("mouseup",t);b.removeEventListener("mouseleave",t);b.removeEventListener("dragstart",u);b.removeEventListener("click",v)}}};return e}exports.touchTracker=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/gallery/gallery",["require","exports","feast","feast-tpl!./gallery.html","helpers/animation-transition","helpers/resizer","helpers/touch-tracker","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);var g=a.default.Block.extend({name:"gallery",template:b.default,blocks:{ico:f.default},mods:{formatPages:function(a,b){return i18n("{current} из {total}",{current:String(a+1),total:String(b)})}},defaults:{controls:"touch, arrows_middle",_offset:0,_width:window.innerWidth},attrChanged:{_width:function(a){var b=this;this.checkScrollEnd();if(!a){return}if(this.allBlocksVisibleTimeout){clearTimeout(this.allBlocksVisibleTimeout)}this.allBlocksVisibleTimeout=setTimeout(function(){if(b.isMounted()&&b._fitsInWidth(a)){b.broadcast("all-blocks-visible")}b.allBlocksVisibleTimeout=null});if(this.allBlocksRenderedTimeout){clearTimeout(this.allBlocksRenderedTimeout)}this.allBlocksRenderedTimeout=setTimeout(function(){if(b.isMounted()){b.handleAllBlocksRendered()}b.allBlocksRenderedTimeout=null},500)},_offset:function(){this.checkScrollEnd()}},events:{"click:previous":"onClickPrevious","click:next":"onClickNext","touchstart:content-inner":"onTouchStart","touchmove:content-inner":"onTouchMove"},constructor:function(){var b=this;a.default.Block.apply(this,arguments);this.onResize=this.onResize.bind(this);this._itemOffsets=[];this._itemsWidth=0;this._transition=c.animationTransition();this._transition.onEnd=function(){if(b.isMounted()){b.set("_animated",false)}}},didMount:function(){this._resizer=d.default();this._resizer.set(this.onResize);this._resizer.observe(this.refs.content,"content");this._resizer.observe(this.refs.contentOuter,"contentOuter");this._measureItemOffsets({});this.onResize();this.setupTouchTracker()},didUpdate:function(){this._measureItemOffsets({})},shouldUpdate:function(a){if(a._offset!==undefined){this.refs.content.style.marginLeft=-a._offset+"px";return Object.keys(a).length>1}if(a.controls!==undefined&&this._touchTracker){this._touchTracker.stop();this.setupTouchTracker()}return true},didUnmount:function(){this._resizer.unbind();this._touchTracker.stop();this._transition.stopAll()},setupTouchTracker:function(){var a=this;this._touchTracker=e.touchTracker(this.el,{touch:this.get("controls").includes("touch"),mouse:this.get("controls").includes("mouse")});this._touchTracker.onMove=function(b){a.set("_offset",Math.max(Math.min(a.get("_offset")+b,a._itemsWidth-a.get("_width")),0))};this._touchTracker.onMoveEnd=function(){a._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(a._findNearestStartIndex()),_animated:true})},200)}},onClickPrevious:function(){var a=this;if(this.hasPreviousControl()){var b=this._findCurrentStartIndex();this._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(b-1),_animated:true})},200)}},onClickNext:function(){var a=this;if(this.hasNextControl()){var b=this._findCurrentStartIndex();this._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(b+1),_animated:true})},200)}},onResize:function(a){var b=this._getOuterRectWidth(a!==null&&a!==void 0?a:{});this._measureItemOffsets(a!==null&&a!==void 0?a:{},false);this.set({_width:b,_offset:this._getItemOffset(this._findCurrentStartIndex(),b)})},hasPreviousControl:function(a){if(a===void 0){a=this.get("_offset")}return!this._fitsInWidth()&&a>0},hasNextControl:function(a){if(a===void 0){a=this.get("_offset")}return!this._fitsInWidth()&&this._itemsWidth-a>this.get("_width")&&this._findCurrentStartIndex()<this._itemOffsets.length-1},_getItemOffset:function(a,b){var c;if(b===void 0){b=this.get("_width")}var d=((c=this._itemOffsets[a])!==null&&c!==void 0?c:{offset:0}).offset;var e=this._fitsInWidth(b)?d:Math.max(b-(this._itemsWidth-d),0);return d-e},_findCurrentStartIndex:function(){var a=this.get("_offset");for(var b=0;b<this._itemOffsets.length;b++){var c=this._itemOffsets[b];if(Math.round(c.offset)>=Math.round(a)){return b}}return 0},_findNearestStartIndex:function(){var a=this.get("_offset");var b=0;var c=-1;for(var d=0;d<this._itemOffsets.length;d++){var e=this._itemOffsets[d];var f=Math.abs(a-e.offset);if(f<c||c===-1){b=d;c=f}}return b},_fitsInWidth:function(a){if(a===void 0){a=this.get("_width")}return this._itemsWidth<=a},_getOuterRectWidth:function(a){if(a.contentOuter){return a.contentOuter.width}var b=this.refs.contentOuter.getBoundingClientRect();return b?b.width:window.innerWidth},_measureItemOffsets:function(a,b){var c,d,e;if(b===void 0){b=true}if(!a.content){if(!this.refs.content){return}if(b){a.content=(c=this.refs.content.getBoundingClientRect())!==null&&c!==void 0?c:{width:window.innerWidth}}}this._itemsWidth=(e=(d=a.content)===null||d===void 0?void 0:d.width)!==null&&e!==void 0?e:this._itemsWidth;this._itemOffsets=[];var f;var g=0;var h=0;for(var i=0;i<this.refs.content.children.length;i++){var j=this.refs.content.children[i];var k=a[i];var l=this._itemOffsets[i];var m=this._getItemAbsoluteOffset(j,k,l),n=m[0],o=m[1];if(f===undefined){f=n}var p=n-f;var q=n-g-h;this._itemOffsets.push({offset:p,width:o,margin:q});g=n;h=0}},_getItemAbsoluteOffset:function(a){var b;var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}c=c.filter(function(a){return!!a});if(!c.length){c.push(a.getBoundingClientRect())}var e=c[0];return e?[(b=e.left)!==null&&b!==void 0?b:e.offset,e.width]:[0,0]},checkScrollEnd:function(){var a=this.hasNextControl();if(this._lastHasNextControl&&!a&&!this._fitsInWidth()){this.broadcast("scroll-end")}this._lastHasNextControl=a},getVisibleItemsCount:function(){var a=this.get("_width");var b=0;this._itemOffsets.forEach(function(c){if(c.offset+c.width<a){b++}});return b},handleAllBlocksRendered:function(){var a=this.getVisibleItemsCount();this.broadcast("all-blocks-rendered",{visibleItemsCount:a})}});exports.default=g});define("feast-tpl!app/feast-tpl!ui-block/unsubscribe/unsubscribe.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:dropdown\n\t\t\tid="unsubscribe-dropdown"\n\t\t\tradar-id="unsubscribe"\n\t\t\ttext="{attrs[\'dropdown-button-text\']}"\n\t\t\tico="status_block"\n\t\t\tbase\n\t\t\tpure\n\t\t\ttouch="{attrs.touch}"\n\t\t\tshort="{attrs.touch || attrs.withoutText}"\n\t\t\tremit:dropdown-change-state="expanded"\n\t\t\texpand-left="{attrs[\'position-right\']}"\n\t\t\tauto-close="{false}"\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tpromoId="{attrs.promoId}"\n\t>\n\t\t<fn:match name="items" args="data">\n\t\t\t<fn:if test="data.attrs.expanded">\n\t\t\t\t<b:react-async\n\t\t\t\t\t\tcomponent="UnsubscribeDropdown"\n\t\t\t\t\t\tonButtonClick="{_this.onUnsubscribeButtonClick.bind(_this)}"\n\t\t\t\t\t\tonClose="{data.hide}"\n\t\t\t\t\t\tsenderName="{attrs.senderFrom}"\n\t\t\t\t\t\tlettersCount="{attrs[\'sender-letters\']}"\n\t\t\t\t\t\tinProgress="{attrs[\'in-progress\']}"\n\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/unsubscribe/unsubscribe.html")});define("feast-tpl!ui-block/unsubscribe/unsubscribe.html",["feast-tpl!app/feast-tpl!ui-block/unsubscribe/unsubscribe.html"],function(a){return a});define("helpers/unsubscribe-actions",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.EUnsubscribeAction={UNSUBSCRIBE:"unsubscribe_action",UNSUBSCRIBE_READ:"unsubscribe_read_action",UNSUBSCRIBE_REMOVE:"unsubscribe_remove_action"}});define("ui-block/unsubscribe/unsubscribe",["exports","default-values","feast","feast-mod/correspondents","feast-tpl!./unsubscribe.html","helpers/radar-utils","helpers/unsubscribe-actions","RPC","service/radars/decorator","service/radars/index","ui-block/dropdown/dropdown","ui-block/react-async/react-async"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=s(b);var m=s(d);var n=s(g);var o=s(h);var p=s(i);var q=s(j);var r=s(k);function s(a){return a&&a.__esModule?a:{default:a}}exports.default=l.default.Block.extend((0,o.default)({events:[{name:"unsubscribe",data:e.getModelData}]})({name:"unsubscribe",template:m.default,isolateEvents:false,mods:{correspondent:c.correspondent},blocks:{dropdown:q.default,"react-async":r.default},defaults:{"sender-letters":0,"dropdown-button-text":i18n("Отписаться от рассылки"),"is-component-visible":false,"actions-finished":false,"in-progress":false},events:{expanded:"handleExpandEvent"},attrChanged:{"actions-finished":function a(b){if(b){this.ids["unsubscribe-dropdown"].hide();this.set("in-progress",false)}},model:function b(){var c=this;(0,p.default)({type:"unsubscribe_button_show",intervals:[["button_position",this._getPositionString()]]});if(this.is("short")){this.set("dropdown-button-text",i18n("Отписаться"))}if(!a.UNSUBSCRIBE_COUNT_ALL){return}n.default.call("messages/count/all",{from:[this.get("senderFrom")],only_newsletters:true}).then(function(a){var b=a.body.count;if(!b){return}if(!c.is("is-component-visible")){c.set("sender-letters",b);(0,p.default)("unsubscribe_count_all-success")}}).catch(function(a){return(0,p.default)("unsubscribe_count_all-error",a)})}},onUnsubscribeButtonClick:function a(b){var c=this.get("letterId");var d=this.get("senderFrom");var e=this.get("insteadSpamButton");this.set("in-progress",true);(0,p.default)({type:"unsubscribe_button_click",intervals:[["action_type",b],["button_position",this._getPositionString()]],dwh:{position:e?"portal-menu":"default",action_type:b}});this.broadcast("unsubscribe",{ids:Array.isArray(c)?c:[c],position:e?"portal-menu":"default"});switch(b){case f.EUnsubscribeAction.UNSUBSCRIBE:return;case f.EUnsubscribeAction.UNSUBSCRIBE_REMOVE:this.broadcast("moveallfrom",{from:d});break;case f.EUnsubscribeAction.UNSUBSCRIBE_READ:this.broadcast("markallfrom",{from:d});break}},handleExpandEvent:function a(b){if(!b.details){return}var c=b.details.state;if(c){(0,p.default)({type:"unsubscribe_open_click",intervals:[["button_position",this._getPositionString()]]})}this.set("is-component-visible",c)},_getPositionString:function a(){return this.is("position-right")?"right":"left"}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html",["feast"],function(a){return a.smartParse('<div\n  ref="layer-cleanmaster-modal"\n>\n</div>\n',"app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html")});define("feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html",["feast-tpl!app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal",["require","exports","@mail/features","@mail/xray","default-values","feast","feast-tpl!./layer-cleanmaster-modal.html","mediator/unsubscribe-actions","service/notify"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);var h=function(a){var b=a.text,d=a.qa;g.default.add({text:b,qa:d,duration:c.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION,inline:false})};var i=function(a){var b=a.text,d=a.qa;g.default.error({text:b,qa:d,duration:c.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION,inline:false})};var j={remove:"@modal/senders/remove",unsubscribe:"@modal/senders/unsubscribe"};exports.default=d.default.Block.extend({name:"layer-cleanmaster-modal",template:e.default,blocks:{},_modalPage:null,defaults:{compact:false,isAvailable:false},events:{},_isValidAction:function(a){return a in j},didMount:function(){var c=this;var d=this.refs["layer-cleanmaster-modal"];var e=this.get("ponymode");var g=this.get("action");var k=this.get("from");var l=this.onClose.bind(this);if(!this._isValidAction(g)){this.set("isAvailable",false);return}window.require(["cleanmaster"],function(m){c._modalPage=m.createCleanmasterModal(d,{features:a.default,septima:false,app:false,touch:false,octavius:true,headerMode:"hidden",isDockSettings:false,compact:e});var n={"@stat/radar":function(a){var c=a.name,d=a.params,e=a.dwh,f=e===void 0?{}:e;b.default.send(c,{i:d,v:1,dwh:__assign(__assign({},f),{query:true})})},"@clean/clean/success":function(a){var b=a.senders,c=b===void 0?[]:b;f.default.deleteSenderFromUnsubscribeList(c.map(function(a){var b=a.emails;return b}))},"@notify/success":h,"@notify/info":h,"@notify/error":i,"@redux-popup/popup/CLOSE_ALL":l};Object.keys(n).forEach(function(a){c._modalPage.on(a,n[a])});c._modalPage.create();c._modalPage.store.dispatch({type:j[g],payload:{sendersEmailList:k}})});this.set("isAvailable",true)},onClose:function(){var a;var b=this.get("isAvailable");if(!b){return}(a=this._modalPage)===null||a===void 0?void 0:a.destroy();this.set("isAvailable",false);this.broadcast("layer:close")}})});define("feast-tpl!app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="spinner">\n\t\t<div bem:elem="spinner-container">\n\t\t\t<b:spinner/>\n\t\t</div>\n\t</fn:match>\n\n\t<b:layer name="edit-settings-filter"\n\t\t\t remit:close="layer:close"\n\t\t\t center\n\t\t\t hiddenfooter\n\t\t\t standard>\n\n\t\t<fn:match name="content">\n\t\t\t<div class="layer-edit-settings-filter_content" ref="content">\n\t\t\t\t<fn:apply-match name="spinner"/>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html")});define("feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html",["feast-tpl!app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/actions/Edit",["require","exports","RPC","Action","filters/Filter"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=b.default.extend({url:c.default.url("edit"),prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){a.filters.forEach(function(a){if(a.actions.notify&&!a.actions.notify.length){delete a.actions.notify}if(a.actions.replace_category===null){delete a.actions.replace_category}});return a},operation:function(b){var c={};b.filters.forEach(function(a,b){if(!a.id){c["filters."+b+".id"]="required"}});if(Object.keys(c).length){return Promise.reject(c)}return a.default.call(this.url,b).then(function(a){return d.processResult(b,a)})}});d.processResult=function(a,b){return c.default.map(a.filters.map(function(a,c){a.id=b.get("body."+c);a.apply_folders=b.get("data.apply_folders");if(!a.conditions){a.conditions=[]}return a}))};b.default.register("filters.Edit",d);d.version="0.1.0";exports.default=d;return d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-edit-settings-filter/layer-edit-settings-filter",["require","exports","data-source/index","default-values","feast","feast-tpl!./layer-edit-settings-filter.html","filters/actions/Edit","filters/actions/SaveSeveral","filters/Filter","helpers/define-utils","mail/Folder","service/getModule","service/notify","service/radars/decorator","service/radars/index","service/secure-folder","ui-block/layer/layer","ui-block/spinner/spinner"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);exports.default=c.default.Block.extend(l.default()({name:"layer-edit-settings-filter",template:d.default,blocks:{layer:o.default,spinner:p.default},events:{close:"onClose",cancel:"onCancel"},defaults:{filterModel:{},applyFolders:[],expandExtendOptions:false},onLoad:function(){},onClose:function(){this.broadcast("layer:close")},onCancel:function(){},didUnmount:function(){this.editor.unmount()},load:function(){var a=this;return new Promise(function(b){Promise.all([j.default("blitz")]).then(function(){h.defineExternalForSyncUse("filters/actions/Edit",e.default);h.defineExternalForSyncUse("filters/Filter",g.default);h.defineExternalForSyncUse("filters/actions/SaveSeveral",f.default);j.default("filters.mail.ru").then(function(c){a.ui=c;require(["mediator/themes-manager"],function(c){var d=c.default;d.register(a);b()})})})})},didMount:function(){var c=this;this.load().then(function(){if(!c.isMounted()){return}var d=c.refs.content;c.editor=new c.ui(d);c.editor.mount({model:c.get("filterModel"),templateValues:c.get("templateValues"),expandExtendOptions:c.get("expandExtendOptions"),useBlackTheme:c.is("dark-mode"),useOctaviusTheme:true,autoreplyLink:b.SETTINGS_AUTOREPLY_LINK,config:{radar:{p:b.RADAR_PROJECT},popup:true},onClose:function(){c.onClose()},onCancel:function(){c.onClose()},successSave:function(){c.onClose();setTimeout(function(){a.default.updateAll()},b.FILTER_SAVE_UPDATE_TIMEOUT);k.default.add({text:i18n("Фильтр успешно создан")})},successApply:function(){setTimeout(function(){a.default.updateAll()},b.FILTER_SAVE_UPDATE_TIMEOUT)},onSendRadar:m.default,onFolderNeedOpen:function(a){return i.default.findOne({id:a}).then(function(a){return n.default(a)}).then(function(a){return!a&&Promise.reject()})}})})}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html",["feast"],function(a){return a.smartParse("<div/>\n","app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html")});define("feast-tpl!ui-block/layer-create-folder/layer-create-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-create-folder/layer-create-folder",["require","exports","@mail/features","data-source/index","feast","feast-tpl!./layer-create-folder.html","mail/Folder","service/getModule","service/mailbox/loader","service/secure-folder"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);function i(a){var b;return((b=a)===null||b===void 0?void 0:b.moveLetters)===true}exports.default=c.default.Block.extend({name:"layer-create-folder",template:d.default,defaults:{mode:"new",model:null,selectMode:false},registerInMediators:function(){var a=this;return new Promise(function(b){require(["mediator/letters-selection"],function(c){var d=c.default;d.register(a);b()})})},didMount:function(){var c=this;var d=this.attrs,j=d.model,k=d.mode;this.registerInMediators().then(function(){if(!c.isMounted()){return}var d=false;var l=null;if(i(j)){d=j.moveLetters;l=j.letterCurrentFolder}var m=k==="edit"||d?null:j;var n=c.get("selectMode");var o=d?function(a){g.default.invalidateCache();c.broadcast("move",{id:a.id,selection:n})}:function(){g.default.invalidateCache();b.default.updateAll()};Promise.all([f.default("react"),f.default("blitz")]).then(function(b){var f=b[0],g=b[1],i=g.CreateFolder,n=g.LayerManager;if(!c.isMounted()){return}var p=c.layerManager||new n;p.setup(c.el,{popup:false,radarPrefix:"folders-lr"});var q={mode:k,folder:k==="edit"?j:new e.default({name:""}),parentFolder:m,folders:e.default.all,FEATURES:a.default,onClose:c.onClose.bind(c),handleFinal:o,isMoveLetters:d,letterCurrentFolder:l,openSecureFolder:h.default,layerManager:p};var r=p.openLayer(f.createElement(i,q),{noPanelWrap:true,responsive:"auto"}).id;c.layerManager=p;c.id=r})})},onClose:function(){this.broadcast("layer:close");if(this.layerManager){this.layerManager.destroyLayer(this.id)}}})});define("feast-tpl!app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-confirm-delete-folder">\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="touch" test="attrs.mobile"/>\n\t<bem:mod name="full" test="!attrs.mobile"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:layer\n\t\t\tremit:close="layer:close"\n\t\t\tmodel="{attrs.model}"\n\t\t\terror="{attrs.error}"\n\t\t\tmobile="{attrs.mobile}"\n\t\t\tprocessing="{attrs.processing}"\n\t\t\tname="confirm-clear-folder"\n\t\t\tclose\n\t\t\theader\n\t\t\tfooter\n\t\t\tcenter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\n\t\t<fn:match name="header" args="attrs">\n\t\t\t{messages.confirm}\n\t\t</fn:match>\n\n\t\t<fn:match name="content" args="attrs">\n\t\t\t<fn:if test="attrs.error">\n\t\t\t\t<div bem:elem="error" qa:id="{attrs.error}">\n\t\t\t\t\t{messages[attrs.error]}\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t{i18n(\'Все письма будут перенесены в папку «Корзина».\')}\n\t\t</fn:match>\n\n\t\t<fn:match name="footer" args="attrs">\n\t\t\t<div bem:elem="submit-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="layer:resolve"\n\t\t\t\t\t\tdisabled="{attrs.processing}"\n\t\t\t\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\tqa:id="submit"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="cancel-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="layer:close"\n\t\t\t\t\t\tdisabled="{attrs.processing}"\n\t\t\t\t\t\ttext="{i18n(\'Отменить\')}"\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html")});define("feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder",["require","exports","feast","feast-tpl!./layer-confirm-delete-folder.html","ui-block/button2/button2","ui-block/layer/layer"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"layer-confirm-delete-folder",template:b.default,blocks:{layer:d.default,button2:c.default},events:{"layer:resolve":"onConfirm"},defaults:{processing:false,error:null},getMessages:function(){return{confirm:i18n("Удалить папку «{folderName}»?",{folderName:this.attrs.model.get("name")}),isCollectorRoot:i18n("Нельзя удалить папку, так как в неё собирается почта из другого ящика"),systemFolder:i18n("Невозможно удалить системную папку"),folderNotExists:i18n("Папка больше не существует"),invalidFolder:i18n("Невозможно удалить папку"),unknownError:i18n("Произошла неизвестная ошибка")}},onConfirm:function(){if(this.is("processing")||this.is("error")){return}this.set("processing",true)}})});define("feast-tpl!app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-metathreads-settings" promo:id="layer-metathreads-settings">\n\t<b:react-async\n\t\tkey="{attrs.metathreadsData.length}"\n\t\tcomponent="MetathreadsSettingsContainer"\n\t\tlayer\n\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\tmetathreadsData="{attrs.metathreadsData}"\n\t\tonHelpClick="{_this.onHelpClick}"\n\t\tonSettingsEdit="{_this.onSettingsEdit}"\n\t\tonClose="{_this.onClose}"\n\t\tuse:mediator="settings-manager themes-manager folders-actions"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html")});define("feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html",["feast-tpl!app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-metathreads-settings/layer-metathreads-settings",["require","exports","data-source/actions","feast","feast-tpl!./layer-metathreads-settings.html","helpers/data-source-dispatch","service/radars/decorator","ui-block/layer/layer","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend(e.default({events:[{name:"help:open",rename:"help_open"}]})({name:"layer-metathreads-settings",template:c.default,defaults:{helpLink:"metathreads",metathreadsData:[]},blocks:{layer:f.default,"react-async":g.default},constructor:function(){b.default.Block.apply(this,arguments);this.onClose=this.onClose.bind(this);this.onSettingsEdit=this.onSettingsEdit.bind(this);this.onHelpClick=this.onHelpClick.bind(this)},onClose:function(){this.broadcast("layer:close")},onSettingsEdit:function(b){var c=this;return d.default({type:a.EDIT_METATHREADS_SETTINGS,settings:b}).then(function(a){c.broadcast("metathreads:settings:updated");return a})},onHelpClick:function(){this.broadcast("help:open",this.attrs.helpLink)}}))});!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("RPC")):"function"==typeof define&&define.amd?define("@mail/e.mail.ru.feedback",["RPC"],b):"object"==typeof exports?exports.mailEMailRuFeedback=b(require("RPC")):a.mailEMailRuFeedback=b(a.RPC)}(self,function(a){return b={3633:function(a,b){!function(a){"use strict";var b=function(){return(b=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},c=window;function d(){}function e(a,b){!function(a,b){var e,f=function(a){!a&&4!==e.readyState||(a=a||200!==e.status&&201!==e.status,f=d,e.onreadystatechange=null,b(!!a,e))};try{e=new c.XMLHttpRequest}catch(a){try{e=new c.ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{e=new c.ActiveXObject("Microsoft.XMLHTTP")}catch(a){(e={readyState:4,status:-1}).open=e.send=d}}}e.onerror=function(a){e.onerror=null,f(a)};try{e.open("GET",a,!0),e.send(null),e.onreadystatechange=function(){f()}}catch(a){f(a)}}(a,function(a,c){if(a)b(a,null);else try{b(a,JSON.parse(c.responseText))}catch(a){b(a,null)}})}var f="https://stat.radar.imgsmail.ru/update?v=1&p=oauth2";function g(a){(new Image).src=f+"&t=jssdk&i="+a+":1"}var h="__mr_oauth2__";function i(a,b,c){try{var d=window.localStorage,e="".concat(h,".").concat(a),f="ttl_".concat(h,".").concat(a);if(1===arguments.length){var g=parseInt(d.getItem(f),10);if(!g||g>Date.now())return JSON.parse(d.getItem(e))}else 0<=c&&d.setItem(f,"".concat(Date.now()+1e3*c)),d.setItem(e,JSON.stringify(b))}catch(a){}return null}function j(a){return document.createElement(a)}function k(a,b){a.appendChild(b)}function l(a){try{a.parentNode.removeChild(a)}catch(a){}}function m(a,b){if(a)for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}var n=function(a,b){void 0===b&&(b="1.5s");for(var c="_".concat(Date.now()),d="".concat(c,"-spin"),e="",f=-146,g=0;f<=92;f+=2)e+='<use fill="rgb('.concat(g+=2,",").concat(g,",").concat(g,')" xlink:href="#a" transform="rotate(').concat(f,' 32 32)"/>');return"\n\t<style>\n\t.".concat(c," {\n\t\twidth: 64px;\n\t\theight: 64px;\n\t\tdisplay: inline-block;\n\t\t-webkit-animation: ").concat(d," ").concat(b," linear infinite;\n\t\t-moz-animation: ").concat(d," ").concat(b," linear infinite;\n\t\tanimation: ").concat(d," ").concat(b," linear infinite;\n\t}\n\t@-moz-keyframes ").concat(d," { 100% { -moz-transform: rotate(360deg); } }\n\t@-webkit-keyframes ").concat(d," { 100% { -webkit-transform: rotate(360deg); } }\n\t@keyframes ").concat(d,' { 100% { -webkit-transform: rotate(360deg); transform:rotate(360deg); } }\n\t</style>\n\t<div class="').concat(c,'"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64">\n\t\t<defs>\n\t\t\t<path id="a" d="M0 0h32v32H0z"></path>\n\t\t\t<mask id="progress">\n\t\t\t\t<path d="M0 0h64v64H0z"></path>\n\t\t\t\t').concat(e,'\n\t\t\t</mask>\n\t\t</defs>\n\t\t<path fill="').concat(a,'" d="M54.6 47.6c-1.98-1.98-5.09-1.98-7.07 0-8.56 8.56-22.6 8.56-31.1 0-8.56-8.56-8.56-22.6 0-31.1 4.54-5.58-3.25-10.7-7.07-7.07-12.4 12.4-12.4 32.8 0 45.3 12.4 12.4 32.8 12.4 45.3 0 1.98-1.98 1.98-5.09 0-7.07zM32 54c-12.1 0-22-9.9-22-22s9.9-22 22-22c2.8 0 5-2.2 5-5s-2.2-5-5-5C14.4 0 0 14.4 0 32s14.4 32 32 32c7.16-.736 5.26-9.84 0-10z" mask="url(#progress)">\n\t\t</path>\n\t</svg></div>\n').trim()},o="unknown",p="connected",q="not_authorized",r="default",s="onetap",t="hidden",u="embedded",v="ru-RU",w="userinfo",x="mail.phone",y="full-fit",z="mailru-login-button",A="login";a.OAUTH_HOST="https://o2.mail.ru";var B="2147483647",C="2147483646",D="__mailru_oauth_".concat(Date.now(),"_").concat(Math.random(),"__"),E="".concat(location.protocol,"//").concat(location.host),F={ui:1,type:1,lang:1,auth:!1},G=/^data-/,H=/^on(load|error|(?:before)?click|login|logout)$/,I=/^https?:/,J=/[?&]lang=([^a-z_-]+)/i,K={},L=[],M=[],N=[],O="o2_mail_ru_popup_login",P=490,Q=500,R=490,S=20,T="close_state",U="login_state",V=1,W=!1,X={clientId:null},Y=window,Z=Y.document,$={btn:"jsapi/button",login:"login",logout:"jsapi/logout",userinfo:"userinfo"},_=[],aa=!1,ba=!1,ca=!1,da=null,ea=null,fa=null,ga=null,ha=o,ia=null,ja=null,ka=[];function la(a,b){return"".concat(a,":").concat(b)}function ma(a,b,c,d){var e=la(a,b);if(K.hasOwnProperty(e)||(K[e]=[]),d){var f=function(){!function(a,b,c){var d=la(a,b);if(K.hasOwnProperty(d)){var e=K[d].indexOf(c);-1<e&&K[d].splice(e,1)}}(a,b,f),c.apply(null,arguments)};K[e].push(f)}else K[e].push(c)}function na(b,c){var d="".concat($[b])+"?client_id=".concat(X.clientId)+"&redirect_uri=".concat(E)+(c.lang?"":"&lang=".concat(X.lang));return X.recaptcha,I.test(d)||(d="".concat(a.OAUTH_HOST,"/").concat(d)),"".concat(d,"&").concat(function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&"function"!=typeof c&&null!=a[c]&&(b+="&".concat(encodeURIComponent(c),"=").concat(encodeURIComponent(a[c])));return b.substr(1)}(c))}function oa(a){Ba("call logout"),ha=ha===p?q:o,ea=ja=ia=null,ka.forEach(function(a){a.send("auth",ha)});var b=sa(!0);ta(a,b),ta(X.onlogin,b),ta(X.onlogout,b),i(U,null)}function pa(){Ba("globalOnLogin invoked"),function(){var a=sa(),b=a.user;Ba("refresh all prorts",a),ka.forEach(function(c){c.send("auth",a.status),b&&c.send("auth:user",b)})}(),ta(X.onlogin,sa())}function qa(a,b){function c(a){function c(){pa(),da.close(),ta(M,sa()),ca=!1,ea=null,M.length=0}Ba("login resolved",{ok:a,options:b}),a&&!1!==b.userinfo?ra(c):c()}if(void 0===b&&(b={}),null==b.mode&&(b.mode=r),Ba("call login",{options:b,authUser:!!ia}),ia)ta(a,sa());else{if(a&&M.push(a),ca)return;if(fa){try{fa.close()}catch(a){}fa=null,Y.clearInterval(ga)}da=function(a){var b=V++,c=function(a){var b=a.mode;return b===s&&!aa||b===u&&!ba}(a),d=ua(c,b,a),e="popup_".concat(c?"embedded_":"").concat(a.mode,"_");return Ba("openPortal",{id:b,embedded:c,options:a}),c?function(a){var b=a.id,c=a.loginUrl,d=a.radarPrefix,e=a.options;Ba("open embedded portal:",b,c,d,e);var f=j("div"),h=j("div"),i=j("iframe"),o=ya(b,i,{embedded:!0,root:f,onClose:function(){l(h)}}),p=Da(),q=p<=R+2*S,t=q?S/2:S,v=q?p-2*t:R,w=Ea()-2*t,x=e.mode===u;i.src=c,i.frameBorder="no",i.width=v+"",i.height="10",i.scrolling="no",m(i,{transform:"translate(0) scale(1,1)"}),m(f,{width:"".concat(i.width,"px"),height:"10px",position:"fixed",opacity:"0",borderRadius:"4px",transform:"translate(0, 20px)",boxShadow:"rgba(0,0,0,.16) 0 4px 20px",zIndex:B,overflow:"hidden",background:"#fff",pointerEvents:"none"}),x?(m(f,{top:"50%",left:"50%"}),m(h,{left:"0",top:"0",right:"0",bottom:"0",position:"fixed",zIndex:C,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center"}),h.innerHTML='<div style="width: 64px; height: 64px">'.concat(n("#fff"),"</div>")):m(f,{top:"".concat(t,"px"),right:"".concat(t,"px")}),k(f,i),k(Z.body,h),k(Z.body,f),g("".concat(d,"try_open")),o.on("connect",function(){g("".concat(d,"connected")),da.send("connected",{})});var y=null,z=function(a){var b,c=[],d=!1;function e(a){a(b)}return a(function(a){d||(b=a,d=!0,c.forEach(e),c.length=0)}),{then:function(a){d?e(a):c.push(a)}}}(function(a){o.on("repaint",function(b){var c=b.rect,d=da.el,e=d.parentElement,f=Math.min(c.height,w);100<c.height&&(d.height=f+"",d.width=v+"",d.scrolling=c.height>w?"yes":"no",m(e,{width:"".concat(v,"px"),height:"".concat(d.height,"px")}),(y=function(a){a&&m(e,{marginTop:"-".concat(f/2,"px"),marginLeft:"-".concat(v/2,"px")})})(x),a())})});return o.on("ready",function(a){var b=a.hidden;function c(a){return z.then(function(){if(!k){var b=x?".6s ease-out":".25s";return y(x),a&&a.position?"center"===a.position?(m(f,{top:"50%",left:"50%"}),y(!0)):(m(f,{top:a.position.top,left:a.position.left}),y(!1)):y(x),i.getBoundingClientRect(),h.textContent="",m(f,{pointerEvents:"",opacity:"1",transform:"translate(0, 0)",transition:"transform ".concat(b,", opacity ").concat(b)}),va(e),setTimeout(function(){m(f,{transition:"height .15s ease-out"})},1e3),!0}Aa("Can't show OneTap, because it already closed (it's zombie)")})}function j(){return z.then(function(){if(!k)return k=!0,o.simulate("cancel"),!0;Aa("OneTap is already closed (it's zombie)")})}g("".concat(d,"ready")),g("".concat(d,"ready_hidden_").concat(b));var k=!1;if(b)xa(e);else{var l=!1;xa(e,function(){return l=!0,{show:c,close:j}}),l||c()}}),o.on("open:login",function(a){var b=a.email;g("".concat(d,"open_login")),o.close(),qa(null,{email:b,embedded:ca=!1})}),o.on("unavailable",function(a){var b=a.mode;g("".concat(d,"unavailable_").concat(b)),b===s&&(aa=!(ca=!1),X.mode=r,X.autoLogin=!1),ta(X.onunavailable,{mode:e.mode}),o.close()}),o}({id:b,loginUrl:d,options:a,radarPrefix:e}):ea?(Ba("using proxy port",b),g("".concat(e,"_create_proxy_port")),va(a),ya(b,{postMessage:function(a){ea.send("login:proxy",a)}},{embedded:c})):(Ba("create popup portal",b),g("".concat(e,"_create_popup")),va(a),fa=function a(b){try{return Y.open(d,b,Fa())}catch(c){return"_blank"!==b?a("_blank"):null}}(O),ga=Y.setInterval(function(){try{if(!fa.top||fa.closed)throw"Y"}catch(a){Ca(b,"login:closed",{}),Y.clearInterval(ga)}},100),ya(b,fa,{embedded:!1}))}(b),ca=!0,da.embedded?(da.on("cancel",function(){ca=!1,Ba("embedded portal[login] canceled"),i(T,!0,X.ttlCloseState),g("popup_embedded_".concat(b.mode,"_canceled")),c(!1),wa(b)}),L.push(function(){Ba("embedded portal[login] resolved"),c(!0)})):(ea||da).on("login:closed",function(){Ba("portal[login] closed"),g("popup_".concat(b.mode,"_closed_proxy")),c(!0),wa(b)})}}function ra(a){ia?a(ia):(N.push(a),1===N.length&&e(na("userinfo",{access_token:ja}),function(a,b){!function(a){return!(a&&a.hasOwnProperty("error"))}(b)||(ia=b,ha=p),ta(N,ia),N.length=0}))}function sa(a){return{status:ha,user:a?null:ia,access_token:a?null:ja}}function ta(a,b){if(a instanceof Array)a.forEach(function(a){ta(a,b)});else try{a&&a.call(null,b)}catch(a){Aa(a.stack)}}function ua(a,b,c){return na("login",{scope:X.scopes.join(" "),response_type:"token",embedded:a?"Y":null,mode:c.mode,state:JSON.stringify({cid:b,loginState:i(U),ttlLoginState:X.ttlLoginState,skin:X.skin||"default",txtExp:X.txtExp||"default"}),login:c.email})}function va(a){ta(X.onshow,{mode:a.mode})}function wa(a){ta(X.onclose,{mode:a.mode})}function xa(a,b){ta(X.onready,{mode:a.mode,onetap:b?{capture:b}:void 0})}function ya(b,c,d){var e=d.root||c,f={el:c,embedded:d.embedded,root:e,send:function(d,e){var f=JSON.stringify({cid:b,type:d,detail:e});Ba("[port] send: ".concat(d,", detail:"),e);try{c.contentWindow.postMessage(f,a.OAUTH_HOST)}catch(d){try{c.postMessage(f,a.OAUTH_HOST)}catch(d){}}},simulate:function(a,c){void 0===c&&(c={}),Y.postMessage(JSON.stringify({cid:b,type:a,detail:c}),"*")},on:function(a,c,d){return c&&ma(b,a,c,d),this},close:function(){this.send("login:close",{}),l(e),function(a){var b=new RegExp("^".concat(la(a,"")));for(var c in K)b.test(c)&&delete K[c]}(b),ta(d.onClose,[]),e=c=null}};return Ba("[port] created: ".concat(b,", iframe: ").concat(c instanceof HTMLIFrameElement)),f}function za(a){if(a[D]!==D){a[D]=D,m(a,{position:"relative"});var b=function(a,b){for(var c=a.attributes.length;c--;){var d=a.attributes[c],e=d.name,f=d.value,g=G.test(e)?e.substr(5):null;g&&(H.test(g)?(Y[f]||Aa("Callback '".concat(e,'="').concat(f,"\"' not found")),b[g]=Y[f]):F[g]&&(b[g]=f))}return b}(a,{cid:V++,type:A,ui:""}),c=j("iframe"),d=ya(b.cid,c,{embedded:!1});c.width="100%",c.height="100%",m(c,{display:"inline-block",verticalAlign:"middle",borderRadius:"2px",transition:"all .1s ease-out"});var e=function(){return d.send("login:cfg",{url:ua(!1,b.cid,{mode:r,modern:!0}),name:O,embedded:X.mode===u,width:P,height:Q,params:Fa()})};a.addEventListener("focusin",function(){e()}),a.addEventListener("mouseover",function(){e()}),a.addEventListener("touchstart",function(){e()}),d.on("load",function(a){Ba("port[button] loaded",b.cid),e(),ka.push(d),-1<b.ui.indexOf(y)&&d.on("resize",function(a){var b=a.width,d=a.height;c.width=b,c.height=d}),d.on("beforeclick",function(a){ka.forEach(function(a){a!==d&&a.send("login:close",{})}),ta(b.onbeforeclick,a)}),d.on("open:embedded",function(){Ba("port[button] invoke embedded login",b.cid),qa(null,{mode:u})}),d.on("click",function(a){ia?(g("button_logout_click"),oa(b.onlogout)):(g("button_login_click"),ea=d,qa(b.onlogin)),ta(b.onclick,a)}),g("button_onload_".concat(a.status)),ta(b.onload,a)},!0),c.onerror=function(){Aa("[transport] Internal error"),g("transport_error"),ta(b.onerror,sa(!0))},c.setAttribute("frameborder","0"),c.scrolling="no",k(a,c),c.src=na("btn",b),Ba("port[button] created",b)}}function Aa(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];_.push("warn",a)}function Ba(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];_.push("info",a)}function Ca(a,b,c){var d=la(a,b);K.hasOwnProperty(d)&&ta(K[d],c)}function Da(){return Y.innerWidth||Z.documentElement.clientWidth}function Ea(){return Y.innerHeight||Z.documentElement.clientHeight}function Fa(){var a=Y.screen,b=null!=Y.screenLeft?Y.screenLeft:a.left,c=null!=Y.screenTop?Y.screenTop:a.top,d=Da()||a.width,e=Ea()||a.height;return["scrollbars=no","left=".concat((d-P)/2+(parseInt(b,10)||0)),"top=".concat((e-Q)/2.3+(parseInt(c,10)||0)),"width=".concat(P),"height=".concat(Q)].join(",")}function Ga(b){var c=b.origin,d=b.data;if(""!==d&&c===a.OAUTH_HOST)try{Ba("message",d);var e=JSON.parse(d),f=e.cid,h=e.type,j=e.detail;switch(Ca(f,h,j),h){case"load":ha=j.status,g("message_load_auth_status_".concat(j.status));break;case"auth":g("message_auth_status_".concat(j.status)),function(a){ja=a||null,L.splice(0,1e6).forEach(function(a){a({status:ja?p:q,access_token:ja})}),ja&&X.ttlLoginState&&i(U,!0,X.ttlLoginState)}(j.access_token)}}catch(b){Aa(b.stack||b.message)}}setInterval(function(){ka=ka.filter(function(a){if(function(a){return"IFRAME"===a.nodeName}(a.el)){for(var b=a.el;b=b.parentNode;)if(b===Z.body)return!0;return Ba("[gc] port removed:",a),!1}return!0})},3e4),a.AUTH_CONNECTED=p,a.AUTH_NOT_AUTHORIZED=q,a.AUTH_UNKNOWN=o,a.BUTTON_CLASSNAME=z,a.BUTTON_TYPE_LOGIN=A,a.LANG_EN="en-US",a.LANG_RU=v,a.MODE_DEFAULT=r,a.MODE_EMBEDDED=u,a.MODE_HIDDEN=t,a.MODE_ONETAP=s,a.MODE_XHR="xhr",a.SCOPE_CLOUD_API="cloud.api",a.SCOPE_CLOUD_DND="cloud.openapi.dnd",a.SCOPE_DOCS_VIEW="mail.api.documents.view",a.SCOPE_MAIL_IMAP="mail.imap",a.SCOPE_MAIL_PHONE=x,a.SCOPE_USER_INFO=w,a.UI_ALWAYS_LOGIN="always_login",a.UI_FULL_FIT=y,a.UI_LOGIN_AS="login_as",a.UI_USERPIC="userpic",a.__DEV__=function(a){},a.auth=function(a){var c=V++,d=j("iframe");Ba("call auth"),m(d,{visibility:"hidden",position:"absolute",left:"-999px",top:"-999px"}),u===X.mode?L.push(function(b){var c=-1!==X.scopes.indexOf(w);l(d),b.status===p?c?ra(function(){Ba("auth successfully with userinfo",sa()),ta(a,sa()),pa()}):(Ba("auth successfully",b),ta(a,b),pa()):(Aa("User not authorized:",b),qa(a,{userinfo:c,mode:u}))}):L.push(a);var e=X.login;d.src=na("login",b(b({scope:X.scopes.join(" ")},e&&{login:e}),{response_type:"token",mode:t,state:"cid=".concat(c,"&e=").concat(D)})),k(Z.body,d)},a.getRuntimeLog=function(){return _},a.getState=function(){return sa()},a.getUser=ra,a.init=function(a){if(W)Ba("reinit",a);else{if(Ba("init",a),!a)throw new Error("[MR.init] `options` not defined");if(W=!0,!(X=a).clientId)throw new Error("[MR.init] `options.clientId` not defined");null==a.lang&&(a.lang=(Y.location.toString().match(J)||[])[1]||Y.navigator.language||Y.navigator.languages&&Y.navigator.languages[0]||v),Ba("[button] lang: ".concat(a.lang," (nav: ").concat(Y.navigator.language,", [").concat(Y.navigator.languages,"]")),null==a.scopes&&(a.scopes=[w]),null==a.modern&&(a.modern=-1<a.scopes.indexOf(x)||-1<location.toString().indexOf("o2.modern")),null==a.mode&&(a.mode=r),null==a.ttlCloseState&&(a.ttlCloseState=2592e3),null==a.ttlLoginState&&(a.ttlLoginState=a.mode===s?604800:0),a.mode===s&&(!i(T)||a.ttlCloseState<=0)&&(Ba("onetap autologin"),qa(null,{mode:s})),Y.addEventListener("message",Ga,!1)}!function(a){for(var b=Z.getElementsByClassName(z),c=b.length;c--;)a(b[c])}(za)},a.login=qa,a.logout=oa,a.reset=function(){i(T,null),i(U,null)},a.setOAuthHost=function(b){a.OAUTH_HOST=b},Object.defineProperty(a,"__esModule",{value:!0})}(b)},2903:function(a,b,c){"use strict";var d=this&&this.__assign||function(){return d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},d.apply(this,arguments)},e=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):(b=a.value,b instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},f=this&&this.__generator||function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){return function(f){if(c)throw new TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&f[0]?d.return:f[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,f[1])).done)return e;switch(d=0,e&&(f=[2&f[0],e.value]),f[0]){case 0:case 1:e=f;break;case 4:return g.label++,{value:f[1],done:!1};case 5:g.label++,d=f[1],f=[0];continue;case 7:f=g.ops.pop(),g.trys.pop();continue;default:if(!((e=(e=g.trys).length>0&&e[e.length-1])||6!==f[0]&&2!==f[0])){g=0;continue}if(3===f[0]&&(!e||f[1]>e[0]&&f[1]<e[3])){g.label=f[1];break}if(6===f[0]&&g.label<e[1]){g.label=e[1],e=f;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(f);break}e[2]&&g.ops.pop(),g.trys.pop();continue}f=b.call(a,g)}catch(a){f=[6,a],d=0}finally{c=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,h])}}},g=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b,"__esModule",{value:!0});var h=c(3633),i=g(c(6093)),j=function(){function a(a){this.config=d({},a),a.localApi||(this.config.apiDomain="corsapi.imgsmail.ru",h.init({clientId:"4e90afb914c14f19a7ac17ceaa28f336",scopes:["mail.api.survey"]}))}return a.prototype.checkFeedbackVoted=function(a){var b="feedback/nps/check";return(this.config.localApi?this.callLocal(b,{id:a}):this.callOAuth(b,{id:a})).then(function(a){return a.voted})},a.prototype.callLocal=function(a,b){return e(this,void 0,void 0,function(){return f(this,function(c){switch(c.label){case 0:return i.default.hasToken()?[3,2]:[4,i.default.token()];case 1:c.sent(),c.label=2;case 2:return[2,i.default.call(a,b).then(function(a){return a.isOK()?a.body:Promise.reject("RPC.call.fail")})]}})})},a.prototype.callOAuth=function(a,b){return e(this,void 0,void 0,function(){var c,e,g,h;return f(this,function(f){switch(f.label){case 0:return[4,this.fetchAccessToken()];case 1:return c=f.sent(),e="https://"+this.config.apiDomain+"/api/v1/"+a,[4,fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d(d({},b),{access_token:c}))})];case 2:return(g=f.sent()).ok?[4,g.json()]:[2,Promise.reject("fetch.fail")];case 3:return 200!==(h=f.sent()).status?[2,Promise.reject("body.status")]:[2,h.body]}})})},a.prototype.fetchAccessToken=function(){return e(this,void 0,void 0,function(){return f(this,function(a){return[2,new Promise(function(a,b){h.auth(function(c){var d=c.status,e=c.access_token;if(d!==h.AUTH_CONNECTED||!e)return b("oauth");a(e)})})]})})},a}();b.default=j},1326:function(a,b){"use strict";var c=this&&this.__assign||function(){return c=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},c.apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0}),b.FrameLoader=void 0;var d={surveyId:"",domain:"e.mail.ru",iframeScrolling:"auto"},e=function(){function a(a){this.frame=null,this.params=c(c({},d),a),this.handlePostMessage=this.handlePostMessage.bind(this)}return a.prototype.open=function(){var a,b,c=this.createSrc(),d=this.params,e=d.iframeScrolling,f=d.styles,g=document.createElement("iframe");g.frameBorder="0",g.scrolling=e,g.src=c,g.width="336px",g.height="146px",g.style.border="none",g.style.display="block",g.style.position="fixed",g.style.zIndex=String((null==f?void 0:f.zIndex)||500),g.style.bottom=(null==f?void 0:f.bottom)||"0px",g.style.left=(null==f?void 0:f.left)||"0px",window.addEventListener("message",this.handlePostMessage),null===(b=null===(a=window.document)||void 0===a?void 0:a.body)||void 0===b||b.appendChild(g),this.frame=g},a.prototype.getFrameOrigin=function(){return"https://"+(this.params.domain||d.domain)},a.prototype.createSrc=function(){var a=this.params,b=a.surveyId,c=a.darkTheme;return this.getFrameOrigin()+"/feedback/nps?id="+b+"&mode=popup&type=csat&origin="+location.origin+"&darkTheme="+(c?"1":"0")},a.prototype.setDarkTheme=function(a){this.params.darkTheme=!!a,this.sendMessage({action:"setTheme",params:{darkTheme:!!a}})},a.prototype.setSize=function(a){var b=a.width,c=a.height;this.frame&&(b&&(this.frame.width=b+"px"),c&&(this.frame.height=c+"px"))},a.prototype.sendMessage=function(a){var b,d=null===(b=this.frame)||void 0===b?void 0:b.contentWindow,e=this.getFrameOrigin();d&&d.postMessage(c(c({},a),{type:"feedback-evt"}),e)},a.prototype.handlePostMessage=function(a){var b=a.origin,c=a.source,d=a.data;if(this.frame&&b===this.getFrameOrigin()&&c===this.frame.contentWindow&&d&&"feedback-evt"===d.type)switch(d.action){case"close":return this.close();case"setSize":return this.setSize(d.params)}},a.prototype.close=function(){var a,b,c;window.removeEventListener("message",this.handlePostMessage),null===(a=this.frame)||void 0===a||a.remove(),this.frame=null,null===(c=(b=this.params).onClose)||void 0===c||c.call(b)},a}();b.FrameLoader=e},1324:function(a,b,c){"use strict";var d=this&&this.__assign||function(){return d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},d.apply(this,arguments)},e=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b,"__esModule",{value:!0}),b.FeedbackLoader=void 0;var f=e(c(2903)),g=c(1326),h=c(5950),i=c(7738),j=c(2532),k=function(){function a(a){this.frameLoader=null,this.config=d({},a),this.storage=i.createStorage(this.config.userId),this.api=new f.default(this.config),this.onClose=this.onClose.bind(this)}return a.prototype.getSaltedUser=function(){var a=this.config;return""+a.userId+a.surveyId+j.getUtcToday()},a.prototype.update=function(){var a=this,b=j.getUtcToday(),c=this.storage.get("lastCheck");if(this.config.forced)return this.show(),Promise.resolve();if(b===c)return Promise.reject();if(this.storage.set("lastCheck",b),!this.checkLastShow())return Promise.reject();var d=this.config,e=d.userId,f=d.permille,g=d.dryRun,h=d.radar,i=d.surveyId;return null==h||h("feedback-loader_update",{userId:e,permille:f,surveyId:i,dryRun:g}),this.checkJigurda()?(null==h||h("feedback-loader_jigurda-pass",{userId:e,permille:f,surveyId:i,dryRun:g}),g?Promise.resolve():this.checkApi().then(function(b){if(null==h||h("feedback-loader_api-"+(b?"pass":"fail"),{userId:e,permille:f,surveyId:i,dryRun:g}),!b)throw!1;a.show()})):Promise.reject()},a.prototype.checkLastShow=function(){var a=this.storage.get("lastShow"),b=this.config.repeatInterval;return!b||!a||j.isDateOlderThan(a,b)},a.prototype.checkJigurda=function(){var a=this.config.permille,b=this.getSaltedUser();return h.jigurda(b)<a},a.prototype.checkApi=function(){var a=this.config.surveyId;return this.api.checkFeedbackVoted(a).then(function(a){return!a})},a.prototype.show=function(){if(!this.frameLoader){var a=this.config,b=a.surveyId,c=a.userId,d=a.domain,e=a.styles,f=a.darkTheme,h=a.radar;this.frameLoader=new g.FrameLoader({surveyId:b,domain:d,styles:e,darkTheme:f,onClose:this.onClose}),this.frameLoader.open(),this.storage.set("lastShow",j.getUtcToday()),null==h||h("feedback-loader_show",{userId:c,surveyId:b})}},a.prototype.close=function(){if(this.frameLoader){this.frameLoader.close();var a=this.config,b=a.surveyId,c=a.userId,d=a.radar;null==d||d("feedback-loader_close",{userId:c,surveyId:b})}},a.prototype.setDarkTheme=function(a){var b;this.config.darkTheme=!!a,null===(b=this.frameLoader)||void 0===b||b.setDarkTheme(a);var c=this.config,d=c.surveyId,e=c.userId,f=c.radar;null==f||f("feedback-loader_set-dark_"+(a?"on":"off"),{userId:e,surveyId:d})},a.prototype.onClose=function(){this.frameLoader=null},a.prototype._getStorage=function(){return this.storage},a}();b.FeedbackLoader=k},5950:function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.jigurda=void 0,b.jigurda=function(a){var b=0,c=0;b^=-1;for(var d=0,e=a.length;d<e;d++)c=255&(b^a.charCodeAt(d)),b=b>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*c,8);return b=(-1^b)>>>0,b%=1e3}},7738:function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createStorage=b.Storage=void 0;var c=function(){function a(a){void 0===a&&(a=""),this.userId="",this.userId=a;try{this.storage=window.localStorage}catch(a){this.storage={}}}return a.prototype.getExpandedKey=function(a){return(this.userId||"")+":feedback:"+a},a.prototype.set=function(a,b){var c=this.getExpandedKey(a);try{this.storage[c]=JSON.stringify(b)}catch(a){}},a.prototype.get=function(a){var b=this.getExpandedKey(a);try{return JSON.parse(this.storage[b])}catch(a){return null}},a}();b.Storage=c,b.createStorage=function(a){return void 0===a&&(a=""),new c(a)}},2532:function(a,b){"use strict";function c(){var a=new Date;return a.setUTCHours(0,0,0,0),a.getTime()}Object.defineProperty(b,"__esModule",{value:!0}),b.isDateOlderThan=b.getUtcToday=b.DAY=void 0,b.DAY=864e5,b.getUtcToday=c,b.isDateOlderThan=function(a,d){return c()-d*b.DAY>=a}},6093:function(b){"use strict";b.exports=a}},c={},d=function a(d){var e=c[d];if(void 0!==e)return e.exports;var f=c[d]={exports:{}};return b[d].call(f.exports,f,f.exports,a),f.exports}(1324),d;var b,c,d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/feedback",["require","exports","@mail/e.mail.ru.feedback","@mail/xray","default-values","service/auth","service/themes.setup"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);var f;var g;exports.default={update:function(){var h;if(c.CSAT_DISABLED||!c.CSAT_POLL_ID){return}if(!f){f=new a.FeedbackLoader({userId:d.default.user.getEmail(),surveyId:c.CSAT_POLL_ID,permille:c.CSAT_DAILY_PERMILLE,radar:b.default.send,dryRun:c.CSAT_DRY_RUN,domain:c.CSAT_DOMAIN,darkTheme:g!==null&&g!==void 0?g:((h=e.default===null||e.default===void 0?void 0:e.default.getSelectedModel())===null||h===void 0?void 0:h.isDarkMode())||false,repeatInterval:c.CSAT_REPEAT_INTERVAL,styles:{zIndex:9001},localApi:true})}f.update().catch(function(){})},show:function(){f===null||f===void 0?void 0:f.show()},setDarkMode:function(a){if(g===a){return}g=a;if(f){f.setDarkTheme(a)}}}});